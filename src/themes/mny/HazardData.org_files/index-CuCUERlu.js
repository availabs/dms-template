function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/InlineImageComponent-Bk2YPb7W.js","assets/vendor-N4NG2DPp.js","assets/LexicalNestedComposer-Cx-lsotu.js","assets/TableComponent-BcqgjVAs.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var Hb=Object.defineProperty;var zb=(t,s,n)=>s in t?Hb(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var ye=(t,s,n)=>(zb(t,typeof s!="symbol"?s+"":s,n),n);import{R as w,c as ja,u as kt,j as e,g as C,N as dc,r as uc,a as cp,L as je,b,m as Ln,t as tr,s as lt,d as Ye,X as qo,M as dp,l as up,e as mc,i as $t,f as $e,h as pc,k as Fe,C as Ub,n as Sd,o as ls,p as mp,P as Le,D as Wb,q as Gb,v as Jb,w as Ie,x as xt,y as yt,z as ee,A as Ot,B as es,E as Pt,F as Dt,G as _t,H as ks,I as hc,J as pp,K as sn,O as la,Q as Se,S as qb,T as $d,U as Ka,V as ii,W as ci,Y as Kb,Z as Yb,_ as hp,$ as Zb,a0 as Xb,a1 as Qb,a2 as ey,a3 as vl,a4 as Ed,a5 as jl,a6 as ty,a7 as sy,a8 as ny,a9 as ay,aa as ry,ab as oy,ac as ly,ad as iy,ae as cy,af as dy,ag as uy,ah as my,ai as Oe,aj as py,ak as hy,al as fy,am as Vn,an as Us,ao as zt,ap as fc,aq as gy,ar as xy,as as Be,at as Je,au as di,av as by,aw as In,ax as gc,ay as ft,az as Tt,aA as ha,aB as Ds,aC as Ko,aD as cn,aE as dn,aF as yy,aG as vy,aH as jy,aI as wy,aJ as Ny,aK as Mt,aL as fp,aM as xc,aN as gp,aO as js,aP as Cy,aQ as _y,aR as Sy,aS as Hn,aT as wa,aU as $y,aV as Ey,aW as ky,aX as Lr,aY as Ir,aZ as Ly,a_ as wl,a$ as Iy,b0 as Ty,b1 as ur,b2 as Yo,b3 as cs,b4 as ps,b5 as fa,b6 as My,b7 as kd,b8 as ws,b9 as By,ba as Ay,bb as Oy,bc as Py,bd as Dy,be as bc,bf as Ry,bg as Fy,bh as ho,bi as xp,bj as Vy,bk as Hy,bl as yc,bm as zy,bn as Uy,bo as Wy,bp as Ld,bq as he,br as Gy,bs as vc,bt as Jy,bu as bp,bv as qy,bw as Ky,bx as Yy,by as Zy,bz as Xy,bA as Tr,bB as Qy,bC as e1,bD as t1,bE as s1,bF as Is,bG as Id,bH as Mr,bI as mt,bJ as fo,bK as n1,bL as a1,bM as r1,bN as o1}from"./vendor-N4NG2DPp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();const Me=(()=>{let t=null;return function s(n){return arguments.length?(t={...n},Object.assign(s,n),s):t}})(),nt=(t,s,n={})=>fetch(t,{method:"POST",headers:{Accept:"application/json, text/plain","Content-type":"application/json"},body:JSON.stringify(s),...n}).then(r=>{if(r.ok)return r.json();throw new Error("There was a network problem.")}),yp="AMS::USER_LOGIN",vp="AMS::USER_LOGOUT",ia="AMS::AUTH_FAILURE",jp="AMS::UPDATE_USER",wp="AMS::IS_AUTHENTICATING",mr=t=>({type:yp,user:t}),Np=t=>{window.localStorage&&window.localStorage.setItem("userToken",t.token)},l1=t=>window.localStorage?window.localStorage.getItem("userToken"):null,Td=()=>{window.localStorage&&window.localStorage.removeItem("userToken")},i1=()=>t=>Promise.resolve(t({type:vp})),Cp=()=>({type:wp}),c1=(t,s)=>n=>{const{AUTH_HOST:r,PROJECT_NAME:a}=Me();return n(Cp()),nt(`${r}/login`,{email:t,password:s,project:a}).then(l=>{l.error?(n({type:ia}),n(Ee(l.error,{type:"Danger"}))):n(mr(l.user))}).catch(l=>{n(Ee("Cannot contact authentication server.")),n({type:ia})})},Nt=(t=l1())=>s=>t?(s(Cp()),nt(`${Me.AUTH_HOST}/auth`,{token:t,project:Me.PROJECT_NAME}).then(n=>{n.error?(s({type:ia}),s(Ee(n.error))):s(mr(n.user))}).catch(n=>{s(Ee("Cannot contact authentication server.")),s({type:ia})})):s({type:ia}),d1=(t,s)=>(n,r)=>{const{token:a}=r().user;return a?nt(`${Me.AUTH_HOST}/password/update`,{token:a,current:t,password:s}).then(l=>l.error?n(Ee(l.error)):(Np(l),n(Ee(l.message)),n({type:jp,update:{token:l.token}}))):Promise.resolve()},u1=(t,s)=>n=>{const{AUTH_HOST:r,CLIENT_HOST:a}=Me();return nt(`${r}/password/set`,{token:t,password:s,host:a,url:"/auth/set-passord"}).then(l=>{if(l.error)n(Ee(l.error));else return l.message&&n(Ee(l.message)),n(Nt(l.token))})},m1=t=>s=>{const{AUTH_HOST:n,PROJECT_NAME:r,CLIENT_HOST:a}=Me();return nt(`${n}/password/reset`,{email:t,project_name:r,host:a,url:"/auth/set-password"}).then(l=>{l.error?s(Ee(l.error)):s(Ee(l.message))})},_p="AMS::GET_USERS",p1="AMS::USERS_IN_GROUPS",Ws=()=>(t,s)=>{const{token:n}=s().user;return n?nt(`${Me.AUTH_HOST}/users`,{token:n}).then(r=>{r.error?(t(Nt()),t(Ee(r.error))):t({type:_p,...r})}):Promise.resolve()},h1=t=>(s,n)=>{const{token:r}=n().user;return r?nt(`${Me.AUTH_HOST}/users/bygroup`,{token:r,groups:[t]}).then(a=>{a.error?(s(Nt()),s(Ee(a.error))):s({type:p1,group:t,...a})}):Promise.resolve()},f1=(t,s)=>(n,r)=>{const{token:a,email:l}=r().user;return a?nt(`${Me.AUTH_HOST}/user/group/assign`,{token:a,user_email:t,group_name:s}).then(i=>i.error?(n(Nt()),n(Ee(i.error))):n(Ws()).then(()=>{l===t&&n(Nt())}).then(()=>{if(i.message)return n(Ee(i.message))})):Promise.resolve()},g1=(t,s)=>(n,r)=>{const{token:a,email:l}=r().user;return a?nt(`${Me.AUTH_HOST}/user/group/remove`,{token:a,user_email:t,group_name:s}).then(i=>{if(i.error)n(Nt()),n(Ee(i.error));else return n(Ws()).then(()=>{l===t&&n(Nt())}).then(()=>{i.message&&n(Ee(i.message))})}):Promise.resolve()},x1=t=>(s,n)=>{const{token:r}=n().user;return r?nt(`${Me.AUTH_HOST}/user/delete`,{token:r,user_email:t}).then(a=>{a.error?(s(Nt()),s(Ee(a.error))):(s(Ws()),s(Nt()),a.message&&s(Ee(a.message)))}):Promise.resolve()},Sp="AMS::GET_GROUPS",un=()=>(t,s)=>{const{token:n}=s().user;return n?nt(`${Me.AUTH_HOST}/groups`,{token:n}).then(r=>{r.error?(t(Nt()),t(Ee(r.error))):t({type:Sp,...r})}):Promise.resolve()},b1=t=>(s,n)=>{const{token:r}=n().user;return r?nt(`${Me.AUTH_HOST}/group/create`,{token:r,name:t}).then(a=>{a.error?(s(Nt()),s(Ee(a.error))):(s(un()),a.message&&s(Ee(a.message)))}):Promise.resolve()},y1=t=>(s,n)=>{const{token:r,groups:a}=n().user;return r?nt(`${Me.AUTH_HOST}/group/delete`,{token:r,name:t}).then(l=>{l.error?(s(Nt()),s(Ee(l.error))):(a.includes(t)&&s(Nt()),s(Ws()),s(un()),l.message&&s(Ee(l.message)))}):Promise.resolve()},v1=(t,s)=>(n,r)=>{const{token:a}=r().user;return a?nt(`${Me.AUTH_HOST}/group/create/project/assign`,{token:a,group_name:t,project_name:Me.PROJECT_NAME,auth_level:s}).then(l=>{l.error?(n(Nt()),n(Ee(l.error))):(n(un()),l.message&&n(Ee(l.message)))}):Promise.resolve()},j1=(t,s)=>(n,r)=>{const{token:a,groups:l}=r().user;return a?nt(`${Me.AUTH_HOST}/group/project/assign`,{token:a,group_name:t,project_name:Me.PROJECT_NAME,auth_level:s}).then(i=>{i.error?(n(Nt()),n(Ee(i.error))):(l.includes(t)&&n(Nt()),n(un()),i.message&&n(Ee(i.message)))}):Promise.resolve()},w1=t=>(s,n)=>{const{token:r,groups:a}=n().user;return r?nt(`${Me.AUTH_HOST}/group/project/remove`,{token:r,group_name:t,project_name:Me.PROJECT_NAME}).then(l=>{l.error?(s(Nt()),s(Ee(l.error))):(a.includes(t)&&s(Nt()),s(un()),s(Ws()),l.message&&s(Ee(l.message)))}):Promise.resolve()},N1=(t,s)=>(n,r)=>{const{token:a}=r().user;return a?nt(`${Me.AUTH_HOST}/group/project/adjust`,{token:a,group_name:t,project_name:Me.PROJECT_NAME,auth_level:s}).then(l=>{l.error?(n(Nt()),n(Ee(l.error))):(n(un()),l.message&&n(Ee(l.message)))}):Promise.resolve()},$p="AMS::GET_REQUESTS",pr=()=>(t,s)=>{const{token:n}=s().user;return n?nt(`${Me.AUTH_HOST}/requests/byProject`,{token:n,project_name:Me.PROJECT_NAME}).then(r=>{r.error?t(Ee(r.error)):(t({type:$p,...r}),r.message&&t(Ee(r.message)))}):Promise.resolve()},C1=(t,s=!1)=>n=>nt(`${Me.AUTH_HOST}/signup/request`,{email:t,addToGroup:s,project:Me.PROJECT_NAME,host:Me.CLIENT_HOST,url:s?"/auth/verify-request":"/auth/verify-email"}).then(r=>r.error?n(Ee(r.error,{type:"Danger"})):(r.user&&n(mr(r.user)),n(Ee(r.message)))).catch(r=>console.log("err",r)),_1=(t,s)=>(n,r)=>{const{token:a}=r().user;return a?nt(`${Me.AUTH_HOST}/signup/accept`,{group_name:s,user_email:t,token:a,project_name:Me.PROJECT_NAME,host:Me.CLIENT_HOST,url:"/auth/set-password"}).then(l=>l.error?n(Ee(l.error,{type:"Danger"})):(n(pr()),n(Ws()),n(Ee(l.message)))):Promise.resolve()},S1=({user_email:t,project_name:s})=>(n,r)=>{const{token:a}=r().user;return a?nt(`${Me.AUTH_HOST}/signup/reject`,{token:a,user_email:t,project_name:s}).then(l=>{l.error?n(Ee(l.error)):(n(pr()),n(Ws()),l.message&&n(Ee(l.message)))}):Promise.resolve()},$1=t=>s=>nt(`${Me.AUTH_HOST}/email/verify`,{token:t}).then(n=>({dispatch:s,res:n,sendSystemMessage:Ee})),E1=(t,s)=>n=>nt(`${Me.AUTH_HOST}/signup/request/verify`,{token:t,password:s}).then(r=>(console.log("verifyRequest::res",r),r.error?n(Ee(r.error,{type:"Danger"})):(n(Ee(r.message)),n(mr(r.user))))),k1=t=>(s,n)=>{const{token:r}=n().user;return r?nt(`${Me.AUTH_HOST}/signup/delete`,{token:r,user_email:t.user_email,project_name:t.project_name}).then(a=>{a.error?(s(Nt()),s(Ee(a.error))):(s(pr()),a.message&&s(Ee(a.message)))}):Promise.resolve()},L1=(t,s)=>(n,r)=>{const{token:a}=r().user;return a?nt(`${Me.AUTH_HOST}/invite`,{token:a,user_email:t,group_name:s,project_name:Me.PROJECT_NAME,host:Me.CLIENT_HOST,url:"/auth/accept-invite"}).then(l=>{l.error?(n(Nt()),n(Ee(l.error))):(n(pr()),n(Ee(l.message)))}):Promise.resolve()},I1=(t,s)=>n=>nt(`${Me.AUTH_HOST}/invite/accept`,{token:t,password:s}).then(r=>r.error?(n(Nt()),n(Ee(r.error,{type:"Danger"}))):(n(Ee(r.message)),n(mr(r.user)))),jc="AMS::GET_PREFERENCES",T1=()=>(t,s)=>{const{token:n}=s().user;if(n){const{AUTH_HOST:r,PROJECT_NAME:a}=Me();nt(`${r}/preferences`,{token:n,project:a}).then(l=>{l.error?t(Ee(l.error)):t({type:jc,preferences:l.preferences||{}})})}else return Promise.resolve()},M1=t=>(s,n)=>{const{token:r}=n().user;if(r){const{AUTH_HOST:a,PROJECT_NAME:l}=Me();nt(`${a}/preferences/update`,{token:r,project:l,preferences:t}).then(i=>{i.error?s(Ee(i.error)):(s(Ee(i.message)),s({type:jc,preferences:i.preferences}))})}else return Promise.resolve()},Ep="AMS::GET_SLACK_USER",B1=t=>(s,n)=>{const{SLACK_KEY:r}=Me();if(r){const a="https://slack.com/api/users.lookupByEmail",l={method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:`token=${encodeURIComponent(r)}&email=${encodeURIComponent(t)}`};return fetch(a,l).then(i=>{if(i.ok)return i.json();s(Ee("There was a network error."))}).then(i=>{i.ok?s({type:Ep,slacker:i.user}):s(Ee(i.error))})}else return Promise.resolve()},A1=t=>(s,n)=>{const{SLACK_KEY:r}=Me();if(!r)return Promise.resolve()},kp="AMS::GET_MESSAGES",Zo=()=>(t,s)=>{const{token:n}=s().user;if(n){const{AUTH_HOST:r,PROJECT_NAME:a}=Me();nt(`${r}/messages`,{token:n,project:a}).then(l=>{l.error?t(Ee(l.error)):t({type:kp,...l})}).catch(l=>{})}else return Promise.resolve()},O1=t=>(s,n)=>{const{token:r}=n().user;if(r){const{AUTH_HOST:a}=Me();nt(`${a}/messages/view`,{token:r,ids:t}).then(l=>{l.error?s(Ee(l.error)):s(Zo())}).catch(l=>{})}else return Promise.resolve()},P1=t=>(s,n)=>{const{token:r}=n().user;if(r){const{AUTH_HOST:a}=Me();nt(`${a}/messages/delete`,{token:r,ids:t}).then(l=>{l.error?s(Ee(l.error)):s(Zo())}).catch(l=>{})}else return Promise.resolve()},Lp=(t,s,n,r)=>(a,l)=>{const{token:i}=l().user;if(i){const{AUTH_HOST:c,PROJECT_NAME:d}=Me();return nt(`${c}/messages/post`,{token:i,heading:t,message:s,type:n,target:r,project:d}).then(u=>{u.error?a(Ee(u.error)):u.message&&a(Ee(u.message,{type:"Info"}))})}else return Promise.resolve()},Ip=Object.freeze(Object.defineProperty({__proto__:null,acceptInvite:I1,adjustAuthLevel:N1,assignToGroup:f1,assignToProject:j1,auth:Nt,createAndAssign:v1,createGroup:b1,deleteGroup:y1,deleteMessages:P1,deleteRequest:k1,deleteUser:x1,getGroups:un,getMessages:Zo,getRequests:pr,getSlackUserFromEmail:B1,getSlackUserFromUserId:A1,getUserPreferences:T1,getUsers:Ws,login:c1,logout:i1,postMessage:Lp,removeFromGroup:g1,removeFromProject:w1,resetPassword:m1,sendInvite:L1,setPassword:u1,signup:C1,signupAccept:_1,signupReject:S1,updatePassword:d1,updateUserPreferences:M1,usersForGroup:h1,verifyEmail:$1,verifyRequest:E1,viewMessages:O1},Symbol.toStringTag,{value:"Module"}));w.createContext({...Ip});const D1=t=>ja(n=>({user:n.user,slacker:n.slacker,groups:n.groups,users:n.users,requests:n.requests,messages:n.avlMessages,preferences:n.preferences}),{...Ip})(t),R1=t=>s=>{const n=kt();return e.jsx(t,{...s,location:n})},F1=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{email:"",password:""})}handleSubmit(a){a.preventDefault(),this.props.login(this.state.email,this.state.password)}render(){const{email:a,password:l}=this.state,i=a&&l,{location:c,user:d,redirectTo:u}=this.props,{pathname:p}=c;if(d.authed){const m=C(c,["state","from"]),h=p===m||!m?u:m;return e.jsx(dc,{to:h})}return e.jsx(t,{...this.props,...this.state,handleSubmit:m=>this.handleSubmit(m),update:m=>this.setState(m),canSubmit:i})}},ye(s,"defaultProps",{amsAction:"login",redirectTo:"/",showIfLoggedIn:!1}),s},V1=t=>{var s;return s=class extends w.Component{render(){return e.jsx(t,{...this.props})}},ye(s,"defaultProps",{amsAction:"logout",redirectTo:"/",authLevel:0}),s},H1=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{email:"",verify:""})}handleSubmit(a){a.preventDefault(),this.setState({email:"",verify:""}),this.props.signup(this.state.email,this.props.addToGroup)}render(){const{email:a,verify:l}=this.state,i=a&&l&&a===l;return this.props.user.authed?uc(this.props.redirectTo):e.jsx(t,{...this.props,...this.state,handleSubmit:c=>this.handleSubmit(c),update:c=>this.setState(c),canSubmit:i})}},ye(s,"defaultProps",{amsAction:"signup",addToGroup:!1,redirectTo:"/",showIfLoggedIn:!1}),s},z1=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{email:"",verify:""})}handleSubmit(a){a.preventDefault(),this.setState({email:"",verify:""}),this.props.resetPassword(this.state.email)}render(){const{email:a,verify:l}=this.state,i=a&&l&&a===l;return e.jsx(t,{...this.props,...this.state,handleSubmit:c=>this.handleSubmit(c),update:c=>this.setState(c),canSubmit:i})}},ye(s,"defaultProps",{amsAction:"reset-password"}),s},U1=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{password:"",verify:""})}handleSubmit(a){a.preventDefault(),this.setState({password:"",verify:""}),this.props.verifyRequest(this.props.urlArg,this.state.password)}render(){const{password:a,verify:l}=this.state,i=a&&l&&a===l;return this.props.user.authed?e.jsx(dc,{to:this.props.redirectTo}):e.jsx(t,{...this.state,...this.props,canSubmit:i,handleSubmit:c=>this.handleSubmit(c),update:c=>this.setState(c)})}},ye(s,"defaultProps",{amsAction:"verify-request",urlArg:null,showInDirectory:!1,redirectTo:"/"}),s},W1=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{password:"",verify:""})}handleSubmit(a){a.preventDefault(),console.log("handle submit set password",this.props,this.state),this.props.setPassword(this.props.urlArg,this.state.password),this.setState({password:"",verify:""})}render(){const{password:a,verify:l}=this.state,i=a&&l&&a===l;return this.props.user.authed?uc(this.props.redirectTo):e.jsx(t,{...this.state,...this.props,canSubmit:i,handleSubmit:c=>this.handleSubmit(c),update:c=>this.setState(c)})}},ye(s,"defaultProps",{amsAction:"set-password",urlArg:null,showInDirectory:!1,redirectTo:"/"}),s},G1=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{verified:"waiting"});ye(this,"MOUNTED",!1)}setState(...a){this.MOUNTED&&super.setState(...a)}componentDidMount(){this.MOUNTED=!0,this.props.verifyEmail(this.props.urlArg).then(({res:a,dispatch:l,sendSystemMessage:i})=>{a.error?(l(i(a.error,{type:"Danger",id:"email-verification-failed"})),this.setState({verified:"failed"})):(l(i(a.message,{type:"Info",id:"email-verification-succeeded"})),this.setState({verified:"succeeded"}))})}componentWillUnmount(){this.MOUNTED=!1}render(){return e.jsx(t,{...this.props,...this.state})}},ye(s,"defaultProps",{amsAction:"verify-email",urlArg:null,showInDirectory:!1}),s},J1=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{password:"",verify:""})}handleSubmit(a){a.preventDefault(),this.props.acceptInvite(this.props.urlArg,this.state.password),this.setState({password:"",verify:""})}render(){const{password:a,verify:l}=this.state,i=a&&l&&a===l;return this.props.user.authed?uc(this.props.redirectTo):e.jsx(t,{...this.state,...this.props,canSubmit:i,handleSubmit:c=>this.handleSubmit(c),update:c=>this.setState(c)})}},ye(s,"defaultProps",{amsAction:"accept-invite",urlArg:null,showInDirectory:!1,redirectTo:"/"}),s},q1=t=>{var s;return s=class extends w.Component{render(){return e.jsx(t,{...this.props})}},ye(s,"defaultProps",{amsAction:"directory",showInDirectory:!1}),s},K1={current:"",password:"",verify:""},Y1=t=>({updatePassword:s,...n})=>{const[r,a]=w.useState(K1),l=w.useCallback(d=>{a(u=>({...u,...d}))},[]),i=w.useMemo(()=>{const{current:d,password:u,verify:p}=r;return d&&u&&d!==u&&u===p},[r]),c=w.useCallback(d=>{d.preventDefault(),i&&s(r.current,r.password)},[s,r,i]);return e.jsx(t,{...n,...r,canSubmit:i,handleSubmit:c,update:l})},Z1=t=>{var s;return s=class extends w.Component{render(){const{requests:r,...a}=this.props,[l,i,c]=r.reduce((d,u)=>(u.state==="pending"?d[0].push(u):u.state==="awaiting"?d[1].push(u):u.state==="rejected"&&d[2].push(u),d),[[],[],[]]);return r.length?e.jsx(t,{...a,pending:l,awaiting:i,rejected:c}):null}},ye(s,"defaultProps",{amsAction:"requests",authLevel:5}),s},X1=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{email:"",verify:"",group:null})}handleSubmit(a){a.preventDefault(),this.props.sendInvite(this.state.email,this.state.group.name)}render(){const{email:a,verify:l,group:i}=this.state,c=a&&l&&i&&a===l;return e.jsx(t,{...this.props,...this.state,handleSubmit:d=>this.handleSubmit(d),update:d=>this.setState(d),canSubmit:c})}},ye(s,"defaultProps",{amsAction:"send-invite",authLevel:5}),s},Q1=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{group:null,authLevel:-1})}handleSubmit(a){a.preventDefault();const{group:l,authLevel:i}=this.state;this.props.assignToProject(l.name,i),this.setState({group:null,authLevel:-1})}render(){const{user:a}=this.props,{group:l,authLevel:i}=this.state,c=l&&i>=0&&a.authLevel>=i;return e.jsx(t,{...this.props,...this.state,groups:this.props.otherGroups,update:d=>this.setState(d),canSubmit:c,handleSubmit:d=>this.handleSubmit(d)})}},ye(s,"defaultProps",{amsAction:"assign-to-project",authLevel:5}),s},ev=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{group:"",authLevel:-1})}handleSubmit(a){a.preventDefault();const{group:l,authLevel:i}=this.state;this.props.createAndAssign(l,i),this.setState({group:"",authLevel:-1})}render(){const{user:a}=this.props,{group:l,authLevel:i}=this.state,c=l&&i>=0&&a.authLevel>=i;return e.jsx(t,{...this.props,...this.state,groups:this.props.otherGroups,update:d=>this.setState(d),canSubmit:c,handleSubmit:d=>this.handleSubmit(d)})}},ye(s,"defaultProps",{amsAction:"create-group",authLevel:5}),s},Tp="SEND_SYSTEM_MESSAGE",Mp="DISMISS_SYSTEM_MESSAGE";let tv=0;const sv=()=>`system-message-${++tv}`,ui=["Danger","Warning","Success","Info"],nv={duration:7500,type:ui[0],onDismiss:()=>{},onConfirm:null},av=t=>(t.id||(t.id=sv()),ui.includes(t.type)||(t.type=ui[0]),t),Ee=(t,s={})=>n=>Promise.resolve(n({type:Tp,message:t,options:av({...nv,...s})})),rv=t=>s=>Promise.resolve(s({type:Mp,id:t})),ov=(t=[],s)=>{switch(s.type){case Tp:{let n=t.filter(({id:r})=>r!==s.options.id);return n.push({message:s.message,...s.options}),n}case Mp:return t.filter(({id:n})=>n!==s.id);default:return t}},lv={heading:"",message:"",type:"",target:"",filterGroups:[]},iv=(t,s)=>{const{type:n,payload:r}=s;switch(n){case"update-state":return{...t,...r};default:return t}},cv=t=>{const s=({getUsers:a,getGroups:l,users:i,groups:c,projectName:d,postMessage:u,sendSystemMessage:p,...m})=>{w.useEffect(()=>{a(),l()},[a,l]);const[h,f]=w.useReducer(iv,lv),g=w.useMemo(()=>{const{filterGroups:_}=h,E=_.reduce((L,S)=>(L[S]=!0,L),{});return i.filter(({projects:L})=>L.reduce((S,k)=>S||k.project_name===d,!1)).filter(({groups:L})=>L.reduce((S,k)=>S||E[k],!_.length)).sort((L,S)=>L.email.localeCompare(S.email))},[i,d,h]),x=w.useMemo(()=>c.filter(({projects:_})=>_.reduce((E,L)=>E||L.project_name===d,!1)).sort((_,E)=>_.name.localeCompare(E.name)),[c,d]),y=w.useCallback(_=>{"type"in _&&(_.target=""),_.type==="project"&&(_.target=d),f({type:"update-state",payload:_})},[d,f]),j=w.useMemo(()=>{const{heading:_,message:E,type:L,target:S}=h;return!!(_&&E&&L&&S)},[h]),N=w.useCallback(()=>{if(!j)return;const{heading:_,message:E,type:L,target:S}=h;return u(_,E,L,S)},[u,h,j]);return e.jsx(t,{...m,canPostMessage:j,postMessage:N,updatePostState:y,postState:h,users:g,groups:x})};return ja(a=>({messages:a.messages,users:a.users,groups:a.groups,projectName:Me.PROJECT_NAME}),{postMessage:Lp,getMessages:Zo,getUsers:Ws,getGroups:un,sendSystemMessage:Ee})(s)},Kr=()=>({token:null,groups:[],authLevel:-1,authed:!1,attempts:0,meta:[],id:null,isAuthenticating:!1,email:null}),dv=(t=Kr(),s)=>{switch(s.type){case wp:return{...t,isAuthenticating:!0};case jp:return{...t,...s.update};case yp:{Np(s.user);const n={...t,...s.user,authed:!0,isAuthenticating:!1};return++n.attempts,n}case ia:{Td();const n=Kr();return++n.attempts,n}case vp:return Td(),Kr();default:return t}},uv=[],mv=(t=uv,s)=>{switch(s.type){case Sp:return s.groups;default:return t}},pv=[],hv=(t=pv,s)=>{switch(s.type){case _p:return s.users;default:return t}},fv="AMS::GET_PROJECTS",gv=[],xv=(t=gv,s)=>{switch(s.type){case fv:return s.projects;default:return t}},bv=[],yv=(t=bv,s)=>{switch(s.type){case $p:return s.requests;default:return t}},Md={receiveEmail:!1,receiveSlack:!1,slackUserId:void 0},vv=(t=Md,s)=>{switch(s.type){case jc:return{...Md,...s.preferences};default:return t}},jv={profile:{email:void 0},id:void 0},wv=(t=jv,s)=>{switch(s.type){case Ep:return s.slacker;default:return t}},Nv=[],Cv=(t=Nv,s)=>{switch(s.type){case kp:return s.messages;default:return t}},Bp={user:dv,groups:mv,users:hv,projects:xv,requests:yv,preferences:vv,slacker:wv,avlMessages:Cv},Ap=({message:t,top:s,type:n,show:r,dismiss:a,confirm:l=null})=>{const i={bgDanger:"bg-red-300 border border-red-400"};return console.log("type",n,s),e.jsx("div",{className:`bg-white absolute whitespace-nowrap rounded ${r}`,style:{top:`${s}rem`},children:e.jsx("div",{className:`
          bg-opacity-25 ${i[`bg${n}`]}
          rounded px-6 py-2 text-large
        `,children:e.jsxs("div",{className:"flex justify-center ",children:[e.jsx("div",{className:"mr-4 p-2",children:t}),e.jsx("button",{onClick:a,className:"px-3 rounded-md hover:bg-white text-xl",children:"✕"}),l?e.jsx("span",{className:"ml-2",children:e.jsx("button",{onClick:l,className:"px-3 rounded-md hover:bg-white text-xl",children:"✓"})}):null]})})})};class Op extends w.Component{constructor(){super(...arguments);ye(this,"state",{show:"show"});ye(this,"timeout",null)}componentDidMount(){this.props.duration&&(this.timeout=setTimeout(this.dismiss.bind(this),this.props.duration))}dismiss(){console.log("dismissing"),this.setState({show:"hide"}),clearTimeout(this.timeout),this.timeout=setTimeout(this.props.dismissSystemMessage,750,this.props.id),this.props.onDismiss()}render(){return console.log("rendering message",this.props,this.state),e.jsx(Ap,{...this.props,...this.state,dismiss:n=>this.dismiss(n)})}}class _v extends Op{confirm(){this.setState({show:"hide"}),clearTimeout(this.timeout),console.log("confirm message"),this.timeout=setTimeout(this.props.dismissSystemMessage,750,this.props.id),this.props.onConfirm()}render(){return e.jsx(Ap,{...this.props,...this.state,dismiss:s=>this.dismiss(s),confirm:s=>this.confirm(s)})}}const Sv=({messages:t,dismissSystemMessage:s})=>t!=null&&t.length?e.jsx("div",{className:"fixed z-50 top-[70px] right-[350px]",children:t.map((n,r)=>n.onConfirm?e.jsx(_v,{top:r*3,...n,dismissSystemMessage:s},n.id):e.jsx(Op,{className:"absolute whitespace-nowrap",top:r*3,...n,dismissSystemMessage:s},n.id))}):e.jsx("span",{}),$v=t=>({messages:t.messages}),Pp=ja($v,{dismissSystemMessage:rv})(Sv);cp({reducer:{...Bp,messages:Pp}});const Ev=(t,s)=>{Me(s);const n=({authFunc:a,...l})=>(w.useEffect(()=>{a()},[a]),e.jsx(Dp.Provider,{value:l.user,children:e.jsx(t,{...l,isAuthenticating:C(l,["user","isAuthenticating"],!1)})}));return ja(a=>({user:a.user}),{authFunc:Nt})(n)},Dp=w.createContext(Kr()),kv=()=>w.useContext(Dp),Rp=t=>ja((n,r)=>({user:n.user}),null)(t),Lv=F1(({email:t,password:s,update:n,canSubmit:r,handleSubmit:a,title:l=""})=>e.jsx("div",{className:"h-full bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8 ",children:e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsxs("div",{className:"bg-white py-8 px-4 shadow-lg sm:rounded-md sm:px-10",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-medium text-gray-900",children:l}),e.jsx("p",{className:"text-lg font-thin text-gray-600",children:e.jsx("span",{href:"#",className:"font-thin text-blue-400 hover:text-blue-500",children:"Login"})})]}),e.jsxs("form",{className:"space-y-6",onSubmit:a,children:[e.jsxs("div",{className:"pt-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-thin text-gray-700",children:"Email"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"email",name:"email",type:"email",value:t,onChange:i=>n({email:i.target.value}),autoComplete:"email",placeholder:"Enter your email",required:!0,autoFocus:!0,className:"appearance-none block w-full px-3 py-2 border-b border-gray-300 shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-thin text-gray-700",children:"Password"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"password",name:"password",type:"password",value:s,onChange:i=>n({password:i.target.value}),autoComplete:"current-password",placeholder:"Enter your password",required:!0,className:"appearance-none block w-full px-3 py-2 border-b border-gray-300 shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Sign in"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"text-xs",children:["Need an account?  ",e.jsx(je,{to:"/auth/register",className:"font-medium text-blue-600 hover:text-blue-500",children:"Register"})]}),e.jsx("div",{className:"text-xs",children:e.jsx(je,{to:"/auth/reset-password",className:"font-medium text-blue-600 hover:text-blue-500",children:"Forgot your password?"})})]})]})})),Iv=V1(({logout:t,redirectTo:s="/"})=>(w.useEffect(()=>{t()},[t]),e.jsx(dc,{to:s}))),Tv=({children:t,className:s="mt-16"})=>e.jsx("div",{className:s,children:e.jsx("div",{className:"py-20",children:t})}),Mv={type:Tv,props:{amsAction:"project-management",authLevel:5},wrappers:["ams-project-management"],children:[{type:"ams-requests"},{type:"ams-send-invite"},{type:"ams-user-search"},{type:"ams-assign-to-project"},{type:"ams-create-group"},{type:"ams-groups-in-project"}]};function Bv(){return{landing:{wrapper:"p-4 border-2 border-blue-300"},table:{table:"min-w-full divide-y divide-gray-300",thead:"",th:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900",tbody:"divide-y divide-gray-200 ",td:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},textarea:{viewWrapper:"overflow-hidden p-2 bg-gray-100 border-b-2"},card:{wrapper:"p-4",row:"flex py-1",rowLabel:"px-4 w-28 text-sm",rowContent:"flex-1"}}}const Fp=Bv(),Vp=w.createContext(Fp),Av=()=>b.useContext(Vp),zn=({Title:t,children:s,className:n=""})=>(Av(),e.jsxs("div",{className:`
      rounded p-10 shadow-xl
      ${n}
    `,children:[t?typeof t=="function"?e.jsx(t,{}):e.jsx("div",{className:"text-3xl font-bold mb-2",children:t}):null,s]})),Ov=H1(({email:t,verify:s,update:n,canSubmit:r,handleSubmit:a,title:l=""})=>e.jsx("div",{className:"h-full bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8 ",children:e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsxs("div",{className:"bg-white py-8 px-4 shadow-lg sm:rounded-md sm:px-10",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-medium text-gray-900",children:l}),e.jsx("p",{className:"text-lg font-thin text-gray-600",children:e.jsx("span",{href:"#",className:"font-thin text-blue-400 hover:text-blue-500",children:"Register"})})]}),e.jsxs("form",{className:"space-y-6",onSubmit:a,children:[e.jsxs("div",{className:"pt-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-thin text-gray-700",children:"Email"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"email",name:"email",type:"email",value:t,onChange:i=>n({email:i.target.value}),autoComplete:"email",placeholder:"Enter your email",autoFocus:!0,required:!0,className:"appearance-none block w-full px-3 py-2 border-b border-gray-300 shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-thin text-gray-700",children:"Verify Your Email"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"verify",name:"verify",type:"email",value:s,onChange:i=>n({verify:i.target.value}),autoComplete:"Verify your email.",placeholder:"Verify your email.",required:!0,className:"appearance-none block w-full px-3 py-2 border-b border-gray-300 shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Register"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsx("div",{className:"text-xs"}),e.jsx("div",{className:"text-xs",children:e.jsx(je,{to:"/auth/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Login"})})]})]})})),Pv=z1(({email:t,verify:s,update:n,canSubmit:r,handleSubmit:a,title:l})=>e.jsx("div",{className:"h-full bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8 ",children:e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsxs("div",{className:"bg-white py-8 px-4 shadow-lg sm:rounded-md sm:px-10",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-medium text-gray-900",children:l}),e.jsx("p",{className:"text-lg font-thin text-gray-600",children:e.jsx("span",{href:"#",className:"font-thin text-blue-400 hover:text-blue-500",children:"Reset Password"})})]}),e.jsxs("form",{className:"space-y-6",onSubmit:a,children:[e.jsxs("div",{className:"pt-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-thin text-gray-700",children:"Email"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"email",name:"email",type:"email",value:t,onChange:i=>n({email:i.target.value}),autoComplete:"email",placeholder:"Enter your email",autoFocus:!0,required:!0,className:"appearance-none block w-full px-3 py-2 border-b border-gray-300 shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-thin text-gray-700",children:"Verify Email"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"verify",name:"verify",type:"email",value:s,onChange:i=>n({verify:i.target.value}),autoComplete:"Verify your email.",placeholder:"Verify your email.",required:!0,className:"appearance-none block w-full px-3 py-2 border-b border-gray-300 shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Request Pasword"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"text-xs",children:["Need an account?  ",e.jsx(je,{to:"/auth/register",className:"font-medium text-blue-600 hover:text-blue-500",children:"Register"})]}),e.jsx("div",{className:"text-xs",children:e.jsx(je,{to:"/auth/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Login"})})]})]})})),Dv=U1(({password:t,verify:s,update:n,canSubmit:r,handleSubmit:a,...l})=>e.jsx("div",{className:"h-full flex-1 flex items-center justify-center",children:e.jsx(zn,{Title:"Verify Request",children:e.jsxs("form",{onSubmit:a,children:[e.jsxs("div",{className:"my-2",children:[e.jsx("label",{htmlFor:"password",className:"block font-bold",children:"Password"}),e.jsx("input",{type:"password",id:"password",required:!0,autoFocus:!0,value:t,onChange:i=>n({password:i.target.value})})]}),e.jsxs("div",{className:"my-2",children:[e.jsx("label",{htmlFor:"verify",className:"block font-bold",children:"Verify Password"}),e.jsx("input",{type:"password",id:"verify",required:!0,value:s,onChange:i=>n({verify:i.target.value})})]}),e.jsx("div",{className:"my-2",children:e.jsx("button",{disabled:!r,type:"submit",className:"block py-2 rounded bg-blue-400",children:"verify"})})]})})})),Rv=({user:t,className:s=null,children:n,...r})=>e.jsx("div",{className:s,children:e.jsxs("div",{className:"py-8 grid grid-cols-2 gap-8",children:[e.jsxs("div",{className:"font-bold text-4xl text-center col-span-2",children:["Welcome: ",t.email]}),n]})}),Fv={type:Rv,props:{amsAction:"profile",authLevel:0},wrappers:["ams-profile"]},Vv=G1(({verified:t,...s})=>e.jsx("div",{className:"h-full flex-1 flex items-center justify-center",children:e.jsx(zn,{children:t==="waiting"?"Verifying Email...":t==="failed"?"Email verification failed.":"Email verification succeeded."})})),Hv=W1(({password:t,verify:s,title:n,update:r,canSubmit:a,handleSubmit:l})=>e.jsx("div",{className:"h-full bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8 ",children:e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow-lg sm:rounded-md sm:px-10",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-medium text-gray-900",children:n}),e.jsx("p",{className:"text-lg font-thin text-gray-600",children:e.jsx("span",{href:"#",className:"font-thin text-blue-400 hover:text-blue-500",children:"Set Password"})})]}),e.jsxs("form",{className:"space-y-6",onSubmit:l,children:[e.jsxs("div",{className:"pt-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-thin text-gray-700",children:"Password"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"password",name:"password",type:"password",value:t,onChange:i=>r({password:i.target.value}),autoComplete:"email",placeholder:"Enter your password",autoFocus:!0,required:!0,className:"appearance-none block w-full px-3 py-2 border-b border-gray-300 shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-thin text-gray-700",children:"Password"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"verify",name:"verify",type:"password",value:s,onChange:i=>r({verify:i.target.value}),autoComplete:"Verify your email.",placeholder:"Verify your email.",required:!0,className:"appearance-none block w-full px-3 py-2 border-b border-gray-300 shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Set Password"})})]})]})})})),zv=J1(({password:t,verify:s,update:n,canSubmit:r,handleSubmit:a})=>e.jsx("div",{className:"h-full flex-1 flex items-center justify-center",children:e.jsx(zn,{Title:"Accept Invite",children:e.jsxs("form",{onSubmit:a,children:[e.jsxs("div",{className:"my-2",children:[e.jsx("label",{htmlFor:"password",className:"block font-bold",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:t,autoFocus:!0,onChange:l=>n({password:l})})]}),e.jsxs("div",{className:"my-2",children:[e.jsx("label",{htmlFor:"verify",className:"block font-bold",children:"Verify Password"}),e.jsx("input",{type:"password",id:"verify",value:s,onChange:l=>n({verify:l})})]}),e.jsx("div",{className:"my-2",children:e.jsx("button",{type:"submit",buttonTheme:"buttonLargePrimaryBlock",disabled:!r,children:"accept"})})]})})})),Uv=q1(({path:t,children:s,user:n,className:r="mt-16",...a})=>{const l={};return e.jsx("div",{className:r,children:e.jsx("div",{className:"py-20",children:e.jsx("div",{className:"inline-block",children:w.Children.toArray(s).reduce((i,c)=>{const d=C(c,["props","showInDirectory"],!0),u=C(c,["props","showIfLoggedIn"],!0),p=C(c,["props","amsAction"]);if(p){const m=C(c,["props","authLevel"],-1);n.authLevel>=m&&d&&(!n.authed||n.authed&&u)?i.push(e.jsx(je,{to:`${t}/${c.props.amsAction}`,children:e.jsx("div",{className:`py-1 px-2 rounded hover:${l.accent1}`,children:c.props.amsAction})},c.props.amsAction)):i.push(e.jsx("div",{className:`py-1 px-2 cursor-not-allowed line-through rounded hover:${l.accent1}`,children:c.props.amsAction},c.props.amsAction))}else p||i.push(c);return i},[])})})})}),Wv=Y1(({current:t,password:s,verify:n,update:r,canSubmit:a,handleSubmit:l})=>e.jsx(zn,{Title:"Update Password",children:e.jsx("form",{onSubmit:l,children:e.jsxs("div",{className:"grid grid-cols-1 gap-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"current",className:"block font-bold",children:"Current Password"}),e.jsx("input",{type:"password",id:"current",value:t,autoFocus:!0,onChange:i=>r({current:i.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block font-bold",children:"New Password"}),e.jsx("input",{type:"password",id:"password",value:s,onChange:i=>r({password:i.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"verify",className:"block font-bold",children:"Verify Password"}),e.jsx("input",{type:"password",id:"verify",value:n,onChange:i=>r({verify:i.target.value})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:!a,children:"update password"})})]})})})),Gv=()=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 font-bold",children:[e.jsx("div",{className:"col-span-3 border-b-2",children:"Pending Requests"}),e.jsx("div",{className:"col-span-2 border-b-2 text-center",children:"Age"}),e.jsx("div",{className:"col-span-5 border-b-2 text-center",children:"Accept Request"}),e.jsx("div",{className:"col-span-2 border-b-2 text-center",children:"Reject Request"})]}),Jv=({request:t,groups:s,signupAccept:n,signupReject:r,...a})=>{const l=((Date.now()-new Date(t.created_at).valueOf())/36e5).toFixed(1),[i,c]=w.useState(null),d=i&&t.state==="pending",u=w.useCallback(p=>{p.preventDefault(),n(t.user_email,i.name),c(null)},[n,t,i]);return e.jsxs("div",{className:"grid grid-cols-12 gap-3 my-1 flex items-center",children:[e.jsx("div",{className:"col-span-3",children:t.user_email}),e.jsxs("div",{className:"col-span-2 text-center",children:[l," hrs"]}),e.jsx("div",{className:"col-span-5",children:e.jsx("form",{onSubmit:u,children:e.jsxs("div",{className:"grid grid-cols-5 gap-1",children:[e.jsx("div",{className:"col-span-3",children:e.jsx("select",{value:i,onChange:p=>c(p.target.value),placeholder:"Select a group...",children:s.map(p=>e.jsx("option",{value:p.name,children:p.name}))})}),e.jsx("div",{className:"col-span-2",children:e.jsx("button",{type:"submit",block:!0,disabled:!d,children:"accept"})})]})})}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsx("button",{buttonTheme:"buttonDanger",showConfirm:!0,onClick:p=>r(t),children:"reject"})})]})},qv=({requests:t,...s})=>t.length?e.jsxs("div",{className:"py-1",children:[e.jsx(Gv,{}),t.map(n=>e.jsx(Jv,{request:n,...s},n.user_email))]}):null,Kv=()=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 font-bold",children:[e.jsx("div",{className:"col-span-3 border-b-2",children:"Awaiting Requests"}),e.jsx("div",{className:"col-span-2 border-b-2 text-center",children:"Age"}),e.jsx("div",{className:"col-span-2 border-b-2 text-center",children:"Reject Request"})]}),Yv=({request:t,signupReject:s,...n})=>{const r=((Date.now()-new Date(t.created_at).valueOf())/36e5).toFixed(1);return e.jsxs("div",{className:"grid grid-cols-12 gap-3 my-1 flex items-center",children:[e.jsx("div",{className:"col-span-3",children:t.user_email}),e.jsxs("div",{className:"col-span-2 text-center",children:[r," hrs"]}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsx(Button,{buttonTheme:"buttonDanger",showConfirm:!0,onClick:a=>s(t),children:"reject"})})]})},Zv=({requests:t,...s})=>t.length?e.jsxs("div",{className:"py-1",children:[e.jsx(Kv,{}),t.map(n=>e.jsx(Yv,{request:n,...s},n.user_email))]}):null,Xv=()=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 font-bold",children:[e.jsx("div",{className:"col-span-3 border-b-2",children:"Rejected Requests"}),e.jsx("div",{className:"col-span-5 border-b-2 text-center",children:"Accept Request"}),e.jsx("div",{className:"col-span-2 border-b-2 text-center",children:"Delete Request"})]}),Qv=({request:t,groups:s,signupAccept:n,deleteRequest:r,...a})=>{const[l,i]=w.useState(null),c=l&&t.state==="rejected",d=w.useCallback(u=>{u.preventDefault(),n(t.user_email,l.name),i(null)},[n,t,l]);return e.jsxs("div",{className:"grid grid-cols-12 gap-3 my-1 flex items-center",children:[e.jsx("div",{className:"col-span-3",children:t.user_email}),e.jsx("div",{className:"col-span-5",children:e.jsx("form",{onSubmit:d,children:e.jsxs("div",{className:"grid grid-cols-5 gap-1",children:[e.jsx("div",{className:"col-span-3",children:e.jsx("select",{value:l,onChange:u=>i(u.target.value),placeholder:"Select a group...",children:s.map(u=>e.jsx("option",{value:u.name,children:u.name}))})}),e.jsx("div",{className:"col-span-2",children:e.jsx(Button,{type:"submit",block:!0,disabled:!c,children:"accept"})})]})})}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsx("button",{showConfirm:!0,onClick:u=>r(t),children:"delete"})})]})},ej=({requests:t,...s})=>t.length?e.jsxs("div",{className:"py-1",children:[e.jsx(Xv,{}),t.map(n=>e.jsx(Qv,{request:n,...s},n.user_email))]}):null,tj=Z1(({pending:t,awaiting:s,rejected:n,...r})=>{const[a,l]=w.useState(!1),i=w.useCallback(d=>d.stopPropagation(),[]),c={};return e.jsxs("div",{className:`
        mb-5 py-2 px-4 border-2 rounded
        ${a?c.accent1:"cursor-pointer"}
      `,style:{borderColor:"currentColor"},onClick:d=>{i(d),l(!0)},children:[e.jsxs("div",{onClick:d=>{i(d),l(!a)},className:`
          border-b-2 cursor-pointer
          ${a?"border-current":"border-transparent"}
        `,children:[e.jsx("span",{className:`fa fa-${a?"minus":"plus"}`}),e.jsx("span",{className:"font-bold text-xl ml-2",children:"Requests"})]}),a?e.jsxs(e.Fragment,{children:[e.jsx(qv,{requests:t,...r}),e.jsx(Zv,{requests:s,...r}),e.jsx(ej,{requests:n,...r})]}):null]})}),hr=({children:t,className:s=""})=>e.jsx("div",{className:`mb-5 last:mb-0 py-2 px-4 border-2 rounded m-auto ${s}`,children:t}),sj=X1(({email:t,verify:s,group:n,update:r,canSubmit:a,handleSubmit:l,groups:i})=>e.jsxs(hr,{children:[e.jsxs("div",{className:"grid grid-cols-10 gap-1 font-bold border-b-2 mb-1",children:[e.jsx("div",{className:"col-span-3 text-xl",children:"Send Invite"}),e.jsx("div",{className:"col-span-3 flex items-end",children:"Verify Email"}),e.jsx("div",{className:"col-span-3 flex items-end",children:"Assign to Group"}),e.jsx("div",{className:"col-span-1 flex items-end"})]}),e.jsx("form",{onSubmit:l,children:e.jsxs("div",{className:"grid grid-cols-10 gap-1 mb-2",children:[e.jsx("div",{className:"col-span-3",children:e.jsx("input",{placeholder:"Enter user email...",type:"email",onChange:c=>r({email:c.target.value}),value:t})}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{placeholder:"Verify user email...",type:"email",onChange:c=>r({verify:c.target.value}),value:s})}),e.jsx("div",{className:"col-span-3"}),e.jsx("div",{className:"col-span-1",children:e.jsx(Button,{block:!0,type:"submit",disabled:!a,children:"send"})})]})})]})),nj=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{search:"",amount:5})}adjustAmount(a,l){const{amount:i}=this.state;(a<0&&i>5||a>0&&i<l)&&this.setState({amount:i+a})}render(){const a=Ln(this.props.users,this.state.search,{keys:["email"]}),l=Math.max(0,a.length-this.state.amount);return e.jsx(t,{...this.props,...this.state,setSearch:i=>this.setState({search:i}),adjustAmount:i=>this.adjustAmount(i,a.length),matches:this.state.search?a.slice(0,this.state.amount):[],remaining:l})}},ye(s,"defaultProps",{amsAction:"user-search",authLevel:5}),s},aj=()=>e.jsxs("div",{className:"grid grid-cols-15 py-1 gap-3 font-bold",children:[e.jsx("div",{className:"col-span-5 border-b-2",children:"User Email"}),e.jsx("div",{className:"col-span-4 text-center border-b-2",children:"Add to Group"}),e.jsx("div",{className:"col-span-4 text-center border-b-2",children:"Remove from Group"}),e.jsx("div",{className:"col-span-2 text-center border-b-2",children:"Delete User"})]}),rj=({user:t,groups:s,assignToGroup:n,removeFromGroup:r,deleteUser:a,...l})=>{const[i,c]=w.useState(""),[d,u]=w.useState("");s.sort((g,x)=>g.authLevel===x.authLevel?g.name<x.name?-1:g.name>x.name?1:0:g.authLevel-x.authLevel);const[p,m]=s.reduce(([g,x],y)=>(t.groups.includes(y.name)?g.push(y):x.push(y),[g,x]),[[],[]]),h=w.useCallback(g=>{n(t.email,i.name),c("")},[n,t,i]),f=w.useCallback(g=>{r(t.email,d.name),u("")},[r,t,d]);return e.jsxs("div",{className:"grid grid-cols-15 py-1 gap-3",children:[e.jsx("div",{className:"col-span-5 whitespace-nowrap overflow-hidden flex items-center",children:t.email}),e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-1",children:[e.jsx("div",{className:"col-span-8",children:e.jsx(Select,{multi:!1,placeholder:"Select a group...",options:m,accessor:g=>g.name,listAccessor:g=>`${g.name} (auth level ${g.authLevel})`,value:i,onChange:c})}),e.jsx("div",{className:"col-span-4",children:e.jsx("button",{block:!0,disabled:!i,onClick:h,children:"add"})})]})}),e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-1",children:[e.jsx("div",{className:"col-span-8",children:e.jsx("select",{placeholder:"Select a group...",value:d,onChange:g=>u(g.target.value),children:p.map(g=>e.jsx("option",{value:g.name,children:g.name}))})}),e.jsx("div",{className:"col-span-4",children:e.jsx("button",{block:!0,disabled:!d,onClick:f,children:"remove"})})]})}),e.jsx("div",{className:"col-span-2 flex justify-center",children:e.jsx("button",{buttonTheme:"buttonDanger",showConfirm:!0,onClick:g=>a(t.email),children:"delete"})})]})},oj=nj(({search:t,setSearch:s,adjustAmount:n,matches:r,remaining:a,...l})=>e.jsxs(hr,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-2",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("input",{placeholder:"Search for a user...",showClear:!0,value:t,onChange:i=>s(i.target.value)})}),e.jsx("div",{className:"col-span-1",children:t?e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{className:"mx-1",disabled:r.length<=5,onClick:i=>n(-5),children:"Show Less"}),e.jsx("button",{className:"mx-1",disabled:!a,onClick:i=>n(5),children:"Show More"})]}):null}),t?e.jsxs("div",{className:"col-span-2",children:[e.jsx(aj,{}),r.map(i=>e.jsx(rj,{...l,user:i},i.email))]}):null]}),t&&a?e.jsxs("div",{className:"py-1",children:["Plus ",a," others..."]}):null]})),lj=Q1(({groups:t,user:s,group:n,authLevel:r,update:a,canSubmit:l,handleSubmit:i})=>e.jsxs(hr,{className:"max-w-2xl pb-4",children:[e.jsx("div",{className:"border-b-2 mb-1",children:e.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[e.jsx("div",{className:"col-span-2 font-bold",children:"Assign to Project"}),e.jsx("div",{className:"col-span-1",children:"Authority Level"})]})}),e.jsx("form",{onSubmit:i,children:e.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("select",{value:n,onChange:c=>a({group:c.target.value}),placeholder:"Select a group...",children:t.map(c=>e.jsx("option",{value:c.name,children:c.name}))})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",min:"0",max:s.authLevel,required:!0,value:r,onChange:c=>a({authLevel:c.target.value})})}),e.jsx("div",{className:"col-span-1 flex justify-center",children:e.jsx("button",{type:"submit",block:!0,disabled:!l,children:"assign"})})]})})]})),ij=ev(({user:t,group:s,authLevel:n,update:r,canSubmit:a,handleSubmit:l})=>e.jsxs(hr,{className:"max-w-2xl pb-4",children:[e.jsx("div",{className:"border-b-2 mb-1",children:e.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[e.jsx("div",{className:"col-span-2 font-bold",children:"Create Group"}),e.jsx("div",{className:"col-span-1",children:"Authority Level"})]})}),e.jsx("form",{onSubmit:l,children:e.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(Input,{placeholder:"Enter group name...",required:!0,showClear:!0,value:s,onChange:i=>r({group:i})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",min:"0",max:t.authLevel,required:!0,value:n,onChange:i=>r({authLevel:i.target.value})})}),e.jsx("div",{className:"col-span-1 flex justify-center",children:e.jsx("button",{type:"submit",block:!0,disabled:!a,children:"create"})})]})})]})),cj=({value:t,onChange:s,...n})=>e.jsxs("div",{className:"grid grid-cols-9 font-bold gap-3",children:[e.jsxs("div",{className:"col-span-4 border-b-2",children:[e.jsx("div",{children:"User Email"}),e.jsx("div",{className:"mb-1",children:e.jsx("input",{small:!0,showClear:!0,placeholder:"Searh users...",value:t,onChange:r=>s(r.target.value)})})]}),e.jsx("div",{className:"col-span-3 border-b-2 flex justify-center items-end",children:"Remove from Group"}),e.jsx("div",{className:"col-span-2 border-b-2 flex justify-center items-end",children:"Delete User"})]}),dj=({group:t,User:s,removeFromGroup:n,deleteUser:r,...a})=>e.jsxs("div",{className:"grid grid-cols-9 my-1",children:[e.jsx("div",{className:"col-span-4",children:s.email}),e.jsx("div",{className:"col-span-3 flex justify-center",children:e.jsx("button",{showConfirm:!0,onClick:l=>n(s.email,t.name),children:"remove"})}),e.jsx("div",{className:"col-span-2 flex justify-center",children:e.jsx("button",{showConfirm:!0,onClick:l=>r(s.email),children:"delete"})})]}),uj=({group:t,User:s,assignToGroup:n,...r})=>e.jsxs("div",{className:"grid grid-cols-12 mb-1 flex items-center",children:[e.jsx("div",{className:"col-span-8",children:s.email}),e.jsx("div",{className:"col-span-4",children:e.jsx("button",{onClick:a=>n(s.email,t.name),children:"add to group"})})]}),mj=({group:t,users:s,...n})=>{const[r,a]=w.useState(5),[l,i]=w.useState(""),[c,d]=w.useState(""),[u,p]=s.reduce(([h,f],g)=>(g.groups.includes(t.name)?h.push(g):f.push(g),[h,f]),[[],[]]);u.sort((h,f)=>h.email<f.email?-1:h.email>f.email?1:0);const m=Ln(p,c,{keys:["email"]});return console.log("???",u),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-5 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"col-span-1 relative",children:[e.jsx("input",{value:c,onChange:h=>d(h.target.value),placeholder:"Search for another user...",showClear:!0}),c&&m.length?e.jsx("div",{className:"absolute left-0 bottom-0 right-0",children:m.length<=5?null:e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:h=>a(r-5),disabled:r===5,className:"mx-1",children:"Show Less"}),e.jsx("button",{onClick:h=>a(r+5),disabled:r>m.length,className:"mx-1",children:"Show More"})]})}):null]}),e.jsx("div",{className:"col-span-2",children:c?e.jsxs("div",{children:[m.length?null:e.jsx("div",{className:"pt-1",children:"No users found..."}),m.slice(0,r).map(h=>b.createElement(uj,{...n,key:h.email,group:t,User:h})),m.length<r?null:e.jsxs("div",{children:["Plus ",m.length-r," others..."]})]}):null})]}),e.jsx(cj,{onChange:i,value:l}),Ln(u,l,{keys:["email"]}).map(h=>b.createElement(dj,{...n,key:h.email,User:h,group:t},h.email))]})},pj=({onChange:t,value:s})=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-center font-bold mb-1",children:[e.jsxs("div",{className:"col-span-4 text-left border-b-2 text-xl",children:[e.jsx("div",{children:"Groups in Project"}),e.jsx("div",{className:"mb-1",children:e.jsx("input",{small:!0,showClear:!0,placeholder:"Search groups...",value:s,onChange:n=>t(n.target.value)})})]}),e.jsx("div",{className:"col-span-3 border-b-2 flex justify-center items-end",children:"Adjust Project Authority"}),e.jsx("div",{className:"col-span-3 border-b-2 flex justify-center items-end",children:"Remove from Project"}),e.jsx("div",{className:"col-span-2 border-b-2 flex justify-center items-end",children:"Delete Group"})]}),hj=(t,s)=>!isNaN(s)&&t!==s&&s>=0&&s<=10,fj=({group:t,project:s,adjustAuthLevel:n,deleteGroup:r,removeFromProject:a,...l})=>{const[i,c]=w.useState(!1),d=w.useCallback(()=>c(!i),[i]),u=t.projects.reduce((g,x)=>x.project_name===s?x:g,{}),[p,m]=w.useState(C(u,"auth_level",-1)),h=w.useCallback(g=>{g.preventDefault(),n(t.name,p)},[n,t.name,p]),f=useTheme();return e.jsxs("div",{className:`
        mb-1 py-1 px-2 rounded ${i?f.accent1:""}`,children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-4 flex items-center",children:[e.jsx("div",{className:`
              px-2 py-1 mr-1 cursor-pointer rounded flex justify-center
              hover:${f.accent2} ${f.transition}
            `,onClick:d,children:i?e.jsx("span",{className:"fa fa-minus"}):e.jsx("span",{className:"fa fa-plus"})}),e.jsx("div",{className:"flex-1",children:t.name})]}),e.jsx("div",{className:"col-span-3",children:e.jsx("form",{onSubmit:h,children:e.jsxs("div",{className:"grid grid-cols-12 gap-1 flex items-center",children:[e.jsx("div",{className:"col-span-6",children:e.jsx("input",{type:"number",min:"0",max:"10",required:!0,value:p,onChange:g=>m(g.target.value)})}),e.jsx("div",{className:"col-span-6",children:e.jsx("button",{type:"submit",disabled:!hj(+u.auth_level,+p),children:"adjust"})})]})})}),e.jsx("div",{className:"col-span-3 flex justify-center",children:e.jsx("button",{showConfirm:!0,onClick:g=>a(t.name),children:"remove"})}),e.jsx("div",{className:"col-span-2 flex justify-center",children:e.jsx("button",{showConfirm:!0,onClick:g=>r(t.name),children:"delete"})})]}),i?e.jsx("div",{className:"mx-10 mt-2",children:e.jsx(mj,{group:t,...l})}):null]})},gj=t=>{var s;return s=class extends w.Component{constructor(){super(...arguments);ye(this,"state",{groupSearch:""})}render(){const{groups:a,...l}=this.props,{groupSearch:i}=this.state;return e.jsx(t,{...l,...this.state,setGroupSearch:c=>this.setState({groupSearch:c}),groups:Ln(a,i,{keys:["name"]})})}},ye(s,"defaultProps",{amsAction:"groups-in-project",authLevel:5}),s},xj=gj(({groups:t,groupSearch:s,setGroupSearch:n,...r})=>e.jsxs(hr,{children:[e.jsx(pj,{value:s,onChange:n}),t.map(a=>e.jsx(fj,{...r,group:a},a.name))]})),bj=({children:t,...s})=>e.jsx(w.Fragment,{children:w.Children.toArray(t).map(n=>w.cloneElement(n,s))}),yj={type:bj,props:{amsAction:"user-preferences",authLevel:0},wrappers:["ams-user-preferences"]},vj=t=>{const{newPreferences:s,setNewPreferences:n,slackEmail:r,setSlackEmail:a,getSlackUserFromEmail:l,updateSlackPreferences:i,updateDisabled:c,preferences:d}=t;return e.jsx(zn,{Title:"Slack Preferences",children:e.jsxs("div",{className:"grid grid-cols-1 gap-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold",children:"Send Messages to Slack"}),e.jsx("div",{children:"todo fix"})]}),s.receiveSlack?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"slackEmail",className:"block font-bold",children:"Slack Email"}),e.jsx("input",{type:"email",id:"slackEmail",placeholder:"Enter your slack email...",onChange:u=>a(u.target.value),value:r})]}),e.jsx("button",{onClick:l,disabled:!r,children:"check slack email"})]}):null]}),d.slackUserId&&s.receiveSlack?e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold",children:"Slack User ID"}),e.jsx("input",{readOnly:!0,value:d.slackUserId})]}):null,e.jsx("button",{onClick:i,disabled:c,children:"update preferences"})]})})},jj={type:vj,wrappers:["show-loading","ams-slack-preferences"]},wj={duration:750,hideOnAction:!0},Nj=(t=wj)=>{const[s,n]=w.useState(!1),r=w.useCallback(l=>{l.stopPropagation(),l.preventDefault(),n(!0)},[]),a=w.useCallback(l=>{l.stopPropagation(),l.preventDefault(),n(!1)},[]);return[{show:s,closeModal:a,...t},r,a]},Cj=({show:t,closeModal:s,actions:n,duration:r,hideOnAction:a,children:l})=>{const i=w.createRef(),c=w.createRef(),[d,u]=w.useState(!0);w.useEffect(()=>{if(d&&t){const m=tr().duration(r);lt(i.current).style("background-color","rgba(0, 0, 0, 0.0)").transition(m).style("background-color","rgba(0, 0, 0, 0.75)"),lt(c.current).style("top","-50%").transition(m).style("left","50%").style("top","50%"),u(!t)}else if(!d&&!t){const m=tr().duration(r);lt(i.current).transition(m).style("background-color","rgba(0, 0, 0, 0.0)"),lt(c.current).transition(m).style("left","50%").style("top","-50%").end().then(()=>u(!t))}},[i,c,t,d,u,r]);const p={};return e.jsx("div",{ref:i,className:"inset-0 z-50 cursor-auto fixed",style:{display:d?"none":"block"},children:e.jsxs("div",{ref:c,className:"absolute inline-block",style:{transform:"translate(-50%, -50%)",left:"50%"},children:[e.jsx("button",{onClick:s,small:!0,className:`
            top-0 left-0 absolute ${p.menuBg}
          `,style:{transform:"translate(-50%, -50%)"},children:e.jsx("span",{className:"fa text-lg fa-times"})}),l]})})},_j=cv(()=>e.jsx("div",{children:"postmessage"})),Sj=({showModal:t,...s})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1 text-3xl font-bold",children:"Messages"}),e.jsx("div",{className:"text-base flex-0",children:e.jsx("button",{onClick:t,children:"compose"})})]}),$j=t=>{const{messages:s,toggleSelected:n,viewMessages:r,viewSelected:a,deleteMessages:l,deleteSelected:i,toggleAll:c,selected:d}=t,[u,p,m]=Nj(),h=w.useMemo(()=>e.jsx(Sj,{showModal:p}),[p]);return e.jsxs(e.Fragment,{children:[e.jsx(Cj,{...u,children:e.jsx("div",{className:"bg-gray-200 p-4 rounded",children:e.jsx(_j,{onPostMessage:m})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(zn,{className:"w-full",Title:h,children:e.jsxs("div",{className:"grid grid-cols-1 gap-y-1",children:[s.length?e.jsxs("div",{className:"flex items-center h-6 px-2",children:[e.jsx("div",{className:"w-4 mr-1 flex-0",children:e.jsx("input",{className:"cursor-pointer",type:"checkbox",checked:!!d.length,onChange:c,onClick:f=>f.stopPropagation()})}),d.length?e.jsxs("div",{className:"flex-1 flex items-center",children:[e.jsx("span",{className:"fa fa-trash mx-2 cursor-pointer hover:text-red-400",onClick:i}),e.jsx("span",{className:"fa fa-eye mx-2 cursor-pointer hover:text-blue-400",onClick:a})]}):null]}):null,s.sort((f,g)=>new Date(g.sent_at)-new Date(f.sent_at)).map(f=>e.jsx(kj,{...f,deleteMessages:l,viewMessages:r,toggleSelected:n,selected:d.includes(f.id)},f.id))]})})})]})},Ej={type:$j,wrappers:["ams-messages"]},kj=t=>{const{id:s,heading:n,message:r,sent_by:a,sent_at:l,viewed:i,viewMessages:c,toggleSelected:d,selected:u}=t,[p,m]=w.useState(!1),h=w.useCallback(g=>{m(!p),!p&&!i&&c([s])},[s,c,i,p]),f=w.useCallback(g=>{g.stopPropagation(),d(s)},[d,s]);return e.jsxs("div",{onClick:h,className:`
        cursor-pointer px-2 rounded
        ${i?"bg-gray-300":"bg-gray-100"}
      `,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 mr-1 flex-0",children:e.jsx("input",{className:"cursor-pointer",type:"checkbox",checked:u,onChange:f,onClick:g=>g.stopPropagation()})}),e.jsx("div",{className:"font-bold text-lg flex-0 w-72 overflow-hidden mr-4",children:a}),e.jsx("div",{className:"font-bold text-lg flex-0",children:n}),e.jsx("div",{className:"flex-1 text-right",children:new Date(l).toLocaleString()})]}),p?e.jsx("textarea",{children:r}):null]})},Lj=({newPreferences:t,setNewPreferences:s,updateDisabled:n,updateEmailPreferences:r,...a})=>e.jsx(zn,{Title:"Email Preferences",children:e.jsxs("div",{className:"grid grid-cols-1 gap-y-3",children:[e.jsx("div",{children:e.jsx("label",{className:"block font-bold",children:"Send Messages to Email"})}),e.jsx("button",{onClick:r,disabled:n,children:"update preferences"})]})}),Ij={type:Lj,wrappers:["ams-email-preferences"]};function Tj(){return e.jsx("div",{children:"Default"})}function Mj({config:t}){return e.jsxs("div",{children:[" Invalid DMS Config :",e.jsx("pre",{style:{background:"#dedede"},children:JSON.stringify(t,null,3)})]})}function Bj({path:t}){return e.jsxs("div",{children:[" These aren't the droids you are looking for",e.jsx("div",{className:"text-5xl",children:"404"}),e.jsxs("div",{children:["/",t]})]})}const wc={"ams-login":Lv,"ams-logout":Iv,"ams-project-management":Mv,"ams-signup":Ov,"ams-reset-password":Pv,"ams-verify-request":Dv,"ams-profile":Fv,"ams-verify-email":Vv,"ams-set-password":Hv,"ams-accept-invite":zv,"ams-directory":Uv,"ams-update-password":Wv,"ams-requests":tj,"ams-send-invite":sj,"ams-user-search":oj,"ams-assign-to-project":lj,"ams-create-group":ij,"ams-groups-in-project":xj,"ams-user-preferences":yj,"ams-slack-preferences":jj,"ams-messages":Ej,"ams-email-preferences":Ij,"ams-default":Tj,InvalidConfig:Mj,NoRouteMatch:Bj},Aj=wc["ams-default"];let Oj=0;const Pj=(t,s)=>t.filter(n=>n.path===s);function Hp(t,s,n){return Pj(t,s).map(a=>{const l=typeof a.type=="function"?a.type:wc[a.type]||Aj;let i=[];a.children&&(i=Hp(a.children,s,format,depth+1));let c=R1(D1(l));return e.jsx(c,{...a,...a.props,children:i,location:{},urlArg:n},Oj++)})}function Dj(t){return t.children&&Array.isArray(t.children)}const{InvalidConfig:Rj,NoRouteMatch:Fj}=wc,Vj=({config:t,path:s="",user:n={},theme:r=Fp,urlArg:a,...l})=>{if(!Dj(t))return e.jsx(Rj,{config:t});const i=Hp(t.children,s,a);return i?e.jsx(Vp.Provider,{value:r,children:i}):e.jsx(Fj,{path:s})};function Hj(t,s="/"){function n(){const r=Ye();return e.jsx(Vj,{path:r.action,urlArg:r.urlArg,config:t})}return[{path:`${s}/:action`,element:r=>e.jsx(n,{...r})},{path:`${s}/:action/:urlArg`,element:r=>e.jsx(n,{...r})}]}const zj=cp({reducer:{...Bp,messages:ov}}),Uj=Math.max,Wj=Math.min;function Gj(t,s,n){let r,a,l,i,c,d,u=0,p=!1,m=!1,h=!0;if(typeof t!="function")throw new TypeError(FUNC_ERROR_TEXT);s=Number(s)||0,typeof n=="object"&&(p=!!n.leading,m="maxWait"in n,l=m?Uj(Number(n.maxWait)||0,s):l,h="trailing"in n?!!n.trailing:h);function f(S){let k=r,$=a;return r=a=void 0,u=S,i=t.apply($,k),i}function g(S){return u=S,c=setTimeout(j,s),p?f(S):i}function x(S){let k=S-d,$=S-u,I=s-k;return m?Wj(I,l-$):I}function y(S){let k=S-d,$=S-u;return d===void 0||k>=s||k<0||m&&$>=l}function j(){const S=Date.now();if(y(S))return N(S);c=setTimeout(j,x(S))}function N(S){return c=void 0,h&&r?f(S):(r=a=void 0,i)}function _(){c!==void 0&&clearTimeout(c),u=0,r=d=a=c=void 0}function E(){return c===void 0?i:N(Date.now())}function L(){let S=Date.now(),k=y(S);if(r=arguments,a=this,d=S,k){if(c===void 0)return g(d);if(m)return c=setTimeout(j,s),f(d)}return c===void 0&&(c=setTimeout(j,s)),i}return L.cancel=_,L.flush=E,L}function Jj(){return new qo}function qj(){return new qo}var Bd=Object.prototype.hasOwnProperty,Ad=function(){};function mi(){}mi.create=function(t){var s=new mi;return s.subscribe=function(n,r,a){var l,i;return typeof n=="function"?l={onNext:n,onError:r||Ad,onCompleted:a||Ad}:l=n,i=t(l),typeof i=="function"?{dispose:i}:i},s};function Nl(t,s,n){return mi.create(function(a){var l={method:t||"GET",crossDomain:!1,async:!0,headers:{},responseType:"json"},i,c,d,u,p;for(p in s)Bd.call(s,p)&&(l[p]=s[p]);!l.crossDomain&&!l.headers["X-Requested-With"]&&(l.headers["X-Requested-With"]="XMLHttpRequest"),n.onBeforeRequest!=null&&n.onBeforeRequest(l);try{i=l.crossDomain?qj():Jj()}catch(m){a.onError(m)}try{l.user?i.open(l.method,l.url,l.async,l.user,l.password):i.open(l.method,l.url,l.async),i.timeout=l.timeout,i.withCredentials=l.withCredentials!==!1,d=l.headers;for(u in d)Bd.call(d,u)&&i.setRequestHeader(u,d[u]);if(l.responseType)try{i.responseType=l.responseType}catch(m){if(l.responseType!=="json")throw m}i.onreadystatechange=function(h){i.readyState===4&&(c||(c=!0,Kj(a,i,h)))},i.ontimeout=function(h){c||(c=!0,Yj(a,i,"timeout error",h))},i.send(l.data)}catch(m){a.onError(m)}return function(){!c&&i.readyState!==4&&(c=!0,i.abort())}})}function Xn(t,s,n){n||(n=new Error(s)),t.onError(n)}function Kj(t,s,n){var r,a;if(s&&t){a=s.responseType,r="response"in s?s.response:s.responseText;var l=s.status===1223?204:s.status;if(l>=200&&l<=399){try{a!=="json"&&(r=JSON.parse(r||"")),typeof r=="string"&&(r=JSON.parse(r||""))}catch(i){Xn(t,"invalid json",i)}t.onNext(r),t.onCompleted();return}else return l===401||l===403||l===407||l===410||l===408||l===504?Xn(t,r):Xn(t,r||"Response code "+l)}}function Yj(t,s,n,r){Xn(t,n||s.statusText||"request error",r)}function Zj(t,s,n){var r=[],a,l={url:t},i=t.indexOf("?")!==-1,c=i?"&":"?";return typeof n=="string"?r.push(n):(a=Object.keys(n),a.forEach(function(d){var u=typeof n[d]=="object"?JSON.stringify(n[d]):n[d];r.push(d+"="+encodeURIComponent(u))})),s==="GET"?l.url+=c+r.join("&"):l.data=r.join("&"),l}function Qn(t,s){var n;for(n in s)t[n]=s[n];return t}function Tn(t,s){if(this._jsongUrl=t,typeof s=="number"){var n={timeout:s};s=n}this._config=Qn({timeout:15e3,headers:{}},s||{})}Tn.prototype={constructor:Tn,buildQueryObject:Zj,get:function(s){var n="GET",r=this.buildQueryObject(this._jsongUrl,n,{paths:s,method:"get"}),a=Qn(r,this._config),l=this;return Nl(n,a,l)},set:function(s){var n="POST",r,a;!this._config.headers||!this._config.headers["Content-Type"]||!this._config.headers["Content-Type"].match(/application\/json/)?(a=this.buildQueryObject(this._jsongUrl,n,{jsonGraph:s,method:"set"}),r=Qn(a,this._config),r.headers["Content-Type"]="application/x-www-form-urlencoded"):r=Qn({url:this._jsongUrl,data:JSON.stringify({jsonGraph:JSON.stringify(s),method:"set"})},this._config);var l=this;return Nl(n,r,l)},call:function(s,n,r,a){n=n||[],r=r||[],a=a||[];var l="POST",i,c=[],d;!this._config.headers||!this._config.headers["Content-Type"]||!this._config.headers["Content-Type"].match(/application\/json/)?(c.push("method=call"),c.push("callPath="+encodeURIComponent(JSON.stringify(s))),c.push("arguments="+encodeURIComponent(JSON.stringify(n))),c.push("pathSuffixes="+encodeURIComponent(JSON.stringify(r))),c.push("paths="+encodeURIComponent(JSON.stringify(a))),d=this.buildQueryObject(this._jsongUrl,l,c.join("&")),i=Qn(d,this._config),i.headers["Content-Type"]="application/x-www-form-urlencoded"):i=Qn({url:this._jsongUrl,data:JSON.stringify({method:"call",callPath:JSON.stringify(s),arguments:JSON.stringify(n),pathSuffixes:JSON.stringify(r),paths:JSON.stringify(a)})},this._config);var u=this;return Nl(l,i,u)}};Tn.XMLHttpSource=Tn;Tn.default=Tn;Promise.map=function(t,s,n={}){let r=n.concurrency||1/0,a=0;const l=[],i=[],c=t[Symbol.iterator]();for(;r-- >0;){const u=d();if(u)i.push(u);else break}return Promise.all(i).then(()=>l);function d(){const u=c.next();if(u.done)return null;const p=a++,m=s(u.value,p);return Promise.resolve(m).then(h=>(l[p]=h,d()))}};let Xj=class extends Tn{onBeforeRequest(s){}};function Qj(){return{}}const ew=()=>{},tw=(t,s,n={})=>{const{placeholder:r="replace_me",chunkSize:a=100}=n,l=[];for(let i=0;i<t.length;i+=a)l.push(s.map(c=>c===r?t.slice(i,i+a):c));return l.length?l:[s]},sw=(t,s={})=>{const{falcor:n,onProgress:r=ew,concurrency:a=5,...l}=s,i=mc(r,50);let c=0,d=0,u=t.reduce((p,[m,h])=>{const f=tw(m,h,l);return d+=f.length,p.push(...f),p},[]);return Promise.map(u,p=>n.get(p).then(()=>{i(++c,d)}),{concurrency:a})},zp=t=>t.reduce((s,n)=>(Array.isArray(n)?s[0].push(n):s[1]=n,s),[[],{}]),nw=(...t)=>{const[s,n]=zp(t),{index:r=null,placeholder:a="replace_me",...l}=n,i=s.reduce((c,d)=>{let u=[],p=!1;const m=d.map((h,f)=>Array.isArray(h)&&h.length&&!p&&(r===null||r===f)?(p=!0,u=h,a):h);return c.push([u,m]),c},[]);return sw(i,{...l,placeholder:a})};let aw=class extends dp{constructor(...s){super(...s),this.listeners=[],this.onChange=this.onChange.bind(this),this.listen=this.listen.bind(this),this.unlisten=this.unlisten.bind(this)}onChange(){this.listeners.forEach(s=>s())}listen(s){this.listeners.includes(s)||this.listeners.push(s)}unlisten(s){this.listeners=this.listeners.filter(n=>n!==s)}},rw=class extends up.Model{constructor(...s){super(...s),this.onChange=this.onChange.bind(this),this.remove=this.remove.bind(this),this.chunk=this.chunk.bind(this)}onChange(s,n){this._root.listen(s,n)}remove(s){this._root.unlisten(s)}get(...s){return super.get(...s).then(n=>n)}chunk(...s){const[n,r]=zp(s);return nw(...n,{falcor:this,...r})}};const Up=t=>new rw({_root:new aw,source:new Xj(t+"/graph",{crossDomain:!0,withCredentials:!1,timeout:12e4}),errorSelector:(s,n)=>(console.log("errorSelector",s,n),n),cache:Qj()});Up("https://graph.availabs.org");const Nc=w.createContext(),et=()=>w.useContext(Nc);Nc.Consumer;const ow=({falcor:t,children:s})=>{const[n,r]=w.useState({}),a=w.useMemo(()=>Gj(()=>{const i=t.getCache();r(i)},250),[t]);w.useEffect(()=>(t.onChange(a),()=>{t.remove(a)}),[t,a]);const l=w.useMemo(()=>({falcor:t,falcorCache:n}),[t,n]);return e.jsx(Nc.Provider,{value:l,children:s})},Wp=(t,s)=>{const[n,...r]=t.split(new RegExp("(?<!^)(?=[A-Z])"));return!s.$compositions||!s.$compositions[n]?s[n]||"":s.$compositions[n].reduce((a,l)=>{let i=l.$default||"";for(const c of r)c in l&&(i=l[c]);return a.push(i),a},[]).filter(Boolean).join(" ")},lw=t=>{const s=JSON.parse(JSON.stringify(t));for(const n in s){if(n==="$compositions")continue;const r=s[n].split(/\s+/),a=/^[@](.+)$/;s[n]=r.map(l=>{const i=a.exec(l);if(i){const[,c]=i;return s[c]}return l}).join(" ")}if(s.$compositions){const{$defaults:n=[],...r}=s.$compositions;for(const a in r)s.$compositions[a].forEach(l=>{for(let i in l){const c=/^[@](.+)$/;l[i]=l[i].split(/\s+/).map(p=>{const m=c.exec(p);if(m){const[,h]=m;return s[h]}return p}).join(" ");const d=/^\$(.+)$/,u=d.exec(l[i]);if(u){const[,p]=u;p in s&&(l[i]=s[p],n.push(p))}}});n.forEach(a=>{s[a]=Wp(a,s)})}return s},Gp={get:(t,s,n)=>(s in t||(t[s]=Wp(s,t)),t[s])},Xo=t=>new Proxy(t,Gp),iw=t=>new Proxy(lw(t),Gp),cw=[{$default:"rounded inline-flex items-center justify-center @transition disabled:cursor-not-allowed disabled:bg-transparent disabled:opacity-50 focus:outline-none border",Text:"inline-flex items-center justify-center @transition disabled:cursor-not-allowed disabled:opacity-50 focus:outline-none border"},{$default:"text-gray-400 disabled:text-gray-300",Primary:"text-blue-400 disabled:text-blue-300",Success:"text-green-400 disabled:text-green-300",Danger:"text-red-400 disabled:text-red-300",Info:"text-teal-400 disabled:text-teal-300"},{$default:"border-gray-400",Primary:"border-blue-400",Success:"border-green-400",Danger:"border-red-400",Info:"border-teal-400",Text:"border-none"},{$default:"hover:bg-gray-400 hover:text-white",Primary:"hover:bg-blue-400 hover:text-white",Success:"hover:bg-green-400 hover:text-white",Danger:"hover:bg-red-400 hover:text-white",Info:"hover:bg-teal-400 hover:text-white",Text:""},{$default:"px-4 py-1 @textBase",Large:"px-6 py-2 @textLarge",Small:"px-2 py-0 @textSmall"},{Block:"w-full"}],dw=[{$default:"w-full block rounded cursor-pointer disabled:cursor-not-allowed @transition @text @placeholder @inputBg @inputBorder"},{$default:"@paddingBase @textBase",Large:"@paddingLarge @textLarge",Small:"@paddingSmall @textSmall"}],uw=[{$default:"border-transparent font-medium focus:outline-none @transition"},{Top:"h-16 flex flex-1 items-center px-4 text-base leading-5",Side:"h-12 mb-1 flex pl-3 pr-4 py-2 border-l-4 text-base"},{$default:"@menuBg @menuBgHover @menuText @menuTextHover",Active:"@menuBgActive @menuBgActiveHover @menuTextActive @menuTextActiveHover"}],mw=[{$default:"@transition inline-flex px-2 hover:font-bold disabled:font-normal disabled:cursor-not-allowed disabled:opacity-50 focus:outline-none"},{$default:"$textbutton",Info:"text-teal-400 hover:text-teal-500 disabled:text-teal-400"},{$default:"text-base",Large:"text-lg",Small:"text-sm"},{$default:"font-normal cursor-pointer",Active:"font-bold cursor-default"}],pw=[{$default:"@transition rounded"},{$default:"p-2 bg-opacity-50",Item:"py-1 px-3 bg-gray-300 mb-2"},{$default:"bg-opacity-50",Dragging:"bg-opacity-75"},{$default:"bg-gray-400",Success:"bg-green-400"}],hw={$defaults:["input","navitemTop","navitemTopActive","navitemSide","navitemSideActive"],button:cw,input:dw,navitem:uw,textbutton:mw,list:pw},fw={bg:"custom-bg",ySpace:"py-4",contentPadding:"py-4",menuBg:"custom-bg",contentWidth:"",text:"text-blue-800",sidebarW:"64",sidebarBorder:"",menuIcon:"mr-3 h-5 w-5",navitemTop:"mr-4 inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium leading-5 text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out",navitemTopActive:"mr-4 inline-flex items-center px-1 pt-1 border-b-2 border-indigo-500 text-sm font-medium leading-5 text-gray-900 focus:outline-none focus:border-indigo-700 transition duration-150 ease-in-out",navitemSide:"mb-1 group flex pl-3 pr-4 py-2 border-l-4 border-transparent text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300 transition duration-150 ease-in-out",navitemSideActive:"mb-1 group flex pl-3 pr-4 py-2 border-l-4 border-indigo-500 text-sm font-medium text-indigo-700 bg-indigo-50 focus:outline-none focus:text-indigo-800 focus:bg-indigo-100 focus:border-indigo-700 transition duration-150 ease-in-out",headerBg:"custom-bg",headerShadow:"",contentBg:"",accent1:"bg-gray-200",accent2:"bg-gray-300",accent3:"bg-gray-400",accent4:"bg-gray-500",lighter:"bg-gray-50",button:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm leading-5 font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 active:text-gray-800 active:bg-gray-50 transition duration-150 ease-in-out",buttonPrimary:"inline-flex items-center px-4 py-2 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:shadow-outline-indigo focus:border-indigo-700 active:bg-indigo-700 transition duration-150 ease-in-out",textbutton:"text-sm text-blue-500 hover:text-blue-300 px-2",input:"block",tableRow:"bg-white border-b border-blue-100 hover:bg-blue-50",tableRowStriped:"bg-white even:bg-gray-50",tableCell:"px-6 py-4 whitespace-no-wrap text-sm leading-5 text-gray-600",tableCellCondensed:"px-3 py-2 whitespace-no-wrap text-sm leading-5 text-gray-600",tableHeader:"px-6 pt-2 pb-1	border-b border-gray-400 bg-gray-200 text-left font-medium text-gray-700 uppercase first:rounded-tl-md last:rounded-tr-md"};Xo(fw);const gw={bg:"bg-gray-300",menuBg:"bg-gray-800",sidebarW:"56",sidebarBorder:"",shadow:"",ySpace:"py-5",contentPadding:"py-5",text:"text-gray-300",contentWidth:"max-w-7xl mx-auto",menuIcon:"mr-3 h-4 w-4",navitemTop:"ml-3 my-3 px-3 py-1 inline-flex items-center rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700",navitemTopActive:"ml-3 my-3 px-3 py-1 inline-flex items-center rounded-md text-sm font-medium text-white bg-gray-900 focus:outline-none focus:text-white focus:bg-gray-700",navitemSide:"mt-1 group flex items-center px-2 py-2 text-sm leading-5 font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 transition ease-in-out duration-150",navitemSideActive:"group flex items-center px-2 py-2 text-sm leading-5 font-medium text-white rounded-md bg-gray-900 focus:outline-none focus:bg-gray-700 transition ease-in-out duration-150",headerBg:"bg-gray-800",headerShadow:"shadow",contentBg:"bg-gray-100",accent1:"bg-gray-600",accent2:"bg-gray-500",accent3:"bg-gray-400",lighter:"bg-gray-700",button:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm leading-5 font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 active:text-gray-800 active:bg-gray-50 transition duration-150 ease-in-out",buttonPrimary:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm leading-5 font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 active:text-gray-800 active:bg-gray-50 transition duration-150 ease-in-out",textbutton:"text-sm text-blue-500 hover:text-blue-300 px-2",tableRow:"bg-white border-b border-gray-200",tableRowStriped:"bg-white even:bg-gray-50"};Xo(gw);const xw={bg:"bg-gray-200",menuBg:"bg-indigo-800",sidebarW:"56",sidebarBorder:"",shadow:"shadow",ySpace:"py-5",contentPadding:"py-5",text:"text-gray-300",contentWidth:"max-w-7xl mx-auto",menuIcon:"mr-3 h-4 w-4",navitemTop:"ml-3 my-3 px-3 py-1 inline-flex items-center rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700",navitemTopActive:"ml-3 my-3 px-3 py-1 inline-flex items-center rounded-md text-sm font-medium text-white bg-gray-900 focus:outline-none focus:text-white focus:bg-gray-700",navitemSide:"mt-1 group flex items-center px-2 py-2 text-sm leading-5 font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 transition ease-in-out duration-150",navitemSideActive:"group flex items-center px-2 py-2 text-sm leading-5 font-medium text-white rounded-md bg-gray-900 focus:outline-none focus:bg-gray-700 transition ease-in-out duration-150",headerBg:"bg-gray-800",headerShadow:"shadow",contentBg:"bg-gray-100",accent1:"bg-gray-200",accent2:"bg-gray-300",accent3:"bg-gray-400",light:"bg-gray-50",button:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm leading-5 font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 active:text-gray-800 active:bg-gray-50 transition duration-150 ease-in-out",buttonPrimary:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm leading-5 font-medium rounded-md text-gray-700 bg-white hover:text-gray-500 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 active:text-gray-800 active:bg-gray-50 transition duration-150 ease-in-out",tableRow:"bg-white border-b border-gray-200",tableRowStriped:"bg-white even:bg-gray-50"};Xo(xw);const bw={shadow:"shadow",ySpace:"py-4",contentPadding:"py-4",sidebarBorder:"",text:"text-gray-800",textContrast:"text-white",border:"border-gray-400",textInfo:"text-teal-400",bgInfo:"bg-teal-400",borderInfo:"border-teal-400",textSuccess:"text-green-400",bgSuccess:"bg-green-400",borderSuccess:"border-green-400",textPrimary:"text-blue-400",bgPrimary:"bg-blue-400",borderPrimary:"border-blue-400",textDanger:"text-red-400",bgDanger:"bg-red-400",borderDanger:"border-red-400",textWarning:"text-yellow-400",bgWarning:"bg-yellow-400",borderWarning:"border-yellow-400",textLight:"text-gray-400",placeholder:"placeholder-gray-400",borderLight:"border-gray-400",bgLight:"bg-gray-400",menuIcon:"mr-3 h-6 w-6",topMenuBorder:"border-b border-gray-200",headerShadow:"",navitemTop:"mr-4 inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium leading-5 text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out",navitemTopActive:"mr-4 inline-flex items-center px-1 pt-1 border-b-2 border-indigo-500 text-sm font-medium leading-5 text-gray-900 bg-indigo-100 focus:outline-none hover:bg-indigo-200 focus:border-indigo-700 transition duration-150 ease-in-out",navitemSide:"mb-1 group flex pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-300 hover:border-gray-300 focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300 transition duration-150 ease-in-out",navitemSideActive:"mb-1 group flex pl-3 pr-4 py-2 border-l-4 border-indigo-500 text-base font-medium text-indigo-600 bg-indigo-100 focus:outline-none hover:text-indigo-800 focus:text-indigo-800 hover:bg-indigo-200 focus:bg-indigo-200 focus:border-indigo-700 transition duration-150 ease-in-out",bg:"bg-gray-100",mobileButton:"md:hidden bg-white inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-300",menuBg:"bg-gray-200",menuBgHover:"hover:bg-gray-300",menuBgActive:"bg-teal-200",menuBgActiveHover:"hover:bg-teal-300",menuText:"text-gray-500",menuTextHover:"hover:text-gray-700",menuTextActive:"text-teal-500",menuTextActiveHover:"hover:text-teal-700",topnavWrapper:"w-full bg-gray-100",topnavContent:"flex w-full ",topnavMenu:"hidden md:flex flex-1 h-full overflow-x-auto overflow-y-hidden scrollbar-sm",sidenavWrapper:"bg-gray-100 w-56 border-r border-gray-200 h-screen pt-16 z-50",headerBg:"bg-gray-200",headerBgHover:"hover:bg-gray-400",inputBg:"bg-white disabled:bg-gray-200 cursor-pointer focus:outline-none",inputBorder:"rounded border border-transparent hover:border-gray-300 focus:border-gray-600 disabled:border-gray-200",inputBgDisabled:"bg-gray-200 cursor-not-allowed focus:outline-none",inputBorderDisabled:"rounded border border-gray-200 hover:border-gray-200",inputBgFocus:"bg-white cursor-pointer focus:outline-none",inputBorderFocus:"rounded border border-transparent hover:border-gray-600 focus:border-gray-600 border-gray-600",textBase:"text-base",textSmall:"text-sm",textLarge:"text-lg",paddingBase:"py-1 px-2",paddingSmall:"py-0 px-1",paddingLarge:"py-2 px-4",contentBg:"bg-white",contentWidth:"max-w-7xl mx-auto",accent1:"bg-gray-200",accent2:"bg-gray-300",accent3:"bg-gray-400",accent4:"bg-gray-500",highlight1:"bg-teal-200",highlight2:"bg-teal-300",highlight3:"bg-teal-400",highlight4:"bg-teal-500",sidebarW:"56",transition:"transition ease-in-out duration-150",button:`
		inline-flex items-center
		px-4 py-2 border border-gray-300
		text-sm leading-5 font-medium
		rounded-md text-gray-700 bg-white
		hover:text-gray-500
		focus:outline-none focus:shadow-outline-blue focus:border-blue-300
		active:text-gray-800 active:bg-gray-50 transition duration-150 ease-in-out
		disabled:cursor-not-allowed`,buttonPrimary:"inline-flex items-center px-4 py-2 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:shadow-outline-indigo focus:border-indigo-700 active:bg-indigo-700 transition duration-150 ease-in-out disabled:cursor-not-allowed",tableRow:"bg-gray-100 hover:bg-gray-200 transition ease-in-out duration-150",tableRowStriped:"bg-gray-100 even:bg-gray-200 hover:bg-gray-300 transition ease-in-out duration-150",tableCell:"px-4 py-1 whitespace-no-wrap",tableHeader:"px-4 py-2 pb-1 border-b-2 border-gray-300 bg-gray-200 text-left font-medium text-gray-700 uppercase first:rounded-tl-md last:rounded-tr-md"},yw=Xo(bw),vw={text:"text-gray-800",textContrast:"text-white",border:"border-gray-400",ySpace:"",textInfo:"text-teal-400",bgInfo:"bg-teal-400",borderInfo:"border-teal-400",textSuccess:"text-green-400",bgSuccess:"bg-green-400",borderSuccess:"border-green-400",textPrimary:"text-blue-400",bgPrimary:"bg-blue-400",borderPrimary:"border-blue-400",textDanger:"text-red-400",bgDanger:"bg-red-400",borderDanger:"border-red-400",textWarning:"text-yellow-400",bgWarning:"bg-yellow-400",borderWarning:"border-yellow-400",textLight:"text-gray-400",placeholder:"placeholder-gray-400",menuIcon:"mr-3 h-6 w-6",topMenuBorder:"border-b border-gray-200",headerShadow:"",bg:"bg-gray-100",menuBg:"bg-gray-200",menuBgHover:"hover:bg-gray-300",menuBgActive:"bg-teal-200",menuBgActiveHover:"hover:bg-teal-300",menuText:"text-gray-500",menuTextHover:"hover:text-gray-700",menuTextActive:"text-teal-500",menuTextActiveHover:"hover:text-teal-700",menuOpenIcon:"fas fa-bars",menuCloseIcon:"fas fa-times",topnavWrapper:"w-full bg-gray-200 h-16",topnavContent:"flex w-full max-w-7xl mx-auto h-full",topnavMenu:"hidden md:flex flex-1 h-full overflow-x-auto overflow-y-hidden scrollbar-sm",sidenavWrapper:"bg-gray-200 w-56 border-r border-gray-200 h-screen pt-16 z-50",topmenuRightNavContainer:"h-full",mobileButton:"md:hidden bg-white inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-300",sidebarBg:"bg-gray-200",sidebarBorder:"",sidebarW:"56",headerBg:"bg-gray-200",headerBgHover:"hover:bg-gray-400",inputBg:"bg-white disabled:bg-gray-200 cursor-pointer focus:outline-none",inputBorder:"rounded border border-transparent hover:border-gray-300 focus:border-gray-600 disabled:border-gray-200",inputBgDisabled:"bg-gray-200 cursor-not-allowed focus:outline-none",inputBorderDisabled:"rounded border border-gray-200 hover:border-gray-200",inputBgFocus:"bg-white cursor-pointer focus:outline-none",inputBorderFocus:"rounded border border-transparent hover:border-gray-600 focus:border-gray-600 border-gray-600",booleanInputSlider:"bg-gray-300",textBase:"text-base",textSmall:"text-sm",textLarge:"text-lg",paddingBase:"py-1 px-2",paddingSmall:"py-0 px-1",paddingLarge:"py-2 px-4",accent1:"bg-gray-200",accent2:"bg-gray-300",accent3:"bg-gray-400",accent4:"bg-gray-500",highlight1:"bg-teal-200",highlight2:"bg-teal-300",highlight3:"bg-teal-400",highlight4:"bg-teal-500",contentBg:"bg-white",contentWidth:"w-full max-w-7xl mx-auto",contentPadding:"py-4",transition:"transition ease-in-out duration-150",tableInfoBar:"bg-white",tableRow:"bg-white hover:bg-gray-200 @transition",tableRowStriped:"bg-white even:bg-gray-100 hover:bg-gray-200 @transition",tableCell:"px-4 py-1 whitespace-no-wrap",tableHeader:"px-4 py-2 pb-1 border-b-2 border-gray-300 bg-gray-200 text-left font-medium text-gray-700 uppercase first:rounded-tl-md last:rounded-tr-md",$compositions:hw};iw(vw);const Jp=w.createContext(yw),st=()=>b.useContext(Jp),fr=t=>ja((n,r)=>({user:n.user}),null)(t);fr(({title:t,LeftComponent:s=null,children:n,RightComponent:r=null,shadowed:a=!1,user:l,userMenu:i=!1,className:c="",customTheme:d={},toggle:u=()=>{},open:p})=>{const m={...st(),...d},{TopUserMenu:h}=el(),f=t||s,g=n||r,x=m.topNavHeight;return e.jsxs("div",{className:`w-full relative flex items-center justify-end ${m.headerBg} ${c} h-${x}`,style:a?{boxShadow:"0px 6px 3px -3px rgba(0, 0, 0, 0.25)"}:null,children:[e.jsx("div",{className:`inset-0 z-0 text-3xl font-bold flex-1 items-center h-${x} flex-grow`,children:typeof f=="function"?w.createElement(f):f}),e.jsxs("div",{className:"flex flex-0 items-center relative z-10 pr-8 w-48 flex-shrink",children:[e.jsx("div",{className:"hidden xl:block",children:g}),!l||!i?null:e.jsx("div",{className:"ml-8",children:e.jsx(h,{})}),e.jsx("button",{className:`block xl:hidden fas ${p?"fa-times":"fa-bars"} float-right ${m.textContrast}`,onClick:u})]})]})});const Ya={};for(const t in $t.schemeGroups)$t.schemeGroups[t].forEach(s=>{const n=$t[s];for(const r in n)r in Ya||(Ya[r]=[]),Ya[r].push({type:`${t[0].toUpperCase()}${t.slice(1)}`,name:s,category:"Colorbrewer",colors:n[r]})});const ds=(t,s,n=!1)=>{let r=C(Ya,[t],[]).reduce((a,l)=>l.name===s?l.colors:a,[]).slice();return n&&r.reverse(),r},qp=({...t})=>Object.keys(t).reduce((s,n)=>(t[n]&&s.push(n.split("").map((r,a)=>a===0?r.toUpperCase():r).join("")),s),[]).join(""),jw=(...t)=>w.useCallback(s=>{[...t].forEach(n=>{n&&(typeof n=="function"?n(s):n.current=s)})},[t]),Kp=t=>{const[s,n]=b.useState(null);return b.useEffect(()=>{const r=a=>{s.contains(a.target)||typeof t=="function"&&t(a)};return s&&document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[s,t]),[n,s]};function pi(){for(var t={}.hasOwnProperty,s=[],n=0;n<arguments.length;n++){var r=arguments[n];if(r){var a=typeof r;if(a==="string"||a==="number")s.push(r);else if(Array.isArray(r)){if(r.length){var l=pi.apply(null,r);l&&s.push(l)}}else if(a==="object"){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){s.push(r.toString());continue}for(var i in r)t.call(r,i)&&r[i]&&s.push(i)}}}return s.join(" ")}const Od=({icon:t,className:s})=>e.jsx("div",{className:`${s} flex justify-center items-center`,children:e.jsx("span",{className:t})}),Qo=({i:t=0,children:s,icon:n,to:r,onClick:a,className:l=null,type:i="side",active:c=!1,subMenus:d=[],themeOptions:u,subMenuActivate:p="onClick",subMenuOpen:m=!1})=>{const h=st()[i==="side"?"sidenav":"topnav"](u),f=$e(),g=w.useMemo(()=>Array.isArray(r)?r:[r],[r]),x=w.useMemo(()=>{const I=d.reduce((T,A)=>(Array.isArray(A.path)?T.push(...A.path):A.path&&T.push(A.path),T),[]);return[...g,...I]},[g,d]),y=!!pc({path:`${x[0]}/*`||"",end:!0}),j=i==="side"?h.navitemSide:h.navitemTop,N=i==="side"?h.navitemSideActive:h.navitemTopActive,_=y||c,E=_?N:j,[L,S]=w.useState(m||y),[k,$]=w.useState(!1);return b.useEffect(()=>{S(y)},[y,L,r]),e.jsx("div",{className:i==="side"?h.subMenuParentWrapper:null,onMouseOutCapture:()=>p==="onHover"&&S(!1)||p!=="onHover"&&$(!1)&&S(!1),onMouseMove:()=>p==="onHover"&&S(!0)||p!=="onHover"&&$(!0)&&S(!0),children:e.jsx("div",{className:`${l||E}`,onClick:I=>{if(I.stopPropagation(),a)return a(g[0]);g[0]&&f(g[0])},children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-1 flex",children:[n?e.jsx(Od,{icon:n,className:i==="side"?_?h.menuIconSideActive:h.menuIconSide:_?h.menuIconTopActive:h.menuIconTop}):null,e.jsx("div",{className:h.navItemContent,children:s})]}),e.jsx("div",{onClick:()=>{p==="onClick"&&S(!L)},children:d.length?e.jsx(Od,{icon:L?h.indicatorIconOpen:h.indicatorIcon}):null}),d.length?e.jsx(ww,{i:t,showSubMenu:L,subMenuActivate:p,active:y,hovering:k,subMenus:d,type:i,themeOptions:u,className:l}):""]})})})},ww=({i:t,showSubMenu:s,subMenus:n,type:r,hovering:a,subMenuActivate:l,active:i,themeOptions:c})=>{const d=st()[r==="side"?"sidenav":"topnav"](c),u=!i&&l!=="onHover"&&a;return(!s||!n.length)&&!u?null:e.jsx("div",{className:r==="side"?d.subMenuWrapper:u&&t===0?d.subMenuWrapperInactiveFlyout:u&&t>0?d.subMenuWrapperInactiveFlyoutBelow:d.subMenuWrapperTop,children:e.jsx("div",{className:`
							${u&&d.subMenuWrapperInactiveFlyoutDirection}
							${!u&&d.subMenuWrapperChild}
					flex ${r==="side"||u?"flex-col":"flex-row"}
				`,children:n.map((p,m)=>e.jsx(Qo,{i:m+1,to:p.path,icon:p.icon,type:r,className:p.className,onClick:p.onClick,themeOptions:c,subMenus:p.subMenus,children:p.name},m))})})},Nw=t=>{const[s,n]=w.useState(null);return w.useEffect(()=>{const r=a=>{s.contains(a.target)||typeof t=="function"&&t(a)};return s&&document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[s,t]),[n,s]},Cc=({control:t,children:s,className:n,openType:r="hover"})=>{const[a,l]=w.useState(!1),i=w.useCallback(()=>l(!1),[]),[c]=Nw(i);return e.jsxs("div",{ref:c,className:`h-full relative cursor-pointer ${n}`,onMouseEnter:d=>{r==="hover"&&l(!0)},onMouseLeave:d=>l(!1),onClick:d=>{l(!a)},children:[t,a?e.jsx("div",{className:`shadow fixed w-full max-w-[200px] rounded-b-lg ${a?"block":"hidden"} z-10`,children:s}):""]})},Yp=({color:t})=>e.jsxs("svg",{width:"100",height:"100",children:[e.jsx("path",{fill:t,d:`M31.6,3.5C5.9,13.6-6.6,42.7,3.5,68.4c10.1,25.7,39.2,38.3,64.9,28.1l-3.1-7.9c-21.3,8.4-45.4-2-53.8-23.3
		c-8.4-21.3,2-45.4,23.3-53.8L31.6,3.5z`,children:e.jsx("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"2s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})}),e.jsx("path",{fill:t,d:`M42.3,39.6c5.7-4.3,13.9-3.1,18.1,2.7c4.3,5.7,3.1,13.9-2.7,18.1l4.1,5.5c8.8-6.5,10.6-19,4.1-27.7
		c-6.5-8.8-19-10.6-27.7-4.1L42.3,39.6z`,children:e.jsx("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"-360 50 50",repeatCount:"indefinite"})}),e.jsx("path",{fill:t,d:`M82,35.7C74.1,18,53.4,10.1,35.7,18S10.1,46.6,18,64.3l7.6-3.4c-6-13.5,0-29.3,13.5-35.3s29.3,0,35.3,13.5
		L82,35.7z`,children:e.jsx("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1.5s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})})]}),Cw=({width:t="100vw",height:s="100vh",color:n="#005bcc"})=>e.jsx("div",{style:{width:t,height:s,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Yp,{color:n})}),go=({scale:t=1,color:s="#005bcc"})=>{const n=100*t;return e.jsx("div",{style:{position:"relative",width:`${n}px`,height:`${n}px`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{display:"flex",transform:`scale(${t}, ${t})`,width:"100px",height:"100px"},children:e.jsx(Yp,{color:s})})})},_w=(t={})=>{const{color:s="white",size:n="base",width:r="block"}=t;let a={white:`
            border border-gray-300  text-gray-700 bg-white hover:text-gray-500
            focus:outline-none focus:shadow-outline-blue focus:border-blue-300
            active:text-gray-800 active:bg-gray-50 transition duration-150 ease-in-out
            disabled:cursor-not-allowed
        `,cancel:`
            text-red-700 bg-white hover:text-red-500
            focus:outline-none focus:shadow-outline-blue focus:border-blue-300
            active:text-red-800 active:bg-gray-50 transition duration-150 ease-in-out
            disabled:cursor-not-allowed
        `,transparent:`
            border border-gray-300  text-gray-700 bg-white hover:text-gray-500
            focus:outline-none focus:shadow-outline-blue focus:border-blue-300
            active:text-gray-800 active:bg-gray-50 hover:bg-gray-100 hover:text-gray-900
            transition duration-150 ease-in-out
            disabled:cursor-not-allowed
        `,primary:`
            border border-transparent shadow
            text-sm leading-4 text-white bg-blue-600 hover:bg-blue-700
            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`,danger:""},l={base:"px-4 py-4 leading-5 font-medium",xs:"text-xs px-1 py-0.5 leading-5 font-thin rounded-sm",sm:"text-sm px-2 py-2 leading-5 font-medium rounded-md",lg:"text-lg px-6 py-6 leading-5 font-medium rounded-md",xl:"text-2xl px-12 py-8 leading-5 font-medium rounded-lg"},i={block:"",full:"w-full"};return{button:`
          ${a[s]} ${l[n]} ${i[r]}
        `,vars:{color:a,size:l,width:i}}},Sw=({onClick:t,children:s,confirmMessage:n,type:r,...a})=>{const[l,i]=w.useState(!1),c=w.useRef(null),d=w.useCallback(p=>{p.preventDefault(),i(!0),c.current=setTimeout(i,5e3,!1)},[c]),u=w.useCallback(p=>{i(!1),t&&t(p)},[t]);return w.useEffect(()=>()=>clearTimeout(c.current),[c]),e.jsx("button",{onClick:l?r==="submit"?null:u:d,...a,type:l?r:"button",children:e.jsxs("div",{className:"relative w-full",children:[l?e.jsx("div",{className:"absolute top-0 left-0 right-0 bottom-0 flex items-center overflow-hidden",children:e.jsx("div",{children:n})}):null,e.jsx("div",{style:{color:l?"transparent":null},children:s})]})})},We=({children:t,type:s="button",className:n="",showConfirm:r=!1,confirmMessage:a="click to confirm",themeOptions:l={},...i})=>{const c=_w(l);return r?e.jsx(Sw,{type:s,...i,confirmMessage:a,className:`${c.button} ${n}`,children:t}):e.jsx("button",{type:s,...i,className:`${c.button} ${n}`,children:t})},wn=t=>t==null||t===!1||typeof t=="string"&&!t.length?!1:Array.isArray(t)?t.reduce((s,n)=>s||wn(n),!1):typeof t=="number"&&isNaN(t)?!1:typeof t=="object"?Object.values(t).reduce((s,n)=>s||wn(n),!1):!0,Un=w.forwardRef(({large:t,small:s,className:n=null,onChange:r,value:a,showClear:l=!1,placeholder:i="type a value...",themeOptions:c={color:"white",size:"small",width:"block"},...d},u)=>{const p=st().input(c).input,m=w.useCallback(h=>{h.stopPropagation(),r(h.target.value,h)},[r]);return l?e.jsxs(e.Fragment,{children:[e.jsx("input",{...d,ref:u,onChange:m,value:wn(a)?a:"",className:`${n||p} `,placeholder:i}),wn(a)?e.jsx("div",{className:`absolute right-0 ${s?"mr-1":"mr-2"} top-0 bottom-0 flex items-center`,children:e.jsx("div",{className:`
                ${p.menuBgActive} ${p.menuBgActiveHover} ${p.textContrast}
                p-1 flex justify-center items-center rounded cursor-pointer
              `,onClick:()=>r(""),children:e.jsxs("svg",{width:"8",height:"8",children:[e.jsx("line",{x2:"8",y2:"8",style:{stroke:"currentColor",strokeWidth:2}}),e.jsx("line",{y1:"8",x2:"8",style:{stroke:"currentColor",strokeWidth:2}})]})})}):null]}):e.jsx("input",{...d,ref:u,onChange:m,value:wn(a)?a:"",className:`${n||p} `,placeholder:i})});w.forwardRef(({large:t,small:s,className:n="",children:r,onChange:a,value:l,...i},c)=>{const d=st(),u=d[`input${qp({large:t,small:s})}`];return e.jsx("textarea",{...i,onChange:p=>a(p.target.value),value:l||"",className:`${u()} ${n}`,ref:c,rows:6,children:r})});w.forwardRef(({children:t,hasFocus:s,large:n,small:r,disabled:a=!1,customTheme:l,className:i="",...c},d)=>{const u={...st(),...l};return e.jsx("div",{...c,ref:d,className:`
        w-full flex flex-row flex-wrap
        ${a?`${u.inputBgDisabled} ${u.inputBorderDisabled}`:s?`${u.inputBgFocus} ${u.inputBorderFocus}`:`${u.inputBg} ${u.inputBorder}`}
        ${n?"pt-1 pb-2 px-4":r?"pb-1 px-1":"pb-1 px-2"}
        ${n?u.textLarge:r?u.textSmall:u.textBase}
        ${i}
      `,children:t})});const Pd=({isPlaceholder:t,children:s,remove:n,edit:r,disabled:a=!1,themeOptions:l})=>{const i=st().select(l);return e.jsxs("div",{className:`
        ${t?i.textLight:`${a?i.accent2:n||r?i.menuBgActive:""}
            mr-1 pl-2 ${!a&&(n||r)?"pr-1":"pr-4"}
          `}
        ${i.itemText}
         flex items-center max-w-full
      `,children:[e.jsx("span",{className:i.valueItem,children:s}),t||a||!r?null:e.jsx("div",{className:`
            ${i.menuBgActive} ${i.menuBgActiveHover} ${i.textContrast}
            ml-2 p-1 flex justify-center items-center rounded cursor-pointer
          `,onClick:r,children:e.jsxs("svg",{width:"8",height:"8",children:[e.jsx("line",{x1:"0",y1:"6",x2:"4",y2:"2",style:{stroke:"currentColor",strokeWidth:2}}),e.jsx("line",{x1:"4",y1:"2",x2:"8",y2:"6",style:{stroke:"currentColor",strokeWidth:2}})]})}),t||a||!n?null:e.jsx("div",{className:`
            ${i.menuBgActive} ${i.menuBgActiveHover} ${i.textContrast}
            ${r?"ml-1":"ml-2"} p-1 flex justify-center items-center rounded cursor-pointer
          `,onClick:n,children:e.jsxs("svg",{width:"8",height:"8",children:[e.jsx("line",{x2:"8",y2:"8",style:{stroke:"currentColor",strokeWidth:2}}),e.jsx("line",{y1:"8",x2:"8",style:{stroke:"currentColor",strokeWidth:2}})]})})]})},$w=w.forwardRef(({children:t,searchable:s,opened:n,direction:r,themeOptions:a={}},l)=>{const i=st().select(a);return e.jsx("div",{className:`
      absolute left-0 z-40 overflow-hidden min-w-full
      ${n?"block":"hidden"}
    `,style:r==="down"?{top:"100%"}:{bottom:"100%"},ref:l,children:e.jsx("div",{className:`${i.menuWrapper}`,children:t})})}),Cl=t=>t,Nn=t=>{const{multi:s=!1,searchable:n=!1,domain:r=[],options:a=[],value:l=null,placeholder:i="Select a value...",accessor:c=Cl,listAccessor:d=null,autoFocus:u=!1,disabled:p=!1,removable:m=!1,themeOptions:h={},onChange:f=Cl,valueAccessor:g=Cl,className:x=""}=t,y=st().select(h),j=w.useRef(),N=w.useRef(),_=w.useRef(),E=w.useRef([]),[L,S]=b.useState(!1),[k,$]=b.useState("down"),[,I]=b.useState(!1),[T,A]=b.useState(""),R=W=>{W.stopPropagation(),S(!0),I(!0)},O=W=>{L&&N&&N.current.focus(),S(!1)},M=()=>{N&&N.focus()};b.useEffect(()=>{u&&M()},[u]),b.useEffect(()=>{const W=U=>{L&&N&&N.current.focus(),S(!1)},Y=U=>{j&&j.current&&j.current.contains(U.target)||W()};if(document.addEventListener("mousedown",Y),_&&_.current&&L&&k==="down"){const U=_.current.getBoundingClientRect();U.top+U.height>window.innerHeight&&$("up")}return()=>{document.removeEventListener("mousedown",Y)}},[k,L]);const D=()=>{let W=[];return wn(l)?(Array.isArray(l)?W=l:W=[l],B().filter(Y=>W.reduce((U,q)=>U||Fe(g(Y),q),!1))):[]},P=(W,Y)=>{W.stopPropagation(),O(),Y=g(Y),s?wn(l)?l.reduce((U,q)=>U&&!Fe(q,Y),!0)&&f([...l,Y]):f([Y]):f(Y)},F=(W,Y)=>{W.stopPropagation(),Y=g(Y),f(s?l.filter(U=>!Fe(U,Y)):null)},B=()=>a.length?a:r;let V=b.useCallback(W=>{switch(W.key){case"Space":case"Enter":case"ArrowDown":W.preventDefault(),L||S(!0),E[0]&&E[0].current&&E[0].current.focus();break;case"ArrowUp":W.preventDefault(),L||S(!0),E[0]&&E[0].current&&E[0].current.focus();break;case"Escape":W.preventDefault(),W.stopPropagation(),L&&S(!1);break}},[L]);const G=D(),Z=B();let X=Z.filter(W=>G.includes(W));const H=d||c,z=T?Ln(Z,T,{keys:[H]}):Z;return e.jsxs("div",{ref:j,onMouseLeave:W=>O(),children:[e.jsx("div",{className:"cursor-pointer",children:e.jsxs("div",{id:t.id,ref:N,onBlur:W=>I(!1),onFocus:W=>I(!0),onKeyDown:V,disabled:p,tabIndex:p?-1:0,onClick:R,className:`${y.select} ${x}`,children:[e.jsx("div",{className:"w-11/12 overflow-x-hidden",children:G.length?G.map((W,Y,U)=>e.jsx(Pd,{disabled:p,themeOptions:h,remove:m?q=>F(q,W):null,children:c(W,U)},Y)):e.jsx(Pd,{isPlaceholder:!0,themeOptions:h,children:i},"placeholder")}),e.jsx("div",{className:`${y.selectIcon}`})]})}),e.jsx("div",{className:"relative",children:p||!L?null:e.jsxs($w,{opened:L,direction:k,searchable:n,ref:_,themeOptions:h,children:[n?e.jsx("div",{className:"p-2 pt-1 w-full",children:e.jsx(Un,{type:"text",autoFocus:!0,placeholder:"search...",className:"w-full",value:T,onChange:W=>A(W)})}):null,z.length?e.jsx("div",{className:"scrollbar overflow-y-auto",style:{maxHeight:"15rem"},children:z.map((W,Y)=>e.jsx("div",{ref:U=>E.current.push(U),onClick:X.includes(W)?U=>U.stopPropagation():U=>P(U,W),className:`${X.includes(W)?`${y.menuItemActive}`:`${y.menuItem}`}`,children:C(W,"OptionComponent")?e.jsx(W.OptionComponent,{option:W}):H(W)},`${c(W)}-${Y}`))}):e.jsx("div",{className:"p-1 text-center",children:"No Selections"})]})})]})};w.forwardRef(({large:t,small:s,className:n="",labels:r=["False","True"],value:a,onChange:l,disabled:i=!1,autoFocus:c=!1,...d},u)=>{const[p,m]=w.useState(!1),[h,f]=w.useState(null);w.useEffect(()=>{h&&c&&h.focus()},[c,h]);const g=st();return e.jsx("div",{...d,onClick:i?null:x=>l(!a),onFocus:x=>m(!i),onBlur:x=>m(!1),className:`
        ${t?`${g.paddingLarge} ${g.textLarge}`:s?`${g.paddingSmall} ${g.textSmall}`:`${g.paddingBase} ${g.textBase}`}
        ${i?`${g.inputBgDisabled} ${g.inputBorderDisabled}`:p?`${g.inputBgFocus} ${g.inputBorderFocus}`:`${g.inputBg} ${g.inputBorder}`}
        ${n}
      `,ref:jw(u,f),tabIndex:i?"-1":"0",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-0",children:e.jsx(Ew,{value:a})}),e.jsx("div",{className:"flex-1 ml-4",children:r[+!!a]})]})})});const Ew=({value:t})=>{const s=st();return e.jsx("div",{className:"px-1 h-full flex justify-center items-center",children:e.jsxs("div",{className:"relative h-3",children:[e.jsxs("div",{className:"relative w-10 h-3 rounded-lg overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 w-20 h-full ${s.accent4}`,style:{left:t?"100%":"0",transition:"left 0.25s"}}),e.jsx("div",{className:`absolute top-0 w-20 h-full ${s.bgInfo}`,style:{right:t?"0":"100%",transition:"right 0.25s"}})]}),e.jsx("div",{className:`absolute h-4 w-4 rounded-lg ${s.booleanInputSlider||s.accent2}`,style:{top:"50%",left:t?"calc(100% - 0.625rem)":"-0.125rem",transform:"translateY(-50%)",transition:"left 0.25s"}})]})})};let kw=-1;const Dd=()=>`input-id-${++kw}`,Lw=w.memo(({small:t=!1,large:s=!1})=>{const n=st();return e.jsx("div",{className:`
        ${t?"h-3 mt-1 w-1":s?"h-9 mt-3 w-3":"h-6 mt-2 w-2"}
        rounded pointer-events-none ${n.accent3}
      `,style:{transform:"translate(-50%, -50%)"}})}),Iw=({showPreview:t=!0,showInputs:s=!0,showLabels:n=!0,showHex:r=!0,showRgb:a=!0,small:l=!1,large:i=!1,disabled:c=!1,autoFocus:d=!1,...u})=>{const[p,m]=w.useState(),h=w.useRef(Dd()),f=w.useRef(Dd());w.useEffect(()=>{p&&d&&p.focus()},[p,d]);const g=st(),x=g[`input${qp({large:i,small:l})}`];return e.jsx("div",{tabIndex:c?-1:0,ref:m,className:`
        ${x} w-full h-full
      `,children:e.jsxs("div",{className:`
          grid
          ${l?"gap-y-1 py-1":i?"gap-y-4 py-2":"gap-y-2 py-1"}
        `,style:{gridTemplateRows:`auto auto${s?" auto":""}`},children:[e.jsxs("div",{className:`
            grid grid-cols-12
            ${l?"gap-x-1":i?"gap-x-4":"gap-x-2"}
          `,style:{height:i?"20rem":l?"10rem":"15rem"},children:[e.jsx("div",{className:`
              relative h-full cursor-pointer
              ${t?"col-span-9":"col-span-12"}
            `,children:e.jsx(Sd.Saturation,{...u,style:{pointer:{pointerEvents:"none"}}})}),t?e.jsx("div",{className:"col-span-3 h-full rounded",style:{backgroundColor:u.hex}}):null]}),e.jsx("div",{className:`
            rounded cursor-pointer relative
            ${l?"h-2":i?"h-6":"h-4"}
          `,children:e.jsx(Sd.Hue,{...u,direction:"horizontal",pointer:()=>e.jsx(Lw,{small:l,large:i})})}),s?e.jsxs("div",{className:`
              grid grid-cols-${!!r+!!a}
              ${l?"gap-x-1":i?"gap-x-4":"gap-x-2"}
            `,children:[r?e.jsx("div",{className:n?`${g.accent1} rounded
                  ${n?l?"px-1 pt-1 pb-0":i?"px-4 pt-4 pb-3":"px-2 pt-2 pb-1":""}
                `:null,children:e.jsx(Ow,{id:h.current,...u,value:u.hex,small:l,large:i,showLabels:n})}):null,a?e.jsx("div",{className:n?`${g.accent1} rounded
                  ${n?l?"px-1 pt-1 pb-0":i?"px-4 pt-4 pb-3":"px-2 pt-2 pb-1":""}
                `:null,children:e.jsx(Rw,{id:f.current,...u,value:u.rgb,small:l,large:i,showLabels:n})}):null]}):null]})})},Tw=Ub(Iw),Mw=({value:t,onChange:s,...n})=>{const r=w.useCallback(({hex:a})=>{s(a)},[s]);return e.jsx(Tw,{color:t||"",...n,onChange:r})},Bw=t=>({value:t.toUpperCase(),blurValue:t.toUpperCase()}),Aw=(t,s)=>{const{type:n,...r}=s;switch(n){case"update-state":return{...t,...r};default:return t}},Yr=w.forwardRef(({id:t,label:s,showLabels:n,...r},a)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Un,{id:t,ref:a,...r}),n?e.jsx("label",{htmlFor:t,className:`
            font-bold
            ${r.small?"text-sm":r.large?"text-lg":"text-base"}
          `,children:s}):null]})),Ow=({id:t,value:s,onChange:n,small:r=!1,large:a=!1,showLabels:l=!0})=>{const[i,c]=w.useReducer(Aw,s,Bw),d=w.useRef(null),u=w.useRef(null),p=w.useRef(null);w.useEffect(()=>{s!==i.value&&(p.current!==s||u.current!==i.value)&&(d.current===document.activeElement?c({type:"update-state",blurValue:s.toUpperCase()}):c({type:"update-state",value:s.toUpperCase(),blurValue:!i.blurValue&&s.toUpperCase()})),u.current=i.value,p.current=s},[s,i]);const m=w.useCallback(f=>{c({type:"update-state",value:f}),n(f)},[n]),h=w.useCallback(f=>{i.blurValue&&c({type:"update-state",value:i.blurValue,blurValue:null})},[i]);return e.jsx(Yr,{type:"text",id:t,small:r,large:a,ref:d,onChange:m,value:i.value,onBlur:h,showLabels:l,label:"Hex"})},Pw=t=>({value:t,blurValue:t}),Dw=(t,s)=>{const{type:n,...r}=s;switch(n){case"update-state":return{...t,...r};case"update-value":return{...t,value:{...t.value,...r}};default:return t}},Rw=({id:t,value:s,onChange:n,small:r=!1,large:a=!1,showLabels:l=!0})=>{const[i,c]=w.useReducer(Dw,s,Pw),d=w.useRef(null),u=w.useRef(null),p=w.useRef(null),m=w.useRef(null),h=w.useRef(null);w.useEffect(()=>{!Fe(s,i.value)&&(!Fe(h.current,s)||!Fe(m.current,i.value))&&([d.current,u.current,p.current].includes(document.activeElement)?c({type:"update-state",blurValue:s}):c({type:"update-state",value:s,blurValue:!i.blurValue&&s})),m.current=i.value,h.current=s},[s,i]);const f=w.useCallback((x,y)=>{const j=y.target.name;c({type:"update-value",[j]:x}),n({...s,[j]:x})},[s,n]),g=w.useCallback(x=>{i.blurValue&&c({type:"update-state",value:i.blurValue,blurValue:null})},[i]);return e.jsxs("div",{className:`
      grid grid-cols-3
      ${r?"gap-x-1":a?"gap-x-4":"gap-x-2"}
    `,children:[e.jsx(Yr,{type:"number",id:`r-${t}`,name:"r",small:r,large:a,min:0,max:255,ref:d,onChange:f,value:i.value.r,onBlur:g,showLabels:l,label:"Red"}),e.jsx(Yr,{type:"number",id:`g-${t}`,name:"g",small:r,large:a,min:0,max:255,ref:u,onChange:f,value:i.value.g,onBlur:g,showLabels:l,label:"Green"}),e.jsx(Yr,{type:"number",id:`b-${t}`,name:"b",small:r,large:a,min:0,max:255,ref:p,onChange:f,value:i.value.b,onBlur:g,showLabels:l,label:"Blue"})]})},Zp=(t={color:"white",size:"compact"})=>{const{color:s="white",size:n="compact"}=t;let r={white:"bg-white hover:bg-blue-50",gray:"bg-gray-100 hover:bg-gray-200",transparent:"gray-100",total:"bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold"},a={small:"px-4 py-1 text-xs",compact:"px-4 py-1 text-sm",full:"px-10 py-5"};return{tableHeader:`${a[n]} pb-1 h-8 border border-b-4 border-gray-200 bg-slate-50 text-left font-semibold text-gray-700 uppercase first:rounded-tl-md last:rounded-tr-md`,tableInfoBar:"bg-white",tableRow:`${r[s]} transition ease-in-out duration-150 hover:bg-blue-100`,totalRow:`${r.total} transition ease-in-out duration-150`,tableOpenOutRow:"flex flex-col",tableRowStriped:"bg-white odd:bg-blue-50 hover:bg-blue-100 bg-opacity-25 transition ease-in-out duration-150",tableCell:`${a[n]} break-words border border-gray-200 pl-1 align-top font-light text-sm`,inputSmall:"w-24",sortIconDown:"fas fa-sort-amount-down text-tigGray-300 opacity-75",sortIconUp:"fas fa-sort-amount-up text-tigGray-300 opacity-75",sortIconIdeal:"fa fa-sort-alt text-tigGray-300 opacity-25",infoIcon:"fas fa-info text-sm text-blue-300 hover:text-blue-500",vars:{color:r,size:a}}},Fw=({column:t})=>{var a;const{filterValue:s="",setFilter:n}=t,r=typeof st=="function"&&((a=st())!=null&&a.table)?st().table():Zp();return e.jsx("div",{className:"w-3/4",children:e.jsx("input",{className:r.inputSmall,value:s,onChange:l=>n(l.target.value),onClick:l=>l.stopPropagation(),placeholder:"Search..."})})},Vw=({column:{filterValue:t,setFilter:s,preFilteredRows:n,id:r,filterMeta:a,filterDomain:l,onFilterChange:i,customValue:c,filterThemeOptions:d,filterClassName:u,filterMulti:p,filterRemovable:m=!0}})=>{const h=w.useMemo(()=>{const g=new Set;return a||(n.forEach(x=>{g.add(x.values[r])}),[...g.values()])},[a,r,n]).filter(g=>g),f=n.length;return e.jsx("div",{className:"",children:e.jsx(Nn,{domain:l||h,value:t||c||[],onChange:g=>{s(g||void 0),i(g||void 0)},placeHolder:`Search ${f} records...`,removable:m,multi:p,themeOptions:d,className:`${u}`})})};function Hw(t,s,n){return Ln(t,n,{keys:[r=>r.values[s]]})}function zw(t,s,n){return t.filter(r=>{const a=r.values[s];return a!==void 0&&Array.isArray(n)&&n.length?n.includes(a):a!==void 0&&n.length?a===n:!0})}const Uw=(t,s)=>{let n=t-2,r=t+2;n<0&&(r+=-n,n=0),r>s&&(n-=r-s,r=s);const a=[];for(let l=Math.max(0,n);l<=Math.min(s,r);++l)a.push(l);return a},Ww=({values:t,theme:s})=>e.jsx("div",{className:"flex flex-col divide-y",children:t.map(({key:n,value:r},a)=>e.jsxs("div",{className:"flex-1 p-2",children:[n?e.jsxs("div",{className:"font-semibold",children:[n,":"]}):null,e.jsx("span",{className:!0,children:r})]},n||`key-${a}`))}),Gw=({fetchData:t,manualPagination:s,theme:n,pageValue:r,pageCount:a,pageSize:l,pageIndex:i,statePageSize:c,totalRecords:d,rows:u,canNextPage:p,onPageSelect:m,onPrevPage:h,onNextPage:f,previousPage:g,gotoPage:x,nextPage:y})=>a<=1?null:e.jsxs("div",{className:`flex items-center flex-wrap ${n.textInfo}`,children:[e.jsxs("div",{className:"flex-0",children:["Page ",r+1," of ",a,e.jsx("br",{}),"Rows ",r*l+1," -",!t&&!s?Math.min(u.length,i*c+c):Math.min(d,r*l+l)," of ",!t&&!s?u.length:d]}),e.jsxs("div",{className:"flex-1 flex justify-end items-center",children:[e.jsx(We,{disabled:r===0,themeOptions:{size:"sm"},onClick:j=>!t&&!s?x(0):m(0),children:"<<"}),e.jsx(We,{disabled:r===0,themeOptions:{size:"sm"},onClick:j=>!t&&!s?g():h(),children:"<"}),Uw(r,a-1).map(j=>{const N=j===r;return e.jsx(We,{themeOptions:{size:"sm",color:N?"primary":"white"},onClick:N?null:_=>!t&&!s?x(j):m(j),children:j+1},j)}),e.jsx(We,{disabled:!t&&!s?!p:r===a-1,themeOptions:{size:"sm"},onClick:j=>!t&&!s?y(0):f(j),children:">"}),e.jsx(We,{disabled:r===a-1,themeOptions:{size:"sm"},onClick:j=>!t&&!s?x(a-1):m(a-1),children:">>"})]})]}),Rd=({row:t,expand:s,visibleColumns:n,ExpandRow:r,theme:a})=>!t.isExpanded||!s.length?null:e.jsx("tr",{className:a.tableRow,children:e.jsx("td",{colSpan:n.length,className:a.tableCell,children:e.jsx(r,{values:s})})}),Fd=({ii:t,cell:s,row:n,columns:r,expand:a,expanded:l,toggleRowExpanded:i,theme:c})=>{const{key:d,...u}=s.getCellProps({style:{minWidth:s.column.minWidth,maxWidth:s.column.maxWidth,width:s.column.width}});return e.jsx("td",{...u,className:`text-${C(r.find(p=>p.Header===s.column.Header),"align")||"center"} ${c.tableCell}`,children:t>0||n.subRows.length===0&&a.length===0?s.render("Cell"):e.jsxs("div",{className:"flex items-center ",children:[e.jsx("div",{onClick:p=>{p.stopPropagation(),p.preventDefault(),Object.keys(l).filter(m=>m!==n.id).forEach(i),n.toggleRowExpanded(!n.isExpanded)},className:`
                          flex item-center justify-center
                          rounded cursor-pointer py-1 px-2
                        h-full hover:text-blue-500
                           ${c.transition}
                        `,children:n.isExpanded?e.jsx("i",{className:"fal fa-chevron-down"}):e.jsx("i",{className:"fal fa-chevron-right"})}),e.jsx("div",{className:"flex-1",children:s.render("Cell")})]})},d??t)},Vd=[],St=({columns:t=Vd,data:s=Vd,sortBy:n,sortOrder:r="",initialPageSize:a=10,manualPagination:l,fetchData:i,onPageChange:c,numRecords:d,manualCurrentPage:u,pageSize:p=5,onRowClick:m,onRowEnter:h,onRowLeave:f,ExpandRow:g=Ww,disableFilters:x=!1,disableSortBy:y=!1,csvDownload:j=!1,onCsvDownload:N,themeOptions:_={},...E})=>{var re;const[L,S]=w.useState(s||[]),[k,$]=w.useState(d||0),[I,T]=b.useState(u||0),[A,R]=b.useState(0),[O,M]=b.useState(!1),D=typeof st=="function"&&((re=st())!=null&&re.table)?st().table(_):Zp(_),P=w.useMemo(()=>({fuzzyText:Hw,dropdown:zw}),[]),F=w.useMemo(()=>({dropdown:Vw,text:Fw}),[]),B=w.useMemo(()=>({Filter:!1}),[]),{getTableProps:V,getTableBodyProps:G,headerGroups:Z,page:X,rows:H,preFilteredRows:z,prepareRow:W,canPreviousPage:Y,canNextPage:U,gotoPage:q,previousPage:te,nextPage:K,pageCount:ne,visibleColumns:J,toggleRowExpanded:ae,setPageSize:de,state:{pageSize:ue,pageIndex:fe,expanded:ve}}=ls.useTable({columns:t,data:L,manualPagination:!!l||!!i,...(!!i||!!l)&&{pageCount:Math.ceil(k/p)},defaultColumn:B,filterTypes:P,disableFilters:x,disableSortBy:y,initialState:{pageSize:+p||+a,...n&&{sortBy:[{id:n,desc:r.toLowerCase()==="desc"}]}}},ls.useFilters,ls.useGlobalFilter,ls.useSortBy,ls.useExpanded,ls.usePagination);w.useEffect(()=>{p!==null&&p!==ue&&de(+p)},[p,ue,de]),w.useEffect(()=>{i&&(async()=>{M(!0);const{data:pe,length:ge}=await i({currentPage:I,pageSize:p});return{data:pe,length:ge}})().then(pe=>{S((pe==null?void 0:pe.data)||[]),$((pe==null?void 0:pe.length)||0),M(!1)})},[i,p,I]),w.useEffect(()=>{i||S(s)},[s,ne,i]),w.useEffect(()=>{!i&&k!==d&&$(d)},[d]),w.useEffect(()=>{R(i||l?I:fe)},[fe,I]);const se=b.useCallback(()=>{T(Q=>Q+1),c(I+1)},[]),me=b.useCallback(()=>{T(Q=>Q-1),c(I-1)},[]),xe=b.useCallback(Q=>{I!==Q&&T(Q),c(Q)},[I]);return!(t.length&&L.length)||!z.length?null:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"overflow-auto scrollbar-sm",children:[O&&e.jsx("div",{className:"z-10 absolute float-center text-center align-middle items-center w-full",style:{backgroundColor:"rgba(255,255,255,0.38)",width:"100%"},children:e.jsx(Cw,{width:"100%",height:"100%"})}),j?e.jsx("div",{className:"w-full text-right",children:e.jsxs(mp,{data:L,headers:t.map(Q=>({label:Q.Header,key:Q.accessor})),filename:"data.csv",className:D.downloadWrapper,children:[e.jsx("i",{className:D.downloadIcon||"fa fa-download"})," ",e.jsx("label",{children:"csv"})]})}):null,e.jsxs("table",{...V(),className:"w-full",children:[e.jsx("thead",{children:Z.map(Q=>{const{key:pe,...ge}=Q.getHeaderGroupProps();return e.jsx("tr",{...ge,children:Q.headers.map(le=>{const{key:ie,...be}=le.getHeaderProps({...le.getSortByToggleProps(),style:{minWidth:le.minWidth,width:le.width,maxWidth:le.maxWidth}});return e.jsx("th",{...be,className:D.tableHeader,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex-1 pr-1",children:le.render("Header")}),e.jsxs(e.Fragment,{children:[le.info&&e.jsx("i",{className:`${D.infoIcon}`,title:le.info}),le.canSort?le.isSorted?le.isSortedDesc?e.jsx("i",{className:`ml-2 pt-1 ${D.sortIconDown}`}):e.jsx("i",{className:`ml-2 pt-1 ${D.sortIconUp}`}):e.jsx("i",{className:`ml-2 pt-1 ${D.sortIconIdeal}`}):null]})]}),e.jsx("div",{children:le.canFilter?e.jsx("div",{children:le.render(F[le.filter]||"Filter")}):null})]})},ie)})},pe)})}),e.jsxs("tbody",{...G(),children:[X.filter(Q=>!Q.original.totalRow).map(Q=>{const{onClick:pe,expand:ge=[]}=Q.original;W(Q);const{key:le,...ie}=Q.getRowProps();return e.jsxs(w.Fragment,{children:[e.jsx("tr",{...ie,onMouseEnter:typeof h=="function"?be=>h(be,Q):null,onMouseLeave:typeof f=="function"?be=>f(be,Q):null,className:`
                                        ${E.striped?D.tableRowStriped:D.tableRow}
                                        ${pe||m?"cursor-pointer":""}
                                    `,onClick:be=>{typeof m=="function"&&m(be,Q),typeof pe=="function"&&pe(be,Q)},children:Q.cells.map((be,_e)=>e.jsx(Fd,{ii:_e,cell:be,row:Q,columns:t,expand:ge,expanded:ve,toggleRowExpanded:ae,theme:D},_e))}),e.jsx(Rd,{row:Q,expand:ge,visibleColumns:J,ExpandRow:g,theme:D})]},le)}),H.filter(Q=>Q.original.totalRow).map(Q=>{const{onClick:pe,expand:ge=[]}=Q.original;W(Q);const{key:le,...ie}=Q.getRowProps();return e.jsxs(w.Fragment,{children:[e.jsx("tr",{...ie,onMouseEnter:typeof h=="function"?be=>h(be,Q):null,onMouseLeave:typeof f=="function"?be=>f(be,Q):null,className:`
                                        ${D.totalRow}
                                        ${pe||m?"cursor-pointer":""}
                                    `,onClick:be=>{typeof m=="function"&&m(be,Q),typeof pe=="function"&&pe(be,Q)},children:Q.cells.map((be,_e)=>e.jsx(Fd,{ii:_e,cell:be,row:Q,columns:t,expand:ge,expanded:ve,toggleRowExpanded:ae,theme:D},_e))}),e.jsx(Rd,{row:Q,expand:ge,visibleColumns:J,ExpandRow:g,theme:D})]},le)})]})]})]}),e.jsx("div",{className:"w-full p-2",children:e.jsx(Gw,{fetchData:i,manualPagination:l,theme:D,pageValue:A,pageCount:ne,pageSize:p,pageIndex:fe,statePageSize:ue,totalRecords:k,rows:H,canNextPage:U,onPageSelect:xe,onPrevPage:me,onNextPage:se,previousPage:te,gotoPage:q,nextPage:K,onPageChange:c})})]})},Xp=({open:t,toggle:s,menuItems:n=[],rightMenu:r=null,themeOptions:a={}})=>{let l=st().topnav(a);return e.jsxs("div",{className:`${t?"md:hidden":"hidden"} ${l.topnavMobileContainer}`,id:"mobile-menu",children:[e.jsx("div",{className:"",children:n.map((i,c)=>e.jsx(Qo,{type:"top",to:i.path,icon:i.icon,themeOptions:a,subMenus:C(i,"subMenus",[]),children:i.name},c))}),e.jsx("div",{className:"",children:r})]})},Jw=({open:t,toggle:s,menuItems:n=[],rightMenu:r=null,leftMenu:a=null,subMenuActivate:l,themeOptions:i={}})=>{let c=st().topnav(i);return e.jsx("div",{className:`${c.topnavWrapper}`,children:e.jsxs("div",{className:`${c.topnavContent} justify-between`,children:[e.jsx("div",{children:a}),e.jsx("div",{className:`${c.topnavMenu}`,children:n.map((d,u)=>e.jsx(Qo,{type:"top",to:d.path,icon:d.icon,subMenuActivate:l,themeOptions:i,subMenus:C(d,"subMenus",[]),children:d.name},u))}),e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:`${c.topmenuRightNavContainer}`,children:r}),e.jsxs("button",{type:"button",className:`${c.mobileButton}`,onClick:()=>s(!t),children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),e.jsx("div",{className:"flex justify-center items-center text-2xl",children:e.jsx("span",{className:t?c.menuCloseIcon:c.menuOpenIcon})})]})]})]})})},_c=({...t})=>{const[s,n]=b.useState(!1);return e.jsxs("nav",{children:[e.jsx(Jw,{open:s,toggle:n,...t}),e.jsx(Xp,{open:s,...t})]})},Qp=({i:t,item:s,themeOptions:n,subMenuActivate:r})=>e.jsx(Qo,{to:s.path,icon:s.icon,className:s.className,onClick:s.onClick,themeOptions:n,subMenuActivate:r,subMenus:C(s,"subMenus",[]),children:s.name},t),qw=({open:t,toggle:s,logo:n=null,topMenu:r,menuItems:a=[],bottomMenu:l,themeOptions:i={},subMenuActivate:c,subMenuStyle:d,...u})=>{let p=st().sidenav(i);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:hidden",onClick:()=>s(!t),children:e.jsx("span",{className:t?p.menuIconOpen:p.menuIconClosed})}),e.jsxs("div",{style:{display:t?"block":"none"},className:"md:hidden",children:[e.jsx("div",{className:"fixed inset-0 z-20 transition-opacity ease-linear duration-300",children:e.jsx("div",{className:"absolute inset-0 opacity-75"})}),e.jsx("div",{className:`fixed inset-0 flex z-40 ${p.contentBgAccent}`,children:e.jsxs("div",{className:`flex-1 flex flex-col max-w-xs w-full transform ease-in-out duration-300 ${p.contentBg}`,children:[e.jsx("div",{className:"absolute top-0 right-0 -mr-14 p-1",children:e.jsx("button",{onClick:()=>s(!t),className:"flex items-center justify-center h-12 w-12 rounded-full focus:outline-none focus:bg-gray-600 os-icon os-icon-x"})}),e.jsxs("div",{className:"flex-1 h-0 pt-2 pb-4 overflow-y-auto overflow-x-hidden",children:[e.jsx("div",{className:"px-6 pt-4 pb-8 logo-text gray-900",children:e.jsx(je,{to:"/",className:`flex-shrink-0 flex items-center ${p.text}`,children:n})}),e.jsx("div",{children:r}),e.jsx("nav",{className:"flex-1",children:a.map((m,h)=>e.jsx("div",{className:m.sectionClass,children:Qp({i:h,page:m,themeOptions:i,subMenuActivate:c})},h))}),e.jsx("div",{children:l})]})]})})]})]})},Kw=({menuItems:t=[],logo:s=null,topMenu:n,bottomMenu:r,toggle:a,open:l,mobile:i,themeOptions:c={},subMenuActivate:d,subMenuStyle:u,...p})=>{let m=st().sidenav(c);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${m.sidenavWrapper}`,children:[n,e.jsx("nav",{className:`${m.itemsWrapper}`,children:t.map((h,f)=>Qp({i:f,item:h,themeOptions:c,subMenuActivate:d}))}),r]}),i==="side"?"":e.jsx("div",{className:`${m.topnavWrapper} md:hidden`,children:e.jsxs("div",{className:`${m.topnavContent} justify-between`,children:[e.jsx("div",{children:n}),e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:`${m.topmenuRightNavContainer}`,children:r}),e.jsxs("button",{type:"button",className:m.mobileButton,onClick:()=>a(!l),children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),e.jsx("div",{className:"flex justify-center items-center text-2xl",children:e.jsx("span",{className:l?m.menuCloseIcon:m.menuOpenIcon})})]})]})]})})]})},Yw=t=>{const[s,n]=b.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(Kw,{...t,open:s,toggle:n}),t.mobile==="side"?e.jsx(qw,{open:s,toggle:n,...t}):e.jsx(Xp,{open:s,...t,themeOptions:{}})]})},Zw=(t,s=100)=>{let n,r;return()=>{const a=+new Date;!!n&&a<n+s?(clearTimeout(r),r=setTimeout(()=>{n=a,t()},s)):(n=a,t())}};function Xw(t,s){return t.length===s.length&&t.every((n,r)=>n===s[r])}class yV extends w.Component{static get propTypes(){return{items:Le.arrayOf(Le.string).isRequired,currentClassName:Le.string.isRequired,scrolledPastClassName:Le.string,style:Le.object,componentTag:Le.oneOfType([Le.string,Le.elementType]),offset:Le.number,rootEl:Le.string,onUpdate:Le.func}}static get defaultProps(){return{items:[],currentClassName:"",style:{},componentTag:"ul",offset:1e3,onUpdate(){}}}constructor(s){super(s),this.state={targetItems:[],inViewState:[],isScrolledPast:[]},this._handleSpy=this._handleSpy.bind(this)}_initSpyTarget(s){return s.map(r=>document.getElementById(r))}_fillArray(s,n){let r=[];for(let a=0,l=s.length;a<l;a++)r[a]=n;return r}_isScrolled(){return this._getScrollDimension().scrollTop>0}_getScrollDimension(){const s=document,{rootEl:n}=this.props,r=n?s.querySelector(n).scrollTop:s.documentElement.scrollTop||s.body.parentNode.scrollTop||s.body.scrollTop,a=n?s.querySelector(n).scrollHeight:s.documentElement.scrollHeight||s.body.parentNode.scrollHeight||s.body.scrollHeight;return{scrollTop:r,scrollHeight:a}}_getElemsViewState(s){let n=[],r=[],a=[];const l=s||this.state.targetItems;let i=!1;for(let c=0,d=l.length;c<d;c++){let u=l[c],p=i?!1:this._isInView(u);p?(i=!0,n.push(u)):r.push(u);const m=c===d-1,h=this._isScrolled();this._isAtBottom()&&this._isInView(u)&&!p&&m&&h&&(r.pop(),r.push(...n),n=[u],a=this._fillArray(a,!1),p=!0),a.push(p)}return{inView:n,outView:r,viewStatusList:a,scrolledPast:this.props.scrolledPastClassName&&this._getScrolledPast(a)}}_isInView(s){if(!s)return!1;const{rootEl:n,offset:r}=this.props;let a;n&&(a=document.querySelector(n).getBoundingClientRect());const l=s.getBoundingClientRect(),i=n?a.height:window.innerHeight,{scrollTop:c}=this._getScrollDimension(),d=c+i,u=n?l.top+c-a.top+r:l.top+c+r,p=u+s.offsetHeight;return u<d&&p>c}_isAtBottom(){const{rootEl:s}=this.props,{scrollTop:n,scrollHeight:r}=this._getScrollDimension(),a=s?document.querySelector(s).getBoundingClientRect().height:window.innerHeight;return n+a>=r}_getScrolledPast(s){if(!s.some(a=>a))return s;let n=!1;return s.map(a=>a&&!n?(n=!0,!1):!n)}_spy(s){const n=this._getElemsViewState(s),r=this.state.inViewState;this.setState({inViewState:n.viewStatusList,isScrolledPast:n.scrolledPast},()=>{this._update(r)})}_update(s){Xw(this.state.inViewState,s)||this.props.onUpdate(this.state.targetItems[this.state.inViewState.indexOf(!0)])}_handleSpy(){Zw(this._spy(),100)}_initFromProps(){const s=this._initSpyTarget(this.props.items);this.setState({targetItems:s}),this._spy(s)}offEvent(){(this.props.rootEl?document.querySelector(this.props.rootEl):window).removeEventListener("scroll",this._handleSpy)}onEvent(){(this.props.rootEl?document.querySelector(this.props.rootEl):window).addEventListener("scroll",this._handleSpy)}componentDidMount(){this._initFromProps(),this.onEvent()}componentWillUnmount(){this.offEvent()}UNSAFE_componentWillReceiveProps(){this._initFromProps()}render(){const s=this.props.componentTag,{children:n,className:r,scrolledPastClassName:a,style:l}=this.props;let i=0;const c=w.Children.map(n,(u,p)=>{if(!u)return null;const m=u.type,h=a&&this.state.isScrolledPast[p],f=pi({[`${u.props.className}`]:u.props.className,[`${this.props.currentClassName}`]:this.state.inViewState[p],[`${this.props.scrolledPastClassName}`]:h});return b.createElement(m,{...u.props,className:f,key:i++},u.props.children)}),d=pi({[`${r}`]:r});return e.jsx(s,{className:d,style:l,children:c})}}const Qw=({children:t,open:s,themeOptions:n})=>{const r=st().modal(n);return e.jsxs("div",{style:{display:s?"flex":"none"},className:`${r.modalContainer} `,children:[e.jsx("div",{className:`${r.modalOverlay}`}),e.jsx("div",{className:`${r.modal}`,children:t})]})},e2=({open:t=!1,className:s="",style:n={},...r})=>{const a=st();return e.jsx("div",{...r,className:`
        flex items-center rounded cursor-pointer ${a.textInfo}
        ${t?a.borderInfo:"border-transparent"}
        hover:${a.borderInfo} ${a.transition}
        flex items-center justify-center ${s}
      `,style:{width:"2.5rem",height:"2.5rem",borderRadius:"1.25rem",fontSize:"1.15rem",borderWidth:"3px",...n},children:e.jsx("span",{className:"fas fa-user"})})},t2=fr(({user:t})=>{const[s,n]=w.useState(!1),r=w.useCallback(u=>{n(p=>!p)},[]),a=w.useCallback(()=>n(!1),[]),[l]=Kp(a),i=st(),{UserMenuItems:c,TopUserMenuControl:d}=el();return t?t.authed?e.jsxs("div",{className:"relative",ref:l,children:[e.jsx(d,{open:s,onClick:r}),s?e.jsx("div",{className:`
              ${i.menuBg} ${i.menuText}
              p-2 right-0 absolute
            `,style:{top:"100%",minWidth:"8rem"},children:e.jsx(c,{toggle:r})}):null]}):e.jsx(je,{to:"/auth/login",children:e.jsx(d,{})}):null}),s2=({open:t=!1,label:s="",className:n="",style:r=null,...a})=>{const l=st();return e.jsxs("div",{...a,className:`
        w-full py-1 pl-4 transition cursor-pointer
        ${l.menuBgHover} ${l.menuTextHover} ${n}
      `,style:r,children:[e.jsx("span",{className:"fas fa-user mr-2"}),s]})},n2=fr(({user:t})=>{const[s,n]=w.useState(!1),r=w.useCallback(()=>{n(u=>!u)},[]),a=w.useCallback(()=>n(!1),[]),[l]=Kp(a),i=st(),{SideUserMenuControl:c,UserMenuItems:d}=el();return t?e.jsx("div",{className:"pb-6",children:t.authed?e.jsxs("div",{className:"relative",ref:l,children:[e.jsx(c,{label:"User Menu",open:s,onClick:r}),s?e.jsx("div",{className:`
                  ${i.menuBg} ${i.menuText} mt-1 p-2 left-0 absolute
                `,style:{bottom:"100%",minWidth:"8rem"},children:e.jsx(d,{toggle:r})}):null]}):e.jsx(je,{to:"/auth/login",children:e.jsx(c,{label:"Login"})})}):null}),a2=fr(({user:t={},toggle:s})=>{const{UserMenuSeparator:n,UserMenuItem:r}=el();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 border-b-2",children:t.email}),e.jsx(r,{to:"/auth/profile",toggle:s,children:"Profile"}),C(t,"authLevel",-1)<5?null:e.jsx(r,{to:"/auth/project-management",toggle:s,children:"Project Management"}),e.jsx(n,{}),e.jsx(r,{to:"/auth/logout",toggle:s,children:"Logout"})]})}),r2=({to:t="#",toggle:s,children:n})=>{const r=st();return e.jsx("div",{onClick:s,children:e.jsx(je,{to:t,children:e.jsx("div",{className:`
          rounded cursor-pointer px-2 whitespace-nowrap
          ${r.menuBg} ${r.menuBgHover}
          ${r.menuText} ${r.menuTextHover}
        `,children:n})})})},o2=()=>e.jsx("div",{className:"border my-1"});let l2=-1;const i2=()=>`list-${++l2}`,c2=({children:t,...s})=>{const[n,r]=w.useState(!1);return w.useEffect(()=>{const a=requestAnimationFrame(()=>r(!0));return()=>{cancelAnimationFrame(a),r(!1)}},[]),n?e.jsx(Gb,{...s,children:t}):null},d2=({id:t,index:s,children:n})=>e.jsx(Jb,{draggableId:`draggable-${t}`,index:s,children:r=>e.jsx("div",{ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,style:{...r.draggableProps.style,left:"auto !important",top:"auto !important"},children:n})}),Wn=({onDrop:t,children:s,offset:n={x:0,y:0},className:r=""})=>{const a=w.useCallback(i=>{if(!i.destination)return;const c=i.source.index,d=i.destination.index;c!==d&&t(c,d)},[t]),l=st();return w.Children.toArray(s).length?e.jsx(Wb,{onDragEnd:a,children:e.jsx(c2,{droppableId:i2(),className:"box-content",children:(i,c)=>e.jsxs("div",{ref:i.innerRef,...i.droppableProps,className:`flex flex-col
                  ${c.isDraggingOver?l.listDragging:l.list}
                  ${r}
                `,children:[w.Children.toArray(s).map((d,u)=>e.jsx(d2,{id:d.key,index:u,children:d},d.key)),i.placeholder]})})}):null};Wn.defaultProps={items:[],idAccessor:t=>t.id,indexAccessor:t=>t.index,onDrop:(t,s)=>{}};w.createContext({});w.forwardRef(({open:t,transitioning:s,width:n,padding:r,children:a,heightFull:l=!0},i)=>{const c=st(),d=l?"h-full":"";return e.jsx("div",{className:`${d} w-full`,ref:i,style:{overflow:t&&!s?"visible":"hidden"},children:e.jsxs("div",{className:`${d} scrollbar-sm overflow-y-auto`,style:{width:`${n-r*2}px`},children:[e.jsx("div",{className:`
          absolute top-0 right-0 bottom-0 left-0 pointer-events-none z-10
          ${t?"opacity-0":"opacity-100"} ${c.sidebarBg}
        `,style:{transition:"opacity 500ms"}}),a]})})});Object.keys(Ya).sort((t,s)=>+t-+s);const u2={TopUserMenu:t2,TopUserMenuControl:e2,SideUserMenu:n2,SideUserMenuControl:s2,UserMenuItem:r2,UserMenuSeparator:o2,UserMenuItems:a2},m2=w.createContext(u2),el=()=>w.useContext(m2);w.memo(({color:t,position:s="fixed",className:n="",scale:r=1})=>e.jsx("div",{className:`
    ${s} left-0 top-0 right-0 bottom-0
    flex justify-center items-center z-50 bg-black opacity-50
    ${n}
  `,children:e.jsx(go,{scale:r,color:t})}));function p2(){return new qo}function h2(){return new qo}var Hd=Object.prototype.hasOwnProperty,zd=function(){};function hi(){}hi.create=function(t){var s=new hi;return s.subscribe=function(n,r,a){var l,i;return typeof n=="function"?l={onNext:n,onError:r||zd,onCompleted:a||zd}:l=n,i=t(l),typeof i=="function"?{dispose:i}:i},s};function _l(t,s,n){return hi.create(function(a){var l={method:t||"GET",crossDomain:!1,async:!0,headers:{},responseType:"json"},i,c,d,u,p;for(p in s)Hd.call(s,p)&&(l[p]=s[p]);!l.crossDomain&&!l.headers["X-Requested-With"]&&(l.headers["X-Requested-With"]="XMLHttpRequest"),n.onBeforeRequest!=null&&n.onBeforeRequest(l);try{i=l.crossDomain?h2():p2()}catch(m){a.onError(m)}try{l.user?i.open(l.method,l.url,l.async,l.user,l.password):i.open(l.method,l.url,l.async),i.timeout=l.timeout,i.withCredentials=l.withCredentials!==!1,d=l.headers;for(u in d)Hd.call(d,u)&&i.setRequestHeader(u,d[u]);if(l.responseType)try{i.responseType=l.responseType}catch(m){if(l.responseType!=="json")throw m}i.onreadystatechange=function(h){i.readyState===4&&(c||(c=!0,f2(a,i,h)))},i.ontimeout=function(h){c||(c=!0,g2(a,i,"timeout error",h))},i.send(l.data)}catch(m){a.onError(m)}return function(){!c&&i.readyState!==4&&(c=!0,i.abort())}})}function ea(t,s,n){n||(n=new Error(s)),t.onError(n)}function f2(t,s,n){var r,a;if(s&&t){a=s.responseType,r="response"in s?s.response:s.responseText;var l=s.status===1223?204:s.status;if(l>=200&&l<=399){try{a!=="json"&&(r=JSON.parse(r||"")),typeof r=="string"&&(r=JSON.parse(r||""))}catch(i){ea(t,"invalid json",i)}t.onNext(r),t.onCompleted();return}else return l===401||l===403||l===407||l===410||l===408||l===504?ea(t,r):ea(t,r||"Response code "+l)}}function g2(t,s,n,r){ea(t,n||s.statusText||"request error",r)}function x2(t,s,n){var r=[],a,l={url:t},i=t.indexOf("?")!==-1,c=i?"&":"?";return typeof n=="string"?r.push(n):(a=Object.keys(n),a.forEach(function(d){var u=typeof n[d]=="object"?JSON.stringify(n[d]):n[d];r.push(d+"="+encodeURIComponent(u))})),s==="GET"?l.url+=c+r.join("&"):l.data=r.join("&"),l}function ta(t,s){var n;for(n in s)t[n]=s[n];return t}function Mn(t,s){if(this._jsongUrl=t,typeof s=="number"){var n={timeout:s};s=n}this._config=ta({timeout:15e3,headers:{}},s||{})}Mn.prototype={constructor:Mn,buildQueryObject:x2,get:function(s){var n="GET",r=this.buildQueryObject(this._jsongUrl,n,{paths:s,method:"get"}),a=ta(r,this._config),l=this;return _l(n,a,l)},set:function(s){var n="POST",r,a;!this._config.headers||!this._config.headers["Content-Type"]||!this._config.headers["Content-Type"].match(/application\/json/)?(a=this.buildQueryObject(this._jsongUrl,n,{jsonGraph:s,method:"set"}),r=ta(a,this._config),r.headers["Content-Type"]="application/x-www-form-urlencoded"):r=ta({url:this._jsongUrl,data:JSON.stringify({jsonGraph:JSON.stringify(s),method:"set"})},this._config);var l=this;return _l(n,r,l)},call:function(s,n,r,a){n=n||[],r=r||[],a=a||[];var l="POST",i,c=[],d;!this._config.headers||!this._config.headers["Content-Type"]||!this._config.headers["Content-Type"].match(/application\/json/)?(c.push("method=call"),c.push("callPath="+encodeURIComponent(JSON.stringify(s))),c.push("arguments="+encodeURIComponent(JSON.stringify(n))),c.push("pathSuffixes="+encodeURIComponent(JSON.stringify(r))),c.push("paths="+encodeURIComponent(JSON.stringify(a))),d=this.buildQueryObject(this._jsongUrl,l,c.join("&")),i=ta(d,this._config),i.headers["Content-Type"]="application/x-www-form-urlencoded"):i=ta({url:this._jsongUrl,data:JSON.stringify({method:"call",callPath:JSON.stringify(s),arguments:JSON.stringify(n),pathSuffixes:JSON.stringify(r),paths:JSON.stringify(a)})},this._config);var u=this;return _l(l,i,u)}};Mn.XMLHttpSource=Mn;Mn.default=Mn;Promise.map=function(t,s,n={}){let r=n.concurrency||1/0,a=0;const l=[],i=[],c=t[Symbol.iterator]();for(;r-- >0;){const u=d();if(u)i.push(u);else break}return Promise.all(i).then(()=>l);function d(){const u=c.next();if(u.done)return null;const p=a++,m=s(u.value,p);return Promise.resolve(m).then(h=>(l[p]=h,d()))}};class b2 extends Mn{onBeforeRequest(s){if(window&&window.localStorage){const n=window.localStorage.getItem("userToken");n&&(s.headers.Authorization=n)}}}function y2(){return{}}const v2=()=>{},j2=(t,s,n={})=>{const{placeholder:r="replace_me",chunkSize:a=100}=n,l=[];for(let i=0;i<t.length;i+=a)l.push(s.map(c=>c===r?t.slice(i,i+a):c));return l.length?l:[s]},w2=(t,s={})=>{const{falcor:n,onProgress:r=v2,concurrency:a=5,...l}=s,i=mc(r,50);let c=0,d=0,u=t.reduce((p,[m,h])=>{const f=j2(m,h,l);return d+=f.length,p.push(...f),p},[]);return Promise.map(u,p=>n.get(p).then(()=>{i(++c,d)}),{concurrency:a})},eh=t=>t.reduce((s,n)=>(Array.isArray(n)?s[0].push(n):s[1]=n,s),[[],{}]),N2=(...t)=>{const[s,n]=eh(t),{index:r=null,placeholder:a="replace_me",...l}=n,i=s.reduce((c,d)=>{let u=[],p=!1;const m=d.map((h,f)=>Array.isArray(h)&&h.length&&!p&&(r===null||r===f)?(p=!0,u=h,a):h);return c.push([u,m]),c},[]);return w2(i,{...l,placeholder:a})};class C2 extends dp{constructor(...s){super(...s),this.listeners=[],this.onChange=this.onChange.bind(this),this.listen=this.listen.bind(this),this.unlisten=this.unlisten.bind(this)}onChange(){this.listeners.forEach(s=>s())}listen(s){this.listeners.includes(s)||this.listeners.push(s)}unlisten(s){this.listeners=this.listeners.filter(n=>n!==s)}}class _2 extends up.Model{constructor(...s){super(...s),this.onChange=this.onChange.bind(this),this.remove=this.remove.bind(this),this.chunk=this.chunk.bind(this)}onChange(s,n){this._root.listen(s,n)}remove(s){this._root.unlisten(s)}get(...s){return super.get(...s).then(n=>n)}call(...s){return super.call(...s).then(n=>n)}chunk(...s){const[n,r]=eh(s);return N2(...n,{falcor:this,...r})}}const S2=t=>new _2({_root:new C2,source:new b2(t+"/graph",{crossDomain:!0,withCredentials:!1,timeout:12e4}),errorSelector:(s,n)=>(console.log("errorSelector",s,n),n),cache:y2()});S2("https://graph.availabs.org");const th=w.createContext(),Na=()=>w.useContext(th);th.Consumer;const $2=()=>{const t="nuetral",s="white",n="blue";return{graphColors:["#1e40af","#93c5fd","#1d4ed8","#bfdbfe"],graphCategorical:["#fde72f","#95d840","#55a488","#2f708e","#453781","#472354"],sidenav:(r={})=>{const{color:a="white",size:l="compact",subMenuStyle:i="inline",responsive:c="top"}=r;let d={top:"hidden md:block",side:"hidden md:block",none:""},u={white:{contentBg:`bg-${s}`,contentBgAccent:"bg-neutral-100",accentColor:`${n}-600`,accentBg:`hover:bg-${n}-400`,borderColor:`border-${t}-100`,textColor:`text-${t}-600`,textColorAccent:"text-slate-800",highlightColor:`text-${t}-800`},transparent:{contentBg:"bg-neutral-100",contentBgAccent:"bg-neutral-100",accentColor:`${n}-600`,accentBg:`hover:bg-${n}-400`,borderColor:`border-${t}-100`,textColor:`text-${t}-600`,textColorAccent:"text-slate-800",highlightColor:`text-${t}-800`},dark:{contentBg:"bg-neutral-800",contentBgAccent:"bg-neutral-900",accentColor:"white",accentBg:"",borderColor:"border-neutral-700",textColor:"text-slate-300",textColorAccent:"text-slate-100",highlightColor:`text-${s}`},bright:{contentBg:`bg-${n}-700`,accentColor:`${n}-400`,accentBg:`hover:bg-${n}-400`,borderColor:`border-${n}-600`,textColor:`text-${s}`,highlightColor:`text-${s}-500`}},p={none:{wrapper:"w-0 overflow-hidden",sideItem:"flex mx-2 pr-4 py-2 text-base ",topItem:"flex items-center text-sm px-4 border-r h-12",icon:"mr-3 text-lg"},compact:{fixed:"ml-0 md:ml-44",wrapper:"w-44 p-1 pt-4",sideItem:"flex mx-2 pr-4 py-2 text-base ",topItem:"flex items-center text-sm px-4 border-r h-12",icon:"mr-3 text-lg"},full:{fixed:"",wrapper:"w-full",sideItem:"flex px-4 py-2 text-base font-base border-b ",topItem:"flex pr-4 py-2 text-sm font-light",icon:"mr-4 text-2xl"},mini:{fixed:"ml-0 md:ml-20",wrapper:"w-20 overflow-x-hidden p-1 pt-4",sideItem:"flex pr-4 py-4 text-base font-base border-b",topItem:"flex px-4 items-center text-sm font-light ",icon:"w-20 mr-4 text-4xl",sideItemContent:"hidden"},micro:{fixed:"ml-0 md:ml-14",wrapper:"w-14 overflow-x-hidden",itemWrapper:"p-1",sideItem:"flex text-base font-base",topItem:"flex mx-6 pr-4 py-2 text-sm font-light",icon:"w-12 text-2xl hover:bg-neutral-900 px-2 py-3 my-2 rounded-lg mr-4 hover:text-blue-500",sideItemContent:"hidden"}},m={inline:{indicatorIcon:"fa fa-angle-right",indicatorIconOpen:"fa fa-angle-down",subMenuWrapper:"w-full",subMenuParentWrapper:"flex flex-col w-full"},flyout:{indicatorIcon:"fa fa-angle-down",indicatorIconOpen:"fa fa-angle-right",subMenuWrapper:`absolute ml-${p[l].width-8}`,subMenuParentWrapper:"flex flex-row",subMenuWrapperTop:"absolute top-full"}};return{fixed:`md:${p[l].fixed}`,logoWrapper:`${p[l].wrapper} ${u[a].contentBgAccent} ${u[a].textColorAccent}`,sidenavWrapper:`${d[c]} ${u[a].contentBg} ${p[l].wrapper} h-full z-20`,menuIconSide:` text-${u[a].accentColor} ${p[l].icon} group-hover:${u[a].highlightColor}`,itemsWrapper:`${u[a].borderColor} ${p[l].itemWrapper}  `,navitemSide:`
            group font-sans flex flex-col
            ${p[l].sideItem} ${u[a].textColor} ${u[a].borderColor}
            hover:${u[a].highlightColor}
            focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
            transition-all cursor-pointer
         `,navItemContent:`${p[l].sideItemContent}`,navitemSideActive:`
            group font-sans flex flex-col
            ${p[l].sideItem} text-blue-500 ${u[a].borderColor}
            hover:${u[a].highlightColor}
            focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
            transition-all cursor-pointer
          `,...m[i],vars:{colors:u,sizes:p,mobile:d}}},topnav:({color:r="white",size:a="compact"})=>{let l={white:{contentBg:"bg-gradient-to-r from-[#f8f4ec] to-[#fefefe]",accentColor:"[#da4e00]",accentBg:"hover:bg-[#da4e00]",borderColor:`border-${t}-100`,textColor:`text-${t}-500`,highlightColor:`text-${s}`},bright:{contentBg:`bg-${n}-700`,accentColor:`${n}-400`,accentBg:`hover:bg-${n}-400`,borderColor:`border-${n}-600`,textColor:`text-${s}`,highlightColor:`text-${s}`}},i={compact:{menu:"hidden md:flex flex-1 justify-end",sideItem:"flex mx-6 pr-4 py-2 text-sm font-light hover:pl-4",topItem:`flex items-center text-lg  font-medium px-8  h-16 ${l[r].textColor} ${l[r].borderColor}
            ${l[r].accentBg} hover:${l[r].highlightColor}`,activeItem:`flex items-center text-lg  font-medium px-8 border-b border-[#da4e00]  h-16 ${l[r].textColor} ${l[r].borderColor}
            ${l[r].accentBg} hover:${l[r].highlightColor}`,icon:"mr-3 text-md fa-fw",responsive:"md:hidden"},inline:{menu:"flex flex-1",sideItem:"flex mx-4 pr-4 py-4 text-base font-base border-b hover:pl-4",topItem:`flex px-4 py-2 mx-2 font-medium text-gray-400 border-b-2 ${l[r].textColor} ${l[r].borderColor}
          hover:border-gray-300 hover:text-gray-700 border-gray-100 `,activeItem:`flex px-4 py-2 mx-2 font-medium text-blue-600 border-b-2 ${l[r].textColor} ${l[r].borderColor} border-blue-600 `,icon:"mr-4 text-2xl",responsive:"hidden"}};return{topnavWrapper:`w-full ${l[r].contentBg} `,topnavContent:"flex w-full h-full",topnavMenu:`${i[a].menu} h-full overflow-x-auto overflow-y-hidden scrollbar-sm`,menuIconTop:`text-[#da4e00] ${i[a].icon} group-hover:${l[r].highlightColor}`,menuOpenIcon:"fa fa-bars",menuCloseIcon:'fa fa-xmark fa-fw"',navitemTop:`
            group font-sans
            ${i[a].topItem}
            focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
            transition cursor-pointer
        `,topmenuRightNavContainer:"hidden md:block h-full",navitemTopActive:` group font-sans
            ${i[a].activeItem}
            focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
            transition cursor-pointer
          `,mobileButton:`${i[a].responsive} ${l[r].contentBg} inline-flex items-center justify-center p-2  text-gray-400 hover:bg-gray-100 `,vars:{colors:l,sizes:i}}},select:(r={})=>{const{color:a="white"}=r;let l={white:"white",transparent:"gray-100 border border-gray-200 shadow-sm"};return{menuWrapper:`bg-${l[a]} my-1`,menuItemActive:`px-4 py-2 cursor-not-allowed bg-${n}-200 border-1 focus:border-${n}-300`,menuItem:`px-4 py-2 cursor-pointer hover:bg-blue-100 border-1 border-${l[a]} focus:border-blue-300`,select:`bg-${l[a]} w-full flex flex-row flex-wrap justify-between px-4 py-2 cursor-pointer focus:border-blue-300`,selectIcon:"fal fa-angle-down text-gray-400 pt-2"}},table:(r={})=>{const{color:a="white",size:l="full"}=r;let i={white:"bg-white hover:bg-gray-100",gray:"bg-gray-100 hover:bg-gray-200",transparent:"gray-100"},c={compact:"px-2 ",full:"px-6 py-2"};return{tableHeader:`${c[l]} pb-1 h-8 border border-b-4 border-gray-200 bg-white text-left font-medium text-gray-700 uppercase first:rounded-tl-md last:rounded-tr-md capitalize`,tableInfoBar:"bg-white",tableRow:`${i[a]} transition ease-in-out duration-150 hover:bg-blue-100`,tableRowStriped:"bg-white odd:bg-gray-100 hover:bg-gray-200 transition ease-in-out duration-150",tableCell:`${c[l]} break-words border border-gray-200 align-center font-light text-sm`,inputSmall:"w-24",sortIconDown:"fas fa-sort-amount-down text-gray-500 opacity-75",sortIconUp:"fas fa-sort-amount-up text-gray-500 opacity-75",sortIconIdeal:"fa fa-bars text-gray-500 opacity-25",downloadIcon:"fa fa-download text-sm",downloadWrapper:"text-blue-300 hover:text-blue-500",vars:{color:i,size:c}}},tabpanel:(r={})=>{const{tabLocation:a="top"}=r;let l={top:{tabpanelWrapper:"flex-col",tabWrapper:"flex-row",tab:"border-b-2"},left:{tabpanelWrapper:"flex-row",tabWrapper:"flex-col",tab:"border-r-2"}};return{tabpanelWrapper:`flex ${l[a].tabpanelWrapper} w-full h-full`,tabWrapper:`flex ${l[a].tabWrapper}`,tab:"px-4 py-2 hover:text-gray-800 cursor-pointer   text-center text-gray-500",tabActive:`px-4 py-2 text-${n}-500 ${l[a].tab} border-blue-500 text-center`,icon:"",tabName:"",contentWrapper:"bg-white flex-1 h-full",vars:{tabLocation:l}}},button:(r={})=>{const{color:a="white",size:l="base",width:i="block"}=r;let c={white:`
                    border border-gray-300  text-gray-700 bg-white hover:text-gray-500
                    focus:outline-none focus:shadow-outline-blue focus:border-blue-300
                    active:text-gray-800 active:bg-gray-50 transition duration-150 ease-in-out
                    disabled:cursor-not-allowed
                `,cancel:`
                    border border-red-300  text-red-700 bg-white hover:text-red-500
                    focus:outline-none focus:shadow-outline-blue focus:border-blue-300
                    active:text-red-800 active:bg-gray-50 transition duration-150 ease-in-out
                    disabled:cursor-not-allowed
                `,transparent:`
                    border border-gray-300  text-gray-700 bg-white hover:text-gray-500
                    focus:outline-none focus:shadow-outline-blue focus:border-blue-300
                    active:text-gray-800 active:bg-gray-50 transition duration-150 ease-in-out
                    disabled:cursor-not-allowed
                `,primary:`
                    border border-transparent shadow 
                    text-sm leading-4 rounded-sm text-white bg-blue-600 hover:bg-blue-700 
                    focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`,danger:""},d={base:"px-4 py-4 leading-5 font-medium",sm:"text-sm px-2 py-2 leading-5 font-medium",lg:"text-lg px-6 py-6 leading-5 font-medium",xl:"text-2xl px-12 py-8 leading-5 font-medium"},u={block:"",full:"w-full"};return{button:`
                  ${c[a]} ${d[l]} ${u[i]}
                `,vars:{color:c,size:d,width:u}}},input:(r={})=>{const{color:a="white",size:l="small",width:i="block"}=r;let c={white:"bg-white",gray:"bg-gray-100"},d={base:"px-4 py-4 font-medium",small:"text-sm px-2 py-2 font-medium text-xs",large:"text-lg px-6 py-6 font-medium text-xl"},u={block:"",full:"w-full"};return{input:`
                 ${c[a]} ${d[l]} ${u[i]}
                `,vars:{color:c,size:d,width:u}}},modal:(r={})=>{const{size:a="base",overlay:l="default"}=r;let i={default:"fixed  inset-0 bg-gray-500 opacity-75",none:""},c={base:"sm:max-w-2xl",small:"w-64",large:"sm:max-w-5xl",xlarge:"sm:max-w-8xl"};return{modalContainer:`${l==="default"?"":"pointer-events-none"} fixed bottom-0 inset-x-0 px-4 pb-4 inset-0 flex items-center justify-center`,modalOverlay:i[l],modal:`${c[a]} w-full  pointer-events-auto bg-white rounded-lg overflow-hidden shadow-xl transform transition-all`,vars:{size:c,overlay:i}}},shadow:"shadow",ySpace:"py-4",text:"text-gray-800",textContrast:"text-white",border:"broder-gray-400",textInfo:"text-blue-400",bgInfo:"bg-blue-400",borderInfo:"border-blue-400",textSuccess:"text-blue-400",bgSuccess:"bg-blue-400",borderSuccess:"border-blue-400",textDanger:"text-red-400",bgDanger:"bg-red-400",borderDanger:"border-red-400",textWarning:"text-yellow-400",bgWarning:"bg-yellow-400",borderWarning:"border-yellow-400",textLight:"text-gray-400",placeholder:"placeholder-gray-400",topMenuBorder:"border-b border-gray-200",topMenuScroll:"",headerShadow:"",navText:"text-gray-100",navMenu:"h-full relative",navMenuOpen:"bg-darkblue-500 text-white shadow-lg w-56 rounded-t-lg",navMenuBg:"bg-darkblue-500 bb-rounded-10 shadow-lg text-white rounded-b-lg",navMenuItem:"hover:font-medium cursor-pointer px-2 py-1 text-lg font-semibold",bg:"bg-gray-50",menuBg:"bg-white z-50",menuBgHover:"",menuBgActive:"bg-blue-200",menuBgActiveHover:"hover:bg-blue-300",menuText:"text-gray-100",menuTextHover:"hover:text-gray-700",menuTextActive:"text-blue-500",menuTextActiveHover:"hover:text-blue-700",headerBg:"bg-gray-200",headerBgHover:"hover:bg-gray-400",inputBg:"bg-white disabled:bg-gray-200 cursor-pointer focus:outline-none",inputBorder:"rounded border-0 border-transparent hover:border-gray-300 focus:border-gray-600 disabled:border-gray-200",inputBgDisabled:"bg-gray-200 cursor-not-allowed focus:outline-none",inputBorderDisabled:"rounded border-2 border-gray-200 hover:border-gray-200",inputBgFocus:"bg-white cursor-pointer focus:outline-none",inputBorderFocus:"rounded border-2 border-transparent hover:border-gray-600 focus:border-gray-600 border-gray-600",textBase:"text-base",textSmall:"text-sm",textLarge:"text-lg",paddingBase:"py-1 px-2",paddingSmall:"py-0 px-1",paddingLarge:"py-2 px-4",contentBg:"bg-white",accent1:"bg-blue-100",accent2:"bg-gray-300",accent3:"bg-gray-400",accent4:"bg-gray-500",highlight1:"bg-blue-200",highlight2:"bg-blue-300",highlight3:"bg-blue-400",highlight4:"bg-blue-500",width:"",transition:"transition ease-in-out duration-150",tableRow:"bg-gray-100 hover:bg-gray-200 transition ease-in-out duration-150",tableRowStriped:"bg-gray-100 even:bg-gray-200 hover:bg-gray-300 transition ease-in-out duration-150",tableCell:"px-4 py-1 whitespace-no-wrap",tableHeader:"px-4 py-2 pb-1 border-b-2 border-gray-300 bg-gray-200 text-left font-medium text-gray-700 uppercase first:rounded-tl-md last:rounded-tr-md"}},E2=$2(),k2="hazard_mitigation";let sh="https://graph.availabs.org",L2="https://availauth.availabs.org",I2="transportny.org",Rt="https://graph.availabs.org";const T2=({user:t})=>e.jsxs("div",{className:"flex justify-column align-middle py-1 px-4",children:[e.jsx("div",{className:"pt-[4px]",children:e.jsx("span",{className:`rounded-full border-2 border-blue-400
                    inline-flex items-center justify-center 
                    h-6 w-6 sm:h-8 sm:w-8 ring-white text-white 
                    bg-blue-500 overflow-hidden`,children:e.jsx("i",{className:"fa-duotone fa-user fa-fw pt-2 text-2xl","aria-hidden":"true"})})}),e.jsxs("span",{className:"pl-2",children:[e.jsx("div",{className:"text-md font-thin tracking-tighter  text-left text-blue-600 group-hover:text-white ",children:t.email?t.email:""}),e.jsx("div",{className:"text-xs font-medium -mt-1 tracking-widest text-left text-gray-500 group-hover:text-gray-200",children:t.groups[0]?t.groups[0]:""})]})]}),Rs=(t,s,n,r)=>r===void 0||r?e.jsx(je,{to:t,children:e.jsx("div",{className:"px-6 py-1 bg-blue-500 text-white hover:text-blue-100",children:e.jsxs("div",{className:"hover:translate-x-2 transition duration-100 ease-out hover:ease-in",children:[e.jsx("i",{className:`${s} `}),e.jsx("span",{className:"pl-2",children:n})]})})}):null,nh=fr(({title:t,shadowed:s=!0,user:n,children:r})=>{const a=st(),l=kt();return e.jsx("div",{className:"h-full w-fit",children:n.authed?e.jsx(Cc,{control:e.jsx(T2,{user:n}),className:"hover:bg-blue-500 group ",children:e.jsxs("div",{className:"p-1 bg-blue-500",children:[n.authLevel>=5?e.jsxs("div",{className:"py-2",children:[e.jsx("div",{className:"",children:Rs("/manage/templates","fad fa-screwdriver-wrench fa-fw flex-shrink-0  pr-1","Templates")}),e.jsx("div",{className:"",children:Rs("/cenrep","fad fa-database fa-fw flex-shrink-0  pr-1","Cen Rep")}),e.jsx("div",{className:"",children:Rs("/edit","fad fa-money-check-pen fa-fw flex-shrink-0  pr-1","Edit Site")})]}):"",e.jsx("div",{className:"py-1 border-t border-blue-400",children:Rs("/auth/logout","fad fa-sign-out-alt pb-2 pr-1","Logout")})]})}):e.jsx(je,{className:`${a.topnav({}).navitemTop}`,to:"/auth/login",state:{from:l==null?void 0:l.pathname},children:"Login"})})}),fi=({sideNav:t})=>e.jsx(e.Fragment,{children:e.jsx(je,{to:"/",className:"flex  items-center h-full",children:e.jsx("div",{className:"h-full pl-4 pr-2 flex items-center ",children:e.jsx("span",{className:"font-bold text-lg tracking-wider px-12",children:" Hazard Data"})})})});let M2={none:"",micro:"mr-14",mini:"mr-20",miniPad:"mr-0",compact:"mr-44",full:"mr-64"},B2={none:"",micro:"w-14",mini:"w-20",miniPad:"w-0",compact:"w-44",full:"w-64"};const A2=({children:t,menus:s,sideNav:n={},topNav:r={},title:a})=>{st();const l={size:n.size||"none",color:n.color||"dark",menuItems:n.menuItems||s},i={position:r.position||"block",size:r.size||"compact",menu:r.menu||"left",subMenuStyle:r.subMenuStyle||"row",menuItems:(r.menuItems||[]).filter(c=>!c.hideInNav),logo:r.logo||e.jsxs("div",{className:"flex items-center justify-center h-12",children:[e.jsx("div",{to:"/",className:`${["none"].includes(l.size)?"":"md:hidden"}`,children:e.jsx(fi,{sideNav:l})}),a]})};return e.jsxs("div",{className:"flex",children:[l.size==="none"?"":e.jsx("div",{className:`hidden md:block ${M2[l.size]}`,children:e.jsx("div",{className:`fixed h-screen ${B2[l.size]}`,children:e.jsx(Yw,{topMenu:e.jsx(fi,{sideNav:l}),themeOptions:l,menuItems:l.menuItems})})}),e.jsxs("div",{className:"flex-1 flex items-start flex-col items-stretch min-h-screen w-full",children:[i.size==="none"?"":e.jsx(e.Fragment,{children:e.jsx("div",{className:`${i.position==="fixed"?"sticky top-0 z-20 w-full ":""}`,children:e.jsx(_c,{themeOptions:i,leftMenu:i.logo,menuItems:i.menuItems,rightMenu:e.jsx(nh,{})})})}),e.jsx("div",{id:"content",className:"h-full flex-1 bg-slate-100",children:t})]})]})},ah=(t,s)=>{const n=t.auth?0:(t==null?void 0:t.authLevel)||-1,r=n>-1&&!C(t,["user","authed"],!1),a=C(t,["user","authLevel"],-1)<n;return r?s("/auth/login",{state:{from:t.path}}):a&&s("/"),!1},O2=({children:t})=>{const s=kt();return b.useLayoutEffect(()=>{document.documentElement.scrollTo(0,0)},[s.pathname]),t},P2=Rp(({element:t,component:s,Layout:n=({children:a})=>e.jsx(e.Fragment,{children:a}),...r})=>{const a=t||s,l=$e(),i=kt(),{auth:c,authLevel:d,user:u}=r;return w.useEffect(()=>{ah({auth:c,authLevel:d,user:u},l)},[c,d,l,i]),e.jsx(O2,{children:e.jsx(n,{...r,children:e.jsx(a,{})})})});function D2(t,s){const n=t.filter(r=>r.mainNav);return t.map(r=>{let a=Ie(r);return a.element=e.jsx(P2,{...a,Layout:s,menus:n}),a})}const R2=t=>t.split(".").length>2||t.split(".").length>1?window.location.host.split(".")[0].toLowerCase():!1,rh="hazmit_dama",F2={children:[{type:"ams-login",path:"login",props:{title:"Hazard Data"}},{ype:"ams-reset-password",path:"reset-password",props:{title:"Hazard Data"}},{type:"ams-logout",path:"logout",props:{redirectTo:"/"}},{type:"ams-signup",path:"register",props:{title:"Hazard Data",addToGroup:"NPMRDS_PM3 New Users"}},{type:"ams-profile",path:"profile"},{type:"ams-verify-request",path:"verify-request"},{type:"ams-set-password",path:"set-password"},{type:"ams-accept-invite",path:"accept-invite"},{type:"ams-project-management",path:"project-management",props:{authLevel:5}}]},V2=Hj(F2,"/auth"),H2=[...V2];function z2(){return{landing:{wrapper:"p-4 border-2 border-blue-300"},table:{table:"min-w-full divide-y divide-gray-300",thead:"",th:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900",tbody:"divide-y divide-gray-200 ",td:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},text:{input:"px-2 py-1 w-full text-sm font-light border rounded-md focus:border-blue-300 bg-white focus:outline-none transition ease-in",view:"text-sm font-light truncate bg-red-500"},textarea:{input:"px-2 py-1 w-full text-sm font-light border rounded-md focus:border-blue-300 focus:outline-none transition ease-in",viewWrapper:"whitespace-normal text-sm font-light"},select:{input:"px-2 py-1 w-full text-sm font-light border rounded-md focus:border-blue-300 bg-white hover:bg-blue-100 transition ease-in",error:"p-1 text-xs text-red-700 font-bold"},multiselect:{view:"w-full h-full",mainWrapper:"w-full h-full",inputWrapper:"flex px-2 py-1 w-full text-sm font-light border focus:border-blue-300 rounded-md bg-white hover:bg-blue-100 transition ease-in",input:"w-full px-2 border rounded-lg focus:outline-none",tokenWrapper:"w-fit flex m-0.5 px-2 py-1 mx-1 bg-blue-400 hover:bg-blue-600 text-white rounded-md transition ease-in",removeIcon:"fa fa-xmark px-1 text-xs text-red-500 hover:text-red-600 self-center cursor-pointer transition ease-in",menuWrapper:"absolute p-2 bg-white w-full max-h-[150px] overflow-auto scrollbar-sm shadow-lg z-10 rounded-lg",menuItem:"px-2 py-1 text-sm hover:bg-blue-300 hover:cursor-pointer transition ease-in rounded-md",smartMenuWrapper:"w-full h-full flex flex-wrap",smartMenuItem:"w-fit px-1 py-0.5 m-1 bg-blue-100 hover:bg-blue-300 hover:cursor-pointer transition ease-in border rounded-lg text-xs",error:"p-1 text-xs text-red-700 font-bold"},radio:{wrapper:"p-1 flex",input:"self-center p-1",label:"text-sm font-light p-1 self-center",error:"text-xs text-red-700 font-bold"},card:{wrapper:"p-4",rowHeader:"w-full flex flex-row justify-between",infoIcon:"p-2 fad fa-info text-blue-300 hover:text-blue-400",row:"flex py-1 flex-col p-2 mt-3",rowLabel:"w-full text-sm font-light mb-2 capitalize",rowContent:"flex-1",btnWrapper:"w-full flex justify-end",continueBtn:"p-2 m-1 bg-blue-300 hover:bg-blue-500 disabled:bg-blue-300 text-white rounded-md transition ease-in",backBtn:"p-2 m-1 bg-blue-300 hover:bg-blue-500 disabled:bg-blue-300 text-white rounded-md transition ease-in",submitBtn:"p-2 m-1 bg-blue-300 hover:bg-blue-500 text-white rounded-md transition ease-in"},form:{tabpanelWrapper:"flex",tabWrapper:"flex p-3 w-full",tabActive:"w-full p-1 border-b-2 flex flex-col text-center border-blue-300 transition ease-in",tab:"group w-full p-1 border-b-2 flex flex-col text-center hover:bg-blue-300 transition ease-in",icon:"",tabTitle:"text-xs font-bold text-blue-500 group-hover:text-white",tabSubtitle:"text-sm font-light text-blue-500 group-hover:text-white",contentWrapper:"flex",sectionsWrapper:"columns-2 gap-2",sections:"w-full h-fit shadow-md mb-4 border",card:{wrapper:"divide-y-2",row:"flex py-1 flex-row hover:bg-blue-50 space-between p-2",rowLabel:"w-1/4 text-xs text-gray-600 font-medium mb-2 capitalize",rowContent:"pl-2 w-3/4 text-sm"}}}}const oh=z2(),U2=w.createContext(oh),Et=()=>b.useContext(U2),W2=({value:t="",onChange:s,className:n,placeholder:r,...a})=>{var d;const[l,i]=b.useState(t),c=Et();return b.useEffect(()=>i(t),[t]),e.jsx("input",{...a,className:n||((d=c==null?void 0:c.text)==null?void 0:d.input)||"w-full border p-2",value:l,placeholder:r,onChange:u=>{i(u.target.value),s(u.target.value)}})},G2=({value:t,className:s,...n})=>{var a;if(!t)return!1;const r=Et();return e.jsx("div",{className:s||((a=r==null?void 0:r.text)==null?void 0:a.view),children:typeof t=="object"?JSON.stringify(t):t})},Sl={EditComp:W2,ViewComp:G2},J2=({value:t,onChange:s,className:n,placeholder:r,...a})=>{var d;const[l,i]=b.useState(t),c=Et();return e.jsx("textarea",{className:n||((d=c==null?void 0:c.textarea)==null?void 0:d.input)||"w-full border p-2",value:l,placeholder:r,onChange:u=>{i(u.target.value),s(u.target.value)}})},q2=({value:t})=>{const s=Et();return t?e.jsx("div",{className:C(s,"textarea.viewWrapper",""),children:typeof t=="object"?JSON.stringify(t):t}):!1},K2={EditComp:J2,ViewComp:q2},Y2=({value:t,onChange:s,placeHolder:n="Please Select"})=>{var a;const r=Et();return e.jsxs("select",{className:(a=r==null?void 0:r.boolean)==null?void 0:a.select,value:t,onChange:l=>s(l.target.value),children:[e.jsx("option",{value:void 0,children:n}),e.jsx("option",{value:!0,children:"True"}),e.jsx("option",{value:!1,children:"False"})]})},Z2=({value:t})=>t?e.jsx("div",{children:t}):!1,X2={EditComp:Y2,ViewComp:Z2},gr=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Q2=b.createContext({}),eN=()=>b.useContext(Q2),tN=b.createContext([t=>()=>t,t=>t]),lh=()=>{const[t,s]=b.useContext(tN),[n,r]=b.useState(null);return b.useEffect(()=>t(a=>{r(a)}),[t]),[n,s]},xo=new WeakMap;function Ud(t){const s=t.changedTouches[0];return s===void 0?null:[s.clientX,s.clientY]}function sN(t,s){let n=xo.get(t);if(n===void 0){const r=new Set,a=i=>{n!==void 0&&(n.start=Ud(i))},l=i=>{if(n===void 0)return;const c=n.start;if(c===null)return;const d=Ud(i);for(const u of r)d!==null&&u([d[0]-c[0],d[1]-c[1]],i)};t.addEventListener("touchstart",a),t.addEventListener("touchend",l),n={handleTouchend:l,handleTouchstart:a,listeners:r,start:null},xo.set(t,n)}return n.listeners.add(s),()=>nN(t,s)}function nN(t,s){const n=xo.get(t);if(n===void 0)return;const r=n.listeners;r.delete(s),r.size===0&&(xo.delete(t),t.removeEventListener("touchstart",n.handleTouchstart),t.removeEventListener("touchend",n.handleTouchend))}function aN(t,s){return sN(t,(n,r)=>{const[a,l]=n;a>0&&a>Math.abs(l)&&s(a,r)})}const gi=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);function Wd(t){if(!ee.$isRangeSelection(t)||!t.isCollapsed())return[!1,""];const s=t.getNodes()[0],n=t.anchor;if(!ee.$isTextNode(s)||!s.isSimpleText()||!Ot.$isAtNodeEnd(n))return[!1,""];const r=[],a=s.getTextContent();let l=s.getTextContentSize(),i;for(;l--&&l>=0&&(i=a[l])!==" ";)r.push(i);return r.length===0?[!1,""]:[!0,r.reverse().join("")]}function rN(){return b.useCallback(t=>{const s=new lN;console.time("query");const n=s.query(t);return console.timeEnd("query"),n},[])}function oN(){const[t]=xt.useLexicalComposerContext(),[,s]=lh(),n=rN();return b.useEffect(()=>{let r=null,a=null,l=null,i=null;function c(){const y=r!==null?ee.$getNodeByKey(r):null;y!==null&&y.isAttached()&&(y.remove(),r=null),i!==null&&(i.dismiss(),i=null),a=null,l=null,s(null)}function d(y,j){i!==y||j===null||t.update(()=>{const N=ee.$getSelection(),[_,E]=Wd(N);if(!_||E!==a||!ee.$isRangeSelection(N))return;const L=N.clone(),S=ih(gi);r=S.getKey(),N.insertNodes([S]),ee.$setSelection(L),l=j,s(j)},{tag:"history-merge"})}function u(y){const j=y.getKey();y.__uuid===gi&&j!==r&&c()}function p(){t.update(()=>{const y=ee.$getSelection(),[j,N]=Wd(y);if(!j){c();return}N!==a&&(c(),i=n(N),i.promise.then(_=>{i!==null&&d(i,_)}).catch(_=>{console.error(_)}),a=N)})}function m(){if(l===null||r===null)return!1;const y=ee.$getNodeByKey(r);if(y===null)return!1;const j=ee.$createTextNode(l);return y.replace(j),j.selectNext(),c(),!0}function h(y){return m()?(y.preventDefault(),!0):!1}function f(y,j){t.update(()=>{m()&&j.preventDefault()})}function g(){t.update(()=>{c()})}const x=t.getRootElement();return yt.mergeRegister(t.registerNodeTransform(Ca,u),t.registerUpdateListener(p),t.registerCommand(ee.KEY_TAB_COMMAND,h,ee.COMMAND_PRIORITY_LOW),t.registerCommand(ee.KEY_ARROW_RIGHT_COMMAND,h,ee.COMMAND_PRIORITY_LOW),...x!==null?[aN(x,f)]:[],g)},[t,n,s]),null}class lN{constructor(){this.DATABASE=iN,this.LATENCY=200,this.query=s=>{let n=!1;const r=()=>{n=!0},a=new Promise((l,i)=>{setTimeout(()=>{if(n)return i("Dismissed");const c=s.length;if(s===""||c<4)return l(null);const d=s.charCodeAt(0),u=d>=65&&d<=90,p=u?String.fromCharCode(d+32)+s.substring(1):s,m=this.DATABASE.find(g=>g.startsWith(p)??null);if(m===void 0)return l(null);const f=(u?String.fromCharCode(m.charCodeAt(0)-32)+m.substring(1):m).substring(c);return l(f===""?null:f)},this.LATENCY)});return{dismiss:r,promise:a}}}}const iN=["information","available","copyright","university","management","international","development","education","community","technology","following","resources","including","directory","government","department","description","insurance","different","categories","conditions","accessories","september","questions","application","financial","equipment","performance","experience","important","activities","additional","something","professional","committee","washington","california","reference","companies","computers","president","australia","discussion","entertainment","agreement","marketing","association","collection","solutions","electronics","technical","microsoft","conference","environment","statement","downloads","applications","requirements","individual","subscribe","everything","production","commercial","advertising","treatment","newsletter","knowledge","currently","construction","registered","protection","engineering","published","corporate","customers","materials","countries","standards","political","advertise","environmental","availability","employment","commission","administration","institute","sponsored","electronic","condition","effective","organization","selection","corporation","executive","necessary","according","particular","facilities","opportunities","appropriate","statistics","investment","christmas","registration","furniture","wednesday","structure","distribution","industrial","potential","responsible","communications","associated","foundation","documents","communication","independent","operating","developed","telephone","population","navigation","operations","therefore","christian","understand","publications","worldwide","connection","publisher","introduction","properties","accommodation","excellent","opportunity","assessment","especially","interface","operation","restaurants","beautiful","locations","significant","technologies","manufacturer","providing","authority","considered","programme","enterprise","educational","employees","alternative","processing","responsibility","resolution","publication","relations","photography","components","assistance","completed","organizations","otherwise","transportation","disclaimer","membership","recommended","background","character","maintenance","functions","trademarks","phentermine","submitted","television","interested","throughout","established","programming","regarding","instructions","increased","understanding","beginning","associates","instruments","businesses","specified","restaurant","procedures","relationship","traditional","sometimes","themselves","transport","interesting","evaluation","implementation","galleries","references","presented","literature","respective","definition","secretary","networking","australian","magazines","francisco","individuals","guidelines","installation","described","attention","difference","regulations","certificate","directions","documentation","automotive","successful","communities","situation","publishing","emergency","developing","determine","temperature","announcements","historical","ringtones","difficult","scientific","satellite","particularly","functional","monitoring","architecture","recommend","dictionary","accounting","manufacturing","professor","generally","continued","techniques","permission","generation","component","guarantee","processes","interests","paperback","classifieds","supported","competition","providers","characters","thousands","apartments","generated","administrative","practices","reporting","essential","affiliate","immediately","designated","integrated","configuration","comprehensive","universal","presentation","languages","compliance","improvement","pennsylvania","challenge","acceptance","strategies","affiliates","multimedia","certified","computing","interactive","procedure","leadership","religious","breakfast","developer","approximately","recommendations","comparison","automatically","minnesota","adventure","institutions","assistant","advertisement","headlines","yesterday","determined","wholesale","extension","statements","completely","electrical","applicable","manufacturers","classical","dedicated","direction","basketball","wisconsin","personnel","identified","professionals","advantage","newsletters","estimated","anonymous","miscellaneous","integration","interview","framework","installed","massachusetts","associate","frequently","discussions","laboratory","destination","intelligence","specifications","tripadvisor","residential","decisions","industries","partnership","editorial","expression","provisions","principles","suggestions","replacement","strategic","economics","compatible","apartment","netherlands","consulting","recreation","participants","favorites","translation","estimates","protected","philadelphia","officials","contained","legislation","parameters","relationships","tennessee","representative","frequency","introduced","departments","residents","displayed","performed","administrator","addresses","permanent","agriculture","constitutes","portfolio","practical","delivered","collectibles","infrastructure","exclusive","originally","utilities","philosophy","regulation","reduction","nutrition","recording","secondary","wonderful","announced","prevention","mentioned","automatic","healthcare","maintained","increasing","connected","directors","participation","containing","combination","amendment","guaranteed","libraries","distributed","singapore","enterprises","convention","principal","certification","previously","buildings","household","batteries","positions","subscription","contemporary","panasonic","permalink","signature","provision","certainly","newspaper","liability","trademark","trackback","americans","promotion","conversion","reasonable","broadband","influence","importance","webmaster","prescription","specifically","represent","conservation","louisiana","javascript","marketplace","evolution","certificates","objectives","suggested","concerned","structures","encyclopedia","continuing","interracial","competitive","suppliers","preparation","receiving","accordance","discussed","elizabeth","reservations","playstation","instruction","annotation","differences","establish","expressed","paragraph","mathematics","compensation","conducted","percentage","mississippi","requested","connecticut","personals","immediate","agricultural","supporting","collections","participate","specialist","experienced","investigation","institution","searching","proceedings","transmission","characteristics","experiences","extremely","verzeichnis","contracts","concerning","developers","equivalent","chemistry","neighborhood","variables","continues","curriculum","psychology","responses","circumstances","identification","appliances","elementary","unlimited","printable","enforcement","hardcover","celebrity","chocolate","hampshire","bluetooth","controlled","requirement","authorities","representatives","pregnancy","biography","attractions","transactions","authorized","retirement","financing","efficiency","efficient","commitment","specialty","interviews","qualified","discovery","classified","confidence","lifestyle","consistent","clearance","connections","inventory","converter","organisation","objective","indicated","securities","volunteer","democratic","switzerland","parameter","processor","dimensions","contribute","challenges","recognition","submission","encourage","regulatory","inspection","consumers","territory","transaction","manchester","contributions","continuous","resulting","cambridge","initiative","execution","disability","increases","contractor","examination","indicates","committed","extensive","affordable","candidate","databases","outstanding","perspective","messenger","tournament","consideration","discounts","catalogue","publishers","caribbean","reservation","remaining","depending","expansion","purchased","performing","collected","absolutely","featuring","implement","scheduled","calculator","significantly","temporary","sufficient","awareness","vancouver","contribution","measurement","constitution","packaging","consultation","northwest","classroom","democracy","wallpaper","merchandise","resistance","baltimore","candidates","charlotte","biological","transition","preferences","instrument","classification","physician","hollywood","wikipedia","spiritual","photographs","relatively","satisfaction","represents","pittsburgh","preferred","intellectual","comfortable","interaction","listening","effectively","experimental","revolution","consolidation","landscape","dependent","mechanical","consultants","applicant","cooperation","acquisition","implemented","directories","recognized","notification","licensing","textbooks","diversity","cleveland","investments","accessibility","sensitive","templates","completion","universities","technique","contractors","subscriptions","calculate","alexander","broadcast","converted","anniversary","improvements","specification","accessible","accessory","typically","representation","arrangements","conferences","uniprotkb","consumption","birmingham","afternoon","consultant","controller","ownership","committees","legislative","researchers","unsubscribe","molecular","residence","attorneys","operators","sustainable","philippines","statistical","innovation","employers","definitions","elections","stainless","newspapers","hospitals","exception","successfully","indonesia","primarily","capabilities","recommendation","recruitment","organized","improving","expensive","organisations","explained","programmes","expertise","mechanism","jewellery","eventually","agreements","considering","innovative","conclusion","disorders","collaboration","detection","formation","engineers","proposals","moderator","tutorials","settlement","collectables","fantastic","governments","purchasing","appointed","operational","corresponding","descriptions","determination","animation","productions","telecommunications","instructor","approaches","highlights","designers","melbourne","scientists","blackjack","argentina","possibility","commissioner","dangerous","reliability","unfortunately","respectively","volunteers","attachment","appointment","workshops","hurricane","represented","mortgages","responsibilities","carefully","productivity","investors","underground","diagnosis","principle","vacations","calculated","appearance","incorporated","notebooks","algorithm","valentine","involving","investing","christopher","admission","terrorism","parliament","situations","allocated","corrections","structural","municipal","describes","disabilities","substance","prohibited","addressed","simulation","initiatives","concentration","interpretation","bankruptcy","optimization","substances","discovered","restrictions","participating","exhibition","composition","nationwide","definitely","existence","commentary","limousines","developments","immigration","destinations","necessarily","attribute","apparently","surrounding","mountains","popularity","postposted","coordinator","obviously","fundamental","substantial","progressive","championship","sacramento","impossible","depression","testimonials","memorabilia","cartridge","explanation","cincinnati","subsection","electricity","permitted","workplace","confirmed","wallpapers","infection","eligibility","involvement","placement","observations","vbulletin","subsequent","motorcycle","disclosure","establishment","presentations","undergraduate","occupation","donations","associations","citysearch","radiation","seriously","elsewhere","pollution","conservative","guestbook","effectiveness","demonstrate","atmosphere","experiment","purchases","federation","assignment","chemicals","everybody","nashville","counseling","acceptable","satisfied","measurements","milwaukee","medication","warehouse","shareware","violation","configure","stability","southwest","institutional","expectations","independence","metabolism","personally","excellence","somewhere","attributes","recognize","screening","thumbnail","forgotten","intelligent","edinburgh","obligation","regardless","restricted","republican","merchants","attendance","arguments","amsterdam","adventures","announcement","appreciate","regularly","mechanisms","customize","tradition","indicators","emissions","physicians","complaint","experiments","afghanistan","scholarship","governance","supplements","camcorder","implementing","ourselves","conversation","capability","producing","precision","contributed","reproduction","ingredients","franchise","complaints","promotions","rehabilitation","maintaining","environments","reception","correctly","consequences","geography","appearing","integrity","discrimination","processed","implications","functionality","intermediate","emotional","platforms","overnight","geographic","preliminary","districts","introduce","promotional","chevrolet","specialists","generator","suspension","correction","authentication","communicate","supplement","showtimes","promoting","machinery","bandwidth","probability","dimension","schedules","admissions","quarterly","illustrated","continental","alternate","achievement","limitations","automated","passenger","convenient","orientation","childhood","flexibility","jurisdiction","displaying","encouraged","cartridges","declaration","automation","advantages","preparing","recipient","extensions","athletics","southeast","alternatives","determining","personalized","conditioning","partnerships","destruction","increasingly","migration","basically","conventional","applicants","occupational","adjustment","treatments","camcorders","difficulty","collective","coalition","enrollment","producers","collector","interfaces","advertisers","representing","observation","restoration","convenience","returning","opposition","container","defendant","confirmation","supervisor","peripherals","bestsellers","departure","minneapolis","interactions","intervention","attraction","modification","customized","understood","assurance","happening","amendments","metropolitan","compilation","verification","attractive","recordings","jefferson","gardening","obligations","orchestra","polyphonic","outsourcing","adjustable","allocation","discipline","demonstrated","identifying","alphabetical","dispatched","installing","voluntary","photographer","messaging","constructed","additions","requiring","engagement","refinance","calendars","arrangement","conclusions","bibliography","compatibility","furthermore","cooperative","measuring","jacksonville","headquarters","transfers","transformation","attachments","administrators","personality","facilitate","subscriber","priorities","bookstore","parenting","incredible","commonwealth","pharmaceutical","manhattan","workforce","organizational","portuguese","everywhere","discharge","halloween","hazardous","methodology","housewares","reputation","resistant","democrats","recycling","qualifications","slideshow","variation","transferred","photograph","distributor","underlying","wrestling","photoshop","gathering","projection","mathematical","specialized","diagnostic","indianapolis","corporations","criticism","automobile","confidential","statutory","accommodations","northeast","downloaded","paintings","injection","yorkshire","populations","protective","initially","indicator","eliminate","sunglasses","preference","threshold","venezuela","exploration","sequences","astronomy","translate","announces","compression","establishing","constitutional","perfectly","instantly","litigation","submissions","broadcasting","horizontal","terrorist","informational","ecommerce","suffering","prospective","ultimately","artificial","spectacular","coordination","connector","affiliated","activation","naturally","subscribers","mitsubishi","underwear","potentially","constraints","inclusive","dimensional","considerable","selecting","processors","pantyhose","difficulties","complexity","constantly","barcelona","presidential","documentary","territories","palestinian","legislature","hospitality","procurement","theoretical","exercises","surveillance","protocols","highlight","substitute","inclusion","hopefully","brilliant","evaluated","assignments","termination","households","authentic","montgomery","architectural","louisville","macintosh","movements","amenities","virtually","authorization","projector","comparative","psychological","surprised","genealogy","expenditure","liverpool","connectivity","algorithms","similarly","collaborative","excluding","commander","suggestion","spotlight","investigate","connecting","logistics","proportion","significance","symposium","essentials","protecting","transmitted","screenshots","intensive","switching","correspondence","supervision","expenditures","separation","testimony","celebrities","mandatory","boundaries","syndication","celebration","filtering","luxembourg","offensive","deployment","colleagues","separated","directive","governing","retailers","occasionally","attending","recruiting","instructional","traveling","permissions","biotechnology","prescribed","catherine","reproduced","calculation","consolidated","occasions","equations","exceptional","respondents","considerations","queensland","musicians","composite","unavailable","essentially","designing","assessments","brunswick","sensitivity","preservation","streaming","intensity","technological","syndicate","antivirus","addressing","discounted","bangladesh","constitute","concluded","desperate","demonstration","governmental","manufactured","graduation","variations","addiction","springfield","synthesis","undefined","unemployment","enhancement","newcastle","performances","societies","brazilian","identical","petroleum","norwegian","retention","exchanges","soundtrack","wondering","profession","separately","physiology","collecting","participant","scholarships","recreational","dominican","friendship","expanding","provincial","investigations","medications","rochester","advertiser","encryption","downloadable","sophisticated","possession","laboratories","vegetables","thumbnails","stockings","respondent","destroyed","manufacture","wordpress","vulnerability","accountability","celebrate","accredited","appliance","compressed","scheduling","perspectives","mortality","christians","therapeutic","impressive","accordingly","architect","challenging","microwave","accidents","relocation","contributors","violations","temperatures","competitions","discretion","cosmetics","repository","concentrations","christianity","negotiations","realistic","generating","christina","congressional","photographic","modifications","millennium","achieving","fisheries","exceptions","reactions","macromedia","companion","divisions","additionally","fellowship","victorian","copyrights","lithuania","mastercard","chronicles","obtaining","distribute","decorative","enlargement","campaigns","conjunction","instances","indigenous","validation","corruption","incentives","cholesterol","differential","scientist","starsmerchant","arthritis","nevertheless","practitioners","transcript","inflation","compounds","contracting","structured","reasonably","graduates","recommends","controlling","distributors","arlington","particles","extraordinary","indicating","coordinate","exclusively","limitation","widescreen","illustration","construct","inquiries","inspiration","affecting","downloading","aggregate","forecasts","complicated","shopzilla","decorating","expressions","shakespeare","connectors","conflicts","travelers","offerings","incorrect","furnishings","guatemala","perception","renaissance","pathology","ordinance","photographers","infections","configured","festivals","possibilities","contributing","analytical","circulation","assumption","jerusalem","transexuales","invention","technician","executives","enquiries","cognitive","exploring","registrar","supporters","withdrawal","predicted","saskatchewan","cancellation","ministers","veterinary","prostores","relevance","incentive","butterfly","mechanics","numerical","reflection","accompanied","invitation","princeton","spirituality","meanwhile","proprietary","childrens","thumbzilla","porcelain","pichunter","translated","columnists","consensus","delivering","journalism","intention","undertaken","statewide","semiconductor","illustrations","happiness","substantially","identifier","calculations","conducting","accomplished","calculators","impression","correlation","fragrance","neighbors","transparent","charleston","champions","selections","projectors","inappropriate","comparing","vocational","pharmacies","introducing","appreciated","albuquerque","distinguished","projected","assumptions","shareholders","developmental","regulated","anticipated","completing","comparable","confusion","copyrighted","warranties","documented","paperbacks","keyboards","vulnerable","reflected","respiratory","notifications","transexual","mainstream","evaluating","subcommittee","maternity","journalists","foundations","volleyball","liabilities","decreased","tolerance","creativity","describing","lightning","quotations","inspector","bookmarks","behavioral","riverside","bathrooms","abilities","initiated","nonprofit","lancaster","suspended","containers","attitudes","simultaneously","integrate","sociology","screenshot","exhibitions","confident","retrieved","officially","consortium","recipients","delicious","traditions","periodically","hungarian","referring","transform","educators","vegetable","humanities","independently","alignment","henderson","britannica","competitors","visibility","consciousness","encounter","resolutions","accessing","attempted","witnesses","administered","strengthen","frederick","aggressive","advertisements","sublimedirectory","disturbed","determines","sculpture","motivation","pharmacology","passengers","quantities","petersburg","consistently","powerpoint","obituaries","punishment","appreciation","subsequently","providence","restriction","incorporate","backgrounds","treasurer","lightweight","transcription","complications","scripting","remembered","synthetic","testament","specifics","partially","wilderness","generations","tournaments","sponsorship","headphones","proceeding","volkswagen","uncertainty","breakdown","reconstruction","subsidiary","strengths","encouraging","furnished","terrorists","comparisons","beneficial","distributions","viewpicture","threatened","republicans","discusses","responded","abstracts","prediction","pharmaceuticals","thesaurus","individually","battlefield","literally","ecological","appraisal","consisting","submitting","citations","geographical","mozambique","disclaimers","championships","sheffield","finishing","wellington","prospects","bulgarian","aboriginal","remarkable","preventing","productive","boulevard","compliant","penalties","imagination","refurbished","activated","conferencing","armstrong","politicians","trackbacks","accommodate","christine","accepting","precipitation","isolation","sustained","approximate","programmer","greetings","inherited","incomplete","chronicle","legitimate","biographies","investigator","plaintiff","prisoners","mediterranean","nightlife","architects","entrepreneur","freelance","excessive","screensaver","valuation","unexpected","cigarette","characteristic","metallica","consequently","appointments","narrative","academics","quantitative","screensavers","subdivision","distinction","livestock","exemption","sustainability","formatting","nutritional","nicaragua","affiliation","relatives","satisfactory","revolutionary","bracelets","telephony","breathing","thickness","adjustments","graphical","discussing","aerospace","meaningful","maintains","shortcuts","voyeurweb","extending","specifies","accreditation","blackberry","meditation","microphone","macedonia","combining","instrumental","organizing","moderators","kazakhstan","standings","partition","invisible","translations","commodity","kilometers","thanksgiving","guarantees","indication","congratulations","cigarettes","controllers","consultancy","conventions","coordinates","responding","physically","stakeholders","hydrocodone","consecutive","attempting","representations","competing","peninsula","accurately","considers","ministries","vacancies","parliamentary","acknowledge","thoroughly","nottingham","identifies","questionnaire","qualification","modelling","miniature","interstate","consequence","systematic","perceived","madagascar","presenting","troubleshooting","uzbekistan","centuries","magnitude","richardson","fragrances","vocabulary","earthquake","fundraising","geological","assessing","introduces","webmasters","computational","acdbentity","participated","handhelds","answering","impressed","conspiracy","organizer","combinations","preceding","cumulative","amplifier","arbitrary","prominent","lexington","contacted","recorders","occasional","innovations","postcards","reviewing","explicitly","transsexual","citizenship","informative","girlfriend","bloomberg","hierarchy","influenced","abandoned","complement","mauritius","checklist","requesting","lauderdale","scenarios","extraction","elevation","utilization","beverages","calibration","efficiently","entertaining","prerequisite","hypothesis","medicines","regression","enhancements","renewable","intersection","passwords","consistency","collectors","azerbaijan","astrology","occurring","supplemental","travelling","induction","precisely","spreading","provinces","widespread","incidence","incidents","enhancing","interference","palestine","listprice","atmospheric","knowledgestorm","referenced","publicity","proposition","allowance","designation","duplicate","criterion","civilization","vietnamese","tremendous","corrected","encountered","internationally","surrounded","creatures","commented","accomplish","vegetarian","newfoundland","investigated","ambassador","stephanie","contacting","vegetation","findarticles","specially","infectious","continuity","phenomenon","conscious","referrals","differently","integrating","revisions","reasoning","charitable","annotated","convinced","burlington","replacing","researcher","watershed","occupations","acknowledged","equilibrium","characterized","privilege","qualifying","estimation","pediatric","techrepublic","institutes","brochures","traveller","appropriations","suspected","benchmark","beginners","instructors","highlighted","stationery","unauthorized","competent","contributor","demonstrates","gradually","desirable","journalist","afterwards","religions","explosion","signatures","disciplines","daughters","conversations","simplified","motherboard","bibliographic","champagne","deviation","superintendent","housewives","influences","inspections","irrigation","hydraulic","robertson","penetration","conviction","omissions","retrieval","qualities","prototype","importantly","apparatus","explaining","nomination","empirical","dependence","sexuality","polyester","commitments","suggesting","remainder","privileges","televisions","specializing","commodities","motorcycles","concentrate","reproductive","molecules","refrigerator","intervals","sentences","exclusion","workstation","holocaust","receivers","disposition","navigator","investigators","marijuana","cathedral","fairfield","fascinating","landscapes","lafayette","computation","cardiovascular","salvation","predictions","accompanying","selective","arbitration","configuring","editorials","sacrifice","removable","convergence","gibraltar","anthropology","malpractice","reporters","necessity","rendering","hepatitis","nationally","waterproof","specialties","humanitarian","invitations","functioning","economies","alexandria","bacterial","undertake","continuously","achievements","convertible","secretariat","paragraphs","adolescent","nominations","cancelled","introductory","reservoir","occurrence","worcester","demographic","disciplinary","respected","portraits","interpreted","evaluations","elimination","hypothetical","immigrants","complimentary","helicopter","performer","commissions","powerseller","graduated","surprising","unnecessary","dramatically","yugoslavia","characterization","likelihood","fundamentals","contamination","endangered","compromise","expiration","namespace","peripheral","negotiation","opponents","nominated","confidentiality","electoral","changelog","alternatively","greensboro","controversial","recovered","upgrading","frontpage","demanding","defensive","forbidden","programmers","monitored","installations","deutschland","practitioner","motivated","smithsonian","examining","revelation","delegation","dictionaries","greenhouse","transparency","currencies","survivors","positioning","descending","temporarily","frequencies","reflections","municipality","detective","experiencing","fireplace","endorsement","psychiatry","persistent","summaries","looksmart","magnificent","colleague","adaptation","paintball","enclosure","supervisors","westminster","distances","absorption","treasures","transcripts","disappointed","continually","communist","collectible","entrepreneurs","creations","acquisitions","biodiversity","excitement","presently","mysterious","librarian","subsidiaries","stockholm","indonesian","therapist","promising","relaxation","thereafter","commissioners","forwarding","nightmare","reductions","southampton","organisms","telescope","portsmouth","advancement","harassment","generators","generates","replication","inexpensive","receptors","interventions","huntington","internship","aluminium","snowboard","beastality","evanescence","coordinated","shipments","antarctica","chancellor","controversy","legendary","beautifully","antibodies","examinations","immunology","departmental","terminology","gentleman","reproduce","convicted","roommates","threatening","spokesman","activists","frankfurt","encourages","assembled","restructuring","terminals","simulations","sufficiently","conditional","crossword","conceptual","liechtenstein","translator","automobiles","continent","longitude","challenged","telecharger","insertion","instrumentation","constraint","groundwater","strengthening","insulation","infringement","subjective","swaziland","varieties","mediawiki","configurations"];class Ca extends ee.DecoratorNode{static clone(s){return new Ca(s.__key)}static getType(){return"autocomplete"}static importJSON(s){return ih(s.uuid)}exportJSON(){return{...super.exportJSON(),type:"autocomplete",uuid:this.__uuid,version:1}}constructor(s,n){super(n),this.__uuid=s}updateDOM(){return!1}createDOM(){return document.createElement("span")}decorate(){return this.__uuid!==gi?null:e.jsx(cN,{})}}function ih(t){return new Ca(t)}function cN(){const[t]=lh(),s=window.navigator.userAgentData,n=s!==void 0?s.mobile:window.innerWidth<=800&&window.innerHeight<=600;return e.jsxs("span",{style:{color:"#ccc"},spellCheck:"false",children:[t," ",n?"(SWIPE ⮕)":"(TAB)"]})}const dN="modulepreload",uN=function(t){return"/"+t},Gd={},ch=function(s,n,r){let a=Promise.resolve();if(n&&n.length>0){const l=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.all(n.map(d=>{if(d=uN(d),d in Gd)return;Gd[d]=!0;const u=d.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(!!r)for(let f=l.length-1;f>=0;f--){const g=l[f];if(g.href===d&&(!u||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${p}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":dN,u||(h.as="script",h.crossOrigin=""),h.href=d,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((f,g)=>{h.addEventListener("load",f),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${d}`)))})}))}return a.then(()=>s()).catch(l=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=l,window.dispatchEvent(i),!i.defaultPrevented)throw l})},mN=b.lazy(()=>ch(()=>import("./InlineImageComponent-Bk2YPb7W.js"),__vite__mapDeps([0,1,2])));function pN(t){if(t instanceof HTMLImageElement){const{alt:s,src:n,width:r,height:a}=t;return{node:tl({altText:s,height:a,src:n,width:r})}}return null}class mn extends ee.DecoratorNode{static getType(){return"image"}static clone(s){return new mn(s.__src,s.__altText,s.__position,s.__width,s.__height,s.__showCaption,s.__caption,s.__key)}static importJSON(s){const{altText:n,height:r,width:a,caption:l,src:i,showCaption:c,position:d="full"}=s,u=tl({altText:n,height:r,position:d,showCaption:c,src:i,width:a}),p=u.__caption,m=p.parseEditorState(l.editorState);return m.isEmpty()||p.setEditorState(m),u}static importDOM(){return{img:s=>({conversion:pN,priority:0})}}constructor(s,n,r,a,l,i,c,d){super(d),this.__src=s,this.__altText=n,this.__width=a||"inherit",this.__height=l||"inherit",this.__showCaption=i||!1,this.__caption=c||ee.createEditor(),this.__position=r}exportDOM(){const s=document.createElement("img");return s.setAttribute("src",this.__src),s.setAttribute("alt",this.__altText),s.setAttribute("width",this.__width.toString()),s.setAttribute("height",this.__height.toString()),{element:s}}exportJSON(){return{altText:this.getAltText(),caption:this.__caption.toJSON(),height:this.__height==="inherit"?0:this.__height,position:this.__position,showCaption:this.__showCaption,src:this.getSrc(),type:"image",version:1,width:this.__width==="inherit"?0:this.__width}}getSrc(){return this.__src}getAltText(){return this.__altText}setAltText(s){const n=this.getWritable();n.__altText=s}setWidthAndHeight(s,n){const r=this.getWritable();r.__width=s,r.__height=n}getShowCaption(){return this.__showCaption}setShowCaption(s){const n=this.getWritable();n.__showCaption=s}getPosition(){return this.__position}setPosition(s){const n=this.getWritable();n.__position=s}update(s){console.log("updating payload",s);const n=this.getWritable(),{altText:r,showCaption:a,position:l}=s;r!==void 0&&(n.__altText=r),a!==void 0&&(n.__showCaption=a),l!==void 0&&(n.__position=l)}createDOM(s){const n=document.createElement("span"),r=`${s.theme.inlineImage} position-${this.__position}`;return r!==void 0&&(n.className=r),n}updateDOM(s,n,r){const a=this.__position;if(a!==s.__position){const l=`${r.theme.inlineImage} position-${a}`;l!==void 0&&(n.className=l)}return!1}decorate(){return e.jsx(b.Suspense,{fallback:null,children:e.jsx(mN,{src:this.__src,altText:this.__altText,width:this.__width,height:this.__height,nodeKey:this.getKey(),showCaption:this.__showCaption,caption:this.__caption,position:this.__position})})}}function tl({altText:t,position:s,height:n,src:r,width:a,showCaption:l,caption:i,key:c}){return ee.$applyNodeReplacement(new mn(r,t,s,a,n,l,i,c))}function dh(t){return t instanceof mn}class Bn extends ee.TextNode{static getType(){return"keyword"}static clone(s){return new Bn(s.__text,s.__key)}static importJSON(s){const n=uh(s.text);return n.setFormat(s.format),n.setDetail(s.detail),n.setMode(s.mode),n.setStyle(s.style),n}exportJSON(){return{...super.exportJSON(),type:"keyword",version:1}}createDOM(s){const n=super.createDOM(s);return n.style.cursor="default",n.className="keyword",n}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}isTextEntity(){return!0}}function uh(t){return new Bn(t)}const hN=[es.HeadingNode,Pt.ListNode,Pt.ListItemNode,Dt.CodeNode,Dt.CodeHighlightNode,_t.AutoLinkNode,_t.LinkNode,mn,Ca,Bn];function fN({onClose:t,children:s,title:n,closeOnClickOutside:r}){const a=b.useRef(null);return b.useEffect(()=>{a.current!==null&&a.current.focus()},[]),b.useEffect(()=>{let l=null;const i=u=>{u.keyCode===27&&t()},c=u=>{const p=u.target;a.current!==null&&!a.current.contains(p)&&r&&t()},d=a.current;return d!==null&&(l=d.parentElement,l!==null&&l.addEventListener("click",c)),window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i),l!==null&&(l==null||l.removeEventListener("click",c))}},[r,t]),e.jsx("div",{className:"flex justify-center items-center fixed flex-col top-0 bottom-0 left-0 right-0 bg-[rgba(40,_40,_40,_0.6)] flex-grow-[0px] flex-shrink-[1px]",role:"dialog",children:e.jsxs("div",{className:"p-[20px] min-h-[100px] min-w-[300px] flex flex-grow-[0px] bg-[#fff] flex-col relative [box-shadow:0_0_20px_0_#444] rounded-[10px]",tabIndex:-1,ref:a,children:[e.jsx("h2",{className:"text-[#444] m-0 pb-[10px] border-b-[1px_solid_#ccc]",children:n}),e.jsx("button",{className:"border-[0px] absolute right-[20px] rounded-[20px] justify-center items-center flex w-[30px] h-[30px] text-center cursor-pointer bg-[#eee] hover:bg-[#ddd]","aria-label":"Close modal",type:"button",onClick:t,children:"X"}),e.jsx("div",{className:"pt-[20px]",children:s})]})})}function gN({onClose:t,children:s,title:n,closeOnClickOutside:r=!1}){return ks.createPortal(e.jsx(fN,{onClose:t,title:n,closeOnClickOutside:r,children:s}),document.body)}function xr(){const[t,s]=b.useState(null),n=b.useCallback(()=>{s(null)},[]),r=b.useMemo(()=>{if(t===null)return null;const{title:l,content:i,closeOnClickOutside:c}=t;return e.jsx(gN,{onClose:n,title:l,closeOnClickOutside:c,children:i})},[t,n]),a=b.useCallback((l,i,c=!1)=>{s({closeOnClickOutside:c,content:i(n),title:l})},[n]);return[r,a]}function xN(...t){return t.filter(Boolean).join(" ")}function ga({"data-test-id":t,children:s,className:n,onClick:r,disabled:a,small:l,title:i}){return e.jsx("button",{disabled:a,className:xN("pt-[10px] pb-[10px] pl-[15px] pr-[15px] border-[0px] bg-[#eee] rounded-[5px] cursor-pointer text-[14px] hover:bg-[#ddd]",a&&"cursor-not-allowed hover:bg-[#eee]",l&&"pt-[5px] pb-[5px] pl-[10px] pr-[10px] text-[13px]",n),onClick:r,title:i,"aria-label":i,...t&&{"data-test-id":t},children:s})}const bN="https://platform.twitter.com/widgets.js";function yN(t){const s=t.getAttribute("data-lexical-tweet-id");return s?{node:Sc(s)}:null}let Jd=!0;function vN({className:t,format:s,loadingComponent:n,nodeKey:r,onError:a,onLoad:l,tweetID:i}){const c=b.useRef(null),d=b.useRef(""),[u,p]=b.useState(!1),m=b.useCallback(async()=>{try{await window.twttr.widgets.createTweet(i,c.current),p(!1),Jd=!1,l&&l()}catch(h){a&&a(String(h))}},[a,l,i]);return b.useEffect(()=>{var h;if(i!==d.current){if(p(!0),Jd){const f=document.createElement("script");f.src=bN,f.async=!0,(h=document.body)==null||h.appendChild(f),f.onload=m,a&&(f.onerror=a)}else m();d&&(d.current=i)}},[m,a,i]),e.jsxs(pp.BlockWithAlignableContents,{className:t,format:s,nodeKey:r,children:[u?n:null,e.jsx("div",{style:{display:"inline-block",width:"550px"},ref:c})]})}class br extends hc.DecoratorBlockNode{static getType(){return"tweet"}static clone(s){return new br(s.__id,s.__format,s.__key)}static importJSON(s){const n=Sc(s.id);return n.setFormat(s.format),n}exportJSON(){return{...super.exportJSON(),id:this.getId(),type:"tweet",version:1}}static importDOM(){return{div:s=>s.hasAttribute("data-lexical-tweet-id")?{conversion:yN,priority:2}:null}}exportDOM(){const s=document.createElement("div");s.setAttribute("data-lexical-tweet-id",this.__id);const n=document.createTextNode(this.getTextContent());return s.append(n),{element:s}}constructor(s,n,r){super(n,r),this.__id=s}getId(){return this.__id}getTextContent(s,n){return`https://twitter.com/i/web/status/${this.__id}`}decorate(s,n){const r=n.theme.embedBlock||{},a={base:r.base||"",focus:r.focus||""};return e.jsx(vN,{className:a,format:this.__format,loadingComponent:"Loading...",nodeKey:this.getKey(),tweetID:this.__id})}isInline(){return!1}}function Sc(t){return new br(t)}function jN(t){return t instanceof br}const wN={dependencies:[la.HorizontalRuleNode],export:t=>la.$isHorizontalRuleNode(t)?"***":null,regExp:/^(---|\*\*\*|___)\s?$/,replace:(t,s,n,r)=>{const a=la.$createHorizontalRuleNode();r||t.getNextSibling()!=null?t.replace(a):t.insertBefore(a),a.selectNext()},type:"element"},NN={dependencies:[mn],export:t=>dh(t)?`![${t.getAltText()}](${t.getSrc()})`:null,importRegExp:/!(?:\[([^[]*)\])(?:\(([^(]+)\))/,regExp:/!(?:\[([^[]*)\])(?:\(([^(]+)\))$/,replace:(t,s)=>{const[,n,r]=s,a=tl({altText:n,maxWidth:800,src:r});t.replace(a)},trigger:")",type:"text-match"},CN={dependencies:[br],export:t=>jN(t)?`<tweet id="${t.getId()}" />`:null,regExp:/<tweet id="([^"]+?)"\s?\/>\s?$/,replace:(t,s,n)=>{const[,r]=n,a=Sc(r);t.replace(a)},type:"element"},mh=/^(?:\|)(.+)(?:\|)\s?$/,_N=/^(\| ?:?-*:? ?)+\|\s?$/,SN={dependencies:[Se.TableNode,Se.TableRowNode,Se.TableCellNode],export:t=>{if(!Se.$isTableNode(t))return null;const s=[];for(const n of t.getChildren()){const r=[];if(!Se.$isTableRowNode(n))continue;let a=!1;for(const l of n.getChildren())Se.$isTableCellNode(l)&&(r.push(sn.$convertToMarkdownString(bo,l).replace(/\n/g,"\\n")),l.__headerState===Se.TableCellHeaderStates.ROW&&(a=!0));s.push(`| ${r.join(" | ")} |`),a&&s.push(`| ${r.map(l=>"---").join(" | ")} |`)}return s.join(`
`)},regExp:mh,replace:(t,s,n)=>{if(_N.test(n[0])){const u=t.getPreviousSibling();if(!u||!Se.$isTableNode(u))return;const p=u.getChildren(),m=p[p.length-1];if(!m||!Se.$isTableRowNode(m))return;m.getChildren().forEach(h=>{Se.$isTableCellNode(h)&&h.toggleHeaderStyle(Se.TableCellHeaderStates.ROW)}),t.remove();return}const r=qd(n[0]);if(r==null)return;const a=[r];let l=t.getPreviousSibling(),i=r.length;for(;l&&!(!ee.$isParagraphNode(l)||l.getChildrenSize()!==1);){const u=l.getFirstChild();if(!ee.$isTextNode(u))break;const p=qd(u.getTextContent());if(p==null)break;i=Math.max(i,p.length),a.unshift(p);const m=l.getPreviousSibling();l.remove(),l=m}const c=Se.$createTableNode();for(const u of a){const p=Se.$createTableRowNode();c.append(p);for(let m=0;m<i;m++)p.append(m<u.length?u[m]:ph(""))}const d=t.getPreviousSibling();Se.$isTableNode(d)&&$N(d)===i?(d.append(...c.getChildren()),t.remove()):t.replace(c),c.selectEnd()},type:"element"};function $N(t){const s=t.getFirstChild();return Se.$isTableRowNode(s)?s.getChildrenSize():0}const ph=t=>{t=t.replace(/\\n/g,`
`);const s=Se.$createTableCellNode(Se.TableCellHeaderStates.NO_STATUS);return sn.$convertFromMarkdownString(t,bo,s),s},qd=t=>{const s=t.match(mh);return!s||!s[1]?null:s[1].split("|").map(n=>ph(n))},bo=[SN,wN,NN,CN,sn.CHECK_LIST,...sn.ELEMENT_TRANSFORMERS,...sn.TEXT_FORMAT_TRANSFORMERS,...sn.TEXT_MATCH_TRANSFORMERS],Kd=()=>{let t=document.getElementById("report-container");return t===null&&(t=document.createElement("div"),t.id="report-container",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.fontSize="32px",t.style.transform="translate(-50%, -50px)",t.style.padding="20px",t.style.background="rgba(240, 240, 240, 0.4)",t.style.borderRadius="20px",document.body&&document.body.appendChild(t)),t};function EN(){const t=b.useRef(null),s=b.useCallback(()=>{t!==null&&clearTimeout(t.current),document.body&&document.body.removeChild(Kd())},[]);return b.useEffect(()=>s,[s]),b.useCallback(n=>{console.log(n);const r=Kd();return clearTimeout(t.current),r.innerHTML=n,t.current=setTimeout(s,1e3),t.current},[s])}const hh=ee.createCommand("SPEECH_TO_TEXT_COMMAND"),kN={"\n":({selection:t})=>{t.insertParagraph()},redo:({editor:t})=>{t.dispatchCommand(ee.REDO_COMMAND,void 0)},undo:({editor:t})=>{t.dispatchCommand(ee.UNDO_COMMAND,void 0)}},fh="SpeechRecognition"in window||"webkitSpeechRecognition"in window;function LN(){const[t]=xt.useLexicalComposerContext(),[s,n]=b.useState(!1),r=window.SpeechRecognition||window.webkitSpeechRecognition,a=b.useRef(null),l=EN();return b.useEffect(()=>(s&&a.current===null&&(a.current=new r,a.current.continuous=!0,a.current.interimResults=!0,a.current.addEventListener("result",i=>{const c=i.results.item(i.resultIndex),{transcript:d}=c.item(0);l(d),c.isFinal&&t.update(()=>{const u=ee.$getSelection();if(ee.$isRangeSelection(u)){const p=kN[d.toLowerCase().trim()];p?p({editor:t,selection:u}):d.match(/\s*\n\s*/)?u.insertParagraph():u.insertText(d)}})})),a.current&&(s?a.current.start():a.current.stop()),()=>{a.current!==null&&a.current.stop()}),[r,t,s,l]),b.useEffect(()=>t.registerCommand(hh,i=>(n(i),!0),ee.COMMAND_PRIORITY_EDITOR),[t]),null}const IN=fh?LN:()=>null;async function TN(t){const s=JSON.stringify(t.getEditorState());try{await fetch("http://localhost:1235/setEditorState",{body:s,headers:{Accept:"application/json","Content-type":"application/json"},method:"POST"})}catch{}}async function MN(t){const s=JSON.stringify(t.getEditorState());let n=null;try{n=await fetch("http://localhost:1235/validateEditorState",{body:s,headers:{Accept:"application/json","Content-type":"application/json"},method:"POST"})}catch{}if(n!==null&&n.status===403)throw new Error("Editor state validation failed! Server did not accept changes.")}function BN({isRichText:t}){const[s]=xt.useLexicalComposerContext(),[n,r]=b.useState(()=>s.isEditable()),[a,l]=b.useState(!1);b.useState(!1);const[i,c]=b.useState(!0),[d,u]=xr();qb.useCollaborationContext(),b.useEffect(()=>s.registerUpdateListener(({dirtyElements:m,prevEditorState:h,tags:f})=>{!n&&m.size>0&&!f.has("historic")&&!f.has("collaboration")&&MN(s),s.getEditorState().read(()=>{const x=ee.$getRoot().getChildren();if(x.length>1)c(!1);else if(ee.$isParagraphNode(x[0])){const y=x[0].getChildren();c(y.length===0)}else c(!1)})}),[s,n]);const p=b.useCallback(()=>{s.update(()=>{const m=ee.$getRoot(),h=m.getFirstChild();if(Dt.$isCodeNode(h)&&h.getLanguage()==="markdown")sn.$convertFromMarkdownString(h.getTextContent(),bo);else{const f=sn.$convertToMarkdownString(bo);m.clear().append(Dt.$createCodeNode("markdown").append(ee.$createTextNode(f)))}m.selectEnd()})},[s]);return e.jsxs("div",{className:"actions",children:[fh&&e.jsx("button",{onClick:()=>{s.dispatchCommand(hh,!a),l(!a)},className:"action-button action-button-mic "+(a?"active":""),title:"Speech To Text","aria-label":`${a?"Enable":"Disable"} speech to text`,children:e.jsx("i",{className:"mic"})}),e.jsx("button",{className:"action-button import",onClick:()=>$d.importFile(s),title:"Import","aria-label":"Import editor state from JSON",children:e.jsx("i",{className:"import"})}),e.jsx("button",{className:"action-button export",onClick:()=>$d.exportFile(s,{fileName:`Playground ${new Date().toISOString()}`,source:"Playground"}),title:"Export","aria-label":"Export editor state to JSON",children:e.jsx("i",{className:"export"})}),e.jsx("button",{className:"action-button clear",disabled:i,onClick:()=>{u("Clear editor",m=>e.jsx(AN,{editor:s,onClose:m}))},title:"Clear","aria-label":"Clear editor contents",children:e.jsx("i",{className:"clear"})}),e.jsx("button",{className:`action-button ${n?"lock":"unlock"}`,onClick:()=>{n&&TN(s),s.setEditable(!s.isEditable())},title:"Read-Only Mode","aria-label":`${n?"Lock":"Unlock"} read-only mode`,children:e.jsx("i",{className:n?"lock":"unlock"})}),e.jsx("button",{className:"action-button",onClick:p,title:"Convert From Markdown","aria-label":"Convert from markdown",children:e.jsx("i",{className:"markdown"})}),d]})}function AN({editor:t,onClose:s}){return e.jsxs(e.Fragment,{children:["Are you sure you want to clear the editor?",e.jsxs("div",{className:"Modal__content",children:[e.jsx(ga,{onClick:()=>{t.dispatchCommand(ee.CLEAR_EDITOR_COMMAND,void 0),t.focus(),s()},children:"Clear"})," ",e.jsx(ga,{onClick:()=>{t.focus(),s()},children:"Cancel"})]})]})}function sl({"data-test-id":t,children:s}){return e.jsx("div",{className:"flex flex-row mt-[20px]","data-test-id":t,children:s})}function ON({className:t,format:s,nodeKey:n,videoID:r}){return e.jsx(pp.BlockWithAlignableContents,{className:t,format:s,nodeKey:n,children:e.jsx("iframe",{width:"560",height:"315",src:`https://www.youtube-nocookie.com/embed/${r}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:"YouTube video"})})}function PN(t){const s=t.getAttribute("data-lexical-youtube");return s?{node:$c(s)}:null}class yr extends hc.DecoratorBlockNode{static getType(){return"youtube"}static clone(s){return new yr(s.__id,s.__format,s.__key)}static importJSON(s){const n=$c(s.videoID);return n.setFormat(s.format),n}exportJSON(){return{...super.exportJSON(),type:"youtube",version:1,videoID:this.__id}}constructor(s,n,r){super(n,r),this.__id=s}exportDOM(){const s=document.createElement("iframe");return s.setAttribute("data-lexical-youtube",this.__id),s.setAttribute("width","560"),s.setAttribute("height","315"),s.setAttribute("src",`https://www.youtube-nocookie.com/embed/${this.__id}`),s.setAttribute("frameborder","0"),s.setAttribute("allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),s.setAttribute("allowfullscreen","true"),s.setAttribute("title","YouTube video"),{element:s}}static importDOM(){return{iframe:s=>s.hasAttribute("data-lexical-youtube")?{conversion:PN,priority:1}:null}}updateDOM(){return!1}getId(){return this.__id}getTextContent(s,n){return`https://www.youtube.com/watch?v=${this.__id}`}decorate(s,n){const r=n.theme.embedBlock||{},a={base:r.base||"",focus:r.focus||""};return e.jsx(ON,{className:a,format:this.__format,nodeKey:this.getKey(),videoID:this.__id})}isInline(){return!1}}function $c(t){return new yr(t)}const gh=ee.createCommand("INSERT_YOUTUBE_COMMAND");function DN(){const[t]=xt.useLexicalComposerContext();return b.useEffect(()=>{if(!t.hasNodes([yr]))throw new Error("YouTubePlugin: YouTubeNode not registered on editor");return t.registerCommand(gh,s=>{const n=$c(s);return yt.$insertNodeToNearestRoot(n),!0},ee.COMMAND_PRIORITY_EDITOR)},[t]),null}const RN={contentName:"Youtube Video",exampleUrl:"https://www.youtube.com/watch?v=jNQXAC9IVRw",icon:e.jsx("i",{className:"icon youtube"}),insertNode:(t,s)=>{t.dispatchCommand(gh,s.id)},keywords:["youtube","video"],parseUrl:async t=>{const s=/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/.exec(t),n=s&&(s==null?void 0:s[2].length)===11?s[2]:null;return n!=null?{id:n,url:t}:null},type:"youtube-video"},xh=[RN];function FN({index:t,isSelected:s,onClick:n,onMouseEnter:r,option:a}){let l="item";return s&&(l+=" selected"),e.jsx("li",{tabIndex:-1,className:l,ref:a.setRefElement,role:"option","aria-selected":s,id:"typeahead-item-"+t,onMouseEnter:r,onClick:n,children:e.jsx("span",{className:"text",children:a.title})},a.key)}function VN({options:t,selectedItemIndex:s,onOptionClick:n,onOptionMouseEnter:r}){return e.jsx("div",{className:"typeahead-popover",children:e.jsx("ul",{children:t.map((a,l)=>e.jsx(FN,{index:l,isSelected:s===l,onClick:()=>n(a,l),onMouseEnter:()=>r(l),option:a},a.key))})})}const HN=(t,s)=>{let n;return r=>{window.clearTimeout(n),n=window.setTimeout(()=>{t(r)},s)}};function zN({embedConfig:t,onClose:s}){const[n,r]=b.useState(""),[a]=xt.useLexicalComposerContext(),[l,i]=b.useState(null),c=b.useMemo(()=>HN(u=>{const p=Ka.URL_MATCHER.exec(u);t!=null&&u!=null&&p!=null?Promise.resolve(t.parseUrl(u)).then(m=>{i(m)}):l!=null&&i(null)},200),[t,l]),d=()=>{l!=null&&(t.insertNode(a,l),s())};return e.jsxs("div",{style:{width:"600px"},children:[e.jsx("div",{className:"Input__wrapper",children:e.jsx("input",{type:"text",className:"Input__input",placeholder:t.exampleUrl,value:n,"data-test-id":`${t.type}-embed-modal-url`,onChange:u=>{const{value:p}=u.target;r(p),c(p)}})}),e.jsx(sl,{children:e.jsx(ga,{disabled:!l,onClick:d,"data-test-id":`${t.type}-embed-modal-submit-btn`,children:"Embed"})})]})}function UN(){const[t,s]=xr(),n=a=>{s(`Embed ${a.contentName}`,l=>e.jsx(zN,{embedConfig:a,onClose:l}))},r=(a,l,i)=>[new Ka.AutoEmbedOption("Dismiss",{onSelect:i}),new Ka.AutoEmbedOption(`Embed ${a.contentName}`,{onSelect:l})];return e.jsxs(e.Fragment,{children:[t,e.jsx(Ka.LexicalAutoEmbedPlugin,{embedConfigs:xh,onOpenEmbedModalForConfig:n,getMenuOptions:r,menuRenderFn:(a,{selectedIndex:l,options:i,selectOptionAndCleanUp:c,setHighlightedIndex:d})=>a.current?ks.createPortal(e.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:a.current.style.width,width:200},children:e.jsx(VN,{options:i,selectedItemIndex:l,onOptionClick:(u,p)=>{d(p),c(u)},onOptionMouseEnter:u=>{d(u)}})}),a.current):null})]})}const WN=/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,GN=/(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/,JN=[ii.createLinkMatcherWithRegExp(WN,t=>t.startsWith("http")?t:`https://${t}`),ii.createLinkMatcherWithRegExp(GN,t=>`mailto:${t}`)];function qN(){return e.jsx(ii.AutoLinkPlugin,{matchers:JN})}function Yd({filter:t,newTab:s=!1}){const[n]=xt.useLexicalComposerContext();return b.useEffect(()=>{function r(a){const l=a,i=KN(l,n);if(i===null)return;const c=i.getAttribute("href");if(i.getAttribute("contenteditable")==="false"||c===void 0)return;const d=n.getEditorState().read(ee.$getSelection);if(ee.$isRangeSelection(d)&&!d.isCollapsed())return;let u=null;if(n.update(()=>{const p=ee.$getNearestNodeFromDOMNode(i);_t.$isLinkNode(p)&&(u=p)}),!(u===null||t!==void 0&&!t(l,u)))try{if(c!==null){const p=l.type==="auxclick"&&l.button===1;window.open(c,s||l.metaKey||l.ctrlKey||p?"_blank":"_self"),l.preventDefault()}}catch{}}return n.registerRootListener((a,l)=>{l!==null&&(l.removeEventListener("click",r),l.removeEventListener("auxclick",r)),a!==null&&(a.addEventListener("click",r),a.addEventListener("auxclick",r))})},[n,t,s]),null}function Zd(t){return t.nodeName.toLowerCase()==="a"}function KN(t,s){return s.getEditorState().read(()=>{const n=t.target;return Zd(n)?n:n.parentNode&&Zd(n.parentNode)?n.parentNode:null})}function YN(){const[t]=xt.useLexicalComposerContext();return b.useEffect(()=>Dt.registerCodeHighlighting(t),[t]),null}function ZN(t){const s=t.open!==void 0?t.open:!0;return{node:Ec(s)}}class An extends ee.ElementNode{constructor(s,n){super(n),this.__open=s}static getType(){return"collapsible-container"}static clone(s){return new An(s.__open,s.__key)}createDOM(s,n){const r=document.createElement("details");return r.classList.add("Collapsible__container"),r.open=this.__open,r.addEventListener("toggle",()=>{n.getEditorState().read(()=>this.getOpen())!==r.open&&n.update(()=>this.toggleOpen())}),r}updateDOM(s,n){return s.__open!==this.__open&&(n.open=this.__open),!1}static importDOM(){return{details:s=>({conversion:ZN,priority:1})}}static importJSON(s){return Ec(s.open)}exportDOM(){const s=document.createElement("details");return s.setAttribute("open",this.__open.toString()),{element:s}}exportJSON(){return{...super.exportJSON(),open:this.__open,type:"collapsible-container",version:1}}setOpen(s){const n=this.getWritable();n.__open=s}getOpen(){return this.getLatest().__open}toggleOpen(){this.setOpen(!this.getOpen())}}function Ec(t){return new An(t)}function As(t){return t instanceof An}function XN(t){return{node:kc()}}class On extends ee.ElementNode{static getType(){return"collapsible-content"}static clone(s){return new On(s.__key)}createDOM(s){const n=document.createElement("div");return n.classList.add("Collapsible__content"),n}updateDOM(s,n){return!1}static importDOM(){return{div:s=>s.hasAttribute("data-lexical-collapsible-content")?{conversion:XN,priority:2}:null}}exportDOM(){const s=document.createElement("div");return s.setAttribute("data-lexical-collapsible-content","true"),{element:s}}static importJSON(s){return kc()}isShadowRoot(){return!0}exportJSON(){return{...super.exportJSON(),type:"collapsible-content",version:1}}}function kc(){return new On}function bh(t){return t instanceof On}function QN(t){return{node:Lc()}}class Pn extends ee.ElementNode{static getType(){return"collapsible-title"}static clone(s){return new Pn(s.__key)}createDOM(s,n){const r=document.createElement("summary");return r.classList.add("Collapsible__title"),r.classList.add("w-full","font-sans","font-medium","text-md","uppercase"),r.classList.add("tracking-wider","py-1","pl-5"),r}updateDOM(s,n){return!1}static importDOM(){return{summary:s=>({conversion:QN,priority:1})}}static importJSON(s){return Lc()}exportDOM(){return{element:document.createElement("summary")}}exportJSON(){return{...super.exportJSON(),type:"collapsible-title",version:1}}collapseAtStart(s){return this.getParentOrThrow().insertBefore(this),!0}insertNewAfter(s,n=!0){const r=this.getParentOrThrow();if(!As(r))throw new Error("CollapsibleTitleNode expects to be child of CollapsibleContainerNode");if(r.getOpen()){const a=this.getNextSibling();if(!bh(a))throw new Error("CollapsibleTitleNode expects to have CollapsibleContentNode sibling");const l=a.getFirstChild();if(ee.$isElementNode(l))return l;{const i=ee.$createParagraphNode();return a.append(i),i}}else{const a=ee.$createParagraphNode();return r.insertAfter(a,n),a}}}function Lc(){return new Pn}function Xd(t){return t instanceof Pn}const Ic=ee.createCommand();ee.createCommand();function eC(){const[t]=xt.useLexicalComposerContext();return b.useEffect(()=>{if(!t.hasNodes([An,Pn,On]))throw new Error("CollapsiblePlugin: CollapsibleContainerNode, CollapsibleTitleNode, or CollapsibleContentNode not registered on editor");const s=()=>{var a;const r=ee.$getSelection();if(ee.$isRangeSelection(r)&&r.isCollapsed()&&r.anchor.offset===0){const l=yt.$findMatchingParent(r.anchor.getNode(),As);if(As(l)){const i=l.getParent();i!==null&&i.getFirstChild()===l&&r.anchor.key===((a=l.getFirstDescendant())==null?void 0:a.getKey())&&l.insertBefore(ee.$createParagraphNode())}}return!1},n=()=>{const r=ee.$getSelection();if(ee.$isRangeSelection(r)&&r.isCollapsed()){const a=yt.$findMatchingParent(r.anchor.getNode(),As);if(As(a)){const l=a.getParent();if(l!==null&&l.getLastChild()===a){const i=a.getLastDescendant();i!==null&&r.anchor.key===i.getKey()&&r.anchor.offset===i.getTextContentSize()&&a.insertAfter(ee.$createParagraphNode())}}}return!1};return yt.mergeRegister(t.registerNodeTransform(On,r=>{const a=r.getParent();if(!As(a)){const l=r.getChildren();for(const i of l)r.insertBefore(i);r.remove()}}),t.registerNodeTransform(Pn,r=>{const a=r.getParent();if(!As(a)){r.replace(ee.$createParagraphNode().append(...r.getChildren()));return}}),t.registerNodeTransform(An,r=>{const a=r.getChildren();if(a.length!==2||!Xd(a[0])||!bh(a[1])){for(const l of a)r.insertBefore(l);r.remove()}}),t.registerCommand(ee.DELETE_CHARACTER_COMMAND,()=>{const r=ee.$getSelection();if(!ee.$isRangeSelection(r)||!r.isCollapsed()||r.anchor.offset!==0)return!1;const l=r.anchor.getNode().getTopLevelElement();if(l===null)return!1;const i=l.getPreviousSibling();return!As(i)||i.getOpen()?!1:(i.setOpen(!0),!0)},ee.COMMAND_PRIORITY_LOW),t.registerCommand(ee.KEY_ARROW_DOWN_COMMAND,n,ee.COMMAND_PRIORITY_LOW),t.registerCommand(ee.KEY_ARROW_RIGHT_COMMAND,n,ee.COMMAND_PRIORITY_LOW),t.registerCommand(ee.KEY_ARROW_UP_COMMAND,s,ee.COMMAND_PRIORITY_LOW),t.registerCommand(ee.KEY_ARROW_LEFT_COMMAND,s,ee.COMMAND_PRIORITY_LOW),t.registerCommand(ee.INSERT_PARAGRAPH_COMMAND,()=>{var a;const r=(a=t._window)==null?void 0:a.event;if(r&&(r.ctrlKey||r.metaKey)&&r.key==="Enter"){const l=ee.$getPreviousSelection();if(ee.$isRangeSelection(l)&&l.isCollapsed()){const i=yt.$findMatchingParent(l.anchor.getNode(),c=>ee.$isElementNode(c)&&!c.isInline());if(Xd(i)){const c=i.getParent();if(As(c))return c.toggleOpen(),ee.$setSelection(l.clone()),!0}}}return!1},ee.COMMAND_PRIORITY_LOW),t.registerCommand(Ic,()=>(t.update(()=>{const r=Lc();yt.$insertNodeToNearestRoot(Ec(!0).append(r,kc().append(ee.$createParagraphNode()))),r.select()}),!0),ee.COMMAND_PRIORITY_LOW))},[t]),null}const $l={};function tC({accept:t,label:s,onChange:n,"data-test-id":r}){return e.jsxs("div",{className:`${$l.Input__wrapper}`,children:[e.jsx("label",{className:`${$l.Input__label}`,children:s}),e.jsx("input",{type:"file",accept:t,className:`${$l.Input__input}`,onChange:a=>n(a.target.files),"data-test-id":r})]})}function sC({children:t,label:s,className:n,...r}){return e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("label",{style:{marginTop:"-1em"},className:"Input__label",children:s}),e.jsx("select",{...r,className:n||"min-w-[160px] max-w-[290px] border-[1px] border-[solid] border-[#393939] rounded-[0.25em] px-[0.5em] py-[0.25em] text-[1rem] cursor-pointer leading-[1.4] bg-[linear-gradient(to_bottom,_#ffffff_0%,_#e5e5e5_100%)]",children:t})]})}const El={};function xa({label:t,value:s,onChange:n,placeholder:r="","data-test-id":a,type:l="text"}){return e.jsxs("div",{className:`${El.Input__wrapper}`,children:[e.jsx("label",{className:`${El.Input__label}`,children:t}),e.jsx("input",{type:l,className:`${El.Input__input}`,placeholder:r,onChange:i=>n(i.target.files),"data-test-id":a})]})}const nC=t=>gr?(t||window).getSelection():null,nl=ee.createCommand("INSERT_INLINE_IMAGE_COMMAND");function yh({activeEditor:t,onClose:s}){const n=b.useRef(!1),[r,a]=b.useState(""),[l,i]=b.useState(""),[c,d]=b.useState(!1),[u,p]=b.useState("left"),m=r==="",h=y=>{d(y.target.checked)},f=y=>{p(y.target.value)},g=y=>{const j=new FileReader;j.onload=function(){return typeof j.result=="string"&&a(j.result),""},y!==null&&j.readAsDataURL(y[0])};b.useEffect(()=>{n.current=!1;const y=j=>{n.current=j.altKey};return document.addEventListener("keydown",y),()=>{document.removeEventListener("keydown",y)}},[t]);const x=()=>{const y={altText:l,position:u,showCaption:c,src:r};t.dispatchCommand(nl,y),s()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"1em"},children:e.jsx(tC,{label:"Image Upload",onChange:g,accept:"image/*","data-test-id":"image-modal-file-upload"})}),e.jsx("div",{style:{marginBottom:"1em"},children:e.jsx(xa,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:i,value:l,"data-test-id":"image-modal-alt-text-input"})}),e.jsxs(sC,{style:{marginBottom:"1em",width:"290px"},label:"Position",name:"position",id:"position-select",onChange:f,children:[e.jsx("option",{value:"left",children:"Left"}),e.jsx("option",{value:"right",children:"Right"}),e.jsx("option",{value:"full",children:"Full Width"})]}),e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("input",{id:"caption",type:"checkbox",checked:c,onChange:h}),e.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),e.jsx(sl,{children:e.jsx(ga,{"data-test-id":"image-modal-file-upload-btn",disabled:m,onClick:()=>x(),children:"Confirm"})})]})}function aC(){const[t]=xt.useLexicalComposerContext();return b.useEffect(()=>{if(!t.hasNodes([mn]))throw new Error("ImagesPlugin: ImageNode not registered on editor");return yt.mergeRegister(t.registerCommand(nl,s=>{const n=tl(s);return ee.$insertNodes([n]),ee.$isRootOrShadowRoot(n.getParentOrThrow())&&yt.$wrapNodeInElement(n,ee.$createParagraphNode).selectEnd(),!0},ee.COMMAND_PRIORITY_EDITOR),t.registerCommand(ee.DRAGSTART_COMMAND,s=>oC(s),ee.COMMAND_PRIORITY_HIGH),t.registerCommand(ee.DRAGOVER_COMMAND,s=>lC(s),ee.COMMAND_PRIORITY_LOW),t.registerCommand(ee.DROP_COMMAND,s=>iC(s,t),ee.COMMAND_PRIORITY_HIGH))},[t]),null}const rC="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",vh=document.createElement("img");vh.src=rC;function oC(t){const s=Tc();if(!s)return!1;const n=t.dataTransfer;return n?(n.setData("text/plain","_"),n.setDragImage(vh,0,0),n.setData("application/x-lexical-drag",JSON.stringify({data:{altText:s.__altText,caption:s.__caption,height:s.__height,key:s.getKey(),showCaption:s.__showCaption,src:s.__src,width:s.__width},type:"image"})),!0):!1}function lC(t){return Tc()?(jh(t)||t.preventDefault(),!0):!1}function iC(t,s){const n=Tc();if(!n)return!1;const r=cC(t);if(!r)return!1;if(t.preventDefault(),jh(t)){const a=dC(t);n.remove();const l=ee.$createRangeSelection();a!=null&&l.applyDOMRange(a),ee.$setSelection(l),s.dispatchCommand(nl,r)}return!0}function Tc(){const t=ee.$getSelection();if(!ee.$isNodeSelection(t))return null;const n=t.getNodes()[0];return dh(n)?n:null}function cC(t){var a;const s=(a=t.dataTransfer)==null?void 0:a.getData("application/x-lexical-drag");if(!s)return null;const{type:n,data:r}=JSON.parse(s);return n!=="image"?null:r}function jh(t){const s=t.target;return!!(s&&s instanceof HTMLElement&&!s.closest("code, span.editor-image")&&s.parentElement&&s.parentElement.closest("div.ContentEditable__root"))}function dC(t){let s;const n=t.target,r=n==null?null:n.nodeType===9?n.defaultView:n.ownerDocument.defaultView,a=nC(r);if(document.caretRangeFromPoint)s=document.caretRangeFromPoint(t.clientX,t.clientY);else if(t.rangeParent&&a!==null)a.collapse(t.rangeParent,t.rangeOffset||0),s=a.getRangeAt(0);else throw Error("Cannot get the selection when dragging");return s}function wh(t,s,...n){if(!t)throw new Error("Internal Lexical error: invariant() is meant to be replaced at compile time. There is no runtime version. Error: "+s)}const uC=new Map,vV=new Map,Nh='{"root":{"children":[{"children":[],"direction":null,"format":"","indent":0,"type":"paragraph","version":1}],"direction":null,"format":"","indent":0,"type":"root","version":1}}',Ch=t=>t===""?Nh:`{"root":{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":${t},"type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1}],"direction":"ltr","format":"","indent":0,"type":"root","version":1}}`,mC=b.lazy(()=>ch(()=>import("./TableComponent-BcqgjVAs.js"),__vite__mapDeps([3,1,2])));function _h(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function yn(t){return{colSpan:1,id:_h(),json:Nh,type:t,width:null}}function sr(){return{cells:[],height:null,id:_h()}}function jV(t){const s=t.querySelectorAll("tr"),n=[];for(let r=0;r<s.length;r++){const l=s[r].querySelectorAll("td,th");if(!l||l.length===0)continue;const i=[];for(let d=0;d<l.length;d++){const u=l[d],p=u.nodeName==="TH",m=yn(p?"header":"normal");m.json=Ch(JSON.stringify(u.innerText.replace(/\n/g," "))),i.push(m)}const c=sr();c.cells=i,n.push(c)}return n}function pC(t){const s=t.querySelectorAll("tr");if(!s||s.length===0)return null;const n=[];for(let r=0;r<s.length;r++){const l=s[r].querySelectorAll("td,th");if(!l||l.length===0)continue;const i=[];for(let d=0;d<l.length;d++){const u=l[d],p=u.nodeName==="TH",m=yn(p?"header":"normal");m.json=Ch(JSON.stringify(u.innerText.replace(/\n/g," "))),i.push(m)}const c=sr();c.cells=i,n.push(c)}return{node:Sh(n)}}function hC(t,s){const n=document.createElement("table"),r=document.createElement("colgroup"),a=document.createElement("tbody"),l=t[0];for(let i=s!=null?s.startX:0;i<(s!=null?s.endX+1:l.cells.length);i++){const c=document.createElement("col");r.append(c)}for(let i=s!=null?s.startY:0;i<(s!=null?s.endY+1:t.length);i++){const d=t[i].cells,u=document.createElement("tr");for(let p=s!=null?s.startX:0;p<(s!=null?s.endX+1:d.length);p++){const m=d[p],h=document.createElement(m.type==="header"?"th":"td");h.innerHTML=uC.get(m.json)||"",u.appendChild(h)}a.appendChild(u)}return n.appendChild(r),n.appendChild(a),n}class Gn extends ee.DecoratorNode{static getType(){return"tablesheet"}static clone(s){return new Gn(Array.from(s.__rows),s.__key)}static importJSON(s){return Sh(s.rows)}exportJSON(){return{rows:this.__rows,type:"tablesheet",version:1}}static importDOM(){return{table:s=>({conversion:pC,priority:0})}}exportDOM(){return{element:hC(this.__rows)}}constructor(s,n){super(n),this.__rows=s||[]}createDOM(){return document.createElement("div")}updateDOM(){return!1}mergeRows(s,n,r){const l=this.getWritable().__rows,i=Math.min(l.length,n+r.length);for(let c=n;c<i;c++){const d=l[c],u=r[c-n],p=d.cells,m=Array.from(p),h={...d,cells:m},f=u.cells,g=Math.min(p.length,s+f.length);for(let x=s;x<g;x++){const y=p[x],j=f[x-s],N={...y,json:j.json,type:j.type};m[x]=N}l[c]=h}}updateCellJSON(s,n,r){const l=this.getWritable().__rows,i=l[n],c=i.cells,d=c[s],u=Array.from(c),p={...d,json:r},m={...i,cells:u};u[s]=p,l[n]=m}updateCellType(s,n,r){const l=this.getWritable().__rows,i=l[n],c=i.cells,d=c[s],u=Array.from(c),p={...d,type:r},m={...i,cells:u};u[s]=p,l[n]=m}insertColumnAt(s){const r=this.getWritable().__rows;for(let a=0;a<r.length;a++){const l=r[a],i=l.cells,c=Array.from(i),d={...l,cells:c},u=(i[s]||i[s-1]).type;c.splice(s,0,yn(u)),r[a]=d}}deleteColumnAt(s){const r=this.getWritable().__rows;for(let a=0;a<r.length;a++){const l=r[a],i=l.cells,c=Array.from(i),d={...l,cells:c};c.splice(s,1),r[a]=d}}addColumns(s){const r=this.getWritable().__rows;for(let a=0;a<r.length;a++){const l=r[a],i=l.cells,c=Array.from(i),d={...l,cells:c},u=i[i.length-1].type;for(let p=0;p<s;p++)c.push(yn(u));r[a]=d}}insertRowAt(s){const r=this.getWritable().__rows,a=r[s]||r[s-1],l=a.cells.length,i=sr();for(let c=0;c<l;c++){const d=yn(a.cells[c].type);i.cells.push(d)}r.splice(s,0,i)}deleteRowAt(s){this.getWritable().__rows.splice(s,1)}addRows(s){const r=this.getWritable().__rows,a=r[r.length-1],l=a.cells.length;for(let i=0;i<s;i++){const c=sr();for(let d=0;d<l;d++){const u=yn(a.cells[d].type);c.cells.push(u)}r.push(c)}}updateColumnWidth(s,n){const a=this.getWritable().__rows;for(let l=0;l<a.length;l++){const i=a[l],c=i.cells,d=Array.from(c),u={...i,cells:d};d[s].width=n,a[l]=u}}decorate(s,n){return e.jsx(b.Suspense,{children:e.jsx(mC,{nodeKey:this.__key,theme:n.theme,rows:this.__rows})})}isInline(){return!1}}function wV(t){return t instanceof Gn}function Sh(t){return new Gn(t)}function fC(t,s,n=!0){const r=[];for(let a=0;a<s;a++){const l=sr();r.push(l);for(let i=0;i<t;i++)l.cells.push(yn(n===!0&&(a===0||i===0)?"header":"normal"))}return new Gn(r)}const $h=ee.createCommand("INSERT_NEW_TABLE_COMMAND"),gC=b.createContext({cellEditorConfig:null,cellEditorPlugins:null,set:()=>{}});function Eh({activeEditor:t,onClose:s}){const[n,r]=b.useState("5"),[a,l]=b.useState("5"),[i,c]=b.useState(!0);b.useEffect(()=>{const u=Number(n),p=Number(a);u&&u>0&&u<=500&&p&&p>0&&p<=50?c(!1):c(!0)},[n,a]);const d=()=>{t.dispatchCommand(Se.INSERT_TABLE_COMMAND,{columns:a,rows:n}),s()};return e.jsxs(e.Fragment,{children:[e.jsx(xa,{placeholder:"# of rows (1-500)",label:"Rows",onChange:r,value:n,"data-test-id":"table-modal-rows",type:"number"}),e.jsx(xa,{placeholder:"# of columns (1-50)",label:"Columns",onChange:l,value:a,"data-test-id":"table-modal-columns",type:"number"}),e.jsx(sl,{"data-test-id":"table-model-confirm-insert",children:e.jsx(ga,{disabled:i,onClick:d,children:"Confirm"})})]})}function xC({activeEditor:t,onClose:s}){const[n,r]=b.useState(""),[a,l]=b.useState(""),[i,c]=b.useState(!0);b.useEffect(()=>{const u=Number(n),p=Number(a);u&&u>0&&u<=500&&p&&p>0&&p<=50?c(!1):c(!0)},[n,a]);const d=()=>{t.dispatchCommand($h,{columns:a,rows:n}),s()};return e.jsxs(e.Fragment,{children:[e.jsx(xa,{placeholder:"# of rows (1-500)",label:"Rows",onChange:r,value:n,"data-test-id":"table-modal-rows",type:"number"}),e.jsx(xa,{placeholder:"# of columns (1-50)",label:"Columns",onChange:l,value:a,"data-test-id":"table-modal-columns",type:"number"}),e.jsx(sl,{"data-test-id":"table-model-confirm-insert",children:e.jsx(ga,{disabled:i,onClick:d,children:"Confirm"})})]})}function bC({cellEditorConfig:t,children:s}){const[n]=xt.useLexicalComposerContext(),r=b.useContext(gC);return b.useEffect(()=>(n.hasNodes([Gn])||wh(!1,"TablePlugin: TableNode is not registered on editor"),r.set(t,s),n.registerCommand($h,({columns:a,rows:l,includeHeaders:i})=>{const c=fC(Number(l),Number(a),i);return ee.$insertNodes([c]),!0},ee.COMMAND_PRIORITY_EDITOR)),[r,t,s,n]),null}class Jt extends ci.MenuOption{constructor(s,n){super(s),this.title=s,this.keywords=n.keywords||[],this.icon=n.icon,this.keyboardShortcut=n.keyboardShortcut,this.onSelect=n.onSelect.bind(this)}}function yC({index:t,isSelected:s,onClick:n,onMouseEnter:r,option:a}){let l="item";return s&&(l+=" selected"),e.jsxs("li",{tabIndex:-1,className:l,ref:a.setRefElement,role:"option","aria-selected":s,id:"typeahead-item-"+t,onMouseEnter:r,onClick:n,children:[a.icon,e.jsx("span",{className:"text",children:a.title})]},a.key)}function vC(t,s){const n=[];if(s==null)return n;const r=s.match(/^([1-9]\d?)(?:x([1-9]\d?)?)?$/);if(r!==null){const a=r[1],l=r[2]?[r[2]]:[1,2,3,4,5,6,7,8,9,10].map(String);n.push(...l.map(i=>new Jt(`${a}x${i} Table`,{icon:e.jsx("i",{className:"icon table"}),keywords:["table"],onSelect:()=>t.dispatchCommand(Se.INSERT_TABLE_COMMAND,{columns:i,rows:a})})))}return n}function jC(t,s){return[new Jt("Paragraph",{icon:e.jsx("i",{className:"icon paragraph"}),keywords:["normal","paragraph","p","text"],onSelect:()=>t.update(()=>{const n=ee.$getSelection();ee.$isRangeSelection(n)&&Ot.$setBlocksType(n,()=>ee.$createParagraphNode())})}),...[1,2,3,4].map(n=>new Jt(`Heading ${n}`,{icon:e.jsx("i",{className:`icon h${n}`}),keywords:["heading","header",`h${n}`],onSelect:()=>t.update(()=>{const r=ee.$getSelection();ee.$isRangeSelection(r)&&Ot.$setBlocksType(r,()=>es.$createHeadingNode(`h${n}`))})})),new Jt("Table",{icon:e.jsx("i",{className:"icon table"}),keywords:["table","grid","spreadsheet","rows","columns"],onSelect:()=>s("Insert Table",n=>e.jsx(Eh,{activeEditor:t,onClose:n}))}),...xh.map(n=>new Jt(`Embed ${n.contentName}`,{icon:n.icon,keywords:[...n.keywords,"embed"],onSelect:()=>t.dispatchCommand(Ka.INSERT_EMBED_COMMAND,n.type)})),new Jt("Numbered List",{icon:e.jsx("i",{className:"icon number"}),keywords:["numbered list","ordered list","ol"],onSelect:()=>t.dispatchCommand(Pt.INSERT_ORDERED_LIST_COMMAND,void 0)}),new Jt("Bulleted List",{icon:e.jsx("i",{className:"icon bullet"}),keywords:["bulleted list","unordered list","ul"],onSelect:()=>t.dispatchCommand(Pt.INSERT_UNORDERED_LIST_COMMAND,void 0)}),new Jt("Check List",{icon:e.jsx("i",{className:"icon check"}),keywords:["check list","todo list"],onSelect:()=>t.dispatchCommand(Pt.INSERT_CHECK_LIST_COMMAND,void 0)}),new Jt("Quote",{icon:e.jsx("i",{className:"icon quote"}),keywords:["block quote"],onSelect:()=>t.update(()=>{const n=ee.$getSelection();ee.$isRangeSelection(n)&&Ot.$setBlocksType(n,()=>es.$createQuoteNode())})}),new Jt("Code",{icon:e.jsx("i",{className:"icon code"}),keywords:["javascript","python","js","codeblock"],onSelect:()=>t.update(()=>{const n=ee.$getSelection();if(ee.$isRangeSelection(n))if(n.isCollapsed())Ot.$setBlocksType(n,()=>Dt.$createCodeNode());else{const r=n.getTextContent(),a=Dt.$createCodeNode();n.insertNodes([a]),n.insertRawText(r)}})}),new Jt("Divider",{icon:e.jsx("i",{className:"icon horizontal-rule"}),keywords:["horizontal rule","divider","hr"],onSelect:()=>t.dispatchCommand(la.INSERT_HORIZONTAL_RULE_COMMAND,void 0)}),new Jt("Image",{icon:e.jsx("i",{className:"icon image"}),keywords:["image","photo","picture","file"],onSelect:()=>s("Insert Image",n=>e.jsx(yh,{activeEditor:t,onClose:n}))}),new Jt("Collapsible",{icon:e.jsx("i",{className:"icon caret-right"}),keywords:["collapse","collapsible","toggle"],onSelect:()=>t.dispatchCommand(Ic,void 0)}),...["left","center","right","justify"].map(n=>new Jt(`Align ${n}`,{icon:e.jsx("i",{className:`icon ${n}-align`}),keywords:["align","justify",n],onSelect:()=>t.dispatchCommand(ee.FORMAT_ELEMENT_COMMAND,n)}))]}function wC(){const[t]=xt.useLexicalComposerContext(),[s,n]=xr(),[r,a]=b.useState(null),l=ci.useBasicTypeaheadTriggerMatch("/",{minLength:0}),i=b.useMemo(()=>{const d=jC(t,n);if(!r)return d;const u=new RegExp(r,"i");return[...vC(t,r),...d.filter(p=>u.test(p.title)||p.keywords.some(m=>u.test(m)))]},[t,r,n]),c=b.useCallback((d,u,p,m)=>{t.update(()=>{u==null||u.remove(),d.onSelect(m),p()})},[t]);return e.jsxs(e.Fragment,{children:[s,e.jsx(ci.LexicalTypeaheadMenuPlugin,{onQueryChange:a,onSelectOption:c,triggerFn:l,options:i,menuRenderFn:(d,{selectedIndex:u,selectOptionAndCleanUp:p,setHighlightedIndex:m})=>d.current&&i.length?ks.createPortal(e.jsx("div",{className:"typeahead-popover component-picker-menu",children:e.jsx("ul",{children:i.map((h,f)=>e.jsx(yC,{index:f,isSelected:u===f,onClick:()=>{m(f),p(h)},onMouseEnter:()=>{m(f)},option:h},h.key))})}),d.current):null})]})}const Qd=["image/","image/heic","image/heif","image/gif","image/webp"];function NC(){const[t]=xt.useLexicalComposerContext();return b.useEffect(()=>t.registerCommand(es.DRAG_DROP_PASTE,s=>((async()=>{const n=await yt.mediaFileReader(s,[Qd].flatMap(r=>r));for(const{file:r,result:a}of n)yt.isMimeType(r,Qd)&&t.dispatchCommand(nl,{altText:r.name,src:a})})(),!0),ee.COMMAND_PRIORITY_LOW),[t]),null}function kl(t){return t instanceof HTMLElement}class kh{constructor(s,n){this._x=s,this._y=n}get x(){return this._x}get y(){return this._y}equals({x:s,y:n}){return this.x===s&&this.y===n}calcDeltaXTo({x:s}){return this.x-s}calcDeltaYTo({y:s}){return this.y-s}calcHorizontalDistanceTo(s){return Math.abs(this.calcDeltaXTo(s))}calcVerticalDistance(s){return Math.abs(this.calcDeltaYTo(s))}calcDistanceTo(s){return Math.sqrt(Math.pow(this.calcDeltaXTo(s),2)+Math.pow(this.calcDeltaYTo(s),2))}}function CC(t){return t instanceof kh}let _C=class sa{constructor(s,n,r,a){const[l,i]=n<=a?[n,a]:[a,n],[c,d]=s<=r?[s,r]:[r,s];this._top=l,this._right=d,this._left=c,this._bottom=i}get top(){return this._top}get right(){return this._right}get bottom(){return this._bottom}get left(){return this._left}get width(){return Math.abs(this._left-this._right)}get height(){return Math.abs(this._bottom-this._top)}equals({top:s,left:n,bottom:r,right:a}){return s===this._top&&r===this._bottom&&n===this._left&&a===this._right}contains(s){if(CC(s)){const{x:n,y:r}=s,a=r<this._top,l=r>this._bottom,i=n<this._left,c=n>this._right;return{reason:{isOnBottomSide:l,isOnLeftSide:i,isOnRightSide:c,isOnTopSide:a},result:!a&&!l&&!i&&!c}}else{const{top:n,left:r,bottom:a,right:l}=s;return n>=this._top&&n<=this._bottom&&a>=this._top&&a<=this._bottom&&r>=this._left&&r<=this._right&&l>=this._left&&l<=this._right}}intersectsWith(s){const{left:n,top:r,width:a,height:l}=s,{left:i,top:c,width:d,height:u}=this,p=n+a>=i+d?n+a:i+d,m=r+l>=c+u?r+l:c+u,h=n<=i?n:i,f=r<=c?r:c;return p-h<=a+d&&m-f<=l+u}generateNewRect({left:s=this.left,top:n=this.top,right:r=this.right,bottom:a=this.bottom}){return new sa(s,n,r,a)}static fromLTRB(s,n,r,a){return new sa(s,n,r,a)}static fromLWTH(s,n,r,a){return new sa(s,r,s+n,r+a)}static fromPoints(s,n){const{y:r,x:a}=s,{y:l,x:i}=n;return sa.fromLTRB(a,r,i,l)}static fromDOM(s){const{top:n,width:r,left:a,height:l}=s.getBoundingClientRect();return sa.fromLWTH(a,r,n,l)}};const xi=4,SC=2,$C="draggable-block-menu",eu="application/x-lexical-drag-block",tu=28,EC=1,kC=-1,su=0;let Zr=1/0;function LC(t){return t===0?1/0:Zr>=0&&Zr<t?Zr:Math.floor(t/2)}function IC(t){return t.getEditorState().read(()=>ee.$getRoot().getChildrenKeys())}function Lh(t){const s=(d,u)=>d?parseFloat(window.getComputedStyle(d)[u]):0,{marginTop:n,marginBottom:r}=window.getComputedStyle(t),a=s(t.previousElementSibling,"marginBottom"),l=s(t.nextElementSibling,"marginTop"),i=Math.max(parseFloat(n),a);return{marginBottom:Math.max(parseFloat(r),l),marginTop:i}}function Ll(t,s,n,r=!1){const a=t.getBoundingClientRect(),l=IC(s);let i=null;return s.getEditorState().read(()=>{if(r){const[u,p]=[s.getElementByKey(l[0]),s.getElementByKey(l[l.length-1])],[m,h]=[u==null?void 0:u.getBoundingClientRect(),p==null?void 0:p.getBoundingClientRect()];if(m&&h&&(n.y<m.top?i=u:n.y>h.bottom&&(i=p),i))return}let c=LC(l.length),d=su;for(;c>=0&&c<l.length;){const u=l[c],p=s.getElementByKey(u);if(p===null)break;const m=new kh(n.x,n.y),h=_C.fromDOM(p),{marginTop:f,marginBottom:g}=Lh(p),x=h.generateNewRect({bottom:h.bottom+g,left:a.left,right:a.right,top:h.top-f}),{result:y,reason:{isOnTopSide:j,isOnBottomSide:N}}=x.contains(m);if(y){i=p,Zr=c;break}d===su&&(j?d=kC:N?d=EC:d=1/0),c+=d}}),i}function TC(t){return!!t.closest(`.${$C}`)}function MC(t,s,n){if(!t){s.style.opacity="0",s.style.transform="translate(-10000px, -10000px)";return}const r=t.getBoundingClientRect(),a=window.getComputedStyle(t),l=s.getBoundingClientRect(),i=n.getBoundingClientRect(),c=r.top+(parseInt(a.lineHeight,10)-l.height)/2-i.top,d=xi;s.style.opacity="1",s.style.transform=`translate(${d}px, ${c}px)`}function BC(t,s){const{transform:n}=s.style;s.style.transform="translateZ(0)",t.setDragImage(s,0,0),setTimeout(()=>{s.style.transform=n})}function AC(t,s,n,r){const{top:a,height:l}=s.getBoundingClientRect(),{top:i,width:c}=r.getBoundingClientRect(),{marginTop:d,marginBottom:u}=Lh(s);let p=a;n>=a?p+=l+u/2:p-=d/2;const m=p-i-SC,h=tu-xi;t.style.transform=`translate(${h}px, ${m}px)`,t.style.width=`${c-(tu-xi)*2}px`,t.style.opacity=".4"}function OC(t){t&&(t.style.opacity="0",t.style.transform="translate(-10000px, -10000px)")}function PC(t,s,n){const r=s.parentElement,a=b.useRef(null),l=b.useRef(null),i=b.useRef(!1),[c,d]=b.useState(null);b.useEffect(()=>{function m(f){const g=f.target;if(!kl(g)){d(null);return}if(TC(g))return;const x=Ll(s,t,f);d(x)}function h(){d(null)}return r==null||r.addEventListener("mousemove",m),r==null||r.addEventListener("mouseleave",h),()=>{r==null||r.removeEventListener("mousemove",m),r==null||r.removeEventListener("mouseleave",h)}},[r,s,t]),b.useEffect(()=>{a.current&&MC(c,a.current,s)},[s,c]),b.useEffect(()=>{function m(f){if(!i.current)return!1;const[g]=es.eventFiles(f);if(g)return!1;const{pageY:x,target:y}=f;if(!kl(y))return!1;const j=Ll(s,t,f,!0),N=l.current;return j===null||N===null?!1:(AC(N,j,x,s),f.preventDefault(),!0)}function h(f){if(!i.current)return!1;const[g]=es.eventFiles(f);if(g)return!1;const{target:x,dataTransfer:y,pageY:j}=f,N=(y==null?void 0:y.getData(eu))||"",_=ee.$getNodeByKey(N);if(!_||!kl(x))return!1;const E=Ll(s,t,f,!0);if(!E)return!1;const L=ee.$getNearestNodeFromDOMNode(E);if(!L)return!1;if(L===_)return!0;const S=E.getBoundingClientRect().top;return j>=S?L.insertAfter(_):L.insertBefore(_),d(null),!0}return yt.mergeRegister(t.registerCommand(ee.DRAGOVER_COMMAND,f=>m(f),ee.COMMAND_PRIORITY_LOW),t.registerCommand(ee.DROP_COMMAND,f=>h(f),ee.COMMAND_PRIORITY_HIGH))},[s,t]);function u(m){const h=m.dataTransfer;if(!h||!c)return;BC(h,c);let f="";t.update(()=>{const g=ee.$getNearestNodeFromDOMNode(c);g&&(f=g.getKey())}),i.current=!0,h.setData(eu,f)}function p(){i.current=!1,OC(l.current)}return ks.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"icon draggable-block-menu",ref:a,draggable:!0,onDragStart:u,onDragEnd:p,children:e.jsx("div",{className:n?"icon":""})}),e.jsx("div",{className:"draggable-block-target-line",ref:l})]}),s)}function DC({anchorElem:t=document.body}){const[s]=xt.useLexicalComposerContext();return PC(s,t,s._editable)}function nr(t){const s=t.anchor,n=t.focus,r=t.anchor.getNode(),a=t.focus.getNode();return r===a?r:t.isBackward()?Ot.$isAtNodeEnd(n)?r:a:Ot.$isAtNodeEnd(s)?r:a}const RC=10,FC=5;function nu(t,s,n,r=RC,a=FC){const l=n.parentElement;if(t===null||!l){s.style.opacity="0",s.style.transform="translate(-10000px, -10000px)";return}const i=s.getBoundingClientRect(),c=n.getBoundingClientRect(),d=l.getBoundingClientRect();let u=t.top-r,p=t.left-a;u<d.top&&(u+=i.height+t.height+r*2),p+i.width>d.right&&(p=d.right-i.width-a),u-=c.top,p-=c.left,s.style.opacity="1",s.style.transform=`translate(${p}px, ${u}px)`}function VC(t){return!0}function HC({editor:t,isLink:s,setIsLink:n,anchorElem:r,isLinkEditMode:a,setIsLinkEditMode:l}){const i=b.useRef(null),c=b.useRef(null),[d,u]=b.useState(""),[p,m]=b.useState("https://"),[h,f]=b.useState(null),g=b.useCallback(()=>{var S,k;const j=ee.$getSelection();if(ee.$isRangeSelection(j)){const $=nr(j),I=$.getParent();_t.$isLinkNode(I)?u(I.getURL()):_t.$isLinkNode($)?u($.getURL()):u("")}const N=i.current,_=window.getSelection(),E=document.activeElement;if(N===null)return;const L=t.getRootElement();if(j!==null&&_!==null&&L!==null&&L.contains(_.anchorNode)&&t.isEditable()){const $=(k=(S=_.focusNode)==null?void 0:S.parentElement)==null?void 0:k.getBoundingClientRect();$&&($.y+=40,nu($,N,r)),f(j)}else(!E||E.className!=="link-input")&&(L!==null&&nu(null,N,r),f(null),l&&l(!1),u(""));return!0},[r,t,l]);b.useEffect(()=>{const j=r.parentElement,N=()=>{t.getEditorState().read(()=>{g()})};return window.addEventListener("resize",N),j&&j.addEventListener("scroll",N),()=>{window.removeEventListener("resize",N),j&&j.removeEventListener("scroll",N)}},[r.parentElement,t,g]),b.useEffect(()=>yt.mergeRegister(t.registerUpdateListener(({editorState:j})=>{j.read(()=>{g()})}),t.registerCommand(ee.SELECTION_CHANGE_COMMAND,()=>(g(),!0),ee.COMMAND_PRIORITY_LOW),t.registerCommand(ee.KEY_ESCAPE_COMMAND,()=>s?(n(!1),!0):!1,ee.COMMAND_PRIORITY_HIGH)),[t,g,n,s]),b.useEffect(()=>{t.getEditorState().read(()=>{g()})},[t,g]),b.useEffect(()=>{a&&c.current&&c.current.focus()},[a,s]);const x=j=>{j.key==="Enter"?(j.preventDefault(),y()):j.key==="Escape"&&(j.preventDefault(),l&&l(!1))},y=()=>{h!==null&&(d!==""&&t.dispatchCommand(_t.TOGGLE_LINK_COMMAND,p),m("https://"),l&&l(!1))};return e.jsx("div",{ref:i,className:"link-editor",children:s?a?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:c,className:"link-input",value:p,onChange:j=>{m(j.target.value)},onKeyDown:j=>{x(j)}}),e.jsxs("div",{children:[e.jsx("div",{className:"link-cancel",role:"button",tabIndex:0,onMouseDown:j=>j.preventDefault(),onClick:()=>{l&&l(!1)}}),e.jsx("div",{className:"link-confirm",role:"button",tabIndex:0,onMouseDown:j=>j.preventDefault(),onClick:y})]})]}):e.jsxs("div",{className:"link-view",children:[e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",children:d}),e.jsx("div",{className:"link-edit",role:"button",tabIndex:0,onMouseDown:j=>j.preventDefault(),onClick:()=>{m(d),l&&l(!0)}}),e.jsx("div",{className:"link-trash",role:"button",tabIndex:0,onMouseDown:j=>j.preventDefault(),onClick:()=>{t.dispatchCommand(_t.TOGGLE_LINK_COMMAND,null)}})]}):null})}function zC(t,s,n,r){const[a,l]=b.useState(t),[i,c]=b.useState(!1);return b.useEffect(()=>{function d(){const u=ee.$getSelection();if(ee.$isRangeSelection(u)){const p=nr(u),m=yt.$findMatchingParent(p,_t.$isLinkNode),h=yt.$findMatchingParent(p,_t.$isAutoLinkNode);c(m!==null&&h===null)}}return yt.mergeRegister(t.registerUpdateListener(({editorState:u})=>{u.read(()=>{d()})}),t.registerCommand(ee.SELECTION_CHANGE_COMMAND,(u,p)=>(d(),l(p),!1),ee.COMMAND_PRIORITY_CRITICAL),t.registerCommand(ee.CLICK_COMMAND,u=>{const p=ee.$getSelection();if(ee.$isRangeSelection(p)){const m=nr(p),h=yt.$findMatchingParent(m,_t.$isLinkNode);if(_t.$isLinkNode(h)&&(u.metaKey||u.ctrlKey))return window.open(h.getURL(),"_blank"),!0}return!1},ee.COMMAND_PRIORITY_LOW))},[t]),ks.createPortal(e.jsx(HC,{editor:a,isLink:i,anchorElem:s,setIsLink:c,isLinkEditMode:n,setIsLinkEditMode:r}),s)}function UC({anchorElem:t=document.body,isLinkEditMode:s,setIsLinkEditMode:n}){const[r]=xt.useLexicalComposerContext();return zC(r,t,s,n)}function WC(t,s){const n=t.getRangeAt(0);let r;if(t.anchorNode===s){let a=s;for(;a.firstElementChild!=null;)a=a.firstElementChild;r=a.getBoundingClientRect()}else r=n.getBoundingClientRect();return r}const GC=10,JC=5;function qC(t,s,n,r=GC,a=JC){const l=n.parentElement;if(t===null||!l){s.style.opacity="0",s.style.transform="translate(-10000px, -10000px)";return}const i=s.getBoundingClientRect(),c=n.getBoundingClientRect(),d=l.getBoundingClientRect();let u=t.top-i.height-r,p=t.left-a;u<d.top&&(u+=i.height+t.height+r*2),p+i.width>d.right&&(p=d.right-i.width-a),u-=c.top,p-=c.left,s.style.opacity="1",s.style.transform=`translate(${p}px, ${u}px)`}function KC({editor:t,anchorElem:s,isLink:n,isBold:r,isItalic:a,isUnderline:l,isCode:i,isStrikethrough:c,isSubscript:d,isSuperscript:u}){const p=b.useRef(null),m=b.useCallback(()=>{n?t.dispatchCommand(_t.TOGGLE_LINK_COMMAND,null):t.dispatchCommand(_t.TOGGLE_LINK_COMMAND,"https://")},[t,n]);function h(x){p!=null&&p.current&&(x.buttons===1||x.buttons===3)&&(p.current.style.pointerEvents="none")}function f(x){p!=null&&p.current&&(p.current.style.pointerEvents="auto")}b.useEffect(()=>{if(p!=null&&p.current)return document.addEventListener("mousemove",h),document.addEventListener("mouseup",f),()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",f)}},[p]);const g=b.useCallback(()=>{const x=ee.$getSelection(),y=p.current,j=window.getSelection();if(y===null)return;const N=t.getRootElement();if(x!==null&&j!==null&&!j.isCollapsed&&N!==null&&N.contains(j.anchorNode)){const _=WC(j,N);qC(_,y,s)}},[t,s]);return b.useEffect(()=>{const x=s.parentElement,y=()=>{t.getEditorState().read(()=>{g()})};return window.addEventListener("resize",y),x&&x.addEventListener("scroll",y),()=>{window.removeEventListener("resize",y),x&&x.removeEventListener("scroll",y)}},[t,g,s]),b.useEffect(()=>(t.getEditorState().read(()=>{g()}),yt.mergeRegister(t.registerUpdateListener(({editorState:x})=>{x.read(()=>{g()})}),t.registerCommand(ee.SELECTION_CHANGE_COMMAND,()=>(g(),!1),ee.COMMAND_PRIORITY_LOW))),[t,g]),e.jsx("div",{ref:p,className:t.isEditable()?"floating-text-format-popup":"",children:t.isEditable()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{t.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"bold")},className:"popup-item spaced "+(r?"active":""),"aria-label":"Format text as bold",children:e.jsx("i",{className:"format bold"})}),e.jsx("button",{onClick:()=>{t.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"italic")},className:"popup-item spaced "+(a?"active":""),"aria-label":"Format text as italics",children:e.jsx("i",{className:"format italic"})}),e.jsx("button",{onClick:()=>{t.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"underline")},className:"popup-item spaced "+(l?"active":""),"aria-label":"Format text to underlined",children:e.jsx("i",{className:"format underline"})}),e.jsx("button",{onClick:()=>{t.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"strikethrough")},className:"popup-item spaced "+(c?"active":""),"aria-label":"Format text with a strikethrough",children:e.jsx("i",{className:"format strikethrough"})}),e.jsx("button",{onClick:()=>{t.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"subscript")},className:"popup-item spaced "+(d?"active":""),title:"Subscript","aria-label":"Format Subscript",children:e.jsx("i",{className:"format subscript"})}),e.jsx("button",{onClick:()=>{t.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"superscript")},className:"popup-item spaced "+(u?"active":""),title:"Superscript","aria-label":"Format Superscript",children:e.jsx("i",{className:"format superscript"})}),e.jsx("button",{onClick:()=>{t.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"code")},className:"popup-item spaced "+(i?"active":""),"aria-label":"Insert code block",children:e.jsx("i",{className:"format code"})}),e.jsx("button",{onClick:m,className:"popup-item spaced "+(n?"active":""),"aria-label":"Insert link",children:e.jsx("i",{className:"format link"})})]})})}function YC(t,s){const[n,r]=b.useState(!1),[a,l]=b.useState(!1),[i,c]=b.useState(!1),[d,u]=b.useState(!1),[p,m]=b.useState(!1),[h,f]=b.useState(!1),[g,x]=b.useState(!1),[y,j]=b.useState(!1),[N,_]=b.useState(!1),E=b.useCallback(()=>{t.getEditorState().read(()=>{if(t.isComposing())return;const L=ee.$getSelection(),S=window.getSelection(),k=t.getRootElement();if(S!==null&&(!ee.$isRangeSelection(L)||k===null||!k.contains(S.anchorNode))){r(!1);return}if(!ee.$isRangeSelection(L))return;const $=nr(L);c(L.hasFormat("bold")),u(L.hasFormat("italic")),m(L.hasFormat("underline")),f(L.hasFormat("strikethrough")),x(L.hasFormat("subscript")),j(L.hasFormat("superscript")),_(L.hasFormat("code"));const I=$.getParent();_t.$isLinkNode(I)||_t.$isLinkNode($)?l(!0):l(!1),!Dt.$isCodeHighlightNode(L.anchor.getNode())&&L.getTextContent()!==""?r(ee.$isTextNode($)):r(!1);const T=L.getTextContent().replace(/\n/g,"");if(!L.isCollapsed()&&T===""){r(!1);return}})},[t]);return b.useEffect(()=>(document.addEventListener("selectionchange",E),()=>{document.removeEventListener("selectionchange",E)}),[E]),b.useEffect(()=>yt.mergeRegister(t.registerUpdateListener(()=>{E()}),t.registerRootListener(()=>{t.getRootElement()===null&&r(!1)})),[t,E]),!n||a?null:ks.createPortal(e.jsx(KC,{editor:t,anchorElem:s,isLink:a,isBold:i,isItalic:d,isStrikethrough:h,isSubscript:g,isSuperscript:y,isUnderline:p,isCode:N}),s)}function au({anchorElem:t=document.body}){const[s]=xt.useLexicalComposerContext();return YC(s,t)}const ZC=/(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])(congrats|congratulations|gratuluju|gratuluji|gratulujeme|blahopřeju|blahopřeji|blahopřejeme|Til lykke|Tillykke|Glückwunsch|Gratuliere|felicitaciones|enhorabuena|paljon onnea|onnittelut|Félicitations|gratula|gratulálok|gratulálunk|congratulazioni|complimenti|おめでとう|おめでとうございます|축하해|축하해요|gratulerer|Gefeliciteerd|gratulacje|Parabéns|parabéns|felicitações|felicitări|мои поздравления|поздравляем|поздравляю|gratulujem|blahoželám|ยินดีด้วย|ขอแสดงความยินดี|tebrikler|tebrik ederim|恭喜|祝贺你|恭喜你|恭喜|恭喜|baie geluk|veels geluk|অভিনন্দন|Čestitam|Čestitke|Čestitamo|Συγχαρητήρια|Μπράβο|અભિનંદન|badhai|बधाई|अभिनंदन|Честитам|Свака част|hongera|வாழ்த்துகள்|வாழ்த்துக்கள்|అభినందనలు|അഭിനന്ദനങ്ങൾ|Chúc mừng|מזל טוב|mazel tov|mazal tov)(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])/i;function XC(){const[t]=xt.useLexicalComposerContext();b.useEffect(()=>{if(!t.hasNodes([Bn]))throw new Error("KeywordsPlugin: KeywordNode not registered on editor")},[t]);const s=b.useCallback(r=>uh(r.getTextContent()),[]),n=b.useCallback(r=>{const a=ZC.exec(r);if(a===null)return null;const l=a[2].length,i=a.index+a[1].length;return{end:i+l,start:i}},[]);return Kb.useLexicalTextEntity(n,Bn,s),null}function ru(){return e.jsx(Yb.LinkPlugin,{validateUrl:VC})}function QC(t){const s=t.getNodes();return s.length===0?new Set([t.anchor.getNode().getParentOrThrow(),t.focus.getNode().getParentOrThrow()]):new Set(s.map(n=>ee.$isElementNode(n)?n:n.getParentOrThrow()))}function e5(t){const s=ee.$getSelection();if(!ee.$isRangeSelection(s))return!1;const n=QC(s);let r=0;for(const a of n)if(Pt.$isListNode(a))r=Math.max(Pt.$getListDepth(a)+1,r);else if(Pt.$isListItemNode(a)){const l=a.getParent();if(!Pt.$isListNode(l))throw new Error("ListMaxIndentLevelPlugin: A ListItemNode must have a ListNode for a parent.");r=Math.max(Pt.$getListDepth(l)+1,r)}return r<=t}function t5({maxDepth:t}){const[s]=xt.useLexicalComposerContext();return b.useEffect(()=>s.registerCommand(ee.INDENT_CONTENT_COMMAND,()=>!e5(t??7),ee.COMMAND_PRIORITY_CRITICAL),[s,t]),null}function s5({maxLength:t}){const[s]=xt.useLexicalComposerContext();return b.useEffect(()=>{let n=null;return s.registerNodeTransform(ee.RootNode,r=>{const a=ee.$getSelection();if(!ee.$isRangeSelection(a)||!a.isCollapsed())return;const l=s.getEditorState(),i=l.read(()=>r.getTextContentSize()),c=r.getTextContentSize();if(i!==c){const d=c-t,u=a.anchor;d>0&&(i===t&&n!==l?(n=l,yt.$restoreEditorState(s,l)):Ot.trimTextContentFromAnchor(s,u,d))}})},[s,t]),null}const n5=1,a5=100;let Ih=0,ou=!1;function r5(){window.addEventListener("keydown",t=>{t.keyCode===9&&(Ih=t.timeStamp)},!0)}function o5(){const[t]=xt.useLexicalComposerContext();return b.useEffect(()=>(ou||(r5(),ou=!0),t.registerCommand(ee.FOCUS_COMMAND,s=>{const n=ee.$getSelection();return ee.$isRangeSelection(n)&&Ih+a5>s.timeStamp&&ee.$setSelection(n.clone()),!1},n5)),[t]),null}const l5=["#d0021b","#f5a623","#f8e71c","#8b572a","#7ed321","#417505","#bd10e0","#9013fe","#4a90e2","#50e3c2","#b8e986","#000000","#4a4a4a","#9b9b9b","#ffffff"],La=214,lu=150,Ts={"color-picker-wrapper":"p-[20px]","color-picker-basic-color":"flex flex-wrap gap-[10px] m-0 p-0","color-picker-basic-color-button":"border-[1px] border-[solid] border-[#ccc] rounded-[4px] h-[16px] w-[16px] cursor-pointer list-none","color-picker-basic-color-button.active":"[box-shadow:0px_0px_2px_2px_rgba(0,_0,_0,_0.3)]","color-picker-saturation":"w-full relative mt-[15px] h-[150px] bg-[linear-gradient(transparent,_black),_linear-gradient(to_right,_white,_transparent)] select-none","color-picker-saturation_cursor":"absolute w-[20px] h-[20px] border-[2px] border-[solid] border-[#ffffff] rounded-[50%] [box-shadow:0_0_15px_#00000026] box-border -translate-x-[10px] -translate-y-[10px]","color-picker-hue":"w-full relative mt-[15px] h-[12px] bg-[linear-gradient(_to_right,_rgb(255,_0,_0),_rgb(255,_255,_0),_rgb(0,_255,_0),_rgb(0,_255,_255),_rgb(0,_0,_255),_rgb(255,_0,_255),_rgb(255,_0,_0)_)] select-none rounded-[12px]","color-picker-hue_cursor":"absolute w-[20px] h-[20px] border-[2px] border-[solid] border-[#ffffff] rounded-full [box-shadow:#0003_0_0_0_0.5px] box-border -translate-x-[10px] -translate-y-[4px]","color-picker-color":"border-[1px] border-[solid] border-[#ccc] mt-[15px] w-full h-[20px]"};function Th({color:t,onChange:s}){const[n,r]=b.useState(qn("hex",t)),[a,l]=b.useState(t),i=b.useRef(null),c=b.useMemo(()=>({x:n.hsv.s/100*La,y:(100-n.hsv.v)/100*lu}),[n.hsv.s,n.hsv.v]),d=b.useMemo(()=>({x:n.hsv.h/360*La}),[n.hsv]),u=h=>{if(l(h),/^#[0-9A-Fa-f]{6}$/i.test(h)){const f=qn("hex",h);r(f)}},p=({x:h,y:f})=>{const g={...n.hsv,s:h/La*100,v:100-f/lu*100},x=qn("hsv",g);r(x),l(x.hex)},m=({x:h})=>{const f={...n.hsv,h:h/La*360},g=qn("hsv",f);r(g),l(g.hex)};return b.useEffect(()=>{i.current!==null&&s&&(s(n.hex),l(n.hex))},[n,s]),b.useEffect(()=>{if(t===void 0)return;const h=qn("hex",t);r(h),l(h.hex)},[t]),e.jsxs("div",{className:`${Ts["color-picker-wrapper"]}`,style:{width:La},ref:i,children:[e.jsx(xa,{label:"Hex",onChange:u,value:a}),e.jsx("div",{className:`${Ts["color-picker-basic-color"]}`,children:l5.map(h=>e.jsx("button",{className:`${Ts["color-picker-basic-color-button"]} ${h===n.hex?Ts["color-picker-basic-color-button.active"]:""}`,style:{backgroundColor:h},onClick:()=>{l(h),r(qn("hex",h))}},h))}),e.jsx(iu,{className:`${Ts["color-picker-saturation"]}`,style:{backgroundColor:`hsl(${n.hsv.h}, 100%, 50%)`},onChange:p,children:e.jsx("div",{className:`${Ts["color-picker-saturation_cursor"]}`,style:{backgroundColor:n.hex,left:c.x,top:c.y}})}),e.jsx(iu,{className:`${Ts["color-picker-hue"]}`,onChange:m,children:e.jsx("div",{className:`${Ts["color-picker-hue_cursor"]}`,style:{backgroundColor:`hsl(${n.hsv.h}, 100%, 50%)`,left:d.x}})}),e.jsx("div",{className:`${Ts["color-picker-color"]}`,style:{backgroundColor:n.hex}})]})}function iu({className:t,style:s,onChange:n,children:r}){const a=b.useRef(null),l=c=>{if(a.current){const{current:d}=a,{width:u,height:p,left:m,top:h}=d.getBoundingClientRect(),f=cu(c.clientX-m,u,0),g=cu(c.clientY-h,p,0);n({x:f,y:g})}},i=c=>{if(c.button!==0)return;l(c);const d=p=>{l(p)},u=p=>{document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",u,!1),l(p)};document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",u,!1)};return e.jsx("div",{ref:a,className:t,style:s,onMouseDown:i,children:r})}function cu(t,s,n){return t>s?s:t<n?n:t}function du(t){if(t.startsWith("#")){if(t.length===4||t.length===5)return t=t.split("").map((s,n)=>n?s+s:"#").join(""),t;if(t.length===7||t.length===9)return t}else{const s=document.createElement("canvas").getContext("2d");if(!s)throw new Error("2d context not supported or canvas already initialized");return s.fillStyle=t,s.fillStyle}return"#000000"}function uu(t){const s=(t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(n,r,a,l)=>"#"+r+r+a+a+l+l).substring(1).match(/.{2}/g)||[]).map(n=>parseInt(n,16));return{b:s[2],g:s[1],r:s[0]}}function Il({r:t,g:s,b:n}){t/=255,s/=255,n/=255;const r=Math.max(t,s,n),a=r-Math.min(t,s,n),l=a?(r===t?(s-n)/a+(s<n?6:0):r===s?2+(n-t)/a:4+(t-s)/a)*60:0,i=r?a/r*100:0,c=r*100;return{h:l,s:i,v:c}}function i5({h:t,s,v:n}){s/=100,n/=100;const r=~~(t/60),a=t/60-r,l=n*(1-s),i=n*(1-s*a),c=n*(1-s*(1-a)),d=r%6,u=Math.round([n,i,l,l,c,n][d]*255),p=Math.round([c,n,n,i,l,l][d]*255);return{b:Math.round([l,l,c,n,n,i][d]*255),g:p,r:u}}function mu({b:t,g:s,r:n}){return"#"+[n,s,t].map(r=>r.toString(16).padStart(2,"0")).join("")}function qn(t,s){let n=du("#121212"),r=uu(n),a=Il(r);return t==="hex"?(n=du(s),r=uu(n),a=Il(r)):t==="rgb"?(r=s,n=mu(r),a=Il(r)):t==="hsv"&&(a=s,r=i5(a),n=mu(r)),{hex:n,hsv:a,rgb:r}}function Tl(t){const s=t.getShape();return{columns:s.toX-s.fromX+1,rows:s.toY-s.fromY+1}}function c5(t){const s=t.getNodes(),n=[];let r=null,a=null,l=0;for(let i=0;i<s.length;i++){const c=s[i];if(Se.$isTableCellNode(c)){const d=c.getParentOrThrow();if(wh(Se.$isTableRowNode(d),"Expected CellNode to have a RowNode parent"),r!==d){if(a!==null&&l!==a)return!1;r!==null&&(a=l),r=d,l=0}const u=c.__colSpan;for(let p=0;p<u;p++)n[l+p]===void 0&&(n[l+p]=0),n[l+p]+=c.__rowSpan;l+=u}}return(a===null||l===a)&&n.every(i=>i===n[0])}function d5(){const t=ee.$getSelection();if(ee.$isRangeSelection(t)&&!t.isCollapsed()||ee.DEPRECATED_$isGridSelection(t)&&!t.anchor.is(t.focus)||!ee.$isRangeSelection(t)&&!ee.DEPRECATED_$isGridSelection(t))return!1;const[s]=ee.DEPRECATED_$getNodeTriplet(t.anchor);return s.__colSpan>1||s.__rowSpan>1}function pu(t){if(t.getChildrenSize()!==1)return!1;const s=t.getFirstChildOrThrow();return!(!ee.$isParagraphNode(s)||!s.isEmpty())}function u5(t){const s=t.getLastDescendant();ee.$isTextNode(s)?s.select():ee.$isElementNode(s)?s.selectEnd():s!==null&&s.selectNext()}function hu(t){return t.getEditorState().read(()=>{const s=ee.$getSelection();if(ee.$isRangeSelection(s)||ee.DEPRECATED_$isGridSelection(s)){const[n]=ee.DEPRECATED_$getNodeTriplet(s.anchor);if(Se.$isTableCellNode(n))return n.getBackgroundColor()}return null})}function m5({onClose:t,tableCellNode:s,setIsMenuOpen:n,contextRef:r,cellMerge:a,showColorPickerModal:l}){const[i]=xt.useLexicalComposerContext(),c=b.useRef(null),[d,u]=b.useState(s),[p,m]=b.useState({columns:1,rows:1}),[h,f]=b.useState(!1),[g,x]=b.useState(!1),[y,j]=b.useState(()=>hu(i)||"");b.useEffect(()=>i.registerMutationListener(Se.TableCellNode,M=>{M.get(d.getKey())==="updated"&&(i.getEditorState().read(()=>{u(d.getLatest())}),j(hu(i)||""))}),[i,d]),b.useEffect(()=>{i.getEditorState().read(()=>{const M=ee.$getSelection();if(ee.DEPRECATED_$isGridSelection(M)){const D=Tl(M);m(Tl(M)),f(c5(M)&&(D.columns>1||D.rows>1))}x(d5())})},[i]),b.useEffect(()=>{const M=r.current,D=c.current,P=i.getRootElement();if(M!=null&&D!=null&&P!=null){const F=P.getBoundingClientRect(),B=M.getBoundingClientRect();D.style.opacity="1";const V=D.getBoundingClientRect(),G=5;let Z=B.right+G;if(Z+V.width>window.innerWidth||Z+V.width>F.right){const H=B.left-V.width-G;Z=(H<0?G:H)+window.pageXOffset}D.style.left=`${Z+window.pageXOffset}px`;let X=B.top;if(X+V.height>window.innerHeight){const H=B.bottom-V.height;X=(H<0?G:H)+window.pageYOffset}D.style.top=`${X+ +window.pageYOffset}px`}},[r,c,i]),b.useEffect(()=>{function M(D){c.current!=null&&r.current!=null&&!c.current.contains(D.target)&&!r.current.contains(D.target)&&n(!1)}return window.addEventListener("click",M),()=>window.removeEventListener("click",M)},[n,r]);const N=b.useCallback(()=>{i.update(()=>{if(d.isAttached()){const D=Se.$getTableNodeFromLexicalNodeOrThrow(d),P=i.getElementByKey(D.getKey());if(!P)throw new Error("Expected to find tableElement in DOM");const F=Se.getTableSelectionFromTableElement(P);F!==null&&F.clearHighlight(),D.markDirty(),u(d.getLatest())}ee.$getRoot().selectStart()})},[i,d]),_=()=>{i.update(()=>{const M=ee.$getSelection();if(ee.DEPRECATED_$isGridSelection(M)){const{columns:D,rows:P}=Tl(M),F=M.getNodes();let B=null;for(let V=0;V<F.length;V++){const G=F[V];if(ee.DEPRECATED_$isGridCellNode(G))if(B===null){G.setColSpan(D).setRowSpan(P),B=G;const Z=pu(G);let X;Z&&ee.$isParagraphNode(X=G.getFirstChild())&&X.remove()}else ee.DEPRECATED_$isGridCellNode(B)&&(pu(G)||B.append(...G.getChildren()),G.remove())}B!==null&&(B.getChildrenSize()===0&&B.append(ee.$createParagraphNode()),u5(B)),t()}})},E=()=>{i.update(()=>{Se.$unmergeCell()})},L=b.useCallback(M=>{i.update(()=>{Se.$insertTableRow__EXPERIMENTAL(M),t()})},[i,t]),S=b.useCallback(M=>{i.update(()=>{for(let D=0;D<p.columns;D++)Se.$insertTableColumn__EXPERIMENTAL(M);t()})},[i,t,p.columns]),k=b.useCallback(()=>{i.update(()=>{Se.$deleteTableRow__EXPERIMENTAL(),t()})},[i,t]),$=b.useCallback(()=>{i.update(()=>{Se.$getTableNodeFromLexicalNodeOrThrow(d).remove(),N(),t()})},[i,d,N,t]),I=b.useCallback(()=>{i.update(()=>{Se.$deleteTableColumn__EXPERIMENTAL(),t()})},[i,t]),T=b.useCallback(()=>{i.update(()=>{const M=Se.$getTableNodeFromLexicalNodeOrThrow(d),D=Se.$getTableRowIndexFromTableCellNode(d),P=M.getChildren();if(D>=P.length||D<0)throw new Error("Expected table cell to be inside of table row.");const F=P[D];if(!Se.$isTableRowNode(F))throw new Error("Expected table row");F.getChildren().forEach(B=>{if(!Se.$isTableCellNode(B))throw new Error("Expected table cell");B.toggleHeaderStyle(Se.TableCellHeaderStates.ROW)}),N(),t()})},[i,d,N,t]),A=b.useCallback(()=>{i.update(()=>{const M=Se.$getTableNodeFromLexicalNodeOrThrow(d),D=Se.$getTableColumnIndexFromTableCellNode(d),P=M.getChildren();for(let F=0;F<P.length;F++){const B=P[F];if(!Se.$isTableRowNode(B))throw new Error("Expected table row");const V=B.getChildren();if(D>=V.length||D<0)throw new Error("Expected table cell to be inside of table row.");const G=V[D];if(!Se.$isTableCellNode(G))throw new Error("Expected table cell");G.toggleHeaderStyle(Se.TableCellHeaderStates.COLUMN)}N(),t()})},[i,d,N,t]),R=b.useCallback(M=>{i.update(()=>{const D=ee.$getSelection();if(ee.$isRangeSelection(D)||ee.DEPRECATED_$isGridSelection(D)){const[P]=ee.DEPRECATED_$getNodeTriplet(D.anchor);Se.$isTableCellNode(P)&&P.setBackgroundColor(M)}})},[i]);let O=null;return a&&(h?O=e.jsx("button",{className:"item",onClick:()=>_(),"data-test-id":"table-merge-cells",children:"Merge cells"}):g&&(O=e.jsx("button",{className:"item",onClick:()=>E(),"data-test-id":"table-unmerge-cells",children:"Unmerge cells"}))),ks.createPortal(e.jsxs("div",{className:"dropdown",ref:c,onClick:M=>{M.stopPropagation()},children:[O,e.jsx("button",{className:"item",onClick:()=>l("Cell background color",()=>e.jsx(Th,{color:y,onChange:R})),"data-test-id":"table-background-color",children:e.jsx("span",{className:"text",children:"Background color"})}),e.jsx("hr",{}),e.jsx("button",{className:"item",onClick:()=>L(!1),"data-test-id":"table-insert-row-above",children:e.jsxs("span",{className:"text",children:["Insert"," ",p.rows===1?"row":`${p.rows} rows`," ","above"]})}),e.jsx("button",{className:"item",onClick:()=>L(!0),"data-test-id":"table-insert-row-below",children:e.jsxs("span",{className:"text",children:["Insert"," ",p.rows===1?"row":`${p.rows} rows`," ","below"]})}),e.jsx("hr",{}),e.jsx("button",{className:"item",onClick:()=>S(!1),"data-test-id":"table-insert-column-before",children:e.jsxs("span",{className:"text",children:["Insert"," ",p.columns===1?"column":`${p.columns} columns`," ","left"]})}),e.jsx("button",{className:"item",onClick:()=>S(!0),"data-test-id":"table-insert-column-after",children:e.jsxs("span",{className:"text",children:["Insert"," ",p.columns===1?"column":`${p.columns} columns`," ","right"]})}),e.jsx("hr",{}),e.jsx("button",{className:"item",onClick:()=>I(),"data-test-id":"table-delete-columns",children:e.jsx("span",{className:"text",children:"Delete column"})}),e.jsx("button",{className:"item",onClick:()=>k(),"data-test-id":"table-delete-rows",children:e.jsx("span",{className:"text",children:"Delete row"})}),e.jsx("button",{className:"item",onClick:()=>$(),"data-test-id":"table-delete",children:e.jsx("span",{className:"text",children:"Delete table"})}),e.jsx("hr",{}),e.jsx("button",{className:"item",onClick:()=>T(),children:e.jsxs("span",{className:"text",children:[(d.__headerState&Se.TableCellHeaderStates.ROW)===Se.TableCellHeaderStates.ROW?"Remove":"Add"," ","row header"]})}),e.jsx("button",{className:"item",onClick:()=>A(),children:e.jsxs("span",{className:"text",children:[(d.__headerState&Se.TableCellHeaderStates.COLUMN)===Se.TableCellHeaderStates.COLUMN?"Remove":"Add"," ","column header"]})})]}),document.body)}function p5({anchorElem:t,cellMerge:s}){const[n]=xt.useLexicalComposerContext(),r=b.useRef(null),a=b.useRef(null),[l,i]=b.useState(!1),[c,d]=b.useState(null),[u,p]=xr(),m=b.useCallback(()=>{const f=r.current,g=ee.$getSelection(),x=window.getSelection(),y=document.activeElement;if(g==null||f==null){d(null);return}const j=n.getRootElement();if(ee.$isRangeSelection(g)&&j!==null&&x!==null&&j.contains(x.anchorNode)){const N=Se.$getTableCellNodeFromLexicalNode(g.anchor.getNode());if(N==null){d(null);return}if(n.getElementByKey(N.getKey())==null){d(null);return}d(N)}else y||d(null)},[n]);b.useEffect(()=>n.registerUpdateListener(()=>{n.getEditorState().read(()=>{m()})})),b.useEffect(()=>{const f=r.current;if(f!=null&&c!=null){const g=n.getElementByKey(c.getKey());if(g!=null){const x=g.getBoundingClientRect(),y=f.getBoundingClientRect(),j=t.getBoundingClientRect(),N=x.top-j.top+4,_=x.right-y.width-10-j.left;f.style.opacity="1",f.style.transform=`translate(${_}px, ${N}px)`}else f.style.opacity="0",f.style.transform="translate(-10000px, -10000px)"}},[r,c,n,t]);const h=b.useRef(c);return b.useEffect(()=>{h.current!==c&&i(!1),h.current=c},[h,c]),e.jsx("div",{className:"table-cell-action-button-container",ref:r,children:c!=null&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"table-cell-action-button chevron-down",onClick:f=>{f.stopPropagation(),i(!l)},ref:a,children:e.jsx("i",{className:"chevron-down"})}),u,l&&e.jsx(m5,{contextRef:a,setIsMenuOpen:i,onClose:()=>i(!1),tableCellNode:c,cellMerge:s,showColorPickerModal:p})]})})}function h5({anchorElem:t=document.body,cellMerge:s=!1}){const n=hp();return ks.createPortal(n?e.jsx(p5,{anchorElem:t,cellMerge:s}):null,t)}const f5=33,g5=50;function x5({editor:t}){const s=b.useRef(null),n=b.useRef(null),r=b.useRef(null),a=b.useRef(null),[l,i]=b.useState(null),[c,d]=b.useState(null),[u,p]=b.useState(!1),[m,h]=b.useState(null);b.useEffect(()=>t.registerCommand(ee.SELECTION_CHANGE_COMMAND,L=>{const S=ee.$getSelection(),k=Se.$isTableSelection(S);return u!==k&&p(k),!1},ee.COMMAND_PRIORITY_HIGH));const f=b.useCallback(()=>{d(null),s.current=null,h(null),a.current=null,r.current=null},[]);b.useEffect(()=>{const L=S=>{setTimeout(()=>{const k=S.target;if(m){i({x:S.clientX,y:S.clientY});return}if(!(n.current&&n.current.contains(k))&&s.current!==k){s.current=k;const $=Se.getDOMCellFromTarget(k);$&&c!==$?t.update(()=>{const I=ee.$getNearestNodeFromDOMNode($.elem);if(!I)throw new Error("TableCellResizer: Table cell node not found.");const T=Se.$getTableNodeFromLexicalNodeOrThrow(I),A=t.getElementByKey(T.getKey());if(!A)throw new Error("TableCellResizer: Table element not found.");s.current=k,r.current=A.getBoundingClientRect(),d($)}):$==null&&f()}},0)};return document.addEventListener("mousemove",L),()=>{document.removeEventListener("mousemove",L)}},[c,m,t,f]);const g=L=>L==="bottom",x=b.useCallback(L=>{if(!c)throw new Error("TableCellResizer: Expected active cell.");t.update(()=>{const S=ee.$getNearestNodeFromDOMNode(c.elem);if(!Se.$isTableCellNode(S))throw new Error("TableCellResizer: Table cell node not found.");const k=Se.$getTableNodeFromLexicalNodeOrThrow(S),$=Se.$getTableRowIndexFromTableCellNode(S),I=k.getChildren();if($>=I.length||$<0)throw new Error("Expected table cell to be inside of table row.");const T=I[$];if(!Se.$isTableRowNode(T))throw new Error("Expected table row");T.setHeight(L)})},[c,t]),y=b.useCallback(L=>{if(!c)throw new Error("TableCellResizer: Expected active cell.");t.update(()=>{const S=ee.$getNearestNodeFromDOMNode(c.elem);if(!Se.$isTableCellNode(S))throw new Error("TableCellResizer: Table cell node not found.");const k=Se.$getTableNodeFromLexicalNodeOrThrow(S),$=Se.$getTableColumnIndexFromTableCellNode(S),I=k.getChildren();for(let T=0;T<I.length;T++){const A=I[T];if(!Se.$isTableRowNode(A))throw new Error("Expected table row");const R=A.getChildren(),D=R.map(F=>F.getColSpan()).reduce((F,B)=>{const V=F[F.length-1]??0;return F.push(V+B),F},[]).findIndex(F=>F>$);if(D>=R.length||D<0)throw new Error("Expected table cell to be inside of table row.");const P=R[D];if(!Se.$isTableCellNode(P))throw new Error("Expected table cell");P.setWidth(L)}})},[c,t]),j=b.useCallback(L=>{const S=k=>{if(k.preventDefault(),k.stopPropagation(),!c)throw new Error("TableCellResizer: Expected active cell.");if(a.current){const{x:$,y:I}=a.current;if(c===null)return;if(g(L)){const T=c.elem.getBoundingClientRect().height,A=Math.abs(k.clientY-I),R=L==="bottom"&&I>k.clientY;x(Math.max(R?T-A:A+T,f5))}else{const T=getComputedStyle(c.elem);let A=c.elem.clientWidth;A-=parseFloat(T.paddingLeft)+parseFloat(T.paddingRight);const R=Math.abs(k.clientX-$),O=L==="right"&&$>k.clientX;y(Math.max(O?A-R:R+A,g5))}f(),document.removeEventListener("mouseup",S)}};return S},[c,f,y,x]),N=b.useCallback(L=>S=>{if(S.preventDefault(),S.stopPropagation(),!c)throw new Error("TableCellResizer: Expected active cell.");a.current={x:S.clientX,y:S.clientY},i(a.current),h(L),document.addEventListener("mouseup",j(L))},[c,j]),E=b.useCallback(()=>{if(c){const{height:L,width:S,top:k,left:$}=c.elem.getBoundingClientRect(),I={bottom:{backgroundColor:"none",cursor:"row-resize",height:"10px",left:`${window.pageXOffset+$}px`,top:`${window.pageYOffset+k+L}px`,width:`${S}px`},right:{backgroundColor:"none",cursor:"col-resize",height:`${L}px`,left:`${window.pageXOffset+$+S}px`,top:`${window.pageYOffset+k}px`,width:"10px"}},T=r.current;return m&&l&&T&&(g(m)?(I[m].left=`${window.pageXOffset+T.left}px`,I[m].top=`${window.pageYOffset+l.y}px`,I[m].height="3px",I[m].width=`${T.width}px`):(I[m].top=`${window.pageYOffset+T.top}px`,I[m].left=`${window.pageXOffset+l.x}px`,I[m].width="3px",I[m].height=`${T.height}px`),I[m].backgroundColor="#adf"),I}return{bottom:null,left:null,right:null,top:null}},[c,m,l])();return e.jsx("div",{ref:n,children:c!=null&&!u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"TableCellResizer__resizer TableCellResizer__ui",style:E.right||void 0,onMouseDown:N("right")}),e.jsx("div",{className:"TableCellResizer__resizer TableCellResizer__ui",style:E.bottom||void 0,onMouseDown:N("bottom")})]})})}function b5(){const[t]=xt.useLexicalComposerContext(),s=hp();return b.useMemo(()=>s?ks.createPortal(e.jsx(x5,{editor:t}),document.body):null,[t,s])}const yo=624,Mh=9;function y5(t){if(t==="h2")return"heading2";if(t==="h3")return"heading3"}function v5(t){const s=t==null?void 0:t.getClientRects()[0].y;return s>=yo&&s<=yo+Mh}function Br(t){return(t==null?void 0:t.getClientRects()[0].y)<yo}function Ml(t){return(t==null?void 0:t.getClientRects()[0].y)>=yo+Mh}function j5({tableOfContents:t}){const[s,n]=b.useState(""),r=b.useRef(0),[a]=xt.useLexicalComposerContext();function l(i,c){a.getEditorState().read(()=>{const d=a.getElementByKey(i);d!==null&&(d.scrollIntoView(),n(i),r.current=c)})}return b.useEffect(()=>{function i(){if(t.length!==0&&r.current<t.length-1){let p=a.getElementByKey(t[r.current][0]);if(p!==null){if(Ml(p)){for(;p!==null&&Ml(p)&&r.current>0;){const h=a.getElementByKey(t[r.current-1][0]);h!==null&&(Br(h)||Ml(h))&&r.current--,p=h}const m=t[r.current][0];n(m)}else if(Br(p)){for(;p!==null&&Br(p)&&r.current<t.length-1;){const h=a.getElementByKey(t[r.current+1][0]);h!==null&&(v5(h)||Br(h))&&r.current++,p=h}const m=t[r.current][0];n(m)}}}else r.current=0}let c;function d(p,m){clearTimeout(c),c=setTimeout(p,m)}function u(){d(i,10)}return document.addEventListener("scroll",u),()=>document.removeEventListener("scroll",u)},[t,a]),e.jsx("div",{className:"table-of-contents",children:e.jsx("ul",{className:"headings",children:t.map(([i,c,d],u)=>u===0?e.jsxs("div",{className:"normal-heading-wrapper",children:[e.jsx("div",{className:"first-heading",onClick:()=>l(i,u),role:"button",tabIndex:0,children:(""+c).length>20?c.substring(0,20)+"...":c}),e.jsx("br",{})]},i):e.jsx("div",{className:`normal-heading-wrapper ${s===i?"selected-heading-wrapper":""}`,children:e.jsx("div",{onClick:()=>l(i,u),role:"button",className:y5(d),tabIndex:0,children:e.jsx("li",{className:`normal-heading ${s===i?"selected-heading":""}
                    `,children:(""+c).length>27?c.substring(0,27)+"...":c})})},i))})})}function w5(){return e.jsx(Zb,{children:t=>e.jsx(j5,{tableOfContents:t})})}const N5=gr&&"documentMode"in document?document.documentMode:null,fu=gr&&/Mac|iPod|iPhone|iPad/.test(navigator.platform);gr&&"InputEvent"in window&&!N5&&"getTargetRanges"in new window.InputEvent("input");const Bh=b.createContext(null),gu=4;function it({children:t,className:s,onClick:n,title:r}){const a=b.useRef(null),l=b.useContext(Bh);if(l===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:i}=l;return b.useEffect(()=>{a&&a.current&&i(a)},[a,i]),e.jsx("button",{className:s,onClick:n,ref:a,title:r,type:"button",children:t})}function C5({children:t,dropDownRef:s,onClose:n}){const[r,a]=b.useState(),[l,i]=b.useState(),c=b.useCallback(p=>{a(m=>m?[...m,p]:[p])},[a]),d=p=>{if(!r)return;const m=p.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(m)&&p.preventDefault(),m==="Escape"||m==="Tab"?n():m==="ArrowUp"?i(h=>{if(!h)return r[0];const f=r.indexOf(h)-1;return r[f===-1?r.length-1:f]}):m==="ArrowDown"&&i(h=>h?r[r.indexOf(h)+1]:r[0])},u=b.useMemo(()=>({registerItem:c}),[c]);return b.useEffect(()=>{r&&!l&&i(r[0]),l&&l.current&&l.current.focus()},[r,l]),e.jsx(Bh.Provider,{value:u,children:e.jsx("div",{className:"dropdown",ref:s,onKeyDown:d,children:t})})}function vn({disabled:t=!1,buttonLabel:s,buttonAriaLabel:n,buttonClassName:r,buttonIconClassName:a,children:l,stopCloseOnClickSelf:i}){const c=b.useRef(null),d=b.useRef(null),[u,p]=b.useState(!1),m=()=>{p(!1),d&&d.current&&d.current.focus()};return b.useEffect(()=>{const h=d.current,f=c.current;if(u&&h!==null&&f!==null){const{top:g,left:x}=h.getBoundingClientRect();f.style.top=`${g+h.offsetHeight+gu}px`,f.style.left=`${Math.min(x,window.innerWidth-f.offsetWidth-20)}px`}},[c,d,u]),b.useEffect(()=>{const h=d.current;if(h!==null&&u){const f=g=>{const x=g.target;i&&c.current&&c.current.contains(x)||h.contains(x)||p(!1)};return document.addEventListener("click",f),()=>{document.removeEventListener("click",f)}}},[c,d,u,i]),b.useEffect(()=>{const h=()=>{if(u){const f=d.current,g=c.current;if(f!==null&&g!==null){const{top:x}=f.getBoundingClientRect(),y=x+f.offsetHeight+gu;y!==g.getBoundingClientRect().top&&(g.style.top=`${y}px`)}}};return document.addEventListener("scroll",h),()=>{document.removeEventListener("scroll",h)}},[d,c,u]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",disabled:t,"aria-label":n||s,className:r,onClick:()=>p(!u),ref:d,children:[a&&e.jsx("span",{className:a}),s&&e.jsx("span",{className:"text dropdown-button-text",children:s}),e.jsx("i",{className:"chevron-down"})]}),u&&ks.createPortal(e.jsx(C5,{dropDownRef:c,onClose:m,children:l}),document.body)]})}function xu({disabled:t=!1,stopCloseOnClickSelf:s=!0,color:n,onChange:r,...a}){return e.jsx(vn,{...a,disabled:t,stopCloseOnClickSelf:s,children:e.jsx(Th,{color:n,onChange:r})})}const bi={bullet:"Bulleted List",check:"Check List",code:"Code Block",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",number:"Numbered List",paragraph:"Normal",quote:"Quote"};function _5(){const t=[];for(const[s,n]of Object.entries(Dt.CODE_LANGUAGE_FRIENDLY_NAME_MAP))t.push([s,n]);return t}const S5=_5(),Ia={center:{icon:"center-align",iconRTL:"right-align",name:"Center Align"},end:{icon:"right-align",iconRTL:"left-align",name:"End Align"},justify:{icon:"justify-align",iconRTL:"justify-align",name:"Justify Align"},left:{icon:"left-align",iconRTL:"left-align",name:"Left Align"},right:{icon:"right-align",iconRTL:"left-align",name:"Right Align"},start:{icon:"left-align",iconRTL:"right-align",name:"Start Align"}};function qt(t){return t?"active dropdown-item-active":""}function $5({editor:t,blockType:s,rootType:n,disabled:r=!1}){const a=()=>{t.update(()=>{const m=ee.$getSelection();ee.$isRangeSelection(m)&&Ot.$setBlocksType(m,()=>ee.$createParagraphNode())})},l=m=>{s!==m&&t.update(()=>{const h=ee.$getSelection();Ot.$setBlocksType(h,()=>es.$createHeadingNode(m))})},i=()=>{s!=="bullet"?t.dispatchCommand(Pt.INSERT_UNORDERED_LIST_COMMAND,void 0):a()},c=()=>{s!=="check"?t.dispatchCommand(Pt.INSERT_CHECK_LIST_COMMAND,void 0):a()},d=()=>{s!=="number"?t.dispatchCommand(Pt.INSERT_ORDERED_LIST_COMMAND,void 0):a()},u=()=>{s!=="quote"&&t.update(()=>{const m=ee.$getSelection();Ot.$setBlocksType(m,()=>es.$createQuoteNode())})},p=()=>{s!=="code"&&t.update(()=>{let m=ee.$getSelection();if(m!==null)if(m.isCollapsed())Ot.$setBlocksType(m,()=>Dt.$createCodeNode());else{const h=m.getTextContent(),f=Dt.$createCodeNode();m.insertNodes([f]),m=ee.$getSelection(),ee.$isRangeSelection(m)&&m.insertRawText(h)}})};return e.jsxs(vn,{disabled:r,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-type "+s,buttonLabel:bi[s],buttonAriaLabel:"Formatting options for text style",children:[e.jsxs(it,{className:"item "+qt(s==="paragraph"),onClick:a,children:[e.jsx("i",{className:"icon paragraph"}),e.jsx("span",{className:"text",children:"Normal"})]}),e.jsxs(it,{className:"item "+qt(s==="h1"),onClick:()=>l("h1"),children:[e.jsx("i",{className:"icon h1"}),e.jsx("span",{className:"text",children:"Heading 1"})]}),e.jsxs(it,{className:"item "+qt(s==="h2"),onClick:()=>l("h2"),children:[e.jsx("i",{className:"icon h2"}),e.jsx("span",{className:"text",children:"Heading 2"})]}),e.jsxs(it,{className:"item "+qt(s==="h3"),onClick:()=>l("h3"),children:[e.jsx("i",{className:"icon h3"}),e.jsx("span",{className:"text",children:"Heading 3"})]}),e.jsxs(it,{className:"item "+qt(s==="h4"),onClick:()=>l("h4"),children:[e.jsx("i",{className:"icon h4"}),e.jsx("span",{className:"text",children:"Heading 4"})]}),e.jsxs(it,{className:"item "+qt(s==="bullet"),onClick:i,children:[e.jsx("i",{className:"icon bullet-list"}),e.jsx("span",{className:"text",children:"Bullet List"})]}),e.jsxs(it,{className:"item "+qt(s==="number"),onClick:d,children:[e.jsx("i",{className:"icon numbered-list"}),e.jsx("span",{className:"text",children:"Numbered List"})]}),e.jsxs(it,{className:"item "+qt(s==="check"),onClick:c,children:[e.jsx("i",{className:"icon check-list"}),e.jsx("span",{className:"text",children:"Check List"})]}),e.jsxs(it,{className:"item "+qt(s==="quote"),onClick:u,children:[e.jsx("i",{className:"icon quote"}),e.jsx("span",{className:"text",children:"Quote"})]}),e.jsxs(it,{className:"item "+qt(s==="code"),onClick:p,children:[e.jsx("i",{className:"icon code"}),e.jsx("span",{className:"text",children:"Code Block"})]})]})}function na(){return e.jsx("div",{className:"divider"})}function E5({editor:t,value:s,isRTL:n,disabled:r=!1}){const a=Ia[s||"left"];return e.jsxs(vn,{disabled:r,buttonLabel:a.name,buttonIconClassName:`icon ${n?a.iconRTL:a.icon}`,buttonClassName:"toolbar-item spaced alignment",buttonAriaLabel:"Formatting options for text alignment",children:[e.jsxs(it,{onClick:()=>{t.dispatchCommand(ee.FORMAT_ELEMENT_COMMAND,"left")},className:"item",children:[e.jsx("i",{className:"icon left-align"}),e.jsx("span",{className:"text",children:"Left Align"})]}),e.jsxs(it,{onClick:()=>{t.dispatchCommand(ee.FORMAT_ELEMENT_COMMAND,"center")},className:"item",children:[e.jsx("i",{className:"icon center-align"}),e.jsx("span",{className:"text",children:"Center Align"})]}),e.jsxs(it,{onClick:()=>{t.dispatchCommand(ee.FORMAT_ELEMENT_COMMAND,"right")},className:"item",children:[e.jsx("i",{className:"icon right-align"}),e.jsx("span",{className:"text",children:"Right Align"})]}),e.jsxs(it,{onClick:()=>{t.dispatchCommand(ee.FORMAT_ELEMENT_COMMAND,"justify")},className:"item",children:[e.jsx("i",{className:"icon justify-align"}),e.jsx("span",{className:"text",children:"Justify Align"})]}),e.jsxs(it,{onClick:()=>{t.dispatchCommand(ee.FORMAT_ELEMENT_COMMAND,"start")},className:"item",children:[e.jsx("i",{className:`icon ${n?Ia.start.iconRTL:Ia.start.icon}`}),e.jsx("span",{className:"text",children:"Start Align"})]}),e.jsxs(it,{onClick:()=>{t.dispatchCommand(ee.FORMAT_ELEMENT_COMMAND,"end")},className:"item",children:[e.jsx("i",{className:`icon ${n?Ia.end.iconRTL:Ia.end.icon}`}),e.jsx("span",{className:"text",children:"End Align"})]}),e.jsx(na,{}),e.jsxs(it,{onClick:()=>{t.dispatchCommand(ee.OUTDENT_CONTENT_COMMAND,void 0)},className:"item",children:[e.jsx("i",{className:"icon "+(n?"indent":"outdent")}),e.jsx("span",{className:"text",children:"Outdent"})]}),e.jsxs(it,{onClick:()=>{t.dispatchCommand(ee.INDENT_CONTENT_COMMAND,void 0)},className:"item",children:[e.jsx("i",{className:"icon "+(n?"outdent":"indent")}),e.jsx("span",{className:"text",children:"Indent"})]})]})}function k5({setIsLinkEditMode:t}){const[s]=xt.useLexicalComposerContext(),[n,r]=b.useState(s),[a,l]=b.useState("paragraph"),[i,c]=b.useState("root"),[d,u]=b.useState(null),[p,m]=b.useState("15px"),[h,f]=b.useState("#000"),[g,x]=b.useState("#dfe6ef"),[y,j]=b.useState("Arial"),[N,_]=b.useState("left"),[E,L]=b.useState(!1),[S,k]=b.useState(!1),[$,I]=b.useState(!1),[T,A]=b.useState(!1),[R,O]=b.useState(!1),[M,D]=b.useState(!1),[P,F]=b.useState(!1),[B,V]=b.useState(!1),[G,Z]=b.useState(!1),[X,H]=b.useState(!1),[z,W]=xr(),[Y,U]=b.useState(!1),[q,te]=b.useState(""),[K,ne]=b.useState(()=>s.isEditable()),J=b.useCallback(()=>{const se=ee.$getSelection();if(ee.$isRangeSelection(se)){const me=se.anchor.getNode();let xe=me.getKey()==="root"?me:yt.$findMatchingParent(me,ie=>{const be=ie.getParent();return be!==null&&ee.$isRootOrShadowRoot(be)});xe===null&&(xe=me.getTopLevelElementOrThrow());const re=xe.getKey(),Q=n.getElementByKey(re);k(se.hasFormat("bold")),I(se.hasFormat("italic")),A(se.hasFormat("underline")),O(se.hasFormat("strikethrough")),D(se.hasFormat("subscript")),F(se.hasFormat("superscript")),V(se.hasFormat("code")),U(Ot.$isParentElementRTL(se));const pe=nr(se),ge=pe.getParent();_t.$isLinkNode(ge)||_t.$isLinkNode(pe)?L(!0):L(!1);const le=yt.$findMatchingParent(pe,Se.$isTableNode);if(Se.$isTableNode(le)?c("table"):c("root"),Q!==null)if(u(re),Pt.$isListNode(xe)){const ie=yt.$getNearestNodeOfType(me,Pt.ListNode),be=ie?ie.getListType():xe.getListType();l(be)}else{const ie=es.$isHeadingNode(xe)?xe.getTag():xe.getType();if(ie in bi&&l(ie),Dt.$isCodeNode(xe)){const be=xe.getLanguage();te(be?Dt.CODE_LANGUAGE_MAP[be]||be:"");return}}m(Ot.$getSelectionStyleValueForProperty(se,"font-size","15px")),f(Ot.$getSelectionStyleValueForProperty(se,"color","#000")),x(Ot.$getSelectionStyleValueForProperty(se,"background-color","#dfe6ef")),j(Ot.$getSelectionStyleValueForProperty(se,"font-family","Arial")),_((ee.$isElementNode(pe)?pe.getFormatType():ge==null?void 0:ge.getFormatType())||"left")}},[n]);b.useEffect(()=>s.registerCommand(ee.SELECTION_CHANGE_COMMAND,(se,me)=>(J(),r(me),!1),ee.COMMAND_PRIORITY_CRITICAL),[s,J]),b.useEffect(()=>(K!==s.isEditable()&&ne(s.isEditable()),yt.mergeRegister(s.registerEditableListener(se=>{ne(se)}),n.registerUpdateListener(({editorState:se})=>{se.read(()=>{J()})}),n.registerCommand(ee.CAN_UNDO_COMMAND,se=>(Z(se),!1),ee.COMMAND_PRIORITY_CRITICAL),n.registerCommand(ee.CAN_REDO_COMMAND,se=>(H(se),!1),ee.COMMAND_PRIORITY_CRITICAL))),[J,n,s]),b.useEffect(()=>n.registerCommand(ee.KEY_MODIFIER_COMMAND,se=>{const me=se,{code:xe,ctrlKey:re,metaKey:Q}=me;return xe==="KeyK"&&(re||Q)?(me.preventDefault(),t(!E),n.dispatchCommand(_t.TOGGLE_LINK_COMMAND,"https://")):!1},ee.COMMAND_PRIORITY_NORMAL),[n,E,t]);const ae=b.useCallback((se,me)=>{n.update(()=>{const xe=ee.$getSelection();xe!==null&&Ot.$patchStyleText(xe,se)},me?{tag:"historic"}:{})},[n]),de=b.useCallback(()=>{n.update(()=>{const se=ee.$getSelection();if(ee.$isRangeSelection(se)){const me=se.anchor,xe=se.focus,re=se.getNodes();if(me.key===xe.key&&me.offset===xe.offset)return;re.forEach((Q,pe)=>{ee.$isTextNode(Q)?(pe===0&&me.offset!==0&&(Q=Q.splitText(me.offset)[1]||Q),pe===re.length-1&&(Q=Q.splitText(xe.offset)[0]||Q),Q.__style!==""&&Q.setStyle(""),Q.__format!==0&&(Q.setFormat(0),yt.$getNearestBlockElementAncestorOrThrow(Q).setFormat(""))):es.$isHeadingNode(Q)||es.$isQuoteNode(Q)?Q.replace(ee.$createParagraphNode(),!0):hc.$isDecoratorBlockNode(Q)&&Q.setFormat("")})}})},[n]),ue=b.useCallback(se=>{ae({color:se})},[ae]),fe=b.useCallback(se=>{ae({"background-color":se}),ae({padding:"4px 12px"}),ae({border:"1px solid"}),ae({"border-color":"#60a5fa"}),ae({"border-radius":"8px"})},[ae]);b.useCallback(()=>{E?s.dispatchCommand(_t.TOGGLE_LINK_COMMAND,null):s.dispatchCommand(_t.TOGGLE_LINK_COMMAND,"https://")},[s,E]);const ve=b.useCallback(se=>{n.update(()=>{if(d!==null){const me=ee.$getNodeByKey(d);Dt.$isCodeNode(me)&&me.setLanguage(se)}})},[n,d]);return K?e.jsxs("div",{className:"toolbar",children:[e.jsx("button",{disabled:!G||!K,onClick:()=>{n.dispatchCommand(ee.UNDO_COMMAND,void 0)},title:fu?"Undo (⌘Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:e.jsx("i",{className:"format undo"})}),e.jsx("button",{disabled:!X||!K,onClick:()=>{n.dispatchCommand(ee.REDO_COMMAND,void 0)},title:fu?"Redo (⌘Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:e.jsx("i",{className:"format redo"})}),e.jsx(na,{}),a in bi&&n===s&&e.jsxs(e.Fragment,{children:[e.jsx($5,{disabled:!K,blockType:a,rootType:i,editor:s}),e.jsx(na,{})]}),a==="code"?e.jsx(vn,{disabled:!K,buttonClassName:"toolbar-item code-language",buttonLabel:Dt.getLanguageFriendlyName(q),buttonAriaLabel:"Select language",children:S5.map(([se,me])=>e.jsx(it,{className:`item ${qt(se===q)}`,onClick:()=>ve(se),children:e.jsx("span",{className:"text",children:me})},se))}):e.jsxs(e.Fragment,{children:[e.jsx(xu,{disabled:!K,buttonClassName:"toolbar-item color-picker",buttonAriaLabel:"Formatting text color",buttonIconClassName:"icon font-color",color:h,onChange:ue,title:"text color"}),e.jsx(xu,{disabled:!K,buttonClassName:"toolbar-item color-picker",buttonAriaLabel:"Formatting background color",buttonIconClassName:"icon bg-color",color:g,onChange:fe,title:"bg color"}),e.jsxs(vn,{disabled:!K,buttonClassName:"toolbar-item spaced",buttonLabel:"",buttonAriaLabel:"Formatting options for additional text styles",buttonIconClassName:"icon dropdown-more",children:[e.jsxs(it,{onClick:()=>{n.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"strikethrough")},className:"item "+qt(R),title:"Strikethrough","aria-label":"Format text with a strikethrough",children:[e.jsx("i",{className:"icon strikethrough"}),e.jsx("span",{className:"text",children:"Strikethrough"})]}),e.jsxs(it,{onClick:()=>{n.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"subscript")},className:"item "+qt(M),title:"Subscript","aria-label":"Format text with a subscript",children:[e.jsx("i",{className:"icon subscript"}),e.jsx("span",{className:"text",children:"Subscript"})]}),e.jsxs(it,{onClick:()=>{n.dispatchCommand(ee.FORMAT_TEXT_COMMAND,"superscript")},className:"item "+qt(P),title:"Superscript","aria-label":"Format text with a superscript",children:[e.jsx("i",{className:"icon superscript"}),e.jsx("span",{className:"text",children:"Superscript"})]}),e.jsxs(it,{onClick:de,className:"item",title:"Clear text formatting","aria-label":"Clear all text formatting",children:[e.jsx("i",{className:"icon clear"}),e.jsx("span",{className:"text",children:"Clear Formatting"})]})]}),e.jsx(na,{}),i==="table"&&e.jsxs(e.Fragment,{children:[e.jsx(vn,{disabled:!K,buttonClassName:"toolbar-item spaced",buttonLabel:"Table",buttonAriaLabel:"Open table toolkit",buttonIconClassName:"icon table secondary",children:e.jsx(it,{onClick:()=>{},className:"item",children:e.jsx("span",{className:"text",children:"TODO"})})}),e.jsx(na,{})]}),e.jsxs(vn,{disabled:!K,buttonClassName:"toolbar-item spaced",buttonLabel:"Insert",buttonAriaLabel:"Insert specialized editor node",buttonIconClassName:"icon plus",children:[e.jsxs(it,{onClick:()=>{n.dispatchCommand(la.INSERT_HORIZONTAL_RULE_COMMAND,void 0)},className:"item",children:[e.jsx("i",{className:"icon horizontal-rule"}),e.jsx("span",{className:"text",children:"Horizontal Rule"})]}),e.jsxs(it,{onClick:()=>{W("Insert Image",se=>e.jsx(yh,{activeEditor:n,onClose:se}))},className:"item",children:[e.jsx("i",{className:"icon image"}),e.jsx("span",{className:"text",children:"Image"})]}),e.jsxs(it,{onClick:()=>{W("Insert Table",se=>e.jsx(Eh,{activeEditor:n,onClose:se}))},className:"item",children:[e.jsx("i",{className:"icon table"}),e.jsx("span",{className:"text",children:"Table"})]}),e.jsxs(it,{onClick:()=>{W("Insert Table",se=>e.jsx(xC,{activeEditor:n,onClose:se}))},className:"item",children:[e.jsx("i",{className:"icon table"}),e.jsx("span",{className:"text",children:"Table (Experimental)"})]}),e.jsxs(it,{onClick:()=>{s.dispatchCommand(Ic,void 0)},className:"item",children:[e.jsx("i",{className:"icon caret-right"}),e.jsx("span",{className:"text",children:"Collapsible container"})]})]})]}),e.jsx(na,{}),e.jsx(E5,{disabled:!K,value:N,editor:s,isRTL:Y}),z]}):e.jsx("div",{className:"toolbar"})}function L5(){const[t]=xt.useLexicalComposerContext();return e.jsx(Xb.TreeView,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",editor:t})}const Ah={blockCursor:"block pointer-events-none absolute content-['']  after:absolute after:-top-[2px] after:w-[20px] after:border-t-[1px_solid_black]",characterLimit:"inline !bg-[#ffbbbb]",code:"bg-[rgb(240,_242,_245)] font-[Menlo,_Consolas,_Monaco,_monospace] block pl-[52px] pr-[8px] py-[8px] leading-[1.53] text-[13px] m-0 mt-[8px] mb-[8px] [tab-size:2] relative after:content-[attr(data-gutter)] after:absolute after:bg-[#eee] after:left-[0] after:top-[0] after:border-r-[1px_solid_#ccc] after:p-[8px] after:text-[#777] after:whitespace-pre-wrap after:text-right after:min-w-[25px]",codeHighlight:{atrule:"text-[#07a]",attr:"text-[#07a]",boolean:"text-[#905]",builtin:"text-[#690]",cdata:"text-[slategray]",char:"text-[#690]",class:"text-[#dd4a68]","class-name":"text-[#dd4a68]",comment:"text-[slategray]",constant:"text-[#905]",deleted:"text-[#905]",doctype:"text-[slategray]",entity:"text-[#9a6e3a]",function:"text-[#dd4a68]",important:"text-[#e90]",inserted:"text-[#690]",keyword:"text-[#07a]",namespace:"text-[#e90]",number:"text-[#905]",operator:"text-[#9a6e3a]",prolog:"text-[slategray]",property:"text-[#905]",punctuation:"text-[#999]",regex:"text-[#e90]",selector:"text-[#690]",string:"text-[#690]",symbol:"text-[#905]",tag:"text-[#905]",url:"text-[#9a6e3a]",variable:"text-[#e90]"},embedBlock:{base:"select-none",focus:"outline-[2px_solid_rgb(60,_132,_244)]"},hashtag:"bg-[rgba(88,_144,_255,_0.15)] border-b-[1px_solid_rgba(88,_144,_255,_0.3)]",heading:{h1:"font-semibold text-2xl scroll-mt-36 font-display",h2:"font-medium text-xl scroll-mt-36 font-display",h3:"font-medium text-lg scroll-mt-36 font-display",h4:"font-medium scroll-mt-36 font-display",h5:"scroll-mt-36 font-display",h6:"scroll-mt-36 font-display"},image:"editor-image",indent:"PlaygroundEditorTheme__indent",inlineImage:"inline-editor-image",link:"PlaygroundEditorTheme__link",list:{listitem:"PlaygroundEditorTheme__listItem",listitemChecked:"PlaygroundEditorTheme__listItemChecked",listitemUnchecked:"PlaygroundEditorTheme__listItemUnchecked",nested:{listitem:"PlaygroundEditorTheme__nestedListItem"},olDepth:["PlaygroundEditorTheme__ol1 list-decimal","PlaygroundEditorTheme__ol2","PlaygroundEditorTheme__ol3","PlaygroundEditorTheme__ol4","PlaygroundEditorTheme__ol5"],ul:"PlaygroundEditorTheme__ul"},ltr:"PlaygroundEditorTheme__ltr",mark:"PlaygroundEditorTheme__mark",markOverlap:"PlaygroundEditorTheme__markOverlap",paragraph:"PlaygroundEditorTheme__paragraph",quote:"PlaygroundEditorTheme__quote",rtl:"PlaygroundEditorTheme__rtl",table:"PlaygroundEditorTheme__table",tableAddColumns:"PlaygroundEditorTheme__tableAddColumns",tableAddRows:"PlaygroundEditorTheme__tableAddRows",tableCell:"PlaygroundEditorTheme__tableCell",tableCellActionButton:"PlaygroundEditorTheme__tableCellActionButton",tableCellActionButtonContainer:"PlaygroundEditorTheme__tableCellActionButtonContainer",tableCellEditing:"PlaygroundEditorTheme__tableCellEditing",tableCellHeader:"PlaygroundEditorTheme__tableCellHeader",tableCellPrimarySelected:"PlaygroundEditorTheme__tableCellPrimarySelected",tableCellResizer:"PlaygroundEditorTheme__tableCellResizer",tableCellSelected:"PlaygroundEditorTheme__tableCellSelected",tableCellSortedIndicator:"PlaygroundEditorTheme__tableCellSortedIndicator",tableResizeRuler:"PlaygroundEditorTheme__tableCellResizeRuler",tableSelected:"PlaygroundEditorTheme__tableSelected",text:{bold:"PlaygroundEditorTheme__textBold",code:"PlaygroundEditorTheme__textCode",italic:"PlaygroundEditorTheme__textItalic",strikethrough:"PlaygroundEditorTheme__textStrikethrough",subscript:"PlaygroundEditorTheme__textSubscript",superscript:"PlaygroundEditorTheme__textSuperscript",underline:"PlaygroundEditorTheme__textUnderline",underlineStrikethrough:"PlaygroundEditorTheme__textUnderlineStrikethrough"}};function Bl({className:t}){return e.jsx(Qb.ContentEditable,{className:t||"border-none relative [tab-size:1] outline-none pt-[8px] px-[8px] lg:px-[28px] pb-[14px]"})}function I5({children:t,className:s}){return e.jsx("div",{className:s||"text-[15px] text-[#999] overflow-hidden absolute overflow-ellipsis top-[8px] left-[8px] lg:left-[28px] right-[28px] select-none whitespace-nowrap inline-block pointer-events-none",children:t})}function T5(t){const{historyState:s}=eN(),{isAutocomplete:n,isMaxLength:r,isCharLimit:a,isCharLimitUtf8:l,isRichText:i=!0,showTreeView:c,showTableOfContents:d,showActionBar:u,placeholderText:p="",editable:m=!0,bgColor:h}=t,f=e.jsx(I5,{children:p}),[g,x]=b.useState(null),[y,j]=b.useState(!1),[N,_]=b.useState(!1),E=S=>{S!==null&&x(S)},L={namespace:"Playground",nodes:[...hN],onError:S=>{throw S},theme:Ah};return b.useEffect(()=>{const S=()=>{const k=gr&&window.matchMedia("(max-width: 1025px)").matches;k!==N&&_(k)};return window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)}},[N]),e.jsxs(e.Fragment,{children:[i&&m&&e.jsx(k5,{}),e.jsxs("div",{className:`${m?"editor-container":"view-container"} ${c?"tree-view":""} ${i?"":"plain-text"}`,style:{backgroundColor:h},children:[r&&e.jsx(s5,{maxLength:30}),e.jsx(NC,{}),e.jsx(ey.ClearEditorPlugin,{}),e.jsx(wC,{}),e.jsx(UN,{}),e.jsx(XC,{}),e.jsx(IN,{}),e.jsx(qN,{}),i?e.jsxs(e.Fragment,{children:[e.jsx(vl.HistoryPlugin,{externalHistoryState:s}),e.jsx(Ed.RichTextPlugin,{contentEditable:e.jsx("div",{className:m?"editor-scroller":"view-scroller",children:e.jsx("div",{className:"editor",ref:E,children:e.jsx(Bl,{})})}),placeholder:f,ErrorBoundary:jl}),e.jsx(YN,{}),e.jsx(ty.ListPlugin,{}),e.jsx(sy.CheckListPlugin,{}),e.jsx(t5,{maxDepth:7}),e.jsx(ny.TablePlugin,{}),e.jsx(b5,{}),e.jsxs(bC,{cellEditorConfig:L,children:[e.jsx(ay.AutoFocusPlugin,{}),e.jsx(Ed.RichTextPlugin,{contentEditable:e.jsx(Bl,{className:"min-h-[20px] border-[0px] resize-none cursor-text block relative [tab-size:1] outline-[0px] p-[10px] select-text text-[14px] leading-[1.4em] w-[calc(100%_-_20px)] whitespace-pre-wrap"}),placeholder:null,ErrorBoundary:jl}),e.jsx(vl.HistoryPlugin,{}),e.jsx(ru,{}),e.jsx(Yd,{}),e.jsx(au,{})]}),e.jsx(aC,{}),e.jsx(ru,{}),e.jsx(DN,{}),e.jsx(Yd,{}),e.jsx(ry.HorizontalRulePlugin,{}),e.jsx(o5,{}),e.jsx(oy.TabIndentationPlugin,{}),e.jsx(eC,{}),g&&!N&&e.jsxs(e.Fragment,{children:[e.jsx(DC,{anchorElem:g}),e.jsx(UC,{anchorElem:g,isLinkEditMode:y,setIsLinkEditMode:j}),e.jsx(h5,{anchorElem:g,cellMerge:!0}),e.jsx(au,{anchorElem:g,showComments:!0})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ly.PlainTextPlugin,{contentEditable:e.jsx(Bl,{}),placeholder:f,ErrorBoundary:jl}),e.jsx(vl.HistoryPlugin,{externalHistoryState:s})]}),(a||l)&&e.jsx(iy.CharacterLimitPlugin,{charset:a?"UTF-16":"UTF-8",maxLength:5}),n&&e.jsx(oN,{}),e.jsx("div",{children:d&&e.jsx(w5,{})}),u&&e.jsx(BN,{isRichText:i})]}),c&&e.jsx(L5,{})]})}const M5=[es.HeadingNode,Pt.ListNode,Pt.ListItemNode,es.QuoteNode,Dt.CodeNode,Gn,Se.TableNode,Se.TableCellNode,Se.TableRowNode,Dt.CodeHighlightNode,_t.AutoLinkNode,_t.LinkNode,cy.OverflowNode,mn,Ca,Bn,la.HorizontalRuleNode,yr,dy.MarkNode,An,On,Pn];function Oh({value:t,onChange:s,bgColor:n,editable:r=!1,id:a}){var i,c,d,u;const l={editorState:(i=JSON.parse(t||"{}"))!=null&&i.root&&((u=(d=(c=JSON.parse(t||"{}"))==null?void 0:c.root)==null?void 0:d.children)!=null&&u.length)?t:null,namespace:"dms-lexical",nodes:[...M5],editable:r,readOnly:!r,onError:p=>{throw p},theme:Ah};return e.jsx(uy.LexicalComposer,{initialConfig:l,children:e.jsx(B5,{value:t,onChange:s,bgColor:n,editable:r})},a)}function B5({value:t,onChange:s,bgColor:n,editable:r}){const a=w.useRef(!0),[l]=xt.useLexicalComposerContext();return w.useEffect(()=>{var i,c;if(a.current&&(a.current=!1),!r&&!a.current){const d=JSON.parse(t||"{}"),u=d.root&&((c=(i=d==null?void 0:d.root)==null?void 0:i.children)!=null&&c.length)?t:null;if(u){const p=l.parseEditorState(u);l.setEditorState(p)}}},[a.current,t]),e.jsxs("div",{className:"editor-shell",children:[e.jsx(T5,{editable:r,bgColor:n}),e.jsx(my.OnChangePlugin,{onChange:s})]})}function A5(t){try{JSON.parse(t)}catch{return!1}return!0}function Ph(t){return t&&typeof t=="object"?JSON.stringify(t):A5(t)?t:null}const O5=({value:t,onChange:s,...n})=>e.jsx("div",{className:"editor-shell tracking-wide leading-7",children:e.jsx(Oh,{value:Ph(t),onChange:r=>s(r),editable:!0,...n})}),P5=({value:t,...s})=>e.jsx("div",{className:"editor-shell tracking-wide leading-7",children:e.jsx(Oh,{value:Ph(t),editable:!1,...s})}),Dh={EditComp:O5,ViewComp:P5},D5=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M21.544 11.045C21.848 11.4713 22 11.6845 22 12C22 12.3155 21.848 12.5287 21.544 12.955C20.1779 14.8706 16.6892 19 12 19C7.31078 19 3.8221 14.8706 2.45604 12.955C2.15201 12.5287 2 12.3155 2 12C2 11.6845 2.15201 11.4713 2.45604 11.045C3.8221 9.12944 7.31078 5 12 5C16.6892 5 20.1779 9.12944 21.544 11.045Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15C13.6569 15 15 13.6569 15 12Z",stroke:"currentColor",strokeWidth:"1.5"})]}),R5=({size:t=24,className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:t,height:t,color:"#000000",fill:"none",className:s,children:[e.jsx("path",{d:"M15.2141 5.98239L16.6158 4.58063C17.39 3.80646 18.6452 3.80646 19.4194 4.58063C20.1935 5.3548 20.1935 6.60998 19.4194 7.38415L18.0176 8.78591M15.2141 5.98239L6.98023 14.2163C5.93493 15.2616 5.41226 15.7842 5.05637 16.4211C4.70047 17.058 4.3424 18.5619 4 20C5.43809 19.6576 6.94199 19.2995 7.57889 18.9436C8.21579 18.5877 8.73844 18.0651 9.78375 17.0198L18.0176 8.78591M15.2141 5.98239L18.0176 8.78591",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11 20H17",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),Rh=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("title",{children:t.title}),e.jsx("path",{d:"M22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M12.2422 17V12C12.2422 11.5286 12.2422 11.2929 12.0957 11.1464C11.9493 11 11.7136 11 11.2422 11",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11.992 8H12.001",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),al=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"#fff",...t,children:e.jsx("path",{d:"M18 9.00005C18 9.00005 13.5811 15 12 15C10.4188 15 6 9 6 9",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),vo=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:16,height:16,color:"#000000",fill:"none",...t,children:e.jsx("path",{d:"M9.00005 6C9.00005 6 15 10.4189 15 12C15 13.5812 9 18 9 18",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),F5=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:18,height:18,color:"#000000",fill:"#fff",...t,children:[e.jsx("path",{d:"M4 14H8.42109C9.35119 14 9.81624 14 9.94012 14.2801C10.064 14.5603 9.74755 14.8963 9.11466 15.5684L5.47691 19.4316C4.84402 20.1037 4.52757 20.4397 4.65145 20.7199C4.77533 21 5.24038 21 6.17048 21H10",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M4 9L6.10557 4.30527C6.49585 3.43509 6.69098 3 7 3C7.30902 3 7.50415 3.43509 7.89443 4.30527L10 9",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M17.5 20V4M17.5 20C16.7998 20 15.4915 18.0057 15 17.5M17.5 20C18.2002 20 19.5085 18.0057 20 17.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),V5=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:18,height:18,color:"#000000",fill:"#fff",...t,children:[e.jsx("path",{d:"M4 3H8.42109C9.35119 3 9.81624 3 9.94012 3.28013C10.064 3.56026 9.74755 3.89632 9.11466 4.56842L5.47691 8.43158C4.84402 9.10368 4.52757 9.43974 4.65145 9.71987C4.77533 10 5.24038 10 6.17048 10H10",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M4 21L6.10557 16.3053C6.49585 15.4351 6.69098 15 7 15C7.30902 15 7.50415 15.4351 7.89443 16.3053L10 21",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M17.5 20V4M17.5 20C16.7998 20 15.4915 18.0057 15 17.5M17.5 20C18.2002 20 19.5085 18.0057 20 17.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Fh=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M19.5 5.5L18.8803 15.5251C18.7219 18.0864 18.6428 19.3671 18.0008 20.2879C17.6833 20.7431 17.2747 21.1273 16.8007 21.416C15.8421 22 14.559 22 11.9927 22C9.42312 22 8.1383 22 7.17905 21.4149C6.7048 21.1257 6.296 20.7408 5.97868 20.2848C5.33688 19.3626 5.25945 18.0801 5.10461 15.5152L4.5 5.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M3 5.5H21M16.0557 5.5L15.3731 4.09173C14.9196 3.15626 14.6928 2.68852 14.3017 2.39681C14.215 2.3321 14.1231 2.27454 14.027 2.2247C13.5939 2 13.0741 2 12.0345 2C10.9688 2 10.436 2 9.99568 2.23412C9.8981 2.28601 9.80498 2.3459 9.71729 2.41317C9.32164 2.7167 9.10063 3.20155 8.65861 4.17126L8.05292 5.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M9.5 16.5L9.5 10.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M14.5 16.5L14.5 10.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),Vh=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M12 4V20",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M4 12H20",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Mc=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("title",{children:t.title}),e.jsx("path",{d:"M5.32171 9.6829C7.73539 5.41196 8.94222 3.27648 10.5983 2.72678C11.5093 2.42437 12.4907 2.42437 13.4017 2.72678C15.0578 3.27648 16.2646 5.41196 18.6783 9.6829C21.092 13.9538 22.2988 16.0893 21.9368 17.8293C21.7376 18.7866 21.2469 19.6548 20.535 20.3097C19.241 21.5 16.8274 21.5 12 21.5C7.17265 21.5 4.75897 21.5 3.46496 20.3097C2.75308 19.6548 2.26239 18.7866 2.06322 17.8293C1.70119 16.0893 2.90803 13.9538 5.32171 9.6829Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M12.2422 17V13C12.2422 12.5286 12.2422 12.2929 12.0957 12.1464C11.9493 12 11.7136 12 11.2422 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11.992 8.99997H12.001",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Hh=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:e.jsx("path",{d:"M8.85746 12.5061C6.36901 10.6456 4.59564 8.59915 3.62734 7.44867C3.3276 7.09253 3.22938 6.8319 3.17033 6.3728C2.96811 4.8008 2.86701 4.0148 3.32795 3.5074C3.7889 3 4.60404 3 6.23433 3H17.7657C19.396 3 20.2111 3 20.672 3.5074C21.133 4.0148 21.0319 4.8008 20.8297 6.37281C20.7706 6.83191 20.6724 7.09254 20.3726 7.44867C19.403 8.60062 17.6261 10.6507 15.1326 12.5135C14.907 12.6821 14.7583 12.9567 14.7307 13.2614C14.4837 15.992 14.2559 17.4876 14.1141 18.2442C13.8853 19.4657 12.1532 20.2006 11.226 20.8563C10.6741 21.2466 10.0043 20.782 9.93278 20.1778C9.79643 19.0261 9.53961 16.6864 9.25927 13.2614C9.23409 12.9539 9.08486 12.6761 8.85746 12.5061Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),zh=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:16,height:16,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M17 2V4M12 2V4M7 2V4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M3.5 10C3.5 6.70017 3.5 5.05025 4.52513 4.02513C5.55025 3 7.20017 3 10.5 3H13.5C16.7998 3 18.4497 3 19.4749 4.02513C20.5 5.05025 20.5 6.70017 20.5 10V15C20.5 18.2998 20.5 19.9497 19.4749 20.9749C18.4497 22 16.7998 22 13.5 22H10.5C7.20017 22 5.55025 22 4.52513 20.9749C3.5 19.9497 3.5 18.2998 3.5 15V10Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M8 15H12M8 10H16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),Uh=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:16,height:16,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M16.9017 6.12874C18 7.25748 18 9.07416 18 12.7075V14.2925C18 17.9258 18 19.7425 16.9017 20.8713C15.8033 22 14.0355 22 10.5 22C6.96447 22 5.1967 22 4.09835 20.8713C3 19.7425 3 17.9258 3 14.2925V12.7075C3 9.07416 3 7.25748 4.09835 6.12874C5.1967 5 6.96447 5 10.5 5C14.0355 5 15.8033 5 16.9017 6.12874Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7.5 5.5V10.3693C7.5 11.3046 7.5 11.7722 7.78982 11.9396C8.35105 12.2638 9.4038 11.1823 9.90375 10.8567C10.1937 10.6678 10.3387 10.5734 10.5 10.5734C10.6613 10.5734 10.8063 10.6678 11.0962 10.8567C11.5962 11.1823 12.6489 12.2638 13.2102 11.9396C13.5 11.7722 13.5 11.3046 13.5 10.3693V5.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 2H11C15.714 2 18.0711 2 19.5355 3.46447C21 4.92893 21 7.28595 21 12V18",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Wh=t=>{try{JSON.parse(t)}catch{return!1}return!0},H5=({to:t,text:s})=>e.jsx(je,{className:"p-2 mx-1 bg-blue-300 hover:bg-blue-600 text-white rounded-md",to:t,children:s}),Gh=({title:t,buttons:s=[]})=>e.jsxs("div",{className:"w-full flex justify-between border-b rounded-l-lg pr-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-3xl text-blue-500 text-bold tracking-wide border-b-4 border-blue-500 px-2",children:t.substring(0,1)}),e.jsx("span",{className:"text-3xl -ml-2 text-blue-500 text-bold tracking-wide",children:t.substring(1,t.length)})]}),e.jsx("div",{children:s.map(n=>e.jsx(H5,{...n}))})]}),Jh=({value:t,onChange:s,size:n,format:r,apiLoad:a,apiUpdate:l,...i})=>{const c=Wh(t)?JSON.parse(t):{},[d,u]=b.useState(c.title||""),[p,m]=b.useState(c.buttons||[]);return b.useEffect(()=>{s(JSON.stringify({...c,title:d,buttons:p}))},[d,p]),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"border flex justify-between",children:[e.jsx("input",{className:"p-2 w-full",placeholder:"Please enter title...",value:d,onChange:h=>u(h.target.value)}),e.jsx("button",{className:"bg-blue-300 hover:bg-blue-600 text-white rounded-md",onClick:()=>m([...p,{to:"",text:""}]),children:"add button"})]}),p.map((h,f)=>e.jsxs("div",{className:"flex",children:[e.jsx("input",{className:"p-2",placeholder:"text",value:h.text,onChange:g=>m([...p.map((x,y)=>f===y?{...x,text:g.target.value}:x)])}),e.jsx("input",{className:"p-2",placeholder:"link",value:h.to,onChange:g=>m([...p.map((x,y)=>f===y?{...x,to:g.target.value}:x)])}),e.jsx("button",{onClick:()=>m(p.filter((g,x)=>x!==f)),children:e.jsx(Fh,{className:"text-red-300 hover:text-red-600"})})]}))]}),e.jsx(Gh,{title:d,buttons:p})]})},z5=({value:t,format:s,apiLoad:n,...r})=>{const a=Wh(t)?JSON.parse(t):{},{title:l,buttons:i}=a;return e.jsx(Gh,{title:l,buttons:i})};Jh.settings={hasControls:!0,name:"ElementEdit"};const U5={name:"Header: Title",type:"Header",variables:[{name:"title"}],EditComp:Jh,ViewComp:z5};function vr({enabled:t=!1,setEnabled:s,label:n,size:r="medium"}){const a={small:"h-4 w-8",medium:"h-6 w-11"},l={small:"h-3.5 w-3.5 p-1",medium:"h-4 w-4"},i={true:{small:"translate-x-4",medium:"translate-x-6"},false:{small:"translate-x-0.5",medium:"translate-x-1"}},c={small:"rounded-lg",medium:"rounded-full"};return e.jsxs("div",{role:"switch","aria-checked":t,tabIndex:0,onClick:()=>s&&s(!t),onKeyDown:d=>{if(d.key==="Enter"||d.key===" ")return d.preventDefault(),!t},className:`relative inline-flex ${a[r]} items-center ${c[r]} cursor-pointer transition-colors duration-200 ease-in-out ${t?"bg-indigo-600":"bg-gray-200"}`,children:[e.jsx("span",{className:"sr-only",children:n}),e.jsx("span",{className:`inline-block ${l[r]} transform rounded-full bg-white transition-transform duration-200 ease-in-out ${i[t][r]}`})]})}function W5({attributes:t,setAttributes:s,visibleAttributes:n,setVisibleAttributes:r}){const a=b.useRef(),l=b.useRef(),i=b.useRef(null),[c,d]=b.useState(),[u,p]=b.useState(!1),m="menu-btn-column-controls",h=(j,N)=>{a.current=N,j.dataTransfer.effectAllowed="move"},f=(j,N)=>{l.current=N},g=j=>{j.preventDefault(),j.dataTransfer.dropEffect="move"},x=j=>{const N=[...n.map(E=>t.find(L=>L.name===E)),...t.filter(E=>!n.includes(E.name))],_=N[a.current];N.splice(a.current,1),N.splice(l.current,0,_),a.current=null,l.current=null,s(N),r(N.filter(E=>n.includes(E.name)).map(E=>E.name))},y=j=>{i.current&&!i.current.contains(j.target)&&j.target.id!==m&&p(!1)};return w.useEffect(()=>(document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}),[]),e.jsxs("div",{className:"relative inline-block text-left",children:[e.jsx("div",{children:e.jsxs("div",{id:m,className:`inline-flex w-full justify-center items-center rounded-md px-1.5 py-1 text-sm font-regular text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 ${u?"bg-gray-50":"bg-white hover:bg-gray-50"} cursor-pointer`,onClick:j=>p(!u),children:["Columns ",e.jsx(al,{height:18,width:18,className:"mt-1"})]})}),e.jsxs("div",{ref:i,className:`${u?"visible transition ease-in duration-200":"hidden transition ease-in duration-200"} absolute left-0 z-10 w-72 origin-top-left divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 transition focus:outline-none`,children:[e.jsx("input",{className:"px-4 py-1 w-full rounded-md",placeholder:"search...",onChange:j=>{d(j.target.value)}}),e.jsx("div",{className:"py-1 max-h-[500px] overflow-auto scrollbar-sm",children:t.filter(j=>j&&(!c||(j.display_name||j.name).toLowerCase().includes(c.toLowerCase()))).map((j,N)=>e.jsxs("div",{className:"flex items-center px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900",onDragStart:_=>h(_,N),onDragEnter:_=>f(_,N),onDragOver:g,onDragEnd:x,draggable:!0,children:[e.jsx("div",{className:"h-4 w-4 m-1 text-gray-800",children:e.jsx("svg",{"data-v-4e778f45":"",className:"nc-icon cursor-move !h-3.75 text-gray-600 mr-1",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",children:e.jsx("path",{fill:"currentColor",d:"M8.5 7a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3m0 6.5a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3m1.5 5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0M15.5 7a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3m1.5 5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m-1.5 8a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3"})})}),e.jsxs("div",{className:"flex justify-between m-1 w-full cursor-pointer ",onClick:()=>n.includes(j.name)?r(n.filter(_=>_!==j.name)):r([...n,j.name]),children:[j.display_name||j.name,e.jsx(vr,{id:j.name,enabled:n.includes(j.name),setEnabled:()=>{}})]})]}))})]})]})}function G5({attributes:t,filters:s,setFilters:n,delimiter:r,navigate:a}){const l=b.useRef(null),[i,c]=b.useState(),[d,u]=b.useState(!1),p="menu-btn-filter-controls",m=h=>{l.current&&!l.current.contains(h.target)&&h.target.id!==p&&u(!1)};return b.useEffect(()=>(document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}),[]),e.jsxs("div",{className:"relative inline-block text-left",children:[e.jsx("div",{children:e.jsxs("div",{id:p,className:`inline-flex w-full justify-center items-center rounded-md px-1.5 py-1 text-sm font-regular text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 ${d?"bg-gray-50":"bg-white hover:bg-gray-50"} cursor-pointer`,onClick:h=>u(!d),children:["Filters ",e.jsx(al,{height:18,width:18,className:"mt-1"})]})}),e.jsxs("div",{ref:l,className:`${d?"visible transition ease-in duration-200":"hidden transition ease-in duration-200"} absolute left-0 z-10 w-72 origin-top-left divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 transition focus:outline-none`,children:[e.jsx("input",{className:"px-3 py-1 w-full rounded-md",placeholder:"search...",onChange:h=>{c(h.target.value)}}),e.jsx("div",{className:"py-1 max-h-[500px] overflow-auto scrollbar-sm",children:t.filter(h=>h&&(!i||(h.display_name||h.name).toLowerCase().includes(i.toLowerCase()))).map((h,f)=>e.jsxs("div",{className:"flex items-center cursor-pointer px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900",onClick:()=>{const g=s.find(x=>x.column===h.name)?s.filter(x=>x.column!==h.name):[...s,{column:h.name}];n(g)},children:[e.jsx("div",{className:"h-4 w-4 m-1 cursor-pointer text-gray-800",children:e.jsx(Hh,{height:14,width:14})}),e.jsxs("div",{className:"flex justify-between m-1 w-full",children:[h.display_name||h.name,e.jsx(vr,{enabled:!!s.find(g=>g.column===h.name),setEnabled:()=>{}})]})]}))})]})]})}function J5({attribute:t,isEdit:s,orderBy:n,setOrderBy:r,filters:a,setFilters:l}){const i=[{label:"Sort A->Z",action:()=>r({[t.name]:"asc nulls last",id:"asc"})},{label:"Sort Z->A",action:()=>r({[t.name]:"desc nulls last",id:"desc"})},{label:"Clear Sort",action:()=>r({})},{label:a.find(c=>c.column===t.name)?"Remove Filter":"Add Filter",action:()=>l(a.find(c=>c.column===t.name)?a.filter(c=>c.column!==t.name):[...a,{column:t.name}])}];return e.jsxs(Oe,{as:"div",className:"relative inline-block text-left w-full",children:[e.jsx("div",{children:e.jsxs(py,{className:"inline-flex items-center w-full justify-between gap-x-1.5 rounded-md px-3 py-1 text-sm font-semibold text-gray-900",children:[t.display_name||t.name,e.jsxs("div",{id:"col-icons",className:"flex items-center",children:[n[t.name]==="asc nulls last"?e.jsx(F5,{}):n[t.name]==="desc nulls last"?e.jsx(V5,{}):null,e.jsx(al,{})]})]})}),e.jsx(hy,{transition:!0,className:"absolute right-0 z-10 w-72 origin-top-left divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 transition focus:outline-none data-[closed]:scale-95 data-[closed]:transform data-[closed]:opacity-0 data-[enter]:duration-100 data-[leave]:duration-75 data-[enter]:ease-out data-[leave]:ease-in",children:e.jsx("div",{className:"py-1 h-1/2 overflow-auto scrollbar-sm",children:i.map((c,d)=>e.jsx(fy,{children:e.jsx("div",{className:"flex items-center cursor-pointer px-2 py-1 text-sm text-gray-700 data-[focus]:bg-gray-100 data-[focus]:text-gray-900",onClick:()=>c.action(),children:e.jsx("div",{className:"flex justify-between m-1 w-full",children:c.label})})}))})})]})}const Xs=80,Ks=20,yi="",bu=t=>typeof t=="object"?JSON.stringify(t):t,q5=({className:t})=>e.jsx("div",{className:t,children:"loading..."}),K5=({startI:t,endI:s,startCol:n,endCol:r},a,l)=>t===s&&n===r?"all":n===r&&t===a?"ltr":n===r&&s===a?"lbr":n===r&&t!==a&&s!==a?"x":t===s&&l===n?"tlb":t===s&&l===r?"trb":t===s&&n!==l&&r!==l?"y":t===a&&n===l?"top-left":t===a&&r===l?"top-right":t===a&&n!==l&&r!==l?"top":s===a&&n===l?"bottom-left":s===a&&r===l?"bottom-right":s===a&&n!==l&&r!==l?"bottom":n===l&&t!==a&&s!==a?"left":r===l&&t!==a&&s!==a?"right":"";function Y5(t){b.useEffect(()=>{function s(n){const r=n.clipboardData.getData("Text");r&&t(r,n)}return window.addEventListener("paste",s),()=>{window.removeEventListener("paste",s)}},[t])}const Z5=({pastedContent:t,e:s,index:n,attrI:r,data:a,visibleAttributes:l,updateItem:i})=>{const c=t==null?void 0:t.split(`
`).filter(m=>m.length).map(m=>m.split("	"));if(!c)return;const d=[...new Array(c.length).keys()].map(m=>n+m).filter(m=>m<a.length),u=[...new Array(c[0].length).keys()].map(m=>l[r+m]).filter(m=>m),p=d.map((m,h)=>({...a[m],...u.reduce((f,g,x)=>({...f,[g]:c[h][x]}),{})}));i(void 0,void 0,p)};function X5(t){b.useEffect(()=>{function s(n){const r=t();return navigator.clipboard.writeText(r)}return window.addEventListener("copy",s),()=>{window.removeEventListener("copy",s)}},[t])}const Q5=({isLastCell:t,allowEdit:s,newItem:n,removeItem:r})=>!t||!s?null:e.jsxs("div",{className:"flex flex-row h-fit justify-evenly",style:{width:Xs},children:[e.jsx(je,{title:"view",className:"flex items-center w-fit p-0.5 bg-blue-300 hover:bg-blue-500 text-white rounded-lg",to:`view/${n.id}`,children:e.jsx(D5,{className:"text-white",height:20,width:20})}),e.jsx(je,{title:"edit",className:"flex items-center w-fit p-0.5 bg-blue-300 hover:bg-blue-500 text-white rounded-lg",to:`edit-item/${n.id}`,children:e.jsx(R5,{className:"text-white",height:18,width:18})}),e.jsx("button",{title:"delete",className:"w-fit p-0.5 bg-red-300 hover:bg-red-500 text-white rounded-lg",onClick:a=>{r(n)},children:e.jsx(Fh,{className:"text-white",height:20,width:20})})]}),e3=({value:t,required:s,options:n,name:r})=>{const a=!s||s&&t&&t!=="",l=!n||!(n!=null&&n.length)||(Array.isArray(n)&&typeof t=="string"?n.map(i=>i.value||i).includes(t):Array.isArray(n)&&Array.isArray(t)?t.reduce((i,c)=>i&&n.map(d=>d.value||d).includes(c.value||c),!0):!1);return a&&l},t3=({attribute:t,i:s,item:n,updateItem:r,width:a,onPaste:l,isFrozen:i,isSelected:c,isSelecting:d,editing:u,edge:p,loading:m,allowEdit:h,onClick:f,onDoubleClick:g,onMouseDown:x,onMouseMove:y,onMouseUp:j})=>{var $,I,T;const[N,_]=b.useState(n),E=m?q5:($=gt[t.type])==null?void 0:$[u&&h?"EditComp":"ViewComp"],L="#2100f8",S={top:{borderTopColor:L},bottom:{borderBottomColor:L},left:{borderLeftColor:L},right:{borderRightColor:L},"top-left":{borderTopColor:L,borderLeftColor:L},"top-right":{borderTopColor:L,borderRightColor:L},"bottom-left":{borderBottomColor:L,borderLeftColor:L},"bottom-right":{borderBottomColor:L,borderRightColor:L},ltr:{borderTopColor:L,borderLeftColor:L,borderRightColor:L},lbr:{borderBottomColor:L,borderLeftColor:L,borderRightColor:L},tlb:{borderTopColor:L,borderLeftColor:L,borderBottomColor:L},trb:{borderTopColor:L,borderRightColor:L,borderBottomColor:L},x:{borderLeftColor:L,borderRightColor:L},y:{borderTopColor:L,borderBottomColor:L},all:{borderColor:L}};b.useEffect(()=>_(n),[n]),b.useEffect(()=>{bu(N[t.name])!==bu(n[t.name])&&r(void 0,void 0,N)},[N]);const k=e3({value:N[t.name],options:t.options,required:t.required==="yes"});return e.jsxs("div",{className:`relative flex items-center min-h-[35px] 
            ${i?yi:""} ${d?"select-none":""}
            ${c?"bg-blue-50":"bg-white"}
            `,style:{width:a,...c&&{borderWidth:"1px",...S[p]}},onClick:f,onMouseDown:x,onMouseMove:y,onMouseUp:j,onDoubleClick:g,onPaste:l,children:[k?null:e.jsx("span",{className:"absolute top-0 right-0 text-red-900 font-bold h-fit w-fit",title:"Invalid Value",children:"*"}),e.jsx(E,{onClick:f,autoFocus:u,className:`
                  min-w-full min-h-full flex flex-wrap items-center truncate
                  ${c?"bg-blue-50":"bg-white"} hover:bg-blue-50 
                  ${t.type==="multiselect"&&((I=N[t.name])!=null&&I.length)||t.type==="multiselect"&&!((T=N[t.name])!=null&&T.length),"p-0.5"} 
                
                  `,...t,value:N[t.name],onChange:A=>{_({...N,[t.name]:A})}},`${t.name}-${s}`)]})},Al=t=>{let{index:s,attrI:n}=typeof t=="number"?{index:t,attrI:void 0}:t;return{index:s,attrI:n}},qh=({visibleAttributes:t,attributes:s,isEdit:n,orderBy:r,setOrderBy:a,filters:l,setFilters:i,updateItem:c,removeItem:d,addItem:u,newItem:p,setNewItem:m,data:h,colSizes:f,setColSizes:g,currentPage:x,pageSize:y,loading:j,allowEdit:N})=>{const _=b.useRef(null),[E,L]=b.useState(!1),[S,k]=b.useState({}),[$,I]=b.useState([]),[T,A]=b.useState(!1),[R,O]=b.useState(!1),M=b.useRef(null),D=b.useRef(null),P=b.useMemo(()=>{const H=[...new Set($.map(W=>W.index!==void 0?W.index:W))].sort((W,Y)=>W-Y),z=[...new Set($.map(W=>W.attrI).sort((W,Y)=>W-Y)||t.map((W,Y)=>Y))];return{startI:H[0],endI:H[H.length-1],startCol:z[0],endCol:z[z.length-1]}},[$]);Y5((H,z)=>{let{index:W,attrI:Y}=typeof $[$.length-1]=="number"?{index:$[$.length-1],attrI:void 0}:$[$.length-1];Z5({pastedContent:H,e:z,index:W,attrI:Y,data:h,visibleAttributes:t,updateItem:c})}),X5(()=>Object.values($.sort((H,z)=>{const{index:W,attrI:Y}=Al(H),{index:U,attrI:q}=Al(z);return W-U||Y-q}).reduce((H,z)=>{const{index:W,attrI:Y}=Al(z);return H[W]=H[W]?`${H[W]}	${h[W][t[Y]]}`:h[W][t[Y]],H},{})).join(`
`)),b.useEffect(()=>{if(_.current&&(!Object.keys(f).length||Object.keys(f).length!==t.length)){const H=t.filter(Y=>s.find(U=>U.name===Y)).length,W=(_.current.offsetWidth-Ks-Xs)/H;g(t.map(Y=>s.find(U=>U.name===Y)).filter(Y=>Y).reduce((Y,U)=>({...Y,[U.name]:W}),{}))}},[t.length,Object.keys(f).length]),b.useEffect(()=>{async function H(){if(T){const z=h.filter((Y,U)=>$.find(q=>(q.index||q)===U)),W=t.filter((Y,U)=>$.map(q=>q.attrI).includes(U));W.length?c(void 0,void 0,z.map(Y=>({...Y,...W.reduce((U,q)=>({...U,[q]:""}),{})}))):c(void 0,void 0,z.map(Y=>({...Y,...t.reduce((U,q)=>({...U,[q]:""}),{})})))}}H()},[T]),b.useEffect(()=>{const H=W=>{if(W.shiftKey){O(!0);let Y=$[$.length-1],U=$.map(te=>te.attrI).filter(te=>te!==void 0).sort((te,K)=>te-K);U!=null&&U.length||(U=t.map((te,K)=>K)),U=[...new Set(U)].sort((te,K)=>te-K);let q=[...new Set($.map(te=>te.index!==void 0?te.index:te))].sort((te,K)=>te-K);switch(typeof Y=="number"&&(Y={index:Y,attrI:void 0}),W.key){case"ArrowUp":Y.index>0&&I(te=>{const K=Y.index-1,ne=U.map(J=>({index:K,attrI:J}));return te.find(J=>J.index<=K)?te.filter(J=>!(J.index>K)):[...te,...ne]});break;case"ArrowDown":Y.index<h.length-1&&I(te=>{const K=Y.index+1,ne=U.map(J=>({index:K,attrI:J}));return te.find(J=>J.index>=K)?te.filter(J=>!(J.index<K)):[...te,...ne]});break;case"ArrowLeft":Y.attrI>0&&I(te=>{const K=Y.attrI-1,ne=q.map(J=>({index:J,attrI:K}));return te.find(J=>J.attrI<=K)?te.filter(J=>!(J.attrI>K)):[...te,...ne]});break;case"ArrowRight":Y.attrI<t.length-1&&I(te=>{const K=Y.attrI+1,ne=q.map(J=>({index:J,attrI:K}));return te.find(J=>J.attrI>=K)?te.filter(J=>!(J.attrI<K)):[...te,...ne]});break}}else if(W.ctrlKey)L(!0);else if(W.key==="Delete")A(!0);else if(W.key.includes("Arrow")){let{index:Y,attrI:U}=typeof $[$.length-1]=="number"?{index:$[$.length-1],attrI:void 0}:$[$.length-1];switch(W.key){case"ArrowUp":Y>0&&I([{index:Y-1,attrI:U||0}]),k({});break;case"ArrowDown":Y<Math.min(y,h.length)-1&&I([{index:Y+1,attrI:U||0}]),k({});break;case"ArrowLeft":U>0&&I([{index:Y,attrI:U-1}]),k({});break;case"ArrowRight":U<t.length-1&&I([{index:Y,attrI:U+1}]),k({});break}}else if(W.key==="Enter"){let{index:Y,attrI:U}=typeof $[$.length-1]=="number"?{index:$[$.length-1],attrI:void 0}:$[$.length-1];Y===S.index&&U===S.attrI?(k({}),I([{index:Y+1,attrI:U}])):k({index:Y,attrI:U})}},z=()=>{L(!1),O(!1),A(!1)};return window.addEventListener("keydown",H),window.addEventListener("keyup",z),()=>{window.removeEventListener("keydown",H)}},[$,S,h.length]);const F=H=>z=>{const W=z.clientX,Y=f[H]||0,U=te=>{const K=Y+te.clientX-W,ne=_.current.offsetWidth-Ks-Xs-K,J=Object.keys(f).filter(ae=>ae!==H).reduce((ae,de)=>ae+(f[de]||0),0);if(J>ne){const ae=t.filter(fe=>s.find(ve=>ve.namr===fe)).length,de=(J-ne)/ae,ue=Object.keys(f).reduce((fe,ve)=>(fe[ve]=ve===H?K:f[ve]-de,fe),{});g(ue)}g({...f,[H]:K})},q=()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",q)};document.addEventListener("mousemove",U),document.addEventListener("mouseup",q)},B=(H,z,W)=>{if(W!==void 0){I([{index:z,attrI:W}]),O(!0),M.current=z,D.current=W;return}W===void 0&&(H.ctrlKey?(H.preventDefault(),I($.includes(z)?$.filter(Y=>Y!==z):[...$,z]),O(!0),M.current=z):(I([z]),O(!0),M.current=z))},V=(H,z,W)=>{if(W!==void 0&&R){const Y=[M.current,z].sort((te,K)=>te-K),U=[D.current,W].sort((te,K)=>te-K),q=[];for(let te=Y[0];te<=Y[1];te++)for(let K=U[0];K<=U[1];K++)q.push({index:te,attrI:K});I(q);return}if(R){const Y=z,U=[M.current,Y].sort((te,K)=>te-K),q=[];for(let te=U[0];te<=U[1];te++)q.push(te);I(q)}},G=()=>{O(!1)},Z={1:"grid grid-cols-1",2:"grid grid-cols-2",3:"grid grid-cols-3",4:"grid grid-cols-4",5:"grid grid-cols-5",6:"grid grid-cols-6",7:"grid grid-cols-7",8:"grid grid-cols-8",9:"grid grid-cols-9",10:"grid grid-cols-10",11:"grid grid-cols-11"};if(!t.length)return e.jsx("div",{className:"p-2",children:"No columns selected."});const X=[0,1];return e.jsx("div",{className:"flex flex-col w-full overflow-x-auto scrollbar-sm",ref:_,children:e.jsxs("div",{className:"flex flex-col no-wrap text-sm max-h-[calc(100vh_-_250px)] overflow-y-auto scrollbar-sm",onMouseLeave:G,children:[e.jsxs("div",{className:`sticky top-0 grid ${Z[t.length+2]}`,style:{zIndex:5,gridTemplateColumns:`${Ks}px ${t.map(H=>`${f[H]}px`||"auto").join(" ")} ${Xs}px`},children:[e.jsx("div",{className:"flex justify-between sticky left-0 z-[1]",style:{width:Ks},children:e.jsx("div",{className:`w-full font-semibold border bg-gray-50 text-gray-500 ${yi}`},"#")}),t.map(H=>s.find(z=>(z==null?void 0:z.name)===H)).filter(H=>H).map((H,z)=>e.jsxs("div",{className:`flex justify-between ${X.includes(z)?yi:""}`,style:{width:f[H==null?void 0:H.name]},children:[e.jsx("div",{className:`w-full font-semibold  border ${$.find(W=>W.attrI===z)?"bg-blue-100 text-gray-900":"bg-gray-50 text-gray-500"}`,children:e.jsx(J5,{isEdit:n,attribute:H,orderBy:r,setOrderBy:a,filters:l,setFilters:i})},z),e.jsx("div",{className:"z-5",style:{width:"3px",height:"100%",background:"#ddd",cursor:"col-resize",position:"relative",right:0,top:0},onMouseDown:F(H==null?void 0:H.name)})]})),e.jsx("div",{className:"flex shrink-0 justify-between",style:{width:Xs},children:e.jsx("div",{className:"w-full flex items-center px-3 py-1 font-semibold border bg-gray-50 text-gray-900 select-none",children:"Actions"},"actions")})]}),h.map((H,z)=>e.jsxs("div",{className:`grid ${Z[t.length+2]} divide-x divide-y ${R?"select-none":""}`,style:{gridTemplateColumns:`${Ks}px ${t.map(W=>`${f[W]}px`||"auto").join(" ")} ${Xs}px`},children:[e.jsx("div",{className:`p-1 flex text-xs items-center justify-center border cursor-pointer 
                             sticky left-0 z-[1]
                             ${$.find(W=>(W.index!==void 0?W.index:W)===z)?"bg-blue-100 text-gray-900":"bg-gray-50 text-gray-500"}`,style:{width:Ks},onClick:W=>{W.ctrlKey?I($.includes(z)?$.filter(Y=>Y!==z):[...$,z]):I([z])},onMouseDown:W=>B(W,z),onMouseMove:W=>V(W,z),onMouseUp:G,children:z+1},"#"),t.filter(W=>s.find(Y=>Y.name===W)).map((W,Y)=>e.jsx(t3,{isSelecting:E,isSelected:$.find(U=>U.index===z&&U.attrI===Y)||$.includes(z),isFrozen:X.includes(Y),edge:$.find(U=>U.index===z&&U.attrI===Y)||$.includes(z)?K5(P,z,Y):null,editing:S.index===z&&S.attrI===Y,triggerDelete:T,width:f[s.find(U=>U.name===W).name],attribute:s.find(U=>U.name===W),loading:j,updateItem:c,removeItem:d,i:z,item:H,onMouseDown:U=>B(U,z,Y),onMouseMove:U=>V(U,z,Y),onMouseUp:G,onClick:()=>{I([{index:z,attrI:Y}]),k({index:z,attrI:Y})},onDoubleClick:()=>{},allowEdit:N},`${z}-${Y}`)),e.jsx("div",{className:"flex items-center border",children:e.jsx(Q5,{allowEdit:N,isLastCell:!0,newItem:H,removeItem:d})})]})),N?e.jsxs("div",{className:`bg-white grid ${Z[t.length+2]} divide-x divide-y ${R?"select-none":""} sticky bottom-0 z-[1]`,style:{gridTemplateColumns:`${Ks}px ${t.map(H=>`${f[H]}px`||"auto").join(" ")} ${Xs}px`},children:[e.jsx("div",{className:"flex justify-between sticky left-0 z-[1]",style:{width:Ks},children:e.jsx("div",{className:"w-full font-semibold border bg-gray-50 text-gray-500"},"#")}),t.map(H=>s.find(z=>z.name===H)).filter(H=>H).map((H,z)=>{var Y;const W=(Y=gt[(H==null?void 0:H.type)||"text"])==null?void 0:Y.EditComp;return e.jsx("div",{className:"flex border",style:{width:f[H.name]},children:e.jsx(W,{menuPosition:"top",className:"p-1 bg-white hover:bg-blue-50 w-full h-full",...H,value:p[H.name],placeholder:"+ add new",onChange:U=>m({...p,[H.name]:U}),onPaste:U=>{var ne;U.preventDefault(),U.stopPropagation();const q=(ne=(U.clipboardData||window.clipboardData).getData("text"))==null?void 0:ne.split(`
`).map(J=>J.split("	")),K=[...new Array(q[0].length).keys()].map(J=>t[z+J]).filter(J=>J).reduce((J,ae,de)=>({...J,[ae]:q[0][de]}),{});m({...p,...K})}},`${H.name}`)})}),e.jsx("div",{className:"bg-white flex flex-row h-fit justify-evenly",style:{width:Xs},children:e.jsx("button",{className:"w-fit p-0.5 bg-blue-300 hover:bg-blue-500 text-white rounded-lg",onClick:H=>{u()},children:e.jsx(Vh,{className:"text-white",height:20,width:20})})})]}):null,e.jsx("div",{id:"loadMoreTrigger"})]})})},Kh=({totalPages:t=0,loadedRows:s,pageSize:n=10,currentPage:r,setVCurrentPage:a,visibleAttributes:l})=>{if(l.length)return e.jsx("div",{className:"float-right flex flex-col items-end p-1 text-sm font-gray-500",children:e.jsxs("div",{className:"text-xs italic",children:["showing ",Math.min(s,t)," of ",isNaN(t)?0:parseInt(t).toLocaleString()," rows"]})})},Yh=t=>{try{JSON.parse(t)}catch{return!1}return!0},yu=t=>`data->>'${t}' as ${t}`,Xr=t=>`data->>'${t}'`,Zh=t=>t.filter(s=>{var n;return((n=s.values)==null?void 0:n.length)&&s.values.filter(r=>r.length).length}).reduce((s,n)=>({...s,[Xr(n.column)]:n.values}),{}),Cn=async({format:t,apiLoad:s,currentPage:n,pageSize:r,length:a,orderBy:l,filters:i})=>{var h;const c=((h=JSON.parse((t==null?void 0:t.config)||"{}"))==null?void 0:h.attributes)||[],d=n*r,u=Math.min(a,n*r+r);if(d>a-1)return[];console.log("fetching",d,u);const p=[{type:()=>{},action:"list",path:"/",filter:{fromIndex:f=>d,toIndex:f=>u,options:JSON.stringify({orderBy:Object.keys(l).reduce((f,g)=>({...f,[`data->>'${g}'`]:l[g]}),{}),filter:Zh(i)}),stopFullDataLoad:!0}}];return await s({app:t.app,type:t.type,format:t,attributes:c,children:p})},jo=async({format:t,apiLoad:s,filters:n=[]})=>{var i;const r=((i=JSON.parse((t==null?void 0:t.config)||"{}"))==null?void 0:i.attributes)||[],a=[{type:()=>{},action:"filteredLength",path:"/",filter:{options:JSON.stringify({filter:Zh(n)})}}];return await s({app:t.app,type:t.type,format:t,attributes:r,children:a})},ca=(t,s)=>{const n=new URLSearchParams;return t.forEach(r=>{const{column:a,values:l=[]}=r;n.append(a,l.filter(i=>i.length).join(s))}),n.toString()},Xh=({attributes:t,filters:s,setFilters:n,format:r,apiLoad:a,delimiter:l})=>{$e();const[i,c]=b.useState({});b.useEffect(()=>{async function u(){const p=await Promise.all(s.map(async(m,h)=>{const f=s.filter((y,j)=>{var N;return((N=y.values)==null?void 0:N.length)&&y.values.filter(_=>_.length).length&&j!==h}).reduce((y,j)=>(y[Xr(j.column)]=j.values.filter(N=>N.length),y),{}),g=await Qr({format:r,apiLoad:a,groupBy:[Xr(m.column)],filterBy:f}),x=await ji({format:r,apiLoad:a,length:g,attributes:[yu(m.column)],groupBy:[Xr(m.column)],filterBy:f});return{[m.column]:x.map(y=>y[yu(m.column)]).filter(y=>typeof y!="object")}}));c(p.reduce((m,h)=>({...m,...h}),{}))}u()},[s]);const d=gt.multiselect.EditComp;return s.length?e.jsxs("div",{className:"p-4 flex flex-col border border-blue-300 rounded-md",children:[e.jsx(Hh,{className:"-mt-4 -mr-6 text-blue-300 bg-white self-end rounded-md"}),s.map((u,p)=>{var m,h;return e.jsxs("div",{className:"w-full flex flex-row items-center",children:[e.jsx("div",{className:"w-1/4 p-1 text-sm",children:((m=t.find(f=>f.name===u.column))==null?void 0:m.display_name)||u.column}),e.jsx("div",{className:"w-3/4 p-1 relative",children:e.jsx(d,{className:`max-h-[150px] flex text-xs overflow-auto scrollbar-sm border rounded-md bg-white ${(h=u.values)!=null&&h.length?"p-1":"p-4"}`,placeholder:"Search...",value:u.values,onChange:f=>{const g=s.map((x,y)=>y===p?{...u,values:f}:x);n(g)},options:i[u.column],displayInvalidMsg:!1})})]})})]}):null},Qh=({value:t,onChange:s,size:n,format:r,apiLoad:a,apiUpdate:l,...i})=>{const c=!!s,d=Yh(t)?JSON.parse(t):{},[u,p]=b.useState(d.length||0),[m,h]=b.useState([]),[f,g]=b.useState(),[x,y]=b.useState(!1),[j,N]=b.useState([]),[_,E]=b.useState(d.visibleAttributes||[]),[L,S]=b.useState(d.colSizes||{}),[k,$]=b.useState({}),[I,T]=b.useState(d.orderBy||{}),[A,R]=b.useState(d.filters||[]),[O,M]=b.useState(d.allowEditInView),[D,P]=b.useState(0),F=50,B="|||",V=$e(),[G,Z]=Vn();b.useEffect(()=>{var W;N(((W=JSON.parse((r==null?void 0:r.config)||"{}"))==null?void 0:W.attributes)||[])},[r]),b.useEffect(()=>S({}),[n]),b.useEffect(()=>{const Y=Array.from(G.keys()).map(U=>{var q;return{column:U,values:(q=G.get(U))==null?void 0:q.split(B)}});if(Y.length){R(Y);const U=`?${ca(A,B)}`;U!==window.location.search&&V(U)}else if(!Y.length&&A.length){const U=`?${ca(A,B)}`;V(U)}},[G]),b.useEffect(()=>{async function W(){if(m)return;y(!0);const Y=await jo({format:r,apiLoad:a,filters:A}),U=await Cn({format:r,apiLoad:a,currentPage:D,pageSize:F,length:Y,orderBy:I,filters:A});h(U),p(Y),!(_!=null&&_.length)&&E(j==null?void 0:j.map(q=>q.name)),y(!1)}W()},[r]),b.useEffect(()=>{async function W(){y(!0);const Y=await jo({format:r,apiLoad:a,filters:A}),U=await Cn({format:r,apiLoad:a,currentPage:D,pageSize:F,length:Y,orderBy:I,filters:A});p(Y),h(U),g(D*F+F<Y),y(!1)}W()},[I,A]),b.useEffect(()=>{const W=new IntersectionObserver(async U=>{if(U[0].isIntersecting&&f){const q=await Cn({format:r,apiLoad:a,currentPage:D+1,pageSize:F,length:u,orderBy:I,filters:A});P(D+1),h(te=>[...te,...q]),g(D*F+F<u)}},{threshold:0}),Y=document.querySelector("#loadMoreTrigger");return Y&&W.observe(Y),()=>{Y&&W.unobserve(Y)}},[m,x]),b.useEffect(()=>{c&&s(JSON.stringify({visibleAttributes:_,pageSize:F,attributes:j,orderBy:I,colSizes:L,filters:A,allowEditInView:O}))},[_,j,I,L,A,O]),b.useEffect(()=>{const W=`?${ca(A,B)}`;V(W)},[A]);const X=(W,Y,U)=>{let q=Array.isArray(U)?U:[U],te=[...m];return q.map(K=>{const ne=m.findIndex(J=>J.id===K.id);te[ne]=K}),h(te),Promise.all(q.map(K=>l({data:K,config:{format:r}})))},H=()=>(h([...m,k]),l({data:k,config:{format:r}})&&$({})),z=W=>(h(m.filter(Y=>Y.id!==W.id)),l({data:W,config:{format:r},requestType:"delete"}));return e.jsxs("div",{className:"w-full",children:[c&&e.jsxs("div",{className:"flex",children:[e.jsx(W5,{attributes:j,setAttributes:N,visibleAttributes:_,setVisibleAttributes:E}),e.jsx(G5,{attributes:j,visibleAttributes:_,filters:A,setFilters:R,delimiter:B,navigate:V}),e.jsx("div",{children:e.jsxs("div",{className:"inline-flex w-full justify-center items-center rounded-md px-1.5 py-1 text-sm font-regular text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 bg-white hover:bg-gray-50 cursor-pointer",onClick:()=>M(!O),children:[e.jsx("span",{className:"flex-1 select-none mr-1",children:"Allow Edit "}),e.jsx(vr,{size:"small",enabled:O,setEnabled:()=>{}})]})})]}),e.jsx(Xh,{attributes:j,filters:A,setFilters:R,apiLoad:a,format:r,delimiter:B}),e.jsx(qh,{data:m,setData:h,visibleAttributes:_,setVisibleAttributes:E,attributes:j,isEdit:c,orderBy:I,setOrderBy:T,filters:A,setFilters:R,updateItem:X,removeItem:z,addItem:H,newItem:k,setNewItem:$,colSizes:L,setColSizes:S,currentPage:D,pageSize:F,loading:x,allowEdit:!0}),e.jsx(Kh,{totalPages:u,loadedRows:m.length,pageSize:F,currentPage:D,setVCurrentPage:P,visibleAttributes:_})]})},s3=({value:t,onChange:s,size:n,format:r,apiLoad:a,apiUpdate:l,...i})=>{const d=Yh(t)?JSON.parse(t):{},[u,p]=b.useState(d.length||0),[m,h]=b.useState(d.colSizes||{}),[f,g]=b.useState(d.orderBy||{}),[x,y]=b.useState(d.filters||[]),[j,N]=b.useState({}),[_,E]=b.useState([]),[L,S]=b.useState(),[k,$]=b.useState(!1),[I,T]=b.useState(0),A=d.attributes,R=d.visibleAttributes||[],O=d.allowEditInView,M=50,D="|||",P=$e(),[F,B]=Vn(window.location.search);b.useEffect(()=>{const H=Array.from(F.keys()).map(z=>{var W;return{column:z,values:(W=F.get(z))==null?void 0:W.split(D)}});if(H.length){y(H);const z=`?${ca(x,D)}`;z!==window.location.search&&P(z)}else if(!H.length&&x.length){const z=`?${ca(x,D)}`;P(z)}},[F]),b.useEffect(()=>{async function X(){if(_)return;$(!0);const H=await jo({format:r,apiLoad:a,filters:x}),z=await Cn({format:r,apiLoad:a,currentPage:I,pageSize:M,length:H,orderBy:f,filters:x});E(z),p(H),$(!1)}X()},[r]),b.useEffect(()=>{async function X(){$(!0);const H=await jo({format:r,apiLoad:a,filters:x}),z=await Cn({format:r,apiLoad:a,currentPage:I,pageSize:M,length:H,orderBy:f,filters:x});p(H),E(z),S(I*M+M<H),$(!1)}X()},[f,x]),b.useEffect(()=>{const X=new IntersectionObserver(async z=>{if(z[0].isIntersecting&&L){const W=await Cn({format:r,apiLoad:a,currentPage:I+1,pageSize:M,length:u,orderBy:f,filters:x});T(I+1),E(Y=>[...Y,...W]),S(I*M+M<u)}},{threshold:0}),H=document.querySelector("#loadMoreTrigger");return H&&X.observe(H),()=>{H&&X.unobserve(H)}},[_,k]),b.useEffect(()=>{const X=ca(x,D);X.length&&X!==window.location.search.replace("?","")&&P(`?${X}`)},[x]);const V=(X,H,z)=>{let W=Array.isArray(z)?z:[z],Y=[..._];return W.map(U=>{const q=_.findIndex(te=>te.id===U.id);Y[q]=U}),E(Y),Promise.all(W.map(U=>l({data:U,config:{format:r}})))},G=()=>(E([..._,j]),l({data:j,config:{format:r}})&&N({})),Z=X=>(E(_.filter(H=>H.id!==X.id)),l({data:X,config:{format:r},requestType:"delete"}));return e.jsxs("div",{className:"w-full",children:[e.jsx(Xh,{attributes:A,filters:x,setFilters:y,apiLoad:a,format:r,delimiter:D}),e.jsx(qh,{data:_,setData:E,visibleAttributes:R,attributes:A,isEdit:!1,orderBy:f,setOrderBy:g,filters:x,setFilters:y,updateItem:V,removeItem:Z,addItem:G,newItem:j,setNewItem:N,colSizes:m,setColSizes:h,currentPage:I,pageSize:M,loading:k,allowEdit:O}),e.jsx(Kh,{totalPages:u,loadedRows:_.length,pageSize:M,currentPage:I,setVCurrentPage:T,visibleAttributes:R})]})};Qh.settings={hasControls:!0,name:"ElementEdit"};const n3={name:"Spreadsheet",type:"table",variables:[],getData:Cn,EditComp:Qh,ViewComp:s3},vi=t=>{try{JSON.parse(t)}catch{return!1}return!0},Bc=async({format:t,apiLoad:s,itemId:n})=>{var i;const r=((i=JSON.parse((t==null?void 0:t.config)||"{}"))==null?void 0:i.attributes)||[],a=[{type:()=>{},action:"edit",path:"view/:id",params:{id:n}}];return{data:(await s({app:t.app,type:t.type,params:{id:n},format:t,attributes:r,children:a},`/view/${n}`)).find(c=>c.id===n),attributes:r}},ef=({value:t,onChange:s,size:n,format:r,apiLoad:a,apiUpdate:l,...i})=>{const c=Ye(),d=vi(t)?JSON.parse(t):{},[u,p]=b.useState([]),[m,h]=b.useState(d.orderedAttributes||[]),[f,g]=b.useState(),[x,y]=b.useState((d==null?void 0:d.visibleAttributes)||[]),[j,N]=b.useState(!1),[_,E]=b.useState(""),L=b.useRef(null),[S,k]=b.useState(!1),$=b.useRef(null),[I,T]=b.useState(d.url||"view/"),[A,R]=b.useState(d.allowEditInView||!1),O=b.useMemo(()=>{var H;return(H=c["*"])==null?void 0:H.split(I)[1]},[I]),M=b.useRef(),D=b.useRef();b.useEffect(()=>{var z;const H=(z=c["*"])==null?void 0:z.split("/");(+H[H.length-1]||H[H.length-1]==="add-new-item")&&T(`${H[H.length-2]}/`)},[c["*"]]);const P=(H,z)=>{M.current=z,H.dataTransfer.effectAllowed="move"},F=(H,z)=>{D.current=z},B=H=>{H.preventDefault(),H.dataTransfer.dropEffect="move"},V=H=>{const z=[...m],W=z[M.current];z.splice(M.current,1),z.splice(D.current,0,W),M.current=null,D.current=null,h(z)};b.useEffect(()=>{async function H(){if(!O)return;const{data:z,attributes:W}=await Bc({format:r,apiLoad:a,itemId:O});g(z),p(W)}H()},[O]),b.useEffect(()=>{s(JSON.stringify({...d,visibleAttributes:x,orderedAttributes:m,url:I,allowEditInView:A}))},[x,m,I,A]);const G=()=>{const H=$.current.getBoundingClientRect(),z=window.innerHeight-H.bottom,W=H.top,Y=L.current?L.current.offsetHeight:0;console.log("???",Y),z<Y&&W>Y?k(!0):k(!1)};w.useEffect(()=>{j&&G()},[j]);const Z=H=>{L.current&&!L.current.contains(H.target)&&N(!1)};w.useEffect(()=>(document.addEventListener("mousedown",Z),()=>{document.removeEventListener("mousedown",Z)}),[]);const X=(H,z,W)=>l({data:{...W,[z.name]:H},config:{format:r}});return e.jsx("div",{children:e.jsxs("div",{className:"divide-y",children:[e.jsxs("div",{className:"flex col-span-3",children:[e.jsx("label",{className:"w-1/4 p-2",children:"Base URL: "}),e.jsx("input",{className:"w-3/4 p-2 w-full",type:"text",value:I,onChange:H=>T(H.target.value),placeholder:"url"})]}),e.jsxs("div",{className:"flex items-center col-span-3",children:[e.jsx("label",{className:"w-1/4 p-2",children:"Allow Edit: "}),e.jsx(vr,{className:"w-3/4 p-2",enabled:A,setEnabled:H=>R(H)})]}),e.jsxs("div",{className:"col-span-3 relative",children:[e.jsx("input",{ref:$,className:"p-2 w-full",type:"text",placeholder:"search...",onChange:H=>E(H.target.value),onFocus:()=>N(!0)}),e.jsx("div",{ref:L,className:_.length||j?"absolute bg-blue-50 z-10 w-full max-h-[200px] p-2 rounded-md overflow-auto scrollbar-sm":"hidden",style:{marginTop:S?"-3rem":"4px",transform:S?"translateY(-100%)":"none"},children:u.filter(H=>_.length?(H.display_name||H.name).toLowerCase().includes(_.toLowerCase()):j).map(H=>e.jsxs("div",{className:"flex hover:bg-blue-100 rounded-sm",children:[e.jsx("div",{className:"p-2 flex items-center font-semibold text-gray-500",children:e.jsx("input",{id:`${H.name}-checkbox`,type:"checkbox",checked:x.includes(H.name),onChange:z=>{const W=x.includes(H.name);y(W?x.filter(Y=>Y!==H.name):[...x,H.name]),h(W?m.filter(Y=>Y.name!==H.name):[...m,H])}})}),e.jsx("label",{htmlFor:`${H.name}-checkbox`,className:"select-none cursor-pointer",children:H.display_name||H.name})]},H.name))})]}),m.map((H,z)=>{var Y;const W=((Y=gt[H.type])==null?void 0:Y.EditComp)||gt.text.EditComp;return e.jsxs("div",{className:`grid grid-cols-3 divide-x rounded-sm ${D.current===z?"bg-gray-50":""}`,style:{gridTemplateColumns:"15px 1fr 2fr"},onDragStart:U=>P(U,z),onDragEnter:U=>F(U,z),onDragOver:B,onDragEnd:V,draggable:!0,children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"h-4 w-4 cursor-pointer text-gray-800",children:e.jsx("svg",{"data-v-4e778f45":"",className:"nc-icon cursor-move !h-3.75 text-gray-600",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M8.5 7a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3m0 6.5a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3m1.5 5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0M15.5 7a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3m1.5 5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m-1.5 8a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3"})})})}),e.jsxs("div",{className:"w-5/6  flex items-center p-2 font-semibold text-gray-500",children:[H.display_name||H.name,H.prompt&&e.jsx(Rh,{className:"text-xs px-1 hover:text-gray-700",title:H.prompt})]}),f?e.jsx("div",{className:"relative p-2 text-gray-700 max-w-11/12",children:e.jsx(W,{className:"border flex flex-wrap w-full p-2 bg-white hover:bg-blue-50 h-fit",...H,value:f[H.name],onChange:U=>{g({...f,[H.name]:U}),X(U,H,{...f,[H.name]:U})}},`${H.name}`)}):null]},z)})]})})},a3=({value:t,format:s,apiLoad:n,apiUpdate:r,...a})=>{var L;const l=vi(t)?JSON.parse(t):{},[i,c]=b.useState((l==null?void 0:l.visibleAttributes)||[]),[d,u]=b.useState(l==null?void 0:l.orderedAttributes),p=Ye(),[m,h]=b.useState({}),[f,g]=b.useState({}),[x,y]=b.useState([]),j=l.allowEditInView,N=j?"EditComp":"ViewComp",_=(L=p["*"])==null?void 0:L.split(l.url||"view/")[1];b.useEffect(()=>{const S=vi(t)?JSON.parse(t):{};c((S==null?void 0:S.visibleAttributes)||[]),u(S==null?void 0:S.orderedAttributes)},[t]),b.useEffect(()=>{async function S(){if(_==="add-new-item"){y(d);return}const{data:k,attributes:$}=await Bc({format:s,apiLoad:n,itemId:_});h(k),g(k),y($)}S()},[]);const E=async()=>{const S=await r({data:f,config:{format:s}});S!=null&&S.id&&_==="add-new-item"&&(window.location=window.location.href.replace(_,S.id))};return e.jsx("div",{children:e.jsxs("div",{className:"divide-y w-full",children:[(d||x.filter(S=>i.includes(S.name))).map((S,k)=>{var I;const $=((I=gt[S.type])==null?void 0:I[N])||gt.text[N];return e.jsxs("div",{className:"group w-full flex flex-row items-center hover:bg-blue-50 rounded-md",children:[e.jsx("div",{className:"p-2 w-2/5 truncate text-sm font-bold text-gray-500",title:S.display_name||S.name,children:S.display_name||S.name}),e.jsx("div",{className:"relative w-3/5 p-2 text-gray-700",children:e.jsx($,{className:"flex flex-wrap w-full p-2 bg-white group-hover:bg-blue-50 h-fit",...S,value:f==null?void 0:f[S.name],onChange:T=>{g({...f,[S.name]:T})}},`${S.name}`)})]},k)}),j?e.jsxs("div",{className:"w-full flex justify-end gap-1",children:[e.jsx("button",{className:"px-2 py-0.5 bg-blue-300 hover:bg-blue-600 text-white rounded-md",onClick:()=>E(),children:"save"}),e.jsx("button",{className:"px-2 py-0.5 bg-red-300 hover:bg-red-600 text-white rounded-md",onClick:()=>g(m),children:"cancel"})]}):null]})})};ef.settings={hasControls:!0,name:"ElementEdit"};const r3={name:"Item",type:"table",variables:[],getData:Bc,EditComp:ef,ViewComp:a3},Ac=t=>{try{JSON.parse(t)}catch{return!1}return!0},o3={text:"text",textarea:"text area",select:"dropdown",multiselect:"dropdown (multiple choice)",lexical:"rich text",radio:"radio"},l3={data:"Simple Data",meta:"Group-able/Meta",fips:"fips",geoid:"geoid"},i3={sum:"Sum",list:"List",count:"Count"},c3={yes:"Yes",no:"No"},jr="text-sm font-light capitalize font-gray-700",Oc="bg-white w-full border p-2 rounded-md",Ol=({label:t,value:s,col:n,attr:r,updateAttribute:a})=>{const[l,i]=b.useState(s),c=d=>setTimeout(a(n,{[r]:d}),500);return e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("label",{className:jr,children:t}),e.jsx("input",{className:Oc,value:l,placeholder:t,onChange:d=>{i(d.target.value),c(d.target.value)}})]})},Ar=({label:t,value:s,col:n,attr:r,updateAttribute:a,placeholder:l,options:i})=>e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("label",{className:jr,children:t}),e.jsxs("select",{className:Oc,value:s,onChange:c=>{a(n,{[r]:c.target.value})},children:[e.jsx("option",{children:l}),Object.keys(i).map(c=>e.jsx("option",{value:c,children:i[c]},c))]})]}),d3=({label:t,value:s,col:n,attr:r,updateAttribute:a})=>e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("label",{className:jr,children:t}),e.jsx(Dh.EditComp,{value:s,bgColor:"#ffffff",onChange:l=>{a(n,{[r]:l})},placeholder:t})]}),u3=({col:t,drivingAttribute:s,attr:n,value:r=[],updateAttribute:a})=>{if(!["select","multiselect","radio"].includes(s))return null;const[l,i]=b.useState(void 0),c=b.useMemo(()=>r==null?void 0:r.map(p=>p.label?p:{label:p,value:p}),[r]),d=(p,m)=>{const h=m!=null&&m.label?[...p,m]:[...p,{label:m,value:m}];a(t,{[n]:h}),i("")},u=(p,m)=>{const h=p.filter(f=>(f.value||f)!==(m.value||m));a(t,{[n]:h})};return e.jsxs("div",{className:"flex flex-col items-start w-full",children:[e.jsx("label",{className:jr,children:"Options"}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsxs("div",{className:"w-full flex",children:[e.jsx("input",{className:"bg-white p-2 flex-1 px-2 shadow bg-blue-100 focus:ring-blue-700 focus:border-blue-500  border-gray-300 rounded-none rounded-md",value:l,onChange:p=>i(p.target.value),onKeyDown:p=>p.key==="Enter"&&d(r,l),placeholder:"Add new option..."}),e.jsx("button",{className:"p-2",onClick:p=>d(r,l),children:"add"})]}),e.jsx("div",{className:"flex flex-row flex-wrap",children:c.map(p=>e.jsxs("div",{className:"bg-red-500 hover:bg-red-700 text-white text-xs font-semibold px-1.5 py-1 m-1 flex no-wrap items-center rounded-md",children:[(p==null?void 0:p.label)||p,e.jsx("div",{title:"remove",className:"p-0.5 px-1 cursor-pointer",onClick:m=>u(r,p),children:"x"})]}))})]})]})},m3=async({format:t,apiLoad:s,length:n})=>{var d,u;const r=Ac(t==null?void 0:t.config)?((d=t.config)==null?void 0:d.attributes)||[]:((u=JSON.parse((t==null?void 0:t.config)||"{}"))==null?void 0:u.attributes)||[],a=0,l=n-1,i=[{type:()=>{},action:"list",path:"/",filter:{fromIndex:p=>a,toIndex:p=>l,options:JSON.stringify({}),stopFullDataLoad:!0}}];return await s({app:t.app,type:t.type,format:t,attributes:r,children:i})},ji=async({format:t,apiLoad:s,length:n,attributes:r,groupBy:a=[],filterBy:l={}})=>{var m,h;const i=r||(Ac(t==null?void 0:t.config)?((m=t.config)==null?void 0:m.attributes)||[]:((h=JSON.parse((t==null?void 0:t.config)||"{}"))==null?void 0:h.attributes)||[]),c=0,d=n-1,u=[{type:()=>{},action:"load",path:"/",filter:{fromIndex:f=>c,toIndex:f=>d,options:JSON.stringify({groupBy:a,aggregatedLen:a.length,filter:l}),attributes:i,stopFullDataLoad:!0}}];return await s({app:t.app,type:t.type,format:t,attributes:i,children:u})},Qr=async({format:t,apiLoad:s,groupBy:n=[],filterBy:r})=>{var c,d;const a=Ac(t==null?void 0:t.config)?((c=t.config)==null?void 0:c.attributes)||[]:((d=JSON.parse((t==null?void 0:t.config)||"{}"))==null?void 0:d.attributes)||[],l=[{type:()=>{},action:"filteredLength",path:"/",filter:{options:JSON.stringify({groupBy:n,aggregatedLen:n.length,filter:r})}}];return await s({app:t.app,type:t.type,format:t,attributes:a,children:l})},p3=({col:t,drivingAttribute:s,attr:n,value:r=[],updateAttribute:a,apiLoad:l,format:i})=>{var L,S,k,$,I,T;const[c,d]=b.useState(!1),[u,p]=b.useState([]),[m,h]=b.useState({}),[f,g]=b.useState([]),[x,y]=b.useState([]),[j,N]=b.useState(),_=gt.multiselect.EditComp,E="p-1 truncate";return b.useEffect(()=>{if(!c)return;async function A(){const R=await Qr({format:{...i,app:"dms-site",type:"forms-config"},apiLoad:l}),O=await m3({format:{...i,app:"dms-site",type:"forms-config"},apiLoad:l,length:R});p(O.map(M=>({...M,config:JSON.parse(M.config||"{}")})))}A()},[c]),b.useEffect(()=>{async function A(){if(!c)return;const R=`data->>'${t}' as ${t}`,O=await Qr({format:i,apiLoad:l,groupBy:[`data->>'${t}'`]}),M=await ji({format:i,apiLoad:l,length:O,attributes:[R],groupBy:[`data->>'${t}'`]});y(M==null?void 0:M.map(D=>D[R]).filter(D=>typeof D!="object"))}A()},[c]),b.useEffect(()=>{async function A(){if(!m.selectedFormat||!m.selectedAttribute)return;const R=`data->>'${m.selectedAttribute}' as ${m.selectedAttribute}`,O=await Qr({format:m.selectedFormat.config,apiLoad:l,groupBy:[`data->>'${m.selectedAttribute}'`]}),M=await ji({format:m.selectedFormat.config,apiLoad:l,length:O,attributes:[R],groupBy:[`data->>'${m.selectedAttribute}'`]});g(M==null?void 0:M.map(D=>D[R]))}A()},[m.selectedAttribute]),e.jsxs("div",{children:["meta mappings",e.jsx("div",{className:"w-full grid grid-cols-6 border-t-2 border-gray-300 rounded-md",children:["#","Source Values","Target Data Type","Target Column","Target Values","Actions"].map(A=>e.jsx("div",{className:"p-1",children:A}))}),r.map((A,R)=>{var O;return e.jsxs("div",{className:"w-full grid grid-cols-6 border-2 border-gray-300 rounded-md items-center font-semibold justify-between hover:bg-blue-200",children:[e.jsxs("div",{className:`${E} text-xs`,children:["Mapping ",R+1]}),e.jsxs("div",{className:E,children:[((O=A.srcValues)==null?void 0:O.length)||0," source values"]}),e.jsx("div",{className:E,children:A.selectedFormat.name}),e.jsx("div",{className:E,children:A.selectedAttribute}),e.jsxs("div",{className:E,children:[A.mappedValues.length," mapped values"]}),e.jsxs("div",{className:"p-1",children:[e.jsx("button",{className:"bg-blue-300 hover:bg-blue-500 text-white text-sm p-1 rounded-md",onClick:()=>{h(A),N(R),d(!0)},children:"edit"}),e.jsx("button",{className:"bg-red-300 hover:bg-red-500 text-white text-sm p-1 rounded-md",onClick:()=>a(t,{[n]:r.filter((M,D)=>D!==R)}),children:"remove"})]})]})}),c?e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("button",{className:"bg-red-300 hover:bg-red-500 text-white text-sm p-1 rounded-md",onClick:()=>d(!1),children:"done"}),e.jsxs("div",{className:"grid grid-cols-6 w-full items-start",children:[e.jsxs("div",{className:"p-1 text-xs",children:["Mapping ",(r==null?void 0:r.length)+1]}),e.jsx(_,{className:`border rounded-md bg-white h-full ${(L=m.srcValues)!=null&&L.length?"p-1":"p-4"}`,placeholder:"Please select values...",value:m.srcValues,onChange:A=>{h({...m,srcValues:A})},options:x,displayInvalidMsg:!1}),e.jsxs("select",{className:"border p-2 rounded-md bg-white",value:(k=(S=m.selectedFormat)==null?void 0:S.config)==null?void 0:k.type,onChange:A=>{h({...m,selectedFormat:u.find(R=>R.config.type===A.target.value)})},children:[e.jsx("option",{children:"Please select a format"}),u.map(A=>e.jsx("option",{value:A.config.type,children:A.name},A.config.type))]}),(I=($=m.selectedFormat)==null?void 0:$.config)!=null&&I.attributes?e.jsxs("select",{className:"border p-2 rounded-md bg-white",value:m.selectedAttribute,onChange:A=>{h({...m,selectedAttribute:A.target.value})},children:[e.jsx("option",{children:"Please select a format"}),m.selectedFormat.config.attributes.map(A=>e.jsx("option",{value:A.name,children:A.name},A.display_name||A.name))]}):e.jsx("div",{}),f!=null&&f.length?e.jsx(_,{className:`border rounded-md bg-white h-full ${(T=m.mappedValues)!=null&&T.length?"p-1":"p-4"}`,placeholder:"Please select values...",value:m.mappedValues,onChange:A=>{h({...m,mappedValues:A})},options:f}):e.jsx("div",{}),f.length&&j!==void 0?e.jsxs("div",{className:"p-1",children:[e.jsx("button",{title:"save",className:"bg-blue-300 hover:bg-blue-500 text-white text-sm p-1 rounded-md h-fit self-center",onClick:()=>{a(t,{[n]:r.map((A,R)=>R===j?m:A)}),h({}),N(void 0)},children:" save"}),e.jsx("button",{title:"cancel",className:"bg-red-300 hover:bg-red-500 text-white text-sm p-1 rounded-md h-fit self-center",onClick:()=>{h({}),N(void 0),d(!1)},children:" cancel"})]}):e.jsx("div",{children:e.jsx("button",{title:"add mapping",className:"bg-blue-300 hover:bg-blue-500 text-white text-sm p-2 rounded-md h-fit self-end",onClick:()=>{a(t,{[n]:[...r,m]}),h({})},children:"+"})})]})]}):e.jsx("div",{className:"flex flex-col items-start",children:e.jsx("button",{className:"bg-blue-300 hover:bg-blue-500 text-white text-sm p-1 rounded-md",onClick:()=>d(!0),children:"+ add mappings"})})]})},h3=({value:t,col:s,drivingAttribute:n,attr:r,updateAttribute:a})=>n==="meta"?e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("label",{className:jr,children:"Meta Lookup"}),e.jsx("textarea",{className:Oc,value:t,placeholder:"Please enter meta lookup if available",onChange:l=>{a(s,{[r]:l.target.value})}})]}):null,f3=({col:t,removeAttribute:s})=>{const[n,r]=b.useState(void 0),a=()=>{r(void 0),s(t)};return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:`${n?"bg-blue-300 hover:bg-blue-500":"bg-red-300 hover:bg-red-500"} w-fit p-1 m-2 text-white float-right rounded-md`,onClick:()=>{if(n)clearTimeout(n),r(void 0);else{const l=setTimeout(a,1500);r(l)}},children:n?"undo":"remove"})})},tf=({i:t,theme:s,item:n,attribute:r,placeholder:a,className:l,updateAttribute:i,removeAttribute:c,apiLoad:d,format:u})=>{const[p,m]=b.useState(!1);return Array.isArray(n[r])?e.jsx("div",{children:n[r].map((h,f)=>e.jsx(tf,{i:f,item:h,placeholder:a,attribute:h==null?void 0:h.name,theme:s,updateAttribute:i,removeAttribute:c,apiLoad:d,format:u}))}):e.jsxs("div",{className:`${t%2?"bg-blue-50":"bg-white"} hover:bg-blue-100 border-l-4 border-blue-100 hover:border-blue-300 mb-1 px-2 pb-2 w-full flex flex-col`,children:[e.jsxs("div",{className:"flex flex-wrap justify-between flex-col sm:flex-row items-center",children:[e.jsx(Ol,{label:"name",attr:"name",value:r,col:n.name,updateAttribute:i}),e.jsx(Ol,{label:"display name",attr:"display_name",value:n.display_name,col:n.name,updateAttribute:i}),e.jsx(Ar,{label:"Input Type",value:n.type,col:n.name,attr:"type",options:o3,updateAttribute:i}),e.jsx("div",{title:"Advanced Settings",className:"cursor-pointer p-2 text-gray-500 hover:text-gray-900 text-xl",onClick:()=>m(!p),children:"..."})]}),e.jsxs("div",{className:p?"flex flex-col":"hidden",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx(d3,{label:"description",attr:"description",value:n.description,col:n.name,updateAttribute:i}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Ar,{label:"Behaviour Type",value:n.display,col:n.name,attr:"display",options:l3,updateAttribute:i,placeholder:"Please select behaviour type"}),e.jsx(Ar,{label:"Default Fn",value:n.defaultFn,col:n.name,attr:"defaultFn",options:i3,updateAttribute:i,placeholder:"Please select default function"}),e.jsx(Ar,{label:"Required",value:n.required,col:n.name,attr:"required",options:c3,updateAttribute:i,placeholder:"Please select property"})]})]}),e.jsx(Ol,{label:"prompt",attr:"prompt",value:n.prompt,col:n.name,updateAttribute:i}),e.jsx(u3,{col:n.name,drivingAttribute:n.type,value:n.options,attr:"options",updateAttribute:i}),e.jsx(h3,{col:n.name,drivingAttribute:n.display,value:n.meta_lookup,attr:"meta_lookup",updateAttribute:i}),e.jsx(p3,{col:n.name,drivingAttribute:n.display,value:n.mappings,attr:"mappings",updateAttribute:i,apiLoad:d,format:u}),e.jsx(f3,{col:n.name,removeAttribute:c})]})]})},g3=({theme:t,placeholder:s,attributes:n=[],className:r,addAttribute:a})=>{const[l,i]=b.useState(""),[c,d]=b.useState("empty name");function u(){a({name:l}),i(""),d("empty name"),document.activeElement!==document.body&&document.activeElement.blur()}const p=()=>setTimeout(u,500);return e.jsxs("div",{className:"w-full flex flex-col sm:flex-row",children:[e.jsx("input",{className:`w-1/4 p-2 border ${c?"border-red-500":""} rounded-md`,value:l,placeholder:s,onChange:m=>{n.find(h=>h.name===m.target.value)?d("already exists"):m.target.value===""?d("empty name"):c&&d(null),i(m.target.value)},onBlur:m=>{m.target.value!==""&&!c&&p()},onKeyDown:m=>!c&&m.key==="Enter"&&p()}),e.jsx("button",{className:`p-2 ${c?"bg-red-500":"bg-blue-300 hover:bg-blue-500"} text-white rounded-md`,onClick:m=>u(),children:c?e.jsxs("div",{className:"flex items-center ",children:[e.jsx(Mc,{className:"text-white px-1"})," ",c," "]}):e.jsxs("div",{className:"flex items-center ",children:[e.jsx(Vh,{className:"text-white px-1"})," ","add"]})})]})},x3="font-light capitalize font-gray-700",vu=t=>{try{return JSON.parse(t)}catch{return t}},b3=({value:t="{}",onChange:s,className:n,placeholder:r,manageTemplates:a,apiLoad:l,format:i,...c})=>{const d=Et(),[u,p]=b.useState(vu(t));b.useEffect(()=>p(vu(t)),[t]);const m=(g,x)=>{const y=((u==null?void 0:u.attributes)||[]).map(N=>N.name===g?{...N,...x}:N),j={...u,attributes:y};p(j),s(JSON.stringify(j))},h=g=>{const x={...u,attributes:[...u.attributes||[],g]};p(x),s(JSON.stringify(x))},f=g=>{const x={...u,attributes:u.attributes.filter(y=>y.name!==g)};p(x),s(JSON.stringify(x))};return e.jsxs("div",{className:"border-2 p-2",children:[e.jsxs("div",{children:["managing ",a?"templates":"config"]}),e.jsx("label",{className:x3,children:"Manage Config"}),Object.keys(u).filter(g=>g==="attributes").map(g=>e.jsx("div",{className:"w-full p-2",children:e.jsx(tf,{item:u,placeholder:r,attribute:g,theme:d,apiLoad:l,format:i,className:n,updateAttribute:m,removeAttribute:f})})),e.jsx("div",{className:"w-full p-2",children:e.jsx(g3,{attributes:u.attributes,placeholder:"New field name...",theme:d,className:n,addAttribute:h})})]})},y3=({value:t,className:s})=>{var r;if(!t)return!1;const n=Et();return e.jsx("div",{className:s||((r=n==null?void 0:n.text)==null?void 0:r.view),children:t})},v3={EditComp:b3,ViewComp:y3},j3=({value:t,item:s,onChange:n,className:r,attributes:a={},...l})=>(console.log("can i pass item here?",s,t,l),Et(),Object.keys(a).map(i=>{const c=a[i].EditComp;return e.jsx(c,{placeholder:a[i].key,...a[i],...l})})),w3=({value:t,className:s,...n})=>{var a;if(!t)return!1;console.log("template",t,n);const r=Et();return e.jsx("div",{className:s||((a=r==null?void 0:r.text)==null?void 0:a.view),children:JSON.stringify(t)})},N3={EditComp:j3,ViewComp:w3};function C3({value:t,onChange:s,attributes:n={}}){console.log("dms-format",t,n);const r=(a,l)=>{Fe(t,{...t,[a]:l})||s({...t,[a]:l})};return e.jsx("div",{children:Object.keys(n).map((a,l)=>{let i=n[a].EditComp;return e.jsxs("div",{children:[e.jsx("div",{children:a}),e.jsx("div",{children:e.jsx(i,{value:t==null?void 0:t[a],onChange:c=>r(a,c)},`${a}-${l}`)})]},`${a}-${l}`)})})}const _3=({value:t={},attributes:s={}})=>(console.log("dms-format value",t,s),e.jsx("div",{children:Object.keys(s).map((n,r)=>{let a=s[n].ViewComp;return e.jsxs("div",{children:[e.jsx("div",{children:n}),e.jsx("div",{children:e.jsx(a,{value:t[n]},`${n}-${r}`)})]},`${n}-${r}`)})})),S3={EditComp:C3,ViewComp:_3},$3=({Component:t,value:s,onChange:n,attr:r})=>{(!s||!s.map)&&(s=[]);const[a,l]=w.useState(""),i=()=>{n([...s,a]),l("")};return e.jsxs(e.Fragment,{children:[s.map((c,d)=>b.createElement(t.ViewComp,{value:c,...r,key:d})),e.jsx(t.EditComp,{value:a,onChange:l,...r}),e.jsx("button",{onClick:i,children:"Add"})]})},E3=({Component:t,value:s,attr:n})=>!s||!s.map?"":s.map((r,a)=>b.createElement(t.ViewComp,{...n,key:a,value:r})),sf={EditComp:$3,ViewComp:E3},k3=({value:t="",onChange:s,className:n,placeholder:r,displayInvalidMsg:a=!0,options:l=[],...i})=>{var u,p;const c=Et(),d=t&&!l.find(m=>(m.value||m)===t);return e.jsxs(e.Fragment,{children:[d?e.jsx(Mc,{className:(u=c==null?void 0:c.select)==null?void 0:u.error,title:`Invalid Value: ${JSON.stringify(t)}`}):null,e.jsxs("select",{className:n||((p=c==null?void 0:c.select)==null?void 0:p.input)||"w-full border p-2",value:t,onChange:m=>s(m.target.value),children:[e.jsx("option",{value:"",children:r}),l.map((m,h)=>e.jsx("option",{value:m.value||m,children:m.label||m},h))]})]})},L3=({className:t,value:s,options:n=[],...r})=>{var i,c;if(!s)return e.jsx("div",{className:`${t||((i=a==null?void 0:a.select)==null?void 0:i.input)}`});const a=Et(),l=n.find(d=>(d.value||d)===s)||s;return s&&n.find(d=>(d.value||d)===s),e.jsx("div",{className:`${t||((c=a==null?void 0:a.select)==null?void 0:c.input)}`,...r,children:(l==null?void 0:l.label)||l})},I3={EditComp:k3,ViewComp:L3},T3="flex px-2 py-1 w-full text-sm font-light border focus:border-blue-300 bg-white hover:bg-gray-100 transition ease-in",M3="w-full",B3="focus:outline-none w-full",A3="flex px-2 py-1 mx-1 bg-gray-100 hover:bg-gray-300 rounded-md transition ease-in",O3="fa fa-x px-1 text-xs text-red-300 hover:text-red-500 self-center transition ease-in",P3="p-2 shadow-lg z-10",ju="px-2 py-1 hover:bg-gray-300 hover:cursor-pointer transition ease-in",nf=({token:t,value:s,onChange:n,theme:r,isSearching:a,setIsSearching:l})=>{var i,c;return e.jsxs("div",{className:((i=r==null?void 0:r.multiselect)==null?void 0:i.tokenWrapper)||A3,children:[e.jsx("div",{onClick:()=>l(!a),children:t.label||t}),n&&e.jsx("i",{className:((c=r==null?void 0:r.multiselect)==null?void 0:c.removeIcon)||O3,onClick:d=>n(s.filter(u=>(u.value||u)!==(t.value||t))),children:" "})]})},D3=({options:t,isSearching:s,setIsSearching:n,placeholder:r,setSearchKeyword:a,searchKeyword:l,value:i,onChange:c,theme:d})=>{var h,f;const u=i.map(g=>g.value||g),p={label:"Select All",value:"select-all"},m={label:"Remove All",value:"remove-all"};return e.jsxs("div",{className:`${s?"block":"hidden"} ${((h=d==null?void 0:d.multiselect)==null?void 0:h.menuWrapper)||P3}`,children:[e.jsx("input",{autoFocus:!0,placeholder:r||"search...",className:((f=d==null?void 0:d.multiselect)==null?void 0:f.input)||B3,onChange:g=>a(g.target.value),onFocus:()=>n(!0)},"input"),e.jsx("div",{className:d.multiselect.smartMenuWrapper,children:[p,m].filter(g=>g.value==="select-all"?i.length!==t.length:g.value==="remove-all"?i.length:!0).map((g,x)=>{var y;return e.jsx("div",{className:((y=d==null?void 0:d.multiselect)==null?void 0:y.smartMenuItem)||ju,onClick:j=>{c(g.value==="select-all"?t:g.value==="remove-all"?[]:[...i,g]),n(!1)},children:g.label||g},`smart-option-${x}`)})}),t.filter(g=>{var x;return!u.includes(g.value||g)&&((x=g.label||g)==null?void 0:x.toLowerCase().includes(l==null?void 0:l.toLowerCase()))}).map((g,x)=>{var y;return e.jsx("div",{className:((y=d==null?void 0:d.multiselect)==null?void 0:y.menuItem)||ju,onClick:j=>{c(g.value==="select-all"?t:g.value==="remove-all"?[]:[...i,g]),n(!1)},children:g.label||g},`option-${x}`)})]})};function R3(t){const[s,n]=b.useState(t),r=b.useRef(null),a=i=>{(i.key==="Escape"||i.key==="Tab")&&n(!1)},l=i=>{r.current&&!r.current.contains(i.target)&&n(!1)};return b.useEffect(()=>(document.addEventListener("keydown",a,!0),document.addEventListener("click",l,!0),()=>{document.removeEventListener("keydown",a,!0),document.removeEventListener("click",l,!0)})),{ref:r,isSearching:s,setIsSearching:n}}const F3=({value:t=[],onChange:s,className:n,placeholder:r,options:a=[],displayInvalidMsg:l=!0,menuPosition:i="bottom"})=>{var x,y,j;const[c,d]=b.useState(""),u=Array.isArray(t)?t:[t],p=Et(),{ref:m,isSearching:h,setIsSearching:f}=R3(!1),g=u.filter(N=>{var _;return(N.value||N)&&!((_=a.filter(E=>(E.value||E)===(N.value||N)))!=null&&_.length)});return e.jsxs("div",{ref:m,className:`${((x=p==null?void 0:p.multiselect)==null?void 0:x.mainWrapper)||M3} ${i==="top"?"flex flex-col flex-col-reverse":""}`,children:[g.length&&l?e.jsx(Mc,{className:(y=p==null?void 0:p.multiselect)==null?void 0:y.error,title:`Invalid Values: ${JSON.stringify(g)}`}):null,e.jsxs("div",{className:n||((j=p==null?void 0:p.multiselect)==null?void 0:j.inputWrapper)||T3,onClick:()=>{f(!h),console.log("ms?",m.current.top)},children:[u.filter(N=>N).map((N,_)=>e.jsx(nf,{token:N,value:u,onChange:s,isSearching:h,setIsSearching:f,theme:p},_)),e.jsx(al,{className:"ml-auto self-center font-bold","width-":16,height:16})]}),e.jsx(D3,{isSearching:h,setIsSearching:f,placeholder:r,setSearchKeyword:d,searchKeyword:c,value:u,onChange:s,options:a,theme:p})]})},V3=({className:t,value:s,options:n=[]})=>{var l,i,c;const r=Et();if(!s)return e.jsx("div",{className:(l=r==null?void 0:r.multiselect)==null?void 0:l.mainWrapper});const a=(Array.isArray(s)?s:[s]).map(d=>d.value||d);return n.filter(d=>a.includes(d.value||d)).map(d=>d.label||d),e.jsx("div",{className:(i=r==null?void 0:r.multiselect)==null?void 0:i.mainWrapper,children:e.jsx("div",{className:t||((c=r==null?void 0:r.text)==null?void 0:c.inputWrapper),children:a.map((d,u)=>e.jsx(nf,{token:d,isSearching:!1,setIsSearching:()=>{},theme:r},u))})})},H3={EditComp:F3,ViewComp:V3},z3=({value:t="",onChange:s,options:n=[],inline:r})=>{var i;const a=Et(),l=t&&!n.find(c=>(c.value||c)===t);return e.jsxs(e.Fragment,{children:[l?e.jsxs("div",{className:(i=a==null?void 0:a.radio)==null?void 0:i.error,children:["Invalid Value: ",JSON.stringify(t)]}):null,e.jsx("div",{className:`flex ${r?"flex-row":"flex-col"}`,children:n.map((c,d)=>{var u,p,m;return e.jsxs("div",{className:((u=a==null?void 0:a.radio)==null?void 0:u.wrapper)||"p-1 flex",children:[e.jsx("input",{id:c.value||c,className:((p=a==null?void 0:a.radio)==null?void 0:p.input)||"self-center p-1",type:"radio",value:c.value||c,checked:t===(c.value||c),onChange:h=>s(h.target.value)}),e.jsxs("label",{htmlFor:c.label||c,className:((m=a==null?void 0:a.radio)==null?void 0:m.label)||"text-sm font-light p-1 self-center",children:[" ",c.label||c," "]})]},d)})})]})},U3=({className:t,value:s})=>{var r;if(!s)return!1;const n=Et();return e.jsx("div",{className:t||((r=n==null?void 0:n.text)==null?void 0:r.view),children:s})},W3={EditComp:z3,ViewComp:U3},gt={text:Sl,datetime:Sl,textarea:K2,config:v3,"form-template":N3,boolean:X2,"dms-format":S3,lexical:Dh,select:I3,multiselect:H3,radio:W3,default:Sl};function af(t,s){gt[t]=s}function G3(t){const{type:s="default",isArray:n=!1,attributes:r}=t;let a=C(gt,`[${s}]`,gt.default),l=a.ViewComp;if(n){let i=t.DisplayComp?t.DisplayComp.ViewComp:sf.ViewComp;l=c=>e.jsx(i,{Component:a,...c,attr:t})}return l}function J3(t){const{type:s="default",isArray:n=!1,attributes:r}=t;let a=C(gt,`[${s}]`,gt.default),l=a.EditComp;if(n){let i=t.DisplayComp?t.DisplayComp.EditComp:sf.EditComp;l=c=>e.jsx(i,{Component:a,...c,attr:t})}return l}function wr(t,s={},n=""){const r=rf(t),a=(s==null?void 0:s.accessor)||"key",l=t.attributes.filter(c=>n!=="edit"||typeof c.editable>"u"||!!c.editable).reduce((c,d)=>(d.format&&r[d.format]?c[d[a]]={...d,attributes:wr(r[d.format])}:c[d[a]]=d,c),{}),i=Object.keys(l);return Object.keys(l).filter(c=>i.includes(c)).forEach(c=>{l[c].ViewComp=G3(C(l,`${c}`,{})),l[c].EditComp=J3(C(l,`${c}`,{}))}),l}function rf(t,s={}){if(!t)return s;const n=Ie(t);return n.registerFormats&&n.registerFormats.forEach(r=>rf(r,s)),s[`${n.app}+${n.type}`]=n,s}const q3=(t,s="update")=>{let n=new FormData;return n.append("data",JSON.stringify(t)),n.append("requestType",s),n};function K3({Component:t,format:s,options:n,params:r,user:a,...l}){const{falcor:i}=Us.useFalcor(),c=wr(s,n,"edit"),d=zt(),{pathname:u,search:p}=kt(),{data:m=[]}=fc()||[];let h=gy();const{defaultSort:f=L=>L}=s,[g,x]=w.useState(f(m).filter(L=>wi(L,r,s))[0]||{});b.useEffect(()=>{let L=m.filter(S=>wi(S,r,s))[0];!Fe(g,L)&&L&&x(L||{})},[m,r]);const y=async({data:L,config:S={format:s},requestType:k=""})=>{console.log("apiUpdate",L,S),await ar(i,S,L,k),d(null,{action:`${u}${p}`})},j=(L,S,k)=>{x(k?{...g,...k}:{...g,[L]:S})},N=()=>{d(q3(g),{method:"post",action:u})},_=async(L,S)=>await Ns(i,L,S||"/"),E=w.useMemo(()=>t,[]);return e.jsx(E,{...l,format:s,attributes:c,item:g,dataItems:m,params:r,apiUpdate:y,apiLoad:_,updateAttribute:j,setItem:x,options:n,status:h,user:a,submit:N})}function Y3({Component:t,format:s,options:n,user:r,...a}){const{falcor:l}=Us.useFalcor(),i=wr(s,n),{app:c,type:d}=s,{pathname:u,search:p}=kt(),{data:m=[]}=fc()||{},h=zt(),f=async({data:y,config:j={format:s},requestType:N=""})=>{const _=await ar(l,j,y,N);if(!y.id)return _;y.app!==c||y.type!==d||h(null,{action:`${u}${p}`})},g=async(y,j)=>await Ns(l,y,j),x=w.useMemo(()=>t,[]);return e.jsx(x,{...a,format:s,attributes:i,dataItems:m,apiUpdate:f,apiLoad:g,options:n,user:r},n==null?void 0:n.path)}function Z3({Component:t,format:s,options:n,params:r,user:a,...l}){let i=wr(s,n);const{data:c=[]}=fc()||{},{defaultSort:d=m=>m}=s,u=d(c).filter(m=>wi(m,r,s))[0]||c[0];console.log("item: view",u);const p=w.useMemo(()=>t,[]);return e.jsx(p,{...l,format:s,attributes:i,item:u,dataItems:c,options:n,user:a})}function X3({Component:t,format:s,options:n,user:r,...a}){let l=wr(s,n);return e.jsx(t,{...a,format:s,attributes:l,dataItems:[],options:n,user:r})}const of={edit:K3,error:X3,list:Y3,view:Z3};function Q3(t){return e.jsx("div",{children:"404 - Config not found"})}function wo({item:t,attributes:s,next:n,nextDisabled:r,prev:a,prevDisabled:l,sectionId:i,preferredTheme:c}){var u,p,m;const d=c||Et();return t?e.jsxs("div",{className:C(d,"card.wrapper",""),children:[Object.keys(s).filter(h=>!i||s[h].section===i).map((h,f)=>{var x,y;let g=s[h].ViewComp;return e.jsxs("div",{className:C(d,"card.row",""),children:[e.jsx("div",{className:C(d,"card.rowLabel",""),children:((x=s[h])==null?void 0:x.display_name)||((y=s[h])==null?void 0:y.label)||h}),e.jsx("div",{className:C(d,"card.rowContent",""),children:e.jsx(g,{value:t[h],...s[h]})})]},f)}),(a||n)&&i&&e.jsxs("div",{className:(u=d==null?void 0:d.card)==null?void 0:u.btnWrapper,children:[a&&i&&e.jsx("button",{className:(p=d==null?void 0:d.card)==null?void 0:p.backBtn,disabled:l,onClick:()=>a(),children:" Back "}),n&&i&&e.jsx("button",{className:(m=d==null?void 0:d.card)==null?void 0:m.continueBtn,disabled:r,onClick:()=>n(),children:" Continue "})]})]},t.id):e.jsx("div",{})}function e_({dataItems:t=[],attributes:s}){return Et(),e.jsxs("div",{className:"border border-pink-300",children:["Landing",t.map((n,r)=>e.jsx(wo,{item:n,attributes:s},r))]})}function wu(t,s){var n=/:(\w+)/g;return t.replace(n,function(r,a){return s[a]||":"+a})}const Nu={data:function({data:s,column:n,className:r,key:a}){return e.jsxs("td",{className:r,children:[" ",C(s,[n.path],"").toString()," "]},a)},date:function({data:s,column:n,className:r,key:a}){return e.jsxs("td",{className:r,children:[" ",new Date(s[n.path]).toLocaleString()," "]},a)},link:function({data:s,column:n,className:r,key:a}){return e.jsx("td",{className:r,children:e.jsx(je,{to:wu(n.to,s),children:wu(n.text,s)})},a)}};function t_({data:t,column:s,className:n}){let r=C(Nu,[s.type],Nu.data);return e.jsx(r,{data:t,column:s,className:n})}function s_({dataItems:t=[],attributes:s={},options:n={}}){var l,i,c;const r=Et();let{columns:a=[]}=n;return a.length===0?e.jsx("div",{children:" No columns specified. "}):e.jsx("div",{className:"",children:e.jsxs("table",{className:`${(l=r==null?void 0:r.table)==null?void 0:l.table}`,children:[e.jsx("thead",{className:`${(i=r==null?void 0:r.table)==null?void 0:i.thead}`,children:e.jsx("tr",{children:a.map((d,u)=>{var p;return e.jsx("th",{className:`${(p=r==null?void 0:r.table)==null?void 0:p.th}`,children:d.name},u)})})}),e.jsx("tbody",{className:`${(c=r==null?void 0:r.table)==null?void 0:c.tbody}`,children:t.map(d=>e.jsx("tr",{children:a.map((u,p)=>{var m;return e.jsx(t_,{className:`${(m=r==null?void 0:r.table)==null?void 0:m.td}`,data:d,column:u},`${u.name}-${p}`)})},d.id))})]})})}function lf({item:t={},attributes:s,updateAttribute:n,status:r,submit:a,next:l,nextDisabled:i,prev:c,prevDisabled:d,sectionId:u,...p}){var h,f,g,x;const m=Et();return e.jsxs("div",{className:C(m,"card.wrapper",""),children:[r?e.jsx("div",{children:JSON.stringify(r)}):"",Object.keys(s).filter(y=>!u||s[y].section===u).map((y,j)=>{var _,E,L,S;let N=s[y].EditComp;return e.jsxs("div",{className:C(m,"card.row",""),children:[e.jsxs("div",{className:C(m,"card.rowHeader",""),children:[e.jsx("div",{className:C(m,"card.rowLabel",""),children:((_=s[y])==null?void 0:_.display_name)||((E=s[y])==null?void 0:E.label)||y}),((L=s[y])==null?void 0:L.prompt)&&e.jsx("i",{title:(S=s[y])==null?void 0:S.prompt,className:C(m,"card.infoIcon","fad fa-info")})]}),e.jsx("div",{className:C(m,"card.rowContent",""),children:e.jsx(N,{value:t==null?void 0:t[y],onChange:k=>n(y,k),...s[y]},`${y}-${j}`)})]},`${y}-${j}`)}),e.jsxs("div",{className:(h=m==null?void 0:m.card)==null?void 0:h.btnWrapper,children:[c&&u&&e.jsx("button",{className:(f=m==null?void 0:m.card)==null?void 0:f.backBtn,disabled:d,onClick:()=>c(),children:" Back "}),l&&u&&e.jsx("button",{className:(g=m==null?void 0:m.card)==null?void 0:g.continueBtn,disabled:i,onClick:()=>l(),children:" Continue "}),e.jsx("button",{className:(x=m==null?void 0:m.card)==null?void 0:x.submitBtn,onClick:()=>a(),children:" Save"})]})]},t.id)}const n_=({theme:t={},tabs:s=[],activeIndex:n=0,setActiveIndex:r=null})=>{if(!s)return null;const[a,l]=w.useState(n);return w.useEffect(()=>{l(n)},[n]),e.jsx("div",{className:`${t.tabpanelWrapper}`,children:e.jsx("div",{className:`${t.tabWrapper}`,children:s.map(({icon:i,title:c,subtitle:d},u)=>e.jsxs("div",{onClick:p=>r?r(u):l(u),className:`${u===a?t.tabActive:t.tab}`,children:[e.jsx("span",{className:`${i} ${t.icon}`}),e.jsxs("span",{className:`${t.tabTitle}`,children:[" ",c," "]}),e.jsxs("span",{className:`${t.tabSubtitle}`,children:[" ",d," "]})]},u))})})};function a_({item:t,updateAttribute:s,attributes:n,status:r,submit:a,format:l,...i}){var p,m,h;const[c,d]=b.useState(l!=null&&l.sections?0:void 0),u=Et();return e.jsxs(e.Fragment,{children:[e.jsx(n_,{tabs:l==null?void 0:l.sections,activeIndex:c,setActiveIndex:d,theme:u.form}),e.jsx(lf,{item:t,status:r,attributes:n,sectionId:(m=(p=l==null?void 0:l.sections)==null?void 0:p[c])==null?void 0:m.id,updateAttribute:s,submit:a,next:()=>d(c+1),nextDisabled:c===((h=l==null?void 0:l.sections)==null?void 0:h.length)-1,prev:()=>d(c-1),prevDisabled:c===0})]})}function r_({item:t,updateAttribute:s,attributes:n,status:r,submit:a,format:l,...i}){var d;const c=Et();return e.jsx("div",{className:(d=c==null?void 0:c.form)==null?void 0:d.sectionsWrapper,children:l!=null&&l.sections?((l==null?void 0:l.sections)||[]).map(u=>{var p,m,h,f,g;return e.jsxs("div",{className:(p=c==null?void 0:c.form)==null?void 0:p.sections,children:[e.jsxs("div",{className:(m=c==null?void 0:c.form)==null?void 0:m.tab,children:[e.jsx("span",{className:`${u.icon} ${(h=c==null?void 0:c.form)==null?void 0:h.icon}`}),e.jsxs("span",{className:`${(f=c==null?void 0:c.form)==null?void 0:f.tabTitle}`,children:[" ",u.title," "]}),e.jsxs("span",{className:`${(g=c==null?void 0:c.form)==null?void 0:g.tabSubtitle}`,children:[" ",u.subtitle," "]})]}),e.jsx(wo,{preferredTheme:c==null?void 0:c.form,item:t,status:r,attributes:n,sectionId:u==null?void 0:u.id})]},u==null?void 0:u.id)}):e.jsx(wo,{preferredTheme:c==null?void 0:c.form,item:t,status:r,attributes:n})})}function o_({config:t}){return e.jsxs("div",{children:[" Invalid DMS Config :",e.jsx("pre",{style:{background:"#dedede"},children:JSON.stringify(t,null,3)})]})}function l_({path:t}){return e.jsxs("div",{children:[" These aren't the droids you are looking for",e.jsx("div",{className:"text-5xl",children:"404"}),e.jsxs("div",{children:["/",t]})]})}const Pc={devinfo:Q3,"dms-landing":e_,"dms-table":s_,"dms-card":wo,"dms-edit":lf,"dms-form-edit":a_,"dms-form-view":r_,InvalidConfig:o_,NoRouteMatch:l_},i_=Pc.devinfo,c_=of.error;let d_=0;function cf(t,s){let r=(xy(t.map(a=>({path:a.path,...a})),{pathname:s})||[]).reduce((a,l)=>(a[l.route.path]=l,a),{});return t.filter((a,l)=>{let i=(r==null?void 0:r[a.path])||!1;return i&&(a.params=i.params),i})}function df(t,s,n,r,a=0){return cf(t,s).map(i=>{const c=typeof i.type=="function"?i.type:Pc[i.type]||i_,d=of[i.action]||c_;let u=[];return i.children&&(u=df(i.children,s,n,r,a+1)),e.jsx(d,{Component:c,format:n,...i,children:u,user:r},d_++)})}function Dc(t=[],s="/",n=0){let r=Ie(cf(t,s)),a=r.reduce((l,i)=>{var d;let c=(d=i.children)!=null&&d.length?Dc(i.children,s,n+1):[];return c.length?[...l,...c]:l},[]);return[...r,...a]}function u_(t){return t&&t.attributes&&t.attributes.length>0}function wi(t,s,n){var l;let r=((l=n==null?void 0:n.attributes)==null?void 0:l.reduce((i,c)=>(c.matchWildcard&&(i=c.key),i),""))||"",a=!1;return Object.keys(s).forEach(i=>{t[i]==s[i]||t[r]&&t[r]===s["*"]?a=!0:a=!1}),s.id==t.id?!0:a}const m_=(t,s,n,r)=>{var f,g,x,y,j,N,_,E,L,S,k,$,I;const{app:a,type:l}=s;let i=((f=t==null?void 0:t.filter)==null?void 0:f.attributes)||[],c=i.length>0?i.map(T=>`data ->> '${T}'`):["data"],d=typeof((g=t==null?void 0:t.filter)==null?void 0:g.fromIndex)=="function"?(x=t==null?void 0:t.filter)==null?void 0:x.fromIndex(n):+((j=t.params)==null?void 0:j[(y=t==null?void 0:t.filter)==null?void 0:y.fromIndex])||0,u=typeof((N=t==null?void 0:t.filter)==null?void 0:N.toIndex)=="function"?(_=t==null?void 0:t.filter)==null?void 0:_.toIndex(n):+((L=t.params)==null?void 0:L[(E=t==null?void 0:t.filter)==null?void 0:E.toIndex])||r-1,p=((S=t==null?void 0:t.filter)==null?void 0:S.options)||"{}",m=((k=t==null?void 0:t.filter)==null?void 0:k.tags)||[],h=(($=t==null?void 0:t.filter)==null?void 0:$.searchType)||"byTag";if(((I=t==null?void 0:t.filter)==null?void 0:I.type)==="new")return[];switch(t.action){case"list":return["dms","data",`${a}+${l}`,p!=="{}"?"opts":!1,p!=="{}"?p:!1,"byIndex",{from:d,to:u},["id","app","type",...c]].filter(T=>T);case"view":case"edit":{const T=uf(t,s);return T||["dms","data",`${a}+${l}`,"byIndex",{from:d,to:u},["id","updated_at","created_at","app","type",...c]]}case"load":return["dms","data",`${a}+${l}`,"options",p,"byIndex",{from:d,to:u},[...i.length>0?i:["data"]]];case"search":return["dms","search",`${a}+${l}`,h,m];case"searchTags":return["dms","search",`${a}+${l}`,"tags"];case"searchPageTitles":return["dms","search",`${a}+${l}`,"pageTitles"];default:return[]}};function uf(t,s){var p,m;const{app:n,type:r,defaultSearch:a,attributes:l=[]}=s;let i=((p=t==null?void 0:t.filter)==null?void 0:p.attributes)||[],c=i.length>0?i.map(h=>`data ->> '${h}'`):["data"];const d=(l==null?void 0:l.reduce((h,f)=>(f.matchWildcard&&(h=f.key),h),""))||"";let u=(m=t.params)==null?void 0:m.id;return u?["dms","data","byId",u,["id","updated_at","created_at","app","type",...c]]:d?["dms","data",`${n}+${r}`,"searchOne",[JSON.stringify({wildKey:`data ->> '${d}'`,params:t.params["*"]||"",defaultSearch:a})],["id","updated_at","created_at","app","type",...c]]:null}async function p_(t,s,n,r,a,l,i,c,d){var f;const u=Array.isArray(s)?s.map(g=>+g):s;let p=[],m=Object.values(C(t,["dms","data","byId"],{})).filter(g=>(n?(u==null?void 0:u.length)&&u.includes(+g.id):!0)&&g.id&&g.app===a&&g.type===l);for(const g in m){let x=Ie(m[g]),y=((f=x==null?void 0:x.data)==null?void 0:f.value)||{};Object.keys(x).filter(j=>j!=="data").forEach(j=>{if(j.includes("data ->> ")){let N=j.split("->>")[1].trim().replace(/[']/g,"");y[N]=x[j]}else y[j]=x[j]}),p.push(y)}c!=null&&c.defaultSort&&(p=c.defaultSort(p));let h=0;for(const g in p)(u==="loadAll"||u.includes(+p[g].id)||h===0)&&await mf(p[g],i,c,d),h++;return p}async function mf(t,s,n,r){var i,c,d,u,p;if(!t)return;let a=Object.keys(t).filter(m=>Object.keys(s).includes(m)),l=Object.keys(s).reduce((m,h)=>{var g,x;let f=(x=(g=n==null?void 0:n.registerFormats)==null?void 0:g.filter(y=>y.type===s[h].format.split("+")[1]))==null?void 0:x[0];return f&&(m[h]=f),m},{});for(const m of a){const h=[],f=Object.values(((i=l==null?void 0:l[m])==null?void 0:i.attributes)||{}).filter(g=>g.type==="dms-format").reduce((g,x)=>(g[x.key]=x,g),{});if(typeof(t==null?void 0:t[m])=="string"&&(t[m]=JSON.parse(t[m])),typeof((c=t==null?void 0:t[m])==null?void 0:c[Symbol.iterator])=="function")for(let g of t[m])g.id&&h.push(["dms","data","byId",g.id,"data"]);else(d=t[m])!=null&&d.id&&h.push(["dms","data","byId",(u=t[m])==null?void 0:u.id,"data"]);if(h.length>0){let g=await r.get(...h);if(typeof((p=t==null?void 0:t[m])==null?void 0:p[Symbol.iterator])=="function"){let x=0;for(let y of t[m])if(y.id){let j=C(g,["json","dms","data","byId",y.id,"data"]);Object.keys(f).length>0&&await mf(j,f,l[m],r),t[m][x]={...y,...j},x+=1}}else{let x=C(g,["json","dms","data","byId",t[m].id,"data"]);t[m]={...t[m],...x}}}}}async function h_(t,s,n){var a,l,i,c,d;let r={};for(const u of Object.keys(t)){r[u]=[];let[p,m]=s[u].format.split("+");const h=Array.isArray(t[u])?t[u]:[t[u]];for(const f of h){let g=Ie(f),x=(g==null?void 0:g.id)||!1;if(x){let y=C(n.getCache(["dms","data","byId",x,"data"]),["dms","data","byId",x,"data","value"],{});delete g.ref,delete g.id,y!=null&&y.ref&&delete y.ref,y!=null&&y.id&&delete y.id,Fe(y,g)||(await n.call(["dms","data","edit"],[x,g]),console.log("invalidate",x,f),await n.invalidate(["dms","data","byId",x])),r[u].push({ref:`${p}+${m}`,id:x})}else{const y=await n.call(["dms","data","create"],[p,m,g]);let j=((c=Object.keys(((i=(l=(a=y==null?void 0:y.json)==null?void 0:a.dms)==null?void 0:l.data)==null?void 0:i.byId)||{}).filter(N=>N!=="$__path"))==null?void 0:c[0])||-1;console.log(j),j!==-1&&r[u].push({ref:`${p}+${m}`,id:j})}}r[u]=Array.isArray(t[u])?r[u]:((d=r[u])==null?void 0:d[0])||""}return r}let f_={};async function Ns(t,s,n="/"){var L,S,k,$,I,T,A,R,O,M,D,P,F,B,V,G,Z,X,H,z,W,Y,U,q,te,K,ne;s.formatFn&&(s.format=await s.formatFn());const{format:r}=s,{app:a,type:l,attributes:i={}}=r,c=Dc(s.children,n),d=Object.values(i).filter(J=>J.type==="dms-format").reduce((J,ae)=>(J[ae.key]=ae,J),{});let u=["dms","data",`${a}+${l}`,"length"];if(c.find(J=>["list","load","filteredLength"].includes(J.action))){const J=(S=(L=c.find(ae=>["list","load","filteredLength"].includes(ae.action)))==null?void 0:L.filter)==null?void 0:S.options;J&&(u=["dms","data",`${a}+${l}`,"options",J,"length"])}const p=C(await t.get(u),["json",...u],0);if(c.find(J=>["length","filteredLength"].includes(J.action)))return p;let m=(($=(k=c[0])==null?void 0:k.filter)==null?void 0:$.options)||"{}";const h=["dms","data",`${a}+${l}`,m!=="{}"?"opts":!1,m!=="{}"?m:!1,"byIndex"].filter(J=>J),f=c.map(J=>m_(J,r,n,p)).filter(J=>J==null?void 0:J.length);f.length>0&&await t.get(...f);let g=t.getCache();if(c.find(J=>J.action==="search")){const J=((T=(I=c.find(de=>de.action==="search"))==null?void 0:I.filter)==null?void 0:T.searchType)||"byTag",ae=f[0].filter((de,ue)=>ue<=f[0].indexOf(J));return C(g,ae,{})}if(c.find(J=>J.action==="searchTags")){const J=f[0].filter((ae,de)=>de<=f[0].indexOf("tags"));return C(g,J,{})}if(c.find(J=>J.action==="searchPageTitles")){const J=f[0].filter((ae,de)=>de<=f[0].indexOf("pageTitles"));return C(g,J,{})}if(c.find(J=>J.action==="load")){const J=f[0].filter((ae,de)=>de<=f[0].indexOf("byIndex"));return Object.values(C(g,J,{}))}const x=c.filter(J=>J.action!=="load").map(J=>uf(J,r)).filter(J=>J==null?void 0:J.length).map(J=>{let ae=C(g,J.slice(0,-1),!1);return(ae==null?void 0:ae.$type)==="ref"?+ae.value[3]:+(ae==null?void 0:ae.id)}).filter(J=>J);let y=(R=(A=c[0])==null?void 0:A.params)==null?void 0:R.id,j=typeof((M=(O=c==null?void 0:c[0])==null?void 0:O.filter)==null?void 0:M.fromIndex)=="function"?(P=(D=c==null?void 0:c[0])==null?void 0:D.filter)==null?void 0:P.fromIndex(n):+((G=(F=c==null?void 0:c[0])==null?void 0:F.params)==null?void 0:G[(V=(B=c==null?void 0:c[0])==null?void 0:B.filter)==null?void 0:V.fromIndex]),N=typeof((X=(Z=c==null?void 0:c[0])==null?void 0:Z.filter)==null?void 0:X.toIndex)=="function"?(z=(H=c==null?void 0:c[0])==null?void 0:H.filter)==null?void 0:z.toIndex(n):+((q=(W=c==null?void 0:c[0])==null?void 0:W.params)==null?void 0:q[(U=(Y=c==null?void 0:c[0])==null?void 0:Y.filter)==null?void 0:U.toIndex]);const _=!y&&j!==void 0&&N!==void 0?Object.keys(C(g,[...h],{})).filter(J=>+J>=+j&&+J<=+N-1).map(J=>C(g,[...h,J,"value",3])).filter(J=>J):[];x.push(..._||[]);const E=await p_(g,x,(K=(te=c==null?void 0:c[0])==null?void 0:te.filter)==null?void 0:K.stopFullDataLoad,_==null?void 0:_.length,a,l,d,r,t);return(ne=c==null?void 0:c[0])!=null&&ne.lazyLoad&&f_[`${a}+${l}`],E}async function ar(t,s,n={},r){var h,f,g,x;const{app:a,type:l}=s.format,{id:i}=n,c=Object.keys(n).filter(y=>!["id","updated_at","created_at"].includes(y));console.log("dms editor",n,a,l);const d=Object.values(((h=s==null?void 0:s.format)==null?void 0:h.attributes)||{}).filter(y=>y.type==="dms-format").reduce((y,j)=>(y[j.key]=j,y),{}),p=c.filter(y=>Object.keys(d).includes(y)).reduce((y,j)=>(y[j]=n[j],delete n[j],y),{});let m=await h_(p,d,t);if(n={...n,...m},r==="delete"&&i)return await t.call(["dms","data","delete"],[a,l,i]),await t.invalidate(["dms","data",`${a}+${l}`,"length"]),{response:`Deleted item ${i}`};if(r==="updateType"&&i)return n.type?(await t.call(["dms","type","edit"],[i,n.type]),await t.invalidate(["dms","data","byId",i]),{message:"Update successful."}):{message:"No type found."};if(i&&c.length>0)return await t.call(["dms","data","edit"],[i,n]),await t.invalidate(["dms","data","byId",i]),{message:"Update successful."};if(c.length>0){const y=await t.call(["dms","data","create"],[a,l,n]);return await t.invalidate(["dms","data",`${a}+${l}`,"length"]),{response:"Item created.",id:Object.keys(((x=(g=(f=y==null?void 0:y.json)==null?void 0:f.dms)==null?void 0:g.data)==null?void 0:x.byId)||{})[0]}}return{message:"Not sure how I got here."}}const g_=(t,{user:s},n,r,a)=>{const l=c=>c.reduce((d,u)=>{let p=u.authLevel||-1;return u.children&&(p=Math.max(p,l(u.children))),Math.max(d,p)},-1);let i=l(n);t({user:s,authLevel:i},r,a)},x_=(t,s,n)=>{const{user:r={}}=t;let a=(t==null?void 0:t.authLevel)||-1;const l=(t==null?void 0:t.auth)||!1;a=Math.max(a,l?0:-1);const i=(r==null?void 0:r.authed)||!1,c=(r==null?void 0:r.authLevel)||-1,d=!i&&a>=0,u=c<a;return d?s("/auth/login",{state:{from:t.path}}):u&&n!=="/"&&s("/"),!1},{InvalidConfig:b_,NoRouteMatch:y_}=Pc,v_=t=>{const{config:s,path:n="",user:r}=t,{check:a=g_,checkAuth:l=x_}=s,i=$e();if(w.useEffect(()=>{if(a&&r){let d=Dc(s.children,n,s.format);a(l,t,d,i,n)}},[n]),!s.children||!u_(s.format))return e.jsx(b_,{config:s});const c=w.useMemo(()=>df(s.children,n,s.format,r),[n]);return c?w.useMemo(()=>e.jsx(e.Fragment,{children:c}),[c]):e.jsx(y_,{path:n})};function j_(t,s=r=>r,n=oh){let{API_HOST:r="https://graph.availabs.org",baseUrl:a=""}=t;const l=`${a}${a==="/"?"":"/"}`,i=Us.falcorGraph(r);async function c({request:p,params:m}){return{data:await Ns(i,t,`/${m["*"]||""}`)}}async function d({request:p,params:m}){const h=await p.formData();return ar(i,t,JSON.parse(h.get("data")),h.get("requestType"),m["*"])}function u(){const p=Ye(),m=s(v_);return w.useMemo(()=>e.jsx(Us.FalcorProvider,{falcor:i,children:e.jsx(m,{path:`/${p["*"]||""}`,config:t,theme:n})}),[p["*"]])}return{path:`${l}*`,Component:p=>e.jsx(u,{...p}),loader:c,action:d}}function w_(t){const s=t instanceof Date?t:new Date(t),n=new Intl.RelativeTimeFormat("en"),r={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},a=(s.getTime()-Date.now())/1e3;for(let l in r)if(r[l]<Math.abs(a)){const i=a/r[l];return n.format(Math.round(i),l)}}function No(t,s,n="",r){let a=s.filter(l=>t.id&&l.parent===t.id).sort((l,i)=>l.index-i.index);return a.length===0?!1:a.map((l,i)=>{let c={id:l.id,path:`${r?`${n}/edit`:n}/${l.url_slug||l.id}`,name:l.title};return No(c,s)&&(c.subMenus=No(l,s,n,r)),c})}function N_(t,s){const n=window.location.pathname.replace(s,"").replace("/","").replace("edit/","");return n===""?t.find(r=>r.index===0&&r.parent===""):t.find((r,a)=>r.url_slug===n||r.id===n)}function pf(t,s){var l,i;const n=N_(t,s),r=t.filter(c=>c.parent===(n==null?void 0:n.id)).length;return(n?(i=(l=n.url_slug)==null?void 0:l.split("/"))==null?void 0:i.length:1)+(r?1:0)}function rl(t,s="",n=!1){return t.sort((r,a)=>r.index-a.index).filter(r=>!r.parent).filter(r=>n||r.published!=="draft").map((r,a)=>{let l={id:r.id,path:`${n?`${s}/edit`:s}/${r.url_slug||r.id}`,name:`${r.title} ${r.published==="draft"?"*":""}`,hideInNav:r.hide_in_nav};return No(l,t,s,n)&&(l.subMenus=No(r,t,s,n)),l})}const _a=(t,s="update")=>{let n=new FormData;return n.append("data",JSON.stringify(t)),n.append("requestType",s),n},C_=(t,s)=>t.parent?`${s.filter(r=>r.id===t.parent)[0].url_slug}/`:"",pn=(t,s)=>{let n=`${C_(t,s)}${__(t.title)}`;return t.url_slug&&t.url_slug===n||!s.map(r=>r.url_slug).includes(n)?n:`${n}_${t.index}`},__=t=>t&&t.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g).map(s=>s.toLowerCase()).join("_"),S_=t=>{var s;return t?typeof t=="object"?t:(s=JSON.parse(t))==null?void 0:s.text:{}};function hf(t,s){const n=t;return{menuItems:((n==null?void 0:n.sections)||[]).reduce((a,{title:l,element:i,level:c="1",...d})=>{var p,m,h;if(!i||!l||c==="0")return a;const u=i["element-type"]==="lexical"||!i["element-type"]?(h=(m=(p=S_(i["element-data"]))==null?void 0:p.root)==null?void 0:m.children)==null?void 0:h.reduce((f,{type:g,tag:x,children:y,...j})=>{var _,E,L,S;const N=g==="heading"&&((E=(_=y[0])==null?void 0:_.text)!=null&&E.length)?[{name:(L=y[0])==null?void 0:L.text,onClick:k=>{const $=[...window.document.querySelectorAll(x)].find(I=>{var T,A;return((T=I==null?void 0:I.children[0])==null?void 0:T.innerHTML)===((A=y[0])==null?void 0:A.text)});$==null||$.scrollIntoView({behavior:"smooth"})},className:`pl-2 pr-4 pb-1 text-sm text-slate-400 hover:text-slate-700 cursor-pointer border-r-2 mr-4
                            ${((S=[...window.document.querySelectorAll(x)].find(k=>{var $,I;return(($=k==null?void 0:k.children[0])==null?void 0:$.innerHTML)===((I=y[0])==null?void 0:I.text)}))==null?void 0:S.offsetParent)===null?"text-blue-200":""}`}]:[];return[...f,...N]},[]):[];return[...a,{name:l,onClick:f=>{const g=window.document.getElementById(`#${l==null?void 0:l.replace(/ /g,"_")}`);g==null||g.scrollIntoView({behavior:"smooth"})},className:s==null?void 0:s.levelClasses[c]},...u||[]]},[]),themeOptions:{size:"full",color:"transparent"}}}const ff=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M16.2141 4.98239L17.6158 3.58063C18.39 2.80646 19.6452 2.80646 20.4194 3.58063C21.1935 4.3548 21.1935 5.60998 20.4194 6.38415L19.0176 7.78591M16.2141 4.98239L10.9802 10.2163C9.93493 11.2616 9.41226 11.7842 9.05637 12.4211C8.70047 13.058 8.3424 14.5619 8 16C9.43809 15.6576 10.942 15.2995 11.5789 14.9436C12.2158 14.5877 12.7384 14.0651 13.7837 13.0198L19.0176 7.78591M16.2141 4.98239L19.0176 7.78591",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21 12C21 16.2426 21 18.364 19.682 19.682C18.364 21 16.2426 21 12 21C7.75736 21 5.63604 21 4.31802 19.682C3 18.364 3 16.2426 3 12C3 7.75736 3 5.63604 4.31802 4.31802C5.63604 3 7.75736 3 12 3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),gf=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M21.544 11.045C21.848 11.4713 22 11.6845 22 12C22 12.3155 21.848 12.5287 21.544 12.955C20.1779 14.8706 16.6892 19 12 19C7.31078 19 3.8221 14.8706 2.45604 12.955C2.15201 12.5287 2 12.3155 2 12C2 11.6845 2.15201 11.4713 2.45604 11.045C3.8221 9.12944 7.31078 5 12 5C16.6892 5 20.1779 9.12944 21.544 11.045Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15C13.6569 15 15 13.6569 15 12Z",stroke:"currentColor",strokeWidth:"1.5"})]}),xf=({size:t=24,className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:t,height:t,color:"#000000",fill:"none",className:s,children:[e.jsx("path",{d:"M15.2141 5.98239L16.6158 4.58063C17.39 3.80646 18.6452 3.80646 19.4194 4.58063C20.1935 5.3548 20.1935 6.60998 19.4194 7.38415L18.0176 8.78591M15.2141 5.98239L6.98023 14.2163C5.93493 15.2616 5.41226 15.7842 5.05637 16.4211C4.70047 17.058 4.3424 18.5619 4 20C5.43809 19.6576 6.94199 19.2995 7.57889 18.9436C8.21579 18.5877 8.73844 18.0651 9.78375 17.0198L18.0176 8.78591M15.2141 5.98239L18.0176 8.78591",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11 20H17",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),bf=({className:t,...s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,...s,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),Rc=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M2.5 12C2.5 7.52166 2.5 5.28249 3.89124 3.89124C5.28249 2.5 7.52166 2.5 12 2.5C16.4783 2.5 18.7175 2.5 20.1088 3.89124C21.5 5.28249 21.5 7.52166 21.5 12C21.5 16.4783 21.5 18.7175 20.1088 20.1088C18.7175 21.5 16.4783 21.5 12 21.5C7.52166 21.5 5.28249 21.5 3.89124 20.1088C2.5 18.7175 2.5 16.4783 2.5 12Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 8V16M16 12H8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),yf=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M20.3584 13.3567C19.1689 14.546 16.9308 14.4998 13.4992 14.4998C11.2914 14.4998 9.50138 12.7071 9.50024 10.4993C9.50024 7.07001 9.454 4.83065 10.6435 3.64138C11.8329 2.45212 12.3583 2.50027 17.6274 2.50027C18.1366 2.49809 18.3929 3.11389 18.0329 3.47394L15.3199 6.18714C14.6313 6.87582 14.6294 7.99233 15.3181 8.68092C16.0068 9.36952 17.1234 9.36959 17.8122 8.68109L20.5259 5.96855C20.886 5.60859 21.5019 5.86483 21.4997 6.37395C21.4997 11.6422 21.5479 12.1675 20.3584 13.3567Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M13.5 14.5L7.32842 20.6716C6.22386 21.7761 4.433 21.7761 3.32843 20.6716C2.22386 19.567 2.22386 17.7761 3.32843 16.6716L9.5 10.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M5.50896 18.5H5.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),vf=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M4 5.00024L10 5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M13 5L20 5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M16 9L16 15",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M10 2L10 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M12 16L12 22",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M16 12L20 12.0002",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M4 12.0002L13 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M12 19L20 19",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M4 19.0002L9 19",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),jf=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M4 4.5L20 4.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M4 14.5L20 14.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M4 9.5L20 9.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M4 19.5L20 19.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),wf=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M12 22C6.47711 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C16.4776 2 20.2257 4.94289 21.5 9H19",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 8V12L14 14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21.9551 13C21.9848 12.6709 22 12.3373 22 12M15 22C15.3416 21.8876 15.6753 21.7564 16 21.6078M20.7906 17C20.9835 16.6284 21.1555 16.2433 21.305 15.8462M18.1925 20.2292C18.5369 19.9441 18.8631 19.6358 19.1688 19.3065",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),$_=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M12.2422 17V12C12.2422 11.5286 12.2422 11.2929 12.0957 11.1464C11.9493 11 11.7136 11 11.2422 11",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11.992 8H12.001",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Nf=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M19.5 5.5L18.8803 15.5251C18.7219 18.0864 18.6428 19.3671 18.0008 20.2879C17.6833 20.7431 17.2747 21.1273 16.8007 21.416C15.8421 22 14.559 22 11.9927 22C9.42312 22 8.1383 22 7.17905 21.4149C6.7048 21.1257 6.296 20.7408 5.97868 20.2848C5.33688 19.3626 5.25945 18.0801 5.10461 15.5152L4.5 5.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M3 5.5H21M16.0557 5.5L15.3731 4.09173C14.9196 3.15626 14.6928 2.68852 14.3017 2.39681C14.215 2.3321 14.1231 2.27454 14.027 2.2247C13.5939 2 13.0741 2 12.0345 2C10.9688 2 10.436 2 9.99568 2.23412C9.8981 2.28601 9.80498 2.3459 9.71729 2.41317C9.32164 2.7167 9.10063 3.20155 8.65861 4.17126L8.05292 5.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M9.5 16.5L9.5 10.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M14.5 16.5L14.5 10.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),Cf=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M16 12L8 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M4.64856 5.07876C4.78691 4.93211 4.92948 4.7895 5.0761 4.65111M7.94733 2.72939C8.12884 2.6478 8.31313 2.57128 8.5 2.5M2.73172 7.94192C2.64925 8.12518 2.57195 8.31127 2.5 8.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Fc=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,fill:"none",...t,children:[e.jsx("path",{d:"M2.75 12C2.75 17.5228 7.22715 22 12.75 22C18.2728 22 22.75 17.5228 22.75 12C22.75 6.47714 18.2728 1.99998 12.75 1.99998",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M5.39856 5.07874C5.53691 4.9321 5.67948 4.78948 5.8261 4.65109M8.69733 2.72938C8.87884 2.64779 9.06313 2.57126 9.25 2.49998M3.48172 7.94191C3.39925 8.12517 3.32195 8.31126 3.25 8.49999",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M15.75 9L12.75 12M12.75 12L9.75 15M12.75 12L15.75 15M12.75 12L9.75 9",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),_f=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M8 22V19C8 17.1144 8 16.1716 8.58579 15.5858C9.17157 15 10.1144 15 12 15C13.8856 15 14.8284 15 15.4142 15.5858C16 16.1716 16 17.1144 16 19V22",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),e.jsx("path",{d:"M10 7H14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M3 11.8584C3 7.28199 3 4.99376 4.38674 3.54394C4.43797 3.49038 4.49038 3.43797 4.54394 3.38674C5.99376 2 8.28199 2 12.8584 2C13.943 2 14.4655 2.00376 14.9628 2.18936C15.4417 2.3681 15.8429 2.70239 16.6452 3.37099L18.8411 5.20092C19.9027 6.08561 20.4335 6.52795 20.7168 7.13266C21 7.73737 21 8.42833 21 9.81025V13C21 16.7497 21 18.6246 20.0451 19.9389C19.7367 20.3634 19.3634 20.7367 18.9389 21.0451C17.6246 22 15.7497 22 12 22C8.25027 22 6.3754 22 5.06107 21.0451C4.6366 20.7367 4.26331 20.3634 3.95491 19.9389C3 18.6246 3 16.7497 3 13V11.8584Z",stroke:"currentColor",strokeWidth:"1.5"})]}),E_=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("path",{d:"M4.64856 5.07876C4.7869 4.93211 4.92948 4.7895 5.0761 4.65111M7.94733 2.72939C8.12884 2.6478 8.31313 2.57128 8.5 2.5M2.5 8.5C2.57195 8.31127 2.64925 8.12518 2.73172 7.94192",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 8V16M16 12L8 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ni=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M16.2141 4.98239L17.6158 3.58063C18.39 2.80646 19.6452 2.80646 20.4194 3.58063C21.1935 4.3548 21.1935 5.60998 20.4194 6.38415L19.0176 7.78591M16.2141 4.98239L10.9802 10.2163C9.93493 11.2616 9.41226 11.7842 9.05637 12.4211C8.70047 13.058 8.3424 14.5619 8 16C9.43809 15.6576 10.942 15.2995 11.5789 14.9436C12.2158 14.5877 12.7384 14.0651 13.7837 13.0198L19.0176 7.78591M16.2141 4.98239L19.0176 7.78591",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21 12C21 16.2426 21 18.364 19.682 19.682C18.364 21 16.2426 21 12 21C7.75736 21 5.63604 21 4.31802 19.682C3 18.364 3 16.2426 3 12C3 7.75736 3 5.63604 4.31802 4.31802C5.63604 3 7.75736 3 12 3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),k_=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M9.5 13.5C9.99153 14.0057 11.2998 16 12 16M14.5 13.5C14.0085 14.0057 12.7002 16 12 16M12 16V8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2.5 12C2.5 7.52166 2.5 5.28249 3.89124 3.89124C5.28249 2.5 7.52166 2.5 12 2.5C16.4783 2.5 18.7175 2.5 20.1088 3.89124C21.5 5.28249 21.5 7.52166 21.5 12C21.5 16.4783 21.5 18.7175 20.1088 20.1088C18.7175 21.5 16.4783 21.5 12 21.5C7.52166 21.5 5.28249 21.5 3.89124 20.1088C2.5 18.7175 2.5 16.4783 2.5 12Z",stroke:"currentColor",strokeWidth:"1.5"})]}),L_=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M9.5 10.5C9.99153 9.9943 11.2998 8 12 8M14.5 10.5C14.0085 9.9943 12.7002 8 12 8M12 8V16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2.5 12C2.5 7.52166 2.5 5.28249 3.89124 3.89124C5.28249 2.5 7.52166 2.5 12 2.5C16.4783 2.5 18.7175 2.5 20.1088 3.89124C21.5 5.28249 21.5 7.52166 21.5 12C21.5 16.4783 21.5 18.7175 20.1088 20.1088C18.7175 21.5 16.4783 21.5 12 21.5C7.52166 21.5 5.28249 21.5 3.89124 20.1088C2.5 18.7175 2.5 16.4783 2.5 12Z",stroke:"currentColor",strokeWidth:"1.5"})]}),Sf=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M2.5 12C2.5 7.52166 2.5 5.28249 3.89124 3.89124C5.28249 2.5 7.52166 2.5 12 2.5C16.4783 2.5 18.7175 2.5 20.1088 3.89124C21.5 5.28249 21.5 7.52166 21.5 12C21.5 16.4783 21.5 18.7175 20.1088 20.1088C18.7175 21.5 16.4783 21.5 12 21.5C7.52166 21.5 5.28249 21.5 3.89124 20.1088C2.5 18.7175 2.5 16.4783 2.5 12Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M17 10C17 10 13.3176 14 12 14C10.6824 14 7 10 7 10",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),$f=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M2.5 12C2.5 7.52166 2.5 5.28249 3.89124 3.89124C5.28249 2.5 7.52166 2.5 12 2.5C16.4783 2.5 18.7175 2.5 20.1088 3.89124C21.5 5.28249 21.5 7.52166 21.5 12C21.5 16.4783 21.5 18.7175 20.1088 20.1088C18.7175 21.5 16.4783 21.5 12 21.5C7.52166 21.5 5.28249 21.5 3.89124 20.1088C2.5 18.7175 2.5 16.4783 2.5 12Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M17 14C17 14 13.3176 10 12 10C10.6824 9.99999 7 14 7 14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Vc=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M2.5 12C2.5 7.52166 2.5 5.28249 3.89124 3.89124C5.28249 2.5 7.52166 2.5 12 2.5C16.4783 2.5 18.7175 2.5 20.1088 3.89124C21.5 5.28249 21.5 7.52166 21.5 12C21.5 16.4783 21.5 18.7175 20.1088 20.1088C18.7175 21.5 16.4783 21.5 12 21.5C7.52166 21.5 5.28249 21.5 3.89124 20.1088C2.5 18.7175 2.5 16.4783 2.5 12Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M12.2422 17V12C12.2422 11.5286 12.2422 11.2929 12.0957 11.1464C11.9493 11 11.7136 11 11.2422 11",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11.992 8H12.001",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ef=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M11.992 12H12.001",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11.9842 16H11.9932",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11.9998 8H12.0088",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2.48438 12C2.48438 7.52166 2.48438 5.28249 3.87562 3.89124C5.26686 2.5 7.50603 2.5 11.9844 2.5C16.4627 2.5 18.7019 2.5 20.0931 3.89124C21.4844 5.28249 21.4844 7.52166 21.4844 12C21.4844 16.4783 21.4844 18.7175 20.0931 20.1088C18.7019 21.5 16.4627 21.5 11.9844 21.5C7.50603 21.5 5.26686 21.5 3.87562 20.1088C2.48438 18.7175 2.48438 16.4783 2.48438 12Z",stroke:"currentColor",strokeWidth:"1.5"})]}),I_=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M12 2C17.5237 2 22 6.47778 22 12C22 17.5222 17.5237 22 12 22",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 21.5C7.81163 21.0953 6.69532 20.5107 5.72302 19.7462M5.72302 4.25385C6.69532 3.50059 7.81163 2.90473 9 2.5M2 10.2461C2.21607 9.08813 2.66019 7.96386 3.29638 6.94078M2 13.7539C2.21607 14.9119 2.66019 16.0361 3.29638 17.0592",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M8 16.5C10.0726 14.302 13.9051 14.1986 16 16.5M14.2179 9.75C14.2179 10.9926 13.2215 12 11.9925 12C10.7634 12 9.76708 10.9926 9.76708 9.75C9.76708 8.50736 10.7634 7.5 11.9925 7.5C13.2215 7.5 14.2179 8.50736 14.2179 9.75Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),T_=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"#fff",...t,children:[e.jsx("path",{d:"M6.57757 15.4816C5.1628 16.324 1.45336 18.0441 3.71266 20.1966C4.81631 21.248 6.04549 22 7.59087 22H16.4091C17.9545 22 19.1837 21.248 20.2873 20.1966C22.5466 18.0441 18.8372 16.324 17.4224 15.4816C14.1048 13.5061 9.89519 13.5061 6.57757 15.4816Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M16.5 6.5C16.5 8.98528 14.4853 11 12 11C9.51472 11 7.5 8.98528 7.5 6.5C7.5 4.01472 9.51472 2 12 2C14.4853 2 16.5 4.01472 16.5 6.5Z",stroke:"currentColor",strokeWidth:"1.5"})]}),Hc=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:[e.jsx("circle",{cx:"1.5",cy:"1.5",r:"1.5",transform:"matrix(1 0 0 -1 16 8)",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2.77423 11.1439C1.77108 12.2643 1.7495 13.9546 2.67016 15.1437C4.49711 17.5033 6.49674 19.5029 8.85633 21.3298C10.0454 22.2505 11.7357 22.2289 12.8561 21.2258C15.8979 18.5022 18.6835 15.6559 21.3719 12.5279C21.6377 12.2187 21.8039 11.8397 21.8412 11.4336C22.0062 9.63798 22.3452 4.46467 20.9403 3.05974C19.5353 1.65481 14.362 1.99377 12.5664 2.15876C12.1603 2.19608 11.7813 2.36233 11.472 2.62811C8.34412 5.31646 5.49781 8.10211 2.77423 11.1439Z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M7 14L10 17",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),kf=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:e.jsx("path",{d:"M17.9998 15C17.9998 15 13.5809 9.00001 11.9998 9C10.4187 8.99999 5.99985 15 5.99985 15",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),Lf=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,color:"#000000",fill:"none",...t,children:e.jsx("path",{d:"M18 9.00005C18 9.00005 13.5811 15 12 15C10.4188 15 6 9 6 9",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),If=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:16,height:16,color:"#000000",fill:"none",...t,children:[e.jsx("title",{children:t.title}),e.jsx("path",{d:"M16.9637 8.98209C16.9613 6.03194 16.9167 4.50384 16.0578 3.45753C15.892 3.25546 15.7067 3.07019 15.5047 2.90436C14.4008 1.99854 12.7609 1.99854 9.48087 1.99854C6.20089 1.99854 4.5609 1.99854 3.45708 2.90436C3.255 3.07018 3.06971 3.25546 2.90387 3.45753C1.99799 4.56128 1.99799 6.20116 1.99799 9.48091C1.99799 12.7607 1.99799 14.4005 2.90387 15.5043C3.0697 15.7063 3.255 15.8916 3.45708 16.0574C4.50346 16.9162 6.03167 16.9608 8.98201 16.9632",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M14.0283 9.02455L16.994 8.98193M14.0143 22.0013L16.9799 21.9586M21.9716 14.0221L21.9436 16.9818M9.01033 14.0357L8.98236 16.9953M11.4873 9.02455C10.6545 9.17371 9.31781 9.32713 9.01033 11.0488M19.4946 21.9586C20.3296 21.8223 21.6685 21.6894 22.0025 19.9726M19.4946 9.02455C20.3274 9.17371 21.6641 9.32713 21.9716 11.0488M11.5 21.9573C10.6672 21.8086 9.33039 21.6559 9.02197 19.9344",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),M_=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:16,height:16,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M12 14.5L12 4.5M12 14.5C11.2998 14.5 9.99153 12.5057 9.5 12M12 14.5C12.7002 14.5 14.0085 12.5057 14.5 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M20 16.5C20 18.982 19.482 19.5 17 19.5H7C4.518 19.5 4 18.982 4 16.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Tf=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:18,height:18,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M19 11C19 10.1825 19 9.4306 18.8478 9.06306C18.6955 8.69552 18.4065 8.40649 17.8284 7.82843L13.0919 3.09188C12.593 2.593 12.3436 2.34355 12.0345 2.19575C11.9702 2.165 11.9044 2.13772 11.8372 2.11401C11.5141 2 11.1614 2 10.4558 2C7.21082 2 5.58831 2 4.48933 2.88607C4.26731 3.06508 4.06508 3.26731 3.88607 3.48933C3 4.58831 3 6.21082 3 9.45584V14C3 17.7712 3 19.6569 4.17157 20.8284C5.34315 22 7.22876 22 11 22H19M12 2.5V3C12 5.82843 12 7.24264 12.8787 8.12132C13.7574 9 15.1716 9 18 9H18.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21 14H19C18.4477 14 18 14.4477 18 15V16.5M18 16.5V19M18 16.5H20.5M7 19V17M7 17V14H8.5C9.32843 14 10 14.6716 10 15.5C10 16.3284 9.32843 17 8.5 17H7ZM12.5 14H13.7857C14.7325 14 15.5 14.7462 15.5 15.6667V17.3333C15.5 18.2538 14.7325 19 13.7857 19H12.5V14Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),B_=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:18,height:18,color:"#000000",fill:"none",...t,children:[e.jsx("path",{d:"M7.35396 18C5.23084 18 4.16928 18 3.41349 17.5468C2.91953 17.2506 2.52158 16.8271 2.26475 16.3242C1.87179 15.5547 1.97742 14.5373 2.18868 12.5025C2.36503 10.8039 2.45321 9.95455 2.88684 9.33081C3.17153 8.92129 3.55659 8.58564 4.00797 8.35353C4.69548 8 5.58164 8 7.35396 8H16.646C18.4184 8 19.3045 8 19.992 8.35353C20.4434 8.58564 20.8285 8.92129 21.1132 9.33081C21.5468 9.95455 21.635 10.8039 21.8113 12.5025C22.0226 14.5373 22.1282 15.5547 21.7352 16.3242C21.4784 16.8271 21.0805 17.2506 20.5865 17.5468C19.8307 18 18.7692 18 16.646 18",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M17 8V6C17 4.11438 17 3.17157 16.4142 2.58579C15.8284 2 14.8856 2 13 2H11C9.11438 2 8.17157 2 7.58579 2.58579C7 3.17157 7 4.11438 7 6V8",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),e.jsx("path",{d:"M13.9887 16L10.0113 16C9.32602 16 8.98337 16 8.69183 16.1089C8.30311 16.254 7.97026 16.536 7.7462 16.9099C7.57815 17.1904 7.49505 17.5511 7.32884 18.2724C7.06913 19.3995 6.93928 19.963 7.02759 20.4149C7.14535 21.0174 7.51237 21.5274 8.02252 21.7974C8.40513 22 8.94052 22 10.0113 22L13.9887 22C15.0595 22 15.5949 22 15.9775 21.7974C16.4876 21.5274 16.8547 21.0174 16.9724 20.4149C17.0607 19.963 16.9309 19.3995 16.6712 18.2724C16.505 17.5511 16.4218 17.1904 16.2538 16.9099C16.0297 16.536 15.6969 16.254 15.3082 16.1089C15.0166 16 14.674 16 13.9887 16Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),e.jsx("path",{d:"M18 12H18.009",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Co={PencilEditSquare:ff,ViewIcon:gf,PencilIcon:xf,CirclePlus:bf,SquarePlus:Rc,WrenchIcon:yf,SlidersIcon:vf,MenuIcon:jf,ClockIcon:wf,InfoCircle:$_,TrashCan:Nf,RemoveCircle:Cf,CancelCircle:Fc,FloppyDisk:_f,CirclePlusDot:E_,PencilSquare:Ni,ArrowDownSquare:k_,ArrowUpSquare:L_,ChevronDownSquare:Sf,ChevronUpSquare:$f,InfoSquare:Vc,MoreSquare:Ef,UserCircle:I_,User:T_,Tags:Hc,ArrowUp:kf,ArrowDown:Lf,Copy:If,PDF:Tf,Printer:B_};function Cu({icon:t,className:s}){let n="";if(!t||t!=null&&t.includes("fa"))n=e.jsx("span",{className:t});else{let r=Co[t];n=e.jsx(r,{})}return e.jsx("div",{className:`${s} flex justify-center items-center`,children:n})}const ol=({i:t=0,children:s,icon:n,to:r,onClick:a,className:l=null,type:i="side",active:c=!1,subMenus:d=[],themeOptions:u,subMenuActivate:p="onClick",subMenuOpen:m=!1})=>{const{theme:h}=w.useContext(ke)||{},f=(h==null?void 0:h[i==="side"?"sidenav":"topnav"])||{},g=$e(),x=w.useMemo(()=>Array.isArray(r)?r:[r],[r]),y=w.useMemo(()=>{const T=d.reduce((A,R)=>(Array.isArray(R.path)?A.push(...R.path):R.path&&A.push(R.path),A),[]);return[...x,...T]},[x,d]),j=!!pc({path:`${y[0]}/*`||"",end:!0}),N=i==="side"?f==null?void 0:f.navitemSide:f==null?void 0:f.navitemTop,_=i==="side"?f==null?void 0:f.navitemSideActive:f==null?void 0:f.navitemTopActive,E=j||c,L=E?_:N,[S,k]=w.useState(m||j),[$,I]=w.useState(!1);return b.useEffect(()=>{k(j)},[j,S,r]),e.jsx("div",{className:i==="side"?f==null?void 0:f.subMenuParentWrapper:null,onMouseOutCapture:()=>p==="onHover"&&k(!1)||p!=="onHover"&&I(!1)&&k(!1),onMouseMove:()=>p==="onHover"&&k(!0)||p!=="onHover"&&I(!0)&&k(!0),children:e.jsx("div",{className:`${l||L}`,onClick:T=>{if(T.stopPropagation(),a)return a(x[0]);x[0]&&g(x[0])},children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-1 flex",children:[n?e.jsx(Cu,{icon:n,className:i==="side"?E?f==null?void 0:f.menuIconSideActive:f==null?void 0:f.menuIconSide:E?f==null?void 0:f.menuIconTopActive:f==null?void 0:f.menuIconTop}):null,e.jsx("div",{className:f==null?void 0:f.navItemContent,children:s})]}),e.jsx("div",{onClick:()=>{p==="onClick"&&k(!S)},children:d.length?e.jsx(Cu,{icon:S?f==null?void 0:f.indicatorIconOpen:f==null?void 0:f.indicatorIcon}):null}),d.length?e.jsx(A_,{i:t,showSubMenu:S,subMenuActivate:p,active:j,hovering:$,subMenus:d,type:i,themeOptions:u,className:l}):""]})})})},A_=({i:t,showSubMenu:s,subMenus:n,type:r,hovering:a,subMenuActivate:l,active:i,themeOptions:c})=>{const{theme:d}=w.useContext(ke),u=(d==null?void 0:d[r==="side"?"sidenav":"topnav"])||{},p=!i&&l!=="onHover"&&a;return(!s||!n.length)&&!p?null:e.jsx("div",{className:r==="side"?u==null?void 0:u.subMenuWrapper:p&&t===0?u==null?void 0:u.subMenuWrapperInactiveFlyout:p&&t>0?u==null?void 0:u.subMenuWrapperInactiveFlyoutBelow:u==null?void 0:u.subMenuWrapperTop,children:e.jsx("div",{className:`
							${p&&(u==null?void 0:u.subMenuWrapperInactiveFlyoutDirection)}
							${!p&&(u==null?void 0:u.subMenuWrapperChild)}
					flex ${r==="side"||p?"flex-col":"flex-row"}
				`,children:n.map((m,h)=>e.jsx(ol,{i:h+1,to:m.path,icon:m.icon,type:r,className:m.className,onClick:m.onClick,themeOptions:c,subMenus:m.subMenus,children:m.name},h))})})},Mf=({open:t,toggle:s,menuItems:n=[],rightMenu:r=null,themeOptions:a={}})=>{const{theme:l}=w.useContext(ke)||{},i=(l==null?void 0:l.topnav)||{};return e.jsxs("div",{className:`${t?"md:hidden":"hidden"} ${i==null?void 0:i.topnavMobileContainer}`,id:"mobile-menu",children:[e.jsx("div",{className:"",children:n.map((c,d)=>e.jsx(ol,{type:"top",to:c.path,icon:c.icon,themeOptions:a,subMenus:C(c,"subMenus",[]),children:c.name},d))}),e.jsx("div",{className:"",children:r})]})},O_=({open:t,toggle:s,menuItems:n=[],rightMenu:r=null,leftMenu:a=null,subMenuActivate:l,themeOptions:i={}})=>{const{theme:c}=w.useContext(ke)||{},d=(c==null?void 0:c.topnav)||{};return e.jsx("div",{className:`${d==null?void 0:d.topnavWrapper}`,children:e.jsxs("div",{className:`${d==null?void 0:d.topnavContent} justify-between`,children:[e.jsx("div",{children:a}),e.jsx("div",{className:`${d==null?void 0:d.topnavMenu}`,children:n.map((u,p)=>e.jsx(ol,{type:"top",to:u.path,icon:u.icon,subMenuActivate:l,themeOptions:i,subMenus:C(u,"subMenus",[]),children:u.name},p))}),e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:`${d==null?void 0:d.topmenuRightNavContainer}`,children:r}),e.jsxs("button",{type:"button",className:`${d==null?void 0:d.mobileButton}`,onClick:()=>s(!t),children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),e.jsx("div",{className:"flex justify-center items-center text-2xl",children:e.jsx("span",{className:t?d==null?void 0:d.menuCloseIcon:d==null?void 0:d.menuOpenIcon})})]})]})]})})},P_=({...t})=>{const[s,n]=b.useState(!1);return e.jsxs("nav",{children:[e.jsx(O_,{open:s,toggle:n,...t}),e.jsx(Mf,{open:s,...t})]})},Bf=({i:t,item:s,themeOptions:n,subMenuActivate:r})=>e.jsx(ol,{to:s.path,icon:s.icon,className:s.className,onClick:s.onClick,themeOptions:n,subMenuActivate:r,subMenus:C(s,"subMenus",[]),children:s.name},t),D_=({open:t,toggle:s,logo:n=null,topMenu:r,menuItems:a=[],bottomMenu:l,themeOptions:i={},subMenuActivate:c,subMenuStyle:d,...u})=>{const{theme:p}=w.useContext(ke)||{},m=(p==null?void 0:p.sidenav)||{};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:hidden",onClick:()=>s(!t),children:e.jsx("span",{className:t?m==null?void 0:m.menuIconOpen:m==null?void 0:m.menuIconClosed})}),e.jsxs("div",{style:{display:t?"block":"none"},className:"md:hidden",children:[e.jsx("div",{className:"fixed inset-0 z-20 transition-opacity ease-linear duration-300",children:e.jsx("div",{className:"absolute inset-0 opacity-75"})}),e.jsx("div",{className:`fixed inset-0 flex z-40 ${m==null?void 0:m.contentBgAccent}`,children:e.jsxs("div",{className:`flex-1 flex flex-col max-w-xs w-full transform ease-in-out duration-300 ${m==null?void 0:m.contentBg}`,children:[e.jsx("div",{className:"absolute top-0 right-0 -mr-14 p-1",children:e.jsx("button",{onClick:()=>s(!t),className:"flex items-center justify-center h-12 w-12 rounded-full focus:outline-none focus:bg-gray-600 os-icon os-icon-x"})}),e.jsxs("div",{className:"flex-1 h-0 border border-orange-400 pt-2 pb-4 overflow-y-auto overflow-x-hidden flex",children:[e.jsx("div",{children:r}),e.jsx("nav",{className:"flex-1 ",children:a.map((h,f)=>e.jsx("div",{className:h.sectionClass,children:Bf({i:f,page:h,themeOptions:i,subMenuActivate:c})},f))}),e.jsx("div",{children:l})]})]})})]})]})},R_=({menuItems:t=[],logo:s=null,topMenu:n,bottomMenu:r,toggle:a,open:l,mobile:i,themeOptions:c={},subMenuActivate:d,subMenuStyle:u,...p})=>{const{theme:m}=w.useContext(ke),h=(m==null?void 0:m.sidenav)||{};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${h==null?void 0:h.sidenavWrapper}`,children:[n,e.jsx("nav",{className:`${h==null?void 0:h.itemsWrapper}`,children:t.map((f,g)=>Bf({i:g,item:f,themeOptions:c,subMenuActivate:d}))}),r]}),i==="side"?"":e.jsx("div",{className:`${h==null?void 0:h.topnavWrapper} md:hidden`,children:e.jsxs("div",{className:`${h==null?void 0:h.topnavContent} justify-between`,children:[e.jsx("div",{children:n}),e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:`${h==null?void 0:h.topmenuRightNavContainer}`,children:r}),e.jsxs("button",{type:"button",className:h==null?void 0:h.mobileButton,onClick:()=>a(!l),children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),e.jsx("div",{className:"flex justify-center items-center text-2xl",children:e.jsx("span",{className:l?h==null?void 0:h.menuCloseIcon:h==null?void 0:h.menuOpenIcon})})]})]})]})})]})},zc=t=>{const[s,n]=b.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(R_,{...t,open:s,toggle:n}),t.mobile==="side"?e.jsx(D_,{open:s,toggle:n,...t}):e.jsx(Mf,{open:s,...t,themeOptions:{}})]})},Af={tags:"byTag",page_title:"byPageTitle"},Of=({value:t,baseUrl:s,type:n="tags"})=>!s||s===""?`/search/?q=${t}&type=${n}`:`/${s}/search/?q=${t}&type=${n}`,_o=(t,s)=>{const n=new RegExp(`(${s})`,"gi");return t.filter(r=>r).reduce((r,a)=>a.toLowerCase()===s.toLowerCase()?r+1:n.test(a)?r+.5:r,0)},da=(t,s)=>{if(!s)return t;const n=t.split(new RegExp(`(${s})`,"gi"));return e.jsx(e.Fragment,{children:n.map((r,a)=>{var l,i;return r.toLowerCase()===s.toLowerCase()?e.jsx(w.Fragment,{children:e.jsxs("div",{className:"inline-block font-bold",children:[a>0&&((l=n[a-1])!=null&&l.endsWith(" "))?" ":"",r,a<n.length-1&&((i=r[a+1])!=null&&i.startsWith(" "))?" ":""]})},a):r})})},F_=({individualTags:t,query:s,setQuery:n,navigate:r,baseUrl:a})=>t.filter(l=>!(s!=null&&s.length)||l.toLowerCase().includes(s.toLowerCase())).length>0&&e.jsxs("div",{className:"max-h-96 scroll-py-3 overflow-y-auto p-3 flex items-center",children:[e.jsx("span",{className:"text-xs italic",children:"suggestions: "}),e.jsx("div",{className:"flex",children:t.filter(l=>!(s!=null&&s.length)||l.toLowerCase().includes(s.toLowerCase())).filter((l,i)=>i<=5).map(l=>e.jsx("div",{onClick:()=>{n&&n(l),r&&r(Of({value:l,baseUrl:a}))},className:"mx-0.5 cursor-pointer rounded-xl py-0.5 px-1.5 bg-gray-500 text-white text-xs",children:l},l))})]}),V_=({items:t,query:s,setQuery:n})=>e.jsx("div",{className:"max-h-[calc(100vh-150px)] scroll-py-3 overflow-y-auto overflow-x-hidden p-3 bg-slate-100 scrollbar-sm",children:Object.keys(t).sort((r,a)=>t[a].score-t[r].score).map(r=>e.jsxs("div",{className:"select-none rounded-xl p-3 bg-slate-10 hover:bg-slate-200 transition ease-in",children:[e.jsxs("div",{className:"group w-full flex items-center text-xl font-medium w-fit text-gray-700 hover:text-gray-700 cursor-pointer",onClick:a=>{n||(window.location=`${t[r].url}`)},children:[e.jsx(zh,{className:"flex items-center h-6 w-6 mr-2 border rounded-md"}),e.jsx("div",{children:da(t[r].page_title||r,s)}),e.jsx(vo,{className:"h-6 w-6 ml-2 text-transparent group-hover:text-gray-900"})]}),e.jsx("div",{className:"ml-3 pl-4 flex-auto border-l border-gray-900",children:e.jsx("div",{children:(t[r].sections||[]).map(({section_id:a,section_title:l,tags:i="",score:c})=>e.jsxs("div",{className:"w-full cursor-pointer group",onClick:()=>{n||(window.location=`${t[r].url}#${a}`)},children:[e.jsxs("div",{className:"w-full flex items-center text-md font-medium text-gray-700 hover:text-gray-700",children:[e.jsx(Uh,{className:"h-6 w-6 mr-2 border rounded-md"}),e.jsx("div",{children:da(l||a,s)}),e.jsx(vo,{className:"h-6 w-6 ml-2 text-transparent group-hover:text-gray-900"})]}),e.jsx("div",{className:"w-full ml-8",children:i==null?void 0:i.split(",").filter(d=>d&&d.length).map(d=>e.jsx("span",{className:`tracking-wide p-1 text-xs text-white font-semibold rounded-md border 
                                                ${d.toLowerCase()===s.toLowerCase()?"border-1 border-red-600 bg-red-400":"bg-red-300"}`,children:da(d,s)}))})]}))})})]},r))}),H_=({loading:t,query:s,itemsLen:n})=>t?e.jsxs("div",{className:"p-2 mx-auto w-1/4 h-full flex items-center justify-middle",children:[e.jsx("i",{className:"px-2 fa fa-loader text-gray-400"}),e.jsx("p",{className:"font-semibold text-gray-900",children:"Loading..."})]}):s&&s!==""&&n===0&&e.jsxs("div",{className:"px-6 py-14 text-center text-sm sm:px-14",children:[e.jsx("i",{className:"fa fa-exclamation mx-auto h-6 w-6 text-gray-400"}),e.jsx("p",{className:"mt-4 font-semibold text-gray-900",children:"No results found"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"No components found for this search term. Please try again."})]}),z_=({item:t,dataItems:s,format:n,attributes:r,logo:a,rightMenu:l})=>{var M;const i=$e(),[c]=Vn(),{baseUrl:d,theme:u,user:p,falcor:m,falcorCache:h,...f}=b.useContext(ke)||{},[g,x]=b.useState(!1),[y,j]=b.useState([]),[N,_]=b.useState([]),[E,L]=b.useState({}),[S,k]=b.useState(),[$,I]=b.useState(c.get("type")||"tags"),T=c.get("q"),A=n==null?void 0:n.app,R=n==null?void 0:n.type;gt.radio.EditComp;const O=w.useMemo(()=>rl(s,d,!1),[s]);return b.useEffect(()=>{async function D(){x(!0);const P=So({app:A,type:R,action:$==="tags"?"searchTags":"searchPageTitles"});return Ns(m,P,"/")}D().then(P=>{j(P.value.map(F=>F[$]).sort()),_([...new Set(P.value.reduce((F,B)=>[...F,...B[$].split(",")],[]))].sort()),x(!1)})},[$]),b.useEffect(()=>{if(!T)return;const D=setTimeout(()=>{x(!0);async function P(){const F=So({app:A,type:R,action:"search",tags:Array.isArray(T)?T:[T],searchType:Af[$]});return await Ns(m,F,"/")}P().then(F=>{L(F),x(!1)})},500);return()=>{clearTimeout(D)}},[T]),b.useEffect(()=>{var P,F;const D=(F=(P=E[T])==null?void 0:P.value)==null?void 0:F.reduce((B,{page_id:V,page_title:G,url_slug:Z,section_id:X,section_title:H,tags:z,...W})=>{var U,q;const Y=_o([...(H==null?void 0:H.split(" "))||[],...(z==null?void 0:z.split(","))||[]],T);return B[V]={page_title:G,url:`${d}/${Z}`,sections:[...((U=B[V])==null?void 0:U.sections)||[],{section_id:X,section_title:H,tags:z,score:Y}].sort((te,K)=>K.score-te.score),score:_o([G],T)+Y+(((q=B[V])==null?void 0:q.sections)||[]).reduce((te,K)=>te+(K.score||0),0)},B},{});k(D||{})},[E,T]),console.log("query",T,g,S),e.jsx(Nr,{navItems:O,children:e.jsxs("div",{className:`${(M=u==null?void 0:u.page)==null?void 0:M.wrapper1} ${u==null?void 0:u.navPadding[0]}`,children:[e.jsxs("div",{className:"w-full text-xl border-2 p-2 rounded-md",children:[e.jsx("input",{className:"w-full",placeholder:"Search...",value:T,onChange:D=>{i(Of({value:D.target.value,baseUrl:d,type:$}))},onKeyDown:()=>x(!0)}),e.jsx(F_,{individualTags:N,query:T,navigate:i,baseUrl:d})]}),S&&Object.keys(S).length?e.jsx(V_,{items:S,query:T}):e.jsx(H_,{query:T,loading:g,itemsLen:S&&Object.keys(S).length})]})})},Or=({app:t,type:s})=>{const[n,r]=b.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"bg-white p-1 h-10 border w-full flex items-center text-sm leading-6 text-slate-400 hover:text-slate-600 rounded-lg shadow-sm py-1.5 pl-4 pr-8 transition ease-in",onClick:()=>r(!0),children:[e.jsx("i",{className:"fa-light fa-search pr-2 "})," Search"]}),e.jsx(q_,{open:n,setOpen:r,app:t,type:s})]})};function U_(...t){return t.filter(Boolean).join(" ")}const W_=({individualTags:t,query:s,setQuery:n})=>t.filter(r=>!(s!=null&&s.length)||r.toLowerCase().includes(s.toLowerCase())).length>0?e.jsxs("div",{className:"flex items-center max-h-96 transform-gpu scroll-py-3 overflow-y-auto p-3",children:[e.jsx("span",{className:"text-xs italic",children:"suggestions: "}),t.filter(r=>!(s!=null&&s.length)||r.toLowerCase().includes(s.toLowerCase())).filter((r,a)=>a<=5).map(r=>e.jsx("div",{onClick:()=>n(r),className:"flex cursor-pointer select-none hover:bg-gray-100  rounded-xl p-1",children:e.jsxs("div",{children:[e.jsx("i",{className:"text-xs text-red-400 fa fa-tag"}),e.jsxs("span",{className:U_("ml-2 text-sm font-medium",focus?"text-gray-900":"text-gray-700"),children:[" ",r," "]})]})},r))]}):null,G_=({items:t,query:s})=>Object.keys(t).length?e.jsx("div",{className:"p-3 max-h-[500px] transform-gpu scroll-py-3 overflow-x-hidden overflow-y-auto scrollbar-sm",children:Object.keys(t).sort((n,r)=>t[r].score-t[n].score).map(n=>e.jsx("div",{className:"select-none rounded-xl m-1",children:e.jsxs("div",{className:"w-full select-none rounded-xl p-2 bg-slate-100 hover:bg-slate-200 transition ease-in",children:[e.jsxs("div",{className:"group w-full flex items-center text-xl font-medium text-gray-700 hover:text-gray-700 cursor-pointer",onClick:r=>{window.location=`${t[n].url}`},children:[e.jsx(zh,{className:"flex items-center h-6 w-6 mr-2 border rounded-md"}),e.jsx("div",{children:da(t[n].page_title||n,s)}),e.jsx(vo,{className:"h-6 w-6 ml-2 text-transparent group-hover:text-gray-900"})]}),e.jsx("div",{className:"ml-3 pl-4 flex-auto border-l border-gray-900",children:e.jsx("div",{children:(t[n].sections||[]).map(({section_id:r,section_title:a,tags:l="",score:i})=>e.jsxs("div",{className:"w-full cursor-pointer group",onClick:()=>window.location=`${t[n].url}#${r}`,children:[e.jsxs("div",{className:"w-full flex items-center text-md font-medium text-gray-700 hover:text-gray-700",children:[e.jsx(Uh,{className:"h-6 w-6 mr-2 border rounded-md"}),e.jsx("div",{children:da(a||r,s)}),e.jsx(vo,{className:"h-6 w-6 ml-2 text-transparent group-hover:text-gray-900"})]}),e.jsx("div",{className:"w-full ml-8",children:l==null?void 0:l.split(",").filter(c=>c&&c.length).map(c=>e.jsx("span",{className:`tracking-wide p-1 text-xs text-white font-semibold rounded-md border 
                                                ${c.toLowerCase()===s.toLowerCase()?"border-1 border-red-600 bg-red-400":"bg-red-300"}`,children:da(c,s)}))})]}))})})]},n)},n))}):null,J_=({loading:t,query:s,itemsLen:n})=>t?e.jsxs("div",{className:"p-2 mx-auto w-1/4 h-full flex items-center justify-middle",children:[e.jsx("i",{className:"px-2 fa fa-loader text-gray-400"}),e.jsx("p",{className:"font-semibold text-gray-900",children:"Loading..."})]}):s&&s!==""&&n===0&&e.jsxs("div",{className:"px-6 py-14 text-center text-sm sm:px-14",children:[e.jsx("i",{className:"fa fa-exclamation mx-auto h-6 w-6 text-gray-400"}),e.jsx("p",{className:"mt-4 font-semibold text-gray-900",children:"No results found"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"No components found for this search term. Please try again."})]}),q_=({open:t,setOpen:s,app:n,type:r})=>{const{baseUrl:a,falcor:l,falcorCache:i}=b.useContext(ke)||{},[c,d]=b.useState(),[u,p]=b.useState(),[m,h]=b.useState(!1),[f,g]=b.useState([]),[x,y]=b.useState([]),[j,N]=b.useState({}),[_,E]=b.useState({}),L="tags";return b.useEffect(()=>{const S=setTimeout(()=>{d(u)},500);return()=>{clearTimeout(S)}},[u]),b.useEffect(()=>{async function S(){h(!0);const k=So({app:n,type:r,action:"searchTags"});return Ns(l,k,"/")}S().then(k=>{g(k.value.map($=>$[L]).sort()),y([...new Set(k.value.reduce(($,I)=>[...$,...I[L].split(",")],[]))].sort()),h(!1)})},[]),b.useEffect(()=>{if(!c)return;h(!0);const S=So({app:n,type:r,action:"search",tags:Array.isArray(c)?c:[c],searchType:Af[L]});async function k(){return await Ns(l,S,"/")}k().then($=>{N($),h(!1)})},[c]),b.useEffect(()=>{function S(){var I,T,A,R;return(T=(I=j[c])==null?void 0:I.value)!=null&&T.length?(R=(A=j[c])==null?void 0:A.value)==null?void 0:R.reduce((O,{page_id:M,page_title:D,url_slug:P,section_id:F,section_title:B,tags:V,...G})=>{var X,H;const Z=_o([...(B==null?void 0:B.split(" "))||[],...(V==null?void 0:V.split(","))||[]],c);return O[M]={page_title:D,url:`${a}/${P}`,sections:[...((X=O[M])==null?void 0:X.sections)||[],{section_id:F,section_title:B,tags:V,score:Z}].sort((z,W)=>W.score-z.score),score:_o([D],c)+Z+(((H=O[M])==null?void 0:H.sections)||[]).reduce((z,W)=>z+(W.score||0),0)},O},{}):{}}const k=S();E(k)},[j,c]),e.jsx(Be.Root,{show:t,as:b.Fragment,afterLeave:()=>d(""),appear:!0,children:e.jsxs(Je,{as:"div",className:"relative z-20",onClose:s,children:[e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-25 transition-opacity"})}),e.jsx("div",{className:"fixed inset-0 z-20 w-screen overflow-y-auto p-4 sm:p-6 md:p-20",children:e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(di,{className:"mx-auto max-w-3xl max-h-3/4 transform divide-y divide-gray-100 overflow-hidden rounded-xl bg-white shadow-2xl ring-1 ring-black ring-opacity-5 transition-all",children:[e.jsxs("div",{className:"flex items-center relative px-2",children:[e.jsx("i",{className:"fa-light fa-search pointer-events-none h-5 w-5 text-gray-400"}),e.jsx(by,{autoFocus:!0,className:"h-10 w-full border-0 bg-transparent p-2 mx-1 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm rounded-md ring-0 outline-none",placeholder:"Search...",value:u,onChange:S=>{p(S.target.value)}}),e.jsx(je,{className:"fa-light fa-arrow-up-right-from-square h-5 w-5 text-gray-400",title:"Open Search Page",to:"search"})]}),e.jsx(W_,{tags:f,individualTags:x,query:u,setQuery:p}),e.jsx(G_,{items:_,query:c},"search-items"),e.jsx(J_,{query:c,loading:m,itemsLen:Object.keys(_).length},"search-suggestions")]})})})]},"search-dialogue")})},So=({app:t,type:s,filter:n,action:r="load",tags:a,searchType:l,attributes:i=[{key:"id",label:"id"},{key:"app",label:"app"},{key:"type",label:"type"},{key:"data",label:"data"},{key:"updated_at",label:"updated_at"}]})=>({format:{app:t,type:s,attributes:i},children:[{type:()=>{},action:r,filter:{options:JSON.stringify({filter:n}),tags:a,searchType:l,attributes:i.map(c=>c.key)},path:"/"}]});let K_={none:"",micro:"mr-14",mini:"mr-20",miniPad:"mr-0",compact:"mr-44",full:"mr-64"},Y_={none:"",micro:"w-14",mini:"w-20",miniPad:"w-0",compact:"w-44",full:"w-64"};const Z_=()=>e.jsx("div",{className:"h-12"}),Nr=({children:t,navItems:s,secondNav:n,title:r,theme:a,yPadding:l="0px",...i})=>{var y;const{theme:c,app:d,type:u,Menu:p}=w.useContext(ke)||{};a=In(Ie(c),Ie(a)),console.log("layout theme",(y=a==null?void 0:a.topnav)==null?void 0:y.topnavWrapper);const{sideNav:m={},topNav:h={},logo:f=Z_}=(a==null?void 0:a.navOptions)||{},g={size:m.size||"none",color:m.color||"transparent",menuItems:((m==null?void 0:m.nav)==="main"?s:(m==null?void 0:m.nav)==="secondary"?n||[]:[]).filter(j=>!j.hideInNav),topMenu:e.jsxs("div",{className:"flex flex-row md:flex-col",children:[(m==null?void 0:m.logo)==="top"&&f,(m==null?void 0:m.dropdown)==="top"&&e.jsx(p,{}),(m==null?void 0:m.search)==="top"&&e.jsx(Or,{app:d,type:u})]}),bottomMenu:e.jsxs("div",{className:"flex flex-row md:flex-col",children:[(m==null?void 0:m.logo)==="bottom"&&f,(m==null?void 0:m.search)==="bottom"&&e.jsx(Or,{app:d,type:u}),(m==null?void 0:m.dropdown)==="bottom"&&e.jsx(p,{})]})},x={position:h.position||"block",size:h.size||"compact",menu:h.menu||"left",subMenuStyle:h.subMenuStyle||"row",menuItems:((h==null?void 0:h.nav)==="main"?s:[]).filter(j=>!j.hideInNav),leftMenu:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[(h==null?void 0:h.logo)==="left"&&f,(h==null?void 0:h.search)==="left"&&e.jsx(Or,{app:d,type:u}),(h==null?void 0:h.dropdown)==="left"&&e.jsx(p,{})]}),rightMenu:e.jsxs(e.Fragment,{children:[h==null?void 0:h.rightMenu,(h==null?void 0:h.search)==="right"&&e.jsx(Or,{app:d,type:u}),(h==null?void 0:h.dropdown)==="right"&&e.jsx(p,{}),(h==null?void 0:h.logo)==="right"&&f]})};return g.logo,e.jsxs("div",{className:`flex ${a==null?void 0:a.bg} max-w-screen`,children:[g.size==="none"?"":e.jsx("div",{className:`hidden md:block ${K_[g.size]}`,children:e.jsx("div",{className:`fixed h-screen ${Y_[g.size]}`,children:e.jsx(zc,{topMenu:g.topMenu,bottomMenu:g.bottomMenu,themeOptions:g,menuItems:g.menuItems})})}),e.jsxs("div",{className:"flex-1 flex items-start flex-col items-stretch max-w-full",style:{minHeight:`calc(100vh - ${l}`},children:[x.size==="none"?"":e.jsx(e.Fragment,{children:e.jsx("div",{className:`${x.position==="fixed"?"sticky top-0 z-20 w-full ":"z-10"}`,children:e.jsx(P_,{themeOptions:x,leftMenu:x.leftMenu,menuItems:x.menuItems,rightMenu:x.rightMenu})})}),e.jsx("div",{id:"content",className:"flex-1",children:t})]})]})};let{color:Ys="white",size:rs="compact",subMenuStyle:X_="inline",responsive:Q_="top"}={},_u={top:"hidden md:block",side:"hidden md:block",none:""},Ms={white:{contentBg:"bg-white border-r",sideItemActive:"",contentBgAccent:"bg-neutral-100",accentColor:"blue-600",accentBg:"",borderColor:"border-slate-200",textColor:"text-slate-600",textColorAccent:"text-slate-800",highlightColor:"text-blue-800"},transparent:{contentBg:"border-r",contentBgAccent:"bg-slate-100",accentColor:"blue-600",accentBg:"hover:bg-blue-400",borderColor:"border-slate-100",textColor:"text-slate-600",textColorAccent:"text-slate-800",highlightColor:"text-slate-800"},dark:{contentBg:"bg-neutral-800",contentBgAccent:"bg-neutral-900",accentColor:"white",accentBg:"",borderColor:"border-neutral-700",textColor:"text-slate-300",textColorAccent:"text-slate-100",highlightColor:"text-slate-100",sideItem:"text-slate-300 hover:text-white",sideItemActive:"text-slate-300 hover:text-white"},bright:{contentBg:"bg-blue-700",accentColor:"blue-400",accentBg:"hover:bg-blue-400",borderColor:"border-blue-600",textColor:"text-white",highlightColor:"text-white-500"}},as={none:{wrapper:"w-0 overflow-hidden",sideItem:"flex mx-2 pr-4 py-2 text-base ",topItem:"flex items-center text-sm px-4 border-r h-12",icon:"mr-3 text-lg"},compact:{fixed:"ml-0 md:ml-44",wrapper:"w-44",itemWrapper:"pt-5",sideItem:"group flex px-3 py-1.5 text-[14px] font-light hover:bg-blue-50 text-slate-700 mx-2 ",sideItemActive:"group flex px-3 py-1.5 text-[14px] font-light hover:bg-blue-50 text-slate-700  mx-2 ",topItem:"flex items-center text-sm px-4 border-r h-12",icon:"group w-6 mr-2 text-blue-500 ",iconActive:"group w-6 mr-2 text-blue-500 ",sideItemContent:"transition-transform duration-300 ease-in-out"},full:{fixed:"",wrapper:"w-full",sideItem:"group flex px-3 py-2 text-[14px] font-light hover:bg-blue-50 text-slate-700 mx-2 border-r-4 border-white",sideItemActive:"group flex px-3 py-2 text-[14px] font-light hover:bg-blue-50 text-slate-700 mx-2 border-r-4  border-white",topItem:"flex pr-4 py-2  font-",icon:"group w-6 mr-2 text-blue-500  ",iconActive:"group w-6 mr-2 text-blue-500",sideItemContent:"group-hover:translate-x-1.5 transition-transform duration-300 ease-in-out"},mini:{fixed:"ml-0 md:ml-20",wrapper:"w-20 overflow-x-hidden",sideItem:"text-white hover:bg-blue-100 hover:text-blue-100",sideItemActive:"text-blue-500 bg-blue-500  ",topItem:"flex px-4 items-center text-sm font-light ",icon:"w-20 h-10 text-xl text-blue-500",iconActive:"w-20 h-10 text-xl text-white",sideItemContent:"w-0"},micro:{fixed:"ml-0 md:ml-14",wrapper:"w-14 overflow-x-hidden",itemWrapper:"p-1",sideItem:"flex text-base font-base ",topItem:"flex mx-6 pr-4 py-2 text-sm font-light",icon:"w-12 text-2xl hover:bg-neutral-900 px-1 py-3 my-2 rounded-lg mr-4 hover:text-blue-500",sideItemContent:"hidden"}};as[rs]||(rs="none");let e4={inline:{indicatorIcon:"fa fa-angle-right pt-2.5",indicatorIconOpen:"fal fa-angle-down pt-2.5",subMenuWrapper:"pl-2 w-full",subMenuParentWrapper:"flex flex-col w-full"},flyout:{indicatorIcon:"fal fa-angle-down",indicatorIconOpen:"fa fa-angle-right",subMenuWrapper:`absolute ml-${as[rs].width-8}`,subMenuParentWrapper:"flex flex-row",subMenuWrapperTop:"absolute top-full"}};const t4={fixed:`md:${as[rs].fixed}`,logoWrapper:`${as[rs].wrapper} ${Ms[Ys].contentBgAccent} ${Ms[Ys].textColorAccent}`,sidenavWrapper:`${_u[Q_]} ${Ms[Ys].contentBg} ${as[rs].wrapper} h-full z-20`,menuIconSide:`${as[rs].icon} group-hover:${Ms[Ys].highlightColor}`,menuIconSideActive:`${as[rs].iconActive} group-hover:${Ms[Ys].highlightColor}`,itemsWrapper:`${Ms[Ys].borderColor} ${as[rs].itemWrapper}  `,navItemContent:`${as[rs].sideItemContent}`,navitemSide:`
        group  flex flex-col

        ${as[rs].sideItem} ${Ms[Ys].sideItem}
        focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
        transition-all cursor-pointer
     `,navitemSideActive:`
        group  flex flex-col
         ${as[rs].sideItemActive} ${Ms[Ys].sideItemActive} 
        
        focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
        transition-all cursor-pointer

      `,...e4[X_],vars:{colors:Ms,sizes:as,mobile:_u}},At="white",tn="compact",s4="row";let Lt={white:{contentBg:"bg-slate-100",accentColor:"blue-500",accentBg:"hover:bg-white",borderColor:"border-slate-100",textColor:"text-slate-700",highlightColor:"text-blue-500"},bright:{contentBg:"bg-blue-700",accentColor:"blue-400",accentBg:"hover:bg-blue-400",borderColor:"border-blue-600",textColor:"text-white",highlightColor:"text-white"}},Os={compact:{menu:"hidden uppercase md:flex flex-1  divide-x-2",sideItem:"flex  mx-6 pr-4 py-2 text-sm font-light hover:pl-4",topItem:`flex font-medium tracking-widest items-center text-[14px] px-4 h-12 ${Lt[At].textColor} ${Lt[At].borderColor}
        ${Lt[At].accentBg} hover:${Lt[At].highlightColor}`,activeItem:`flex font-medium  tracking-widest bg-white items-center text-[14px] px-4 h-12 ${Lt[At].highlightColor} ${Lt[At].borderColor}
        ${Lt[At].accentBg} hover:${Lt[At].highlightColor}`,icon:"mr-3 text-lg",responsive:"md:hidden"},inline:{menu:"flex flex-1",sideItem:"flex mx-4 pr-4 py-4 text-base font-base border-b hover:pl-4",topItem:`flex px-4 py-2 mx-2 font-medium text-gray-400 border-b-2 ${Lt[At].textColor} ${Lt[At].borderColor}
      hover:border-gray-300 hover:text-gray-700 border-gray-100 `,activeItem:`flex px-4 py-2 mx-2 font-medium text-blue-600 border-b-2 ${Lt[At].textColor} ${Lt[At].borderColor} border-blue-600 `,icon:"mr-4 text-2xl",responsive:"hidden"}},n4={inline:{subMenuWrapperChild:"",subMenuWrapper:"pl-2 w-full ",subMenuParentWrapper:"flex flex-col w-full  "},flyout:{indicatorIcon:"fal fa-angle-down pl-2 pt-1",indicatorIconOpen:"fal fa-angle-down pl-2",subMenuWrapper:`absolute ml-${Os[tn].width-8} `,subMenuParentWrapper:"flex flex-row  ",subMenuWrapperTop:"absolute top-full  "},row:{indicatorIcon:"fal fa-angle-down pl-2 pt-1",indicatorIconOpen:"fal fa-angle-down pl-2 pt-1",subMenuWrapper:`absolute bg-white ml-${Os[tn].width-8}`,subMenuParentWrapper:"flex flex-row  ",subMenuWrapperChild:"divide-x overflow-x-auto",subMenuWrapperTop:"absolute top-full left-0 border-y border-gray-200 w-full bg-white normal-case",subMenuWrapperInactiveFlyout:"absolute  mt-8 normal-case bg-white shadow-lg z-10 p-2",subMenuWrapperInactiveFlyoutBelow:" absolute ml-40 normal-case bg-white shadow-lg z-10 p-2",subMenuWrapperInactiveFlyoutDirection:"flex flex-col divide-y-2"}},a4={topnavWrapper:`w-full ${Lt[At].contentBg} border-b border-gray-200`,topnavContent:"flex w-full h-full",topnavMenu:`${Os[tn].menu} h-full overflow-x-auto overflow-y-hidden scrollbar-sm`,menuIconTop:`text-${Lt[At].accentColor} ${Os[tn].icon} group-hover:${Lt[At].highlightColor}`,menuIconTopActive:`text-${Lt[At].accentColor} ${Os[tn].icon} group-hover:${Lt[At].highlightColor}`,menuOpenIcon:"fa-light fa-bars fa-fw",menuCloseIcon:'fa-light fa-xmark fa-fw"',navitemTop:`
        w-fit group font-display whitespace-nowrap
        ${Os[tn].topItem}
        focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
        transition cursor-pointer
    `,topmenuRightNavContainer:"hidden md:flex h-full items-center",topnavMobileContainer:"bg-slate-50",navitemTopActive:` w-fit group font-display whitespace-nowrap
        ${Os[tn].activeItem}
        focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
        transition cursor-pointer 
      `,mobileButton:`${Os[tn].responsive} ${Lt[At].contentBg} inline-flex items-center justify-center pt-[12px] px-2 hover:text-blue-400  text-gray-400 hover:bg-gray-100 `,...n4[s4],vars:{colors:Lt,sizes:Os}};const Pf={navOptions:{logo:"",sideNav:{size:"none",search:"none",logo:"top",dropdown:"none",nav:"none"},topNav:{size:"compact",dropdown:"right",search:"right",logo:"left",position:"fixed",nav:"main"}},heading:{base:"p-2 w-full font-sans font-medium text-md bg-transparent",1:"text-blue-500 font-bold text-xl tracking-wider py-1 pl-1",2:"text-lg tracking-wider",3:"text-md tracking-wide",default:""},levelClasses:{1:" pt-2 pb-1 uppercase text-sm text-blue-400 hover:underline cursor-pointer border-r-2 mr-4",2:"pl-2 pt-2 pb-1 uppercase text-sm text-slate-400 hover:underline cursor-pointer border-r-2 mr-4",3:"pl-4 pt-2 pb-1 text-sm text-slate-400 hover:underline cursor-pointer border-r-2 mr-4",4:"pl-6 pt-2 pb-1 text-sm text-slate-400 hover:underline cursor-pointer border-r-2 mr-4"},page:{wrapper1:"w-full h-full flex-1 flex flex-col bg-slate-100",wrapper2:"w-full h-full flex-1 flex flex-row px-1 md:px-6 py-6",wrapper3:"flex flex-1 w-full  flex-col border shadow bg-white relative text-md font-light leading-7 p-4 min-h-[calc(100vh_-_102px)]",iconWrapper:"z-5 absolute right-[10px] top-[5px]",icon:"text-slate-400 hover:text-blue-500"},pageControls:{controlItem:"pl-6 py-0.5 text-md cursor-pointer hover:text-blue-500 text-slate-400 flex items-center",select:"bg-transparent border-none rounded-sm focus:ring-0 focus:border-0 pl-1",selectOption:"p-4 text-md cursor-pointer hover:text-blue-500 text-slate-400 hover:bg-blue-600"},navPadding:{1:"pt-0 ",2:"md:pt-12 pt-0",3:"md:pt-24 pt-0"},navLabel:"px-6 pb-1 pt-6 uppercase text-xs text-blue-400",bg:"bg-slate-100",sidenav:t4,topnav:a4},gn={settings:{theme:{label:"Theme",defaultOpen:!0,controls:{theme:{label:"Theme",type:"select",options:["default","mnyv1"]}}}},navOptions:{topNav:{label:"Top Nav",defaultOpen:!0,controls:{size:{label:"Size",type:"select",options:["none","compact"]},logo:{label:"Logo",type:"select",options:["none","left","right"]},search:{label:"Search",type:"select",options:["none","left","right"]},dropdown:{label:"Menu",type:"select",options:["none","left","right"]},nav:{label:"Navigation",type:"select",options:["none","main","secondary"]}}},sideNav:{label:"Side Nav",defaultOpen:!1,controls:{size:{label:"Size",type:"select",options:["none","micro","mini","compact","full"]},color:{label:"Color",type:"select",options:["transparent","white","bright","dark"]},logo:{label:"Logo",type:"select",options:["none","top","bottom"]},search:{label:"Search",type:"select",options:["none","top","bottom"]},dropdown:{label:"Menu",type:"select",options:["none","top","bottom"]},nav:{label:"Navigation",type:"select",options:["none","main","secondary"]}}},secondaryNav:{label:"Secondary Nav",defaultOpen:!1,controls:{navItems:{label:"Nav Items",type:"menu"}}},authMenu:{label:"Auth Menu",defaultOpen:!1,controls:{navItems:{label:"Nav Items",type:"menu"}}}}},r4=t=>{const[s,n]=w.useState(null);return w.useEffect(()=>{const r=a=>{s.contains(a.target)||typeof t=="function"&&t(a)};return s&&document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[s,t]),[n,s]};function o4({control:t,children:s,className:n,width:r="w-full max-w-[200px]",openType:a="hover"}){const[l,i]=w.useState(!1),c=w.useCallback(()=>i(!1),[]),[d]=r4(c);return e.jsxs("div",{ref:d,className:`relative cursor-pointer ${n}`,onMouseEnter:u=>{a==="hover"&&i(!0)},onMouseLeave:u=>i(!1),onClick:u=>{i(!l)},children:[t,l?e.jsx("div",{className:`shadow fixed ${r} rounded-b-lg ${l?"block":"hidden"} z-10`,children:s}):""]})}function l4({children:t,onClick:s}){const{theme:n=Pf}=w.useContext(ke);return e.jsx("div",{onClick:s,className:n.pageControls.controlItem,children:t})}function i4({icon:t,onClick:s,children:n}){let[r,a]=b.useState(),[l,i]=b.useState(),{styles:c,attributes:d}=gc(r,l);return e.jsxs(ft,{className:"relative",children:[e.jsx(ft.Button,{ref:a,onClick:s,className:"text-md cursor-pointer hover:text-blue-800 text-blue-500",children:t}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(ft.Panel,{ref:i,style:c.popper,...d.popper,className:"shadow-lg bg-white rounded z-10 transform  border border-blue-200 w-[180px] ",children:n})})]})}function c4({value:t,onChange:s,label:n}){const[r,a]=w.useState(!1),[l,i]=w.useState(t||"");return e.jsxs("div",{className:"pl-4 pb-2",children:[n&&e.jsxs("span",{className:"text-xs uppercase font-bold text-slate-400",children:[" ",n]}),e.jsx("div",{className:"flex justify-between group",children:e.jsx("div",{className:"flex-1",children:e.jsx("dd",{className:" text-sm text-gray-900 ",children:r?e.jsxs("div",{className:"flex group focus:outline-none border-slate-300 border-b-2 group-focus:border-blue-500",children:[e.jsx("input",{className:"w-full px-2 py-1 bg-transparent font-medium text-slate-500 focus:outline-none focus:border-blue-500",value:l,onChange:c=>i(c.target.value)}),e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx("span",{className:" pt-0.5 text-green-500 rounded hover:bg-green-500 hover:text-white ",onClick:c=>{s(l),a(!1)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}),e.jsx("span",{className:"pt-0.5 text-slate-300  rounded  hover:text-red-300 ",onClick:c=>a(!1),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})})]})]}):e.jsxs("div",{className:"w-full min-h-[30px] flex flex-row px-2 py-1 text font-medium text-slate-500 focus:outline-none border-slate-300 border-b-2 focus:border-blue-500",children:[e.jsx("div",{className:"w-full",children:t}),e.jsx("div",{className:"hidden group-hover:block cursor-pointer group-hover:text-gray-300 ",onClick:c=>a(!r),children:e.jsx(xf,{size:20,className:"text-gray-400 hover:text-blue-500"})})]})})})})]})}const d4=({label:t,types:s,type:n,setType:r,multi:a=!1,size:l="small",disabled:i,disabledTitle:c})=>(b.useEffect(()=>{var p,m;const d=((p=s[0])==null?void 0:p.value)||s[0];if(!d||i)return;const u=a?[d]:d;(!n||Array.isArray(n)&&!((m=n.filter(h=>h))!=null&&m.length))&&r(u)},[s]),e.jsxs("div",{className:"my-1 flex flex-rows flex-wrap",title:i?c:null,children:[t&&e.jsx("div",{className:"p-2 pl-0 w-1/4",children:t}),e.jsx("span",{className:`
              
                space-x-1 rounded-lg bg-slate-100 py-0.5
                flex flex-row flex-wrap
                shadow-sm 
                ${l==="large"?"w-full":"w-fit"}`,children:s.map((d,u)=>{const p=(d==null?void 0:d.value)||d,m=a&&Array.isArray(n)?n:a&&!Array.isArray(n)?[n]:!a&&Array.isArray(n)?n[0]:n,h=a&&(m==null?void 0:m.includes(p))||!a&&m===p;return e.jsx("button",{type:"button",className:`
                                    ${u!==0&&"-ml-px"} 
                                    ${i&&"pointer-events-none"}
                                    rounded-lg py-[0.4375rem] break-none
                                    ${h?"text-gray-900 bg-white shadow":"text-gray-700"} hover:text-blue-500
                                    min-w-[60px] min-h-[30px] uppercase
                                    relative items-center px-2 text-xs items-center justify-center text-center 
                                    focus:z-10
                                `,onClick:()=>{const f=a&&(m!=null&&m.includes(p))?m.filter(g=>g!==p):a&&!(m!=null&&m.includes(p))?[...m,p]:p;r(f)},children:(d==null?void 0:d.label)||d},u)})})]}));function $o({children:t,width:s="w-64",custom:n="top-20"}){return e.jsx("div",{className:`${s} hidden xl:block`,children:e.jsx("div",{className:`${s} sticky ${n} hidden xl:block`,children:t})})}function u4({children:t,active:s,onClick:n}){return e.jsx("div",{onClick:n,className:`${s?"inline-flex w-36 justify-center rounded-lg cursor-pointer text-sm font-semibold py-2 px-2 bg-blue-600 text-white hover:bg-blue-500 shadow-lg border border-b-4 border-blue-800 hover:border-blue-700 active:border-b-2 active:mb-[2px] active:shadow-none":"inline-flex w-36 justify-center rounded-lg cursor-not-allowed text-sm font-semibold py-2 px-2 bg-slate-300 text-white shadow border border-slate-400 border-b-4"}`,children:e.jsx("span",{className:"flex items-center",children:t})})}function m4({children:t,active:s,onClick:n}){return s?e.jsx("div",{onClick:n,className:`${s?"inline-flex w-36 justify-center rounded-lg cursor-pointer text-sm font-semibold py-2 px-2 bg-red-600 text-white hover:bg-red-500 shadow-lg border border-b-4 border-red-800 hover:border-red-700 active:border-b-2 active:mb-[2px] active:shadow-none":"inline-flex w-36 justify-center rounded-lg cursor-not-allowed text-sm font-semibold py-2 px-2 bg-slate-300 text-white shadow border border-slate-400 border-b-4"}`,children:e.jsx("span",{className:"flex items-center",children:t})}):null}function Pl({value:t,toggleSidebar:s}){let n=t==="show";return e.jsxs(Tt,{checked:n,onChange:s,className:"group relative inline-flex h-5 w-10 flex-shrink-0 cursor-pointer items-center justify-center rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2",children:[e.jsx("span",{className:"sr-only",children:"Use setting"}),e.jsx("span",{"aria-hidden":"true",className:"pointer-events-none absolute h-full w-full rounded-md bg-white"}),e.jsx("span",{"aria-hidden":"true",className:`
          ${n?"bg-blue-500":"bg-gray-200"}
          pointer-events-none absolute mx-auto h-4 w-9 rounded-full transition-colors duration-200 ease-in-out
        `}),e.jsx("span",{"aria-hidden":"true",className:`
          ${n?"translate-x-5":"translate-x-0"}
          pointer-events-none absolute left-0 inline-block h-5 w-5 transform rounded-full border border-gray-200 bg-white shadow ring-0 transition-transform duration-200 ease-in-out
        `})]})}function Df({title:t,prompt:s,item:n={},open:r,setOpen:a,onDelete:l}){const i=b.useRef(null);w.useContext(ke);const[c,d]=b.useState(!1);return e.jsxs(p4,{open:r,setOpen:a,initialFocus:i,children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fa fa-danger h-6 w-6 text-red-600","aria-hidden":"true"})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[e.jsx(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:t||`Delete ${n.title||""} ${n.id}`}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:s||`Are you sure you want to delete this page? All of the page data will be permanently removed
              from our servers forever. This action cannot be undone.`})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsxs("button",{type:"button",disabled:c,className:"inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto",onClick:l,children:["Delet",c?"ing...":"e"]}),e.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>a(!1),ref:i,children:"Cancel"})]})]})}function p4({open:t,setOpen:s,initialFocus:n,children:r}){return e.jsx(Be.Root,{show:t,as:b.Fragment,children:e.jsxs(Je,{as:"div",className:"relative z-30",initialFocus:n,onClose:s,children:[e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),e.jsx("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:e.jsx("div",{onClick:()=>{s(!1)},className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:e.jsx(Je.Panel,{className:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6",children:r})})})})]})})}const h4=async t=>{const s=`
                        <!DOCTYPE html>
                            <html lang="en">
                            <head>
                                <title>PDF</title>
                                <meta name="viewport" content="width=1600, initial-scale=1" />
                                <link rel="stylesheet" type="text/css" href="https://mitigateny.org/css/build.css" />
                                <style>
                                  @import url('https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600;700;800;900&family=IBM+Plex+Sans:wght@100;200;300;400;500;600;700&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Montserrat:wght@100;200;300;400;500;600;700;800;900&family=Oswald:wght@300;500;700&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&family=Rubik:wght@300;400;500;600;700;800&family=Work+Sans:wght@100;200;300;400;500;600;700;800;900&display=swap');
                                </style>
                            </head>
                            <body style="padding:30px;width: 1400px">
                                ${t.current.innerHTML}
                            </body>
                            </html>`;console.log(s);const n=await fetch(`${sh}/dama-admin/hazmit_dama/downloadpdf`,{method:"POST",headers:{"Content-Type":"text/html"},body:s});if(console.log("res",n),n.ok){const r=await n.blob();console.log("blob",r);const a=window.URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download="document.pdf",document.body.appendChild(l),l.click(),l.remove()}else console.error("Failed to generate PDF")};function f4({item:t,dataItems:s,attributes:n,logo:r,rightMenu:a}){var y,j,N,_,E,L,S,k,$,I,T,A,R,O;t||(t={});const l=b.useRef(),{baseUrl:i,theme:c,user:d}=w.useContext(ke)||{},u=w.useMemo(()=>n.sections.ViewComp,[]),p=w.useMemo(()=>rl(s,i,!1),[s]),m=(t==null?void 0:t.index)=="999"||((j=(y=c==null?void 0:c.navOptions)==null?void 0:y.topNav)==null?void 0:j.nav)!=="main"?1:pf(s,i),h=hf(t,c),f=(_=(N=t.sections)==null?void 0:N.filter(M=>M.is_header))==null?void 0:_[0],g=(E=t.sections)==null?void 0:E.filter(M=>!M.is_header&&!M.is_footer),x=((L=n==null?void 0:n.sections)==null?void 0:L.attributes)||{};return e.jsxs("div",{id:"page_view",children:[(t==null?void 0:t.header)==="above"&&e.jsx(u,{item:t,value:[f],attributes:x}),e.jsx(Nr,{navItems:p,secondNav:((k=(S=c==null?void 0:c.navOptions)==null?void 0:S.secondaryNav)==null?void 0:k.navItems)||[],children:e.jsxs("div",{className:`${($=c==null?void 0:c.page)==null?void 0:$.wrapper1} ${c==null?void 0:c.navPadding[m]}`,children:[(t==null?void 0:t.header)==="below"&&e.jsx(u,{item:t,value:[f],attributes:x}),e.jsxs("div",{className:`${(I=c==null?void 0:c.page)==null?void 0:I.wrapper2}`,children:[(t==null?void 0:t.sidebar)==="show"&&e.jsx($o,{children:e.jsx(zc,{...h})}),e.jsxs("div",{className:(T=c==null?void 0:c.page)==null?void 0:T.wrapper3,ref:l,children:[(t==null?void 0:t.header)==="inpage"&&e.jsx(u,{item:t,value:[f],attributes:x}),(d==null?void 0:d.authLevel)>=5&&e.jsx(je,{className:(A=c==null?void 0:c.page)==null?void 0:A.iconWrapper,to:`${i}/edit/${(t==null?void 0:t.url_slug)||""}`,children:e.jsx(ff,{className:(R=c==null?void 0:c.page)==null?void 0:R.icon})}),e.jsx("div",{className:(O=d==null?void 0:d.email)!=null&&O.includes("availabs")?"flex absolute right-10 top-2":"hidden",children:e.jsx("button",{className:"mx-1",onClick:()=>h4(l),children:e.jsx(Tf,{className:"hover:text-blue-500"})})}),e.jsx(u,{full_width:t.full_width,item:t,value:g,attributes:x})]})]})]})}),(t==null?void 0:t.footer)&&e.jsx("div",{className:"h-[300px] bg-slate-100"})]})}const Dl=(t,s,n,r)=>{var c;const a=(c=s.draft_sections)==null?void 0:c.filter(d=>!d.is_header&&!d.is_footer);let l=s.history?Ie(s.history):[];l.push({type:"Header updated.",user:(n==null?void 0:n.email)||"user",time:new Date().toString()});const i={id:s.id,draft_sections:[...t,...a].filter(d=>d),has_changes:!0,history:l};r({data:i})},g4=async(t,s,n,r,a)=>{var u,p;const l=(p=(u=n.draft_sections)==null?void 0:u.filter(m=>m.is_header))==null?void 0:p[0];let i={type:s,user:(r==null?void 0:r.email)||"user",time:new Date().toString()},c=n.history?Ie(n.history):[];s&&c.push(i);const d={id:n==null?void 0:n.id,draft_sections:[l,...t].filter(m=>m),has_changes:!0,history:c};await a({data:d})},x4=async(t,s,n,r)=>{const a=s.filter(i=>i.parent===t.id).reduce((i,c)=>Math.max(isNaN(c.index)?0:c.index,i),0),l={title:"New Page",parent:t.id,index:a+1,published:"draft",history:[{type:" created Page.",user:n.email,time:new Date().toString()}]};l.url_slug=`${pn(l,s)}`,r({data:l})},b4=(t,s,n,r)=>{const a=s.filter(i=>!i.parent).reduce((i,c)=>Math.max(isNaN(c.index)?-1:c.index,i),-1),l=Ie(t);delete l.id,l.title+=" Dup",l.index=a+1,l.url_slug=pn(l,s),l.sections.forEach(i=>{delete i.ref,delete i.id}),l.history=[{type:"Created Duplicate Page.",user:n.email,time:new Date().toString()}],r({data:l})},y4=async(t,s,n,r)=>{const a=s.filter(i=>!i.parent).reduce((i,c)=>Math.max(isNaN(c.index)?0:c.index,i),0),l={title:"New Page",parent:t==null?void 0:t.parent,index:a+1,published:"draft",history:[{type:" created Page.",user:n==null?void 0:n.email,time:new Date().toString()}]};l.url_slug=`${pn(l,s)}`,r({data:l})},v4=async(t,s,n="",r,a)=>{if(n!==t.title){let l=t.history?Ie(t.history):[],i={type:`changed page title to ${n}`,user:r.email,time:new Date().toString()};l.push(i);const c={id:t.id,title:n,history:l};c.url_slug=pn(c,s),a({data:c})}},Pr=async(t,s,n="",r,a)=>{var c,d;const l={id:t.id};l[s]=n;let i=r==="template"?"sections":"draft_sections";s==="header"&&!((d=(c=t==null?void 0:t[i])==null?void 0:c.filter(u=>u.is_header))!=null&&d[0])&&(l[i]=Ie(t[i]||[]),l[i].unshift({is_header:!0,element:{"element-type":"Header: Default Header","element-data":{}}})),a({data:l})},j4=async(t,s,n)=>{let r={type:"published changes.",user:t.email,time:new Date().toString()},a=s!=null&&s.history?Ie(s.history):[];a.push(r);const l={id:s.id,has_changes:!1,published:"",history:a};let i=Ie(s.sections||[]).reduce((c,d)=>(d.draft_id&&(c[d.draft_id]=d),c),{});l.sections=Ie(s.draft_sections||[]).reduce((c,d)=>(i[d.id]?d.id=i[d.id].id:delete d.id,c.push(d),c),[]),n({data:l})},w4=async(t,s,n)=>{let r={type:"discarded changes.",user:t.email,time:new Date().toString()},a=s!=null&&s.history?Ie(s.history):[];a.push(r);const l={...Ie(s),has_changes:!1,published:"",history:a};l.draft_sections=s.sections.map(i=>(delete i.id,i)),n({data:l})};function N4(t,s,n,r,a,l,i){return[{icon:e.jsx(yf,{className:"text-blue-400 hover:text-blue-700 cursor-pointer h-10 w-10 p-2 "}),name:"Page Controls",items:[{item:"☲ New Page",onClick:()=>y4(t,s,n,i)},{item:"☲ Insert Subpage",onClick:()=>x4(t,s,n,i)},{item:"☳ Duplicate",onClick:()=>b4(t,s,n,i)},{item:"☵ Delete",onClick:()=>l({...a,showDelete:!0})}]},{icon:e.jsx(vf,{className:"text-blue-400 hover:text-blue-700 cursor-pointer h-10 w-10 p-2"}),name:"Page Settings",items:[{item:e.jsxs(e.Fragment,{children:[e.jsx(Pl,{value:t.sidebar,toggleSidebar:()=>Pr(t,"sidebar",t.sidebar==="show"?null:"show",r,i)}),"Show Sidebar"]})},{item:e.jsxs(e.Fragment,{children:[e.jsx(Pl,{value:t.full_width,toggleSidebar:()=>Pr(t,"full_width",t.full_width==="show"?null:"show",r,i)}),"Full Width"]})},{item:e.jsxs(e.Fragment,{children:[e.jsx(Pl,{value:t.hide_in_nav,toggleSidebar:()=>Pr(t,"hide_in_nav",t.hide_in_nav==="show"?null:"show",r,i)}),"Hide In Nav"]})},{item:e.jsx(e.Fragment,{children:e.jsx(d4,{label:"Header:",types:[{label:"None",value:"none"},{label:"Above",value:"above"},{label:"Below",value:"below"},{label:"In page",value:"inpage"}],type:t.header,setType:c=>Pr(t,"header",c,r,i)})})}]},{icon:e.jsx(jf,{className:"text-blue-400 hover:text-blue-700 cursor-pointer h-10 w-10 p-2"}),onClick:()=>l({...a,showNav:!0})},{icon:e.jsx(wf,{className:"text-blue-400 hover:text-blue-700 cursor-pointer h-10 w-10 p-2"}),onClick:()=>l({...a,showHistory:!0})}]}function Cs(t){return typeof t=="object"&&!("toString"in t)?Object.prototype.toString.call(t).slice(8,-1):t}function _s(t,s){if(!t)throw new Error(s())}var Ci=Object.prototype.hasOwnProperty,C4=Array.prototype.splice,_4=Object.prototype.toString;function _n(t){return _4.call(t).slice(8,-1)}var _i=Object.assign||function(t,s){return Uc(s).forEach(function(n){Ci.call(s,n)&&(t[n]=s[n])}),t},Uc=typeof Object.getOwnPropertySymbols=="function"?function(t){return Object.keys(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.keys(t)};function Qs(t){return Array.isArray(t)?_i(t.constructor(t.length),t):_n(t)==="Map"?new Map(t):_n(t)==="Set"?new Set(t):t&&typeof t=="object"?_i(Object.create(Object.getPrototypeOf(t)),t):t}var S4=function(){function t(){this.commands=_i({},$4),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(s,n){return s===n},this.update.newContext=function(){return new t().update}}return Object.defineProperty(t.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(s){this.update.isEquals=s},enumerable:!1,configurable:!0}),t.prototype.extend=function(s,n){this.commands[s]=n},t.prototype.update=function(s,n){var r=typeof n=="function"?{$apply:n}:n;Array.isArray(s)&&Array.isArray(r)||_s(!Array.isArray(r),function(){return"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."}),_s(typeof r=="object"&&r!==null,function(){return"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the "+"following commands: ".concat(Object.keys(this.commands).join(", "),".")});var a=s;return Uc(r).forEach(l=>{if(Ci.call(this.commands,l)){var i=s===a;a=this.commands[l](r[l],a,r,s),i&&this.isEquals(a,s)&&(a=s)}else{var c=_n(s)==="Map"?this.update(s.get(l),r[l]):this.update(s[l],r[l]),d=_n(a)==="Map"?a.get(l):a[l];(!this.isEquals(c,d)||typeof c>"u"&&!Ci.call(s,l))&&(a===s&&(a=Qs(s)),_n(a)==="Map"?a.set(l,c):a[l]=c)}}),a},t}(),$4={$push:function(t,s,n){return Su(s,n,"$push"),t.length?s.concat(t):s},$unshift:function(t,s,n){return Su(s,n,"$unshift"),t.length?t.concat(s):s},$splice:function(t,s,n,r){return k4(s,n),t.forEach(function(a){Rf(a),s===r&&a.length&&(s=Qs(r)),C4.apply(s,a)}),s},$set:function(t,s,n){return I4(n),t},$toggle:function(t,s){Ha(t,"$toggle");var n=t.length?Qs(s):s;return t.forEach(function(r){n[r]=!s[r]}),n},$unset:function(t,s,n,r){return Ha(t,"$unset"),t.forEach(function(a){Object.hasOwnProperty.call(s,a)&&(s===r&&(s=Qs(r)),delete s[a])}),s},$add:function(t,s,n,r){return $u(s,"$add"),Ha(t,"$add"),_n(s)==="Map"?t.forEach(function(a){var l=a[0],i=a[1];s===r&&s.get(l)!==i&&(s=Qs(r)),s.set(l,i)}):t.forEach(function(a){s===r&&!s.has(a)&&(s=Qs(r)),s.add(a)}),s},$remove:function(t,s,n,r){return $u(s,"$remove"),Ha(t,"$remove"),t.forEach(function(a){s===r&&s.has(a)&&(s=Qs(r)),s.delete(a)}),s},$merge:function(t,s,n,r){return T4(s,t),Uc(t).forEach(function(a){t[a]!==s[a]&&(s===r&&(s=Qs(r)),s[a]=t[a])}),s},$apply:function(t,s){return L4(t),t(s)}},E4=new S4;function Su(t,s,n){_s(Array.isArray(t),function(){return"update(): expected target of ".concat(Cs(n)," to be an array; got ").concat(Cs(t),".")}),Ha(s[n],n)}function Ha(t,s){_s(Array.isArray(t),function(){return"update(): expected spec of ".concat(Cs(s)," to be an array; got ").concat(Cs(t),". ")+"Did you forget to wrap your parameter in an array?"})}function k4(t,s){_s(Array.isArray(t),function(){return"Expected $splice target to be an array; got ".concat(Cs(t))}),Rf(s.$splice)}function Rf(t){_s(Array.isArray(t),function(){return"update(): expected spec of $splice to be an array of arrays; got ".concat(Cs(t),". ")+"Did you forget to wrap your parameters in an array?"})}function L4(t){_s(typeof t=="function",function(){return"update(): expected spec of $apply to be a function; got ".concat(Cs(t),".")})}function I4(t){_s(Object.keys(t).length===1,function(){return"Cannot have more than one key in an object with $set"})}function T4(t,s){_s(s&&typeof s=="object",function(){return"update(): $merge expects a spec of type 'object'; got ".concat(Cs(s))}),_s(t&&typeof t=="object",function(){return"update(): $merge expects a target of type 'object'; got ".concat(Cs(t))})}function $u(t,s){var n=_n(t);_s(n==="Map"||n==="Set",function(){return"update(): ".concat(Cs(s)," expects a target of type Set or Map; got ").concat(Cs(n))})}const Eu=E4.update,M4=t=>Object.prototype.toString.call(t).slice(8,-1),B4=t=>M4(t)==="Array",A4=(t,s)=>{for(;t;){if(t.matches&&t.matches(s))return t;t=t.parentNode}return null},O4=t=>{var s=t.getBoundingClientRect(),n=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||n.scrollTop,l=window.pageXOffset||r.scrollLeft||n.scrollLeft,i=r.clientTop||n.clientTop||0,c=r.clientLeft||n.clientLeft||0,d=s.top+a-i,u=s.left+l-c;return{top:Math.round(d),left:Math.round(u)}},P4=t=>{let s=0,n=0;for(;t=t.parentNode;)s+=t.scrollTop||0,n+=t.scrollLeft||0;return{top:s,left:n}},D4=(t,s)=>({transform:"translate("+t+"px, "+s+"px)"}),Si=(t,s)=>t.map(n=>({...n,[s]:n[s]?Si(n[s],s):[]})),eo=(t,{idProp:s,childrenProp:n})=>{let r=[];return t.filter(l=>l[n].length).map(l=>(r=r.concat(eo(l[n],{idProp:s,childrenProp:n})),l[s])).concat(r)};function Eo(){for(var t={}.hasOwnProperty,s=[],n=0;n<arguments.length;n++){var r=arguments[n];if(r){var a=typeof r;if(a==="string"||a==="number")s.push(r);else if(Array.isArray(r)){if(r.length){var l=Eo.apply(null,r);l&&s.push(l)}}else if(a==="object"){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){s.push(r.toString());continue}for(var i in r)t.call(r,i)&&r[i]&&s.push(i)}}}return s.join(" ")}function R4({children:t,className:s,...n}){return e.jsx("i",{className:`${nestable-icon}  ${s}`,...n})}var jn;let ku=(jn=class extends b.Component{constructor(){super(...arguments);ye(this,"renderCollapseIcon",({isCollapsed:n})=>e.jsx(R4,{className:Eo("nestable-item-icon",{"icon-plus-gray":n,"icon-minus-gray":!n})}))}render(){const{item:n,isCopy:r,options:a,index:l,depth:i}=this.props,{dragItem:c,renderItem:d,handler:u,idProp:p,childrenProp:m,renderCollapseIcon:h=this.renderCollapseIcon}=a,f=a.isCollapsed(n),g=!r&&c&&c[p]===n[p],x=n[m]&&n[m].length>0;let y={},j={},N;r||(c?y={...y,onMouseEnter:k=>a.onMouseEnter(k,n)}:j={...j,draggable:!0,onDragStart:k=>a.onDragStart(k,n)}),u?N=e.jsx("span",{className:"nestable-item-handler",...j,children:u}):y={...y,...j};const _=x?e.jsx("span",{onClick:()=>a.onToggleCollapse(n),children:h({isCollapsed:f})}):null,E="nestable-item ml-2"+(r?"-copy":""),L={className:Eo(E,E+"-"+n[p],{"is-dragging bg-slate-200 border pl-4":g,[E+"--with-children"]:x,[E+"--children-open"]:x&&!f,[E+"--children-collapsed"]:x&&f})},S=d({collapseIcon:_,depth:i,handler:N,index:l,item:n});return S?e.jsxs("li",{...L,children:[e.jsx("div",{className:"nestable-item-name",...y,children:S}),x&&!f&&e.jsx("ol",{className:"nestable-list border-l ml-4",children:n[m].map((k,$)=>e.jsx(jn,{index:$,depth:i+1,item:k,options:a,isCopy:r},$))})]}):null}},ye(jn,"propTypes",{item:Le.object,isCopy:Le.bool,options:Le.object,index:Le.number,depth:Le.number}),ye(jn,"defaultProps",{depth:0}),jn);var qr;let Ff=(qr=class extends b.Component{constructor(n){super(n);ye(this,"collapse",n=>{const{idProp:r,childrenProp:a,collapsed:l}=this.props,{items:i}=this.state;n==="NONE"?this.setState({collapsedGroups:l?eo(i,{idProp:r,childrenProp:a}):[]}):n==="ALL"?this.setState({collapsedGroups:l?[]:eo(i,{idProp:r,childrenProp:a})}):B4(n)&&this.setState({collapsedGroups:eo(i,{idProp:r,childrenProp:a}).filter(c=>n.indexOf(c)>-1^l)})});ye(this,"startTrackMouse",()=>{document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onDragEnd),document.addEventListener("keydown",this.onKeyDown)});ye(this,"stopTrackMouse",()=>{document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onDragEnd),document.removeEventListener("keydown",this.onKeyDown),this.elCopyStyles=null});ye(this,"getItemDepth",n=>{const{childrenProp:r}=this.props;let a=1;if(n[r].length>0){const l=n[r].map(this.getItemDepth);a+=Math.max(...l)}return a});ye(this,"isCollapsed",n=>{const{collapsed:r,idProp:a}=this.props,{collapsedGroups:l}=this.state;return!!(l.indexOf(n[a])>-1^r)});ye(this,"onDragStart",(n,r)=>{n&&(n.preventDefault(),n.stopPropagation()),this.el=A4(n.target,".nestable-item"),this.startTrackMouse(),this.onMouseMove(n),this.setState({dragItem:r,itemsOld:this.state.items})});ye(this,"onDragEnd",(n,r)=>{n&&n.preventDefault(),this.stopTrackMouse(),this.el=null,r?this.dragRevert():this.dragApply()});ye(this,"onMouseMove",n=>{const{group:r,threshold:a}=this.props,{dragItem:l}=this.state,{clientX:i,clientY:c}=n,d=D4(i,c),u=document.querySelector(".nestable-"+r+" .nestable-drag-layer > .nestable-list");if(this.elCopyStyles){this.elCopyStyles={...this.elCopyStyles,...d};for(let m in d)d.hasOwnProperty(m)&&(u.style[m]=d[m]);const p=i-this.mouse.last.x;p>=0&&this.mouse.shift.x>=0||p<=0&&this.mouse.shift.x<=0?this.mouse.shift.x+=p:this.mouse.shift.x=0,this.mouse.last.x=i,Math.abs(this.mouse.shift.x)>a&&(this.mouse.shift.x>0?this.tryIncreaseDepth(l):this.tryDecreaseDepth(l),this.mouse.shift.x=0)}else{const p=O4(this.el),m=P4(this.el);this.elCopyStyles={marginTop:p.top-c-m.top,marginLeft:p.left-i-m.left,...d}}});ye(this,"onMouseEnter",(n,r)=>{n&&(n.preventDefault(),n.stopPropagation());const{collapsed:a,idProp:l,childrenProp:i}=this.props,{dragItem:c}=this.state;if(c[l]===r[l])return;const d=this.getPathById(c[l]),u=this.getPathById(r[l]);let p={};if(a&&d.length>1){const m=this.getItemByPath(d.slice(0,-1));m[i].length===1&&(p=this.onToggleCollapse(m,!0))}this.moveItem({dragItem:c,pathFrom:d,pathTo:u},p)});ye(this,"onToggleCollapse",(n,r)=>{const{collapsed:a,idProp:l}=this.props,{collapsedGroups:i}=this.state,d={collapsedGroups:this.isCollapsed(n)^a?i.filter(u=>u!==n[l]):i.concat(n[l])};if(r)return d;this.setState(d)});ye(this,"onKeyDown",n=>{n.which===27&&this.onDragEnd(null,!0)});this.state={items:[],itemsOld:null,dragItem:null,isDirty:!1,collapsedGroups:[]},this.el=null,this.elCopyStyles=null,this.mouse={last:{x:0},shift:{x:0}}}componentDidMount(){let{items:n,childrenProp:r}=this.props;n=Si(n,r),this.setState({items:n})}componentDidUpdate(n){const{items:r,childrenProp:a}=this.props;if(Fe({props:n,state:{}},this.props)){this.stopTrackMouse();let i={};n.collapsed!==this.props.collapsed&&(i.collapsedGroups=[]),this.setState({items:Si(r,a),dragItem:null,isDirty:!1,...i})}}componentWillUnmount(){this.stopTrackMouse()}moveItem({dragItem:n,pathFrom:r,pathTo:a},l={}){const{childrenProp:i,confirmChange:c}=this.props,d=this.getItemDepth(n);let{items:u}=this.state;const p=this.getRealNextPath(r,a,d);if(p.length===0)return;const m=p.length>a.length?a:a.slice(0,-1),h=this.getItemByPath(m);if(!c({dragItem:n,destinationParent:h}))return;const f=this.getSplicePath(r,{numToRemove:1,childrenProp:i}),g=this.getSplicePath(p,{numToRemove:0,itemsToInsert:[n],childrenProp:i});u=Eu(u,f),u=Eu(u,g),this.setState({items:u,isDirty:!0,...l})}tryIncreaseDepth(n){const{maxDepth:r,idProp:a,childrenProp:l,collapsed:i}=this.props,c=this.getPathById(n[a]),d=c[c.length-1],u=c.length+this.getItemDepth(n);if(d>0&&u<=r){const p=this.getItemByPath(c.slice(0,-1).concat(d-1));if(!p[l].length||!this.isCollapsed(p)){const m=c.slice(0,-1).concat(d-1).concat(p[l].length);let h={};i&&!p[l].length&&(h=this.onToggleCollapse(p,!0)),this.moveItem({dragItem:n,pathFrom:c,pathTo:m},h)}}}tryDecreaseDepth(n){const{idProp:r,childrenProp:a,collapsed:l}=this.props,i=this.getPathById(n[r]),c=i[i.length-1];if(i.length>1){const d=this.getItemByPath(i.slice(0,-1));if(c+1===d[a].length){let u=i.slice(0,-1);u[u.length-1]+=1;let p={};l&&d[a].length===1&&(p=this.onToggleCollapse(d,!0)),this.moveItem({dragItem:n,pathFrom:i,pathTo:u},p)}}}dragApply(){const{onChange:n,idProp:r}=this.props,{items:a,isDirty:l,dragItem:i}=this.state;if(this.setState({itemsOld:null,dragItem:null,isDirty:!1}),n&&l){const c=this.getPathById(i[r],a);n({items:a,dragItem:i,targetPath:c})}}dragRevert(){const{itemsOld:n}=this.state;this.setState({items:n,itemsOld:null,dragItem:null,isDirty:!1})}getPathById(n,r=this.state.items){const{idProp:a,childrenProp:l}=this.props;let i=[];return r.every((c,d)=>{if(c[a]===n)i.push(d);else if(c[l]){const u=this.getPathById(n,c[l]);u.length&&(i=i.concat(d).concat(u))}return i.length===0}),i}getItemByPath(n,r=this.state.items){const{childrenProp:a}=this.props;let l=null;return n.forEach(i=>{l=(l?l[a]:r)[i]}),l}getSplicePath(n,r={}){const a={},l=r.numToRemove||0,i=r.itemsToInsert||[],c=n.length-1;let d=a;return n.forEach((u,p)=>{if(p===c)d.$splice=[[u,l,...i]];else{const m={};d[u]={[r.childrenProp]:m},d=m}}),a}getRealNextPath(n,r,a){const{childrenProp:l,maxDepth:i}=this.props,c=n.length-1,d=r.length-1,u=r.length+a-1;if(n.length<r.length){let p=!1;return u>i&&r.length?this.getRealNextPath(n,r.slice(0,-1),a):r.map((m,h)=>p?h===d?m+1:m:typeof n[h]!="number"?m:r[h]>n[h]&&h===c?(p=!0,m-1):m)}else if(n.length===r.length&&r[d]>n[d]){const p=this.getItemByPath(r);if(u<i&&p[l]&&p[l].length&&!this.isCollapsed(p))return r.slice(0,-1).concat(r[d]-1).concat(0)}return r}getItemOptions(){const{renderItem:n,renderCollapseIcon:r,handler:a,idProp:l,childrenProp:i}=this.props,{dragItem:c}=this.state;return{dragItem:c,idProp:l,childrenProp:i,renderItem:n,renderCollapseIcon:r,handler:a,onDragStart:this.onDragStart,onMouseEnter:this.onMouseEnter,isCollapsed:this.isCollapsed,onToggleCollapse:this.onToggleCollapse}}renderDragLayer(){const{group:n,idProp:r}=this.props,{dragItem:a}=this.state,l=document.querySelector(".nestable-"+n+" .nestable-item-"+a[r]);let i={};l&&(i.width=l.clientWidth),this.elCopyStyles&&(i={...i,...this.elCopyStyles});const c=this.getItemOptions();return e.jsx("div",{className:"nestable-drag-layer",children:e.jsx("ol",{className:"nestable-list",style:i,children:e.jsx(ku,{item:a,options:c,isCopy:!0})})})}render(){const{group:n,className:r}=this.props,{items:a,dragItem:l}=this.state,i=this.getItemOptions();return e.jsxs("div",{className:Eo(r,"nestable","nestable-"+n,{"is-drag-active":l}),children:[e.jsx("ol",{className:"nestable-list nestable-group",children:a.map((c,d)=>e.jsx(ku,{index:d,item:c,options:i},d))}),l&&this.renderDragLayer()]})}},ye(qr,"propTypes",{childrenProp:Le.string,className:Le.string,collapsed:Le.bool,confirmChange:Le.func,group:Le.oneOfType([Le.number,Le.string]),handler:Le.node,idProp:Le.string,items:Le.array,maxDepth:Le.number,onChange:Le.func,renderCollapseIcon:Le.func,renderItem:Le.func,threshold:Le.number}),ye(qr,"defaultProps",{childrenProp:"children",collapsed:!1,confirmChange:()=>!0,group:Math.random().toString(36).slice(2),idProp:"id",items:[],maxDepth:10,onChange:()=>{},renderItem:({item:n})=>String(n),threshold:30}),qr);function F4({item:t,dataItems:s,edit:n,open:r,setOpen:a}){return w.useContext(ke),e.jsx(Be.Root,{show:r,as:b.Fragment,children:e.jsxs(Je,{as:"div",className:"relative z-30",onClose:a,children:[e.jsx("div",{className:"fixed inset-0"}),e.jsx("div",{className:"fixed inset-0 overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:e.jsx(Be.Child,{as:b.Fragment,enter:"transform transition ease-in-out duration-500 sm:duration-700",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(Je.Panel,{className:"pointer-events-auto w-screen max-w-md",children:e.jsxs("div",{className:"flex h-full flex-col overflow-y-scroll bg-white py-6 shadow-xl",children:[e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(Je.Title,{className:"text-base font-semibold leading-6 text-gray-900",children:"Edit Pages"}),e.jsx("div",{className:"ml-3 flex h-7 items-center",children:e.jsxs("button",{type:"button",className:"relative rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none ",onClick:()=>a(!1),children:[e.jsx("span",{className:"absolute -inset-2.5"}),e.jsx("span",{className:"sr-only",children:"Close panel"}),e.jsx("i",{className:"h-6 w-6 fa fa-close","aria-hidden":"true"})]})})]})}),e.jsx("div",{className:"relative mt-6 flex-1 px-4 sm:px-6",children:e.jsx(V4,{item:t,dataItems:s,edit:n,open:r,setOpen:a})})]})})})})})})]})})}const Za={nav:{container:t=>"w-full ",navItemContainer:"h-full border-l overflow-y-auto overflow-x-hidden pt-3 scrollbar-xs",navItem:({isActive:t,isPending:s})=>`block px-4 py-2 font-light ${t?"w-[256px] bg-white text-blue-500 border-l border-y":"w-[248px] hover:bg-blue-100 text-slate-600"}`,navItemChild:({isActive:t,isPending:s})=>`block px-4 py-2 font-light ${t?"w-[238px] bg-white text-blue-500 border-l border-y":"w-[230px] hover:bg-blue-100 text-slate-600"}`,addItemButton:"cursor-pointer px-4 py-2 mt-3 hover:bg-blue-100 w-full text-slate-400 border-t border-slate-200"}};function ko(t,s,n,r){let a=s.filter(l=>l.parent===t.id).sort((l,i)=>l.index-i.index);return a.length===0?!1:a.map((l,i)=>{let c={id:l.id,Comp:()=>e.jsx(ha,{to:`${r?`${n}/edit`:n}/${l.url_slug||l.id}`,className:Za.nav.navItem,children:l.title},i)};return ko(c,s,n,r)&&(c.children=ko(l,s,n,r)),c})}function V4({item:t,dataItems:s,edit:n,open:r,setOpen:a}){const l=zt(),{pathname:i="/edit"}=kt(),{baseUrl:c}=w.useContext(ke),d=w.useCallback(m=>{let h=s.reduce((y,j)=>(y[j.id]=j,y),{});function f(y,j="",N){let _=[];return y.forEach((E,L)=>{let S=N[E.id];const k={id:S.id,index:S.index,title:S.title,url_slug:S.url_slug};(S.index!==L||S.parent!==j)&&(k.index=L,k.parent=j,_.push(k)),E.children&&(_=[..._,...f(E.children,E.id,N)])}),_}let g=f(m.items,"",h),x=[...g,...s.filter(y=>!g.map(j=>j.id).includes(y.id))];g.forEach(y=>y.url_slug=pn(y,x)),Promise.all(g.map(y=>{l(_a(y),{method:"post",action:i})})).then(y=>{})},[]),u=s.sort((m,h)=>m.index-h.index).filter(m=>!m.parent).map((m,h)=>{let f={id:m.id,index:m.index,Comp:()=>e.jsx(ha,{to:`${n?`${c}/edit`:c}/${m.url_slug||m.id}`,className:Za.nav.navItem,children:m.title})};return ko(f,s,c)&&(f.children=ko(m,s,c,n)),f}),p=m=>m.map(h=>{let f=h.Comp;return e.jsxs(w.Fragment,{children:[e.jsx(f,{}),h.children?e.jsx("div",{className:"border-l ml-4 pl-2",children:p(h.children)}):""]},h.id)});return e.jsx(e.Fragment,{children:e.jsx("div",{className:Za.nav.container(r),children:e.jsxs("div",{className:Za.nav.navItemContainer,children:[n?e.jsx(Ff,{items:u,onChange:d,maxDepth:4,renderItem:({item:m})=>{let h=m.Comp;return e.jsx(h,{})}}):p(u),n&&e.jsx(H4,{dataItems:s})]})})})}function H4({dataItems:t}){const s=zt(),{pathname:n="/edit"}=kt(),{baseUrl:r,user:a}=w.useContext(ke),i={title:"New Page",index:t.filter(d=>!d.parent).reduce((d,u)=>Math.max(isNaN(u.index)?-1:u.index,d),-1)+1,published:"draft",history:[{type:" created Page.",user:a.email,time:new Date().toString()}]};i.url_slug=pn(i,t);const c=()=>{s(_a(i),{method:"post",action:n})};return e.jsx("div",{className:"pr-2",children:e.jsx("div",{onClick:c,className:Za.nav.addItemButton,children:"+ Add Page"})})}function z4({item:t,dataItems:s,historyOpen:n,setHistoryOpen:r}){return w.useContext(ke),e.jsx(Be.Root,{show:n,as:b.Fragment,children:e.jsxs(Je,{as:"div",className:"relative z-30",onClose:r,children:[e.jsx("div",{className:"fixed inset-0"}),e.jsx("div",{className:"fixed inset-0 overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:e.jsx(Be.Child,{as:b.Fragment,enter:"transform transition ease-in-out duration-500 sm:duration-700",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(Je.Panel,{className:"pointer-events-auto w-screen max-w-md",children:e.jsxs("div",{className:"flex h-full flex-col overflow-y-auto bg-white py-6 shadow-xl",children:[e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(Je.Title,{className:"text-base font-semibold leading-6 text-gray-900",children:"Edit History"}),e.jsx("div",{className:"ml-3 flex h-7 items-center",children:e.jsxs("button",{type:"button",className:"relative rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none",onClick:()=>r(!1),children:[e.jsx("span",{className:"absolute -inset-2.5"}),e.jsx("span",{className:"sr-only",children:"Close panel"}),e.jsx("i",{className:"h-6 w-6 text-lg fa fa-close","aria-hidden":"true"})]})})]})}),e.jsx("div",{className:"relative mt-6 flex-1 px-4 sm:px-6",children:e.jsx(W4,{history:(t==null?void 0:t.history)||[]})})]})})})})})})]})})}function U4(...t){return t.filter(Boolean).join(" ")}function W4({history:t}){return e.jsx(e.Fragment,{children:e.jsx("ul",{role:"list",className:"space-y-6",children:t.sort((s,n)=>new Date(n.time)-new Date(s.time)).map((s,n)=>e.jsxs("li",{className:"relative flex gap-x-4",children:[e.jsx("div",{className:U4(n===t.length-1?"h-6":"-bottom-6","absolute left-0 top-0 flex w-6 justify-center"),children:e.jsx("div",{className:"w-px bg-gray-200"})}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative flex h-6 w-6 flex-none items-center justify-center bg-white",children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-gray-100 ring-1 ring-gray-300"})}),e.jsxs("p",{className:"flex-auto py-0.5 text-xs leading-5 text-gray-500",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.user})," ",s.type]}),e.jsx("time",{dateTime:s.time,className:"flex-none py-0.5 text-xs leading-5 text-gray-500",children:w_(s.time)})]})]},s.id))})})}function G4({item:t,dataItems:s,updateAttribute:n,setItem:r,apiUpdate:a,attributes:l,edit:i,status:c,pageType:d="page"}){const{baseUrl:u,user:p,falcor:m,falcorCache:h}=w.useContext(ke)||{},f=zt(),[g,x]=w.useState({showNav:!1,showHistory:!1,showDelete:!1}),y=t.published==="draft"||t.has_changes,j=N4(t,s,p,d,g,x,a);return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"w-full flex justify-center pb-6",children:e.jsxs(u4,{active:y,onClick:()=>j4(p,t,a),children:[e.jsxs("span",{children:[" ",y?"Publish":"No Changes"," "]}),y?e.jsx(bf,{className:"w-6 h-6"}):""]})}),e.jsx("div",{className:"w-full flex justify-center pb-6",children:e.jsxs(m4,{active:y,onClick:()=>w4(p,t,a),children:[e.jsxs("span",{children:[" ",y?"Discard":"No Changes"," "]}),y?e.jsx(Fc,{className:"w-6 h-6"}):""]})}),e.jsx(c4,{value:t==null?void 0:t.title,onChange:N=>v4(t,s,N,p,a),label:"page name"}),e.jsx("div",{className:"flex w-full h-12 px-4",children:j.map((N,_)=>e.jsx(i4,{icon:N.icon,onClick:N.onClick,children:N.name&&e.jsxs("div",{className:"py-2",children:[e.jsxs("div",{className:"px-6 font-medium text-sm",children:[" ",N.name," "]}),N.items.map((E,L)=>e.jsx(l4,{onClick:E.onClick,children:E.item},L))]})},_))}),e.jsx(Df,{title:`Delete Page ${t.title} ${t.id} `,open:g.showDelete,setOpen:N=>x({...g,showDelete:N}),onDelete:()=>{async function N(){await f(_a(t,"delete"),{method:"post",action:`${u}/edit/`}),x({...g,showDelete:!1})}N()}}),e.jsx(F4,{item:t,dataItems:s,edit:!0,open:g.showNav,setOpen:N=>x({...g,showNav:N})}),e.jsx(z4,{item:t,historyOpen:g.showHistory,setHistoryOpen:N=>x({...g,showHistory:N})})]})}function J4({item:t,dataItems:s,updateAttribute:n,attributes:r,setItem:a,apiUpdate:l,status:i,navOptions:c}){var E,L,S,k,$,I,T,A,R,O,M,D,P;const d=$e(),u=zt();kt();const{baseUrl:p,user:m,theme:h}=w.useContext(ke)||{};w.useState(!1);const f=w.useMemo(()=>rl(s,p,!0),[s]),g=(t==null?void 0:t.index)=="999"||((L=(E=h==null?void 0:h.navOptions)==null?void 0:E.topNav)==null?void 0:L.nav)!=="main"?1:pf(s,p),x=hf(t,h),y=((S=r==null?void 0:r.sections)==null?void 0:S.attributes)||{};w.useEffect(()=>{if(!(t!=null&&t.url_slug)){let F=s.sort((B,V)=>B.index-V.index).filter(B=>!B.parent&&B.url_slug)[0];F&&F.url_slug&&d(`edit/${F.url_slug}`)}},[]),w.useEffect(()=>{var F;if(t.sections&&((F=t==null?void 0:t.sections)==null?void 0:F.length)>0&&!t.draft_sections){const B=Ie(t.sections);B.forEach(G=>delete G.id);const V=Ie(t);V.draft_sections=B,t.draft_sections=B,n("draft_sections",B),u(_a(V),{method:"post",action:`${p}/edit/${V.url_slug}`})}},[]);const j=($=(k=t.draft_sections)==null?void 0:k.filter(F=>F.is_header))==null?void 0:$[0],N=(I=t.draft_sections)==null?void 0:I.filter(F=>!F.is_header&&!F.is_footer),_=w.useMemo(()=>r.sections.EditComp,[]);return e.jsxs("div",{children:[(t==null?void 0:t.header)==="above"&&e.jsx(_,{item:t,value:[j],onChange:(F,B)=>Dl(v,t,m,l),attributes:y}),e.jsx(Nr,{navItems:f,secondNav:((A=(T=h==null?void 0:h.navOptions)==null?void 0:T.secondaryNav)==null?void 0:A.navItems)||[],children:e.jsxs("div",{className:`${(R=h==null?void 0:h.page)==null?void 0:R.wrapper1} ${h==null?void 0:h.navPadding[g]}`,children:[(t==null?void 0:t.header)==="below"&&e.jsx(_,{item:t,value:[j],onChange:(F,B)=>Dl(v,t,m,l),attributes:y}),e.jsxs("div",{className:`${(O=h==null?void 0:h.page)==null?void 0:O.wrapper2}`,children:[(t==null?void 0:t.sidebar)==="show"&&e.jsx($o,{children:e.jsx(zc,{...x})}),e.jsxs("div",{className:((M=h==null?void 0:h.page)==null?void 0:M.wrapper3)+"",children:[(t==null?void 0:t.header)==="inpage"&&e.jsx(_,{item:t,value:[j],onChange:(F,B)=>Dl(v,t,m,l),attributes:y}),(m==null?void 0:m.authLevel)>=5&&e.jsx(je,{className:(D=h==null?void 0:h.page)==null?void 0:D.iconWrapper,to:`${p}/${(t==null?void 0:t.url_slug)||""}`,children:e.jsx(gf,{className:(P=h==null?void 0:h.page)==null?void 0:P.icon})}),e.jsx(_,{full_width:t.full_width,value:N,onChange:(F,B)=>g4(F,B,t,m,l),attributes:y})]}),e.jsx($o,{witdh:"w-52",children:e.jsx(G4,{item:t,dataItems:s,setItem:a,edit:!0,status:i,apiUpdate:l,attributes:r,updateAttribute:n,pageType:"page"})})]})]})}),(t==null?void 0:t.footer)&&e.jsx("div",{className:"h-[300px] bg-slate-100"})]})}const q4=({label:t,types:s,type:n,setType:r,multi:a=!1,size:l="small",disabled:i,disabledTitle:c,autoSelect:d=!0})=>(b.useEffect(()=>{var m,h;const u=((m=s[0])==null?void 0:m.value)||s[0];if(!u||!d||i)return;const p=a?[u]:u;(!n||Array.isArray(n)&&!((h=n.filter(f=>f))!=null&&h.length))&&r(p)},[s]),e.jsxs("div",{className:"my-1 flex flex-rows flex-wrap",title:i?c:null,children:[t&&e.jsx("div",{className:"p-2 pl-0 w-1/4",children:t}),e.jsx("span",{className:`
              
                space-x-1 rounded-lg bg-slate-100 py-0.5
                flex flex-row flex-wrap
                shadow-sm 
                ${l==="large"?"w-full":"w-fit"}`,children:s.map((u,p)=>{const m=(u==null?void 0:u.value)||u,h=a&&Array.isArray(n)?n:a&&!Array.isArray(n)?[n]:!a&&Array.isArray(n)?n[0]:n,f=a&&(h==null?void 0:h.includes(m))||!a&&h===m;return e.jsx("button",{type:"button",className:`
                            ${p!==0&&"-ml-px"} 
                            ${i&&"pointer-events-none"}
                            rounded-lg py-[0.4375rem] break-none
                            ${f?"text-gray-900 bg-white shadow":"text-gray-700"} hover:text-blue-500
                            min-w-[60px] min-h-[30px] uppercase
                            relative items-center px-2 text-xs items-center justify-center text-center 
                            focus:z-10`,onClick:()=>{const g=a&&(h!=null&&h.includes(m))?h.filter(x=>x!==m):a&&!(h!=null&&h.includes(m))?[...h,m]:m;r(g)},children:(u==null?void 0:u.label)||u},p)})})]}));function ua({options:t=[],onChange:s,value:n,nameAccessor:r=i=>(i==null?void 0:i.name)||i,valueAccessor:a,className:l}){const[i,c]=b.useState(""),d=i===""?t:t.filter(u=>(r(u)+"").toLowerCase().replace(/\s+/g,"").startsWith(i.toLowerCase().replace(/\s+/g,"")));return e.jsx("div",{className:"w-full",children:e.jsx(Ds,{value:n,onChange:s,children:e.jsxs("div",{className:"relative mt-1",children:[e.jsxs("div",{className:l||"relative w-full cursor-default overflow-hidden rounded-lg bg-white text-left shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 focus-visible:ring-offset-2 focus-visible:ring-offset-blue-300 sm:text-sm",children:[e.jsx(Ds.Input,{className:"w-full border-none py-2 pl-3 pr-10 text-sm leading-5 text-gray-900 focus:ring-0",displayValue:u=>r(u)||u,onChange:u=>c(u.target.value)}),e.jsx(Ds.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:e.jsx("div",{className:"h-5 w-5 text-gray-400 flex items-center justify-center","aria-hidden":"true",children:e.jsx("div",{class:"fa fa-chevron-down"})})})]}),e.jsx(Be,{as:b.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",afterLeave:()=>c(""),children:e.jsx(Ds.Options,{className:"z-50 absolute mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:d.length===0&&i!==""?e.jsx("div",{className:"relative cursor-default select-none py-2 px-4 text-gray-700",children:"Nothing found."}):d.filter((u,p)=>p<60).map((u,p)=>e.jsx(Ds.Option,{className:({active:m})=>`relative cursor-default select-none py-2 pl-10 pr-4 ${m?"bg-blue-600 text-white":"text-gray-900"}`,value:u,children:({selected:m,active:h})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${m?"font-medium":"font-normal"}`,children:r(u)||u}),m?e.jsx("span",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${h?"text-white":"text-blue-600"}`,children:e.jsx("div",{className:"h-5 w-5 flex items-center justify-center","aria-hidden":"true",children:e.jsx("div",{className:"fa fa-check"})})}):null]})},p))})})]})})})}const Vf=t=>Object.entries(t||{}).reduce((s,n)=>{const[r,a]=n;return typeof a.value<"u"?s[r]=a.value:s[r]=a,s},{}),K4=({source_id:t,value:s,onChange:n})=>{const{falcor:r,falcorCache:a,pgEnv:l}=w.useContext(ke);b.useEffect(()=>{async function c(){const d=["dama",l,"sources","byId",t,"views","length"],u=await r.get(d);await r.get(["dama",l,"sources","byId",t,"views","byIndex",{from:0,to:C(u.json,d,0)-1},"attributes",["view_id","version"]])}c()},[r,l]);const i=b.useMemo(()=>Object.values(C(a,["dama",l,"sources","byId",t,"views","byIndex"],{})).map(c=>Vf(C(a,c.value,{attributes:{}}).attributes)),[a,t,l]);return b.useEffect(()=>{var c;!s&&((c=i==null?void 0:i[0])!=null&&c.view_id)&&n(i==null?void 0:i[0])},[i]),e.jsx(ua,{options:["",...i],value:s,nameAccessor:c=>c==null?void 0:c.version,onChange:c=>n(c)})},Y4=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r,pgEnv:a}=w.useContext(ke);b.useEffect(()=>{async function i(){const c=["dama",a,"sources","length"],d=await n.get(c);await n.get(["dama",a,"sources","byIndex",{from:0,to:C(d.json,c,0)-1},"attributes",["source_id","name","metadata"]])}i()},[n,a]);const l=b.useMemo(()=>Object.values(C(r,["dama",a,"sources","byIndex"],{})).map(i=>Vf(C(r,i.value,{attributes:{}}).attributes)),[r,a]);return e.jsx(ua,{options:["",...l],value:t,onChange:i=>s(i)})};function Lu({icon:t,className:s}){return e.jsx("div",{className:`${s} flex justify-center items-center`,children:e.jsx("span",{className:t})})}const ll=({i:t=0,children:s,icon:n,to:r,onClick:a,className:l=null,type:i="side",active:c=!1,subMenus:d=[],themeOptions:u,subMenuActivate:p="onClick",subMenuOpen:m=!1})=>{const{theme:h}=w.useContext(ke),f=h[i==="side"?"sidenav":"topnav"](u),g=$e(),x=w.useMemo(()=>Array.isArray(r)?r:[r],[r]),y=w.useMemo(()=>{const T=d.reduce((A,R)=>(Array.isArray(R.path)?A.push(...R.path):R.path&&A.push(R.path),A),[]);return[...x,...T]},[x,d]),j=!!pc({path:`${y[0]}/*`||"",end:!0}),N=i==="side"?f.navitemSide:f.navitemTop,_=i==="side"?f.navitemSideActive:f.navitemTopActive,E=j||c,L=E?_:N,[S,k]=w.useState(m||j),[$,I]=w.useState(!1);return b.useEffect(()=>{k(j)},[j,S,r]),e.jsx("div",{className:i==="side"?f.subMenuParentWrapper:null,onMouseOutCapture:()=>p==="onHover"&&k(!1)||p!=="onHover"&&I(!1)&&k(!1),onMouseMove:()=>p==="onHover"&&k(!0)||p!=="onHover"&&I(!0)&&k(!0),children:e.jsx("div",{className:`${l||L}`,onClick:T=>{if(T.stopPropagation(),a)return a(x[0]);x[0]&&g(x[0])},children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-1 flex",children:[n?e.jsx(Lu,{icon:n,className:i==="side"?E?f.menuIconSideActive:f.menuIconSide:E?f.menuIconTopActive:f.menuIconTop}):null,e.jsx("div",{className:f.navItemContent,children:s})]}),e.jsx("div",{onClick:()=>{p==="onClick"&&k(!S)},children:d.length?e.jsx(Lu,{icon:S?f.indicatorIconOpen:f.indicatorIcon}):null}),d.length?e.jsx(Z4,{i:t,showSubMenu:S,subMenuActivate:p,active:j,hovering:$,subMenus:d,type:i,themeOptions:u,className:l}):""]})})})},Z4=({i:t,showSubMenu:s,subMenus:n,type:r,hovering:a,subMenuActivate:l,active:i,themeOptions:c})=>{const{theme:d}=w.useContext(ke),u=d[r==="side"?"sidenav":"topnav"](c),p=!i&&l!=="onHover"&&a;return(!s||!n.length)&&!p?null:e.jsx("div",{className:r==="side"?u.subMenuWrapper:p&&t===0?u.subMenuWrapperInactiveFlyout:p&&t>0?u.subMenuWrapperInactiveFlyoutBelow:u.subMenuWrapperTop,children:e.jsx("div",{className:`
							${p&&u.subMenuWrapperInactiveFlyoutDirection}
							${!p&&u.subMenuWrapperChild}
					flex ${r==="side"||p?"flex-col":"flex-row"}
				`,children:n.map((m,h)=>e.jsx(ll,{i:h+1,to:m.path,icon:m.icon,type:r,className:m.className,onClick:m.onClick,themeOptions:c,subMenus:m.subMenus,children:m.name},h))})})},Hf=({open:t,toggle:s,menuItems:n=[],rightMenu:r=null,themeOptions:a={}})=>{const{theme:l}=w.useContext(ke),i=l.topnav(a);return e.jsxs("div",{className:`${t?"md:hidden":"hidden"} ${i.topnavMobileContainer}`,id:"mobile-menu",children:[e.jsx("div",{className:"",children:n.map((c,d)=>e.jsx(ll,{type:"top",to:c.path,icon:c.icon,themeOptions:a,subMenus:C(c,"subMenus",[]),children:c.name},d))}),e.jsx("div",{className:"",children:r})]})},X4=({open:t,toggle:s,menuItems:n=[],rightMenu:r=null,leftMenu:a=null,subMenuActivate:l,themeOptions:i={}})=>{const{theme:c}=w.useContext(ke);let d=c.topnav(i);return e.jsx("div",{className:`${d.topnavWrapper}`,children:e.jsxs("div",{className:`${d.topnavContent} justify-between`,children:[e.jsx("div",{children:a}),e.jsx("div",{className:`${d.topnavMenu}`,children:n.map((u,p)=>e.jsx(ll,{type:"top",to:u.path,icon:u.icon,subMenuActivate:l,themeOptions:i,subMenus:C(u,"subMenus",[]),children:u.name},p))}),e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:`${d.topmenuRightNavContainer}`,children:r}),e.jsxs("button",{type:"button",className:`${d.mobileButton}`,onClick:()=>s(!t),children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),e.jsx("div",{className:"flex justify-center items-center text-2xl",children:e.jsx("span",{className:t?d.menuCloseIcon:d.menuOpenIcon})})]})]})]})})},Q4=({...t})=>{const[s,n]=b.useState(!1);return e.jsxs("nav",{children:[e.jsx(X4,{open:s,toggle:n,...t}),e.jsx(Hf,{open:s,...t})]})},zf=({i:t,item:s,themeOptions:n,subMenuActivate:r})=>e.jsx(ll,{to:s.path,icon:s.icon,className:s.className,onClick:s.onClick,themeOptions:n,subMenuActivate:r,subMenus:C(s,"subMenus",[]),children:s.name},t),e6=({open:t,toggle:s,logo:n=null,topMenu:r,menuItems:a=[],bottomMenu:l,themeOptions:i={},subMenuActivate:c,subMenuStyle:d,...u})=>{const{theme:p}=w.useContext(ke),m=p.sidenav(i);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:hidden",onClick:()=>s(!t),children:e.jsx("span",{className:t?m.menuIconOpen:m.menuIconClosed})}),e.jsxs("div",{style:{display:t?"block":"none"},className:"md:hidden",children:[e.jsx("div",{className:"fixed inset-0 z-20 transition-opacity ease-linear duration-300",children:e.jsx("div",{className:"absolute inset-0 opacity-75"})}),e.jsx("div",{className:`fixed inset-0 flex z-40 ${m.contentBgAccent}`,children:e.jsxs("div",{className:`flex-1 flex flex-col max-w-xs w-full transform ease-in-out duration-300 ${m.contentBg}`,children:[e.jsx("div",{className:"absolute top-0 right-0 -mr-14 p-1",children:e.jsx("button",{onClick:()=>s(!t),className:"flex items-center justify-center h-12 w-12 rounded-full focus:outline-none focus:bg-gray-600 os-icon os-icon-x"})}),e.jsxs("div",{className:"flex-1 h-0 pt-2 pb-4 overflow-y-auto overflow-x-hidden",children:[e.jsx("div",{className:"px-6 pt-4 pb-8 logo-text gray-900",children:e.jsx(je,{to:"/",className:`flex-shrink-0 flex items-center ${m.text}`,children:n})}),e.jsx("div",{children:r}),e.jsx("nav",{className:"flex-1",children:a.map((h,f)=>e.jsx("div",{className:h.sectionClass,children:zf({i:f,page:h,themeOptions:i,subMenuActivate:c})},f))}),e.jsx("div",{children:l})]})]})})]})]})},t6=({menuItems:t=[],logo:s=null,topMenu:n,bottomMenu:r,toggle:a,open:l,mobile:i,themeOptions:c={},subMenuActivate:d,subMenuStyle:u,...p})=>{const{theme:m}=w.useContext(ke),h=m.sidenav(c);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${h.sidenavWrapper}`,children:[n,e.jsx("nav",{className:`${h.itemsWrapper}`,children:t.map((f,g)=>zf({i:g,item:f,themeOptions:c,subMenuActivate:d}))}),r]}),i==="side"?"":e.jsx("div",{className:`${h.topnavWrapper} md:hidden`,children:e.jsxs("div",{className:`${h.topnavContent} justify-between`,children:[e.jsx("div",{children:n}),e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:`${h.topmenuRightNavContainer}`,children:r}),e.jsxs("button",{type:"button",className:h.mobileButton,onClick:()=>a(!l),children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),e.jsx("div",{className:"flex justify-center items-center text-2xl",children:e.jsx("span",{className:l?h.menuCloseIcon:h.menuOpenIcon})})]})]})]})})]})},Uf=t=>{const[s,n]=b.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(t6,{...t,open:s,toggle:n}),t.mobile==="side"?e.jsx(e6,{open:s,toggle:n,...t}):e.jsx(Hf,{open:s,...t,themeOptions:{}})]})};let s6={none:"",micro:"mr-14",mini:"mr-20",miniPad:"mr-0",compact:"mr-44",full:"mr-64"},n6={none:"",micro:"w-14",mini:"w-20",miniPad:"w-0",compact:"w-44",full:"w-64"};const a6=()=>e.jsx("div",{className:"h-12"}),r6=({children:t,menus:s,sideNav:n={},topNav:r={},title:a})=>{w.useContext(ke);const l={size:n.size||"none",color:n.color||"white",menuItems:n.menuItems||s,logo:(n==null?void 0:n.logo)||a6},i={position:r.position||"block",size:r.size||"compact",menu:r.menu||"left",subMenuStyle:r.subMenuStyle||"row",menuItems:(r.menuItems||[]).filter(d=>!d.hideInNav),logo:r.logo||e.jsxs("div",{className:"flex items-center justify-center h-12",children:[e.jsx("div",{to:"/",className:`${["none"].includes(l.size)?"":"md:hidden"}`}),a]}),rightMenu:r.rightMenu||e.jsx("div",{})},c=l.logo;return e.jsxs("div",{className:"flex",children:[l.size==="none"?"":e.jsx("div",{className:`hidden md:block ${s6[l.size]}`,children:e.jsx("div",{className:`fixed h-screen ${n6[l.size]}`,children:e.jsx(Uf,{topMenu:e.jsx(c,{sideNav:l}),themeOptions:l,menuItems:l.menuItems})})}),e.jsxs("div",{className:"flex-1 flex items-start flex-col items-stretch w-full min-h-screen",children:[i.size==="none"?"":e.jsx(e.Fragment,{children:e.jsx("div",{className:`${i.position==="fixed"?"sticky top-0 z-20 w-full ":""}`,children:e.jsx(Q4,{themeOptions:i,leftMenu:i.logo,menuItems:i.menuItems,rightMenu:i.rightMenu})})}),e.jsx("div",{id:"content",className:"flex-1",children:t})]})]})},o6=({column:t})=>{const{filterValue:s="",setFilter:n}=t,r={};return e.jsx("div",{className:"w-3/4",children:e.jsx("input",{className:r.inputSmall,value:s,onChange:a=>n(a.target.value),onClick:a=>a.stopPropagation(),placeholder:"Search..."})})},l6=({column:{filterValue:t,setFilter:s,preFilteredRows:n,id:r,filterMeta:a,filterDomain:l,onFilterChange:i,customValue:c,filterThemeOptions:d,filterClassName:u,filterMulti:p,filterRemovable:m=!0}})=>{const h=w.useMemo(()=>{const g=new Set;return a||(n.forEach(x=>{g.add(x.values[r])}),[...g.values()])},[a,r,n]).filter(g=>g),f=n.length;return e.jsx("div",{className:"",children:e.jsx("select",{domain:l||h,value:t||c||[],onChange:g=>{s(g||void 0),i(g||void 0)},placeHolder:`Search ${f} records...`,removable:m,multi:p,themeOptions:d,className:`${u}`})})};function i6(t,s,n){return Ln(t,n,{keys:[r=>r.values[s]]})}function c6(t,s,n){return t.filter(r=>{const a=r.values[s];return a!==void 0&&Array.isArray(n)&&n.length?n.includes(a):a!==void 0&&n.length?a===n:!0})}const d6=(t,s)=>{let n=t-2,r=t+2;n<0&&(r+=-n,n=0),r>s&&(n-=r-s,r=s);const a=[];for(let l=Math.max(0,n);l<=Math.min(s,r);++l)a.push(l);return a},u6=({values:t,theme:s})=>e.jsx("div",{className:"flex flex-col divide-y",children:t.map(({key:n,value:r},a)=>e.jsxs("div",{className:"flex-1 p-2",children:[n?e.jsxs("div",{className:"font-semibold",children:[n,":"]}):null,e.jsx("span",{className:!0,children:r})]},n||`key-${a}`))}),m6=({fetchData:t,manualPagination:s,theme:n,pageValue:r,pageCount:a,pageSize:l,pageIndex:i,statePageSize:c,totalRecords:d,rows:u,canNextPage:p,onPageSelect:m,onPrevPage:h,onNextPage:f,previousPage:g,gotoPage:x,nextPage:y})=>a<=1?null:e.jsxs("div",{className:`flex items-center flex-wrap ${n.textInfo}`,children:[e.jsxs("div",{className:"flex-0",children:["Page ",r+1," of ",a,e.jsx("br",{}),"Rows ",r*l+1," -",!t&&!s?Math.min(u.length,i*c+c):Math.min(d,r*l+l)," of ",!t&&!s?u.length:d]}),e.jsxs("div",{className:"flex-1 flex justify-end items-center",children:[e.jsx("button",{disabled:r===0,themeOptions:{size:"sm"},onClick:j=>!t&&!s?x(0):m(0),children:"<<"}),e.jsx("button",{disabled:r===0,themeOptions:{size:"sm"},onClick:j=>!t&&!s?g():h(),children:"<"}),d6(r,a-1).map(j=>{const N=j===r;return e.jsx("button",{themeOptions:{size:"sm",color:N?"primary":"white"},onClick:N?null:_=>!t&&!s?x(j):m(j),children:j+1},j)}),e.jsx("button",{disabled:!t&&!s?!p:r===a-1,themeOptions:{size:"sm"},onClick:j=>!t&&!s?y(0):f(j),children:">"}),e.jsx("button",{disabled:r===a-1,themeOptions:{size:"sm"},onClick:j=>!t&&!s?x(a-1):m(a-1),children:">>"})]})]}),p6=({row:t,expand:s,visibleColumns:n,ExpandRow:r,theme:a})=>!t.isExpanded||!s.length?null:e.jsx("tr",{className:a.tableRow,children:e.jsx("td",{colSpan:n.length,className:a.tableCell,children:e.jsx(r,{values:s})})}),h6=({ii:t,cell:s,row:n,columns:r,expand:a,expanded:l,toggleRowExpanded:i,theme:c})=>e.jsx("td",{...s.getCellProps({style:{minWidth:s.column.minWidth,maxWidth:s.column.maxWidth,width:s.column.width}}),className:`text-${C(r.find(d=>d.Header===s.column.Header),"align")||"center"} ${c.tableCell}`,children:t>0||n.subRows.length===0&&a.length===0?s.render("Cell"):e.jsxs("div",{className:"flex items-center ",children:[e.jsx("div",{onClick:d=>{d.stopPropagation(),d.preventDefault(),Object.keys(l).filter(u=>u!==n.id).forEach(i),n.toggleRowExpanded(!n.isExpanded)},className:`
                          flex item-center justify-center
                          rounded cursor-pointer py-1 px-2
                        h-full hover:text-blue-500
                           ${c.transition}
                        `,children:n.isExpanded?e.jsx("i",{className:"fal fa-chevron-down"}):e.jsx("i",{className:"fal fa-chevron-right"})}),e.jsx("div",{className:"flex-1",children:s.render("Cell")})]})},t),Iu=[],f6=()=>e.jsx("div",{children:"Loading..."}),g6=({columns:t=Iu,data:s=Iu,sortBy:n,sortOrder:r="",initialPageSize:a=10,manualPagination:l,fetchData:i,onPageChange:c,numRecords:d,manualCurrentPage:u,pageSize:p=5,onRowClick:m,onRowEnter:h,onRowLeave:f,ExpandRow:g=u6,disableFilters:x=!1,disableSortBy:y=!1,csvDownload:j=!1,onCsvDownload:N,themeOptions:_={},...E})=>{const[L,S]=w.useState(s||[]),[k,$]=w.useState(d||0),[I,T]=b.useState(u||0),[A,R]=b.useState(0),[O,M]=b.useState(!1),D={},P=w.useMemo(()=>({fuzzyText:i6,dropdown:c6}),[]),F=w.useMemo(()=>({dropdown:l6,text:o6}),[]),B=w.useMemo(()=>({Filter:!1}),[]),{getTableProps:V,getTableBodyProps:G,headerGroups:Z,page:X,rows:H,preFilteredRows:z,prepareRow:W,canPreviousPage:Y,canNextPage:U,gotoPage:q,previousPage:te,nextPage:K,pageCount:ne,visibleColumns:J,toggleRowExpanded:ae,setPageSize:de,state:{pageSize:ue,pageIndex:fe,expanded:ve}}=ls.useTable({columns:t,data:L,manualPagination:!!l||!!i,...(!!i||!!l)&&{pageCount:Math.ceil(k/p)},defaultColumn:B,filterTypes:P,disableFilters:x,disableSortBy:y,initialState:{pageSize:+p||+a,...n&&{sortBy:[{id:n,desc:r.toLowerCase()==="desc"}]}}},ls.useFilters,ls.useGlobalFilter,ls.useSortBy,ls.useExpanded,ls.usePagination);w.useEffect(()=>{p!==null&&p!==ue&&de(+p)},[p,ue,de]),w.useEffect(()=>{i&&(async()=>{M(!0);const{data:Q,length:pe}=await i({currentPage:I,pageSize:p});return{data:Q,length:pe}})().then(Q=>{S((Q==null?void 0:Q.data)||[]),$((Q==null?void 0:Q.length)||0),M(!1)})},[i,p,I]),w.useEffect(()=>{i||S(s)},[s,ne,i]),w.useEffect(()=>{!i&&k!==d&&$(d)},[d]),w.useEffect(()=>{R(i||l?I:fe)},[fe,I]);const se=b.useCallback(()=>{T(re=>re+1),c(I+1)},[]),me=b.useCallback(()=>{T(re=>re-1),c(I-1)},[]),xe=b.useCallback(re=>{I!==re&&T(re),c(re)},[I]);return!(t.length&&L.length)||!z.length?null:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"overflow-auto scrollbar-sm",children:[O&&e.jsx("div",{className:"z-10 absolute float-center text-center align-middle items-center w-full",style:{backgroundColor:"rgba(255,255,255,0.38)",width:"100%"},children:e.jsx(f6,{width:"100%",height:"100%"})}),j?e.jsx("div",{className:"w-full text-right",children:e.jsxs(mp,{data:L,headers:t.map(re=>({label:re.Header,key:re.accessor})),filename:"data.csv",className:D.downloadWrapper,children:[e.jsx("i",{className:D.downloadIcon||"fa fa-download"})," ",e.jsx("label",{children:"csv"})]})}):null,e.jsxs("table",{...V(),className:"w-full",children:[e.jsx("thead",{children:Z.map(re=>e.jsx("tr",{...re.getHeaderGroupProps(),children:re.headers.map(Q=>e.jsx("th",{...Q.getHeaderProps({...Q.getSortByToggleProps(),style:{minWidth:Q.minWidth,width:Q.width,maxWidth:Q.maxWidth}}),className:D.tableHeader,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex-1 pr-1",children:Q.render("Header")}),e.jsxs(e.Fragment,{children:[Q.info&&e.jsx("i",{className:`${D.infoIcon}`,title:Q.info}),Q.canSort?Q.isSorted?Q.isSortedDesc?e.jsx("i",{className:`ml-2 pt-1 ${D.sortIconDown}`}):e.jsx("i",{className:`ml-2 pt-1 ${D.sortIconUp}`}):e.jsx("i",{className:`ml-2 pt-1 ${D.sortIconIdeal}`}):null]})]}),e.jsx("div",{children:Q.canFilter?e.jsx("div",{children:Q.render(F[Q.filter]||"Filter")}):null})]})}))}))}),e.jsx("tbody",{...G(),children:X.map(re=>{const{onClick:Q,expand:pe=[]}=re.original;return W(re),e.jsxs(w.Fragment,{children:[e.jsx("tr",{...re.getRowProps(),onMouseEnter:typeof h=="function"?ge=>h(ge,re):null,onMouseLeave:typeof f=="function"?ge=>f(ge,re):null,className:`
                                        ${E.striped?D.tableRowStriped:D.tableRow}
                                        ${Q||m?"cursor-pointer":""}
                                    `,onClick:ge=>{typeof m=="function"&&m(ge,re),typeof Q=="function"&&Q(ge,re)},children:re.cells.map((ge,le)=>e.jsx(h6,{ii:le,cell:ge,row:re,columns:t,expand:pe,expanded:ve,toggleRowExpanded:ae,theme:D},le))}),e.jsx(p6,{row:re,expand:pe,visibleColumns:J,ExpandRow:g,theme:D})]},re.getRowProps().key)})})]})]}),e.jsx("div",{className:"w-full p-2",children:e.jsx(m6,{fetchData:i,manualPagination:l,theme:D,pageValue:A,pageCount:ne,pageSize:p,pageIndex:fe,statePageSize:ue,totalRecords:k,rows:H,canNextPage:U,onPageSelect:xe,onPrevPage:me,onNextPage:se,previousPage:te,gotoPage:q,nextPage:K,onPageChange:c})})]})},Wf=t=>typeof(t==null?void 0:t.value)=="object"?Wf(t.value):(t==null?void 0:t.value)||t,x6={"docs-play":"Playground","docs-page":"Live","docs-draft":"Draft","docs-ctp":"CTP Live"},Tu={"docs-play":"/playground","docs-page":"","docs-ctp":"","docs-draft":"/drafts"},Lo=({app:t,type:s,filter:n,action:r="load",tags:a,attributes:l=[{key:"id",label:"id"},{key:"app",label:"app"},{key:"type",label:"type"},{key:"data",label:"data"},{key:"updated_at",label:"updated_at"}]})=>({format:{app:t,type:s,attributes:l},children:[{type:()=>{},action:r,filter:{options:JSON.stringify({filter:n}),tags:a,attributes:l.map(i=>i.key)},path:"/"}]}),b6={view:"fa-thin fa-eye",edit:"fa-thin fa-pencil"},Mu={success:{textColor:"text-green-400",icon:"fa-thin fa-check"},error:{textColor:"text-red-400",icon:"fa-thin fa-warning"}},y6={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},v6=t=>Object.keys(t).find(s=>s.toLowerCase().includes("name")||s.toLowerCase().includes("title")),j6=(t,s,n)=>t==="geoid"?(n==null?void 0:n.county)||(n==null?void 0:n.name)||s:(n==null?void 0:n[v6(n)])||s,w6=({item:t,params:s,logo:n,rightMenu:r,baseUrl:a=""})=>{var k,$,I,T,A,R;const[l,i]=b.useState(10),{falcor:c,falcorCache:d,pgEnv:u,theme:p}=w.useContext(ke),{id:m}=s,h=($=(k=t.data_controls)==null?void 0:k.view)==null?void 0:$.view_id,f=(T=(I=t.data_controls)==null?void 0:I.id_column)==null?void 0:T.name,g=[t.type];if(!m)return null;const[x,y]=b.useState([]);b.useEffect(()=>{(async function(){const O=await g.reduce(async(M,D)=>{const P=await M,F=await Ns(c,Lo({app:"dms-site",type:D,filter:{"data->>'template_id'":[m]}}),"/");return[...P,...F]},Promise.resolve([]));y(O)})()},[m]),b.useEffect(()=>{h&&async function(){c.get(["dama",u,"viewsbyId",h,"data","length"])}()},[m,h]);const j=w.useMemo(()=>C(d,["dama",u,"viewsbyId",h,"data","length"],0),[m,u,h,d]);b.useEffect(()=>{h&&async function(){c.get(["dama",u,"viewsbyId",h,"databyIndex",{from:0,to:j-1},Object.keys(t.data_controls.active_row||{})])}()},[m,u,h,d]);const N=w.useMemo(()=>Object.values(C(d,["dama",u,"viewsbyId",h,"databyIndex"],{})).map(O=>C(d,[...O.value],"")),[m,f,h,d]),_=["view","edit"],E=["status"],L=["title","location","updated","status",..._].map(O=>({Header:_.includes(O)?"":O,accessor:O,..._.includes(O)&&{Cell:M=>e.jsx(je,{to:M.value,className:` ${b6[O]} px-2 py-1 mx-2 text-bold cursor-pointer`,title:O})},...E.includes(O)&&{Cell:M=>e.jsx("i",{className:`${Mu[M.value].icon} ${Mu[M.value].textColor} font-bold`,title:M.value})},...["updated"].includes(O)&&{Cell:M=>new Date(M.value).toLocaleDateString(void 0,y6)},filter:_.includes(O)||E.includes(O)?void 0:"text",disableSortBy:_.includes(O),align:_.includes(O)||E.includes(O)?"center":"left",width:_.includes(O)||E.includes(O)?"5%":"20%"})),S=x.map(({type:O,data:M,updated_at:D})=>{var F,B,V;const P=N.find(G=>G[f]===M.value.id_column_value);return{title:j6(f,M.value.id_column_value,P)||M.value.title,location:x6[O],view:`${Tu[O]}/${(F=M==null?void 0:M.value)==null?void 0:F.url_slug}`,edit:`${Tu[O]}/edit/${(B=M==null?void 0:M.value)==null?void 0:B.url_slug}`,updated:Wf(D),status:((V=M==null?void 0:M.value)==null?void 0:V.num_errors)>0?"error":"success"}});return e.jsx("div",{className:(A=p==null?void 0:p.page)==null?void 0:A.wrapper2,children:e.jsx("div",{className:(R=p==null?void 0:p.page)==null?void 0:R.wrapper3,children:e.jsx("div",{className:"py-6 h-full",children:e.jsxs("div",{className:"bg-white h-full shadow border max-w-6xl mx-auto px-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-2xl pt-3 font-thin flex-1",children:[e.jsx("span",{className:"font-semibold",children:t.title})," / Generated Pages"]}),e.jsxs("label",{className:"text-sm font-thin flex-1 italic",children:["Showing ",x==null?void 0:x.length," generated / ",j," available items"]})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("label",{children:"show"}),e.jsx("select",{className:"p-2 m-2 h-fit",value:l,onChange:O=>i(O.target.value),children:[10,25,50,75,100].map(O=>e.jsx("option",{value:O,children:O},O))}),e.jsx("label",{children:"rows"})]})]}),e.jsx("div",{className:"px-6 pt-8",children:e.jsx("div",{className:"shadow rounded border",children:e.jsx(g6,{data:S,columns:L,pageSize:l,sortBy:"updated",sortOrder:"desc"})})})]})})})})},Wc=(t,s={})=>{let n=s;try{n=JSON.parse(t)}catch{}return n},N6=(t,s,n)=>{s&&n([])},Gf=(t,s,n)=>{var a;let r=(a=t[0])==null?void 0:a.key;s(t),n&&n(r)},C6=({props:t,selected:s,setSelected:n,onChange:r})=>e.jsxs("div",{className:"w-fit inline-block ml-2",children:[t.label,e.jsx("button",{className:"hover:text-red-300 animate ml-1 p-1 rounded-md rbt-token-remove-button",onClick:a=>{const l=s.filter(i=>i.key!==t.key);Gf(l,n,r)},children:e.jsx("i",{className:"fa fa-close"})})]},t.label),_6=({results:t,menuProps:s,labelKey:n,filter:r,filters:a,setFilter:l,onChange:i,...c})=>e.jsxs(cn,{className:"bg-slate-100 overflow-hidden z-10 rounded-md",...s,children:[e.jsx("div",{className:"flex flex-row flex-wrap items-center justify-start gap-1 p-1 bg-slate-200 text-xs font-bold",children:a.map(({icon:d,label:u,value:p,filterText:m,onClick:h})=>{const f=r===m,g=x=>h?h(x):p?i(p):l(f?null:m);return e.jsxs("button",{title:`Filter by: ${m}`,className:`py-1 px-2 my-0.5 
                                    ${f?"bg-slate-300 hover:bg-blue-300":"bg-slate-100 hover:bg-blue-100"} 
                                     rounded-md`,onClick:x=>g(x),children:[e.jsx("i",{className:`${d} pr-2 pl-1`}),u]},m)})}),t.map((d,u)=>e.jsx(dn,{className:"block hover:bg-slate-200 text-xl tracking-wide pl-1",option:d,position:u,children:d.label},d.label))]}),S6=({className:t,value:s,onChange:n,options:r=[],filters:a=[],showAll:l=!1,placeholder:i="Search..."})=>{const[c,d]=b.useState([]),[u,p]=b.useState(""),[m,h]=b.useState(r);return b.useEffect(()=>{if(!s)return;const f=r.filter(g=>g.key===s);d(f)},[s]),b.useEffect(()=>{h(r.filter(f=>{var g;return!u||((g=f==null?void 0:f.label)==null?void 0:g.toLowerCase().includes(u.toLowerCase()))}))},[r,u]),e.jsx("div",{className:"flex justify-between",children:e.jsxs("div",{className:`flex flex row ${t} w-full shrink my-1 bg-white p-1 pl-3 rounded-l-md`,children:[e.jsx("i",{className:"fa fa-search font-light text-xl bg-white rounded-r-md"}),e.jsx(Ko,{className:"w-full",onSearch:N6,minLength:0,id:"search",placeholder:i,options:m,labelKey:f=>`${f==null?void 0:f.label}`,defaultSelected:c,onChange:f=>Gf(f,d,n),selected:c,inputProps:{className:"w-full flex flex-row flex-wrap p-2"},renderMenu:(f,g,x)=>_6({results:f,menuProps:g,labelKey:x,filters:a,filter:u,setFilter:p,onChange:n}),renderToken:f=>e.jsx(C6,{props:f,selected:c,setSelected:d,onChange:n})},"search")]})})};function Jf({position:t="above",bgImg:s="",logo:n="",title:r="Title",bgClass:a="",subTitle:l="subTitle",note:i="note"}){return e.jsxs("div",{className:`h-[300px] bg-cover bg-center w-full flex ${a}`,style:{backgroundImage:`url("${s}")`},children:[e.jsx("div",{className:"p-2",children:n&&e.jsx("img",{src:n,alt:"NYS Logo"})}),e.jsxs("div",{className:"flex-1 flex flex-col  items-center p-4",children:[e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"text-3xl sm:text-7xl font-bold text-[#f2a91a] text-right w-full text-display",children:r&&e.jsx("div",{children:r})}),e.jsx("div",{className:"text-lg tracking-wider pt-2 sm:text-3xl font-bold text-slate-200 text-right w-full uppercase",children:l&&e.jsx("div",{children:l})}),e.jsx("div",{className:"text-lg tracking-wider sm:text-xl font-bold text-slate-200 text-right w-full uppercase",children:i&&e.jsx("div",{children:i})}),e.jsx("div",{className:"flex-1"})]})]})}const $6=({position:t="above",bgImg:s="/img/header.png",logo:n="/img/nygov-logo.png",bgClass:r="",title:a="MitigateNY",subTitle:l="New York State Hazard Mitigation Plan",note:i="2023 Update"})=>new Promise((c,d)=>{c({position:t,bgImg:s,bgClass:r,logo:n,title:a,subTitle:l,note:i})}),qf=({value:t,onChange:s,size:n})=>{let r=b.useMemo(()=>t&&e0(t)?JSON.parse(t):{},[t]);b.useState(!0),b.useState("");const[a,l]=b.useState({bgImg:r.bgImg||"",logo:r.logo||"",title:r.title||"Title",subTitle:r.subTitle||"subTitle",note:r.note||"note",bgClass:r.bgClass||""});return b.useEffect(()=>{t!==JSON.stringify(a)&&s(JSON.stringify(a))},[a]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:[e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Title:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.title,onChange:i=>l({...a,title:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"subTitle:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.subTitle,onChange:i=>l({...a,subTitle:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Note:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.note,onChange:i=>l({...a,note:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Bg Class:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.bgClass,onChange:i=>l({...a,bgClass:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"bgImg:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.bgImg,onChange:i=>l({...a,bgImg:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"logo:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.logo,onChange:i=>l({...a,logo:i.target.value})})})]})]}),e.jsx(Jf,{...a})]})})},E6=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx(Jf,{...s})};qf.settings={hasControls:!0,name:"ElementEdit"};const k6={name:"Header: Default",type:"Header",variables:[{name:"bgImg",default:"/img/header.png"},{name:"logo",default:"/img/nygov-logo.png"},{name:"title",default:"MitigateNY"},{name:"subTitle",default:"New York State Hazard Mitigation Plan"},{name:"bgClass",default:""},{name:"note",default:"2023 Update"}],getData:$6,EditComp:qf,ViewComp:E6},Yt=(t,s="update")=>{let n=new FormData;return n.append("data",JSON.stringify(t)),n.append("requestType",s),n},L6=(t,s)=>t.parent?`${s.filter(r=>r.id===t.parent)[0].url_slug}/`:"",aa=(t,s)=>{let n=`${L6(t,s)}${Kf(t.title)}`;return t.url_slug&&t.url_slug===n||!s.map(r=>r.url_slug).includes(n)?n:`${n}_${t.index}`},Kf=t=>t&&t.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g).map(s=>s.toLowerCase()).join("_"),I6=t=>{if(typeof t=="object")return t;try{return JSON.parse(t)}catch{return t}},T6={"data->>'base_url' as base_url":{label:"Base Url",name:"base_url"},"data->>'doc_type' as doc_type":{label:"Doc Type",name:"doc_type"},"data->>'subdomain' as subdomain":{label:"Subdomain",name:"subdomain"},"data->>'authLevel' as authLevel":{label:"Auth Level",name:"authLevel"}},Io=[{name:"section_id",display_name:"id"},{name:"parent",display_name:"Parent"},{name:"page_title",display_name:"Page Title"},{name:"section_title",display_name:"Section Title"},{name:"element_type",display_name:"Type"},{name:"tags",display_name:"Tags"},{name:"url",display_name:"URL"},{name:"element_data",display_name:"DataSource"}],M6=({sections:t,pattern:s,fileName:n="sections"})=>{const r=async()=>{const a=(t||[]).map(i=>Io.reduce((c,{name:d})=>(c[d]=d==="url"?Yf({name:d,section:i,pattern:s}):d==="element_data"?Xf({section:i}):i[d],c),{})),l=Io.map(({name:i,display_name:c})=>({column:c,type:String,value:d=>d==null?void 0:d[i],...i==="url"&&{hyperlink:d=>d==null?void 0:d[i]}}));await yy(a,{schema:l,fileName:`${n}.xlsx`})};return e.jsx("button",{className:"p-1 border rounded-md group",onClick:r,children:e.jsx(M_,{className:"text-blue-500 group-hover:text-blue-700",height:20,width:20})})},Yf=({name:t,section:s,pattern:n})=>{var u;const r=t==="page_title"?s.url_slug:`${s.url_slug}#${s.section_id}`,a=(u=n.base_url)==null?void 0:u.replace("/",""),{protocol:l,host:i}=window.location,c=i.split(".").length>2?i.split(".").slice(1).join("."):i,d=typeof n.subdomain=="string"?`${n.subdomain}.${c}`:c;return a!=null&&a.length?`${l}//${d}/${a}/${r}`:`${l}//${d}/${r}`},Zf=(t,s,n)=>{if(n&&console.log("running for",t.page_title,t),!(s!=null&&s.length))return[];if(!t.page_parent)return[t];const r=s.find(a=>+a.page_id==+t.page_parent);return n&&console.log("parent for ",t.page_title,r,s),r?r.page_parent?[...Zf(r,s),t]:[r,t]:[]},Xf=({section:t})=>t.element_data?(Array.isArray(t.element_data)?t.element_data:[t.element_data]).map(n=>n.version).join(", "):null,B6=({value:t})=>t?e.jsx("div",{className:"flex flex-wrap",children:t.split(",").map((s,n)=>e.jsx("div",{className:"text-sm font-semibold text-white m-0.5 py-0.5 px-1 rounded-lg bg-red-300 h-fit w-fit",children:s},`${s}-${n}`))}):e.jsx("div",{className:"p-1",children:"N/A"}),A6=({value:t,section:s})=>{const n=Xf({section:s});return e.jsx("div",{children:n||"N/A"})},O6=({value:t})=>e.jsx("div",{className:"p-1 overflow-hidden",children:t||"N/A"}),P6=({value:t,section:s,name:n,pattern:r})=>{const a=Yf({name:n,section:s,pattern:r});return e.jsx(je,{className:"p-1 overflow-hidden",to:a,children:n==="url"?"link":t||"N/A"})},D6=({value:t,name:s,section:n,sections:r,pattern:a})=>s==="tags"?e.jsx(B6,{value:t}):s==="element_data"?e.jsx(A6,{value:t,section:n}):["page_title","section_title","url"].includes(s)?e.jsx(P6,{name:s,value:t,section:n,pattern:a}):e.jsx(O6,{value:t});async function R6({app:t,falcor:s}){const n=JSON.stringify({filter:{"data->>'pattern_type'":["page"]}}),r=["data->>'base_url' as base_url","data->>'doc_type' as doc_type","data->>'subdomain' as subdomain","data->>'authLevel' as authLevel"],a=["dms","data",`${t}+pattern`,"options",n,"length"],l=await s.get(a),i=C(l,["json",...a],0);if(!i)return;const c=["dms","data",`${t}+pattern`,"options",n,"byIndex"];await s.get([...c,{from:0,to:i-1},r]);const d=C(s.getCache(),c,{});return Object.values(d).map(u=>Object.keys(u).reduce((p,m)=>({...p,[T6[m].name]:u[m]}),{}))}async function Bu({app:t,pattern:s,falcor:n,setLoading:r}){r(!0);const a=["dms","data",`${t}+${s}`,"sections"];return await n.get(a),C(n.getCache(),[...a,"value"],{})}const Au=t=>t.map(s=>{const n=Zf(s,t),r=n.map(l=>l.page_title||l.url_slug).join("/"),a=n.map(l=>l.page_index).join("-");return{...s,parent:r,sortBy:a}}).filter(s=>s.parent&&s.sortBy).sort((s,n)=>s.sortBy.localeCompare(n.sortBy)),$i=({value:t,onChange:s,size:n})=>{const{app:r,baseUrl:a,falcor:l,falcorCache:i,...c}=b.useContext(ke)||{},d=I6(t)?JSON.parse(t):{},[u,p]=b.useState(!1),[m,h]=b.useState([]),[f,g]=b.useState(d.pattern||[]),[x,y]=b.useState(d.sections||[]);b.useState(0);const[j,N]=b.useState(!1);return b.useEffect(()=>{p(!0),R6({app:r,falcor:l}).then(_=>{h(_),p(!1),f&&(p(!0),Bu({app:r,pattern:f,falcor:l,setLoading:p}).then(E=>{y(Au(E)),p(!1)}))})},[]),b.useEffect(()=>{!(m!=null&&m.length)||!f||Bu({app:r,pattern:f,falcor:l,setLoading:p}).then(_=>{y(Au(_)),p(!1)})},[r,f]),b.useEffect(()=>{s&&s(JSON.stringify({...d,pattern:f}))},[f]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex w-full",children:[e.jsx("label",{htmlFor:"pattern-selector",children:"Pattern: "}),e.jsxs("select",{id:"pattern-selector",className:"flex-0 w-full p-1 bg-blue-100 hover:bg-blue-300 border rounded-md",value:f,onChange:_=>g(_.target.value),children:[e.jsx("option",{children:"please select a pattern"}),(m||[]).map(_=>e.jsx("option",{value:_.doc_type,children:_.doc_type},_.doc_type))]})]}),!u&&e.jsx(M6,{sections:x,pattern:m.find(_=>_.doc_type===f),fileName:`${f}_sections`})]}),e.jsxs("div",{className:"flex items-center p-1 text-sm rounded-md my-1 w-fit bg-gray-100 hover:bg-gray-200 cursor-pointer",onClick:()=>N(!j),children:[e.jsx("span",{className:"mr-1",children:"Filter Empty Tags"}),e.jsx(vr,{enabled:j,setEnabled:_=>N(_),label:"filter null tags",size:"small"})]}),e.jsx("div",{className:"grid grid-cols-8 divide-x font-semibold border-x border-t",children:Io.map(_=>e.jsx("div",{className:"p-1",children:_.display_name},_.name))}),u?e.jsx("div",{className:"w-full text-center",children:"loading..."}):e.jsx("div",{className:"max-h-[700px] overflow-auto scrollbar-sm border rounded-md",children:(x||[]).filter((_,E)=>{var L;return!j||((L=_.tags)==null?void 0:L.length)}).map(_=>e.jsx("div",{className:"grid grid-cols-8 divide-x divide-y font-light hover:bg-blue-100",children:Io.map(({name:E})=>e.jsx(D6,{value:_[E],name:E,section:_,sections:x,pattern:m.find(L=>L.doc_type===f)},`${_.section_id}_${E}`))},_.section_id))})]})};$i.settings={hasControls:!0,name:"ElementEdit"};const F6={name:"Table: Components Index",type:"table",variables:[],EditComp:$i,ViewComp:$i},V6=w.createContext(void 0),H6=async({file:t,user:s,etlContextId:n,damaServerPath:r,setGisUploadId:a,setLoading:l})=>{try{l(!0);const i=new FormData;i.append("etlContextId",n),i.append("user_id",s.userId),i.append("email",s.email),i.append("fileSizeBytes",t.size),i.append("file",t),console.log("sending upload");const c=await fetch(`${r}/gis-dataset/upload`,{method:"POST",body:i});console.log("sending upload finished ");const d=await c.json();if(Array.isArray(d)){const[{id:u}]=d;console.log("gisUploadId",u),a(u),l(!1)}else throw l(!1),d}catch(i){l(!1),console.error(i==null?void 0:i.message)}},z6=async({userId:t,email:s,gisUploadId:n,layerName:r,app:a,type:l,dmsServerPath:i,columns:c,setPublishing:d,setPublishStatus:u})=>{const p={user_id:t,email:s,gisUploadId:n,layerName:r,columns:c};d(!0);const h=await(await fetch(`${i}/dms/${a}+${l}/publish`,{method:"POST",body:JSON.stringify(p),headers:{"Content-Type":"application/json"}})).json();d(!1),u(!0),console.log("publishFinalEvent",h)},Ei=({value:t,onChange:s,size:n,format:r,apiLoad:a,apiUpdate:l,...i})=>{var F;const{API_HOST:c,user:d}=b.useContext(V6),u="hazmit_dama",p=`${c}/dama-admin/${u}`,m=`${c}/dama-admin`,[h,f]=b.useState(!1),[g,x]=b.useState(!1),[y,j]=b.useState(!1),[N,_]=b.useState(""),[E,L]=b.useState(),[S,k]=b.useState(),[$,I]=b.useState([]),[T,A]=b.useState(""),R="p-1.5 hover:bg-blue-100 rounded-sm",O=(F=JSON.parse(r.config||"{}"))==null?void 0:F.attributes,[M,D]=b.useState([]);b.useEffect(()=>{async function B(){const G=+await(await fetch(`${p}/etl/new-context-id`)).text();L(G)}B()},[u]),b.useEffect(()=>{if(S)try{(async V=>{var H;const G=`${p}/gis-dataset/${V}/layers`,X=await(await fetch(G)).json();I(X),A((H=X==null?void 0:X[0])==null?void 0:H.layerName)})(S)}catch(B){console.error(B)}},[S,p]),b.useEffect(()=>{var B,V;(B=$.find(G=>G.layerName===T))!=null&&B.fieldsMetadata&&D((V=$.find(G=>G.layerName===T))==null?void 0:V.fieldsMetadata.map(({name:G,display_name:Z},X)=>{const H=O.find(z=>z.display_name===Z||z.name===G);return{name:G||`col_${X+1}`,display_name:Z||G||`col_${X+1}`,existingColumnMatch:H==null?void 0:H.name,options:["select","multiselect"].includes(H==null?void 0:H.type)?H.options:null,required:(H==null?void 0:H.required)==="yes"}}))},[$,T]),console.log("columns",M);const P=O.filter(B=>M.filter(V=>V.existingColumnMatch===B.name).length>1);return y?e.jsxs("div",{className:"flex items-center justify-center w-full h-[150px] border rounded-md",children:["The Sheet has been Processed. To Validate your records, ",e.jsx(je,{className:"text-blue-500 hover:text-blue-700 px-1",to:"manage/validate",children:"click here"})]}):S?e.jsxs("div",{className:"w-full border p-2 rounded-md",children:[e.jsxs("div",{className:"w-full pb-4",children:[e.jsx("label",{htmlFor:"layer-selector",children:"Please select a sheet to upload:"}),e.jsx("select",{id:"layer-selector",className:"p-2 ml-4 bg-transparent border rounded-md hover:cursor-pointer",value:T,onChange:B=>A(B.target.value),children:($||[]).map(({layerName:B})=>e.jsx("option",{value:B,children:B},B))})]}),P.length?e.jsxs("div",{className:"p-2 border border-blue-300 rounded-md",children:[e.jsxs("div",{className:"flex items-center text-blue-500 font-semibold",children:["Pivot Columns",e.jsx(Rh,{className:"ml-1 text-blue-500 hover:text-blue-300 cursor-pointer",height:18,width:18,title:"These column headers will become values for the Destination column if there exists a value for a given row in the data."})]}),e.jsxs("div",{className:"grid grid-cols-2",style:{gridTemplateColumns:"1fr 2fr"},children:[e.jsx("div",{children:"Destination Column"}),e.jsx("div",{children:"Source Columns"})]}),P.map(B=>e.jsxs("div",{className:"grid grid-cols-2",style:{gridTemplateColumns:"1fr 2fr"},children:[e.jsx("div",{children:B.display_name||B.name}),e.jsx("div",{children:M.filter(V=>V.existingColumnMatch===B.name).map(V=>V.display_name||V.name).join(", ")})]},B.name))]}):null,M!=null&&M.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-1 hover:bg-blue-50 rounded-md grid grid-cols-3 font-semibold border-b",style:{gridTemplateColumns:"1fr 1fr 100px"},children:[e.jsxs("label",{className:"flex flex-wrap items-center",children:["Display Name",e.jsx("input",{className:"p-0.5 mx-1 border rounded-md text-sm font-light",value:N,onChange:B=>_(B.target.value),placeholder:"search..."})]}),e.jsx("label",{children:"Existing Column Match"}),e.jsx("label",{children:"GEO Column"})]}),e.jsx("div",{className:"flex flex-col max-h-[700px] overflow-auto scrollbar-sm",children:M.filter(({display_name:B,name:V})=>!N||(B||V).toLowerCase().includes(N.toLowerCase())).map(({name:B,display_name:V,existingColumnMatch:G,geo_col:Z})=>e.jsxs("div",{className:"p-0.5 hover:bg-blue-50 rounded-md grid grid-cols-3",style:{gridTemplateColumns:"1fr 1fr 100px"},children:[e.jsx("div",{className:R,children:V},`${B}_display_name`),e.jsxs("select",{className:G?R:`${R} bg-red-50`,value:G,onChange:X=>D(M.map(H=>H.name===B?{...H,existingColumnMatch:X.target.value}:H)),children:[e.jsx("option",{children:"Please select..."}),O.sort((X,H)=>{var z;return(z=X==null?void 0:X.display_name)==null?void 0:z.localeCompare(H==null?void 0:H.display_name)}).map(({name:X,display_name:H})=>e.jsx("option",{value:X,children:H||X},X))]},`${B}_select_existing_col`),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{className:"",type:"checkbox",checked:Z||!1,onChange:()=>{},onClick:X=>{D(M.map(H=>H.name===B?{...H,geo_col:X.target.checked}:H))}})},`${B}_geo_col_div`)]},B))}),e.jsx("div",{className:"mt-1 flex justify-end",children:e.jsx("button",{className:"p-1 bg-blue-300 hover:bg-blue-600 text-white rounded-md",disabled:g,onClick:()=>z6({...d,gisUploadId:S,layerName:T,app:r.app,type:r.type,dmsServerPath:m,columns:M,publishStatus:y,setPublishStatus:j,setPublishing:x}),children:g?"publishing...":"publish"})})]}):e.jsx("div",{children:"No columns available."})]}):e.jsx("div",{className:"w-full h-[300px]",children:e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{htmlFor:"dropzone-file",className:"flex flex-col items-center justify-center w-full h-96 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-gray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-8 h-8 mb-4 text-gray-500 dark:text-gray-400","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 16",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"})}),h?e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Uploading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"CSV or Excel"})]})]}),e.jsx("input",{disabled:h,id:"dropzone-file",type:"file",className:"hidden",onChange:B=>H6({file:B.target.files[0],user:d,etlContextId:E,damaServerPath:p,setGisUploadId:k,setLoading:f})})]})})})};Ei.settings={hasControls:!0,name:"ElementEdit"};const U6={name:"Upload",type:"Upload",variables:[],EditComp:Ei,ViewComp:Ei},W6=t=>{try{return JSON.parse(t)}catch{return{}}},G6=({title:t,className:s,color:n,setColor:r})=>e.jsxs("div",{className:s,children:[e.jsx("label",{className:"shrink-0 pr-2 w-1/4",children:t}),e.jsx("input",{id:"background",list:"colors",className:"rounded-md shrink",type:"color",value:n,onChange:a=>r(a.target.value)}),e.jsx("datalist",{id:"colors",children:["rgba(0,0,0,0)","#1e3a8a","#1e40af","#1d4ed8","#2563eb","#3b82f6","#60a5fa","#93c5fd","#bfdbfe","#dbeafe","#eff6ff","#713f12","#854d0e","#a16207","#ca8a04","#eab308","#facc15","#fde047","#fef08a","#fef9c3","#fefce8"].map(a=>e.jsx("option",{children:a},a))})]}),Qf=({value:t,onChange:s})=>{const n=W6(t),r={text:"",size:"4xl",color:"rgab(0,0,0,0)"},[a,l]=b.useState((n==null?void 0:n.bgColor)||"rgba(0,0,0,0)"),[i,c]=b.useState((n==null?void 0:n.text)||t||r);b.useEffect(()=>{s(JSON.stringify({bgColor:a,text:i}))},[a,i]);const d=gt.lexical.EditComp;return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsx(G6,{title:"Background: ",className:"w-full px-2 py-1 flex flex-row text-sm items-center border border-dashed",color:a,setColor:l}),e.jsx(d,{value:i,onChange:c,bgColor:a})]})})};Qf.settings={hasControls:!0,name:"ElementEdit"};const J6=({value:t})=>{var a,l,i,c,d,u,p,m;if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);const n=(s==null?void 0:s.text)||t;if(!n||((l=(a=n==null?void 0:n.root)==null?void 0:a.children)==null?void 0:l.length)===1&&((u=(d=(c=(i=n==null?void 0:n.root)==null?void 0:i.children)==null?void 0:c[0])==null?void 0:d.children)==null?void 0:u.length)===0||((m=(p=n==null?void 0:n.root)==null?void 0:p.children)==null?void 0:m.length)===0)return null;const r=gt.lexical.ViewComp;return e.jsx("div",{children:e.jsx(r,{value:n,bgColor:s==null?void 0:s.bgColor})})},q6={name:"Rich Text",EditComp:Qf,ViewComp:J6},K6={lexical:q6,"Header: Default Header":k6,Title:U5,Spreadsheet:n3,Item:r3,Upload:U6,"Table: Components Index":F6};let Ht=K6;const e0=t=>{try{JSON.parse(t)}catch{return!1}return!0},Y6={card:"fa-thin fa-credit-card",table:"fa-thin fa-table",graph:"fa-thin fa-chart-column",map:"fa-thin fa-map",lexical:"fa-thin fa-text"};function Z6(t){const{value:s,onChange:n,size:r,...a}=t,[l,i]=b.useState(),c=(p,m)=>{Fe(s,{...s,[p]:m})||n({...s,[p]:m})};b.useEffect(()=>{s!=null&&s["element-type"]||n({...s,"element-type":"lexical"})},[]);let d=(Ht[C(s,"element-type","lexical")]||Ht.lexical).EditComp;const u=async p=>{p.preventDefault();try{const m=await navigator.clipboard.readText(),h=e0(m)&&JSON.parse(m||"{}");if(!h||!h["element-type"])return;i(h["element-type"]),c("element-type",h["element-type"]),c("element-data",h["element-data"]),n({...s,...h})}catch(m){console.error("<paste>",m)}};return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"relative my-1",children:e.jsx(S6,{contentEditable:!0,className:"flex-row-reverse",placeholder:"Search for a Component...",options:Object.keys(Ht).filter(p=>!Ht[p].hideInSelector).map(p=>({key:p,label:Ht[p].name||p})),value:s==null?void 0:s["element-type"],onChange:async p=>{p==="paste"||c("element-type",p)},filters:[{icon:"fa-thin fa-paste",label:"Paste",value:"paste",onClick:u},...[...new Set(Object.keys(Ht).filter(p=>!Ht[p].hideInSelector).map(p=>(Ht[p].name||p).split(":")[0]))].map(p=>({icon:`${Y6[p.toLowerCase()]||p.toLowerCase()}`,label:p,filterText:p}))]})}),e.jsx("div",{children:e.jsx(d,{value:(s==null?void 0:s["element-data"])||"",onChange:p=>c("element-data",p),size:r,...a},l||"")})]})}function X6({value:t,...s}){let n=Ht[C(t,"element-type","lexical")]?Ht[C(t,"element-type","lexical")].ViewComp:()=>e.jsxs("div",{children:[" Component ",t["element-type"]," Not Registered "]});return e.jsx(n,{value:(t==null?void 0:t["element-data"])||"",...s})}const t0={EditComp:Z6,ViewComp:X6},Q6=(t={})=>{Ht={...Ht,...t}},Dr=async({item:t,url:s,destination:n,id_column:r,dataRows:a,falcor:l,setLoadingStatus:i,locationNameMap:c,setGeneratedPages:d,from:u,to:p,urlSuffixCol:m="geoid"})=>{i("Generating Pages...",a);const h=a.filter((x,y)=>!u||!p||y>=u&&y<=p).sort((x,y)=>x!=null&&x.state_fips?+y[r.name]-+x[r.name]:!0).map(x=>x[r.name]);let f=0;const g=[];await Ou(h,async(x,y)=>{var k,$,I,T;const j=await c.reduce(async(A,R)=>(await A,(await Ns(l,Lo({app:"dms-site",type:R,filter:{"data->>'template_id'":[t.id],"data->>'id_column_value'":[x]}}),"/"))[0]),Promise.resolve([])),N=((I=($=(k=j==null?void 0:j.data)==null?void 0:k.value)==null?void 0:$.sections)==null?void 0:I.map(A=>A.id))||[];i(`${j?"Updating":"Generating"} page ${++f}/${h==null?void 0:h.length}`);const _=await N.reduce(async(A,R)=>{const O=await A,M=await Ns(l,Lo({app:"dms-site",type:"cms-section",filter:{id:[R]}}),"/");return[...O,...M]},Promise.resolve([])),E=t.data_controls,L=a.find(A=>A[r.name]===x)||{};let S=await Promise.allSettled(t.sections.map(A=>A.id).map(A=>{var G,Z,X,H;let R=t.sections.find(z=>z.id===A)||{},O=Wc((G=R==null?void 0:R.element)==null?void 0:G["element-data"])||{},M=((Z=R==null?void 0:R.element)==null?void 0:Z["element-type"])||"",D=Ht[M]||{},P=((D==null?void 0:D.variables)||[]).reduce((z,W)=>(z[W.name]=W.name===r.name?x:O[W.name],z),{}),F=Object.keys(((X=E==null?void 0:E.sectionControls)==null?void 0:X[A])||{}).reduce((z,W)=>{var U,q,te,K,ne,J;const Y=((te=(q=(U=E==null?void 0:E.sectionControls)==null?void 0:U[A])==null?void 0:q[W])==null?void 0:te.name)||((ne=(K=E==null?void 0:E.sectionControls)==null?void 0:K[A])==null?void 0:ne[W]);return z[W]=Y===r.name?x:L[Y]||((J=E==null?void 0:E.active_row)==null?void 0:J[Y])||null,z},{}),B=(H=O.additionalVariables)==null?void 0:H.map(z=>{var U,q;const W=z.name,Y=(q=(U=E==null?void 0:E.sectionControls)==null?void 0:U[A])==null?void 0:q[W];return z.defaultValue=L==null?void 0:L[Y],z}),V={...P,...F,additionalVariables:B};try{return D!=null&&D.getData?D.getData(V,l).then(async z=>({section_id:A,data:z,type:M})):{section_id:A,data:O,type:M}}catch(z){return console.error("<generatePages> Error: ",x,z),{section_id:A,data:O,err:z,type:M}}}));if(await l.setCache({}),console.log("updates",S),S.length>0){const A=t.sections.map(F=>{var B;return((B=S.find(V=>{var G;return((G=V==null?void 0:V.value)==null?void 0:G.section_id)===F.id}))==null?void 0:B.value)||F}).filter(F=>F).map(({section_id:F,data:B,err:V,type:G})=>{var z;let Z=t.sections.find(W=>W.id===F)||{},X=_.find(W=>W.data.value.element["template-section-id"]===F)||{},H=((z=X==null?void 0:X.data)==null?void 0:z.value)||{element:{}};return X!=null&&X.id&&(H.id=X==null?void 0:X.id),H.title=Z.title,H.level=Z.level,H.size=Z.size,H.tags=Z.tags,H.status=V?JSON.stringify(V,Object.getOwnPropertyNames(V)):"success",H.element["element-data"]=JSON.stringify(B),H.element["element-type"]=G,H.element["template-section-id"]=F,H}),R="dms-site",O=n||t.type,D={format:{app:R,type:"cms-section"}},P={format:{app:R,type:O}};try{const F=await Ou(A.map(Z=>ar(l,D,Z)),Z=>Z,{concurrency:25,saveResponse:!0}),V=m==="county"&&(Z=>Z.toLowerCase().replace(" county","").replace(".","").replace(/ /g,"_"))((L==null?void 0:L.county)||(L==null?void 0:L.name))||x,G={...j&&{id:j.id},...((T=j==null?void 0:j.data)==null?void 0:T.value)||{},id_column_value:x,template_id:t.id,sidebar:t.sidebar,header:t.header,footer:t.footer,full_width:t.full_width,hide_in_nav:"true",index:999,url_slug:`${s||r.name}/${V}`,title:`${r.name} ${x} Template`,num_errors:A.filter(Z=>Z.status!=="success").length,sections:[...A.map((Z,X)=>{var H;return{id:Z.id||((H=F[X])==null?void 0:H.id),ref:"dms-site+cms-section"}}),..._.filter(Z=>!Z.data.value.element["template-section-id"]).map((Z,X)=>({id:Z.id,ref:"dms-site+cms-section"}))],draft_sections:[...A.map((Z,X)=>{var H;return{id:Z.id||((H=F[X])==null?void 0:H.id),ref:"dms-site+cms-section"}}),..._.filter(Z=>!Z.data.value.element["template-section-id"]).map((Z,X)=>({id:Z.id,ref:"dms-site+cms-section"}))]};try{const Z=await ar(l,P,G);g.push({id:Z==null?void 0:Z.id,num_errors:G.num_errors,id_column_value:G.id_column_value})}catch(Z){console.error("<generatePages> Create/Update Page Error:",x,Z)}}catch(F){console.error("<generatePages> Create/Update Sections Error:",x,F)}}},{concurrency:20,saveResponse:!1}),d(g),i(void 0)};function Ou(t,s,n={}){let r=n.concurrency||1/0,a=0;const l=[],i=[],c=t[Symbol.iterator]();for(;r-- >0;){const u=d();if(u)i.push(u);else break}return Promise.all(i).then(()=>l);function d(){const u=c.next();if(u.done)return null;const p=a++,m=s(u.value,p);return Promise.resolve(m).then(h=>(n.saveResponse&&(l[p]=h),console.log("size of the results object in PromiseMap:",JSON.stringify(l).length,l),d()))}}const s0=({submit:t,item:s,onChange:n,loadingStatus:r,setLoadingStatus:a=()=>{}})=>{var D;const{falcor:l,falcorCache:i,pgEnv:c}=w.useContext(ke),[d,u]=b.useState([]),[p,m]=b.useState(!1),[h,f]=b.useState("geoid"),[g,x]=b.useState({}),{url:y,destination:j=s.type,source:N,view:_,view_id:E,id_column:L,active_row:S}=s==null?void 0:s.data_controls;if(!(_!=null&&_.view_id))return null;const k=[j];w.useEffect(()=>{l.get(["dama",c,"viewsbyId",_.view_id,"data","length"])},[c,_.view_id]);const $=w.useMemo(()=>C(i,["dama",c,"viewsbyId",_.view_id,"data","length"],0),[c,_.view_id,i]),I=w.useMemo(()=>{let P=C(N,["metadata","columns"],C(N,"metadata",[]));return Array.isArray(P)||(P=[]),P.filter(F=>!["geom","wkb_geometry","ogc_fid"].includes(F==null?void 0:F.name))},[N]);w.useEffect(()=>{_!=null&&_.view_id&&(L!=null&&L.name)&&$&&l.get(["dama",c,"viewsbyId",_.view_id,"databyIndex",{from:0,to:$-1},I.map(P=>P.name)])},[L,_.view_id,$]);const T=w.useMemo(()=>Object.values(C(i,["dama",c,"viewsbyId",_.view_id,"databyIndex"],{})).map(P=>C(i,[...P.value],"")),[L,_.view_id,i]);w.useEffect(()=>{(async function(){a("Loading Pages...");const P=await k.reduce(async(F,B)=>{const V=await F,G=[{key:"id",label:"id"},{key:"data->>'id_column_value' as id_column_value",label:"id_column_value"},{key:"data->>'num_errors' as num_errors",label:"num_errors"}];let Z=await Ns(l,Lo({app:"dms-site",type:B,filter:{"data->>'template_id'":[s.id]},attributes:G}),"/");return Z=Z.map(X=>G.reduce((H,z)=>(H[z.label]=X[z.key],H),{})),[...V,...Z]},Promise.resolve([]));u(P),a(void 0)})()},[s.id,(D=s.data_controls)==null?void 0:D.sectionControls]);const A=b.useMemo(()=>d.filter(P=>typeof+P.num_errors=="number"&&+P.num_errors>0).map(P=>P.id_column_value.toString()),[d]),R=b.useMemo(()=>d.filter(P=>P.id_column_value&&typeof P.id_column_value!="object").map(P=>P.id_column_value.toString()),[d]),O=b.useMemo(()=>T.filter(P=>{var F;return!R.includes((F=P[L.name])==null?void 0:F.toString())}),[R,T,L.name]),M=b.useMemo(()=>T.filter(P=>{var F;return A.includes((F=P[L.name])==null?void 0:F.toString())}),[A,T,L.name]);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs uppercase font-bold text-slate-400 ml-4",children:" url suffix "}),e.jsx(ua,{className:"ml-2.5 relative w-full cursor-default overflow-hidden bg-transparent border-b-2 border-slate-300 text-slate-500 text-left sm:text-sm",options:I.map(P=>P.name),value:h,nameAccessor:P=>P==null?void 0:P.name,valueAccessor:P=>P==null?void 0:P.name,onChange:P=>f(P)}),e.jsx(ua,{options:["",...I],value:L,nameAccessor:P=>P==null?void 0:P.name,valueAccessor:P=>P==null?void 0:P.name,onChange:P=>n("id_column",P)}),L!=null&&L.name?e.jsx(ua,{options:T,value:S,nameAccessor:P=>(L==null?void 0:L.name)==="geoid"&&((P==null?void 0:P.county)||(P==null?void 0:P.name))||(P==null?void 0:P[L==null?void 0:L.name]),onChange:P=>n("active_row",{active_row:P})}):"",e.jsx("div",{className:"flex items-center pt-2",children:d!=null&&d.length||T!=null&&T.length?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("button",{className:`inline-flex w-36 justify-center rounded-lg cursor-pointer text-sm font-semibold 
                                            py-2 px-2 text-white shadow-lg border active:border-b-2 active:mb-[2px] active:shadow-none 
                                            ${r?"bg-gray-500 border-b-2 border-gray-800 cursor-not-allowed":"bg-blue-500 hover:bg-blue-400 border-b-4 border-blue-800 hover:border-blue-700"}`,disabled:r,onClick:P=>Dr({item:s,url:y,destination:j,id_column:L,dataRows:T,falcor:l,setLoadingStatus:a,locationNameMap:k,setGeneratedPages:u,urlSuffixCol:h}),children:r||(d!=null&&d.length?"Update Pages":"Generate Pages")}),e.jsx("button",{disabled:r,className:`inline-flex rounded-lg cursor-pointer text-white text-bold px-2 py-2.5 shadow-lg
                                border active:border-b-2 active:mb-[2px] active:shadow-none 
                                ${r?"bg-gray-500 border-b-2 border-gray-800 cursor-not-allowed":"bg-blue-500 hover:bg-blue-400 border-b-4 border-blue-800 hover:border-blue-700"}`,onClick:()=>m(!p),children:e.jsx("i",{className:p?"fa fa-caret-up":"fa fa-caret-down"})})]}),e.jsxs("div",{className:p?"flex flex-col":"hidden",children:[e.jsx("button",{className:`inline-flex w-36 justify-center rounded-lg text-sm font-semibold 
                                            py-2 px-2 text-white shadow-lg border active:border-b-2 active:mb-[2px] active:shadow-none' 
                                            ${r||!(O!=null&&O.length)?"bg-gray-500 border-b-2 border-gray-800 cursor-not-allowed":"bg-blue-500 hover:bg-blue-400 border-b-4 border-blue-800 hover:border-blue-700 cursor-pointer"}`,disabled:r||!(O!=null&&O.length),onClick:P=>(m(!1),Dr({item:s,url:y,destination:j,id_column:L,dataRows:O,falcor:l,setLoadingStatus:a,locationNameMap:k,setGeneratedPages:u,urlSuffixCol:h})),children:r||`Generate missing pages (${O==null?void 0:O.length})`}),e.jsx("button",{className:`inline-flex w-36 justify-center rounded-lg text-sm font-semibold 
                                            py-2 px-2 text-white shadow-lg border active:border-b-2 active:mb-[2px] active:shadow-none' 
                                            ${r||!(M!=null&&M.length)?"bg-gray-500 border-b-2 border-gray-800 cursor-not-allowed":"bg-blue-500 hover:bg-blue-400 border-b-4 border-blue-800 hover:border-blue-700 cursor-pointer"}`,disabled:r||!(M!=null&&M.length),onClick:P=>(m(!1),Dr({item:s,url:y,destination:j,id_column:L,dataRows:M,falcor:l,setLoadingStatus:a,locationNameMap:k,setGeneratedPages:u,urlSuffixCol:h})),children:r||`Update errored pages (${M==null?void 0:M.length})`}),e.jsxs("div",{className:`inline-flex flex-col w-36 justify-center rounded-lg text-sm font-semibold 
                                            py-2 px-2 shadow-lg border active:border-b-2 active:mb-[2px] active:shadow-none' 
                                            bg-blue-100 border-b-4 border-blue-500`,children:[e.jsxs("div",{className:"w-full flex py-1",children:[e.jsxs("select",{className:"p-1 border hover:cursor-pointer rounded-md",value:g.from,onChange:P=>x({...g,from:P.target.value}),children:[e.jsx("option",{children:"from"}),Array.from({length:T.length},(P,F)=>F).map(P=>e.jsx("option",{value:P,children:P+1},P))]}),e.jsxs("select",{className:"p-1 border hover:cursor-pointer rounded-md",value:g.to,onChange:P=>x({...g,to:P.target.value}),children:[e.jsx("option",{children:"to"}),Array.from({length:T.length},(P,F)=>F).map(P=>e.jsx("option",{value:P,children:P+1},P))]})]}),r||e.jsx("button",{className:"w-full text-white bg-blue-500 hover:bg-blue-400 border-b-4 border-blue-800 hover:border-blue-700 cursor-pointer rounded-md",onClick:P=>(m(!1),Dr({item:s,url:y,destination:j,id_column:L,dataRows:T,falcor:l,setLoadingStatus:a,locationNameMap:k,setGeneratedPages:u,...g,urlSuffixCol:h})),children:"Generate"})]})]})]}):e.jsx("button",{className:"mt-4 p-2 rounded-lg text-white bg-gray-500 border border-b-2 border-gray-800 cursor-not-allowed",disabled:!0,children:"No template data available."})})]})},eS=()=>e.jsx("div",{children:"Path..."}),tS=({section:t,source:s,sectionControl:n={},updateSectionControl:r})=>{var u,p;let a=Wc((u=t==null?void 0:t.element)==null?void 0:u["element-data"])||{},l=((p=t==null?void 0:t.element)==null?void 0:p["element-type"])||"",i=Ht[l]||{},c=[...(i==null?void 0:i.variables)||[],...(a==null?void 0:a.additionalVariables)||[]];const d=w.useMemo(()=>{let m=C(s,["metadata","columns"],C(s,"metadata",[]));return Array.isArray(m)||(m=[]),m.map(h=>h.name)},[s]);return e.jsxs("div",{className:"p-4 border rounded mb-1",children:[e.jsxs("div",{children:["Title: ",t==null?void 0:t.title," ",t==null?void 0:t.id]}),e.jsx("div",{children:l}),e.jsx("div",{children:c.filter(m=>!m.hidden).map(m=>e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-1 items-center",children:[e.jsx("div",{children:m.name}),e.jsx("div",{className:"text-xs",children:typeof a[m.name]=="object"?JSON.stringify(a[m.name]):a[m.name]})]}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsx(ua,{options:["",...d],value:n[m.name]||"",onChange:h=>{r({...n,[m.name]:h})}})})]},m.name))})]})},sS=({sections:t=[],sectionControls:s,source:n,onChange:r})=>e.jsx("div",{children:t.map(a=>e.jsx(tS,{section:a,source:n,sectionControl:(s==null?void 0:s[a.id])||{},updateSectionControl:l=>{r({...s,[a.id]:l})}},a.id))}),nS=({item:t,dataControls:s={},setDataControls:n,baseUrl:r,loadingStatus:a,setLoadingStatus:l})=>{var c,d,u,p,m;const i=(h,f)=>{n({...s,[h]:f})};return e.jsxs("div",{className:"relative mt-6 flex-1 px-4 sm:px-6",children:[e.jsx("span",{className:"text-sm text-gray-500 p-1",children:"Select Template Source:"}),e.jsx(Y4,{value:s==null?void 0:s.source,onChange:h=>{i("source",h)}}),(c=s==null?void 0:s.source)!=null&&c.source_id?e.jsx(K4,{source_id:(d=s==null?void 0:s.source)==null?void 0:d.source_id,value:(u=s.view)==null?void 0:u.view_id,onChange:h=>{i("view",h)}}):"",(p=s==null?void 0:s.source)!=null&&p.source_id&&((m=s==null?void 0:s.view)!=null&&m.view_id)?e.jsxs("div",{children:[e.jsx(s0,{item:t,source:s==null?void 0:s.source,view:s==null?void 0:s.view,id_column:s==null?void 0:s.id_column,active_row:s==null?void 0:s.active_row,onChange:(h,f)=>{h==="id_column"&&(i("id_column",f),n({...s,id_column:f,active_row:{}})),h==="active_row"&&n({...s,...f})},loadingStatus:a,setLoadingStatus:l,baseUrl:r}),e.jsx(eS,{}),e.jsx(sS,{sections:t.sections,sectionControls:s.sectionControls,source:s==null?void 0:s.source,onChange:h=>{i("sectionControls",{...s.sectionControls,...h})}})]}):"",e.jsx("div",{children:e.jsx("pre",{children:JSON.stringify(s,null,3)})})]})};function aS(t){const{open:s,setOpen:n}=t;return e.jsx(Be.Root,{show:s,as:b.Fragment,children:e.jsx(Je,{as:"div",className:"relative z-20 ",onClose:()=>{n(!1),console.log("onclose")},children:e.jsx("div",{className:"fixed inset-x-0 bottom-0 top-12  overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:"pointer-events-none fixed inset-y-0 top-12 right-0 flex max-w-full pl-10",children:e.jsx(Be.Child,{as:b.Fragment,enter:"transform transition ease-in-out duration-500 sm:duration-700",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(Je.Panel,{className:"pointer-events-auto w-screen max-w-md",children:e.jsxs("div",{className:"flex h-full flex-col overflow-y-scroll bg-white py-6 shadow-xl",children:[e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(Je.Title,{className:"text-base font-semibold leading-6 text-gray-900",children:"Data Controls"}),e.jsx("div",{className:"ml-3 flex h-7 items-center",children:e.jsxs("button",{type:"button",className:"relative rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none",onClick:()=>n(!1),children:[e.jsx("span",{className:"absolute -inset-2.5"}),e.jsx("span",{className:"sr-only",children:"Close panel"}),e.jsx("i",{className:"h-6 w-6 text-lg fa fa-close","aria-hidden":"true"})]})})]})}),e.jsx(nS,{...t})]})})})})})})})})}function Ss(t){return typeof t=="object"&&!("toString"in t)?Object.prototype.toString.call(t).slice(8,-1):t}function $s(t,s){if(!t)throw new Error(s())}var ki=Object.prototype.hasOwnProperty,rS=Array.prototype.splice,oS=Object.prototype.toString;function Sn(t){return oS.call(t).slice(8,-1)}var Li=Object.assign||function(t,s){return Gc(s).forEach(function(n){ki.call(s,n)&&(t[n]=s[n])}),t},Gc=typeof Object.getOwnPropertySymbols=="function"?function(t){return Object.keys(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.keys(t)};function en(t){return Array.isArray(t)?Li(t.constructor(t.length),t):Sn(t)==="Map"?new Map(t):Sn(t)==="Set"?new Set(t):t&&typeof t=="object"?Li(Object.create(Object.getPrototypeOf(t)),t):t}var lS=function(){function t(){this.commands=Li({},iS),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(s,n){return s===n},this.update.newContext=function(){return new t().update}}return Object.defineProperty(t.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(s){this.update.isEquals=s},enumerable:!1,configurable:!0}),t.prototype.extend=function(s,n){this.commands[s]=n},t.prototype.update=function(s,n){var r=typeof n=="function"?{$apply:n}:n;Array.isArray(s)&&Array.isArray(r)||$s(!Array.isArray(r),function(){return"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."}),$s(typeof r=="object"&&r!==null,function(){return"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the "+"following commands: ".concat(Object.keys(this.commands).join(", "),".")});var a=s;return Gc(r).forEach(l=>{if(ki.call(this.commands,l)){var i=s===a;a=this.commands[l](r[l],a,r,s),i&&this.isEquals(a,s)&&(a=s)}else{var c=Sn(s)==="Map"?this.update(s.get(l),r[l]):this.update(s[l],r[l]),d=Sn(a)==="Map"?a.get(l):a[l];(!this.isEquals(c,d)||typeof c>"u"&&!ki.call(s,l))&&(a===s&&(a=en(s)),Sn(a)==="Map"?a.set(l,c):a[l]=c)}}),a},t}(),iS={$push:function(t,s,n){return Pu(s,n,"$push"),t.length?s.concat(t):s},$unshift:function(t,s,n){return Pu(s,n,"$unshift"),t.length?t.concat(s):s},$splice:function(t,s,n,r){return dS(s,n),t.forEach(function(a){n0(a),s===r&&a.length&&(s=en(r)),rS.apply(s,a)}),s},$set:function(t,s,n){return mS(n),t},$toggle:function(t,s){za(t,"$toggle");var n=t.length?en(s):s;return t.forEach(function(r){n[r]=!s[r]}),n},$unset:function(t,s,n,r){return za(t,"$unset"),t.forEach(function(a){Object.hasOwnProperty.call(s,a)&&(s===r&&(s=en(r)),delete s[a])}),s},$add:function(t,s,n,r){return Du(s,"$add"),za(t,"$add"),Sn(s)==="Map"?t.forEach(function(a){var l=a[0],i=a[1];s===r&&s.get(l)!==i&&(s=en(r)),s.set(l,i)}):t.forEach(function(a){s===r&&!s.has(a)&&(s=en(r)),s.add(a)}),s},$remove:function(t,s,n,r){return Du(s,"$remove"),za(t,"$remove"),t.forEach(function(a){s===r&&s.has(a)&&(s=en(r)),s.delete(a)}),s},$merge:function(t,s,n,r){return pS(s,t),Gc(t).forEach(function(a){t[a]!==s[a]&&(s===r&&(s=en(r)),s[a]=t[a])}),s},$apply:function(t,s){return uS(t),t(s)}},cS=new lS;function Pu(t,s,n){$s(Array.isArray(t),function(){return"update(): expected target of ".concat(Ss(n)," to be an array; got ").concat(Ss(t),".")}),za(s[n],n)}function za(t,s){$s(Array.isArray(t),function(){return"update(): expected spec of ".concat(Ss(s)," to be an array; got ").concat(Ss(t),". ")+"Did you forget to wrap your parameter in an array?"})}function dS(t,s){$s(Array.isArray(t),function(){return"Expected $splice target to be an array; got ".concat(Ss(t))}),n0(s.$splice)}function n0(t){$s(Array.isArray(t),function(){return"update(): expected spec of $splice to be an array of arrays; got ".concat(Ss(t),". ")+"Did you forget to wrap your parameters in an array?"})}function uS(t){$s(typeof t=="function",function(){return"update(): expected spec of $apply to be a function; got ".concat(Ss(t),".")})}function mS(t){$s(Object.keys(t).length===1,function(){return"Cannot have more than one key in an object with $set"})}function pS(t,s){$s(s&&typeof s=="object",function(){return"update(): $merge expects a spec of type 'object'; got ".concat(Ss(s))}),$s(t&&typeof t=="object",function(){return"update(): $merge expects a target of type 'object'; got ".concat(Ss(t))})}function Du(t,s){var n=Sn(t);$s(n==="Map"||n==="Set",function(){return"update(): ".concat(Ss(s)," expects a target of type Set or Map; got ").concat(Ss(n))})}const Ru=cS.update,hS=t=>Object.prototype.toString.call(t).slice(8,-1),fS=t=>hS(t)==="Array",gS=(t,s)=>{for(;t;){if(t.matches&&t.matches(s))return t;t=t.parentNode}return null},xS=t=>{var s=t.getBoundingClientRect(),n=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||n.scrollTop,l=window.pageXOffset||r.scrollLeft||n.scrollLeft,i=r.clientTop||n.clientTop||0,c=r.clientLeft||n.clientLeft||0,d=s.top+a-i,u=s.left+l-c;return{top:Math.round(d),left:Math.round(u)}},bS=t=>{let s=0,n=0;for(;t=t.parentNode;)s+=t.scrollTop||0,n+=t.scrollLeft||0;return{top:s,left:n}},yS=(t,s)=>({transform:"translate("+t+"px, "+s+"px)"}),Ii=(t,s)=>t.map(n=>({...n,[s]:n[s]?Ii(n[s],s):[]})),to=(t,{idProp:s,childrenProp:n})=>{let r=[];return t.filter(l=>l[n].length).map(l=>(r=r.concat(to(l[n],{idProp:s,childrenProp:n})),l[s])).concat(r)};function To(){for(var t={}.hasOwnProperty,s=[],n=0;n<arguments.length;n++){var r=arguments[n];if(r){var a=typeof r;if(a==="string"||a==="number")s.push(r);else if(Array.isArray(r)){if(r.length){var l=To.apply(null,r);l&&s.push(l)}}else if(a==="object"){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){s.push(r.toString());continue}for(var i in r)t.call(r,i)&&r[i]&&s.push(i)}}}return s.join(" ")}function vS({children:t,className:s,...n}){return e.jsx("i",{className:`${nestable-icon}  ${s}`,...n})}const er=class er extends b.Component{constructor(){super(...arguments);ye(this,"renderCollapseIcon",({isCollapsed:n})=>e.jsx(vS,{className:To("nestable-item-icon",{"icon-plus-gray":n,"icon-minus-gray":!n})}))}render(){const{item:n,isCopy:r,options:a,index:l,depth:i}=this.props,{dragItem:c,renderItem:d,handler:u,idProp:p,childrenProp:m,renderCollapseIcon:h=this.renderCollapseIcon}=a,f=a.isCollapsed(n),g=!r&&c&&c[p]===n[p],x=n[m]&&n[m].length>0;let y={},j={},N;r||(c?y={...y,onMouseEnter:k=>a.onMouseEnter(k,n)}:j={...j,draggable:!0,onDragStart:k=>a.onDragStart(k,n)}),u?N=e.jsx("span",{className:"nestable-item-handler",...j,children:u}):y={...y,...j};const _=x?e.jsx("span",{onClick:()=>a.onToggleCollapse(n),children:h({isCollapsed:f})}):null,E="nestable-item ml-2"+(r?"-copy":""),L={className:To(E,E+"-"+n[p],{"is-dragging bg-slate-200 border pl-4":g,[E+"--with-children"]:x,[E+"--children-open"]:x&&!f,[E+"--children-collapsed"]:x&&f})},S=d({collapseIcon:_,depth:i,handler:N,index:l,item:n});return S?e.jsxs("li",{...L,children:[e.jsx("div",{className:"nestable-item-name",...y,children:S}),x&&!f&&e.jsx("ol",{className:"nestable-list border-l ml-4",children:n[m].map((k,$)=>e.jsx(er,{index:$,depth:i+1,item:k,options:a,isCopy:r},$))})]}):null}};ye(er,"propTypes",{item:Le.object,isCopy:Le.bool,options:Le.object,index:Le.number,depth:Le.number}),ye(er,"defaultProps",{depth:0});let Mo=er;class Ti extends b.Component{constructor(n){super(n);ye(this,"collapse",n=>{const{idProp:r,childrenProp:a,collapsed:l}=this.props,{items:i}=this.state;n==="NONE"?this.setState({collapsedGroups:l?to(i,{idProp:r,childrenProp:a}):[]}):n==="ALL"?this.setState({collapsedGroups:l?[]:to(i,{idProp:r,childrenProp:a})}):fS(n)&&this.setState({collapsedGroups:to(i,{idProp:r,childrenProp:a}).filter(c=>n.indexOf(c)>-1^l)})});ye(this,"startTrackMouse",()=>{document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onDragEnd),document.addEventListener("keydown",this.onKeyDown)});ye(this,"stopTrackMouse",()=>{document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onDragEnd),document.removeEventListener("keydown",this.onKeyDown),this.elCopyStyles=null});ye(this,"getItemDepth",n=>{const{childrenProp:r}=this.props;let a=1;if(n[r].length>0){const l=n[r].map(this.getItemDepth);a+=Math.max(...l)}return a});ye(this,"isCollapsed",n=>{const{collapsed:r,idProp:a}=this.props,{collapsedGroups:l}=this.state;return!!(l.indexOf(n[a])>-1^r)});ye(this,"onDragStart",(n,r)=>{n&&(n.preventDefault(),n.stopPropagation()),this.el=gS(n.target,".nestable-item"),this.startTrackMouse(),this.onMouseMove(n),this.setState({dragItem:r,itemsOld:this.state.items})});ye(this,"onDragEnd",(n,r)=>{n&&n.preventDefault(),this.stopTrackMouse(),this.el=null,r?this.dragRevert():this.dragApply()});ye(this,"onMouseMove",n=>{const{group:r,threshold:a}=this.props,{dragItem:l}=this.state,{clientX:i,clientY:c}=n,d=yS(i,c),u=document.querySelector(".nestable-"+r+" .nestable-drag-layer > .nestable-list");if(this.elCopyStyles){this.elCopyStyles={...this.elCopyStyles,...d};for(let m in d)d.hasOwnProperty(m)&&(u.style[m]=d[m]);const p=i-this.mouse.last.x;p>=0&&this.mouse.shift.x>=0||p<=0&&this.mouse.shift.x<=0?this.mouse.shift.x+=p:this.mouse.shift.x=0,this.mouse.last.x=i,Math.abs(this.mouse.shift.x)>a&&(this.mouse.shift.x>0?this.tryIncreaseDepth(l):this.tryDecreaseDepth(l),this.mouse.shift.x=0)}else{const p=xS(this.el),m=bS(this.el);this.elCopyStyles={marginTop:p.top-c-m.top,marginLeft:p.left-i-m.left,...d}}});ye(this,"onMouseEnter",(n,r)=>{n&&(n.preventDefault(),n.stopPropagation());const{collapsed:a,idProp:l,childrenProp:i}=this.props,{dragItem:c}=this.state;if(c[l]===r[l])return;const d=this.getPathById(c[l]),u=this.getPathById(r[l]);let p={};if(a&&d.length>1){const m=this.getItemByPath(d.slice(0,-1));m[i].length===1&&(p=this.onToggleCollapse(m,!0))}this.moveItem({dragItem:c,pathFrom:d,pathTo:u},p)});ye(this,"onToggleCollapse",(n,r)=>{const{collapsed:a,idProp:l}=this.props,{collapsedGroups:i}=this.state,d={collapsedGroups:this.isCollapsed(n)^a?i.filter(u=>u!==n[l]):i.concat(n[l])};if(r)return d;this.setState(d)});ye(this,"onKeyDown",n=>{n.which===27&&this.onDragEnd(null,!0)});this.state={items:[],itemsOld:null,dragItem:null,isDirty:!1,collapsedGroups:[]},this.el=null,this.elCopyStyles=null,this.mouse={last:{x:0},shift:{x:0}}}componentDidMount(){let{items:n,childrenProp:r}=this.props;n=Ii(n,r),this.setState({items:n})}componentDidUpdate(n){const{items:r,childrenProp:a}=this.props;if(Fe({props:n,state:{}},this.props)){this.stopTrackMouse();let i={};n.collapsed!==this.props.collapsed&&(i.collapsedGroups=[]),this.setState({items:Ii(r,a),dragItem:null,isDirty:!1,...i})}}componentWillUnmount(){this.stopTrackMouse()}moveItem({dragItem:n,pathFrom:r,pathTo:a},l={}){const{childrenProp:i,confirmChange:c}=this.props,d=this.getItemDepth(n);let{items:u}=this.state;const p=this.getRealNextPath(r,a,d);if(p.length===0)return;const m=p.length>a.length?a:a.slice(0,-1),h=this.getItemByPath(m);if(!c({dragItem:n,destinationParent:h}))return;const f=this.getSplicePath(r,{numToRemove:1,childrenProp:i}),g=this.getSplicePath(p,{numToRemove:0,itemsToInsert:[n],childrenProp:i});u=Ru(u,f),u=Ru(u,g),this.setState({items:u,isDirty:!0,...l})}tryIncreaseDepth(n){const{maxDepth:r,idProp:a,childrenProp:l,collapsed:i}=this.props,c=this.getPathById(n[a]),d=c[c.length-1],u=c.length+this.getItemDepth(n);if(d>0&&u<=r){const p=this.getItemByPath(c.slice(0,-1).concat(d-1));if(!p[l].length||!this.isCollapsed(p)){const m=c.slice(0,-1).concat(d-1).concat(p[l].length);let h={};i&&!p[l].length&&(h=this.onToggleCollapse(p,!0)),this.moveItem({dragItem:n,pathFrom:c,pathTo:m},h)}}}tryDecreaseDepth(n){const{idProp:r,childrenProp:a,collapsed:l}=this.props,i=this.getPathById(n[r]),c=i[i.length-1];if(i.length>1){const d=this.getItemByPath(i.slice(0,-1));if(c+1===d[a].length){let u=i.slice(0,-1);u[u.length-1]+=1;let p={};l&&d[a].length===1&&(p=this.onToggleCollapse(d,!0)),this.moveItem({dragItem:n,pathFrom:i,pathTo:u},p)}}}dragApply(){const{onChange:n,idProp:r}=this.props,{items:a,isDirty:l,dragItem:i}=this.state;if(this.setState({itemsOld:null,dragItem:null,isDirty:!1}),n&&l){const c=this.getPathById(i[r],a);n({items:a,dragItem:i,targetPath:c})}}dragRevert(){const{itemsOld:n}=this.state;this.setState({items:n,itemsOld:null,dragItem:null,isDirty:!1})}getPathById(n,r=this.state.items){const{idProp:a,childrenProp:l}=this.props;let i=[];return r.every((c,d)=>{if(c[a]===n)i.push(d);else if(c[l]){const u=this.getPathById(n,c[l]);u.length&&(i=i.concat(d).concat(u))}return i.length===0}),i}getItemByPath(n,r=this.state.items){const{childrenProp:a}=this.props;let l=null;return n.forEach(i=>{l=(l?l[a]:r)[i]}),l}getSplicePath(n,r={}){const a={},l=r.numToRemove||0,i=r.itemsToInsert||[],c=n.length-1;let d=a;return n.forEach((u,p)=>{if(p===c)d.$splice=[[u,l,...i]];else{const m={};d[u]={[r.childrenProp]:m},d=m}}),a}getRealNextPath(n,r,a){const{childrenProp:l,maxDepth:i}=this.props,c=n.length-1,d=r.length-1,u=r.length+a-1;if(n.length<r.length){let p=!1;return u>i&&r.length?this.getRealNextPath(n,r.slice(0,-1),a):r.map((m,h)=>p?h===d?m+1:m:typeof n[h]!="number"?m:r[h]>n[h]&&h===c?(p=!0,m-1):m)}else if(n.length===r.length&&r[d]>n[d]){const p=this.getItemByPath(r);if(u<i&&p[l]&&p[l].length&&!this.isCollapsed(p))return r.slice(0,-1).concat(r[d]-1).concat(0)}return r}getItemOptions(){const{renderItem:n,renderCollapseIcon:r,handler:a,idProp:l,childrenProp:i}=this.props,{dragItem:c}=this.state;return{dragItem:c,idProp:l,childrenProp:i,renderItem:n,renderCollapseIcon:r,handler:a,onDragStart:this.onDragStart,onMouseEnter:this.onMouseEnter,isCollapsed:this.isCollapsed,onToggleCollapse:this.onToggleCollapse}}renderDragLayer(){const{group:n,idProp:r}=this.props,{dragItem:a}=this.state,l=document.querySelector(".nestable-"+n+" .nestable-item-"+a[r]);let i={};l&&(i.width=l.clientWidth),this.elCopyStyles&&(i={...i,...this.elCopyStyles});const c=this.getItemOptions();return e.jsx("div",{className:"nestable-drag-layer",children:e.jsx("ol",{className:"nestable-list",style:i,children:e.jsx(Mo,{item:a,options:c,isCopy:!0})})})}render(){const{group:n,className:r}=this.props,{items:a,dragItem:l}=this.state,i=this.getItemOptions();return e.jsxs("div",{className:To(r,"nestable","nestable-"+n,{"is-drag-active":l}),children:[e.jsx("ol",{className:"nestable-list nestable-group",children:a.map((c,d)=>e.jsx(Mo,{index:d,item:c,options:i},d))}),l&&this.renderDragLayer()]})}}ye(Ti,"propTypes",{childrenProp:Le.string,className:Le.string,collapsed:Le.bool,confirmChange:Le.func,group:Le.oneOfType([Le.number,Le.string]),handler:Le.node,idProp:Le.string,items:Le.array,maxDepth:Le.number,onChange:Le.func,renderCollapseIcon:Le.func,renderItem:Le.func,threshold:Le.number}),ye(Ti,"defaultProps",{childrenProp:"children",collapsed:!1,confirmChange:()=>!0,group:Math.random().toString(36).slice(2),idProp:"id",items:[],maxDepth:10,onChange:()=>{},renderItem:({item:n})=>String(n),threshold:30});function jS({item:t,dataItems:s,edit:n,open:r,setOpen:a}){return w.useContext(ke),e.jsx(Be.Root,{show:r,as:b.Fragment,children:e.jsxs(Je,{as:"div",className:"relative z-20",onClose:a,children:[e.jsx("div",{className:"fixed inset-0"}),e.jsx("div",{className:"fixed inset-0 overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:e.jsx(Be.Child,{as:b.Fragment,enter:"transform transition ease-in-out duration-500 sm:duration-700",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(Je.Panel,{className:"pointer-events-auto w-screen max-w-md",children:e.jsxs("div",{className:"flex h-full flex-col overflow-y-scroll bg-white py-6 shadow-xl",children:[e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(Je.Title,{className:"text-base font-semibold leading-6 text-gray-900",children:"Edit Pages"}),e.jsx("div",{className:"ml-3 flex h-7 items-center",children:e.jsxs("button",{type:"button",className:"relative rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none ",onClick:()=>a(!1),children:[e.jsx("span",{className:"absolute -inset-2.5"}),e.jsx("span",{className:"sr-only",children:"Close panel"}),e.jsx("i",{className:"h-6 w-6 fa fa-close","aria-hidden":"true"})]})})]})}),e.jsx("div",{className:"relative mt-6 flex-1 px-4 sm:px-6",children:e.jsx(wS,{item:t,dataItems:s,edit:n,open:r,setOpen:a})})]})})})})})})]})})}const Xa={nav:{container:t=>"w-full ",navItemContainer:"h-full border-l overflow-y-auto overflow-x-hidden pt-3 scrollbar-xs",navItem:({isActive:t,isPending:s})=>`block px-4 py-2 font-light ${t?"w-[256px] bg-white text-blue-500 border-l border-y":"w-[248px] hover:bg-blue-100 text-slate-600"}`,navItemChild:({isActive:t,isPending:s})=>`block px-4 py-2 font-light ${t?"w-[238px] bg-white text-blue-500 border-l border-y":"w-[230px] hover:bg-blue-100 text-slate-600"}`,addItemButton:"cursor-pointer px-4 py-2 mt-3 hover:bg-blue-100 w-full text-slate-400 border-t border-slate-200"}};function Bo(t,s,n,r){let a=s.filter(l=>l.parent===t.id).sort((l,i)=>l.index-i.index);return a.length===0?!1:a.map((l,i)=>{let c={id:l.id,Comp:()=>e.jsx(ha,{to:`${r?`${n}/edit`:n}/${l.url_slug||l.id}`,className:Xa.nav.navItem,children:l.title},i)};return Bo(c,s,n,r)&&(c.children=Bo(l,s,n,r)),c})}function wS({item:t,dataItems:s,edit:n,open:r,setOpen:a}){const l=zt(),{pathname:i="/edit"}=kt(),{baseUrl:c}=w.useContext(ke),d=w.useCallback(m=>{let h=s.reduce((y,j)=>(y[j.id]=j,y),{});function f(y,j="",N){let _=[];return y.forEach((E,L)=>{let S=N[E.id];const k={id:S.id,index:S.index,title:S.title,url_slug:S.url_slug};(S.index!==L||S.parent!==j)&&(k.index=L,k.parent=j,_.push(k)),E.children&&(_=[..._,...f(E.children,E.id,N)])}),_}let g=f(m.items,"",h),x=[...g,...s.filter(y=>!g.map(j=>j.id).includes(y.id))];g.forEach(y=>y.url_slug=aa(y,x)),Promise.all(g.map(y=>{l(Yt(y),{method:"post",action:i})})).then(y=>{})},[]),u=s.sort((m,h)=>m.index-h.index).filter(m=>!m.parent).map((m,h)=>{let f={id:m.id,index:m.index,Comp:()=>e.jsx(ha,{to:`${n?`${c}/edit`:c}/${m.url_slug||m.id}`,className:Xa.nav.navItem,children:m.title})};return Bo(f,s,c)&&(f.children=Bo(m,s,c,n)),f}),p=m=>m.map(h=>{let f=h.Comp;return e.jsxs(w.Fragment,{children:[e.jsx(f,{}),h.children?e.jsx("div",{className:"border-l ml-4 pl-2",children:p(h.children)}):""]},h.id)});return e.jsx(e.Fragment,{children:e.jsx("div",{className:Xa.nav.container(r),children:e.jsxs("div",{className:Xa.nav.navItemContainer,children:[n?e.jsx(Ti,{items:u,onChange:d,maxDepth:4,renderItem:({item:m})=>{let h=m.Comp;return e.jsx(h,{})}}):p(u),n&&e.jsx(NS,{dataItems:s})]})})})}function NS({dataItems:t}){const s=zt(),{pathname:n="/edit"}=kt(),{baseUrl:r,user:a}=w.useContext(ke),i={title:"New Page",index:t.filter(d=>!d.parent).reduce((d,u)=>Math.max(isNaN(u.index)?-1:u.index,d),-1)+1,published:"draft",history:[{type:" created Page.",user:a.email,time:new Date().toString()}]};i.url_slug=aa(i,t);const c=()=>{s(Yt(i),{method:"post",action:n})};return e.jsx("div",{className:"pr-2",children:e.jsx("div",{onClick:c,className:Xa.nav.addItemButton,children:"+ Add Page"})})}function CS({item:t,dataItems:s,historyOpen:n,setHistoryOpen:r}){return w.useContext(ke),e.jsx(Be.Root,{show:n,as:b.Fragment,children:e.jsxs(Je,{as:"div",className:"relative z-20",onClose:r,children:[e.jsx("div",{className:"fixed inset-0"}),e.jsx("div",{className:"fixed inset-0 overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:e.jsx(Be.Child,{as:b.Fragment,enter:"transform transition ease-in-out duration-500 sm:duration-700",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(Je.Panel,{className:"pointer-events-auto w-screen max-w-md",children:e.jsxs("div",{className:"flex h-full flex-col overflow-y-scroll bg-white py-6 shadow-xl",children:[e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(Je.Title,{className:"text-base font-semibold leading-6 text-gray-900",children:"Edit History"}),e.jsx("div",{className:"ml-3 flex h-7 items-center",children:e.jsxs("button",{type:"button",className:"relative rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none",onClick:()=>r(!1),children:[e.jsx("span",{className:"absolute -inset-2.5"}),e.jsx("span",{className:"sr-only",children:"Close panel"}),e.jsx("i",{className:"h-6 w-6 text-lg fa fa-close","aria-hidden":"true"})]})})]})}),e.jsx("div",{className:"relative mt-6 flex-1 px-4 sm:px-6",children:e.jsx(SS,{history:(t==null?void 0:t.history)||[]})})]})})})})})})]})})}function _S(...t){return t.filter(Boolean).join(" ")}function SS({history:t}){return e.jsx(e.Fragment,{children:e.jsx("ul",{role:"list",className:"space-y-6",children:t.sort((s,n)=>new Date(n.time)-new Date(s.time)).map((s,n)=>e.jsxs("li",{className:"relative flex gap-x-4",children:[e.jsx("div",{className:_S(n===t.length-1?"h-6":"-bottom-6","absolute left-0 top-0 flex w-6 justify-center"),children:e.jsx("div",{className:"w-px bg-gray-200"})}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative flex h-6 w-6 flex-none items-center justify-center bg-white",children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-gray-100 ring-1 ring-gray-300"})}),e.jsxs("p",{className:"flex-auto py-0.5 text-xs leading-5 text-gray-500",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.user})," ",s.type]}),e.jsx("time",{dateTime:s.time,className:"flex-none py-0.5 text-xs leading-5 text-gray-500",children:$S(s.time)})]})]},s.id))})})}function $S(t){const s=t instanceof Date?t:new Date(t),n=new Intl.RelativeTimeFormat("en"),r={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},a=(s.getTime()-Date.now())/1e3;for(let l in r)if(r[l]<Math.abs(a)){const i=a/r[l];return n.format(Math.round(i),l)}}const Bs={pageControls:{controlItem:"pl-6 py-0.5 text-md cursor-pointer hover:text-blue-500 text-slate-400 flex items-center",select:"bg-transparent border-none rounded-sm focus:ring-0 focus:border-0 pl-1",selectOption:"p-4 text-md cursor-pointer hover:text-blue-500 text-slate-400 hover:bg-blue-600",content:""}};function ES({item:t,dataItems:s,updateAttribute:n,attributes:r,edit:a,status:l,setItem:i,pageType:c="page"}){var P,F;const d=zt(),{pathname:u="/edit"}=kt(),[p,m]=w.useState(!1),[h,f]=w.useState(!1),[g,x]=b.useState(!1),[y,j]=b.useState(!1);b.useState(l==null?void 0:l.message),b.useState(!1),b.useState(t.type);const[N,_]=b.useState(),{baseUrl:E,user:L,falcor:S,falcorCache:k}=w.useContext(ke),$=async B=>{let V={id:t.id,url_slug:aa(t,s)};B&&(V.sections=B),d(Yt(V),{method:"post",action:c==="template"?u:`${E}/edit/${V.url_slug}`})};async function I(B){var Z,X;const V=(X=(Z=Object.keys(B.sectionControls))==null?void 0:Z.filter((H,z)=>H&&H!=="undefined"))==null?void 0:X.length;_("Loading sections...");const G=await Object.keys(B.sectionControls).filter((H,z)=>H&&H!=="undefined").reduce(async(H,z,W)=>{var fe,ve,se,me,xe;const Y=await H;let U=((fe=t.sections.filter(re=>re.id===z))==null?void 0:fe[0])||{};_(`Updating section ${U==null?void 0:U.title}  ${(ve=U==null?void 0:U.element)==null?void 0:ve["element-type"]}  ${W+1}/${V}`);let q=Wc((se=U==null?void 0:U.element)==null?void 0:se["element-data"])||{},te=((me=U==null?void 0:U.element)==null?void 0:me["element-type"])||"",K=Ht[te]||{},ne=((K==null?void 0:K.variables)||[]).reduce((re,Q)=>(re[Q.name]=q[Q.name],re),{}),J=Object.keys(B.sectionControls[z]).reduce((re,Q)=>{var pe,ge,le,ie,be,_e,Re;return re[Q]=((ie=B==null?void 0:B.active_row)==null?void 0:ie[(le=(ge=(pe=B==null?void 0:B.sectionControls)==null?void 0:pe[z])==null?void 0:ge[Q])==null?void 0:le.name])||((Re=B==null?void 0:B.active_row)==null?void 0:Re[(_e=(be=B==null?void 0:B.sectionControls)==null?void 0:be[z])==null?void 0:_e[Q]])||null,re},{}),ae=(xe=q.additionalVariables)==null?void 0:xe.map(re=>{var ge,le,ie;const Q=re.name,pe=(le=(ge=B==null?void 0:B.sectionControls)==null?void 0:ge[z])==null?void 0:le[Q];return re.defaultValue=(ie=B==null?void 0:B.active_row)==null?void 0:ie[pe],re}),de={...ne,...J,additionalVariables:ae};const ue=K!=null&&K.getData?await K.getData(de,S).then(re=>({section_id:z,data:re})):null;return ue?[...Y,ue]:Y},Promise.resolve([]));if(G.length>0){let H=Ie(t.sections);G.forEach(({section_id:z,data:W})=>{var U;let Y=((U=H.filter(q=>q.id===z))==null?void 0:U[0])||{};Y.element["element-data"]=JSON.stringify(W)}),n("sections",H),$(H)}_(void 0)}const T=()=>{const B=s.filter(G=>!G.parent).reduce((G,Z)=>Math.max(isNaN(Z.index)?-1:Z.index,G),-1),V=Ie(t);delete V.id,V.title+=" Dup",V.index=B+1,V.url_slug=aa(V,s),V.sections.forEach(G=>{delete G.ref,delete G.id}),d(Yt(V),{method:"post",action:u})},A=async()=>{const B=s.filter(G=>G.parent===t.id).reduce((G,Z)=>Math.max(isNaN(Z.index)?0:Z.index,G),0),V={title:"New Page",parent:t.id,index:B+1,published:"draft",history:[{type:" created Page.",user:L.email,time:new Date().toString()}]};V.url_slug=`${aa(V,s)}`,d(Yt(V),{method:"post",action:`${E}/edit/${V.url_slug}`})},R=async(B,V="")=>{var X,H;const G=Ie(t);G[B]=V;let Z=c==="template"?"sections":"draft_sections";B==="header"&&!((H=(X=G==null?void 0:G[Z])==null?void 0:X.filter(z=>z.is_header))!=null&&H[0])?(G[Z].unshift({is_header:!0,element:{"element-type":"Header: Default Header","element-data":{}}}),n("","",{header:V,[Z]:G[Z]})):n(B,V),d(Yt(G),{method:"post",action:u})},O=async(B="")=>{if(B!==t.title){let V=t.history?Ie(t.history):[],G={type:`changed page title to ${B}`,user:L.email,time:new Date().toString()};V.push(G);const Z={id:t.id,title:B,history:V};Z.url_slug=aa(Z,s),n("title",B),d(Yt(Z),{method:"post",action:`${E}/edit/${Z.url_slug}`})}},M=async()=>{let B={type:"published changes.",user:L.email,time:new Date().toString()},V=t.history?Ie(t.history):[];V.push(B);const G={id:t.id,has_changes:!1,published:"",history:V};let Z=Ie(t.sections||[]).reduce((X,H)=>(H.draft_id&&(X[H.draft_id]=H),X),{});G.sections=Ie(t.draft_sections).reduce((X,H)=>(Z[H.id]?H.id=Z[H.id].id:delete H.id,X.push(H),X),[]),n("","",{has_changes:!1,published:"",history:V}),d(Yt(G),{method:"post",action:u})},D=B=>{if(!Fe(t.data_controls,B)){console.log("------setting data controls-------------");const V=Ie(t);t.id,V.data_controls=B,n("data_controls",B),d(Yt(V),{method:"post",action:u})}};return e.jsxs(e.Fragment,{children:[e.jsx(jS,{item:t,dataItems:s,edit:!0,open:p,setOpen:m}),e.jsx(CS,{item:t,historyOpen:h,setHistoryOpen:f}),e.jsx(aS,{item:t,open:g,setOpen:x,dataControls:t==null?void 0:t.data_controls,setDataControls:D,loadingStatus:N,setLoadingStatus:_,baseUrl:E}),a&&e.jsxs("div",{className:"p-4",children:[c==="page"&&e.jsx("div",{className:"w-full flex justify-center pb-6",children:e.jsx(kS,{item:t,onClick:M})}),e.jsxs("div",{className:"pl-4 pb-2",children:[e.jsx("span",{className:"text-xs uppercase font-bold text-slate-400",children:" page name "}),e.jsx(Fu,{value:t==null?void 0:t.title,onChange:O})]}),e.jsxs("div",{className:"flex w-full h-12 px-4",children:[c==="page"&&e.jsx(Vu,{icon:"fad fa-wrench p-2 text-blue-300 hover:text-blue-500 cursor-pointer text-lg",children:e.jsxs("div",{className:"py-2",children:[e.jsx("div",{className:"px-6 font-medium text-sm",children:" Page Controls "}),e.jsx("div",{onClick:A,className:Bs.pageControls.controlItem,children:"☲ New Page"}),e.jsx("div",{onClick:A,className:Bs.pageControls.controlItem,children:"☲ Insert Subpage"}),e.jsx("div",{onClick:T,className:Bs.pageControls.controlItem,children:"☳ Duplicate"}),e.jsx("div",{onClick:()=>j(!0),className:Bs.pageControls.controlItem,children:"☵ Delete"})]})}),e.jsx(Vu,{icon:"fad fa-sliders-h p-2 text-blue-300 hover:text-blue-500 cursor-pointer text-lg",children:e.jsxs("div",{className:"py-2",children:[e.jsx("div",{className:"px-6 font-medium text-sm",children:" Page Settings "}),e.jsxs("div",{className:Bs.pageControls.controlItem,children:[e.jsx(Rr,{item:t,type:"sidebar",toggleSidebar:R}),"Show Sidebar"]}),e.jsxs("div",{className:Bs.pageControls.controlItem,children:[e.jsx(Rr,{type:"full_width",item:t,toggleSidebar:R}),"Full Width"]}),e.jsxs("div",{className:Bs.pageControls.controlItem,children:[e.jsx(Rr,{type:"hide_in_nav",item:t,toggleSidebar:R}),"Hide In Nav"]}),e.jsx("div",{className:Bs.pageControls.controlItem+" pr-4",children:e.jsx(q4,{label:"Header:",types:[{label:"None",value:"none"},{label:"Above",value:"above"},{label:"Below",value:"below"},{label:"In page",value:"inpage"}],type:t.header,setType:B=>R("header",B)})}),e.jsxs("div",{className:Bs.pageControls.controlItem,children:[e.jsx(Rr,{type:"footer",item:t,toggleSidebar:R}),"Show Footer"]})]})}),c==="page"&&e.jsx("div",{className:"fad fa-file-alt p-2 text-blue-300 hover:text-blue-500 cursor-pointer text-lg",onClick:()=>m(!0)}),c==="template"&&e.jsx("div",{className:"fad fa-sliders-h-square p-2 text-blue-300 hover:text-blue-500 cursor-pointer text-lg",onClick:()=>x(!0)}),e.jsx("div",{className:"fad fa-history p-2 text-blue-300 hover:text-blue-500 cursor-pointer text-lg",onClick:()=>f(!0)})]}),c==="template"&&e.jsxs("div",{className:"pl-4 pb-2",children:[e.jsx("span",{className:"text-xs uppercase font-bold text-slate-400",children:" url prefix "}),e.jsx(Fu,{value:(P=t==null?void 0:t.data_controls)==null?void 0:P.url,onChange:B=>D({...t.data_controls,url:B})})]}),c==="template"&&((F=t==null?void 0:t.data_controls)==null?void 0:F.id_column)&&e.jsx("div",{children:e.jsx(s0,{item:t,submit:d,onChange:(B,V)=>{let G;console.log("test123",B,V),B==="id_column"&&(G={...t==null?void 0:t.data_controls,id_column:V,active_row:{}}),B==="active_row"&&(G={...t==null?void 0:t.data_controls,...V}),D(G),I(G)},loadingStatus:N,setLoadingStatus:_,baseUrl:E})}),e.jsx(LS,{item:t,open:y,setOpen:j})]})]})}function Fu({value:t,onChange:s}){const[n,r]=w.useState(!1),[a,l]=w.useState(t||"");return e.jsx("div",{className:"flex justify-between group",children:e.jsx("div",{className:"flex-1",children:e.jsx("dd",{className:" text-sm text-gray-900 ",children:n?e.jsxs("div",{className:"flex group focus:outline-none border-slate-300 border-b-2 group-focus:border-blue-500",children:[e.jsx("input",{className:"w-full px-2 py-1 text font-medium text-slate-500 focus:outline-none focus:border-blue-500",value:a,onChange:i=>l(i.target.value)}),e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx("span",{className:" pt-0.5 text-green-500 rounded hover:bg-green-500 hover:text-white ",onClick:i=>{s(a),r(!1)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}),e.jsx("span",{className:"pt-0.5 text-slate-300  rounded  hover:text-red-300 ",onClick:i=>r(!1),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})})]})]}):e.jsxs("div",{className:"w-full min-h-[30px] flex flex-row px-2 py-1 text font-medium text-slate-500 focus:outline-none border-slate-300 border-b-2 focus:border-blue-500",children:[e.jsx("div",{className:"w-full",children:t}),e.jsx("span",{className:"hidden group-hover:block text-blue-300 hover:text-blue-500 cursor-pointer ",onClick:i=>r(!n),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-4 -mt-0.5 p-1.5 rounded hover:bg-blue-500 hover:text-white"})})]})})})})}function kS({item:t,onClick:s}){const n=t.published==="draft"||t.has_changes;return e.jsx("div",{onClick:()=>n?s():null,className:`${n?"inline-flex w-36 justify-center rounded-lg cursor-pointer text-sm font-semibold py-2 px-2 bg-blue-600 text-white hover:bg-blue-500 shadow-lg border border-b-4 border-blue-800 hover:border-blue-700 active:border-b-2 active:mb-[2px] active:shadow-none":"inline-flex w-36 justify-center rounded-lg cursor-not-allowed text-sm font-semibold py-2 px-2 bg-slate-300 text-white shadow border border-slate-400 border-b-4"}`,children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"pr-2",children:n?"Publish":"No Changes"}),n?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}):""]})})}function Vu({icon:t,children:s}){let[n,r]=b.useState(),[a,l]=b.useState(),{styles:i,attributes:c}=gc(n,a);return e.jsxs(ft,{className:"relative",children:[e.jsx(ft.Button,{ref:r,className:"text-md cursor-pointer hover:text-blue-800 text-blue-500",children:e.jsx("i",{className:t,title:"Help"})}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(ft.Panel,{ref:l,style:i.popper,...c.popper,className:"shadow-lg bg-white rounded z-10 transform  border border-blue-200 w-[180px] ",children:s})})]})}function Rr({type:t,item:s,toggleSidebar:n}){let r=s[t]==="show";return e.jsxs(Tt,{checked:r,onChange:a=>n(t,r?"":"show"),className:"group relative inline-flex h-5 w-10 flex-shrink-0 cursor-pointer items-center justify-center rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2",children:[e.jsx("span",{className:"sr-only",children:"Use setting"}),e.jsx("span",{"aria-hidden":"true",className:"pointer-events-none absolute h-full w-full rounded-md bg-white"}),e.jsx("span",{"aria-hidden":"true",className:`
          ${r?"bg-blue-500":"bg-gray-200"}
          pointer-events-none absolute mx-auto h-4 w-9 rounded-full transition-colors duration-200 ease-in-out
        `}),e.jsx("span",{"aria-hidden":"true",className:`
          ${r?"translate-x-5":"translate-x-0"}
          pointer-events-none absolute left-0 inline-block h-5 w-5 transform rounded-full border border-gray-200 bg-white shadow ring-0 transition-transform duration-200 ease-in-out
        `})]})}function LS({item:t,open:s,setOpen:n}){const r=b.useRef(null),a=zt(),{baseUrl:l}=w.useContext(ke),[i,c]=b.useState(!1);return e.jsxs(Jc,{open:s,setOpen:n,initialFocus:r,children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fa fa-danger h-6 w-6 text-red-600","aria-hidden":"true"})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[e.jsxs(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:["Delete Page ",t.title," ",t.id]}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this page? All of the page data will be permanently removed from our servers forever. This action cannot be undone."})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsxs("button",{type:"button",disabled:i,className:"inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto",onClick:async()=>{c(!0),await a(Yt(t,"delete"),{method:"post",action:`${l}/edit/`}),c(!1),n(!1)},children:["Delet",i?"ing...":"e"]}),e.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>n(!1),ref:r,children:"Cancel"})]})]})}function Jc({open:t,setOpen:s,initialFocus:n,children:r}){return e.jsx(Be.Root,{show:t,as:b.Fragment,children:e.jsxs(Je,{as:"div",className:"relative z-30",initialFocus:n,onClose:s,children:[e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),e.jsx("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:e.jsx("div",{onClick:()=>{s(!1)},className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:e.jsx(Je.Panel,{className:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6",children:r})})})})]})})}function IS({item:t={}}){const{baseUrl:s}=w.useContext(ke),[n,r]=b.useState(!1);return e.jsxs("div",{className:"grid grid-cols-4 px-2 py-3 border-b hover:bg-blue-50",children:[e.jsx("div",{children:e.jsxs(je,{to:`${s}/manage/templates/edit/${t.id}`,children:[e.jsx("div",{className:"px-2 font-medium text-lg text-slate-700",children:t.title}),e.jsx("div",{className:"px-2 text-xs text-slate-400",children:t.id})]})}),e.jsx("div",{}),e.jsx("div",{}),e.jsxs("div",{className:"text-right flex items-center flex-row justify-end px-2 ",children:[e.jsx(je,{to:`${s}/manage/templates/pages/${t.id}`,className:"fa-thin fa-memo px-2 py-1 mx-2 text-bold cursor-pointer",title:"pages"}),e.jsx("i",{className:"fa fa-trash text-red-300 hover:text-red-500 cursor-pointer",onClick:()=>r(!n)}),e.jsx(BS,{item:t,open:n,setOpen:r})]})]})}function TS({children:t,dataItems:s,edit:n,...r}){var u,p;const{path:a}=kt(),[l,i]=b.useState(!1),{baseUrl:c,theme:d}=w.useContext(ke);return e.jsx("div",{className:(u=d==null?void 0:d.page)==null?void 0:u.wrapper2,children:e.jsxs("div",{className:(p=d==null?void 0:d.page)==null?void 0:p.wrapper3,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-2xl p-3 font-thin flex-1",children:"Templates"}),a===`${c}/manage/templates`?e.jsx("div",{className:"px-1",children:e.jsx(je,{to:`${c}`,className:"inline-flex w-36 justify-center rounded-lg cursor-pointer text-sm font-semibold py-1 px-4 bg-blue-600 text-white hover:bg-blue-500 shadow-lg border border-b-4 border-blue-800 hover:border-blue-700 active:border-b-2 active:mb-[2px] active:shadow-none",children:" Templates "})}):e.jsx("div",{className:"px-1",children:e.jsx("div",{onClick:()=>i(!l),className:"inline-flex w-36 justify-center rounded-lg cursor-pointer text-sm font-semibold py-1 px-4 bg-blue-600 text-white hover:bg-blue-500 shadow-lg border border-b-4 border-blue-800 hover:border-blue-700 active:border-b-2 active:mb-[2px] active:shadow-none",children:" New Template"})})]}),e.jsx("div",{className:"px-6 pt-8 w-full mx-auto max-w-10xl",children:e.jsx("div",{children:s.filter(m=>m.template_id=="-99").map(m=>e.jsx(IS,{item:m},m.id))})}),e.jsx(MS,{open:l,setOpen:i})]})})}function MS({open:t,setOpen:s}){const n=b.useRef(null),r=zt(),{pathname:a="/edit"}=kt(),[l,i]=b.useState(!1),[c,d]=b.useState("");return e.jsxs(Jc,{open:t,setOpen:s,initialFocus:n,children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fa fa-plus text-blue-400"})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full px-2",children:[e.jsx(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:"New Template"}),e.jsx("div",{className:"mt-2 w-full",children:e.jsx("input",{className:"w-full px-2 py-1 text font-medium text-slate-500 focus:outline-none border-slate-300 border-b-2 focus:border-blue-500",value:c,onChange:u=>d(u.target.value),placeholder:"Template Title"})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsxs("button",{type:"button",disabled:l||c.length<3,className:"inline-flex w-full justify-center rounded-md disabled:bg-slate-300 bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto",onClick:async()=>{const u={title:c,url_slug:Kf(c),template_id:-99,hide_in_nav:!0,index:999};i(!0),await r(Yt(u),{method:"post",action:a}),i(!1),s(!1)},children:["Creat",l?"ing...":"e"]}),e.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>s(!1),ref:n,children:"Cancel"})]})]})}function BS({item:t,open:s,setOpen:n}){const r=b.useRef(null),a=zt(),{pathname:l="/edit"}=kt(),[i,c]=b.useState(!1);return e.jsxs(Jc,{open:s,setOpen:n,initialFocus:r,children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fa fa-exlamation-triangle"})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[e.jsxs(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:["Delete Page ",t.title," ",t.id]}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this Template? All of the page data will be permanently removed from our servers forever. This action cannot be undone."})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsxs("button",{type:"button",disabled:i,className:"inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto",onClick:async()=>{c(!0),await a(Yt(t,"delete"),{method:"post",action:l}),c(!1),n(!1)},children:["Delet",i?"ing...":"e"]}),e.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>n(!1),ref:r,children:"Cancel"})]})]})}const AS={1:" pt-2 pb-1 uppercase text-sm text-blue-400 hover:underline cursor-pointer border-r-2 mr-4",2:"pl-2 pt-2 pb-1 uppercase text-sm text-slate-400 hover:underline cursor-pointer border-r-2 mr-4",3:"pl-4 pt-2 pb-1 text-sm text-slate-400 hover:underline cursor-pointer border-r-2 mr-4",4:"pl-6 pt-2 pb-1 text-sm text-slate-400 hover:underline cursor-pointer border-r-2 mr-4"},OS=t=>{var s;return t?typeof t=="object"?t:(s=JSON.parse(t))==null?void 0:s.text:{}};function PS(t,s=!1){const n=t;return{menuItems:((n==null?void 0:n.sections)||[]).reduce((a,{title:l,element:i,level:c="1",...d})=>{var p,m,h;if(!i||!l||c==="0")return a;const u=i["element-type"]==="lexical"||!i["element-type"]?(h=(m=(p=OS(i["element-data"]))==null?void 0:p.root)==null?void 0:m.children)==null?void 0:h.reduce((f,{type:g,tag:x,children:y,...j})=>{var _,E,L,S;const N=g==="heading"&&((E=(_=y[0])==null?void 0:_.text)!=null&&E.length)?[{name:(L=y[0])==null?void 0:L.text,onClick:k=>{const $=[...window.document.querySelectorAll(x)].find(I=>{var T,A;return((T=I==null?void 0:I.children[0])==null?void 0:T.innerHTML)===((A=y[0])==null?void 0:A.text)});$==null||$.scrollIntoView({behavior:"smooth"})},className:`pl-2 pr-4 pb-1 text-sm text-slate-400 hover:text-slate-700 cursor-pointer border-r-2 mr-4
                            ${((S=[...window.document.querySelectorAll(x)].find(k=>{var $,I;return(($=k==null?void 0:k.children[0])==null?void 0:$.innerHTML)===((I=y[0])==null?void 0:I.text)}))==null?void 0:S.offsetParent)===null?"text-blue-200":""}`}]:[];return[...f,...N]},[]):[];return[...a,{name:l,onClick:f=>{const g=window.document.getElementById(`#${l==null?void 0:l.replace(/ /g,"_")}`);g==null||g.scrollIntoView({behavior:"smooth"})},className:AS[c]},...u||[]]},[]),themeOptions:{size:"full",color:"transparent"}}}function DS({item:t,dataItems:s,updateAttribute:n,attributes:r,setItem:a,status:l,params:i,logo:c,rightMenu:d,sideNav:u=[]}){var k,$,I;$e();const p=zt(),{baseUrl:m,user:h,theme:f}=w.useContext(ke),{pathname:g="/edit"}=kt(),{id:x}=i,y=1,j=PS(t),N=($=(k=t.sections)==null?void 0:k.filter(T=>T.is_header))==null?void 0:$[0],_=(I=t.sections)==null?void 0:I.filter(T=>!T.is_header&&!T.is_footer),E=T=>{let A=t.history?Ie(t.history):[];A.push({type:"Header updated.",user:h.email,time:new Date().toString()}),n("","",{has_changes:!0,history:A,sections:[...T,..._].filter(O=>O)});const R={id:t.id,sections:[...T,..._].filter(O=>O),has_changes:!0,history:A};console.log("save header",R),p(Yt(R),{method:"post",action:g})},L=(T,A)=>{let R={type:A,user:h.email,time:new Date().toString()},O=t.history?Ie(t.history):[];A&&O.push(R),n("","",{has_changes:!0,history:O,sections:[N,...T].filter(D=>D)});const M={id:t.id,sections:[N,...T].filter(D=>D),has_changes:!0,history:O};p(Yt(M),{method:"post",action:g})},S=w.useMemo(()=>r.sections.EditComp,[]);return e.jsxs("div",{children:[(t==null?void 0:t.header)==="above"&&e.jsx("div",{className:"w-full",children:e.jsx(S,{full_width:t.full_width,value:[N],onChange:E,...r.sections})}),e.jsx(r6,{topNav:{size:"none"},sideNav:u,children:e.jsxs("div",{className:`${f.page.wrapper1} ${f.navPadding[y]}`,children:[(t==null?void 0:t.header)==="below"&&e.jsx("div",{className:"w-full",children:e.jsx(S,{item:t,value:[N],onChange:E,...r.sections})}),e.jsxs("div",{className:`${f.page.wrapper2}`,children:[(t==null?void 0:t.sidebar)==="show"&&e.jsx(RS,{inPageNav:j}),e.jsxs("div",{className:f.page.wrapper3+" border-r",children:[(t==null?void 0:t.header)==="inpage"&&e.jsx("div",{className:"w-full",children:e.jsx(S,{item:t,value:[N],onChange:E,...r.sections})}),e.jsx(S,{full_width:t.full_width,value:_,onChange:L,...r.sections})]}),e.jsx("div",{className:"w-52 hidden xl:block",children:e.jsx("div",{className:"w-52 sticky top-12 hidden xl:block h-screen",children:e.jsx(ES,{item:t,dataItems:s,setItem:a,edit:!0,status:l,attributes:r,updateAttribute:n,pageType:"template"})})})]})]})}),(t==null?void 0:t.footer)&&e.jsx("div",{className:"h-[300px] bg-slate-100"})]},x)}function RS({inPageNav:t}){return e.jsx("div",{className:"w-64 hidden xl:block",children:e.jsx("div",{className:"w-64 sticky top-20 hidden xl:block h-screen",children:e.jsx("div",{className:"h-[calc(100%_-_5rem)] overflow-y-auto overflow-x-hidden font-display",children:e.jsx(Uf,{...t})})})})}const FS={navOptions:{sideNav:{size:"compact",search:"none",logo:"top",dropdown:"none",nav:"main"},topNav:{size:"compact",dropdown:"right",search:"none",logo:"none",position:"fixed",nav:"none"}}};function VS({children:t}){var l;const{baseUrl:s,theme:n,user:r}=w.useContext(ke)||{},a=[{name:"< Manage Site",path:"/list"},{name:"",className:"p-2"},{name:"Dashboard",path:`${s}/manage`},{name:"View Site",path:`${s}/`},{name:"Content",className:n.navLabel},{name:"Pages",path:`${s}/manage/pages`},{name:"Templates",path:`${s}/manage/templates`},{name:"Tags",path:`${s}/manage/tags`},{name:"Layout",className:n.navLabel},{name:"Design",path:`${s}/manage/design`}];return e.jsx("div",{id:"page_view",children:e.jsx(Nr,{navItems:a,theme:FS,children:e.jsx("div",{className:`${(l=n==null?void 0:n.page)==null?void 0:l.wrapper1} `,children:t})})})}function HS({item:t,dataItems:s,attributes:n,logo:r,rightMenu:a}){var d,u;const{baseUrl:l,theme:i,user:c}=w.useContext(ke)||{};return e.jsx("div",{className:`${(d=i==null?void 0:i.page)==null?void 0:d.wrapper2}`,children:e.jsx("div",{className:(u=i==null?void 0:i.page)==null?void 0:u.wrapper3,children:e.jsx("div",{children:"Dashboard"})})})}function zS({item:t,dataItems:s,attributes:n,logo:r,edit:a,rightMenu:l}){var u,p;const{baseUrl:i,theme:c,user:d}=w.useContext(ke)||{};return e.jsx("div",{className:`${(u=c==null?void 0:c.page)==null?void 0:u.wrapper2}`,children:e.jsx("div",{className:(p=c==null?void 0:c.page)==null?void 0:p.wrapper3,children:e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-2xl p-3 font-thin flex-1",children:"Pages"})}),e.jsx("div",{children:e.jsx(US,{item:t,dataItems:s,edit:!0})})]})})})}const Ua={nav:{container:t=>"w-full border-2 border-teal-400",navItemContainer:"h-full border-l overflow-y-auto overflow-x-hidden pt-3 scrollbar-xs",navItem:({isActive:t,isPending:s})=>`block px-4 py-2 font-light ${t?"w-[256px] bg-white text-blue-500 border-l border-y":"w-[248px] hover:bg-blue-100 text-slate-600"}`,navItemChild:({isActive:t,isPending:s})=>`block px-4 py-2 font-light ${t?"w-[238px] bg-white text-blue-500 border-l border-y":"w-[230px] hover:bg-blue-100 text-slate-600"}`,addItemButton:"cursor-pointer px-4 py-2 mt-3 hover:bg-blue-100 w-full text-slate-400 border-t border-slate-200"}};function US({item:t,dataItems:s,edit:n,open:r,setOpen:a}){const l=zt(),{pathname:i="/edit"}=kt(),{baseUrl:c}=w.useContext(ke),d=w.useCallback(m=>{let h=s.reduce((y,j)=>(y[j.id]=j,y),{});function f(y,j="",N){let _=[];return y.forEach((E,L)=>{let S=N[E.id];const k={id:S.id,index:S.index,title:S.title,url_slug:S.url_slug};(S.index!==L||S.parent!==j)&&(k.index=L,k.parent=j,_.push(k)),E.children&&(_=[..._,...f(E.children,E.id,N)])}),_}let g=f(m.items,"",h),x=[...g,...s.filter(y=>!g.map(j=>j.id).includes(y.id))];g.forEach(y=>y.url_slug=pn(y,x)),Promise.all(g.map(y=>{l(_a(y),{method:"post",action:i})})).then(y=>{})},[]),u=s.sort((m,h)=>m.index-h.index).filter(m=>!m.parent).map((m,h)=>{let f={id:m.id,index:m.index,Comp:()=>e.jsx(ha,{to:`${n?`${c}/edit`:c}/${m.url_slug||m.id}`,className:Ua.nav.navItem,children:m.title})};return p(f,s,c)&&(f.children=p(m,s,c,n)),f});function p(m,h,f,g){let x=h.filter(y=>y.parent===m.id).sort((y,j)=>y.index-j.index);return x.length===0?!1:x.map((y,j)=>{let N={id:y.id,Comp:()=>e.jsx(ha,{to:`${g?`${f}/edit`:f}/${y.url_slug||y.id}`,className:Ua.nav.navItem,children:y.title},j)};return p(N,h,f,g)&&(N.children=p(y,h,f,g)),N})}return e.jsx(e.Fragment,{children:e.jsx("div",{className:Ua.nav.container(r),children:e.jsxs("div",{className:Ua.nav.navItemContainer,children:[e.jsx(Ff,{items:u,onChange:d,maxDepth:4,renderItem:({item:m})=>{let h=m.Comp;return e.jsx(h,{})}}),n&&e.jsx(WS,{dataItems:s})]})})})}function WS({dataItems:t}){const s=zt(),{pathname:n="/edit"}=kt(),{baseUrl:r,user:a}=w.useContext(ke),i={title:"New Page",index:t.filter(d=>!d.parent).reduce((d,u)=>Math.max(isNaN(u.index)?-1:u.index,d),-1)+1,published:"draft",history:[{type:" created Page.",user:a.email,time:new Date().toString()}]};i.url_slug=pn(i,t);const c=()=>{s(_a(i),{method:"post",action:n})};return e.jsx("div",{className:"pr-2",children:e.jsx("div",{onClick:c,className:Ua.nav.addItemButton,children:"+ Add Page"})})}function GS({themeOptions:t,theme:s,newTheme:n,setNewTheme:r,sectionKey:a,navKey:l,controlKey:i}){var d,u,p,m;let c=t[a][l].controls[i];return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-xs font-medium pt-1 text-slate-400",children:c.label}),e.jsx("div",{className:"w-full",children:e.jsx("select",{className:"p-2 bg-white w-full",value:((u=(d=n[a])==null?void 0:d[l])==null?void 0:u[i])||((m=(p=s[a])==null?void 0:p[l])==null?void 0:m[i]),onChange:h=>{r(In(Ie(n),{[a]:{[l]:{[i]:h.target.value}}}))},children:c.options.map(h=>e.jsx("option",{value:h,children:h},h))})})]})}function JS({onSave:t,onCancel:s}){let[n,r]=w.useState({name:"",icon:"",path:"",className:"",authLevel:"-1"});return e.jsxs("div",{children:[["name","icon","path","className","authLevel"].map(a=>e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium pt-1 text-slate-400",children:a}),e.jsx("div",{className:"w-full",children:e.jsx("input",{className:"p-2 bg-white w-full",value:n[a],onChange:l=>r({...n,[a]:l.target.value})})})]},a)),e.jsxs("div",{className:"flex justify-end py-2",children:[e.jsx("div",{className:"bg-slate-300 rounded px-2 py-1 text-slate-100 cursor-pointer",onClick:s,children:"Cancel"}),e.jsx("div",{className:"bg-blue-500 rounded px-2 py-1 text-white cursor-pointer ml-2",onClick:()=>t(n),children:"Save"})]})]})}function qS({themeOptions:t,theme:s,newTheme:n,setNewTheme:r,sectionKey:a,navKey:l,controlKey:i}){var m,h,f,g;let[c,d]=w.useState(-2);console.log("test 123",l,i,(h=(m=n.navOptions)==null?void 0:m[l])==null?void 0:h[i]);let u=t[a][l].controls[i],p=((g=(f=n==null?void 0:n[a])==null?void 0:f[l])==null?void 0:g[i])||[];return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"text-xs font-medium pt-1 text-slate-400 w-full flex justify-between",children:[e.jsxs("div",{children:[u.label," ",c]}),e.jsx("div",{children:e.jsx("button",{className:"bg-blue-500 rounded px-2 py-1 text-white cursor-pointer",onClick:()=>d(-1),children:"Add Item"})})]}),e.jsx("div",{children:p.length===0?"No Items":p.map((x,y)=>e.jsxs("div",{className:"flex w-full text-sm items-center py-1 border-b",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium text-slate-600",children:x.name})," ",e.jsx("span",{className:"text-slate-400",children:x.path})]}),e.jsx("div",{children:e.jsx(Co.PencilIcon,{onClick:()=>{console.log("pencil click"),d(y)},className:"h-5 w-5 cursor-pointer text-slate-500 hover:text-blue-500"})}),e.jsx("div",{children:e.jsx(Co.RemoveCircle,{onClick:()=>{console.log("menuItems",p),p.splice(y,1);let j=p;console.log("splice",j,y),r(In(Ie(n),{[a]:{[l]:{[i]:j}}}))},className:"h-5 w-5 cursor-pointer text-slate-500 hover:text-red-500"})})]},y))}),e.jsx("div",{children:c!==-2?e.jsx(JS,{onCancel:x=>d(-2),onSave:x=>{const y=p;c===-1?y.push(x):y[c]=x,r(In(Ie(n),{[a]:{[l]:{[i]:y}}})),d(-2)}}):""})]})}const KS={select:GS,menu:qS};function YS({item:t,dataItems:s,attributes:n,apiLoad:r,apiUpdate:a,format:l,logo:i,rightMenu:c,themes:d,...u}){var L,S,k,$,I,T;const{baseUrl:p,theme:m,user:h}=w.useContext(ke)||{},[f,g]=w.useState({}),[x,y]=w.useState({}),j=In(Ie(m),Ie(d[((S=(L=f==null?void 0:f.settings)==null?void 0:L.theme)==null?void 0:S.theme)||"default"]),Ie(f)),N={app:l.app,type:"pattern",attributes:[{key:"theme",type:"text"}]},_=w.useMemo(()=>rl(s,p,!1),[s]);w.useEffect(()=>{(async()=>{var O;let R=await r({children:[{action:"list",path:"/*",filter:{options:JSON.stringify({filter:{"data->>'doc_type'":[l.type]}})}}],format:N});g(Ie(((O=R==null?void 0:R[0])==null?void 0:O.theme)||{})),y(Ie({theme:{},...R==null?void 0:R[0]}))})()},[]);function E(){a({data:{id:x.id,theme:f},config:{format:N}}),y({...x,theme:f})}return e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"flex-1 h-full flex p-4",children:e.jsx(vy,{className:"flex-1 border",head:e.jsxs(e.Fragment,{children:[e.jsx("link",{type:"text/css",rel:"stylesheet",href:"/css/build.css"}),e.jsx("link",{href:"/fonts/font-awesome-6/css/all.min.css",rel:"stylesheet"})]}),children:e.jsx(Nr,{navItems:_,secondNav:(($=(k=f==null?void 0:f.navOptions)==null?void 0:k.secondaryNav)==null?void 0:$.navItems)||[],theme:j,children:e.jsx("div",{className:`${(I=j==null?void 0:j.page)==null?void 0:I.wrapper2}`,children:e.jsx("div",{className:`${(T=j==null?void 0:j.page)==null?void 0:T.wrapper3} `,children:"Placeholder Content"})})})})}),e.jsx($o,{custom:"top-12 h-full",children:e.jsxs("div",{className:"border-l h-full",children:[e.jsxs("div",{className:"px-1 py-2 w-full flex justify-between items-center",children:[e.jsx("div",{children:"Design Options"}),e.jsx("div",{children:e.jsx("button",{onClick:E,disabled:Fe(x.theme,f),className:"bg-blue-500 disabled:bg-slate-300  disabled:border-slate-400  rounded px-3 border border-blue-400 shadow  py-1 text-white cursor-pointer mx-2",children:"Save"})})]}),e.jsx("div",{className:"border-t",children:Object.keys(gn).map(A=>e.jsxs("div",{children:[A,Object.keys(gn[A]).map(R=>e.jsx(jy,{as:"div",className:"border-b",defaultOpen:gn[A][R].defaultOpen,children:({open:O})=>e.jsxs(e.Fragment,{children:[e.jsxs(wy,{className:"group flex w-full items-center justify-between p-1 ",children:[e.jsx("span",{className:"text-xs/6 font-bold text-slate-700 group-data-[hover]:text-slate-700/80",children:gn[A][R].label}),e.jsx("span",{children:O?e.jsx(kf,{className:"text-slate-400 h-6 w-6 mr-2"}):e.jsx(Lf,{className:"text-slate-400 h-6 w-6 mr-2"})})]}),e.jsx(Ny,{className:"text-xs/5 text-slate-700/50 py-1 px-2",children:Object.keys(gn[A][R].controls).map(M=>{const D=KS[gn[A][R].controls[M].type||"select"];return e.jsx("div",{children:e.jsx(D,{theme:m,newTheme:f,setNewTheme:g,themeOptions:gn,sectionKey:A,navKey:R,controlKey:M})},`${A}_${R}_${M}`)})})]})},R))]},A))}),e.jsx("div",{children:e.jsx("pre",{className:"text-xs",children:JSON.stringify(f,null,3)})})]})})]})}const Ta=(t=50,s=50,n=20,r=30,a=!1)=>e.jsxs("svg",{width:r,height:n,children:[e.jsx("line",{x1:"0",y1:"0",x2:"0",y2:n,stroke:"black",strokeDasharray:"4 1.5 4 1.5"}),e.jsx("rect",{x:t===100?0:5,y:"0",width:Math.max(Math.floor(r*t/100)-(t===100?0:6),0),height:n,rx:"1",ry:"1",style:{fill:"white",stroke:"black",strokeWidth:1,opacity:.5}}),e.jsx("rect",{x:r*t/100-1,y:"0",width:Math.max(Math.floor(r*s/100)-(t===100?0:6),0),height:n,rx:"1",ry:"1",style:{fill:"white",stroke:"black",strokeWidth:1,opacity:.5}}),e.jsx("line",{x1:r,y1:"0",x2:r,y2:n,stroke:"black",strokeDasharray:"4 1.5 4 1.5"})]}),Rl={"1/3":"col-span-6 md:col-span-2","1/2":"col-span-6 md:col-span-3","2/3":"col-span-6 md:col-span-4",1:"col-span-6 md:col-span-6",2:"col-span-6 md:col-span-8"},qc=[{name:"1/3",value:2,icon:Ta(40,60)},{name:"1/2",value:3,icon:Ta(50,50)},{name:"2/3",value:4,icon:Ta(60,40)},{name:"1",value:6,icon:Ta(90,0)},{name:"2",value:8,icon:Ta(100,0)}],a0=(t,s,n,r)=>["2"].includes(t)?Rl[t]:n<s?`${Rl[t]} md:col-start-2`:`${Rl[t]} md:col-start-${r}`,ZS=t=>{try{JSON.parse(t)}catch{return!1}return!0};function XS({size:t="1",setSize:s,onChange:n}){return e.jsx("div",{className:"flex space-x-1 rounded-lg bg-blue-50 p-0.5",role:"tablist","aria-orientation":"horizontal",children:qc.map((r,a)=>e.jsx("button",{className:r.name===t?"flex items-center rounded-md py-[0.4375rem] pl-2 pr-2 text-sm font-semibold lg:pr-3 bg-white shadow":"flex items-center rounded-md py-[0.4375rem] pl-2 pr-2 text-sm font-semibold lg:pr-3 hover:text-blue-500",id:"headlessui-tabs-tab-3",role:"tab",type:"button",tabIndex:-1,onClick:()=>{n(r.name)},children:r.icon},a))})}const QS=({data:t})=>e.jsxs("div",{className:"p-2 rounded-md bg-red-300 border-red-500 text-white min-h-[50px]",children:["Error: ",t==null?void 0:t.status]});function r0({value:t,placeholder:s,onChange:n,edit:r=!1}){const a=Array.isArray(t)?t:(t==null?void 0:t.split(","))||[],[l,i]=b.useState("");console.log("hola",t,a);const c=["Hazard","Hurricane","Avalanche","Earthquake","Rec","S1","S1-a","S2","S2-a","S2-a1","S2-a2","S2-a3","S2-a4","S2-a5","S2-a6","S2-a7","S2-a8","S2-a9","S3","S3-a","S3-a1","S3-a2","S3-a3","S3-b2","S4","S4-a","S4-b","S5","S5-a","S5-b","S5-1","S6","S6-a","S6-a1","S6-a2","S6-a2.i","S6-a2.ii","S6-a2.iii","S6-b","S7","S7-a","S7-a1","S7-a2","S7-a3","S7-a4","S8","S8-1","S8-a","S8-a1","S8-a2","S8-a2.i","S8-a3","S8-a3.i","S8-a3.ii","S8-a3.iii","S8-a3.iv","S8-a3.v","S8-a4","S8-b","S8-b1","S8-b2","S8-b3","S8-c","S8-c1","S8-c2","S9","S9-a","S9-b","S10","S10-a","S10-b","S10-c","S10-d","S11","S11-a","S11-b","S12","S12-a","S12-b","S13","S13-a","S13-b","S13-b1","S13-b2","S14","S14-a","S14-a1","S14-a2","S14-a3","S14-b","S14-b1","S14-b2","S15","S15-a","S15-a1","S15-a2","S15-a3","S16","S16-a","S16-b","S17","S17-1","S17-1a","S17-1b","S18","S18-a","S18-b","S18-b1","S18-b2","S18-b3","S18-c","S19","S19-a","S19-1","S20","S20-a","S20-b","HHPD1","HHPD1-1","HHPD1-a","HHPD1-b","HHPD1-b1","HHPD1-b2","HHPD1-2","HHPD2","HHPD2-1","HHPD2-a","HHPD2-b","HHPD2-b1","HHPD2-b2","HHPD2-b3","HHPD2-b4","HHPD2-c","HHPD3","HHPD3-1","HHPD3-a","HHPD3-a1","HHPD3-a2","HHPD3-a3","HHPD3-a4","HHPD3-b","HHPD4","HPPD4-1","HPPD4-a","HPPD4-a1","HPPD4-a2","HPPD4-a3","HPPD4-a4","HPPD4-a5","HHPD4-b","HHPD4-c","HHPD5","HHPD5-a","HHPD6","HHPD6-1","HHPD6-a","HHPD6-b","HHPD6-c","HHPD7","HHPD7-1","HHPD7-a","HHPD7-b","FMAG1","FMAG1-a","FMAG1-b","FMAG1-c","FMAG1-d","FMAG2","FMAG2-a"];return e.jsxs("div",{className:"w-full border border-blue-200",children:[r&&e.jsxs(Ds,{children:[e.jsx("div",{className:"relative z-20",children:e.jsx(Ds.Input,{className:"h-12 w-[189px] bg-blue-50 m-1 p-2 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm",placeholder:s,value:l,onChange:d=>{i(d.target.value)},onKeyUp:d=>{d.key==="Enter"&&l.length>0&&(n([...a,l].join(",")),i(""))}})}),c.filter(d=>!(l!=null&&l.length)||d.toLowerCase().includes(l.toLowerCase())).length>0&&e.jsx(Ds.Options,{static:!0,className:"max-h-96 transform-gpu scroll-py-3 overflow-y-auto p-3",children:c.filter(d=>l.length>0&&d.toLowerCase().includes(l.toLowerCase())).filter((d,u)=>u<=5).map(d=>e.jsx(Ds.Option,{value:d,onClick:()=>{i(d)},className:({active:u})=>`flex cursor-pointer select-none rounded-xl p-1 ${u&&"bg-gray-100"}`,children:({active:u})=>e.jsxs("div",{children:[e.jsx("i",{className:"text-sm text-blue-400 fa fa-tag"}),e.jsx("span",{className:`ml-2 text-sm font-medium ${u?"text-gray-900":"text-gray-700"}`,children:d})]})},d))})]}),e.jsx("div",{className:"w-full min-h-8 border-blue-200",children:a.map((d,u)=>e.jsxs("div",{className:"px-2 py-1 text-sm border border-blue-200 m-1 rounded bg-blue-100 flex justify-between items-center",children:[e.jsx("div",{className:"text-slate-600",children:d}),r&&e.jsx("div",{className:"cursor-pointer",onClick:()=>n(a.filter(p=>p!==d).join(",")),children:e.jsx(Cf,{className:"text-red-400 hover:text-red-600  w-[16px] h-[16px]"})})]},u))})]})}function e8({value:t,i:s,onChange:n,attributes:r,size:a,onCancel:l,onSave:i,onRemove:c}){var j,N,_,E,L,S;const[d,u]=b.useState(!1);let p=t==null?void 0:t.title,{theme:m}=w.useContext(ke)||{};const h=(k,$)=>{Fe(t,{...t,[k]:$})||n({...t,[k]:$})};let f=(j=r==null?void 0:r.title)==null?void 0:j.EditComp,g=(N=r==null?void 0:r.level)==null?void 0:N.EditComp;(_=r==null?void 0:r.tags)==null||_.EditComp;let x=(E=r==null?void 0:r.element)==null?void 0:E.EditComp,y=(L=r==null?void 0:r.helpText)==null?void 0:L.EditComp;return e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex w-full",children:[e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"z-10 relative",children:e.jsxs("div",{className:"absolute mr-16 top-[-14px] right-[-60px] flex",children:[e.jsx("button",{className:"flex items-center text-md cursor-pointer pr-1",onClick:()=>u(!d),children:e.jsx(Nf,{className:"text-red-400 hover:text-red-600 w-[24px] h-[24px]",title:"Move Down"})}),e.jsx(Df,{title:`Delete Section ${(t==null?void 0:t.title)||""} ${t==null?void 0:t.id}`,open:d,prompt:`Are you sure you want to delete this section? All of the section data will be permanently removed
                                            from our servers forever. This action cannot be undone.`,setOpen:k=>u(k),onDelete:()=>{async function k(){await c(),u(!1)}k()}}),e.jsxs(ft,{className:"relative",children:[e.jsx(ft.Button,{className:"flex items-center cursor-pointer pt-1 pr-1",children:e.jsx(Vc,{className:"text-blue-400 hover:text-blue-600  w-[24px] h-[24px]",title:"Help Text"})}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(ft.Panel,{anchor:"bottom",className:"absolute shadow-lg bg-white z-10 w-screen max-w-sm transform px-4 border border-blue-200 lg:max-w-lg",children:e.jsx(y,{value:t==null?void 0:t.helpText,onChange:k=>h("helpText",k)})})})]}),e.jsxs(ft,{className:"relative",children:[e.jsx(ft.Button,{className:"flex items-center cursor-pointer pt-1 pr-1",children:e.jsx(Hc,{className:"text-blue-400 hover:text-blue-600  w-[24px] h-[24px]",title:"Tags"})}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(ft.Panel,{anchor:"bottom",className:"absolute -left-[100px] shadow-lg bg-white z-10 w-[200px] transform border border-blue-200 ",children:e.jsx(r0,{edit:!0,className:"p-2 flex-0",value:t==null?void 0:t.tags,placeholder:"Add Tag...",onChange:k=>h("tags",k)})})})]}),e.jsx("button",{className:"text-lg cursor-pointer hover:text-blue-500 text-slate-400 pr-1",onClick:i,children:e.jsx(_f,{className:"text-slate-400 hover:text-blue-500 w-[24px] h-[24px]"})}),e.jsx("button",{className:" flex items-center text-md cursor-pointer  py-1 pr-1 text-slate-400",onClick:l,children:e.jsx(Fc,{className:"text-slate-400 hover:text-red-500 w-[24px] h-[24px]"})}),e.jsxs(ft,{className:"relative",children:[e.jsx(ft.Button,{className:"flex items-center cursor-pointer pt-1 pr-1",children:e.jsx(Ef,{className:"text-blue-400 hover:text-blue-600  w-[24px] h-[24px]",title:"section details"})}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(ft.Panel,{anchor:"bottom",className:"fixed right-0 lg:absolute lg:left-[35px] lg:top-[14px] shadow bg-blue-50 z-10 w-[280px] min-h-[250px] z-40 rounded border border-blue-300 transform px-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex-0 grow",children:e.jsx(f,{className:`${(S=m==null?void 0:m.heading)==null?void 0:S.base} ${(m==null?void 0:m.heading[t==null?void 0:t.level])||(m==null?void 0:m.heading.default)}`,placeholder:"Section Title",value:t==null?void 0:t.title,onChange:k=>h("title",k)})}),e.jsx("div",{children:e.jsx(g,{className:"p-2 w-full bg-transparent",value:t==null?void 0:t.level,placeholder:"level",options:r.level.options,onChange:k=>h("level",k)})}),e.jsx("div",{className:"self-center pl-2",children:e.jsx(XS,{size:t==null?void 0:t.size,onChange:k=>h("size",k)})})]})})})]})]})})]}),p&&e.jsx("div",{className:"flex h-[50px]",children:e.jsx("div",{className:"flex",children:e.jsx(f,{className:`p-2 w-full font-sans font-medium text-md  ${(t==null?void 0:t.level)==="1"?"text-blue-500 font-bold text-xl tracking-wider py-1 pl-1":(t==null?void 0:t.level)==="2"?"text-lg tracking-wider":(t==null?void 0:t.level)==="3"?"text-md tracking-wide":""}`,placeholder:"Section Title",value:t==null?void 0:t.title,onChange:k=>h("title",k)})})}),e.jsx("div",{className:"",children:e.jsx(x,{value:t==null?void 0:t.element,onChange:k=>h("element",k),size:a})})]})}function o0({value:t,i:s,attributes:n,edit:r,onEdit:a,moveItem:l,addAbove:i}){var k,$,I,T,A,R,O,M,D;let[c,d]=b.useState(),[u,p]=b.useState();gc(c,u);const{baseUrl:m,user:h,theme:f}=w.useContext(ke)||{};let g=(k=n==null?void 0:n.title)==null?void 0:k.ViewComp;($=n==null?void 0:n.tags)==null||$.ViewComp;let x=(I=n==null?void 0:n.element)==null?void 0:I.ViewComp,y=(T=n==null?void 0:n.helpText)==null?void 0:T.ViewComp,j=t==null?void 0:t.title,N=t==null?void 0:t.helpText,_=!1,E=(A=t==null?void 0:t.element)==null?void 0:A["template-section-id"],L=r&&typeof a=="function"&&!E;const S=w.useMemo(()=>e.jsx(x,{value:t==null?void 0:t.element}),[t]);return e.jsxs("div",{className:"h-full ",style:{pageBreakInside:"avoid"},children:[e.jsxs("div",{className:"flex w-full ",children:[e.jsx("div",{className:"flex-1"}),t!=null&&t.is_header&&r?e.jsx("div",{className:"z-10 relative ",children:e.jsx("div",{className:"absolute mr-16 right-[-60px] flex",children:e.jsx("button",{className:" flex items-center text-md cursor-pointer hover:text-blue-500 text-slate-400",onClick:a,children:e.jsx(Ni,{className:"text-slate-400 hover:text-blue-500"})})})}):e.jsx("div",{className:"z-10 relative",children:e.jsxs("div",{className:"absolute mr-16 top-[-14px] right-[-60px] flex items-center h-[32px]",children:[((R=t==null?void 0:t.tags)==null?void 0:R.length)&&e.jsxs(ft,{className:"pr-1 h-[24px] z-20",children:[e.jsx(ft.Button,{className:"flex items-center cursor-pointer",children:e.jsx(Hc,{className:"text-slate-400 hover:text-blue-500 w-[24px] h-[24px]",title:"Move Up"})}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(ft.Panel,{anchor:"bottom",className:"absolute -left-[174px] shadow-lg bg-white z-30 w-[200px] transform border border-blue-200 ",children:e.jsx(r0,{className:"p-2 flex-0",value:t==null?void 0:t.tags,placeholder:"Add Tag...",onChange:P=>updateAttribute("tags",P)})})})]}),N&&e.jsxs(ft,{className:"relative pr-1 h-[24px]",children:[e.jsx(ft.Button,{className:" cursor-pointer ",children:e.jsx(Vc,{className:"text-blue-400 hover:text-blue-500 w-[24px] h-[24px]",title:"Move Up"})}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(ft.Panel,{className:"absolute shadow bg-white z-10 w-screen max-w-sm transform px-4 border border-blue-200 lg:max-w-lg",children:e.jsx(y,{value:t==null?void 0:t.helpText})})})]}),L&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"flex items-center text-md cursor-pointer hover:text-blue-500 text-slate-400 pr-1",onClick:()=>l(s,-1),children:e.jsx($f,{className:"text-slate-400 hover:text-blue-500 w-[24px] h-[24px]",title:"Move Up"})}),e.jsx("button",{className:"flex items-center text-md cursor-pointer hover:text-blue-500 text-slate-400 pr-1",onClick:()=>l(s,1),children:e.jsx(Sf,{className:"text-slate-400 hover:text-blue-500 w-[24px] h-[24px]",title:"Move Down"})}),e.jsx("button",{className:" flex items-center text-md cursor-pointer hover:text-blue-500 py-1 pr-1 text-slate-400",onClick:()=>{var P,F;return navigator.clipboard.writeText(JSON.stringify({"element-type":(P=t==null?void 0:t.element)==null?void 0:P["element-type"],"element-data":(F=t==null?void 0:t.element)==null?void 0:F["element-data"]}))},children:e.jsx(If,{title:"Copy Section",className:"text-slate-400 hover:text-blue-500 w-[24px] h-[24px]"})}),e.jsx("button",{className:" flex items-center text-md cursor-pointer hover:text-blue-500 py-1 pr-1 text-slate-400",onClick:a,children:e.jsx(Ni,{className:"text-slate-400 hover:text-blue-500 w-[24px] h-[24px]"})}),e.jsx("button",{className:"text-lg cursor-pointer hover:text-blue-500 text-slate-400 pr-3",onClick:i,children:e.jsx(Rc,{className:"text-slate-400 hover:text-blue-500 w-[24px] h-[24px]"})})]})]})})]}),(j||_)&&e.jsxs("div",{className:`flex w-full h-[50px] items-center ${(t==null?void 0:t.level)==="1"?"border-b":""} `,children:[e.jsx("div",{id:`#${(O=t==null?void 0:t.title)==null?void 0:O.replace(/ /g,"_")}`,className:`flex-1 flex-row py-2  font-display font-medium uppercase scroll-mt-36 ${j?"":"invisible"}`,children:e.jsx(g,{className:`w-full ${f.heading[t==null?void 0:t.level]||f.heading.default}`,value:t==null?void 0:t.title})}),((D=(M=t==null?void 0:t.element)==null?void 0:M["element-type"])==null?void 0:D.includes("Map:"))&&e.jsx(je,{className:"hidden",to:`/interact/${t==null?void 0:t.id}`,title:"interact",children:e.jsx("i",{className:"fa-light fa-window-restore"})}),j&&typeof a=="function"&&!E?e.jsx(e.Fragment,{}):E&&typeof a=="function"?e.jsx("i",{className:"pl-5 py-0.5 fa-light fa-lock p-2 text-slate-400",title:"Template generated section"}):e.jsx(e.Fragment,{})]}),e.jsx("div",{className:"h-full ",children:S})]})}const t8=({onClick:t,showpageToggle:s})=>e.jsxs("div",{className:"flex w-full",children:[e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:`z-10 relative ${s?"w-12":"w-8"}`,children:e.jsx("div",{className:"absolute right-[14px] top-[-9px] flex",children:e.jsx("button",{className:"cursor-pointer pr-0.5",onClick:t,children:e.jsx(Rc,{className:"w-[24px] h-[24px] hover:text-blue-500 text-slate-400"})})})})]}),l0=()=>{const t=kt();return b.useLayoutEffect(()=>{const{hash:s}=t,n=r=>+r.slice(1);if(s){const r=document.getElementById(n(s));if(r){let a=r.getBoundingClientRect();setTimeout(function(){window.scrollTo(a.x,a.y-170)},100)}}},[t]),null},s8=({Component:t,value:s,onChange:n,attr:r,full_width:a=!1,...l})=>{(!s||!s.map)&&(s=[]);const[i,c]=b.useState([]);w.useEffect(()=>{c([...s,""])},[s]);const[d,u]=w.useState({index:-1,value:"",type:"new"}),p=_=>u({...d,value:_}),m=_=>u({...d,index:_}),h=()=>{u({index:-1,value:"",type:"new"})},f=()=>{var L,S,k,$;let _=Ie(s),E="";d.type==="update"?(_[d.index]=d.value,E=`edited section ${(L=d==null?void 0:d.value)!=null&&L.title?`${(S=d==null?void 0:d.value)==null?void 0:S.title} ${d.index+1}`:d.index+1}`):(_.splice(d.index,0,d.value),E=`added section ${(k=d==null?void 0:d.value)!=null&&k.title?`${($=d==null?void 0:d.value)==null?void 0:$.title} ${d.index+1}`:d.index+1}`),h(),c([..._,""]),n(_,E)},g=()=>{var E,L;let _=Ie(s);d.type==="update"&&_.splice(d.index,1),h(),n(_,`removed section ${(E=d==null?void 0:d.value)!=null&&E.title?`${(L=d==null?void 0:d.value)==null?void 0:L.title} ${d.index+1}`:d.index+1}`)},x=_=>{u({index:_,value:s[_],type:"update"})};function y(_,E){let L=Ie(s),S=_+E;if(!(S<0||S>=L.length)){var k=L.splice(_,1)[0];L.splice(S,0,k),n(L)}}let j=8;const N={centered:"md:grid-cols-[1fr_repeat(6,_minmax(_100px,_170px))_1fr]",fullwidth:"md:grid-cols-[_minmax(_0px,0px)_repeat(6,_1fr)_minmax(_0px,0px)]"};return e.jsxs("div",{className:`w-full grid grid-cols-6 ${N[a==="show"?"fullwidth":"centered"]} gap-1`,children:[e.jsx(l0,{}),i.map((_,E)=>{var I,T,A,R;const L=(d.index===E?(I=d==null?void 0:d.value)==null?void 0:I.size:_==null?void 0:_.size)||"1",S=(T=qc.find(O=>O.name===L))==null?void 0:T.value,k=6-j;j===0?j=S:S<=k?j+=S:j=S;const $=a0(L,S,k,j);return e.jsxs("div",{id:`${_==null?void 0:_.id}`,className:`${_!=null&&_.size?"h-full":""} ${$} `,children:[d.index===E?e.jsx(e8,{value:d.value,onChange:p,onSave:f,onCancel:h,onRemove:g,attributes:r.attributes,size:L,i:E}):"",_!==""&&!(d.index===E&&d.type==="update")&&(!(_!=null&&_.status)||(_==null?void 0:_.status)==="success")?e.jsx(o0,{value:_,i:E,moveItem:y,attributes:r.attributes,edit:!0,onEdit:d.index===-1?O=>x(E):null,addAbove:()=>m(E)}):((A=_==null?void 0:_.status)==null?void 0:A.length)>1?e.jsx(QS,{data:_}):"",!((R=i[0])!=null&&R.is_header)&&d.index==-1&&E===i.length-1?e.jsx("div",{className:"",children:e.jsx(t8,{onClick:()=>m(E)})}):e.jsx("div",{className:""})]},E)})]})},n8=({Component:t,value:s,attr:n,full_width:r})=>{var p;if(!s||!s.map)return"";const{baseUrl:a,user:l,theme:i}=w.useContext(ke)||{};(p=l==null?void 0:l.email)==null||p.includes("availabs");let c=8,d={centered:"md:grid-cols-[1fr_repeat(6,_minmax(_100px,_170px))_1fr]",fullwidth:"md:grid-cols-[_minmax(_0px,0px)_repeat(6,_1fr)_minmax(_0px,0px)]"};const u=m=>{var g;let h=(g=m==null?void 0:m.element)==null?void 0:g["element-data"],f=typeof h=="object"?h:h&&ZS(h)?JSON.parse(h):{};return!(f!=null&&f.hideSection)};return e.jsxs("div",{className:`w-full grid grid-cols-6 ${d[r==="show"?"fullwidth":"centered"]} gap-1`,children:[s.filter(m=>u(m)).map((m,h)=>{var j;const f=(m==null?void 0:m.size)||"1",g=(j=qc.find(N=>N.name===f))==null?void 0:j.value,x=6-c;c===0?c=g:g<=x?c+=g:c=g;const y=a0(f,g,x,c);return e.jsx("div",{id:m==null?void 0:m.id,className:`${y}`,"data-size":g,children:e.jsx(o0,{attributes:n.attributes,i:h,value:m},h)},h)}),e.jsx(l0,{})]})},Hu={EditComp:s8,ViewComp:n8},a8={app:"dms-site",type:"cms-section",attributes:[{key:"title",type:"text",required:!1,default:"Untitled Section"},{key:"is_header",type:"boolean",hidden:"true",required:!1},{key:"helpText",type:"lexical"},{key:"level",type:"select",options:[{value:"0",label:"Hidden"},{value:"1",label:"H1"},{value:"2",label:"H2"},{value:"3",label:"H3"},{value:"4",label:"H4"}],required:!1,default:"1"},{key:"tags",type:"text",required:!1},{key:"requirements",type:"text",required:!1},{key:"size",type:"text"},{key:"element",type:"selector",required:!1}]},r8={app:"dms-site",type:"page-edit",attributes:[{key:"action",type:"text"},{key:"user",type:"text"},{key:"time",type:"text"},{key:"parent_type",type:"text"}]},o8={app:"dms-site",type:"docs-page",registerFormats:[a8,r8],defaultSearch:"data ->> 'index' = '0' and (data ->> 'parent' = '' or data ->> 'parent' is null) and (data ->> 'template_id' is null)",defaultSort:t=>t.sort((s,n)=>(n.parent===null)-(s.parent===null)||s.index-n.index||+s.parent-+n.parent),attributes:[{key:"title",type:"text",required:!0,default:"New Page"},{key:"template_id",type:"number"},{key:"data_controls",type:"text",hidden:!0},{key:"generated-pages",type:"text",isArray:!0},{key:"hide_in_nav",type:"text",default:!1},{key:"index",type:"number",default:"props:index",editable:!1,hidden:!0},{key:"parent",type:"text",default:"",editable:!1,hidden:!0},{key:"url_slug",type:"text",matchWildcard:!0,hidden:!0},{key:"sidebar",type:"text",hidden:!0},{key:"header",type:"text",hidden:!0},{key:"footer",type:"text",hidden:!0},{key:"full_width",type:"text",hidden:!0},{key:"sections",type:"dms-format",isArray:!0,format:"dms-site+cms-section",DisplayComp:Hu},{key:"draft_sections",type:"dms-format",isArray:!0,format:"dms-site+cms-section",DisplayComp:Hu},{key:"published",type:"text",default:"draft"},{key:"has_changes",type:"boolean",default:!1},{key:"history",type:"dms-format",isArray:!0,format:"dms-site+page-edit"}]},l8=({user:t})=>{var s;return e.jsxs("div",{className:"flex justify-column align-middle py-1 px-4 min-w-44",children:[e.jsx("div",{className:"pt-[4px]",children:e.jsx("span",{className:`rounded-full border-2 border-blue-400
                    inline-flex items-center justify-center 
                    h-6 w-6 sm:h-8 sm:w-8 ring-white text-white 
                    bg-blue-500 overflow-hidden`,children:e.jsx(Co.User,{className:"text-slate-50 "})})}),e.jsxs("span",{className:"pl-2",children:[e.jsx("div",{className:"text-md font-thin tracking-tighter  text-left text-blue-600 group-hover:text-white ",children:t.email?t.email:""}),e.jsx("div",{className:"text-xs font-medium -mt-1 tracking-widest text-left text-gray-500 group-hover:text-gray-200",children:(s=t==null?void 0:t.groups)!=null&&s[0]?t.groups[0]:""})]})]})},zu=({to:t,icon:s,children:n})=>e.jsx(je,{to:t,children:e.jsx("div",{className:"px-6 py-1 bg-blue-500 text-white hover:text-blue-100",children:e.jsxs("div",{className:"hover:translate-x-2 transition duration-100 ease-out hover:ease-in",children:[e.jsx("i",{className:`${s} `}),e.jsx("span",{className:"pl-2",children:n})]})})}),i8=({title:t,children:s})=>{var c,d;const{user:n,baseUrl:r,theme:a}=w.useContext(ke),l=kt();let i=((d=(c=a==null?void 0:a.navOptions)==null?void 0:c.authMenu)==null?void 0:d.navItems)||[{name:"Patterns",icon:"fad fa-sign-out-alt pb-2 pr-1",path:"/list",authLevel:5},{name:"Manager",icon:"fad fa-sign-out-alt pb-2 pr-1",path:`${r}/manage`,authLevel:5}];return e.jsx(e.Fragment,{children:n.authed?e.jsx(o4,{control:e.jsx(l8,{user:n}),className:"hover:bg-blue-500 group z-40 ",children:e.jsxs("div",{className:"p-1 bg-blue-500 z-40",children:[e.jsx("div",{className:"py-2",children:i.map((u,p)=>e.jsx("div",{children:n.authLevel>=(+u.authLevel||-1)&&e.jsx(zu,{to:u.path,icon:u.icon,children:u.name})},p))}),!n.fake&&e.jsx("div",{className:"py-1 border-t border-blue-400",children:e.jsx(zu,{to:"/auth/logout",icon:"fad fa-sign-out-alt pb-2 pr-1",children:"Logout"})})]})}):e.jsx(je,{className:"flex items-center px-8 text-lg font-bold h-12 text-slate-500 px-4",to:"/auth/login",state:{from:l==null?void 0:l.pathname},children:"Login"})})},ke=w.createContext(void 0),c8=({app:t="dms-site",type:s="docs-page",rightMenu:n=e.jsx(i8,{}),baseUrl:r="/",logo:a,authLevel:l=-1,themes:i={default:{}},pattern:c,site:d,pgEnv:u,API_HOST:p})=>{var g,x,y;let m=In(Ie(Pf),Ie(i[(y=(x=(g=c==null?void 0:c.theme)==null?void 0:g.settings)==null?void 0:x.theme)==null?void 0:y.theme]||i.default),(c==null?void 0:c.theme)||{});r=r==="/"?"":r;const h=e.jsx(je,{to:`${r||"/"}`,className:"h-12 flex px-4 items-center",children:e.jsx("div",{className:"rounded-full h-8 w-8 bg-blue-500 border-2 border-blue-300 hover:bg-blue-600"})});m.navOptions.logo||(m.navOptions.logo=a||h);const f=Ie(o8);return f.app=t,f.type=s,Kc(f.registerFormats,t,s),i0(f.attributes,t,s),{format:f,baseUrl:r,API_HOST:p,children:[{type:({children:j,user:N={},..._})=>{const{falcor:E,falcorCache:L}=Us.useFalcor();return e.jsx(ke.Provider,{value:{baseUrl:r,user:N,theme:m,falcor:E,falcorCache:L,pgEnv:u,app:t,type:s,Menu:()=>e.jsx(e.Fragment,{children:n})},children:j})},authLevel:l,action:"list",path:"/*",filter:{options:JSON.stringify({filter:{"data->>'hide_in_nav'":["null"]}}),attributes:["title","index","url_slug","parent","published","hide_in_nav"]},children:[{type:j=>e.jsx(J4,{...j}),path:"edit/*",action:"edit"},{type:j=>e.jsx(f4,{...j}),filter:{attributes:["title","index","url_slug","parent","published","hide_in_nav","sections","sidebar","header","footer","full_width"]},path:"/*",action:"view"},{type:j=>e.jsx(z_,{...j}),path:"search/*",action:"list"},{type:VS,path:"manage/*",action:"list",filter:{options:JSON.stringify({filter:{"data->>'hide_in_nav'":["null"]}}),attributes:["title","index","url_slug","parent","published","hide_in_nav"]},children:[{type:HS,path:"manage/",action:"edit"},{type:j=>e.jsx(YS,{themes:i,...j}),path:"manage/design",action:"edit"},{type:zS,path:"manage/pages",action:"edit"},{type:TS,action:"list",path:"manage/templates/*",lazyLoad:!0,filter:{options:JSON.stringify({filter:{"data->>'template_id'":["-99"]}}),attributes:["title","index","url_slug","parent","hide_in_nav","template_id"]}},{type:DS,action:"edit",path:"manage/templates/edit/:id"},{type:w6,action:"edit",path:"manage/templates/pages/:id"}]}]}]}},Kc=(t,s,n)=>(Array.isArray(t)&&(t=t.map(r=>(r.app=s,r.type=`${n}|${r.type}`,r.registerFormats=Kc(r.registerFormats,s,n),r.attributes=i0(r.attributes,s,n),r))),t),i0=(t,s,n)=>(Array.isArray(t)&&(t=t.map(r=>(r.format=r.format?`${s}+${n}|${r.format.split("+")[1]}`:void 0,Kc(r,s,n)))),t);w.createContext(void 0);af("selector",t0);const oe="hazmit_dama",tt=t=>{try{JSON.parse(t)}catch{return!1}return!0},Cr=({data:t,keys:s,indexFormat:n,keyFormat:r,valueFormat:a})=>e.jsxs("div",{className:`
      flex flex-col px-2 pt-1 rounded bg-white
      ${(s==null?void 0:s.length)<=1?"pb-2":"pb-1"}`,children:[e.jsx("div",{className:"font-bold text-lg leading-6 border-b-2 mb-1 pl-2",children:n(C(t,"index",null))}),s.slice().filter(l=>t.key===l||C(t,["data",l],0)>0).reverse().map(l=>e.jsxs("div",{className:`
            flex items-center px-2 border-2 rounded transition
            ${t.key===l?"border-current":"border-transparent"}
          `,children:[e.jsx("div",{className:"mr-2 rounded-sm color-square w-5 h-5",style:{backgroundColor:C(t,["barValues",l,"color"],null),opacity:t.key===l?1:.2}}),e.jsxs("div",{className:"mr-4",children:[r(l),":"]}),e.jsx("div",{className:"text-right flex-1",children:a(C(t,["data",l],0))})]},l)),(s==null?void 0:s.length)<=1?null:e.jsxs("div",{className:"flex pr-2",children:[e.jsx("div",{className:"w-5 mr-2"}),e.jsx("div",{className:"mr-4 pl-2",children:"Total:"}),e.jsx("div",{className:"flex-1 text-right",children:a(s.reduce((l,i)=>l+C(t,["data",i],0),0))})]})]}),il=(t="0.2",s=!1)=>{const n=s?"$":"",r=l=>l>=1e15?"Q":l>=1e12?"T":l>=1e9?"B":l>=1e6?"M":l>=1e3?"K":"",a=l=>+l<1?+Mt("0.1r")(+l):Mt(t)(+l).toString().replace(/[a-z]*[A-Z]*/g,"");return l=>`${n} ${a(l)}${r(l)}`},Qe=(t,s=2,n=!1)=>isNaN(t)?"No Data":typeof t=="number"&&t<1?`${n?"$":""} ${t==null?void 0:t.toFixed(s)}`:t>=1e15?`${n?"$":""} ${(t/1e15).toFixed(s)} Q`:t>=1e12?`${n?"$":""} ${(t/1e12).toFixed(s)} T`:t>=1e9?`${n?"$":""} ${(t/1e9).toFixed(s)} B`:t>=1e6?`${n?"$":""} ${(t/1e6).toFixed(s)} M`:t>=1e3?`${n?"$":""} ${(t/1e3).toFixed(s)} K`:typeof t=="object"?"":`${n?"$":""} ${parseInt(t)}`,c0=t=>{const[s,n]=t.replace("$","").trim().split(" "),r={k:1e3,m:1e6,b:1e9,t:1e12,q:1e15};return+s*r[n.toLowerCase()||1]},us=(t,s=!1)=>`${s?"$ ":""} ${isNaN(t)?0:parseInt(t).toLocaleString()}`,Wa=t=>{const s={year:"numeric",month:"2-digit",day:"2-digit"};return t?new Date(t).toLocaleDateString(void 0,s):""},Sa=(t,s)=>Array.from({length:s+1-t},(n,r)=>r+t),Ne={hail:{color:"#027B8E",name:"Hail",prefix:"hail",consequences:["b","p","pe","a","t"],icon:"fa-thin fa-cloud-hail"},winterweat:{color:"#76c8c8",name:"Snowstorm",prefix:"wntw",consequences:["b","p","pe","a","t"],icon:"fa-thin fa-snow-blowing"},icestorm:{color:"#98d1d1",name:"Ice Storm",prefix:"istm",consequences:["b","p","pe","t"],icon:"fa-thin fa-icicles"},coldwave:{color:"#badbdb",name:"Extreme Cold",prefix:"cwav",consequences:["b","p","pe","a","t"],icon:"fa-sharp fa-thin fa-temperature-snow"},coastal:{color:"#54bebe",name:"Coastal Hazards",prefix:"cfld",consequences:["b","p","pe","t"],icon:"fa-thin fa-house-flood"},riverine:{color:"#115f9a",name:"Flooding",prefix:"rfld",consequences:["b","p","pe","a","t"],icon:"fa-thin fa-water"},tsunami:{color:"#5e569b",name:"Tsunami",prefix:"tsun",consequences:["b","p","pe","t"],icon:"fa-solid fa-house-tsunami fa-circle"},avalanche:{color:"#776bcd",name:"Avalanche",prefix:"avln",consequences:["b","p","pe","t"],icon:"fa-solid fa-hill-avalanche fa-circle"},tornado:{color:"#9080ff",name:"Tornado",prefix:"trnd",consequences:["b","p","pe","a","t"],icon:"fa-thin fa-tornado"},lightning:{color:"#beb9db",name:"Lightning",prefix:"ltng",consequences:["b","p","pe","t"],icon:"fa-thin fa-cloud-bolt"},wildfire:{color:"#ff1a40",name:"Wildfire",prefix:"wfir",consequences:["b","p","pe","a","t"],icon:"fa-thin fa-fire"},heatwave:{color:"#ff571a",name:"Extreme Heat",prefix:"hwav",consequences:["b","p","pe","a","t"],icon:"fa-thin fa-temperature-sun"},volcano:{color:"#FF8066",name:"Volcano",prefix:"vlcn",consequences:["b","p","pe","t"],icon:"fa-thin fa-volcano"},landslide:{color:"#786028",name:"Landslide",prefix:"lnds",consequences:["b","p","pe","t"],icon:"fa-solid fa-hill-rockslide fa-circle"},earthquake:{color:"#a57c1b",name:"Earthquake",prefix:"erqk",consequences:["b","p","pe","t"],icon:"fa-thin fa-house-crack"},drought:{color:"#d2980d",name:"Drought",prefix:"drgt",consequences:["a","t"],icon:"fa-thin fa-sun-dust"},hurricane:{color:"#ffb400",name:"Hurricane",prefix:"hrcn",consequences:["b","p","pe","a","t"],icon:"fa-thin fa-hurricane"},wind:{color:"#b9c3d5",name:"Wind",prefix:"swnd",consequences:["b","p","pe","a","t"],icon:"fa-thin fa-wind"}},so={};for(const t in $t.schemeGroups)$t.schemeGroups[t].forEach(s=>{const n=$t[s];for(const r in n)r in so||(so[r]=[]),so[r].push({type:`${t[0].toUpperCase()}${t.slice(1)}`,name:s,category:"Colorbrewer",colors:n[r]})});const d0=(t,s,n=!1)=>{let r=C(so,[t],[]).reduce((a,l)=>l.name===s?l.colors:a,[]).slice();return n&&r.reverse(),r},d8=d0(12,"Set3"),Yc=t=>{if(typeof t=="function")return t;let s=[...d8];if(typeof t=="string"){const[n,r,a=!1]=t.split("-");s=d0(n,r),a&&s.reverse()}else Array.isArray(t)&&(s=[...t]);return(n,r)=>s[r%s.length]},Uu=t=>t===null||isNaN(t),u8={type:"band",domain:[]},m8={type:"linear",domain:[]},p8={band:fp,point:xc,ordinal:gp,linear:js,power:Cy,log:_y,symlog:Sy,quantize:Hn,quantile:wa},Wu=t=>{let{type:s,domain:n,range:r,data:a,padding:l,paddingInner:i,paddingOuter:c,getter:d,exponent:u=1,base:p=10}=t;n!=null&&n.length||(n=d(a));const m=p8[s]().domain(n).range(r);return s==="band"&&m.paddingInner(l||i).paddingOuter(l||c),s==="point"&&m.paddingOuter(l||c),s==="power"&&m.exponent(u),s==="log"&&m.base(p),m},Hs=t=>t,is=[],nn={},u0={left:70,top:20,right:20,bottom:30},h8={min:0},m0=(t,s,n)=>{const r=w.useRef({}),a=w.useRef([s,n]),l=w.useMemo(()=>{const i=C(t,"shouldComponentUpdate",[]);return!Fe([s,n],a.current)||i.reduce((c,d)=>c||!Fe(C(r,["current",d]),C(t,d)),!i.length)},[t,s,n]);return w.useEffect(()=>{r.current=t,a.current=[s,n]},[t,s,n]),l},f8=t=>{const s=t&&t.current;return s?s.getBoundingClientRect():{width:0,height:0}},Zc=(t,s)=>{const[n,r]=w.useState({width:0,height:0,x:0,y:0}),a=w.useCallback(()=>{const l=f8(t),{width:i,height:c,x:d,y:u}=l;(i!==n.width||c!==n.height)&&(typeof s=="function"&&s({width:i,height:c,x:d,y:u}),r({width:i,height:c,x:d,y:u}))},[t,n,s]);return w.useEffect(()=>(window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}),[a]),w.useEffect(()=>{a()}),n},Xc={textBase:"text-base",textSmall:"text-sm",textLarge:"text-lg",paddingBase:"py-1 px-2",paddingSmall:"py-0 px-1",paddingLarge:"py-2 px-4",contentBg:"bg-white",accent1:"bg-blue-100",accent2:"bg-gray-300",accent3:"bg-gray-400",accent4:"bg-gray-500",highlight1:"bg-blue-200",highlight2:"bg-blue-300",highlight3:"bg-blue-400",highlight4:"bg-blue-500"},Mi=t=>{const{adjustedWidth:s,adjustedHeight:n,type:r="band",rotateLabels:a=!1,domain:l,scale:i,format:c,ticks:d,tickValues:u,secondary:p,label:m,margin:h,tickDensity:f=2,showGridLines:g=!0,showAnimations:x=!0,gridLineOpacity:y=.25,axisColor:j="currentColor",axisOpacity:N=1}=t,_=w.useRef();return w.useEffect(()=>{_.current&&g8({ref:_.current,showAnimations:x,rotateLabels:a,adjustedWidth:s,adjustedHeight:n,type:r,domain:l,scale:i,format:c,ticks:d,tickValues:u,secondary:p,label:m,margin:h,tickDensity:f,showGridLines:g,gridLineOpacity:y,axisColor:j,axisOpacity:N})},[s,n,r,x,l,i,c,d,u,p,m,h,f,a,g,y,j,N]),e.jsx("g",{ref:_})},g8=({ref:t,showAnimations:s,rotateLabels:n,adjustedWidth:r,adjustedHeight:a,type:l,domain:i,scale:c,format:d,ticks:u,tickValues:p,secondary:m,label:h,margin:f,tickDensity:g,showGridLines:x,gridLineOpacity:y,axisColor:j,axisOpacity:N})=>{const{left:_,top:E,bottom:L}=f;if(g=g||100,!p&&l==="band"){const B=Math.ceil(r/100*g),V=Math.ceil(i.length/B),G=Math.floor(V*.5);p=i.filter((Z,X)=>(V===1||X>0)&&(V===1||X<i.length-1)&&!((X-G)%V))}else if(!p&&l==="ordinal"){const B=100/g;let V=0;p=[];for(let G=0;G<i.length;++G)G>0&&(V+=c(i[G])-c(i[G-1])),(!p.length&&V>=B*.5||V>=B)&&(p.push(i[G]),V=0)}const S=$y(c).tickFormat(d);p?S.tickValues(p):u&&S.ticks(u);const k=tr().duration(1e3),$=B=>s?B.transition(k):B,T=lt(t).selectAll("g.animated-group").data(["animated-group"]).join(B=>B.append("g").attr("class","animated-group").call(V=>V.style("transform",`translate(${_}px, ${a+E}px)`)),B=>B.call(V=>$(V).style("transform",`translate(${_}px, ${a+E}px)`)),B=>B.call(V=>$(V).remove())).selectAll("g.axis-group").data(i.length?["axis-group"]:[]).join(B=>B.append("g").attr("class","axis-group").call(V=>$(V.style("transform","scale(0, 0)")).style("transform","scale(1, 1)")),B=>B.call(V=>$(V).style("transform","scale(1, 1)")),B=>B.call(V=>$(V).style("transform","scale(0, 0)").remove())),A=T.selectAll("g.axis").data(i.length?["axis-bottom"]:[]).join("g").attr("class","axis axis-bottom").classed("secondary",m);$(A).call(S).select(".domain").attr("stroke",j).attr("opacity",N),T.selectAll("text.axis-label").data(i.length&&h?[h]:[]).join("text").attr("class","axis-label axis-label-bottom").style("transform",`translate(${r*.5}px, calc(${L}px - 0.5rem))`).attr("text-anchor","middle").attr("fill","currentColor").attr("font-size","1rem").attr("font-weight","bold").text(B=>B),n?T.selectAll(".tick text").attr("text-anchor","start").style("transform","translate(0.5rem, 0.1rem) rotate(45deg)"):T.selectAll(".tick text").attr("text-anchor",null).style("transform",null);const R=l==="linear"&&x&&!!c&&!!i.length,O=T.selectAll("line.grid-line"),M=O.size(),D=R?c.ticks(u).length:0,P=M&&M<D?c(i[1]*1.5):c(i[0]),F=R?i[0]===0&&i[1]===0?0:c(i[1]*1.5):0;O.data(R?c.ticks(u):[]).join(B=>B.append("line").attr("class","grid-line").attr("x1",P).attr("x2",P).attr("y1",0).attr("y2",-a).attr("stroke","currentColor").attr("stroke-opacity",y).call(V=>$(V).attr("x1",G=>c(G)+.5).attr("x2",G=>c(G)+.5)),B=>B.call(V=>$(V.attr("stroke","currentColor").attr("stroke-opacity",y)).attr("y2",-a).attr("x1",G=>c(G)+.5).attr("x2",G=>c(G)+.5)),B=>B.call(V=>$(V).attr("x1",F).attr("x2",F).remove()))},Bi=t=>{const{adjustedWidth:s,adjustedHeight:n,showGridLines:r=!0,showAnimations:a=!0,gridLineOpacity:l=.25,axisColor:i="currentColor",axisOpacity:c=1,domain:d,scale:u,format:p,type:m="linear",secondary:h,label:f,margin:g,ticks:x=10,tickValues:y,tickDensity:j=8}=t,N=w.useRef();return w.useEffect(()=>{N.current&&x8(N.current,a,s,n,d,u,m,p,h,f,g,x,y,r,l,i,c,j)},[s,n,r,d,u,m,p,a,h,f,g,x,y,l,i,c,j]),e.jsx("g",{ref:N})},x8=(t,s,n,r,a,l,i,c,d,u,p,m,h,f,g,x,y,j)=>{const{left:N,top:_}=p;if(!h&&i==="band"){const P=Math.ceil(r/100*j),F=Math.ceil(a.length/P),B=Math.floor(F*.5);h=a.filter((V,G)=>(F===1||G>0)&&(F===1||G<a.length-1)&&!((G-B)%F))}else if(!h&&i==="ordinal"){const P=100/j;let F=0;h=[];for(let B=0;B<a.length;++B)B>0&&(F+=l(a[B])-l(a[B-1])),(!h.length&&F>=P*.5||F>=P)&&(h.push(a[B]),F=0)}const E=Ey(l).tickFormat(c);h?E.tickValues(h):m&&E.ticks(m);const L=tr().duration(1e3),S=P=>s?P.transition(L):P,$=lt(t).selectAll("g.animated-group").data(["animated-group"]).join(P=>P.append("g").attr("class","animated-group").call(F=>F.style("transform",`translate(${N}px, ${_}px)`)),P=>P.call(F=>S(F).style("transform",`translate(${N}px, ${_}px)`)),P=>P.call(F=>S(F).style("transform",`translate(${N}px, ${_}px)`).remove())).selectAll("g.axis-group").data(a.length?["axis-group"]:[]).join(P=>P.append("g").attr("class","axis-group").call(F=>S(F.style("transform",`translateY(${r}px) scale(0, 0)`)).style("transform","translateY(0px) scale(1, 1)")),P=>P.call(F=>S(F).style("transform","translateY(0px) scale(1, 1)")),P=>P.call(F=>S(F).style("transform",`translateY(${r}px) scale(0, 0)`).remove())),I=$.selectAll("g.axis").data(a.length?["axis-left"]:[]).join("g").attr("class","axis axis-left").classed("secondary",d);S(I).call(E).call(P=>P.selectAll(".tick line").attr("stroke","currentColor").attr("stroke-opacity",g)).select(".domain").attr("stroke",x).attr("opacity",y),$.selectAll("text.axis-label").data(a.length&&u?[u]:[]).join("text").attr("class","axis-label axis-label-left").style("transform",`translate(${-N+20}px, ${r*.5}px) rotate(-90deg)`).attr("text-anchor","middle").attr("fill","currentColor").attr("font-size","1rem").attr("font-weight","bold").text(P=>P);const T=i==="linear"&&f&&l&&a.length,A=$.selectAll("line.grid-line"),R=A.size(),O=T?l.ticks(m).length:0,M=T?R&&R<O?l(a[1]*1.5):l(a[1]):0,D=T?l(a[1]*1.5):r;A.data(T?l.ticks(m):[]).join(P=>P.append("line").attr("class","grid-line").attr("x1",0).attr("x2",n).attr("y1",M).attr("y2",M).attr("stroke","currentColor").attr("stroke-opacity",g).call(F=>S(F).attr("y1",B=>l(B)+.5).attr("y2",B=>l(B)+.5)),P=>P.call(F=>S(F.attr("stroke","currentColor").attr("stroke-opacity",g)).attr("x2",n).attr("y1",B=>l(B)+.5).attr("y2",B=>l(B)+.5)),P=>P.call(F=>S(F).attr("y1",D).attr("y2",D).remove()))},Ai=t=>{const{adjustedWidth:s,adjustedHeight:n,showGridLines:r=!0,gridLineOpacity:a=.25,axisColor:l="currentColor",axisOpacity:i=1,domain:c,scale:d,format:u,type:p="linear",showAnimations:m=!0,secondary:h,label:f,margin:g,ticks:x=10,tickValues:y}=t,j=w.useRef();return w.useEffect(()=>{j.current&&b8(j.current,m,s,n,c,d,p,u,h,f,g,x,y,r,a,l,i)},[s,n,r,c,d,p,u,m,h,f,g,x,y,a,l,i]),e.jsx("g",{ref:j})},b8=(t,s,n,r,a,l,i,c,d,u,p,m,h,f,g,x,y)=>{const{left:j,right:N,top:_}=p,E=ky(l).tickFormat(c);h?E.tickValues(h):m&&E.ticks(m);const L=tr().duration(1e3),S=D=>s?D.transition(L):D,$=lt(t).selectAll("g.animated-group").data(["animated-group"]).join(D=>D.append("g").attr("class","animated-group").call(P=>P.style("transform",`translate(${n+j}px, ${_}px)`)),D=>D.call(P=>S(P).style("transform",`translate(${n+j}px, ${_}px)`)),D=>D.call(P=>S(P).style("transform",`translate(${n+j}px, ${_}px)`).remove())).selectAll("g.axis-group").data(a.length?["axis-group"]:[]).join(D=>D.append("g").attr("class","axis-group").call(P=>S(P.style("transform",`translateY(${r}px) scale(0, 0)`)).style("transform","translateY(0px) scale(1, 1)")),D=>D.call(P=>S(P).style("transform","translateY(0px) scale(1, 1)")),D=>D.call(P=>S(P).style("transform",`translateY(${r}px) scale(0, 0)`).remove())),I=$.selectAll("g.axis").data(a.length?["axis-right"]:[]).join("g").attr("class","axis axis-right");if(S(I).call(E).call(D=>D.selectAll(".tick line").attr("stroke","currentColor").attr("stroke-opacity",g)).select(".domain").attr("stroke",x).attr("opacity",y),$.selectAll("g.axis.axis-right .domain").attr("stroke-dasharray",d?"8 4":null),$.selectAll("text.axis-label").data(a.length&&u?[u]:[]).join("text").attr("class","axis-label axis-label-right").style("transform",`translate(${N-20}px, ${r*.5}px) rotate(90deg)`).attr("text-anchor","middle").attr("fill","currentColor").attr("font-size","1rem").text(D=>D),i!=="linear"||!f)return;const T=$.selectAll("line.grid-line"),A=T.size(),R=l.ticks().length,O=A&&A<R?l(a[1]*1.5):l(0),M=l(a[1]*1.5);T.data(a.length?l.ticks():[]).join(D=>D.append("line").attr("class","grid-line").attr("stroke-dasharray",d?"8 4":null).attr("x1",0).attr("x2",-n).attr("y1",O).attr("y2",O).attr("stroke","currentColor").attr("stroke-opacity",g).call(P=>S(P).attr("y1",F=>l(F)+.5).attr("y2",F=>l(F)+.5)),D=>D.call(P=>S(P.attr("stroke","currentColor").attr("stroke-opacity",g)).attr("x2",-n).attr("y1",F=>l(F)+.5).attr("y2",F=>l(F)+.5)),D=>D.call(P=>S(P).attr("y1",M).attr("y2",M).remove()))},y8=({pos:t,svgWidth:s,svgHeight:n,margin:r,position:a})=>{const[c,d]=t;switch(a){case"above":{const u=s-r.right;return`translate(
        max(
          min(calc(${c}px - 50%), calc(${u-10}px - 100%)),
          calc(${r.left+10}px)
        ),
        calc(-100% - ${30-d}px)
      )`}default:{const u=n-r.bottom,p=`max(
          ${r.top+10}px,
          min(${d-30}px, calc(${u-10}px - 100%))
        )`;return c<r.left+(s-r.left-r.right)*.5?`translate(
          ${c+30}px,
          ${p}
        )`:`translate(
        calc(-100% + ${c-30}px),
        ${p}
      )`}}},Qc=({show:t,children:s,...n})=>e.jsx("div",{className:`
      absolute top-0 left-0 z-50 pointer-events-none
      rounded whitespace-nowrap hover-comp
    `,style:{display:t?"inline-block":"none",transform:y8(n),boxShadow:"2px 2px 8px 0px rgba(0, 0, 0, 0.75)",transition:"transform 0.15s ease-out"},children:s}),Oi="update-data",p0="set-show",v8=(t,s)=>{const{type:n,...r}=s;switch(n){case Oi:case p0:return{...t,...r};default:return t}},j8={show:!1,pos:[0,0],data:null,target:"graph"},ed=t=>{const[s,n]=w.useReducer(v8,j8),r=w.useMemo(()=>mc(n,25),[n]),a=w.useCallback((c,d,{pos:u=null,target:p="graph"}={})=>{const m=t.current.getBoundingClientRect();r({type:Oi,show:!0,target:p,data:d,pos:u?[u.x-m.x,u.y-m.y]:[c.clientX-m.x,c.clientY-m.y]})},[t,r]),l=w.useCallback((c,d,{pos:u=null,target:p="graph"}={})=>{const m=t.current.getBoundingClientRect();r({type:Oi,show:!0,target:p,data:d,pos:u?[u.x-m.x,u.y-m.y]:[c.clientX-m.x,c.clientY-m.y]})},[t,r]),i=w.useCallback(c=>{r({type:p0,show:!1})},[r]);return{hoverData:s,onMouseOver:a,onMouseMove:l,onMouseLeave:i}},w8=({data:t,keys:s,indexFormat:n,keyFormat:r,valueFormat:a,showTotals:l=!0})=>e.jsxs("div",{className:`
      flex flex-col px-2 pt-1 rounded
      ${s.length<=1?"pb-2":"pb-1"}
      ${Xc.accent1}
    `,children:[e.jsx("div",{className:"font-bold text-lg leading-6 border-b-2 mb-1 pl-2",children:n(C(t,"index",null))}),s.slice().reverse().filter(i=>C(t,["data",i],!1)).map(i=>e.jsxs("div",{className:`
            flex items-center px-2 border-2 rounded transition
            ${t.key===i?"border-current":"border-transparent"}
          `,children:[e.jsx("div",{className:"mr-2 rounded-sm color-square w-5 h-5",style:{backgroundColor:C(t,["barValues",i,"color"],null),opacity:t.key===i?1:.2}}),e.jsxs("div",{className:"mr-4",children:[r(i),":"]}),e.jsx("div",{className:"text-right flex-1",children:a(C(t,["data",i],0))})]},i)),s.length<=1?null:e.jsxs("div",{className:"flex pr-2",children:[e.jsx("div",{className:"w-5 mr-2"}),e.jsx("div",{className:"mr-4 pl-2",children:"Total:"}),e.jsx("div",{className:"flex-1 text-right",children:a(s.reduce((i,c)=>i+C(t,["data",c],0),0))})]})]}),N8={HoverComp:w8,indexFormat:Hs,keyFormat:Hs,valueFormat:Hs,position:"side",showTotals:!0},C8={xDomain:[],yDomain:[],XScale:fp(),YScale:js(),adjustedWidth:0,adjustedHeight:0},ba=t=>{const{data:s=is,keys:n=is,margin:r=nn,hoverComp:a=nn,axisBottom:l=null,xScale:i=nn,axisLeft:c=null,axisRight:d=null,yScale:u=nn,indexBy:p="index",className:m="",paddingInner:h=0,paddingOuter:f=0,padding:g,colors:x,groupMode:y="stacked",orientation:j="vertical",showAnimations:N=!0,addons:_=[]}=t,E=w.useMemo(()=>({...u0,...r}),[r]),L=w.useMemo(()=>{const U={...N8,...a};return typeof U.indexFormat=="string"&&(U.indexFormat=Mt(U.indexFormat)),typeof U.keyFormat=="string"&&(U.keyFormat=Mt(U.keyFormat)),typeof U.valueFormat=="string"&&(U.valueFormat=Mt(U.valueFormat)),U},[a]),S=w.useRef(),{width:k,height:$}=Zc(S),[I,T]=w.useState(C8),A=w.useRef(is),R=w.useRef(is),O=w.useCallback(()=>{A.current=A.current.filter(({id:U})=>!(U in R.current)),T(U=>({...U}))},[]),M=m0(t,k,$),D=j==="horizontal";w.useEffect(()=>{if(k&&$||M){const U=Math.max(0,k-(E.left+E.right)),q=Math.max(0,$-(E.top+E.bottom)),K=Wu({...u8,...i,type:"band",getter:pe=>pe.map(ge=>C(ge,p,null)),data:s,range:D?[q,0]:[0,U],padding:g,paddingInner:h,paddingOuter:f}),ne=K.domain(),J=K.bandwidth(),ae=K.step(),de=K.paddingOuter()*ae,fe=Wu({...m8,...u,getter:pe=>{if(ne.length){if(y==="stacked")return pe.reduce((ge,le)=>{const ie=n.reduce((be,_e)=>be+C(le,_e,0),0);return Uu(ie)?ge:[0,Math.max(ie,C(ge,1,0))]},[]);if(y==="grouped")return pe.reduce((ge,le)=>{const ie=n.reduce((be,_e)=>Math.max(be,C(le,_e,0)),0);return Uu(ie)?ge:[0,Math.max(ie,C(ge,1,0))]},[])}else return[0,0]},data:s,range:D?[0,U]:[q,0]}),ve=fe.domain();ve[0]===0&&ve[1]===0&&fe.range([q,q]);const me=Yc(x),[xe,re]=A.current.reduce((pe,ge)=>{const[le,ie]=pe;return le[ge.id]="updating",ie[ge.id]=ge,ge.state="exiting",[le,ie]},[{},{}]);A.current=s.map((pe,ge)=>{var ie;delete re[pe[p]];const le={};if(y==="stacked"){let be=D?0:q;return{stacks:n.map((Re,Pe)=>{const Ge=C(pe,Re,0),Ue=D?fe(Ge):J,ut=D?J:Math.max(0,q-fe(Ge)),at=me(Ge,Pe,pe,Re);D||(be-=ut),le[Re]={value:Ge,color:at};const Bt={data:pe,key:Re,width:Ue,height:ut,index:pe[p],y:D?0:be,x:D?be:0,color:at,value:Ge,barValues:le};return D&&(be+=Ue),Bt}),barValues:le,left:D?0:K(pe[p]),top:D?K(pe[p]):0,data:pe,state:C(xe,pe[p],"entering"),id:((ie=pe==null?void 0:pe[p])==null?void 0:ie.toString())||"0"}}else if(y==="grouped")return{stacks:n.map((_e,Re)=>{const Pe=C(pe,_e,0),Ge=D?J/n.length*Re:Math.min(q,fe(Pe)),Ue=me(pe,Re,_e);return le[_e]={value:Pe,color:Ue},{data:pe,key:_e,width:D?fe(Pe):J/n.length,height:D?J/n.length:q-Ge,index:pe[p],y:Ge,x:D?0:J/n.length*Re,color:Ue,value:Pe,barValues:le}}),barValues:le,left:D?0:de+ge*ae,top:D?q-(de+(ge+1)*ae):0,data:pe,state:C(xe,pe[p],"entering"),id:pe[p].toString()};return{stacks:[]}}),R.current=re;const Q=Object.values(re);Q.length&&setTimeout(O,1050),A.current=A.current.concat(Q),T({xDomain:ne,yDomain:ve,XScale:K,YScale:fe,adjustedWidth:U,adjustedHeight:q})}},[s,n,k,$,y,E,x,p,O,g,h,f,M,j]);const{onMouseMove:P,onMouseLeave:F,hoverData:B}=ed(S),{xDomain:V,XScale:G,yDomain:Z,YScale:X,...H}=I,{HoverComp:z,position:W,...Y}=L;return e.jsxs("div",{className:"w-full h-full avl-graph-container relative",ref:S,children:[e.jsxs("svg",{className:`w-full h-full block avl-graph ${m}`,children:[A.current.length?j==="horizontal"?e.jsxs("g",{children:[l?e.jsx(Mi,{type:"linear",...H,margin:E,scale:X,domain:Z,showAnimations:N,...l}):null,c?e.jsx(Bi,{type:"band",...H,margin:E,scale:G,domain:V,showAnimations:N,...c}):null,d?e.jsx(Ai,{type:"band",...H,margin:E,scale:G,domain:V,showAnimations:N,...d}):null]}):e.jsxs("g",{children:[l?e.jsx(Mi,{type:"band",...H,margin:E,scale:G,domain:V,showAnimations:N,...l}):null,c?e.jsx(Bi,{type:"linear",...H,margin:E,scale:X,domain:Z,showAnimations:N,...c}):null,d?e.jsx(Ai,{type:"linear",...H,margin:E,scale:X,domain:Z,showAnimations:N,...d}):null]}):null,e.jsxs("g",{style:{transform:`translate(${E.left}px, ${E.top}px)`},onMouseLeave:F,children:[A.current.map(({id:U,...q})=>e.jsx(S8,{...q,svgHeight:I.adjustedHeight,onMouseMove:P,showAnimations:N},U)),A.current.length?_.map((U,q)=>e.jsx(U,{...I,xScale:G,yScale:X,showAnimations:N},q)):null]})]}),e.jsx(Qc,{...B,position:W,svgWidth:k,svgHeight:$,margin:E,children:B.data?e.jsx(z,{data:B.data,keys:n,...Y}):null})]})},_8=w.memo(t=>{const{state:s,width:n,svgHeight:r,height:a,y:l,x:i,color:c,onMouseMove:d,Key:u,index:p,value:m,data:h,barValues:f,showAnimations:g}=t,x=w.useRef();w.useEffect(()=>{if(s==="entering"){const j=lt(x.current).attr("width",n).attr("height",0).attr("x",i).attr("y",r);g?j.transition().duration(1e3).attr("height",a).attr("y",l).attr("fill",c):j.attr("height",a).attr("y",l).attr("fill",c)}else if(s==="exiting"){const j=lt(x.current);g?j.transition().duration(1e3).attr("height",0).attr("y",r):j.attr("height",0).attr("y",r)}else{const j=lt(x.current);g?j.transition().duration(1e3).attr("height",a).attr("x",i).attr("y",l).attr("width",n).attr("fill",c):j.attr("height",a).attr("x",i).attr("y",l).attr("width",n).attr("fill",c)}},[x,s,n,r,a,i,l,c,g]);const y=w.useCallback(j=>{d(j,{color:c,key:u,index:p,value:m,data:h,barValues:f})},[d,c,u,p,m,h,f]);return e.jsx("rect",{className:"avl-stack",ref:x,onMouseMove:y})}),S8=w.memo(({stacks:t,left:s=0,top:n=0,state:r,showAnimations:a,...l})=>{const i=w.useRef();return w.useEffect(()=>{if(r==="entering")lt(i.current).attr("transform",`translate(${s} ${n})`);else{const c=lt(i.current);a?c.transition().duration(1e3).attr("transform",`translate(${s} ${n})`):c.attr("transform",`translate(${s} ${n})`)}},[i,r,s,n,a]),e.jsx("g",{className:"avl-bar",ref:i,children:t.map(({key:c,...d},u)=>e.jsx(_8,{Key:c,state:r,...l,...d,showAnimations:a},c))})}),$8=({data:t,idFormat:s,xFormat:n,yFormat:r,lineTotals:a,showTotals:l=!0})=>e.jsxs("div",{className:`
        flex flex-col px-2 pt-1 pb-2 rounded
        ${Xc.accent1}
      `,children:[e.jsxs("div",{className:"border-b-2 px-2 flex",children:[e.jsx("div",{className:"font-bold text-lg leading-6 flex-1",children:n(C(t,"x",null),t)}),l?e.jsx("div",{children:"(Line Total)"}):null]}),e.jsxs("div",{className:"px-2",children:[t.data.sort((i,c)=>a[c.id]-a[i.id]).map(({id:i,y:c,color:d,isMax:u,...p})=>e.jsxs("div",{className:`
                  rounded border-2 flex
                  ${u?"border-current":"border-transparent"}
                `,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:`
                    flex items-center
                    ${u?"border-current":"border-transparent"}
                    transition pl-2
                  `,children:[e.jsx("div",{className:`
                      mr-2 rounded-sm color-square w-5 h-5 transition border-2
                    `,style:{borderColor:d,borderStyle:"solid",background:`${d}${u?"ff":"33"}`}}),e.jsxs("div",{className:"mr-4 flex-1",children:[s(i,p),":"]})]})}),e.jsx("div",{children:e.jsx("div",{className:`
                    text-right pr-4 transition
                  `,children:r(c,p)})}),l?e.jsx("div",{children:e.jsxs("div",{className:`
                      text-right transition pr-2
                    `,children:["(",r(a[i],p),")"]})}):null]},i)),t.secondary.sort((i,c)=>a[c.id]-a[i.id]).map(({id:i,y:c,color:d,isMax:u,...p})=>e.jsxs("div",{className:`
                  rounded border-2 grid grid-cols-3
                  ${u?"border-current":"border-transparent"}
                `,children:[e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:`
                    flex items-center
                    ${u?"border-current":"border-transparent"}
                    transition pl-2
                  `,children:[e.jsx("div",{className:`
                      mr-2 rounded-sm color-square w-5 h-5 transition border-2
                    `,style:{borderColor:d,borderStyle:"solid",background:`${d}${u?"ff":"33"}`}}),e.jsxs("div",{className:"mr-4",children:[s(i,p),":"]})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:`
                    text-right pr-4 transition
                  `,children:r(c,p)})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:`
                    text-right transition pr-2
                  `,children:["(",r(a[i],p),")"]})})]},i))]})]}),E8={HoverComp:$8,idFormat:Hs,xFormat:Hs,yFormat:Hs,position:"side",showTotals:!0},k8={xDomain:[],yDomain:[],secDomain:[],XScale:xc(),YScale:js(),SecScale:js(),adjustedWidth:0,adjustedHeight:0,sliceData:{},lineTotals:{},barData:[]},L8=t=>{const{data:s=is,secondary:n=is,margin:r=nn,xScale:a=null,axisBottom:l=null,yScale:i=null,axisLeft:c=null,secScale:d=null,axisRight:u=null,hoverComp:p=nn,indexBy:m="id",className:h="",padding:f=.5,strokeWidth:g=1,shouldComponentUpdate:x=null,showAnimations:y=!0,colors:j}=t,N=w.useMemo(()=>{const K={...E8,...p};return typeof K.idFormat=="string"&&(K.idFormat=Mt(K.idFormat)),typeof K.xFormat=="string"&&(K.xFormat=Mt(K.xFormat)),typeof K.yFormat=="string"&&(K.yFormat=Mt(K.yFormat)),K},[p]),_=w.useMemo(()=>({...u0,...r}),[r]),E=w.useRef(),{width:L,height:S}=Zc(E),[k,$]=w.useState(k8),I=w.useRef(is),T=w.useRef(is),A=w.useRef(is),R=w.useRef(is),O=w.useCallback((K=!1)=>{let ne=K?A:I,J=K?R:T;ne.current=ne.current.filter(({id:ae})=>!(ae in J.current)),$(ae=>({...ae}))},[]),M=m0(t,L,S);w.useEffect(()=>{if(!(L&&S)||!M)return;const K=Math.max(0,L-(_.left+_.right)),ne=Math.max(0,S-(_.top+_.bottom));let J=s.length?s[0].data.map(we=>we.x):[];const ae={...h8,...c};let de=[];J.length&&(de=s.reduce((we,De)=>{const Ce=De.data.reduce((Xe,ot)=>Math.max(Xe,+ot.y),0);return isNaN(Ce)?we:[ae.min,Math.max(Ce,C(we,1,0))]},[]));let ue=[];J.length&&(ue=n.reduce((we,De)=>{const Ce=De.data.reduce((Xe,ot)=>Math.max(Xe,+ot.y),0);return isNaN(Ce)?we:[0,Math.max(Ce,C(we,1,0))]},[]));const fe=xc().padding(f).domain(J).range([0,K]);a&&(J=C(a,"domain",J),fe.domain(J));const ve=js().domain(de).range([ne,0]);i&&(de=C(i,"domain",de),ve.domain(de));const se=js().domain(ue).range([ne,0]);d&&(ue=C(d,"domain",ue),se.domain(ue));const me=Lr().curve(Ir).x(we=>fe(we.x)).y(we=>ve(we.y)),xe=Lr().curve(Ir).x(we=>fe(we.x)).y(we=>se(we.y)),re=ve(de[0]),Q=Lr().curve(Ir).x(we=>fe(we)).y(we=>re),pe=Q(J),ge=se(ue[0]),le=Lr().curve(Ir).x(we=>fe(we)).y(we=>ge),ie=le(J),be=Yc(j),_e={},[Re,Pe]=I.current.reduce((we,De)=>{const[Ce,Xe]=we;return Ce[De[m]]="updating",Xe[De[m]]=De,De.state="exiting",[Ce,Xe]},[{},{}]),Ge=J.reduce((we,De)=>(we[De]=[],we),{});I.current=s.map((we,De)=>{const{data:Ce,...Xe}=we;delete Pe[we[m]];const ot=be(we,De);return _e[we[m]]=0,Ce.forEach(({x:Vt,y:Gt})=>{_e[we[m]]+=Gt,Vt in Ge&&Ge[Vt].push({...Xe,color:ot,y:Gt})}),{line:me(Ce),baseLine:pe,color:ot,state:C(Re,we[m],"entering"),id:we[m].toString()}}),T.current=Pe;const Ue=Object.values(Pe);Ue.length&&setTimeout(O,1050),I.current=I.current.concat(Ue);for(const we in Ge){const De=Ge[we],{i:Ce}=De.reduce((Xe,ot,Vt)=>(ot.isMax=!1,ot.y>Xe.y?{y:ot.y,i:Vt}:Xe),{y:0,i:-1});Ce>-1&&(De[Ce].isMax=!0)}let[ut,at]=A.current.reduce((we,De)=>{const[Ce,Xe]=we;return Ce[De[m]]="updating",Xe[De[m]]=De,De.state="exiting",[Ce,Xe]},[{},{}]);const Bt=J.reduce((we,De)=>(we[De]=[],we),{});A.current=n.map((we,De)=>{const{data:Ce,...Xe}=we;delete at[we[m]];const ot=be(we,De+I.current.length);return _e[we[m]]=0,Ce.forEach(({x:Vt,y:Gt})=>{_e[we[m]]+=Gt,Bt[Vt].push({...Xe,color:ot,y:Gt})}),{line:xe(Ce),baseLine:ie,color:ot,state:C(ut,we[m],"entering"),id:we[m].toString()}}),R.current=at;const Ut=Object.values(at);Ut.length&&setTimeout(O,1050,!0),A.current=A.current.concat(Ut);for(const we in Bt){const De=Bt[we],{i:Ce}=De.reduce((Xe,ot,Vt)=>(ot.isMax=!1,ot.y>Xe.y?{y:ot.y,i:Vt}:Xe),{y:0,i:-1});Ce>-1&&(De[Ce].isMax=!0)}const Wt=fe.step(),Xt=fe.padding()*Wt-Wt*.5,Te=J.map((we,De)=>({left:Xt+De*Wt,center:fe(we),data:Ge[we],secondary:Bt[we],height:ne,width:Wt,id:we}));$({xDomain:J,yDomain:de,XScale:fe,YScale:ve,barData:Te,indexBy:m,SecScale:se,secDomain:ue,adjustedWidth:K,adjustedHeight:ne,sliceData:Ge,secSliceData:Bt,lineTotals:_e})},[s,L,S,_,I,j,f,O,m,n,c,M]);const{onMouseMove:D,onMouseLeave:P,hoverData:F}=ed(E),{xDomain:B,XScale:V,yDomain:G,YScale:Z,secDomain:X,SecScale:H,lineTotals:z,barData:W,...Y}=k,{HoverComp:U,position:q,...te}=N;return e.jsxs("div",{className:"w-full h-full relative avl-graph-container relative",ref:E,children:[e.jsxs("svg",{className:`w-full h-full block avl-graph ${h}`,children:[I.current.length?e.jsxs("g",{children:[l?e.jsx(Mi,{...Y,margin:_,scale:V,domain:B,showAnimations:y,...l}):null,c?e.jsx(Bi,{...Y,margin:_,scale:Z,domain:G,showAnimations:y,...c}):null]}):null,e.jsxs("g",{style:{transform:`translate(${_.left}px, ${_.top}px)`},onMouseLeave:P,children:[I.current.map(({id:K,...ne})=>e.jsx(Gu,{...ne,onMouseMove:D,strokeWidth:g,showAnimations:y},K)),A.current.map(({id:K,...ne})=>e.jsx(Gu,{...ne,secondary:!0,onMouseMove:D,strokeWidth:g,showAnimations:y},K)),W.map(({id:K,...ne})=>e.jsx(I8,{id:K,...ne,onMouseMove:D},K)),F.show?e.jsx("line",{stroke:"currentColor",strokeWidth:"1",style:{transform:`translate(${F.data.center}px)`,transition:"transform 0.15s ease-out"},x1:.5,y1:0,x2:.5,y2:Y.adjustedHeight}):null]}),A.current.length?e.jsx("g",{children:u?e.jsx(Ai,{...Y,secondary:!0,margin:_,scale:H,domain:X,...u}):null}):null]}),e.jsx(Qc,{...F,position:q,svgWidth:L,svgHeight:S,margin:_,children:F.data?e.jsx(U,{data:F.data,lineTotals:z,...te}):null})]})},Gu=w.memo(({line:t,baseLine:s,state:n,color:r,strokeWidth:a=1,secondary:l=!1,showAnimations:i})=>{const c=w.useRef();return w.useEffect(()=>{if(n==="entering"){const d=lt(c.current).attr("d",s).attr("stroke",r).attr("stroke-dasharray",l?"8 4":null).attr("stroke-width",a);i?d.transition().duration(1e3).attr("d",t):d.attr("d",t)}else if(n==="exiting"){const d=lt(c.current);i?d.transition().duration(1e3).attr("d",s):d.attr("d",s)}else{const d=lt(c.current);i?d.transition().duration(1e3).attr("stroke",r).attr("stroke-width",a).attr("d",t):d.attr("stroke",r).attr("stroke-width",a).attr("d",t)}},[c,n,t,s,r,l,i]),e.jsx("g",{children:e.jsx("path",{ref:c,fill:"none",strokeWidth:"4"})})}),I8=w.memo(({id:t,left:s,center:n,data:r,secondary:a,height:l,width:i,onMouseMove:c})=>{const d=w.useCallback(u=>{c(u,{x:t,data:r,secondary:a,center:n})},[c,t,r,a,n]);return e.jsx("rect",{fill:"#00000000",x:s,y:0,width:i,height:l,onMouseMove:d})}),T8=w.memo(({x:t,width:s,height:n,color:r,state:a,onMouseMove:l,onClick:i,Key:c,index:d,value:u,showAnimations:p,data:m,indexData:h,indexes:f})=>{const g=w.useRef();w.useEffect(()=>{if(a==="entering"){const j=lt(g.current).attr("width",0).attr("height",n).attr("x",0).attr("y",0).attr("fill",r);p?j.transition().duration(1e3).attr("width",s).attr("x",t):j.attr("width",s).attr("x",t)}else if(a==="exiting"){const j=lt(g.current);p?j.transition().duration(1e3).attr("width",0).attr("height",n).attr("x",0).attr("fill",r):j.attr("width",0).attr("height",n).attr("x",0).attr("fill",r)}else{const j=lt(g.current);p?j.transition().duration(1e3).attr("width",s).attr("height",n).attr("x",t).attr("fill",r):j.attr("width",s).attr("height",n).attr("x",t).attr("fill",r)}},[t,s,n,r,a,p]);const x=w.useCallback(j=>{l(j,{color:r,key:c,index:d,value:u,data:m,x:t,width:s,indexData:h,indexes:f})},[l,r,c,d,u,m,t,s,h,f]),y=w.useMemo(()=>i?j=>{i(j,{key:c,index:d,value:u})}:null,[i,c,d,u]);return e.jsx("rect",{ref:g,className:"avl-grid",onMouseMove:x,onClick:y})});w.memo(({index:t,grid:s,top:n,state:r,showAnimations:a,onHoverEnter:l,onHoverLeave:i,className:c,...d})=>{const u=w.useRef();w.useEffect(()=>{r==="entering"?lt(u.current).attr("transform",`translate(0 ${n})`):a?lt(u.current).transition().duration(1e3).attr("transform",`translate(0 ${n})`):lt(u.current).attr("transform",`translate(0 ${n})`)},[r,n,a]);const p=w.useMemo(()=>l?h=>l(h,t):null,[l,t]),m=w.useMemo(()=>i?h=>i(h,t):null,[i,t]);return e.jsx("g",{ref:u,className:`avl-grid-horizontal ${c||""}`,onMouseEnter:p,onMouseLeave:m,children:s.map(({key:h,...f})=>e.jsx(T8,{Key:h,state:r,...d,...f,showAnimations:a},h))})});const M8=({data:t,keys:s,indexFormat:n,keyFormat:r,valueFormat:a,...l})=>e.jsxs("div",{className:`
      flex flex-col px-2 pt-1 rounded
      ${s.length<=1?"pb-2":"pb-1"}
      ${Xc.accent1}
    `,children:[e.jsx("div",{className:"font-bold text-lg leading-6 border-b-2 mb-1 pl-2",children:n(C(t,"index",null))}),s.map(i=>e.jsxs("div",{className:`
            flex items-center px-2 border-2 rounded transition
            ${t.key===i?"border-current":"border-transparent"}
          `,children:[e.jsx("div",{className:"mr-2 rounded-sm color-square w-5 h-5",style:{backgroundColor:C(t,["colorMap",t.index,i],null),opacity:t.key===i?1:.2}}),e.jsxs("div",{className:"mr-4",children:[r(i),":"]}),e.jsx("div",{className:"text-right flex-1",children:a(C(t,["data",i],0))})]},i)),s.length<=1?null:e.jsxs("div",{className:"flex pr-2",children:[e.jsx("div",{className:"w-5 mr-2"}),e.jsx("div",{className:"mr-4 pl-2",children:"Total:"}),e.jsx("div",{className:"flex-1 text-right",children:a(s.reduce((i,c)=>i+C(t,["data",c],0),0))})]})]}),B8={HoverComp:M8,indexFormat:Hs,keyFormat:Hs,valueFormat:Hs,position:"side"},A8={radiusDomain:[],radiusScale:null,adjustedWidth:0,adjustedHeight:0,pieData:[],exiting:[]},O8=(t,s)=>{const{type:n,...r}=s;switch(n){case"update-state":{const{pieData:a}=t,l=a.reduce((i,c)=>(i[c.index]=c,i),{});return r.pieData.forEach(i=>{i.index in l&&(i.state="updating",delete l[i.index])}),{...t,...r,pieData:[...r.pieData,...Object.values(l).map(i=>({...i,state:"exiting"}))],exiting:Object.keys(l)}}case"exit-data":return{...t,pieData:t.pieData.filter(a=>r.exiting.includes(a.index)?a.state!=="exiting":!0),exiting:t.exiting.filter(a=>!r.exiting.includes(a))};default:return t}},P8={left:10,top:10,right:10,bottom:10},D8=(t,s,n)=>{let r,a;const l=Math.ceil(Math.sqrt(n*t/s));Math.floor(l*s/t)*l<n?r=s/Math.ceil(l*s/t):r=t/l;const i=Math.ceil(Math.sqrt(n*s/t));return Math.floor(i*t/s)*i<n?a=t/Math.ceil(i*t/s):a=s/i,Math.max(r,a)},R8=t=>{const{data:s=is,keys:n=is,margin:r=nn,hoverComp:a=nn,indexBy:l="index",className:i="",startAngle:c=0,endAngle:d=2*Math.PI,padAngle:u=0,colors:p}=t,m=w.useMemo(()=>({...P8,...r}),[r]),h=w.useMemo(()=>{const I={...B8,...a};return typeof I.indexFormat=="string"&&(I.indexFormat=Mt(I.indexFormat)),typeof I.keyFormat=="string"&&(I.keyFormat=Mt(I.keyFormat)),typeof I.valueFormat=="string"&&(I.valueFormat=Mt(I.valueFormat)),I},[a]),f=w.useRef(),{width:g,height:x}=Zc(f),[y,j]=w.useReducer(O8,A8),N=w.useCallback(I=>{j({type:"exit-data",exiting:I})},[]);w.useEffect(()=>{if(!(g&&x))return;const I=Math.max(0,g-(m.left+m.right)),T=Math.max(0,x-(m.top+m.bottom)),A=Iy().value(z=>z.value).startAngle(c).endAngle(d).padAngle(u).sort(null),R=Yc(p),O={},M=s.map(z=>{O[z[l]]={};const W=n.map((Y,U)=>{const q=C(z,Y,0),te=R(q,U,z,Y);return O[z[l]][Y]=te,{data:z,colorMap:O,color:te,value:q,key:Y,index:z[l]}}).filter(Y=>!!Y.value);return{index:z[l],pie:A(W),total:Ty(W,Y=>Y.value),state:"entering",label:z[l]}}),D=15;let P=D8(I,T,M.length),F=Math.floor(I/P),B=Math.ceil(M.length/F),V=M.length-(B-1)*F;for(;V<=F-1-(B-1);)--F,B=Math.ceil(M.length/F),V=M.length-(B-1)*F;const G=T/B;P=Math.min(P,G-D);const Z=G-P,X=ur(M,z=>z.total);X[0]===X[1]&&(X[0]=0);const H=js().domain(X).range([.3*P,.475*P]);M.forEach((z,W)=>{const Y=W%F,U=Math.floor(W/F),q=U+1<B?F:V,te=I/q;z.radius=H(z.total),z.dx=te*Y+te*.5,z.dy=G*U+(G-Z)*.5,z.ms=P}),j({type:"update-state",radiusScale:H,adjustedWidth:I,adjustedHeight:T,pieData:M})},[s,n,g,x,p,m,l,c,d,u]),w.useEffect(()=>{y.exiting.length&&setTimeout(N,1050,y.exiting)},[N,y.exiting]);const{onMouseMove:_,onMouseLeave:E,hoverData:L}=ed(f),{HoverComp:S,position:k,...$}=h;return e.jsxs("div",{ref:f,className:"w-full h-full avl-graph-container relative",children:[e.jsx("svg",{className:`w-full h-full block avl-graph ${i}`,children:e.jsx("g",{onMouseLeave:E,style:{transform:`translate(${m.left}px, ${m.top}px)`},children:y.pieData.map((I,T)=>e.jsx(V8,{...I,onMouseMove:_},I.index))})}),e.jsx(Qc,{...L,position:k,svgWidth:g,svgHeight:x,margin:m,children:L.data?e.jsx(S,{data:L.data,keys:n,...$}):null})]})},F8=w.memo(({state:t,data:s,radius:n,index:r,onMouseMove:a,endAngle:l,startAngle:i,padAngle:c})=>{const d=w.useMemo(()=>Ly().innerRadius(0).cornerRadius(0),[]),u=w.useRef();w.useEffect(()=>{lt(u.current).datum({endAngle:l,startAngle:i,padAngle:c,outerRadius:n})},[l,i,c,n]),w.useEffect(()=>{t==="entering"?lt(u.current).attr("d",d({endAngle:l,startAngle:i,padAngle:c,outerRadius:.1})).transition().duration(1e3).attr("d",d({endAngle:l,startAngle:i,padAngle:c,outerRadius:n})).attr("fill",s.color):t==="exiting"?lt(u.current).transition().duration(1e3).attr("d",d({endAngle:l,startAngle:i,padAngle:c,outerRadius:.1})):lt(u.current).transition().duration(1e3).attr("fill",s.color).attrTween("d",m=>{const h=wl(m.startAngle,i),f=wl(m.endAngle,l),g=wl(m.outerRadius,n);return x=>(m.startAngle=h(x),m.endAngle=f(x),m.outerRadius=g(x),d(m))})},[u,d,s,n,l,i,c,t]);const p=w.useCallback(m=>{a(m,{...s})},[a,s]);return e.jsx("path",{ref:u,className:"avl-slice",stroke:"none",onMouseMove:p})}),V8=w.memo(({pie:t,dx:s,dy:n,ms:r,state:a,label:l,...i})=>{const c=w.useRef();w.useEffect(()=>{a==="entering"?lt(c.current).style("transform",`translate(${s}px, ${n}px)`).style("opacity",0).transition().duration(1e3).style("opacity",1):a==="exiting"?lt(c.current).transition().duration(1e3).style("transform",`translate(${s}px, ${n}px)`).style("opacity",0):lt(c.current).transition().duration(1e3).style("transform",`translate(${s}px, ${n}px)`).style("opacity",1)},[c,s,n,a]);const d=w.useRef();return w.useEffect(()=>{lt(d.current).transition().duration(1e3).style("transform",`translateY(${r*.5+15}px)`)},[d,r]),e.jsxs("g",{ref:c,children:[t.map((u,p)=>e.jsx(F8,{...i,...u,state:a},u.data.key)),e.jsx("g",{ref:d,children:e.jsx("text",{textAnchor:"middle",children:l})})]})}),H8=({hazard:t,nonDeclaredDisastersColor:s})=>e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 xl:grid-cols-9 gap-1 text-xs align-middle",children:[Object.keys(Ne).filter(n=>!t||t==="total"||n===t).map(n=>e.jsxs("div",{className:"h-full flex flex-wrap",children:[e.jsx("span",{className:"rounded-full m-1 shrink-0",style:{height:"10px",width:"10px",backgroundColor:C(Ne,[n,"color"],"#d0d0ce")}}),e.jsx("label",{className:"pl-2",children:Ne[n].name})]},n)),e.jsxs("div",{className:"h-full flex",children:[e.jsx("span",{className:"rounded-full m-1 shrink-0",style:{height:"10px",width:"10px",backgroundColor:s}}),e.jsx("label",{className:"pl-2",children:"Non-declared"})]},"nonDeclaredDisasters")]}),ze=({label:t,types:s,type:n,setType:r,multi:a=!1,size:l="small",disabled:i,disabledTitle:c,autoSelect:d=!0})=>(b.useEffect(()=>{var m,h;const u=((m=s[0])==null?void 0:m.value)||s[0];if(!u||!d||i)return;const p=a?[u]:u;(!n||Array.isArray(n)&&!((h=n.filter(f=>f))!=null&&h.length))&&r(p)},[s]),e.jsxs("div",{className:"my-1 flex flex-rows flex-wrap",title:i?c:null,children:[t&&e.jsx("div",{className:"p-2 pl-0 w-1/4",children:t}),e.jsx("span",{className:`
              
                space-x-1 rounded-lg bg-slate-100 py-0.5
                flex flex-row flex-wrap
                shadow-sm 
                ${l==="large"?"w-full":"w-fit"}`,children:s.map((u,p)=>{const m=(u==null?void 0:u.value)||u,h=a&&Array.isArray(n)?n:a&&!Array.isArray(n)?[n]:!a&&Array.isArray(n)?n[0]:n,f=a&&(h==null?void 0:h.includes(m))||!a&&h===m;return e.jsx("button",{type:"button",className:`
                            ${p!==0&&"-ml-px"} 
                            ${i&&"pointer-events-none"}
                            rounded-lg py-[0.4375rem] break-none
                            ${f?"text-gray-900 bg-white shadow":"text-gray-700"} hover:text-blue-500
                            min-w-[60px] min-h-[30px] uppercase
                            relative items-center px-2 text-xs items-center justify-center text-center 
                            focus:z-10`,onClick:()=>{const g=a&&(h!=null&&h.includes(m))?h.filter(x=>x!==m):a&&!(h!=null&&h.includes(m))?[...h,m]:m;r(g)},children:(u==null?void 0:u.label)||u},p)})})]})),ct=({baseUrl:t="/",attributionData:s})=>{var n;return e.jsxs("div",{className:"flex flex-row text-xs text-gray-700 p-1",children:[e.jsx("label",{children:"Attribution:"}),e.jsx("div",{className:"flex flex-col pl-1",children:(n=Array.isArray(s)?s:[s])==null?void 0:n.map(r=>{var a;return e.jsxs(je,{to:`/${t}/cenrep/source/${r==null?void 0:r.source_id}/versions/${r==null?void 0:r.view_id}`.replace("///","/"),children:[r==null?void 0:r.version," (",Wa(((a=r==null?void 0:r._modified_timestamp)==null?void 0:a.value)||(r==null?void 0:r._modified_timestamp)),")"]},`link-${r==null?void 0:r.view_id}`)})})]})},z8={swd_population_damage:"Population Damage",fusion_property_damage:"Property Damage",fusion_crop_damage:"Crop Damage",disaster_number:"Disaster Number",swd_ttd:"Non Declared Total",ofd_ttd:"Declared Total"},Fl="#be00ff",h0=({chartDataActiveView:t=[],disaster_numbers:s=[],attributionData:n,baseUrl:r,hazard:a,consequence:l="_td"})=>{if(!(t!=null&&t.length))return null;const[i,c]=w.useState("Max");Math.min(...t.map(_=>_.year));const d=Math.max(...t.map(_=>_.year)),u=s.map(_=>`${_}${l}`),p=t.map(_=>u.reduce((E,L)=>E+(+_[L]||0),0)),m=Math.max(...p),h=+Qe(m,m.toString().length).trim().split(" ")[0],g=5*Math.ceil(h/5),x=(_=100)=>(Math.floor(m/h)+_-(Math.floor(m/h)%_||_))/(Math.floor(h)===1?5:1),j=[.05,.5,.75].map(_=>g*_*x()),N=i==="Max"?m:c0(i);return e.jsxs("div",{className:"w-full pt-10 my-1 block flex flex-col",style:{height:"450px"},children:[e.jsx(H8,{hazard:a,nonDeclaredDisastersColor:Fl}),e.jsx(ze,{types:[...j.map(_=>Qe(_,0)),"Max"],type:i,setType:c,size:"large"}),e.jsx(ba,{data:t,keys:u,indexBy:"year",xScale:{domain:Sa(1996,d).map(_=>_.toString())},axisBottom:{tickDensity:3,axisColor:"#000",axisOpacity:0},yScale:{domain:[0,N]},axisLeft:{format:_=>Qe(_,0),gridLineOpacity:0,showGridLines:!0,ticks:5,axisColor:"#000",axisOpacity:0},paddingInner:.1,colors:(_,E,L,S)=>(S==null?void 0:S.split("_")[0])==="Non-declared Disasters"?Fl:C(Ne,[L[`${S==null?void 0:S.split("_")[0]}_nri_category`],"color"],Fl),hoverComp:{HoverComp:Cr,valueFormat:Qe,keyFormat:_=>z8[_]||_.replace("_td","").replace("_cd","").replace("_pd","")},groupMode:"stacked"},"numEvents"),e.jsx(ct,{baseUrl:r,attributionData:n})]})},U8=(t=[],s)=>{const n=[...new Set(t.map(d=>d.year))],r=new Set(["Non-declared Disasters"]),a=new Set,l={swd_tpd:0,swd_tcd:0,swd_ttd:0},i={ofd_tpd:0,ofd_tcd:0,ofd_ttd:0};return{processed_data:n.map(d=>{const u={swd_pd:0,swd_cd:0,swd_td:0},p={ofd_pd:0,ofd_cd:0,ofd_td:0},m=t.filter(h=>h.year===d).reduce((h,f)=>{var _;const g=f.nri_category,x=f.disaster_number==="SWD"?"Non-declared Disasters":C(s,[f.disaster_number],"No Title")+` (${f.disaster_number} - ${((_=Ne[g])==null?void 0:_.name)||g})`,y=+f.fusion_property_damage||0,j=+f.fusion_crop_damage||0,N=y+j+(+f.swd_population_damage||0);return x.includes("Non-declared Disasters")?(a.add(x.split("_")[1]),u.swd_pd+=y,u.swd_cd+=j,u.swd_td+=N,l.swd_tpd+=y,l.swd_tcd+=j,l.swd_ttd+=N):(r.add(x),p.ofd_pd+=y,p.ofd_cd+=j,p.ofd_td+=N,i.ofd_tpd+=y,i.ofd_tcd+=j,i.ofd_ttd+=N),{...h,[`${x}_pd`]:(h[[`${x}_pd`]]||0)+y,[`${x}_cd`]:(h[`${x}_cd`]||0)+j,[`${x}_td`]:(h[`${x}_td`]||0)+N,[`${x}_nri_category`]:g}},{});return{year:d,...m,...u,...p}}),total:[{...l,...i,year:"Loss Distribution"}],disaster_numbers:[...r],event_ids:[...a]}},W8={source_id:"source_id",name:"name",display_name:"display_name",type:"type",update_interval:"update_interval",category:"category",categories:"categories",description:"description",statistics:"statistics",metadata:"metadata"},G8={view_id:"view_id",source_id:"source_id",data_type:"data_type",interval_version:"interval_version",geography_version:"geography_version",version:"version",source_url:"source_url",publisher:"publisher",table_schema:"table_schema",table_name:"table_name",data_table:"data_table",download_url:"download_url",tiles_url:"tiles_url",start_date:"start_date",end_date:"end_date",last_updated:"last_updated",statistics:"statistics",metadata:"metadata",user_id:"user_id",etl_context_id:"etl_context_id",view_dependencies:"view_dependencies",active_start_timestamp:"active_start_timestamp",active_end_timestamp:"active_end_timestamp",_created_timestamp:"_created_timestamp",_modified_timestamp:"_modified_timestamp"},J8=t=>Object.entries(t).reduce((s,n)=>{const[r,a]=n;return typeof a.value<"u"?s[r]=a.value:s[r]=a,s},{}),f0=({showSelector:t,setShowSelector:s,hide:n=!1})=>!n&&e.jsx("div",{className:"w-full flex justify-end",children:e.jsx("button",{className:"text-blue-500 hover:text-blue-800 text-xs float-right",onClick:()=>s(!t),children:t?"hide version selector":"change dataset version"})}),q8=(t,s,n)=>{s&&n([])},K8=(t,s,n,r,a,l)=>{const i=C(t,[0,"view_id"]);i?(s(t),l&&l(i)):s([])},Y8=(t,s,n,...r)=>e.jsx(cn,{className:"bg-slate-100  overflow-hidden z-10",...s,children:t.map((a,l)=>e.jsx(dn,{className:"block hover:bg-slate-200 text-xl tracking-wide pl-1",option:a,position:l,children:a.version}))}),Ct=({className:t,source_id:s,view_id:n,label:r="Data Source",controlDisplay:a=!1,showSelectorControl:l=!1,onChange:i})=>{const c=$e(),{falcor:d,falcorCache:u}=et(),[p,m]=b.useState([]),[h,f]=b.useState(!1);b.useEffect(()=>{async function x(){const y=["dama",oe,"sources","byId",s,"views","length"],j=await d.get(y);return await d.get(["dama",oe,"sources","byId",s,"views","byIndex",{from:0,to:C(j.json,y,0)-1},"attributes",Object.values(G8)],["dama",oe,"sources","byId",s,"attributes",Object.values(W8)],["dama",oe,"sources","byId",s,"meta"])}x()},[s,d,oe]);const g=b.useMemo(()=>Object.values(C(u,["dama",oe,"sources","byId",s,"views","byIndex"],{})).map(x=>J8(C(u,x.value,{attributes:{}}).attributes)).sort((x,y)=>+(y==null?void 0:y.view_id)-+(x==null?void 0:x.view_id)),[u,s,oe]);return b.useEffect(()=>{m(g.filter(x=>n&&x.view_id===n))},[g,n]),b.useEffect(()=>{var x;!n&&g&&i&&i((x=g[0])==null?void 0:x.view_id)},[g]),e.jsxs(e.Fragment,{children:[e.jsx(f0,{showSelector:h,setShowSelector:f,hide:a}),e.jsxs("div",{className:`flex flex-row flex-wrap justify-between ${h||l?"":"hidden"}`,children:[e.jsxs("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:[r," Version:"]}),e.jsxs("div",{className:`flex flex row ${t} w-3/4 shrink my-1`,children:[e.jsx("i",{className:"fa fa-search font-light text-xl bg-white pr-2 pt-1 rounded-r-md"}),e.jsx(Yo,{className:"w-full",isLoading:!1,onSearch:q8,minLength:0,id:"geography-search",placeholder:"Search for a Data Source...",options:g,labelKey:x=>`${x==null?void 0:x.version}`,defaultSelected:p,onChange:x=>K8(x,m,n,g,c,i),selected:p,inputProps:{className:"bg-white w-full p-1 pl-3 rounded-l-md"},renderMenu:Y8},"geography-search")]})]})]})},Z8=(t,s,n)=>{s&&n([])},X8=(t,s,n,r,a,l)=>{const i=C(t,[0,"geoid"]);if(i||i===""){const c={0:"",2:"/state",5:"/county"};s(t),l?l(i):a(`${c[i==null?void 0:i.length]}/${i}`)}else s([])},Q8=(t,s,n,...r)=>e.jsx(cn,{className:"bg-slate-100  overflow-hidden z-10",...s,children:t.map((a,l)=>e.jsx(dn,{className:"block hover:bg-slate-200 text-xl tracking-wide pl-1",option:a,position:l,children:a.name}))}),e9=async({falcor:t,pgEnv:s})=>{const r=["geoid","stusps","name"],a=JSON.stringify({}),l=["dama",s,"viewsbyId",285,"options",a],i=await t.get([...l,"length"]),c=C(i,["json",...l,"length"]);if(c>0){const d={from:0,to:c-1},u=await t.get([...l,"databyIndex",d,r]);return Object.values(C(u,["json",...l,"databyIndex"],{})).filter(p=>p.geoid)}},t9=async({falcor:t,pgEnv:s,statesData:n,setGeoData:r})=>{const l={geoid:"geoid",name:"namelsad as name"},i=Object.values(l),c=JSON.stringify({}),d=["dama",s,"viewsbyId",286,"options",c],u=await t.get([...d,"length"]),p=C(u,["json",...d,"length"]);if(p>0){const m={from:0,to:p-1},h=await t.get([...d,"databyIndex",m,i]),f=Object.values(C(h,["json",...d,"databyIndex"],{})).filter(g=>g.geoid).map(g=>{const x=C(n.find(y=>y.geoid===g.geoid.substring(0,2)),"stusps","");return{geoid:g.geoid,name:`${g[l.name]}, ${x}`}});f.push(...n.map(g=>({geoid:g.geoid,name:`State of ${g.name}`}))),f.push({geoid:"",name:"United States"}),r(f)}},rt=({showLabel:t=!0,className:s,value:n,onChange:r})=>{const a=$e(),{falcor:l,falcorCache:i}=et(),[c,d]=b.useState([]),[u,p]=b.useState([]);b.useEffect(()=>{async function h(){const f=await e9({falcor:l,pgEnv:oe});await t9({falcor:l,pgEnv:oe,statesData:f,setGeoData:d})}h()},[oe,l]),b.useEffect(()=>{p(c.filter(h=>(n||n==="")&&h.geoid===n))},[c,n]);const m=()=>e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-search font-light text-xl bg-white pr-2 pt-1 rounded-r-md"}),e.jsx(Yo,{className:"w-full",isLoading:!1,onSearch:Z8,minLength:2,id:"geography-search",placeholder:"Search for a Geography...",options:c,labelKey:h=>`${h.name}`,defaultSelected:u,onChange:h=>X8(h,p,n,c,a,r),selected:u,inputProps:{className:"bg-white  w-full p-1 pl-3 rounded-l-md"},renderMenu:Q8},"geography-search")]});return t?e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Geography:"}),e.jsx("div",{className:`flex flex row ${s} w-3/4 shrink my-1`,children:e.jsx(m,{})})]}):e.jsx("div",{className:`flex w-full ${s}`,children:e.jsx(m,{})})},dt=()=>e.jsx("div",{className:"text-center p-5",children:e.jsxs("div",{role:"status",children:[e.jsxs("svg",{"aria-hidden":"true",className:"inline w-10 h-10 mr-2 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),e.jsx("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})]}),e.jsx("span",{className:"sr-only",children:"Loading..."})]})}),Gs=({hazard:t,setHazard:s,showTotal:n=!1})=>e.jsxs("div",{className:"flex flex-row flwx-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Hazard Type:"}),e.jsxs("select",{className:"w-3/4 shrink my-1 p-1 bg-white rounded-md",onChange:r=>{s(r.target.value)},value:t,children:[n?e.jsx("option",{value:"total",children:"Total"}):e.jsx("option",{value:null,children:"Select A Hazard Type"}),Object.keys(Ne).sort((r,a)=>Ne[r].name.localeCompare(Ne[a].name)).map((r,a)=>e.jsx("option",{value:r,children:Ne[r].name},r))]})]});async function g0({ealSourceId:t,ealViewId:s,fusionSourceId:n=336,fusionViewId:r,consequence:a,hazard:l,geoid:i},c){var j;const d=["dama",oe,"viewDependencySubgraphs","byViewId",s],u=["distinct disaster_number as disaster_number","declaration_title"],p=N=>["dama",oe,"viewsbyId",N,"options"],m=await c.get(d),h=C(m,["json",...d,"dependencies"],[]),f=h.find(N=>N.type==="fusion");if(!f)return{};const g=l!=="total"?["fusion",oe,"source",n,"view",f.view_id,"byGeoid",i,"hazards",JSON.stringify([l]),"lossByYearByDisasterNumber"]:["fusion",oe,"source",n,"view",f.view_id,"byGeoid",i,"lossByYearByDisasterNumber"],x=await c.get(g,["dama",oe,"views","byId",f.view_id,"attributes",["source_id","view_id","version"]]);console.log("lossRes",C(x,["json",...g],[]),x);const y=(j=C(x,["json",...g],[]).map(N=>N.disaster_number))==null?void 0:j.filter(N=>N!=="SWD").sort((N,_)=>+N-+_);if(y!=null&&y.length){const N=h.find(I=>I.type==="disaster_declarations_summaries_v2");await c.get([...p(N.view_id),JSON.stringify({filter:{disaster_number:y.sort((I,T)=>+I-+T)}}),"databyIndex",{from:0,to:y.length-1},u]);const _=c.getCache(),E=Object.values(C(_,[...p(N==null?void 0:N.view_id)],{})).reduce((I,T)=>[...I,...Object.values((T==null?void 0:T.databyIndex)||{})],[]).reduce((I,T)=>(I[T["distinct disaster_number as disaster_number"]]=T.declaration_title,I),{}),L=C(_,[...g,"value"],[]),{processed_data:S,disaster_numbers:k}=U8(L,E),$=C(_,["dama",oe,"views","byId",r,"attributes"],{});return{chartDataActiveView:S,disaster_numbers:k,attributionData:$,ealSourceId:t,ealViewId:s,fusionViewId:r,geoid:i,hazard:l,consequence:a}}}const x0=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",i=(a==null?void 0:a.ealSourceId)||343,[c,d]=b.useState((a==null?void 0:a.ealViewId)||837),u=336,[p,m]=b.useState((a==null?void 0:a.fusionViewId)||834),[h,f]=b.useState(!1),[g,x]=b.useState(a==null?void 0:a.status),[y,j]=b.useState((a==null?void 0:a.geoid)||"36"),[N,_]=b.useState((a==null?void 0:a.hazard)||"total"),[E,L]=b.useState((a==null?void 0:a.consequence)||"_td");return b.useEffect(()=>{async function S(){x(y?void 0:"Please Select a Geography"),f(!0),x(void 0);const k=await g0({ealSourceId:i,ealViewId:c,fusionSourceId:u,fusionViewId:p,consequence:E,hazard:N,geoid:y},n);s(JSON.stringify({...k})),f(!1)}S()},[y,c,p,y,N,E]),a.attributionData,e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:i,view_id:c,onChange:d,className:"flex-row-reverse"}),e.jsx(rt,{value:y,onChange:j,className:"flex-row-reverse"}),e.jsx(Gs,{hazard:N,setHazard:_,showTotal:!0}),e.jsx(ze,{label:"Loss Type:",types:[{value:"_pd",label:"Property"},{value:"_cd",label:"Crop"},{value:"_td",label:"Total"}],type:E,setType:L})]}),h?e.jsx(dt,{}):g?e.jsx("div",{className:"p-5 text-center",children:g}):e.jsx(e.Fragment,{children:e.jsx(h0,{chartDataActiveView:a.chartDataActiveView,disaster_numbers:a.disaster_numbers,attributionData:a.attributionData,hazard:N,consequence:E,baseUrl:l})})]})})};x0.settings={hasControls:!0,name:"ElementEdit"};const s9=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(h0,{...JSON.parse(t),baseUrl:"/"})})},n9={name:"Graph: Historic Loss by Disaster Number",type:"Bar Chart",variables:[{name:"ealSourceId",default:343,hidden:!0},{name:"ealViewId",default:837,hidden:!0},{name:"fusionSourceId",default:336,hidden:!0},{name:"fusionViewId",default:834,hidden:!0},{name:"geoid",default:"36"},{name:"hazard",default:"total",hidden:!0},{name:"consequence",default:"_td",hidden:!0}],getData:g0,EditComp:x0,ViewComp:s9},Ju={swd_population_damage:"Population Damage",fusion_property_damage:"Property Damage",fusion_crop_damage:"Crop Damage",disaster_number:"Disaster Number",swd_ttd:"Non Declared Events Total ($)",ofd_ttd:"FEMA Declared Disaster Total ($)"},b0=({data:t,attributionData:s,baseUrl:n})=>{const r={ofd_ttd:"#0089ff",swd_ttd:"#ff003b"};return e.jsxs("div",{className:"w-full my-1 block flex flex-col",style:{height:"300px"},children:[e.jsx("div",{className:"flex flex-row pr-5 pt-5",children:Object.keys(r).map(a=>e.jsxs("div",{className:"flex px-2",children:[e.jsx("div",{className:"rounded-full self-center align-middle",style:{height:"15px",width:"15px",backgroundColor:r[a]}}),e.jsx("span",{className:"pl-2",children:Ju[a]})]},a))}),e.jsx(R8,{data:t,keys:Object.keys(r),colors:Object.values(r),indexBy:"year",axisBottom:a=>a,axisLeft:{format:Qe,gridLineOpacity:1,gridLineColor:"#9d9c9c"},paddingInner:.1,hoverComp:{HoverComp:Cr,valueFormat:Qe,keyFormat:a=>Ju[a]||a},groupMode:"stacked"},"numEvents"),e.jsx(ct,{baseUrl:n,attributionData:s})]})},a9=(t=[],s)=>{const n=[...new Set(t.map(l=>l.year))],r={swd_tpd:0,swd_tcd:0,swd_ttd:0},a={ofd_tpd:0,ofd_tcd:0,ofd_ttd:0};return n.map(l=>{t.filter(i=>i.year===l).reduce((i,c)=>{const d=c.nri_category,u=c.disaster_number==="SWD"?"Non-declared Disasters":C(s,[c.disaster_number],"No Title")+` (${c.disaster_number} - ${d})`,p=+c.fusion_property_damage||0,m=+c.fusion_crop_damage||0,h=p+m+(+c.swd_population_damage||0);u.includes("Non-declared Disasters")?(r.swd_tpd+=p,r.swd_tcd+=m,r.swd_ttd+=h):(a.ofd_tpd+=p,a.ofd_tcd+=m,a.ofd_ttd+=h)},{})}),{total:[{...r,...a,year:"Loss Distribution"}]}};async function y0({ealViewId:t,hazard:s,fusionSourceId:n,geoid:r},a){const l=["dama",oe,"viewDependencySubgraphs","byViewId",t],i=await a.get(l),d=C(i,["json",...l,"dependencies"]).find(g=>g.type==="fusion");if(!d)return{};const u=s!=="total"?["fusion",oe,"source",n,"view",d.view_id,"byGeoid",r,"hazards",JSON.stringify([s]),"lossByYearByDisasterNumber"]:["fusion",oe,"source",n,"view",d.view_id,"byGeoid",r,"lossByYearByDisasterNumber"];await a.get(u,["dama",oe,"views","byId",d.view_id,"attributes",["source_id","view_id","version","_modified_timestamp"]]);const p=a.getCache(),m=C(p,[...u,"value"],[]),{total:h}=a9(m),f=C(p,["dama",oe,"views","byId",d.view_id,"attributes"],{});return{total:h,attributionData:f,hazard:s,geoid:r,ealViewId:t,fusionSourceId:n}}const v0=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",i=343,[c,d]=b.useState((a==null?void 0:a.ealViewId)||837),u=336,[p,m]=b.useState(!1),[h,f]=b.useState(a==null?void 0:a.status),[g,x]=b.useState((a==null?void 0:a.geoid)||"36"),[y,j]=b.useState((a==null?void 0:a.hazard)||"total");return b.useEffect(()=>{async function N(){f(g?void 0:"Please Select a Geography"),m(!0),f(void 0);const _=await y0({ealViewId:c,hazard:y,fusionSourceId:u,geoid:g},n);s(JSON.stringify({..._})),m(!1)}N()},[g,c,g,y]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:i,view_id:c,onChange:d,className:"flex-row-reverse"}),e.jsx(rt,{value:g,onChange:x,className:"flex-row-reverse"}),e.jsx(Gs,{hazard:y,setHazard:j,showTotal:!0})]}),p?e.jsx(dt,{}):h?e.jsx("div",{className:"p-5 text-center",children:h}):e.jsx(e.Fragment,{children:e.jsx(b0,{data:a.total,attributionData:a.attributionData,baseUrl:l})})]})})};v0.settings={hasControls:!0,name:"ElementEdit"};const r9=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(b0,{data:s==null?void 0:s.total,attributionData:s==null?void 0:s.attributionData,baseUrl:"/"})})},o9={name:"Graph: Declared vs Non-Declared Loss",type:"Pie Chart",variables:[{name:"ealViewId",default:837,hidden:!0},{name:"fusionSourceId",default:336,hidden:!0},{name:"geoid",default:"36"},{name:"hazard",default:"total",hidden:!0}],getData:y0,EditComp:v0,ViewComp:r9},l9=({hazard:t,nonDeclaredDisastersColor:s,renderNonDeclared:n=!1})=>e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 xl:grid-cols-9 gap-1 text-xs align-middle",children:[Object.keys(Ne).filter(r=>!t||t==="total"||r===t).map(r=>e.jsxs("div",{className:"h-full flex flex-wrap",children:[e.jsx("span",{className:"rounded-full m-1 shrink-0",style:{height:"10px",width:"10px",backgroundColor:C(Ne,[r,"color"],"#d0d0ce")}}),e.jsx("label",{className:"pl-2",children:Ne[r].name})]},r)),n&&e.jsxs("div",{className:"h-full flex",children:[e.jsx("span",{className:"rounded-full m-1 shrink-0",style:{height:"10px",width:"10px",backgroundColor:s}}),e.jsx("label",{className:"pl-2",children:"Non-declared"})]},"nonDeclaredDisasters")]}),i9={swd_population_damage:"Population Damage",fusion_property_damage:"Property Damage",fusion_crop_damage:"Crop Damage",disaster_number:"Disaster Number",swd_ttd:"Non Declared Total",ofd_ttd:"Declared Total"},qu="#be00ff",j0=({chartDataActiveView:t=[],base:s="year",attributionData:n,baseUrl:r,hazard:a,consequence:l="_td"})=>{if(!(t!=null&&t.length))return null;const[i,c]=w.useState("Max"),d=1996,u=Math.max(...t.map(S=>S.year)),m=s==="year"?Sa(d,u).map(S=>S.toString()):["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],h=Object.keys(Ne).filter(S=>!a||a==="total"||S===a).map(S=>`${S}${l}`),f=t.map(S=>h.reduce((k,$)=>k+(+S[$]||0),0)),g=Math.max(...f),x=+Qe(g,g.toString().length).trim().split(" ")[0],j=5*Math.ceil(x/5),N=(S=100)=>(Math.floor(g/x)+S-(Math.floor(g/x)%S||S))/(Math.floor(x)===1?5:1),E=[.05,.5,.75].map(S=>j*S*N()),L=i==="Max"?g:c0(i);return e.jsxs("div",{className:"w-full pt-10 my-1 block flex flex-col",style:{height:"450px"},children:[e.jsx(l9,{hazard:a,nonDeclaredDisastersColor:qu}),e.jsx(ze,{types:[...E.map(S=>Qe(S,0)),"Max"],type:i,setType:c}),e.jsx(ba,{data:t,keys:h,indexBy:s,xScale:{domain:m},axisBottom:{tickDensity:3,axisColor:"#000",axisOpacity:0},yScale:{domain:[0,L]},axisLeft:{format:S=>Qe(S,0),gridLineOpacity:0,showGridLines:!0,ticks:5,axisColor:"#000",axisOpacity:0},paddingInner:.1,colors:(S,k,$,I)=>C(Ne,[$[`${I==null?void 0:I.split("_")[0]}_nri_category`],"color"],qu),hoverComp:{HoverComp:Cr,valueFormat:Qe,keyFormat:S=>{var $,I,T;const k=(I=($=S.replace("_td",""))==null?void 0:$.replace("_cd",""))==null?void 0:I.replace("_pd","");return i9[S]||((T=Ne[k])==null?void 0:T.name)||k}},groupMode:"stacked"},"numEvents"),e.jsx(ct,{baseUrl:r,attributionData:n})]})},c9=(t=[],s)=>{const n=[...new Set(t.map(l=>l[s]))],r=new Set([]);return{processed_data:n.map(l=>{const i=t.filter(c=>c[s]===l).reduce((c,d)=>{const u=d.nri_category,p=d.nri_category,m=+d.fusion_property_damage||0,h=+d.fusion_crop_damage||0,f=m+h+(+d.swd_population_damage||0);return{...c,[`${p}_pd`]:(c[[`${p}_pd`]]||0)+m,[`${p}_cd`]:(c[`${p}_cd`]||0)+h,[`${p}_td`]:(c[`${p}_td`]||0)+f,[`${p}_nri_category`]:u}},{});return{[s]:l,...i}}),nri_categories:[...r]}};async function w0({ealSourceId:t,ealViewId:s,fusionSourceId:n,status:r,geoid:a,hazard:l,consequence:i,base:c},d){var N;const u=["dama",oe,"viewDependencySubgraphs","byViewId",s],p=await d.get(u),h=(N=C(p,["json",...u,"dependencies"]).find(_=>_.type==="fusion"))==null?void 0:N.view_id;if(!h)return{};const f=["fusion",oe,"source",n,"view",h,"byGeoid",a,c==="year"?"lossByYearByHazardType":"lossByMonthByHazardType"];await d.get(f,["dama",oe,"views","byId",h,"attributes",["source_id","view_id","version","_modified_timestamp"]]);const g=d.getCache(),x=C(g,[...f,"value"],[]),{processed_data:y}=c9(x,c),j=C(g,["dama",oe,"views","byId",h,"attributes"],{});return{chartDataActiveView:y,attributionData:j,ealSourceId:t,ealViewId:s,fusionSourceId:n,status:r,geoid:a,hazard:l,dataPath:f,consequence:i,base:c}}const N0=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",i=a.ealSourceId||343,[c,d]=b.useState((a==null?void 0:a.ealViewId)||837),u=(a==null?void 0:a.fusionSourceId)||336,[p,m]=b.useState(!1),[h,f]=b.useState(a==null?void 0:a.status),[g,x]=b.useState((a==null?void 0:a.geoid)||"36"),[y,j]=b.useState((a==null?void 0:a.hazard)||"total"),[N,_]=b.useState((a==null?void 0:a.consequence)||"_td"),[E,L]=b.useState((a==null?void 0:a.base)||"year");return b.useEffect(()=>{async function S(){f(g?void 0:"Please Select a Geography"),m(!0),f(void 0);const k=await w0({ealSourceId:i,ealViewId:c,fusionSourceId:u,geoid:g,hazard:y,consequence:N,base:E},n);s(JSON.stringify({...k})),m(!1)}S()},[g,c,u,y,N,E]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:i,view_id:c,onChange:d,className:"flex-row-reverse"}),e.jsx(rt,{value:g,onChange:x,className:"flex-row-reverse"}),e.jsx(Gs,{hazard:y,setHazard:j,showTotal:!0}),e.jsx(ze,{label:"Base:",types:[{value:"year",label:"Year"},{value:"month",label:"Month"}],type:E,setType:S=>{L(S)}}),e.jsx(ze,{label:"Loss Type:",types:[{value:"_pd",label:"Property"},{value:"_cd",label:"Crop"},{value:"_td",label:"Total"}],type:N,setType:_})]}),p?e.jsx(dt,{}):h?e.jsx("div",{className:"p-5 text-center",children:h}):e.jsx(e.Fragment,{children:e.jsx(j0,{base:E,chartDataActiveView:a.chartDataActiveView,attributionData:a.attributionData,hazard:y,consequence:N,baseUrl:l})})]})})};N0.settings={hasControls:!0,name:"ElementEdit"};const d9=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(j0,{...JSON.parse(t),baseUrl:"/"})})},u9={name:"Graph: Historic Loss by Hazard Type",type:"Bar Chart",variables:[{name:"ealSourceId",default:343,hidden:!0},{name:"ealViewId",default:837,hidden:!0},{name:"fusionSourceId",default:336,hidden:!0},{name:"fusionViewId",default:834,hidden:!0},{name:"geoid",default:"36"},{name:"hazard",default:"total",hidden:!0},{name:"consequence",default:"_td",hidden:!0},{name:"base",default:"year",hidden:!0}],getData:w0,EditComp:N0,ViewComp:d9},C0=({total:t,numDeclaredEvents:s,numNonDeclaredEvents:n,attributionData:r,baseUrl:a})=>{const l="w-full bg-slate-100 p-5 text-center flex flex-col",i="border-b-2",c="font-medium text-xl pt-2";return e.jsxs(w.Fragment,{children:[e.jsxs("div",{className:"w-full my-1 grid grid-cols-1 md:grid-cols-2 gap-10 place-content-stretch content-center ",children:[e.jsxs("div",{className:l,children:[e.jsx("label",{className:`${i} border-blue-300`,children:"# FEMA Declared Disasters"}),e.jsx("span",{className:c,children:C(t,[0,"ofd_ttd"],0)===0?0:us(s)})]}),e.jsxs("div",{className:l,children:[e.jsx("label",{className:`${i} border-blue-300`,children:"FEMA Declared Loss"}),e.jsx("span",{className:c,children:us(C(t,[0,"ofd_ttd"],0),!0)})]}),e.jsxs("div",{className:l,children:[e.jsx("label",{className:`${i} border-red-300`,children:"# Non Declared Events"}),e.jsx("span",{className:c,children:us(n)})]}),e.jsxs("div",{className:l,children:[e.jsx("label",{className:`${i} border-red-300`,children:"Non Declared Loss"}),e.jsx("span",{className:c,children:us(C(t,[0,"swd_ttd"],0),!0)})]})]}),e.jsx(ct,{baseUrl:a,attributionData:r})]})},m9=(t=[],s)=>{const n=[...new Set(t.map(l=>l.year))],r={swd_tpd:0,swd_tcd:0,swd_ttd:0},a={ofd_tpd:0,ofd_tcd:0,ofd_ttd:0};return n.map(l=>{t.filter(i=>i.year===l).reduce((i,c)=>{const d=c.nri_category,u=c.disaster_number==="SWD"?"Non-declared Disasters":C(s,[c.disaster_number],"No Title")+` (${c.disaster_number} - ${d})`,p=+c.fusion_property_damage||0,m=+c.fusion_crop_damage||0,h=p+m+(+c.swd_population_damage||0);u.includes("Non-declared Disasters")?(r.swd_tpd+=p,r.swd_tcd+=m,r.swd_ttd+=h):(a.ofd_tpd+=p,a.ofd_tcd+=m,a.ofd_ttd+=h)},{})}),{total:[{...r,...a,year:"Loss Distribution"}]}};async function _0({ealViewId:t,hazard:s,fusionSourceId:n,geoid:r},a){const l=["dama",oe,"viewDependencySubgraphs","byViewId",t],i=await a.get(l),d=C(i,["json",...l,"dependencies"]).find(y=>y.type==="fusion");if(!d)return{};const u=s!=="total"?["fusion",oe,"source",n,"view",d.view_id,"byGeoid",r,"hazards",JSON.stringify([s]),"lossByYearByDisasterNumber"]:["fusion",oe,"source",n,"view",d.view_id,"byGeoid",r,"lossByYearByDisasterNumber"];await a.get(u,["dama",oe,"views","byId",d.view_id,"attributes",["source_id","view_id","version","_modified_timestamp"]]);const p=a.getCache(),m=C(p,[...u,"value"],[]),{total:h}=m9(m),f=m.reduce((y,j)=>y+ +(j.disaster_number!=="SWD"?j.num_declared:0),0),g=m.reduce((y,j)=>y+ +(j.disaster_number==="SWD"?j.num_non_declared:0),0),x=C(p,["dama",oe,"views","byId",d.view_id,"attributes"],{});return{numDeclaredEvents:f,numNonDeclaredEvents:g,total:h,attributionData:x,hazard:s,geoid:r,ealViewId:t,fusionSourceId:n}}const S0=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",i=343,[c,d]=b.useState((a==null?void 0:a.ealViewId)||837),u=336,[p,m]=b.useState(!1),[h,f]=b.useState(a==null?void 0:a.status),[g,x]=b.useState((a==null?void 0:a.geoid)||"36"),[y,j]=b.useState((a==null?void 0:a.hazard)||"total");return b.useEffect(()=>{async function N(){f(g?void 0:"Please Select a Geography"),m(!0),f(void 0);const _=await _0({ealViewId:c,hazard:y,fusionSourceId:u,geoid:g},n);s(JSON.stringify({..._})),m(!1)}N()},[g,c,y]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:i,view_id:c,onChange:d,className:"flex-row-reverse"}),e.jsx(rt,{value:g,onChange:x,className:"flex-row-reverse"}),e.jsx(Gs,{hazard:y,setHazard:j,showTotal:!0})]}),p?e.jsx(dt,{}):h?e.jsx("div",{className:"p-5 text-center",children:h}):e.jsx(e.Fragment,{children:e.jsx(C0,{numNonDeclaredEvents:a.numNonDeclaredEvents,numDeclaredEvents:a.numDeclaredEvents,total:a.total,attributionData:a.attributionData,baseUrl:l})})]})})};S0.settings={hasControls:!0,name:"ElementEdit"};const p9=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(C0,{...s,baseUrl:"/"})})},h9={name:"Card: Declared vs Non-Declared Loss",type:"Pie Chart",variables:[{name:"ealViewId",default:837,hidden:!0},{name:"fusionSourceId",default:336,hidden:!0},{name:"geoid",default:"36"},{name:"hazard",default:"total",hidden:!0}],getData:_0,EditComp:S0,ViewComp:p9},Pi=t=>typeof(t==null?void 0:t.value)=="object"?Pi(t.value):(t==null?void 0:t.value)||t,$0=({data:t=[],columns:s=[],pageSize:n,sortBy:r={},filterValue:a={},fusionAttributes:l={},baseUrl:i,attributionData:c,geoid:d,striped:u})=>{var f,g;const p=s.map(x=>{x.rawHeader;const y=x.Header;return{...x,Cell:j=>{let N=Pi(j.value);return N=x.type==="text"?N:us(N||0,!0),y==="Disaster Number"?e.jsx(je,{to:`/disaster/${j.row.original.disaster_number}/geography/${d}`,children:N}):e.jsx("div",{children:N})}}}),m=(f=p.find(x=>{var y;return x.Header===((y=Object.keys(r))==null?void 0:y[0])}))==null?void 0:f.accessor,h=t.filter(x=>!Object.keys(a||{}).length||Object.keys(a).reduce((y,j)=>{var _,E;const N=Pi(x[(_=l[j])==null?void 0:_.raw]);return y&&(N==null?void 0:N.toString().toLowerCase().includes((E=a[j])==null?void 0:E.toLowerCase()))},!0));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-5",children:(t==null?void 0:t.length)>0&&(s==null?void 0:s.length)>0&&e.jsx(St,{columns:p,data:h,initialPageSize:n,pageSize:n,striped:u,sortBy:m,sortOrder:((g=Object.values(r))==null?void 0:g[0])||"asc"})}),e.jsx(ct,{baseUrl:i,attributionData:c})]})},f9=(t,s,n)=>{s&&n([])},E0=(t,s,n,r)=>{let a=t.map(c=>c.key),l=a.includes("all"),i=a.includes(null);s(l?r.filter(c=>c.key&&c.key!=="all"):i?[]:t),n&&n(l?r.filter(c=>c.key&&c.key!=="all"):i?[]:t)},g9=({props:t,selected:s,setSelected:n,onChange:r})=>e.jsxs("div",{className:"w-fit inline-block ml-2",children:[t.label,e.jsx("button",{className:"hover:text-red-300 animate ml-1 p-1 rounded-md rbt-token-remove-button",onClick:a=>{const l=s.filter(i=>i.key!==t.key);E0(l,n,r)},children:e.jsx("i",{className:"fa fa-close"})})]},t.label),x9=(t,s,n,...r)=>e.jsx(cn,{className:"bg-slate-100  overflow-hidden z-10",...s,children:t.map((a,l)=>e.jsx(dn,{className:"block hover:bg-slate-200 text-xl tracking-wide pl-1",option:a,position:l,children:a.label}))}),k0=({className:t,label:s="Select",noLabel:n=!1,value:r,onChange:a,showAll:l=!1,options:i=[]})=>{const[c,d]=b.useState([]),u=[...l?[{key:"all",label:"Select All"},{key:null,label:"Clear All"}]:[],...i];return b.useEffect(()=>{if(!r)return;const p=i.filter(m=>Array.isArray(r)&&r.includes(m.key))||[];d(p)},[r]),e.jsxs("div",{className:"flex justify-between",children:[!n&&e.jsxs("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:[s,":"]}),e.jsxs("div",{className:`flex flex row ${t} w-full shrink my-1 bg-white p-1 pl-3 rounded-l-md`,children:[e.jsx("i",{className:"fa fa-search font-light text-xl bg-white rounded-r-md"}),e.jsx(Ko,{className:"w-full",multiple:!0,onSearch:f9,minLength:0,id:"multi-search",placeholder:"Search...",options:u,labelKey:p=>`${p==null?void 0:p.label}`,defaultSelected:c,onChange:p=>E0(p,d,a,u),selected:c,inputProps:{className:"flex flex-row flex-wrap"},renderMenu:x9,renderToken:p=>e.jsx(g9,{props:p,selected:c,setSelected:d,onChange:a},p.label)},"multi-search")]})]})},Di=({title:t,className:s,color:n,setColor:r})=>e.jsxs("div",{className:s,children:[e.jsx("label",{className:"shrink-0 pr-2 w-1/4",children:t}),e.jsx("input",{id:"background",list:"colors",className:"rounded-md shrink",type:"color",value:n,onChange:a=>r(a.target.value)}),e.jsx("datalist",{id:"colors",children:["#1e3a8a","#1e40af","#1d4ed8","#2563eb","#3b82f6","#60a5fa","#93c5fd","#bfdbfe","#dbeafe","#eff6ff","#713f12","#854d0e","#a16207","#ca8a04","#eab308","#facc15","#fde047","#fef08a","#fef9c3","#fefce8"].map(a=>e.jsx("option",{children:a},a))})]});function Ft(...t){return t.filter(Boolean).join(" ")}const b9=({pageSize:t,setPageSize:s})=>{const[n,r]=b.useState(t);return s?e.jsxs("div",{className:"w-full pt-2 mt-1 flex flex-row text-sm",children:[e.jsx("label",{className:"shrink-0 pr-2 py-2 my-1 w-1/4",children:"Table Page Size"}),e.jsx("input",{className:"p-2 ml-0 my-1 bg-white rounded-md w-full shrink",type:"number",placeholder:"Table Page Size",value:n,onChange:a=>{r(a.target.value),a.target.value>0&&s(+a.target.value)},onWheel:a=>a.target.blur()},"pageSizeInput")]}):null},y9=({dataSize:t,setDataSize:s})=>{const[n,r]=b.useState(t);return s?e.jsxs("div",{className:"w-full pl-1 pt-2 mt-1 flex flex-row text-sm",children:[e.jsx("label",{className:"shrink-0 pr-2 py-2 my-1 w-1/4",children:"Table Data Size"}),e.jsx("input",{className:"p-2 ml-0 my-1 bg-white rounded-md w-full shrink",type:"number",placeholder:"Table Page Size",value:n,onChange:a=>{r(a.target.value),a.target.value>0&&s(+a.target.value)},onWheel:a=>a.target.blur()},"dataSizeInput")]}):null},v9=({cols:t,anchorCols:s,visibleCols:n,setVisibleCols:r,metadata:a})=>e.jsxs("div",{className:"w-full pt-2 mt-1 flex flex-row text-sm",children:[e.jsx("label",{className:"shrink-0 pr-2 py-2 my-1 w-1/4",children:" Display Columns: "}),e.jsxs("select",{value:" ",className:"p-2 ml-0 my-1 bg-white rounded-md w-full shrink",onChange:l=>r([...n,l.target.value]),children:[e.jsx("option",{value:" ",children:" Select a Column"},0),t.filter(l=>!n.includes(l)&&!s.includes(l)).map(l=>{var i;return e.jsx("option",{value:l,children:((i=a.find(c=>c.name===l))==null?void 0:i.display_name)||l},l)})]},"displayColsInput")]}),j9=({column:t,groupBy:s,setGroupBy:n,fn:r,metadata:a})=>{if(!n||!["meta-variable","geoid-variable"].includes(a==null?void 0:a.display))return null;const l=t.includes(" as")?t.split(" as")[0]:t.split(" AS")[0],i=s.includes(l);return e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsx("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:" Group by: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:i,onChange:c=>n(i?s.filter(d=>d!==l):[...s,l]),className:Ft(i?"bg-indigo-600":"bg-gray-200",`relative inline-flex 
                         h-4 w-10 shrink
                         cursor-pointer rounded-full border-2 border-transparent 
                         transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                         focus:ring-indigo-600 focus:ring-offset-2`),children:[e.jsx("span",{className:"sr-only",children:"toggle group by"}),e.jsx("span",{"aria-hidden":"true",className:Ft(i?"translate-x-5":"translate-x-0",`pointer-events-none inline-block 
                            h-3 w-4
                            transform rounded-full bg-white shadow ring-0 t
                            transition duration-200 ease-in-out`)})]},`groupby-${t}`)})]})},w9=({column:t,fn:s,setFn:n,groupBy:r,metadata:a})=>{var p,m,h;if(!n||(a==null?void 0:a.display)==="calculated-column")return null;const l=t.includes(" as")?t.split(" as")[0]:t.split(" AS")[0],i=(t.includes(" as")?t.split("as ")[1]:t.split("AS ")[1])||l,c=[{label:"None",value:t},{label:"List",value:`array_to_string(array_agg(distinct ${l}), ', ') as ${i}`},{label:"Sum",value:`sum(${l}) as ${i}`},{label:"Count",value:`count(${l}) as ${i}`}],d=l.includes("count(")||l.includes("sum("),u=d?(p=c.find(f=>f.label==="None"))==null?void 0:p.value:((m=c.find(f=>f.label===(a==null?void 0:a.defaultFn)))==null?void 0:m.value)||((h=c.find(f=>f.label==="List"))==null?void 0:h.value);return r.includes(l)&&s[t]!==t&&n({...s,[t]:t}),r.length&&!r.includes(l)&&!d&&(s[t]===t||!s[t])&&n({...s,[t]:u}),!r.length&&s[t]!==t&&n({...s,[t]:t}),e.jsxs("div",{className:"block w-full flex justify-between",children:[e.jsx("label",{className:"align-bottom shrink-0 pr-2 py-2 my-1 w-1/4",children:" Function: "}),e.jsx("select",{className:"align-bottom p-2 ml-0 my-1 bg-white rounded-md w-full shrink",value:s[t],onChange:f=>n({...s,[t]:f.target.value}),disabled:!r.length,children:c.map(f=>e.jsxs("option",{value:f.value,children:[" ",f.label," "]},`fn-${t}-${f.label}`))},`fn-${t}`)]})},N9=({column:t,notNull:s,setNotNull:n})=>{if(!n)return null;const r=t.includes(" as")?t.split(" as")[0]:t.split(" AS")[0],a=s.includes(r);return e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsx("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:" Exclude N/A: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:s.includes(r),onChange:l=>n(a?s.filter(i=>i!==r):[...s,r]),className:Ft(a?"bg-indigo-600":"bg-gray-200",`relative inline-flex 
                         h-4 w-10 shrink
                         cursor-pointer rounded-full border-2 border-transparent 
                         transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                         focus:ring-indigo-600 focus:ring-offset-2`),children:[e.jsx("span",{className:"sr-only",children:"toggle not null by"}),e.jsx("span",{"aria-hidden":"true",className:Ft(a?"translate-x-5":"translate-x-0",`pointer-events-none inline-block 
                            h-3 w-4
                            transform rounded-full bg-white shadow ring-0 t
                            transition duration-200 ease-in-out`)})]},`notNull-${r}`)})]})},C9=({column:t,index:s,showTotal:n,setShowTotal:r,fn:a})=>{if(!r||s===0)return null;const l=a[t]||t,i=n.includes(l);return e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsx("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:" Show Total: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:n.includes(l),onChange:c=>r(i?n.filter(d=>d!==l):[...n,l]),className:Ft(i?"bg-indigo-600":"bg-gray-200",`relative inline-flex 
                         h-4 w-10 shrink
                         cursor-pointer rounded-full border-2 border-transparent 
                         transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                         focus:ring-indigo-600 focus:ring-offset-2`),children:[e.jsx("span",{className:"sr-only",children:"toggle show total"}),e.jsx("span",{"aria-hidden":"true",className:Ft(i?"translate-x-5":"translate-x-0",`pointer-events-none inline-block 
                            h-3 w-4
                            transform rounded-full bg-white shadow ring-0 t
                            transition duration-200 ease-in-out`)})]},`show-total-${l}`)})]})},_9=({column:t,hiddenCols:s,setHiddenCols:n,fn:r})=>{if(!n)return null;const a=r[t]||t,l=s.includes(a);return e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsx("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:" Hide: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:s.includes(a),onChange:i=>n(l?s.filter(c=>c!==a):[...s,a]),className:Ft(l?"bg-indigo-600":"bg-gray-200",`relative inline-flex 
                         h-4 w-10 shrink
                         cursor-pointer rounded-full border-2 border-transparent 
                         transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                         focus:ring-indigo-600 focus:ring-offset-2`),children:[e.jsx("span",{className:"sr-only",children:"toggle hide column"}),e.jsx("span",{"aria-hidden":"true",className:Ft(l?"translate-x-5":"translate-x-0",`pointer-events-none inline-block 
                            h-3 w-4
                            transform rounded-full bg-white shadow ring-0 t
                            transition duration-200 ease-in-out`)})]},`hide-${a}`)})]})},S9=({column:t,extFilterCols:s,setExtFilterCols:n,fn:r})=>{if(!n)return null;const a=r[t]||t,l=s.includes(a);return e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsx("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:" External Filter: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:s.includes(a),onChange:i=>n(l?s.filter(c=>c!==a):[...s,a]),className:Ft(l?"bg-indigo-600":"bg-gray-200",`relative inline-flex 
                         h-4 w-10 shrink
                         cursor-pointer rounded-full border-2 border-transparent 
                         transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                         focus:ring-indigo-600 focus:ring-offset-2`),children:[e.jsx("span",{className:"sr-only",children:"toggle ext filter column"}),e.jsx("span",{"aria-hidden":"true",className:Ft(l?"translate-x-5":"translate-x-0",`pointer-events-none inline-block 
                            h-3 w-4
                            transform rounded-full bg-white shadow ring-0 t
                            transition duration-200 ease-in-out`)})]},`extFilter-${a}`)})]})},$9=({column:t,openOutCols:s,setOpenOutCols:n,fn:r})=>{if(!n)return null;const a=r[t]||t,l=s.includes(a);return e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsx("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:" Open Out: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:s.includes(a),onChange:i=>n(l?s.filter(c=>c!==a):[...s,a]),className:Ft(l?"bg-indigo-600":"bg-gray-200",`relative inline-flex 
                         h-4 w-10 shrink
                         cursor-pointer rounded-full border-2 border-transparent 
                         transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                         focus:ring-indigo-600 focus:ring-offset-2`),children:[e.jsx("span",{className:"sr-only",children:"toggle open out column"}),e.jsx("span",{"aria-hidden":"true",className:Ft(l?"translate-x-5":"translate-x-0",`pointer-events-none inline-block 
                            h-3 w-4
                            transform rounded-full bg-white shadow ring-0 t
                            transition duration-200 ease-in-out`)})]},`openout-${a}`)})]})},E9=({column:t,filters:s,setFilters:n,anchorCols:r})=>n?e.jsxs("div",{className:"w-full pt-2 mt-1 flex flex-row text-sm",children:[e.jsx("label",{className:"align-bottom shrink-0 pr-2 py-2 my-1 w-1/4",children:" Filter: "}),e.jsxs("select",{className:"align-bottom p-2 ml-0 my-1 bg-white rounded-md w-full shrink",value:s[t],onChange:a=>n({...s,[t]:a.target.value}),disabled:r.includes(t),children:[e.jsx("option",{value:" ",children:"None"},`filter-none-${t}`),e.jsx("option",{value:"text",children:"Text"},`filter-text-${t}`)]},`filter-${t}`)]}):null,k9=({column:t,filterValue:s,setFilterValue:n,fn:r})=>{if(!n)return null;const a=r[t]||t;return e.jsxs("div",{className:"w-full pt-2 mt-1 flex flex-row text-sm",children:[e.jsx("label",{className:"align-bottom shrink-0 pr-2 py-2 my-1 w-1/4",children:" Filter by: "}),e.jsx("input",{type:"text",className:"align-bottom p-2 ml-0 my-1 bg-white rounded-md w-full shrink",value:s[a],placeholder:"filter by",onChange:l=>{const i=JSON.parse(JSON.stringify(s));l.target.value||delete i[a];const c=l.target.value?{...i,[a]:l.target.value?l.target.value:void 0}:i;n(c)}})]})},L9=({column:t,formatFn:s,setFormatFn:n,fn:r})=>n?e.jsxs("div",{className:"w-full pt-2 mt-1 flex flex-row text-sm",children:[e.jsx("label",{className:"align-bottom shrink-0 pr-2 py-2 my-1 w-1/4",children:" Format: "}),e.jsxs("select",{className:"align-bottom p-2 ml-0 my-1 bg-white rounded-md w-full shrink",value:s[t],onChange:a=>n({...s,[t]:a.target.value}),children:[e.jsx("option",{value:" ",children:"None"},`filter-none-${t}`),e.jsx("option",{value:"abbreviate",children:"Abbreviate"},`filter-text-${t}`),e.jsx("option",{value:"comma",children:"Comma Seperated"},`filter-text-${t}`)]},`format-fn-${t}`)]}):null,I9=({column:t,sortBy:s,setSortBy:n,fn:r,stateNamePreferences:a})=>{if(!n)return null;const l=a==="original"?t:r[t]||t;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"block shrink-0 w-full flex",children:[e.jsx("label",{className:"align-bottom pr-2 py-2 my-1 w-1/4",children:" Sort by: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:(s==null?void 0:s[l])||!1,onChange:i=>n(s!=null&&s[l]?{}:{[l]:i&&"asc"}),className:Ft(s!=null&&s[l]?"bg-indigo-600":"bg-gray-200",`relative inline-flex 
                                            h-4 w-10 
                                             cursor-pointer rounded-full border-2 border-transparent 
                                            transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                                            focus:ring-indigo-600 focus:ring-offset-2`),children:[e.jsx("span",{className:"sr-only",children:"toggle sort"}),e.jsx("span",{"aria-hidden":"true",className:Ft(s!=null&&s[l]?"translate-x-5":"translate-x-0",`pointer-events-none inline-block 
                                                h-3 w-4
                                                transform rounded-full bg-white shadow ring-0 t
                                                transition duration-200 ease-in-out`)})]},`sortby-${t}`)})]}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("label",{className:"align-bottom shrink-0 pr-2 py-2 my-1 w-1/4",children:" Order: "}),e.jsxs("select",{className:"align-bottom p-2 ml-0 my-1 bg-white rounded-md w-full shrink",value:s==null?void 0:s[l],onChange:i=>n({[l]:i.target.value}),disabled:!(s!=null&&s[l]),children:[e.jsx("option",{value:"asc",children:"Ascending"},`order-asc-${t}`),e.jsx("option",{value:"desc",children:"Descending"},`order-desc-${t}`)]},`order-${t}`)]})]})},T9=({column:t,colSizes:s,setColSizes:n})=>{if(!n)return null;const[r,a]=b.useState(!1),l=s[t]||"15%",i=[{label:"x-small (5%)",value:"5%"},{label:"small (15%)",value:"15%"},{label:"medium (20%)",value:"20%"},{label:"large (25%)",value:"25%"},{label:"x-large (35%)",value:"35%"},{label:"custom",value:"custom"}],c=i.map(d=>d.value).filter(d=>d!=="custom");return b.useEffect(()=>{a(!c.includes(l))},[l]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("label",{className:"align-bottom shrink-0 pr-2 py-2 my-1 w-1/4",children:" Size: "}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("select",{className:"p-2 ml-0 my-1 bg-white rounded-md w-full shrink",value:l,onChange:d=>{c.includes(d.target.value)?n({...s,[t]:d.target.value}):a(!0)},children:i.map(d=>e.jsx("option",{value:d.value,children:d.label},`size-${d.value}`))},`size-${t}`),r?e.jsx("input",{className:"w-full p-2 ml-0 my-1 bg-white rounded-md shrink",type:"number",placeholder:"size in px",value:l.replace("px",""),onChange:d=>{n({...s,[t]:`${d.target.value}px`})},onWheel:d=>d.target.blur()},"colSizeInput"):null]})]})})},rr=t=>["integer","number"].includes(t)?"right":"left",M9=({column:t,colJustify:s,setColJustify:n,metadata:r})=>{if(!n)return null;const a=rr(r==null?void 0:r.type),l=s[t]||a;return e.jsx(ze,{label:"Justify:",types:[{label:"Left",value:"left"},{label:"Center",value:"center"},{label:"Right",value:"right"}],type:l,setType:i=>n({...s,[t]:i})})},B9=({column:t,customColName:s,setCustomColName:n,metadata:r})=>{if(!n)return null;const a=s[t]||r.display_name||r.name,[l,i]=b.useState({[t]:a});return b.useEffect(()=>{setTimeout(()=>n({...s,...l}),1500)},[l]),e.jsxs("div",{className:"w-full pt-2 mt-1 flex flex-row text-sm",children:[e.jsx("label",{className:"align-bottom shrink-0 pr-2 py-2 my-1 w-1/4",children:" Label: "}),e.jsx("input",{type:"text",className:"align-bottom p-2 ml-0 my-1 bg-white rounded-md w-full shrink",value:l[t],placeholder:"Label",onChange:c=>{i({[t]:c.target.value})}})]})},A9=({column:t,linkCols:s,setLinkCols:n,metadata:r})=>{if(!n)return null;const a=s[t]||{},[l,i]=b.useState(a);return b.useEffect(()=>{setTimeout(()=>n({...s,[t]:l}),500)},[l]),e.jsxs("div",{className:"w-full pt-2 mt-1 flex flex-row text-sm",children:[e.jsx("label",{className:"align-bottom shrink-0 pr-2 py-2 my-1 w-1/4",children:" is Link: "}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"p-2 pl-0 my-1 rounded-md shrink",children:e.jsxs(Tt,{checked:a||!1,onChange:c=>{const d=a!=null&&a.isLink?{...s,[t]:{...a,isLink:!1}}:{...s,[t]:{...a,isLink:!0}};n(d)},className:Ft(a!=null&&a.isLink?"bg-indigo-600":"bg-gray-200",`relative inline-flex 
                                            h-4 w-10 
                                             cursor-pointer rounded-full border-2 border-transparent 
                                            transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                                            focus:ring-indigo-600 focus:ring-offset-2`),children:[e.jsx("span",{className:"sr-only",children:"toggle is link"}),e.jsx("span",{"aria-hidden":"true",className:Ft(a!=null&&a.isLink?"translate-x-5":"translate-x-0",`pointer-events-none inline-block 
                                                h-3 w-4
                                                transform rounded-full bg-white shadow ring-0 t
                                                transition duration-200 ease-in-out`)})]},`islink-${t}`)}),a!=null&&a.isLink?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"align-bottom p-2 ml-0 my-1 bg-white rounded-md w-full shrink",value:l.linkText,placeholder:"link text",onChange:c=>{i({...a,linkText:c.target.value})}}),e.jsx("input",{type:"text",className:"align-bottom p-2 ml-0 my-1 bg-white rounded-md w-full shrink",value:l.location,placeholder:"location",onChange:c=>{i({...a,location:c.target.value})}})]}):null]})]})},O9=({column:t,columnHeaders:s,setColumnHeaders:n})=>{if(!n)return null;const r=s[t]||"none";return e.jsx(ze,{label:"Justify:",types:[{label:"H1",value:"h1"},{label:"H2",value:"h2"},{label:"H3",value:"h3"},{label:"H4",value:"h4"},{label:"None",value:"none"}],type:r,setType:a=>n({...s,[t]:a})})},P9=({column:t,columnColors:s,setColumnColors:n})=>{if(!n)return null;const r=s[t]||"none";return e.jsxs(e.Fragment,{children:[e.jsx(Di,{title:"Background: ",className:"w-full py-1 flex flex-row items-center",color:r.bg,setColor:a=>n({...s,[t]:{...r,bg:a}})}),e.jsx(Di,{title:"Text: ",className:"w-full py-1 flex flex-row items-center",color:r.text,setColor:a=>n({...s,[t]:{...r,text:a}})})]})},D9=({cols:t,anchorCols:s=[],visibleCols:n=[],setVisibleCols:r,hiddenCols:a=[],setHiddenCols:l,openOutCols:i,setOpenOutCols:c,colJustify:d,setColJustify:u,extFilterCols:p,setExtFilterCols:m,filters:h,setFilters:f,filterValue:g,setFilterValue:x,formatFn:y,setFormatFn:j,groupBy:N,setGroupBy:_,notNull:E,setNotNull:L,showTotal:S,setShowTotal:k,fn:$,setFn:I,sortBy:T,setSortBy:A,metadata:R,stateNamePreferences:O,colSizes:M,setColSizes:D,customColName:P,setCustomColName:F,linkCols:B,setLinkCols:V,columnHeader:G,setColumnHeader:Z,columnColors:X,setColumnColors:H})=>{const[z,W]=b.useState(!1),[Y,U]=b.useState([...new Set([...s,...n])]),q=b.useRef(),te=b.useRef(),K=b.useRef(null);b.useEffect(()=>{const ue=s.filter(ve=>!n.includes(ve)),fe=ue!=null&&ue.length?[...new Set([...s,...n])]:n;U(fe),r(fe)},[s,n]);const ne=(ue,fe)=>{q.current=fe,ue.dataTransfer.effectAllowed="move"},J=(ue,fe)=>{te.current=fe},ae=ue=>{ue.preventDefault(),ue.dataTransfer.dropEffect="move"},de=ue=>{const fe=[...Y],ve=fe[q.current];fe.splice(q.current,1),fe.splice(te.current,0,ve),q.current=null,te.current=null,U(fe),r(fe)};return e.jsx("div",{className:"flex flex-row flex-wrap space-between px-16 my-1 text-sm",children:Y.filter(ue=>t.includes(ue)).map((ue,fe)=>{const ve=R.find(se=>se.name===ue);return e.jsxs("div",{onDragStart:se=>ne(se,fe),onDragEnter:se=>J(se,fe),onDragOver:ae,onDragEnd:de,draggable:!0,id:(ve==null?void 0:ve.display_name)||ue,className:`m-1 flex flex-col justify-between p-2 cursor-grab
                                    border border-dashed border-blue-${s.includes(ue)?"500":"300"}
                                    rounded-md`,children:[e.jsxs("div",{className:"font-normal w-full h-full flex flex-row justify-between items-center",children:[e.jsx("label",{className:"",children:(ve==null?void 0:ve.display_name)||ue},`label-${ue}`),e.jsx("i",{className:"fa fa-gear p-2 text-blue-300 hover:text-blue-500",onClick:se=>W(ue)}),e.jsx("button",{className:s.includes(ue)?"hidden":"align-top hover:text-red-500 text-slate-40",onClick:()=>r(n.filter(se=>se!==ue)),children:e.jsx("i",{className:"fa-light fa-xmark fa-fw float-right",title:"remove"})},`cancel-${ue}`)]}),e.jsx(Be.Root,{show:z===ue,as:b.Fragment,children:e.jsxs(Je,{as:"div",className:"relative z-20",initialFocus:K,onClose:W,children:[e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),e.jsx("div",{className:"fixed inset-0 z-20 w-screen overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:e.jsxs(Je.Panel,{className:"relative transform overflow-hidden bg-blue-50 rounded-lg px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6",children:[e.jsx("label",{className:"text-sm font-semibold",children:"Settings"}),e.jsx("i",{className:"fa fa-close float-right inline-flex justify-right rounded-md hover:text-red-500",onClick:()=>W(void 0),ref:K}),e.jsxs("div",{className:"w-full divide-y",children:[e.jsx(B9,{column:ue,customColName:P,setCustomColName:F,metadata:ve}),e.jsx(E9,{column:ue,anchorCols:s,filters:h,setFilters:f}),e.jsx(k9,{column:ue,filterValue:g,setFilterValue:x,fn:$}),e.jsx(L9,{column:ue,formatFn:y,setFormatFn:j,fn:$}),e.jsx(j9,{column:ue,groupBy:N,setGroupBy:_,fn:$,metadata:ve}),e.jsx(w9,{column:ue,fn:$,setFn:I,groupBy:N,metadata:ve}),e.jsx(I9,{column:ue,sortBy:T,setSortBy:A,fn:$,stateNamePreferences:O==null?void 0:O.sortBy}),e.jsx(T9,{column:ue,colSizes:M,setColSizes:D}),e.jsx(M9,{column:ue,colJustify:d,setColJustify:u,metadata:ve}),e.jsx(N9,{column:ue,notNull:E,setNotNull:L}),e.jsx(C9,{column:ue,index:fe,showTotal:S,setShowTotal:k,fn:$,stateNamePreferences:O==null?void 0:O.showTotal}),e.jsx(_9,{column:ue,hiddenCols:a,setHiddenCols:l,fn:$,stateNamePreferences:O==null?void 0:O.hideCols}),e.jsx(S9,{column:ue,extFilterCols:p,setExtFilterCols:m,fn:$,stateNamePreferences:O==null?void 0:O.hideCols}),e.jsx($9,{column:ue,openOutCols:i,setOpenOutCols:c,fn:$,stateNamePreferences:O==null?void 0:O.hideCols}),e.jsx(A9,{column:ue,linkCols:B,setLinkCols:V}),e.jsx(O9,{column:ue,columnHeaders:G,setColumnHeaders:Z}),e.jsx(P9,{column:ue,columnColors:X,setColumnColors:H})]})]})})})})]})})]},`col-settings-${ue}`)})})},R9=({visibleCols:t,setVisibleCols:s})=>t!=null&&t.length?e.jsx("div",{className:"w-full py-1",children:e.jsx("button",{className:"p-1 text-xs bg-red-600 hover:bg-red-500 text-white rounded-md height-fit float-right",onClick:()=>s([]),children:"Clear"})}):null,Ls=({cols:t=[],metadata:s=[],anchorCols:n=[],visibleCols:r=[],setVisibleCols:a,hiddenCols:l=[],setHiddenCols:i,filters:c={},setFilters:d,formatFn:u={},setFormatFn:p,filterValue:m={},setFilterValue:h,extFilterCols:f={},setExtFilterCols:g,showTotal:x=[],setShowTotal:y,groupBy:j=[],setGroupBy:N,notNull:_=[],setNotNull:E,fn:L={},setFn:S,sortBy:k={},setSortBy:$,pageSize:I,setPageSize:T,dataSize:A,setDataSize:R,stateNamePreferences:O,colSizes:M={},setColSizes:D,openOutCols:P=[],setOpenOutCols:F,colJustify:B={},setColJustify:V,customColName:G={},setCustomColName:Z,linkCols:X={},setLinkCols:H,columnHeader:z={},setColumnHeader:W,columnColors:Y={},setColumnColors:U})=>e.jsxs("div",{children:[e.jsx("div",{className:"shadow-md shadow-blue-100 p-1.5"},"shadow"),e.jsxs("div",{className:"w-full flex flex-cols sm:flex-rows justify-between",children:[e.jsx(b9,{pageSize:I,setPageSize:T}),e.jsx(y9,{dataSize:A,setDataSize:R})]}),e.jsx(v9,{cols:t,anchorCols:n,visibleCols:r,setVisibleCols:a,metadata:s}),e.jsx(R9,{visibleCols:r,setVisibleCols:a}),e.jsx(D9,{cols:t,anchorCols:n,visibleCols:r,setVisibleCols:a,hiddenCols:l,setHiddenCols:i,extFilterCols:f,setExtFilterCols:g,filters:c,setFilters:d,filterValue:m,setFilterValue:h,formatFn:u,setFormatFn:p,sortBy:k,setSortBy:$,groupBy:j,setGroupBy:N,notNull:_,setNotNull:E,showTotal:x,setShowTotal:y,fn:L,setFn:S,metadata:s,stateNamePreferences:O,colSizes:M,setColSizes:D,openOutCols:P,setOpenOutCols:F,colJustify:B,setColJustify:V,customColName:G,setCustomColName:Z,linkCols:X,setLinkCols:H,columnHeader:z,setColumnHeader:W,columnColors:Y,setColumnColors:U})]}),F9={disaster_number:"distinct disaster_number as disaster_number"},L0=t=>typeof(t==null?void 0:t.value)=="object"?L0(t.value):(t==null?void 0:t.value)||t,wt=t=>({[t==="declared"?"Disaster Name / Number":"Event Id"]:{raw:t==="declared"?"disaster_number":"event_id",align:"right",width:[t==="declared"?"40%":"10%"],type:"text"},County:{raw:"geoid",type:"text"},Year:{raw:"EXTRACT(YEAR from coalesce(fema_incident_begin_date, swd_begin_date)) as year",align:"right",width:"10%",type:"text"},"NRI Category":{raw:"ARRAY_AGG(distinct nri_category order by nri_category) as nri_category",align:"right",width:"20%",type:"text"},"Start Date":{raw:"min(coalesce(fema_incident_begin_date, swd_begin_date)) as start_date",type:"text"},"Deaths, Injuries":{raw:"'deaths:' || (coalesce(sum(deaths_direct), 0) + coalesce(sum(deaths_indirect), 0))::text || ', injuries:' || (coalesce(sum(injuries_direct), 0) + coalesce(sum(injuries_indirect), 0))::text as population_damage_numbers",type:"text"},"Population Damage $":{raw:"sum(swd_population_damage) * 11700000 as swd_population_damage",align:"right"},"Property Damage":{raw:"sum(fusion_property_damage) as fusion_property_damage",align:"right"},"Crop Damage":{raw:"sum(fusion_crop_damage) as fusion_crop_damage",align:"right"},"Total Damage":{raw:"coalesce(sum(fusion_property_damage), 0) + coalesce(sum(fusion_crop_damage), 0) as total_fusion_damage",width:"20%",align:"right"},"Event Narrative":{raw:"event_narrative",width:"20%",align:"right",fetchData:!1,type:"text",visible:!1},"Episode Narrative":{raw:"episode_narrative",width:"20%",align:"right",fetchData:!1,type:"text",visible:!1}}),Ku=(t,s)=>t&&t!=="0"?t:s;async function I0({geoid:t,type:s,hazard:n,ealViewId:r,visibleCols:a,filters:l,filterValue:i,pageSize:c,sortBy:d},u){var q,te,K;const p="geoid",m=JSON.stringify({aggregatedLen:!0,filter:{[`substring(${p}, 1, ${(q=t==null?void 0:t.toString())==null?void 0:q.length})`]:[t],...s!=="declared"&&{disaster_number:["null"]},...n!=="total"&&{nri_category:[n]}},exclude:{...s==="declared"&&{"coalesce((fusion_property_damage), 0) + coalesce((fusion_crop_damage), 0)+ coalesce((swd_population_damage), 0)":[0]},...s==="declared"&&{disaster_number:["null"]}},groupBy:[p,"EXTRACT(YEAR from coalesce(fema_incident_begin_date, swd_begin_date))",s==="declared"?"disaster_number":"event_id"]}),h=JSON.stringify({filter:{[`substring(${p}, 1, ${(te=t==null?void 0:t.toString())==null?void 0:te.length})`]:[t],...s!=="declared"&&{disaster_number:["null"]},...n!=="total"&&{nri_category:[n]}},exclude:{...s==="declared"&&{"coalesce((fusion_property_damage), 0) + coalesce((fusion_crop_damage), 0)+ coalesce((swd_population_damage), 0)":[0]},...s==="declared"&&{disaster_number:["null"]}},groupBy:[1,2,3],orderBy:[s==="declared"?"sum(fema_property_damage)+sum(fema_crop_damage) desc nulls last":"sum(swd_property_damage)+sum(swd_crop_damage)+sum(swd_population_damage) desc nulls last"]}),f=ne=>["dama",oe,"viewsbyId",ne,"options"],g=ne=>["dama",oe,"viewDependencySubgraphs","byViewId",ne],x=["distinct disaster_number as disaster_number","declaration_title"],y=(ne,J)=>["dama",oe,"viewsbyId",ne,"options",JSON.stringify({filter:{disaster_number:J}}),"databyIndex"],j=["event_id","event_narrative","episode_narrative"],N=(ne,J)=>["dama",oe,"viewsbyId",ne,"options",JSON.stringify({filter:{event_id:J}}),"databyIndex"],_=JSON.stringify({...t&&{filter:{[`substring(geoid, 1, ${(K=t==null?void 0:t.toString())==null?void 0:K.length})`]:[t]}}}),E=ne=>["dama",oe,"viewsbyId",ne,"options",_],L=await u.get(g(r)),S=C(L,["json",...g(r),"dependencies"]),k=S.find(ne=>ne.type==="fusion"),$=S.find(ne=>ne.type==="disaster_declarations_summaries_v2"),I=S.find(ne=>ne.type==="tl_county"),T=S.find(ne=>ne.type==="ncei_storm_events_enhanced");if(!k)return{};const A=await u.get([...E(I.view_id),"length"]),R=C(A,["json",...E(I.view_id),"length"],0);R&&await u.get([...E(I.view_id),"databyIndex",{from:0,to:R-1},["geoid","namelsad"]]);const O=await u.get([...f(k.view_id),m,"length"]),M=Math.min(C(O,["json",...f(k.view_id),m,"length"],0),250),D={from:0,to:M-1},P=await u.get([...f(k.view_id),h,"databyIndex",D,Object.values(wt(s)).filter(ne=>ne.fetchData!==!1).map(ne=>ne.raw)],["dama",oe,"views","byId",k.view_id,"attributes",["source_id","view_id","version","_modified_timestamp"]]),F=[...new Set(Object.values(C(P,["json",...f(k.view_id),h,"databyIndex"],{})).map(ne=>ne.disaster_number).filter(ne=>ne))],B=[...new Set(Object.values(C(P,["json",...f(k.view_id),h,"databyIndex"],{})).map(ne=>ne.event_id).filter(ne=>ne))];F.length&&$&&await u.get([...y($.view_id,F),{from:0,to:F.length-1},x]),B.length&&T&&await u.get([...N(T.view_id,B),{from:0,to:B.length-1},j]);const V=u.getCache(),G=Object.values(C(V,[...y($.view_id,F)],{})),Z=Object.values(C(V,[...N(T.view_id,B)],{})),X=Object.values(C(V,[...E(I.view_id),"databyIndex"],{})),H=ne=>ne.map(J=>{var ue,fe;const ae={...J},de=L0(ae[wt(s)["NRI Category"].raw]);if(ae[wt(s).County.raw]=((ue=X==null?void 0:X.find(ve=>ve.geoid===ae[wt(s).County.raw]))==null?void 0:ue.namelsad)||ae[wt(s).County.raw],ae[wt(s)["NRI Category"].raw]=(de||[]).map(ve=>{var se;return((se=Ne[ve])==null?void 0:se.name)||ve}).join(", "),s==="declared"&&((fe=ae[wt(s)["Disaster Name / Number"].raw])==null?void 0:fe.length)<=4&&(ae[wt(s)["Disaster Name / Number"].raw]=C(G.find(ve=>ve[F9.disaster_number]===ae[wt(s)["Disaster Name / Number"].raw]),"declaration_title","No Title")+` (${ae[wt(s)["Disaster Name / Number"].raw]})`),s==="non-declared"&&!(ae.event_narrative||ae.episode_narrative)){const ve=Z.find(se=>se.event_id===ae.event_id);(a.includes("Event Narrative")||a.includes("Episode Narrative"))&&(ae.expand=[],a.includes("Event Narrative")&&ae.expand.push({key:"Event Narrative",value:Ku(ve==null?void 0:ve.event_narrative,"No Event Narrative")}),a.includes("Episode Narrative")&&ae.expand.push({key:"Episode Narrative",value:Ku(ve==null?void 0:ve.episode_narrative,"No Episode Narrative")}))}return ae}),z=Object.values(C(V,[...f(k.view_id),h,"databyIndex"],{})),W=H(z),Y=a.filter(ne=>{var J;return wt(s)[ne]&&((J=wt(s)[ne])==null?void 0:J.visible)!==!1}).map(ne=>{var J,ae,de,ue,fe,ve;return{Header:ne,accessor:(J=wt(s)[ne])==null?void 0:J.raw,rawHeader:(ae=wt(s)[ne])==null?void 0:ae.raw,type:(de=wt(s)[ne])==null?void 0:de.type,align:((ue=wt(s)[ne])==null?void 0:ue.align)||"left",width:((fe=wt(s)[ne])==null?void 0:fe.width)||"15%",filter:((ve=wt(s)[ne])==null?void 0:ve.filter)||l[ne]}}),U=C(V,["dama",oe,"views","byId",k.view_id,"attributes"],{});return{data:W,columns:Y,disasterNames:G,ealViewId:r,countyView:I.view_id,disasterDecView:$.view_id,nceiView:T.view_id,fusionViewId:k.view_id,type:s,geoid:t,visibleCols:a,filters:l,filterValue:i,hazard:n,attributionData:U,pageSize:c,sortBy:d,fusionAttributes:wt(s)}}const T0=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",i=343,[c,d]=b.useState((a==null?void 0:a.ealViewId)||837);b.useState((a==null?void 0:a.fusionViewId)||834);const[u,p]=b.useState(!0),[m,h]=b.useState((a==null?void 0:a.type)||"declared"),[f,g]=b.useState(a==null?void 0:a.status),[x,y]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[j,N]=b.useState((a==null?void 0:a.filters)||{}),[_,E]=b.useState((a==null?void 0:a.filterValue)||{}),[L,S]=b.useState((a==null?void 0:a.visibleCols)||[]),[k,$]=b.useState((a==null?void 0:a.pageSize)||5),[I,T]=b.useState((a==null?void 0:a.sortBy)||{}),[A,R]=b.useState((a==null?void 0:a.hazard)||"total");return b.useEffect(()=>{async function O(){g(x?void 0:"Please Select a Geography"),p(!0),g(void 0);const M=await I0({geoid:x,type:m,hazard:A,ealViewId:c,visibleCols:L,filters:j,filterValue:_,pageSize:k,sortBy:I},n);s(JSON.stringify({...M})),p(!1)}O()},[x,m,A,c,L,j,_,k,I]),b.useEffect(()=>{N({...j,...Object.keys(wt(m)).filter(O=>wt(m)[O].filter).reduce((O,M)=>({...O,[M]:wt(m)[M].filter}),{})})},[m]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:i,view_id:c,onChange:d,className:"flex-row-reverse"}),e.jsx(rt,{value:x,onChange:y,className:"flex-row-reverse"}),e.jsx(ze,{label:"Type:",types:[{label:"Declared Disasters",value:"declared"},{label:"Non Declared Disasters",value:"non-declared"}],type:m,setType:O=>{h(O),S([]),N({})}}),e.jsx(Gs,{hazard:A,setHazard:R,showTotal:!0}),e.jsx(Ls,{cols:Object.keys(wt(m)||{}),visibleCols:L,setVisibleCols:S,filters:j,setFilters:N,filterValue:_,setFilterValue:E,pageSize:k,setPageSize:$,sortBy:I,setSortBy:T})]}),u?e.jsx(dt,{}):f?e.jsx("div",{className:"p-5 text-center",children:f}):e.jsx($0,{geoid:x,type:m,data:a.data,columns:a.columns,pageSize:k,sortBy:I,filterValue:_,fusionAttributes:wt(m),attributionData:a.attributionData,baseUrl:l})]})})};T0.settings={hasControls:!0,name:"ElementEdit"};const V9=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx($0,{...s,baseUrl:"/"})})},H9={name:"Table: Disaster Events",type:"Table",variables:[{name:"ealViewId",default:837,hidden:!0},{name:"geoid",default:"36"},{name:"type",default:"declared"},{name:"hazard",default:"total"},{name:"pageSize",default:5},{name:"visibleCols",default:[]},{name:"filters",default:{}},{name:"filterValue",default:{}},{name:"sortBy",default:{}}],getData:I0,EditComp:T0,ViewComp:V9},Yu="border-b-2",Zu="font-medium pt-2 text-xl",M0=({disasterNumber:t,title:s,incidentType:n,declarationDate:r,endDate:a,attributionData:l,baseUrl:i})=>e.jsxs(w.Fragment,{children:[e.jsxs("div",{className:"w-full shrink-1 flex flex-col mr-5",children:[e.jsxs("div",{className:"w-full h-[70px] font-bold flex items-center text-3xl",children:[s," ",t?`(${t})`:null]}),e.jsxs("div",{className:"w-full  text-center flex flex-row ",children:[e.jsxs("div",{className:"w-full h-[90px] bg-white p-3 mt-5 flex flex-col",children:[e.jsx("label",{className:Yu,children:"Category"}),e.jsx("span",{className:Zu,children:n})]}),e.jsxs("div",{className:"w-full h-[90px] bg-white p-3 mt-5 ml-5 flex flex-col",children:[e.jsx("label",{className:Yu,children:"Incident Date"}),e.jsxs("span",{className:Zu,children:[Wa(r)," ",a&&Wa(r)!==Wa(a)?`- ${Wa(a)}`:""]})]})]})]}),e.jsx(ct,{baseUrl:i,attributionData:l})]}),z9=(t,s,n)=>{s&&n([])},U9=(t,s,n,r,a,l)=>{const i=C(t,[0,"key"]);console.log("changed",i),s(t),l?l(i):a(`/disaster/${i}`)},W9=(t,s,n,...r)=>e.jsx(cn,{className:"bg-slate-100  overflow-hidden z-10",...s,children:t.map((a,l)=>e.jsx(dn,{className:"block hover:bg-slate-200 text-xl tracking-wide pl-1",option:a,position:l,children:a.label}))}),Jn=({className:t,view_id:s,value:n,geoid:r,onChange:a,showAll:l=!1,showLabel:i=!0})=>{const c=$e(),{falcor:d,falcorCache:u}=et(),[p,m]=b.useState(),[h,f]=b.useState([]),g=E=>["dama",oe,"viewDependencySubgraphs","byViewId",E],x=["distinct disaster_number as disaster_number","declaration_title","declaration_date","incident_type"],y=JSON.stringify({...r&&{filter:{[(r==null?void 0:r.length)===2?"fips_state_code":"fips_state_code || fips_county_code"]:[r]}},exclude:{disaster_number:Sa(3e3,3999)}}),j=E=>["dama",oe,"viewsbyId",E,"options",y];b.useEffect(()=>{async function E(){const L=await d.get(g(s)),k=C(L,["json",...g(s),"dependencies"]).find(T=>T.type==="disaster_declarations_summaries_v2");if(!k)return;m(k.view_id);const $=await d.get([...j(k.view_id),"length"]),I=C($,["json",...j(k.view_id),"length"],0);await d.chunk([...j(k.view_id),"databyIndex",{from:0,to:I-1},x])}E()},[d,s,r,oe]);const N=b.useMemo(()=>[...l?[{key:void 0,label:"All Disasters"}]:[],...Object.values(C(u,[...j(p),"databyIndex"],{})).filter(E=>typeof E["distinct disaster_number as disaster_number"]!="object").map(E=>({key:E["distinct disaster_number as disaster_number"],label:`${E.declaration_title} (${E["distinct disaster_number as disaster_number"]})`}))],[u,s,r,p,oe]);b.useEffect(()=>{f(N.filter(E=>n&&E.key===n))},[N,n]);const _=()=>e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-search font-light text-xl bg-white pr-2 pt-1 rounded-r-md"}),e.jsx(Yo,{className:"w-full",isLoading:!1,onSearch:z9,minLength:0,id:"geography-search",placeholder:"Search for a FEMA Disaster...",options:N,labelKey:E=>`${E==null?void 0:E.label}`,defaultSelected:h,onChange:E=>U9(E,f,s,N,c,a),selected:h,inputProps:{className:"bg-white w-full p-1 pl-3 rounded-l-md"},renderMenu:W9},"geography-search")]});return i?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"FEMA Disaster:"}),e.jsx("div",{className:`flex flex row ${t} w-full shrink my-1`,children:e.jsx(_,{})})]}):e.jsx("div",{className:`flex w-full ${t}`,children:e.jsx(_,{})})};async function B0({geoid:t,disasterNumber:s,ealViewId:n},r){const a=f=>["dama",oe,"viewDependencySubgraphs","byViewId",f],l=await r.get(a(n)),c=C(l,["json",...a(n),"dependencies"]).find(f=>f.type==="disaster_declarations_summaries_v2"),d=c.view_id,u=f=>["dama",oe,"viewsbyId",f,"options",m,"databyIndex"],p=["disaster_number","declaration_title","incident_begin_date","incident_end_date","incident_type","ARRAY_AGG(distinct fips_state_code || fips_county_code) as geoid"],m=JSON.stringify({filter:{disaster_number:[s]},groupBy:[1,2,3,4,5]}),h=await r.get([...u(c.view_id),{from:0,to:0},p],["dama",oe,"views","byId",c.view_id,"attributes",["source_id","view_id","version"]]);return{ealViewId:n,geoid:t,disasterNumber:s,disasterDecView:d,title:C(h,["json",...u(d),0,"declaration_title"]),incidentType:C(h,["json",...u(d),0,"incident_type"]),declarationDate:C(h,["json",...u(d),0,"incident_begin_date"],""),endDate:C(h,["json",...u(d),0,"incident_end_date"],""),attributionData:C(h,["json","dama",oe,"views","byId",d,"attributes"],{})}}const A0=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=b.useMemo(()=>t&&tt(t)?JSON.parse(t):{},[t]);const l="/",i=343,[c,d]=b.useState((a==null?void 0:a.ealViewId)||837),[u,p]=b.useState(a==null?void 0:a.disasterNumber),[m,h]=b.useState(!0),[f,g]=b.useState(void 0),[x,y]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36");return b.useEffect(()=>{async function j(){if(console.log("got to load",c,x,u),!x||!u)return g("Please Select a Geography and a Disaster."),Promise.resolve();g(void 0),console.log(),h(!0),g(void 0);let N=await B0({ealViewId:c,geoid:x,disasterNumber:u},n);N.title&&s(JSON.stringify(N)),h(!1)}j()},[x,c,u]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:i,view_id:c,onChange:d,className:"flex-row-reverse"}),e.jsx(rt,{value:x,onChange:y,className:"flex-row-reverse"}),e.jsx(Jn,{view_id:c,value:u,geoid:x,onChange:p,className:"flex-row-reverse"})]}),m?e.jsx(dt,{}):f?e.jsx("div",{className:"p-5 text-center",children:f}):e.jsx(M0,{title:a==null?void 0:a.title,incidentType:a==null?void 0:a.incidentType,declarationDate:a==null?void 0:a.declarationDate,endDate:a==null?void 0:a.endDate,attributionData:a==null?void 0:a.attributionData,disasterNumber:a==null?void 0:a.disasterNumber,baseUrl:l})]})})};A0.settings={hasControls:!0,name:"ElementEdit"};const G9=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(M0,{...s,baseUrl:"/"})})},J9={name:"Card: FEMA Disaster Info",type:"Hero Stats",variables:[{name:"geoid",default:"36"},{name:"disasterNumber",default:"1406"},{name:"ealViewId",default:837,hidden:!0}],getData:B0,EditComp:A0,ViewComp:G9},bs="w-full h-[90px] bg-white p-1 text-center flex flex-col",ys="border-b-2",vs="font-medium text-xl pt-2",q9=({totalLoss:t,ihpLoss:s,paLoss:n,sbaLoss:r,nfipLoss:a,usdaLoss:l})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"Total Loss"}),e.jsx("span",{className:vs,children:Qe(t,2,!0)})]}),e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"IHP Loss"}),e.jsx("span",{className:vs,children:Qe(s,2,!0)})]}),e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"PA Loss"}),e.jsx("span",{className:vs,children:Qe(n,2,!0)})]}),e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"SBA Loss"}),e.jsx("span",{className:vs,children:Qe(r,2,!0)})]}),e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"NFIP Loss"}),e.jsx("span",{className:vs,children:Qe(a,2,!0)})]}),e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"USDA Loss"}),e.jsx("span",{className:vs,children:Qe(l,2,!0)})]})]}),K9=({totalFunding:t,ihpFunding:s,paFunding:n,sbaFunding:r,hmgpFunding:a})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"Total Funding"}),e.jsx("span",{className:vs,children:Qe(t,2,!0)})]}),e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"IHP Funding"}),e.jsx("span",{className:vs,children:Qe(s,2,!0)})]}),e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"PA Funding"}),e.jsx("span",{className:vs,children:Qe(n,2,!0)})]}),e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"SBA Funding"}),e.jsx("span",{className:vs,children:Qe(r,2,!0)})]}),e.jsxs("div",{className:bs,children:[e.jsx("label",{className:ys,children:"HMGP Funding"}),e.jsx("span",{className:vs,children:Qe(a,2,!0)})]})]}),O0=({type:t,totalLoss:s,ihpLoss:n,paLoss:r,sbaLoss:a,nfipLoss:l,usdaLoss:i,totalFunding:c,ihpFunding:d,paFunding:u,sbaFunding:p,hmgpFunding:m,attributionData:h,baseUrl:f})=>{const g={loss:6,funding:5};return e.jsxs(w.Fragment,{children:[e.jsx("div",{className:`w-full grid grid-cols-${g[t]} gap-4 place-content-stretch mt-5`,children:t==="loss"?e.jsx(q9,{totalLoss:s,ihpLoss:n,paLoss:r,sbaLoss:a,nfipLoss:l,usdaLoss:i}):e.jsx(K9,{totalFunding:c,ihpFunding:d,paFunding:u,sbaFunding:p,hmgpFunding:m})}),e.jsx(ct,{baseUrl:f,attributionData:h})]})};async function P0({ealViewId:t,geoid:s,disasterNumber:n,type:r},a){var J,ae,de,ue,fe,ve,se,me,xe,re;const l=Q=>["dama",oe,"viewDependencySubgraphs","byViewId",Q],i=await a.get(l(t)),c=C(i,["json",...l(t),"dependencies"]),d=c.find(Q=>Q.type==="disaster_loss_summary").view_id,u=512,p=c.find(Q=>Q.type==="individuals_and_households_program_valid_registrations_v1").view_id,m=c.find(Q=>Q.type==="public_assistance_funded_projects_details_v1_enhanced").view_id,h=c.find(Q=>Q.type==="sba_disaster_loan_data_new").view_id,f=798,g=((J=s==null?void 0:s.toString())==null?void 0:J.length)===2?"substring(geoid, 1, 2)":((ae=s==null?void 0:s.toString())==null?void 0:ae.length)===5?"geoid":"'all'",x={geoid:`${g} as geoid`,ihp_loss:"sum(ihp_loss) as ihp_loss",pa_loss:"sum(pa_loss) as pa_loss",sba_loss:"sum(sba_loss) as sba_loss",nfip_loss:"sum(nfip_loss) as nfip_loss",fema_crop_damage:"sum(fema_crop_damage) as fema_crop_damage"},y=JSON.stringify({filter:{...s&&{[g]:[s]},...n&&{disaster_number:[n]}},exclude:{fema_incident_begin_date:["null"]},groupBy:[1]}),j=Q=>["dama",oe,"viewsbyId",Q,"options",y],N={ihp_loss:"total_amount_ihp_approved as ihp_loss",pa_loss:"total_obligated_amount_pa as pa_loss"},_=JSON.stringify({filter:{...n&&{disaster_number:[n]}}}),E=Q=>["dama",oe,"viewsbyId",Q,"options",_],L=((de=s==null?void 0:s.toString())==null?void 0:de.length)===2?"substring(geoid, 1, 2)":((ue=s==null?void 0:s.toString())==null?void 0:ue.length)===5?"geoid":"'all'",S={ihp_funding:"SUM(ihp_amount) as ihp_amount"},k=JSON.stringify({filter:{...s&&{[L]:[s]},...n&&{disaster_number:[n]}}}),$=["dama",oe,"viewsbyId",p,"options",k],I=((fe=s==null?void 0:s.toString())==null?void 0:fe.length)===2?"lpad(state_number_code::text, 2, '0')":((ve=s==null?void 0:s.toString())==null?void 0:ve.length)===5?"lpad(state_number_code::text, 2, '0') || lpad(county_code::text, 3, '0')":"'all'",T={pa_funding:"SUM(total_obligated) as total_obligated"},A=JSON.stringify({filter:{...s&&{[I]:[s]},...n&&{disaster_number:[n]}}}),R=["dama",oe,"viewsbyId",m,"options",A],O=((se=s==null?void 0:s.toString())==null?void 0:se.length)===2?"substring(geoid, 1, 2)":((me=s==null?void 0:s.toString())==null?void 0:me.length)===5?"geoid":"'all'",M={sba_funding:"SUM(total_approved_loan_amount) as total_approved_loan_amount"},D=JSON.stringify({filter:{...s&&{[O]:[s]},...n&&{fema_disaster_number:[n]}}}),P=["dama",oe,"viewsbyId",h,"options",D],F=((xe=s==null?void 0:s.toString())==null?void 0:xe.length)===2?"state_number_code":((re=s==null?void 0:s.toString())==null?void 0:re.length)===5?"state_number_code || county_code":"'all'",B={hmgp_funding:"SUM(federal_share_obligated) as hmgp_funding"},V=JSON.stringify({filter:{...s&&{[F]:[s]},...n&&{disaster_number:[n]}}}),G=["dama",oe,"viewsbyId",f,"options",V],Z=r==="loss"?[[...j(d),"databyIndex",{from:0,to:0},Object.values(x)],[...E(u),"databyIndex",{from:0,to:0},Object.values(N)],["dama",oe,"views","byId",[d],"attributes",["source_id","view_id","version","_modified_timestamp"]]]:[[...$,"databyIndex",{from:0,to:0},Object.values(S)],[...R,"databyIndex",{from:0,to:0},Object.values(T)],[...P,"databyIndex",{from:0,to:0},Object.values(M)],[...G,"databyIndex",{from:0,to:0},Object.values(B)],["dama",oe,"views","byId",[p,m,h,f],"attributes",["source_id","view_id","version","_modified_timestamp"]]],X=await a.get(...Z),H=C(X,["json",...j(d),"databyIndex",0,x.ihp_loss],0),z=C(X,["json",...j(d),"databyIndex",0,x.pa_loss],0),W=C(X,["json",...j(d),"databyIndex",0,x.sba_loss],0),Y=C(X,["json",...j(d),"databyIndex",0,x.nfip_loss],0),U=C(X,["json",...j(d),"databyIndex",0,x.fema_crop_damage],0),q=C(X,["json",...$,"databyIndex",0,S.ihp_funding],0),te=C(X,["json",...R,"databyIndex",0,T.pa_funding],0),K=C(X,["json",...P,"databyIndex",0,M.sba_funding],0),ne=C(X,["json",...G,"databyIndex",0,B.hmgp_funding],0);return{type:r,ealViewId:t,disasterNumber:n,geoid:s,disasterLossView:d,ihpLoss:H,paLoss:z,sbaLoss:W,nfipLoss:Y,usdaLoss:U,ihpFunding:q,paFunding:te,sbaFunding:K,hmgpFunding:ne,totalLoss:+H+ +z+ +W+ +Y+ +U,totalFunding:+q+ +te+ +K+ +ne,attributionData:(r==="loss"?[d]:[p,m,h,f]).map(Q=>C(X,["json","dama",oe,"views","byId",Q,"attributes"],{}))}}const D0=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l=343,[i,c]=b.useState((a==null?void 0:a.ealViewId)||837),[d,u]=b.useState(a==null?void 0:a.disasterNumber),[p,m]=b.useState(!0),[h,f]=b.useState(a==null?void 0:a.status),[g,x]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[y,j]=b.useState((a==null?void 0:a.type)||"loss");return b.useEffect(()=>{async function N(){if(!g||!d)return f("Please Select a Geography && disasterNumber."),Promise.resolve();f(void 0),m(!0),f(void 0);const _=await P0({geoid:g,disasterNumber:d,ealViewId:i,type:y},n);_&&s(JSON.stringify(_)),m(!1)}N()},[g,i,d,y]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:l,view_id:i,onChange:c,className:"flex-row-reverse"}),e.jsx(rt,{value:g,onChange:x,className:"flex-row-reverse"}),e.jsx(Jn,{view_id:i,value:d,geoid:g,onChange:u,showAll:!0,className:"flex-row-reverse"}),e.jsx(ze,{type:y,setType:j,label:"Type:",types:[{value:"loss",label:"Assessed Loss"},{value:"funding",label:"FEMA Obligated Funding"}]})]}),p?e.jsx(dt,{}):h?e.jsx("div",{className:"p-5 text-center",children:h}):e.jsx(O0,{type:a.type,totalLoss:a.totalLoss,ihpLoss:a.ihpLoss,paLoss:a.paLoss,sbaLoss:a.sbaLoss,nfipLoss:a.nfipLoss,usdaLoss:a.usdaLoss,totalFunding:a.totalFunding,ihpFunding:a.ihpFunding,paFunding:a.paFunding,sbaFunding:a.sbaFunding,hmgpFunding:a.hmgpFunding,attributionData:a.attributionData,baseUrl:a.baseUrl})]})})};D0.settings={hasControls:!0,name:"ElementEdit"};const Y9=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(O0,{...s,baseUrl:"/"})})},Z9={name:"Card: FEMA Disaster Loss Summary",type:"Hero Stats",variables:[{name:"geoid",default:"36"},{name:"disasterNumber",default:"1406"},{name:"ealViewId",default:837,hidden:!0},{name:"type",default:"loss",hidden:!0}],getData:P0,EditComp:D0,ViewComp:Y9},It={ihp:{type:"individuals_and_households_program_valid_registrations_v1",attributes:({geoid:t})=>{var s,n;return{[((s=t==null?void 0:t.toString())==null?void 0:s.length)===5?"Damaged City":"County"]:((n=t==null?void 0:t.toString())==null?void 0:n.length)===5?"damaged_city":"county","# Claims":"count(1) as num_claims","Assessed Building Damage":"sum(rpfvl) as rpfvl","Assessed Contents Damage":"sum(ppfvl) as ppfvl","Housing Assistance":"sum(ha_amount) as ha_amount","Total Amount":"sum(ihp_amount) as ihp_amount","Other Needs Assistance":"sum(ona_amount) as ona_amount"}},options:({disasterNumber:t,geoid:s})=>{var n,r;return{aggregatedLen:!0,filter:{...t&&{disaster_number:[t]},...s&&{[`substring(geoid, 1, ${(n=s==null?void 0:s.toString())==null?void 0:n.length})`]:[s]}},groupBy:[((r=s==null?void 0:s.toString())==null?void 0:r.length)===5?"damaged_city":"county"]}},textCols:["County","Damaged City"],numCols:["# Claims"],anchorCols:["County","Damaged City"]},pa:{type:"public_assistance_funded_projects_details_v1",attributes:({disasterNumber:t})=>({...!t&&{"Disaster Number":"disaster_number"},County:"county","Damage Category":"damage_category","# Projects":"count(1) as num_projects","Project Amount":"sum(project_amount) as project_amount","Federal Share Obligated":"sum(federal_share_obligated) as federal_share_obligated","Total Obligated":"sum(total_obligated) as total_obligated"}),options:({disasterNumber:t,geoid:s})=>{var n;return{aggregatedLen:!0,filter:{...t&&{disaster_number:[t]},...s&&{[`substring(lpad(state_number_code::text, 2, '0') || lpad(county_code::text, 3, '0'), 1, ${(n=s==null?void 0:s.toString())==null?void 0:n.length})`]:[s]}},exclude:{dcc:["A","B","Z"]},groupBy:t?["county","damage_category"]:["disaster_number","county","damage_category"]}},textCols:["Disaster Number","County","Damage Category"],numCols:["# Projects"],anchorCols:["County"]},sba:{type:"sba_disaster_loan_data_new",attributes:({geoid:t,disasterNumber:s})=>{var n,r;return{...!s&&{"Disaster Number":"fema_disaster_number"},[((n=t==null?void 0:t.toString())==null?void 0:n.length)===5?"City":"County / Parish"]:((r=t==null?void 0:t.toString())==null?void 0:r.length)===5?"damaged_property_city_name":"damaged_property_county_or_parish_name","# Loans":"count(1) as num_loans","Verified Loss":"sum(total_verified_loss) as total_verified_loss","Verified Loss Real Estate":"sum(verified_loss_real_estate) as verified_loss_real_estate","Verified Loss Content":"sum(verified_loss_content) as verified_loss_content","Loan Approved Total":"sum(total_approved_loan_amount) as total_approved_loan_amount","Loan Approved Real Estate":"sum(approved_amount_real_estate) as approved_amount_real_estate","Loan Approved Content":"sum(approved_amount_content) as approved_amount_content","Loan approved Economic Injury (EIDL)":"sum(approved_amount_eidl) as approved_amount_eidl"}},options:({disasterNumber:t,geoid:s})=>{var n,r;return{aggregatedLen:!0,filter:{...t&&{fema_disaster_number:[t]},...s&&{[`substring(geoid, 1, ${(n=s==null?void 0:s.toString())==null?void 0:n.length})`]:[s]}},groupBy:[...t?[]:["fema_disaster_number"],((r=s==null?void 0:s.toString())==null?void 0:r.length)===5?"damaged_property_city_name":"damaged_property_county_or_parish_name"]}},textCols:["Disaster Number","City","County / Parish"],numCols:["# Loans"],anchorCols:["City","County / Parish"]},nfip:{type:"fima_nfip_claims_v1_enhanced",mapGeoidToName:!0,attributes:({disasterNumber:t})=>({...!t&&{"Disaster Number":"disaster_number"},County:"geoid","# Claims":"count(1) as num_claims","Amount Paid on Building Claim":"sum(amount_paid_on_building_claim) as amount_paid_on_building_claim","Amount Paid on Contents Claim":"sum(amount_paid_on_contents_claim) as amount_paid_on_contents_claim","Amount Paid on Increased Cost of Compliance":"sum(amount_paid_on_increased_cost_of_compliance_claim) as amount_paid_on_increased_cost_of_compliance_claim","Total Amount Paid":"sum(total_amount_paid) as total_amount_paid"}),options:({disasterNumber:t,geoid:s})=>{var n;return{aggregatedLen:!0,filter:{...t&&{disaster_number:[t]},...s&&{[`substring(geoid, 1, ${(n=s==null?void 0:s.toString())==null?void 0:n.length})`]:[s]}},groupBy:t?["geoid"]:["disaster_number","geoid"]}},textCols:["Disaster Number","County"],numCols:["# Claims"],anchorCols:["County"]},usda:{type:"usda_crop_insurance_cause_of_loss_enhanced",attributes:({disasterNumber:t})=>({...!t&&{"Disaster Number":"disaster_number"},County:"county_name","# Claims":"count(1) as num_claims","Commodity Name":"ARRAY_AGG(distinct commodity_name order by commodity_name) as commodity_names","Acres Planted":"sum(net_planted_acres) as net_planted_acres","Acres Lost":"sum(net_determined_acres) as net_determined_acres","Crop Value Lost":"sum(indemnity_amount) as indemnity_amount"}),options:({disasterNumber:t,geoid:s})=>{var n;return{aggregatedLen:!0,filter:{...t&&{disaster_number:[t]},...s&&{[`substring(geoid, 1, ${(n=s==null?void 0:s.toString())==null?void 0:n.length})`]:[s]}},groupBy:t?["county_name"]:["disaster_number","county_name"]}},textCols:["Disaster Number","County","Commodity Name"],numCols:["# Claims"],anchorCols:["County"]},"hmgp projects":{type:"hazard_mitigation_assistance_projects_v3",mapGeoidToName:!0,geoidCol:"LPAD(state_number_code, 2, '0') || LPAD(county_code, 3, '0') as geoid",attributes:()=>({"Disaster Number":"disaster_number",County:"LPAD(state_number_code, 2, '0') || LPAD(county_code, 3, '0') as geoid","Project Type":"array_to_string(array_agg(distinct project_type), ', ') as project_type",Status:"array_to_string(array_agg(distinct status), ', ') as status","# Final Properties":"sum(number_of_final_properties) as num_final_properties","Benefit Cost Ratio":"sum(benefit_cost_ratio) as benefit_cost_ratio","Project Amount":"sum(project_amount) as project_amount","Federal Share Obligated":"sum(federal_share_obligated) as federal_share_obligated","Net Value Benefits":"sum(net_value_benefits) as net_value_benefits"}),options:({disasterNumber:t,geoid:s})=>{var n;return{aggregatedLen:!0,filter:{...t&&{disaster_number:[t]},...s&&{[`substring(LPAD(state_number_code, 2, '0') || LPAD(county_code, 3, '0'), 1, ${(n=s==null?void 0:s.toString())==null?void 0:n.length})`]:[s]}},groupBy:["disaster_number","state_number_code","county_code"]}},textCols:["Disaster Number","County","Project Type","Recipients","Status"],numCols:["# Final Properties","Benefit Cost Ratio"],anchorCols:[]}},X9=({cell:t,textCols:s=[],isDollar:n=!1})=>{var a,l,i;let r=((l=(a=t==null?void 0:t.value)==null?void 0:a.value)==null?void 0:l.join(", "))||t.value||0;return s.includes((i=t==null?void 0:t.column)==null?void 0:i.Header)?r:us(r,n)},Q9=(t,s,n)=>{var r,a;return e.jsx("div",{children:X9({cell:t,textCols:((r=It==null?void 0:It[s])==null?void 0:r.textCols)||[],isDollar:!(((a=It==null?void 0:It[s])==null?void 0:a.numCols)||[]).includes(n)})})},R0=t=>typeof(t==null?void 0:t.value)=="object"?R0(t.value):(t==null?void 0:t.value)||t,F0=({geoid:t,data:s=[],columns:n=[],pageSize:r,sortBy:a={},filterValue:l={},striped:i,attributionData:c,baseUrl:d,type:u})=>{var h,f;const p=(h=n.find(g=>{var x;return g.Header===((x=Object.keys(a))==null?void 0:x[0])}))==null?void 0:h.accessor,m=s.filter(g=>!Object.keys(l||{}).length||Object.keys(l).reduce((x,y)=>{var _,E;const j=(_=It[u])==null?void 0:_.attributes(t)[y],N=R0(g[j]);return x&&(N==null?void 0:N.toString().toLowerCase().includes((E=l[y])==null?void 0:E.toLowerCase()))},!0));return e.jsxs("div",{className:"py-5 flex flex-col",children:[(s==null?void 0:s.length)>0&&(n==null?void 0:n.length)>0&&e.jsx(St,{columns:n.map(g=>({...g,Cell:x=>Q9(x,u,g.Header)})),data:m,initialPageSize:r,pageSize:r,striped:i,sortBy:p,sortOrder:((f=Object.values(a))==null?void 0:f[0])||"asc"}),e.jsx(ct,{baseUrl:d,attributionData:c})]})};async function V0({disasterNumber:t,geoid:s,ealViewId:n,type:r,visibleCols:a,filters:l},i){var O,M,D,P;const c=F=>["dama",oe,"viewDependencySubgraphs","byViewId",F],d=["dama",oe,"views","byId",n,"attributes",["source_id","view_id","version","_modified_timestamp"]],u=JSON.stringify({...s&&{filter:{[`substring(geoid, 1, ${(O=s==null?void 0:s.toString())==null?void 0:O.length})`]:[s]}}}),p=F=>["dama",oe,"viewsbyId",F,"options",u],m=JSON.stringify((M=It[r])==null?void 0:M.options({disasterNumber:t,geoid:s})),h=F=>["dama",oe,"viewsbyId",F,"options"],f=await i.get(c(n)),g=C(f,["json",...c(n),"dependencies"]),x=g==null?void 0:g.find(F=>F.type==="tl_county");if(!x)return{};const y=await i.get([...p(x.view_id),"length"]),j=C(y,["json",...p(x.view_id),"length"],0);j&&await i.get([...p(x.view_id),"databyIndex",{from:0,to:j-1},["geoid","namelsad"]]);const N={"hmgp summaries":725,"hmgp projects":798,"hmgp properties":729},_=N[r]?{view_id:N[r]}:g.find(F=>{var B;return F.type===((B=It[r])==null?void 0:B.type)});if(!_)return{};const E=await i.get([...h(_.view_id),m,"length"]),L=Math.min(C(E,["json",...h(_.view_id),m,"length"],0),100),S={from:0,to:L-1};if(!L)return{};await i.get([...h(_.view_id),m,"databyIndex",S,Object.values((D=It[r])==null?void 0:D.attributes({geoid:s,disasterNumber:t}))],d);const k=i.getCache(),$=C(k,["dama",oe,"views","byId",n,"attributes"],{}),I=Object.values(C(k,[...p(x.view_id),"databyIndex"],{})),T=F=>(F.map(B=>{var Z;const V=It[r].geoidCol||"geoid",G=(Z=I==null?void 0:I.find(X=>X.geoid===B[V]))==null?void 0:Z.namelsad;B[V]=G||B[V]}),F);let A=Object.values(C(k,[...h(_.view_id),m,"databyIndex"],{}));(P=It[r])!=null&&P.mapGeoidToName&&T&&T(A);const R=a.map((F,B)=>{var G,Z,X;const V=(G=It[r])==null?void 0:G.attributes({geoid:s,disasterNumber:t})[F];return{Header:F,accessor:V,align:(X=(Z=It[r])==null?void 0:Z.textCols)!=null&&X.includes(F)?"left":"right",filter:l[F]}});return{typeId:_.view_id,countyView:x.view_id,disasterNumber:t,geoid:s,ealViewId:n,type:r,visibleCols:a,filters:l,data:A,columns:R,attributionData:$}}const H0=({value:t,onChange:s})=>{var P,F,B;const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",i=343,[c,d]=b.useState((a==null?void 0:a.ealViewId)||837),[u,p]=b.useState(a==null?void 0:a.disasterNumber),[m,h]=b.useState(!0),[f,g]=b.useState(a==null?void 0:a.status),[x,y]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[j,N]=b.useState((a==null?void 0:a.type)||"ihp"),[_,E]=b.useState((a==null?void 0:a.filters)||{}),[L,S]=b.useState((a==null?void 0:a.filterValue)||{}),[k,$]=b.useState((a==null?void 0:a.visibleCols)||[]),[I,T]=b.useState((a==null?void 0:a.pageSize)||5),[A,R]=b.useState((a==null?void 0:a.sortBy)||{});b.useEffect(()=>{async function V(){var Z;if(!x||!j)return!x&&g("Please Select a Geography."),!j&&g("Please Select a Type."),h(!1),Promise.resolve();g(void 0),h(!0),g(void 0),E({..._,[Object.keys(((Z=It[j])==null?void 0:Z.attributes({geoid:x,disasterNumber:u}))||{})[0]]:"text"});const G=await V0({disasterNumber:u,geoid:x,ealViewId:c,type:j,visibleCols:k,filters:_},n);s(JSON.stringify({...G})),h(!1)}V()},[x,c,u,j,k]);const O=(a==null?void 0:a.data)||[],M=a==null?void 0:a.attributionData,D=a==null?void 0:a.columns;return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 text-sm",children:["Edit Controls",e.jsx(Ct,{source_id:i,view_id:c,onChange:d,className:"flex-row-reverse"}),e.jsx(rt,{value:x,onChange:y,className:"flex-row-reverse"}),e.jsx(Jn,{view_id:c,value:u,geoid:x,onChange:p,showAll:!0,className:"flex-row-reverse"}),e.jsx(ze,{label:"Type:",types:Object.keys(It),type:j,setType:V=>{N(V),$([]),E({})}}),e.jsx(Ls,{cols:Object.keys(((P=It[j])==null?void 0:P.attributes({geoid:x,disasterNumber:u}))||{}),anchorCols:(B=(F=It[j])==null?void 0:F.anchorCols)==null?void 0:B.filter(V=>{var G;return Object.keys(((G=It[j])==null?void 0:G.attributes({geoid:x,disasterNumber:u}))||{}).includes(V)}),visibleCols:k,setVisibleCols:$,filters:_,setFilters:E,filterValue:L,setFilterValue:S,pageSize:I,setPageSize:T,sortBy:A,setSortBy:R})]}),m?e.jsx(dt,{}):f?e.jsx("div",{className:"p-5 text-center",children:f}):e.jsx(F0,{geoid:x,data:O,columns:D,pageSize:I,sortBy:A,filterValue:L,title:j,type:j,attributionData:M,baseUrl:l})]})})};H0.settings={hasControls:!0,name:"ElementEdit"};const e$=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(F0,{...s,baseUrl:"/"})})},t$={name:"Table: FEMA Disaster Loss by Program",type:"Table",variables:[{name:"ealViewId",default:837,hidden:!0},{name:"geoid",default:"36"},{name:"disasterNumber",default:"4625"},{name:"type",default:"ihp"},{name:"visibleCols",default:[]},{name:"filters",default:{}}],getData:V0,EditComp:H0,ViewComp:e$},Kt={total_losses:{title:"Total Losses",type:"disaster_loss_summary",columns:{"IHP Loss":"ihp_loss","PA Loss":"pa_loss","SBA Loss":"sba_loss","NFIP Loss":"nfip_loss","USDA Loss":"fema_crop_damage"},paintFn:t=>t&&+t.ihp_loss+ +t.pa_loss+ +t.sba_loss+ +t.nfip_loss+ +t.fema_crop_damage},ihp:{title:"IHP Losses",type:"individuals_and_households_program_valid_registrations_v1",columns:["rpfvl","ppfvl"],paintFn:t=>t&&t.rpfvl+t.ppfvl},pa:{title:"Project Amount",type:"public_assistance_funded_projects_details_v1",geoColumn:"lpad(state_number_code::text, 2, '0') || lpad(county_code::text, 3, '0')",columns:{"Project Amount":"project_amount"}},sba:{title:"SBA Verified Loss",type:"sba_disaster_loan_data_new",disasterNumberColumn:"fema_disaster_number",columns:{"Total Verified Loss":"total_verified_loss"}},nfip:{title:"NFIP Amount Paid",type:"fima_nfip_claims_v1_enhanced",mapGeoidToName:!0,columns:{"Total Amount Paid":"total_amount_paid"}},usda:{title:"USDA Indemnity Amount",type:"usda_crop_insurance_cause_of_loss_enhanced",columns:{"Indemnity Amount":"indemnity_amount"}},declared:{title:"",type:"disaster_declarations_summaries_v2",geoColumn:"fips_state_code || fips_county_code",columns:{},paintFn:t=>t.geoid?1:0,legend:!1,colors:["#fba819"]}},cl=({numColors:t=9,setNumColors:s,shade:n,setShade:r,colors:a,setColors:l,title:i})=>{const[c,d]=b.useState(!1),u=[...$t.schemeGroups.sequential,...$t.schemeGroups.diverging,...$t.schemeGroups.singlehue];return e.jsxs("div",{className:"p-2 pl-0 my-1 w-full flex flex-row place-middle",children:[e.jsx("div",{className:"self-top flex flex-row flex-wrap w-1/4",children:i&&e.jsx("span",{className:"self-center pt-1",children:i})}),e.jsxs("div",{className:"flex flex-row flex-wrap space-between w-3/4",children:[s&&e.jsxs("div",{className:"self-center py-1 rounded-l-lg",children:[e.jsx("label",{className:"pl-1 pr-5 text-sm",children:"# Shades:"}),e.jsx("input",{type:"number",min:1,max:9,value:t,onChange:p=>{p.stopPropagation(),s(p.target.value)},className:"self-center px-1 bg-white rounded-lg"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{onClick:()=>d(!c),className:"flex flex-col self-center rounded-r-lg",children:e.jsx("div",{className:"block flex flex-row p-2",children:a.map(p=>e.jsx("div",{className:"h-[20px] w-[20px]",style:{backgroundColor:p}},p))})}),e.jsx("div",{className:`max-h-36 overflow-auto ${c?"block mt-[40px] absolute bg-white shadow-lg rounded-lg z-20":"hidden"}`,children:u.map(p=>e.jsx("div",{className:"flex flex-row p-2",onClick:()=>{r(p),l(ds(Math.max(t,3),p,!1).slice(0,+t)),d(!1)},children:ds(Math.max(t,3),p,!1).slice(0,+t).map(m=>e.jsx("div",{className:"h-[20px] w-[20px]",style:{backgroundColor:m}},m))},p))})]})]})]})},no={};for(const t in $t.schemeGroups)$t.schemeGroups[t].forEach(s=>{const n=$t[s];for(const r in n)r in no||(no[r]=[]),no[r].push({type:`${t[0].toUpperCase()}${t.slice(1)}`,name:s,category:"Colorbrewer",colors:n[r]})});const Js=(t,s)=>C(no,[t],[]).reduce((n,r)=>r.name===s?r.colors:n,[]).slice();function s$(t){return t.slice().sort(function(s,n){return s-n})}function n$(t){for(var s=0,n,r=0;r<t.length;r++)(r===0||t[r]!==n)&&(n=t[r],s++);return s}function Xu(t,s){for(var n=[],r=0;r<t;r++){for(var a=[],l=0;l<s;l++)a.push(0);n.push(a)}return n}function Ri(t,s,n,r){var a;if(t>0){var l=(n[s]-n[t-1])/(s-t+1);a=r[s]-r[t-1]-(s-t+1)*l*l}else a=r[s]-n[s]*n[s]/(s+1);return a<0?0:a}function Fi(t,s,n,r,a,l,i){if(!(t>s)){var c=Math.floor((t+s)/2);r[n][c]=r[n-1][c-1],a[n][c]=c;var d=n;t>n&&(d=Math.max(d,a[n][t-1]||0)),d=Math.max(d,a[n-1][c]||0);var u=c-1;s<r[0].length-1&&(u=Math.min(u,a[n][s+1]||0));for(var p,m,h,f,g=u;g>=d&&(p=Ri(g,c,l,i),!(p+r[n-1][d-1]>=r[n][c]));--g)m=Ri(d,c,l,i),h=m+r[n-1][d-1],h<r[n][c]&&(r[n][c]=h,a[n][c]=d),d++,f=p+r[n-1][g-1],f<r[n][c]&&(r[n][c]=f,a[n][c]=g);Fi(t,c-1,n,r,a,l,i),Fi(c+1,s,n,r,a,l,i)}}function a$(t,s,n){for(var r=s[0].length,a=new Array(r),l=new Array(r),i=t[Math.floor(r/2)],c=0;c<r;++c)c===0?(a[0]=t[0]-i,l[0]=(t[0]-i)*(t[0]-i)):(a[c]=a[c-1]+t[c]-i,l[c]=l[c-1]+(t[c]-i)*(t[c]-i)),s[0][c]=Ri(0,c,a,l),n[0][c]=0;for(var d,u=1;u<s.length;++u)u<s.length-1?d=u:d=r-1,Fi(d,r-1,u,s,n,a,l)}function dl(t,s){if(s>t.length)throw new Error("Cannot generate more classes than there are data values");var n=t.length,r=s$(t),a=n$(r);if(a===1)return[r[0]];s=Math.min(a,s);var l=Xu(s,n),i=Xu(s,n);a$(r,l,i);for(var c=[],d=i[0].length-1,u=i.length-1;u>=0;u--){var p=i[u][d];c[u]=r[p],u>0&&(d=p-1)}return c}const r$=t=>{const s=t&&t.current;return s?s.getBoundingClientRect():{width:0,height:0}},o$=(t,s)=>{const[n,r]=w.useState({width:0,height:0,x:0,y:0}),a=w.useCallback(()=>{const l=r$(t),{width:i,height:c,x:d,y:u}=l;(i!==n.width||c!==n.height)&&(typeof s=="function"&&s({width:i,height:c,x:d,y:u}),r({width:i,height:c,x:d,y:u}))},[t,n,s]);return w.useEffect(()=>(window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}),[a]),w.useEffect(()=>{a()}),n},Ao=t=>t==null||typeof t=="string"&&!t.length?!1:Array.isArray(t)?t.reduce((s,n)=>s||Ao(n),!1):typeof t=="number"&&isNaN(t)?!1:typeof t=="object"?Object.values(t).reduce((s,n)=>s||Ao(n),!1):!0,l$=({onClick:t,cursor:s="cursor-pointer",className:n="",style:r={},children:a})=>e.jsx("div",{onClick:t,className:`
        ${s} ${n} transition h-6 w-6
        hover:text-blue-500 flex items-center justify-center
      `,style:{...r},children:a}),i$=(t,{width:s,height:n})=>{const{x:l,y:i}=t,c=n,d=`max(
      10px,
      min(calc(${i}px - 50%), calc(${c-10}px - 100%))
    )`;return l<s*.5?`translate(
      ${l+30}px,
      ${d}
    )`:`translate(
    calc(-100% + ${l-30}px),
    ${d}
  )`},c$=({x:t,y:s},n)=>{const a=`calc(${s}px - 50%)`;return n==="right"?`translate(
      ${t+30}px,
      ${a}
    )`:`translate(
    calc(-100% + ${t-30}px),
    ${a}
  )`},d$=({x:t},s)=>s==="right"?"translate(-50%, -50%) rotate(45deg) skew(-15deg, -15deg)":"translate(50%, -50%) rotate(45deg) skew(-15deg, -15deg)",u$=({orientation:t,children:s})=>e.jsx("div",{style:{transform:t==="left"?"translate(-0.75rem, -0.75rem)":"translate(0.75rem, -0.75rem)"},className:`
        bg-white
        rounded absolute inline-block top-0 z-20
        ${t==="left"?"left-0":"right-0"}
      `,children:s}),m$=({children:t,remove:s,id:n,project:r,lngLat:a,width:l})=>{const i=r(a),c=w.useRef(i.x<l*.5?"right":"left"),d=w.useMemo(()=>({top:"50%",transform:d$(i,c.current)}),[i]);return e.jsxs("div",{className:`
        absolute top-0 left-0 z-20 inline-block
        rounded whitespace-nowrap hover-comp
        pointer-events-auto
        bg-white
        grid grid-cols-1 gap-1
      `,style:{transform:c$(i,c.current),boxShadow:"2px 2px 8px 0px rgba(0, 0, 0, 0.75)"},children:[e.jsx("div",{className:`
          absolute w-6 h-6bg-white rounded-bl rounded-tr
          ${c.current==="left"?"right-0":"left-0"}
        `,style:d}),t,e.jsx(u$,{orientation:c.current,children:e.jsx(l$,{onClick:u=>s(n),children:e.jsx("span",{className:"fa fa-times"})})})]})},p$=({show:t,children:s,lngLat:n,project:r,...a})=>{const l=r(n);return e.jsx("div",{className:`
        absolute top-0 left-0 z-20
        rounded whitespace-nowrap hover-comp
        pointer-events-none
        grid grid-cols-1 gap-1
      `,style:{display:t?"grid":"none",transform:i$(l,a),boxShadow:"2px 2px 8px 0px rgba(0, 0, 0, 0.75)"},children:s})},h$=({activeLayers:t,width:s=320,padding:n=8,MapActions:r,layerStates:a,...l})=>{const[i,c]=w.useMemo(()=>t.reduce((d,u)=>{const p=u.infoBoxes.filter(({show:m=!0})=>{let h=m;return typeof m=="function"&&(h=m(u)),h});return p.length&&(d[0].push([u,p]),d[1]=Math.max(d[1],u.infoBoxes.reduce((m,h)=>Math.max(m,C(h,"width",0)),0))),d},[[],[],s]),[t,s,a]);return e.jsx("div",{className:`
        absolute right-0 top-0 bottom-0 flex flex-col items-end z-30
        pointer-events-none 
      `,style:{padding:`${n}px`},children:i.length?e.jsx("div",{style:{width:`${c-n*2}px`},children:i.map(([d,u],p)=>e.jsx("div",{children:u.map((m,h)=>e.jsx(f$,{...l,...m,layer:d,MapActions:r,activeLayers:t},h))},p))}):null})},f$=({layer:t,Component:s,MapActions:n,...r})=>e.jsx(e.Fragment,{children:s?e.jsx(e.Fragment,{children:typeof s=="function"?e.jsx(s,{layer:t,MapActions:n,...r}):s}):null}),g$=[{name:"Light",style:"https://api.maptiler.com/maps/dataviz-light/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Dark",style:"https://api.maptiler.com/maps/dataviz-dark/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Streets",style:"https://api.maptiler.com/maps/streets-v2/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Satellite Streets",style:"https://api.maptiler.com/maps/hybrid/style.json?key=mU28JQ6HchrQdneiq6k9"}],x$={center:[-74.180647,42.58],minZoom:2,zoom:10,preserveDrawingBuffer:!0,styles:g$,attributionControl:!1,maplibreLogo:!1,logoPosition:"bottom-left",protocols:[]};let b$=0;const z0=()=>`unique-id-${++b$}`,y$={map:null,initializedLayers:[],activeLayers:[],dynamicLayers:[],layersLoading:{},hoverData:{data:new Map,pos:[0,0],lngLat:{}},pinnedHoverComps:[],pinnedMapMarkers:[],mapStyles:[],styleIndex:0,sidebarTabIndex:0,modalData:[],prevLayerStates:{},layerStates:{},prevLayerProps:{},Protocols:{}},v$=(t,s)=>{const{type:n,...r}=s;switch(n){case"init-layer":return{...t,initializedLayers:[...t.initializedLayers,r.layer.id]};case"loading-start":return{...t,layersLoading:{...t.layersLoading,[r.layerId]:C(t,["layersLoading",r.layerId],0)+1}};case"loading-stop":return{...t,layersLoading:{...t.layersLoading,[r.layerId]:Math.max(0,t.layersLoading[r.layerId]-1)}};case"activate-layer":return{...t,activeLayers:[r.layer,...t.activeLayers],layerStates:{...t.layerStates,[r.layer.id]:r.layer.state}};case"deactivate-layer":return{...t,activeLayers:t.activeLayers.filter(({id:a})=>a!==r.layerId),layerStates:{...t.layerStates,[r.layerId]:{}},prevLayerStates:{...t.layerStates,[r.layerId]:{}}};case"hover-layer-move":{const{data:a,layer:l,HoverComp:i,pinnable:c,sortOrder:d,...u}=r;return t.hoverData.data.set(l.id,{data:a,HoverComp:i,layer:l,pinnable:c,sortOrder:d}),{...t,hoverData:{...t.hoverData,...u}}}case"hover-layer-leave":{const{layer:a}=r;return t.hoverData.data.delete(a.id),{...t,hoverData:{...t.hoverData}}}case"pin-hover-comp":{if(!t.hoverData.data.size)return t;const a={id:z0(),HoverComps:[...t.hoverData.data.values()].filter(({pinnable:l})=>l).sort((l,i)=>l.sortOrder-i.sortOrder),...r};return a.HoverComps.length?{...t,pinnedHoverComps:[...t.pinnedHoverComps,a]}:t}case"remove-pinned":return{...t,pinnedHoverComps:t.pinnedHoverComps.filter(a=>a.id!==r.id?!0:(a.marker.remove(),!1))};case"add-dynamic-layer":return{...t,dynamicLayers:[...t.dynamicLayers,r.layer]};case"remove-dynamic-layer":return{...t,dynamicLayers:t.dynamicLayers.filter(({id:a})=>a!==r.layer.id)};case"show-modal":{const{layerId:a,modalKey:l}=r;return t.modalData.reduce((i,c)=>i||c.layerId===a&&c.modalKey===l,!1)?t:{...t,modalData:[...t.modalData,{layerId:a,modalKey:l,zIndex:0}]}}case"bring-modal-to-front":{const{layerId:a,modalKey:l}=r;return{...t,modalData:t.modalData.map(i=>({...i,zIndex:i.layerId===a&&i.modalKey===l?10:0}))}}case"close-modal":return{...t,modalData:t.modalData.filter(({layerId:a,modalKey:l})=>!(a===r.layerId&&l===r.modalKey))};case"layer-update":{const{layer:a,newState:l}=r;return{...t,layerStates:{...t.layerStates,[a.id]:l}}}case"update-prev":{const{layerProps:a,updateProps:l,updateStates:i}=r;let c=t.prevLayerProps;l.length&&(c={...t.prevLayerProps,...l.reduce((u,p)=>(u[p.id]=C(a,p.id,{}),u),{})});let d=t.prevLayerStates;return i.length&&(d={...t.prevLayerStates,...i.reduce((u,p)=>(u[p.id]=C(t.layerStates,p.id,{}),u),{})}),{...t,prevLayerProps:c,prevLayerStates:d}}case"set-map-style":case"switch-tab":case"map-loaded":case"update-state":return{...t,...r};default:return t}},j$=[],Qu={},ul=t=>{const{accessToken:s,mapOptions:n=Qu,layers:r=j$,Sidebar:a=null,layerProps:l=Qu,navigationControl:i="bottom-right",falcor:c=()=>{}}=t,[d,u]=w.useReducer(v$,y$),p=w.useCallback(U=>{u(U)},[]),m=w.useCallback(U=>d.map?d.map.project(U):null,[d.map]),h=w.useCallback((U,q,te)=>{if(!C(U,["filters",q],null))return;u({type:"loading-start",layerId:U.id});const K=U.filters[q].value;U.filters={...U.filters,[q]:{...U.filters[q],prevValue:K,value:te}};const ne=C(l,U.id,{});Promise.resolve(U.onFilterChange(q,te,K,ne)).then(()=>U.fetchData(c,ne)).then(()=>U.render(d.map,c,ne)).then(()=>{u({type:"loading-stop",layerId:U.id})})},[d.map,c,l]),f=w.useCallback(U=>{u({type:"loading-start",layerId:U.id}),Promise.resolve(U.fetchData(c)).then(()=>U.render(d.map,c)).then(()=>{u({type:"loading-stop",layerId:U.id})})},[d.map,c]),g=w.useCallback((U,q)=>{C(U,"legend",null)&&(U.legend={...U.legend,...q},U.render(d.map,c),u({type:"update-state"}))},[d.map,c]),x=w.useCallback(U=>{U.isDynamic=!0,u({type:"add-dynamic-layer",layer:U})},[]),y=w.useCallback(U=>{U._onRemove(d.map),u({type:"remove-dynamic-layer",layer:U})},[d.map]),j=w.useCallback(U=>{U.toggleVisibility(d.map),u({type:"update-state"})},[d.map]),N=w.useCallback(U=>{U._onAdd(d.map,c,p),u({type:"activate-layer",layer:U})},[d.map,c,p]),_=w.useCallback(U=>{U._onRemove(d.map),u({type:"deactivate-layer",layerId:U.id})},[d.map]),E=w.useCallback(U=>{u({type:"switch-tab",sidebarTabIndex:U})},[]),L=w.useCallback((U,q)=>{u({type:"show-modal",layerId:U,modalKey:q})},[]),S=w.useCallback((U,q)=>{u({type:"close-modal",layerId:U,modalKey:q})},[]),k=w.useCallback((U,q)=>{u({type:"bring-modal-to-front",layerId:U,modalKey:q})},[]),$=w.useCallback(U=>{u({type:"remove-pinned",id:U})},[]),I=w.useCallback(({lngLat:U,hoverData:q})=>{if(q.pinnable){const te=new cs.Marker().setLngLat(U).addTo(d.map);u({type:"pin-hover-comp",marker:te,lngLat:U})}},[d.map]),T=w.useCallback((U="map.png")=>{const q=d.map.getCanvas(),te=document.createElement("a");te.download=U,te.href=q.toDataURL(),te.click()},[d.map]),A=w.useCallback(U=>{d.map.once("style.load",q=>{d.activeLayers.slice().reverse().reduce((te,K)=>te.then(()=>K.onMapStyleChange(d.map,c,p)),Promise.resolve())}),d.activeLayers.forEach(q=>{q._onRemove(d.map)}),console.log("setStyle"),d.map.setStyle(d.mapStyles[U].style),u({type:"set-map-style",styleIndex:U})},[d.map,d.mapStyles,d.activeLayers,p,c]),R=w.useMemo(()=>({toggleVisibility:j,addLayer:N,removeLayer:_,addDynamicLayer:x,removeDynamicLayer:y,updateLegend:g,setSidebarTab:E,showModal:L,closeModal:S,updateFilter:h,fetchData:f,removePinnedHoverComp:$,addPinnedHoverComp:I,bringModalToFront:k,projectLngLat:m,saveMapAsImage:T}),[j,N,_,x,y,g,E,f,T,L,S,h,k,$,I,m]),O=w.useRef({...x$,...n}),M=w.useRef(t.id||z0());w.useEffect(()=>{const U=/^mapbox:\/\/styles\//,{style:q,styles:te,protocols:K=[],...ne}=O.current,J=K.reduce((fe,ve)=>{const{type:se,protocolInit:me,...xe}=ve;return fe[se]={...xe,Protocol:me(cs)},fe},{}),ae=te.map(fe=>({...fe}));let de=0;if(U.test(q)){const fe=ae.reduce((ve,se,me)=>se.style===q?me:ve,-1);fe===-1?ae.unshift({name:"Unspecified Style",style:q}):de=fe}const ue=new cs.Map({container:M.current,...ne,style:ae[de].style});return i&&ue.addControl(new cs.NavigationControl,i),ue.on("move",fe=>{u({type:"update-state",mapMoved:performance.now()})}),ue.once("load",fe=>{u({type:"map-loaded",map:ue,mapStyles:ae,styleIndex:de,Protocols:J})}),()=>ue.remove()},[s,i]),w.useEffect(()=>{d.map&&[...r,...d.dynamicLayers].filter(({id:U})=>!d.initializedLayers.includes(U)).reverse().reduce((U,q)=>{u({type:"init-layer",layer:q}),q.dispatchStateUpdate=(te,K)=>{u({type:"layer-update",newState:K,layer:te})},q.props=C(l,q.id,{});for(const te in q.filters)q.filters[te].onChange=K=>h(q,te,K);return q.toolbar.forEach(te=>{typeof te.action=="function"&&(te.actionFunc=te.action.bind(q))}),q.mapActions.forEach(te=>{te.actionFunc=te.action.bind(q)}),U.then(()=>q._init(d.map,c,R)).then(()=>{q.setActive&&q.fetchData(c).then(()=>q._onAdd(d.map,c,p)).then(()=>u({type:"activate-layer",layer:q}))})},Promise.resolve())},[d.map,d.dynamicLayers,c,r,R,h,p,d.initializedLayers,l]);const D=w.useCallback(({lngLat:U})=>{if(d.hoverData.pinnable){const q=new cs.Marker().setLngLat(U).addTo(d.map);u({type:"pin-hover-comp",marker:q,lngLat:U})}},[d.map,d.hoverData.pinnable]),P=!!d.hoverData.data.size;w.useEffect(()=>{if(P)return d.map.on("click",D),()=>d.map.off("click",D)},[d.map,D,P]);const F=w.useMemo(()=>[...r,...d.dynamicLayers].filter(U=>!!d.layersLoading[U.id]),[r,d.dynamicLayers,d.layersLoading]),{HoverComps:B,...V}=w.useMemo(()=>{const U=[...d.hoverData.data.values()].sort((q,te)=>q.sortOrder-te.sortOrder);return{...d.hoverData,show:!!U.length,HoverComps:U}},[d.hoverData]),G=w.useMemo(()=>[...r,...d.dynamicLayers].filter(U=>!d.initializedLayers.includes(U.id)||!d.activeLayers.includes(U)),[r,d.dynamicLayers,d.initializedLayers,d.activeLayers]);w.useEffect(()=>{d.activeLayers.forEach(U=>{const q=C(l,U.id,{}),te=C(d.prevLayerProps,U.id,{});Fe(Object.values(q).filter(K=>typeof K!="function"),Object.values(te).filter(K=>typeof K!="function"))||U.receiveProps(q,te,d.map,c)})},[d.map,c,d.activeLayers,l]),w.useEffect(()=>{const U=[],q=[];d.activeLayers.forEach(te=>{te.props=C(l,te.id,{});const K=C(l,te.id,null),ne=C(d.prevLayerProps,te.id,null);Fe(K,ne)||U.push(te);const J=C(d.layerStates,te.id,null),ae=C(d.prevLayerStates,te.id,null);J!==ae&&q.push(te)}),U.forEach(te=>{f(te)}),q.forEach(te=>{te.render(d.map,c)}),(U.length||q.length)&&u({type:"update-prev",layerProps:l,updateProps:U,updateStates:q})},[l,d.layerStates]);const Z=w.useRef(null),X=o$(Z),H=w.useMemo(()=>({...R,setMapStyle:A}),[R,A]),z=w.useCallback(()=>Z.current?Z.current.getBoundingClientRect():{width:0,height:0},[]),{width:W,height:Y}=z();return w.useEffect(()=>{d.map&&d.map.resize()},[W,Y,d.map]),e.jsxs("div",{ref:Z,className:"w-full h-full relative focus:outline-none",children:[e.jsx("div",{id:M.current,className:"w-full h-full relative"}),a?e.jsx(a,{mapboxMap:d.map,layerStates:d.layerStates,sidebarTabIndex:d.sidebarTabIndex,mapStyles:d.mapStyles,styleIndex:d.styleIndex,layersLoading:d.layersLoading,inactiveLayers:G,activeLayers:d.activeLayers,loadingLayers:F,MapActions:H}):e.jsx("span",{}),e.jsx(h$,{activeLayers:d.activeLayers,layersLoading:d.layersLoading,loadingLayers:F,inactiveLayers:G,MapActions:H,mapboxMap:d.map,layerStates:d.layerStates}),e.jsxs("div",{className:`
        absolute top-0 bottom-0 left-0 right-0 z-50
        pointer-events-none overflow-hidden
      `,children:[d.pinnedHoverComps.map(({HoverComps:U,data:q,id:te,...K})=>b.createElement(m$,{...K,...X,remove:$,project:m,key:te,id:te},U.map(({HoverComp:ne,data:J,layer:ae},de)=>e.jsx(ne,{layer:ae,data:J,activeLayers:d.activeLayers,layersLoading:d.layersLoading,loadingLayers:F,inactiveLayers:G,MapActions:H,mapboxMap:d.map,layerStates:d.layerStates,pinned:!0},ae.id)))),d.hoverData.data.size?e.jsx(p$,{...V,...X,project:m,children:B.map(({HoverComp:U,data:q,layer:te},K)=>e.jsx(U,{layer:te,data:q,activeLayers:d.activeLayers,layersLoading:d.layersLoading,loadingLayers:F,inactiveLayers:G,MapActions:H,mapboxMap:d.map,layerStates:d.layerStates,pinned:!1},te.id))}):null]})]})},w$=({data:t,layer:s})=>{const n=t.reduce((r,a,l)=>{(l===0||a.length===1)&&r.push([]);const i=r.length-1;return r[i].push(a),r},[]);return e.jsx("div",{className:`
      bg-white p-1 rounded relative z-20 grid grid-cols-1 gap-1
    `,children:n.map((r,a)=>e.jsx("div",{className:"rounded relative px-1 bg-white",children:r.map((l,i)=>e.jsx("div",{className:"flex",children:l.map((c,d)=>e.jsx("div",{className:`
                          ${d===0?"flex-1 font-bold":"flex-0"}
                          ${l.length>1&&d===0?"mr-4":""}
                          ${l.length===1&&d===0?`border-b-2 text-lg ${i>0?"mt-1":""}`:""}
                        `,children:c},d))},i))},a))})};let N$=-1;const C$=()=>`avl-layer-${++N$}`,_$=()=>null,S$={setActive:!0,isDynamic:!1,filters:{},modals:{},mapActions:[],sources:[],layers:[],isVisible:!0,toolbar:["toggle-visibility"],legend:null,infoBoxes:[],props:{},state:{},mapboxMap:null,onHover:!1,onClick:!1,onBoxSelect:!1};class ml{constructor(s={}){const n={...S$,...s};for(const r in n)this[r]=n[r];this.id=C$(),this.layerVisibility={},this.needsRender=this.setActive,this.callbacks=[],this.hoveredFeatures=new Map,this.dispatchStateUpdate=()=>{},this.updateState=this.updateState.bind(this)}_init(s,n){return this.mapboxMap=s,this.falcor=n,this.init(s,n)}init(s,n){return Promise.resolve()}updateState(s){typeof s=="function"?this.state=s(this.state):this.state={...this.state,...s},this.dispatchStateUpdate(this,this.state)}_onAdd(s,n,r){return this.sources.forEach(({id:a,source:l})=>{s.getSource(a)||s.addSource(a,l)}),this.layers.forEach(a=>{s.getLayer(a.id)||(a.beneath&&s.getLayer(a.beneath)?s.addLayer(a,a.beneath):s.addLayer(a),this.isVisible||this._setVisibilityNone(s,a.id),this.layerVisibility[a.id]=s.getLayoutProperty(a.id,"visibility"))}),this.onHover&&this.addHover(s,r),this.onClick&&this.addClick(s),this.onBoxSelect&&(this.state={...this.state,selection:[]},this.addBoxSelect(s)),this.onAdd(s,n)}onAdd(s,n){return Promise.resolve()}addClick(s){function n(r,{point:a,features:l,lngLat:i}){this.onClick.callback.call(this,r,l,i,a)}this.onClick.layers.forEach(r=>{if(r==="mapboxMap"){const a=n.bind(this,r);this.callbacks.push({action:"click",callback:a}),s.on("click",a)}else{const a=n.bind(this,r);this.callbacks.push({action:"click",callback:a,layerId:r}),s.on("click",r,a)}})}hoverLeave(s,n){this.hoveredFeatures.has(n)&&(this.hoveredFeatures.get(n).forEach(r=>{s.setFeatureState(r,{hover:!1})}),this.hoveredFeatures.delete(n))}addHover(s,n){const r=C(this,["onHover","callback"],_$).bind(this),a=C(this,["onHover","HoverComp"],w$),l=C(this,["onHover","property"],null),i=C(this,["onHover","filterFunc"],null),c=C(this,["onHover","pinnable"],!0),d=C(this,["onHover","sortOrder"],1/0),u=(m,{point:h,features:f,lngLat:g})=>{const x=this.hoveredFeatures.get(m)||new Map;this.hoveredFeatures.set(m,new Map);const y=_=>{_.forEach(({id:E,source:L,sourceLayer:S})=>{if(E!=null)if(x.has(E))this.hoveredFeatures.get(m).set(E,x.get(E)),x.delete(E);else{const k={id:E,source:L,sourceLayer:S};this.hoveredFeatures.get(m).set(E,k),s.setFeatureState(k,{hover:!0})}})},j=new Map;if(l){const _=f.reduce((E,L)=>{const S=C(L,["properties",l],null);return S&&(E[S]=!0),E},{});s.queryRenderedFeatures({layers:[m],filter:["in",["get",l],["literal",Object.keys(_)]]}).forEach(E=>{j.set(E.id,E)})}if(i){const _=i.call(this,m,f,g,h);Ao(_)&&s.queryRenderedFeatures({layers:[m],filter:_}).forEach(E=>{j.set(E.id,E)})}f.forEach(_=>{j.set(_.id,_)}),y([...j.values()]),x.forEach(_=>{s.setFeatureState(_,{hover:!1})});const N=r(m,f,g,h);Ao(N)&&n({pos:[h.x,h.y],type:"hover-layer-move",HoverComp:a,layer:this,pinnable:c,sortOrder:d,lngLat:g,data:N})},p=(m,h)=>{this.hoverLeave(s,m),n({type:"hover-layer-leave",layer:this})};this.onHover.layers.forEach(m=>{let h=u.bind(this,m);this.callbacks.push({action:"mousemove",callback:h,layerId:m}),s.on("mousemove",m,h),h=p.bind(this,m),this.callbacks.push({action:"mouseleave",callback:h,layerId:m}),s.on("mouseleave",m,h)},this)}addBoxSelect(s){let n,r,a;const l=s.getCanvasContainer(),i=h=>{const f=l.getBoundingClientRect();return new cs.Point(h.clientX-f.left-l.clientLeft,h.clientY-f.top-l.clientTop)},c=h=>{if(h.preventDefault(),r=i(h),!a){const j=C(this,["onBoxSelect","className"],"bg-black bg-opacity-50 border-2 border-black");a=document.createElement("div"),a.className="absolute top-0 left-0 w-0 h-0 "+j,l.appendChild(a)}var f=Math.min(n.x,r.x),g=Math.max(n.x,r.x),x=Math.min(n.y,r.y),y=Math.max(n.y,r.y);a.style.transform=`translate( ${f}px, ${x}px)`,a.style.width=`${g-f}px`,a.style.height=`${y-x}px`},d=h=>{p([n,i(h)])},u=h=>{(h.keyCode===27||h.which===27||h.code==="Escape")&&p()},p=h=>{if(document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",d),document.removeEventListener("keydown",u),s.dragPan.enable(),a&&(a.parentNode.removeChild(a),a=null),h){const g=s.queryRenderedFeatures(h,{layers:C(this,["onBoxSelect","layers"]),filter:C(this,["onBoxSelect","filter"])}).reduce((j,N)=>(j[N.id]=N,j),{}),x=Object.values(g),y=[];x.forEach(j=>{y.push({id:j.id,source:j.source,sourceLayer:j.sourceLayer})}),C(this,["onBoxSelect","selectedValues"],[]).forEach(j=>{s.setFeatureState(j,{select:!1})}),this.onBoxSelect.selectedValues=y,y.forEach(j=>{s.setFeatureState(j,{select:!0})}),this.updateState({selection:x})}},m=h=>{h.shiftKey&&h.button===0&&(document.addEventListener("mousemove",c),document.addEventListener("mouseup",d),document.addEventListener("keydown",u),s.dragPan.disable(),n=i(h))};this.callbacks.push({action:"mousemove",callback:c,element:l}),l.addEventListener("mousedown",m,!0),s.boxZoom.disable(),this.onBoxSelect.selectedValues=[]}_onRemove(s){for(;this.callbacks.length;){const{action:n,layerId:r,callback:a,element:l}=this.callbacks.pop();l?l.removeEventListener(n,a):r?this.mapboxMap.off(n,r,a):this.mapboxMap.off(n,a)}this.layers.forEach(({id:n})=>{this.mapboxMap.removeLayer(n)}),this.onRemove(this.mapboxMap)}onRemove(s){}fetchData(s){return Promise.resolve()}render(s,n){}receiveProps(s,n,r,a){}toggleVisibility(s){this.isVisible=!this.isVisible,this.layers.forEach(({id:n})=>{this.isVisible?this._setVisibilityVisible(s,n):this._setVisibilityNone(s,n)})}_setVisibilityVisible(s,n){this.layerVisibility[n]!=="none"&&s.setLayoutProperty(n,"visibility","visible")}_setVisibilityNone(s,n){s.getLayoutProperty(n,"visibility")==="none"?this.layerVisibility[n]="none":s.setLayoutProperty(n,"visibility","none")}setLayerVisibility(s,n,r){const a=this.isVisible&&r==="visible";this.layerVisibility[n.id]=r,r=a?"visible":"none",s.setLayoutProperty(n.id,"visibility",r)}onFilterChange(s,n,r){}onMapStyleChange(s,n,r){this._onAdd(s,n,r).then(()=>this.render(s,n))}}const Vl={"1/3":236,"2/3":420,"1/2":420,2:420,1:420,[void 0]:420},$$=(t,s,n)=>{if(t.showLegend===!1)return null;const r=s.getContext("2d");r.drawImage(n,0,0);let a=0,l=20,i=t.legend.title?80:50;if(r.fillStyle="white",r.roundRect(a,l,Vl[t==null?void 0:t.size]+15,i,5),r.fill(),t.legend.title){r.font=((t==null?void 0:t.size)==="1/3","1rem Arial"),r.fillStyle="#232323",l+=20;const m=t.legend.title;r.fillText(m,a+10,l,Vl[t==null?void 0:t.size]),l+=10}a+=10,l+=10;const c=Vl[t.size]/(t.legend.range.length+1.1);t.legend.range.forEach((m,h)=>{r.fillStyle=m,r.fillRect(a+h*c,l,c,20)}),r.fillStyle="#d0d0ce",r.fillRect(5+a+t.legend.range.length*c,l,c,20);let d;switch(t.legend.type){case"quantile":d=wa().domain(t.legend.domain).range(t.legend.range);break;case"quantize":d=Hn().domain(t.legend.domain).range(t.legend.range);break;case"threshold":d=ps().domain(t.legend.domain).range(t.legend.range);break}const u=typeof t.legend.format=="function"?t.legend.format:il(t.legend.format);return a+=3,l+=33,r.fillStyle="#232323",r.font=(t==null?void 0:t.size)==="1/3"?"10px Arial":"11px Arial",r.textAlign="right",t.legend.range.forEach((m,h)=>{const f=u(d==null?void 0:d.invertExtent(m)[1]);r.fillText(f,a+c+h*c,l)}),r.fillText("N/A",5+a+c+t.legend.range.length*c,l),0};class U0 extends ml{constructor(n){super(n);ye(this,"name","ccl");ye(this,"id","ccl");ye(this,"legend",{Title:n=>"",type:"threshold",format:"0.2s",domain:[0,25,50,75,100],range:ds(5,"RdYlGn",!1),show:!1})}init(n,r,a){n.fitBounds([-125.0011,24.9493,-66.9326,49.5904],{duration:10}),n.on("idle",l=>{var i;if(this.props.change){const c=document.querySelector("canvas.maplibregl-canvas"),d=document.createElement("canvas");let u;d.width=c.width,d.height=c.height,d.getContext("2d").drawImage(c,0,0),(i=this==null?void 0:this.legend)!=null&&i.show&&(console.log("drawLegend",this),$$({legend:this.legend,showLegend:this.props.showLegend,filters:this.filters,size:this.props.size},d,c)),u=d.toDataURL(),this.props.change({filters:this.filters,img:u,bounds:n.getBounds(),center:n.getCenter(),zoom:n.getZoom(),style:this.style})}})}handleMapFocus(n,r){if(r.mapFocus)try{n.fitBounds(r.mapFocus,{duration:10})}catch{n.fitBounds([-125.0011,24.9493,-66.9326,49.5904],{duration:10})}else n.fitBounds([-125.0011,24.9493,-66.9326,49.5904],{duration:10})}paintMap(n,r){let{domain:a=[],colors:l=[],title:i="",sources:c=[],layers:d=[]}=r;this.legend.domain=a,this.legend.range=l,this.legend.title=i,console.time("changing sources and layers"),console.log("paint map",c,d),c.forEach(u=>{n.getSource(u.id)||n.addSource(u.id,u.source)}),d.forEach(u=>{n.getLayer(u.id)&&n.removeLayer(u.id),n.addLayer(u)}),console.timeEnd("changing sources and layers")}receiveProps(n,r,a,l){this.paintMap(a,n),this.handleMapFocus(a,n)}}const W0=(t={})=>new U0(t),E$={"1/3":290,"2/3":370,"1/2":370,2:370,1:370,[void 0]:370},k$=({size:t,domain:s,range:n,fmt:r,title:a,hideNA:l})=>{const i=({value:c,color:d,fmt:u,className:p})=>(E$[t]/(n.length+1),e.jsxs("div",{className:`flex flex-col h-[40px] flex-1 ${p}`,children:[e.jsx("div",{className:"h-[20px]",style:{backgroundColor:d}}),e.jsx("div",{className:"h-[20px] text-xs font-thin text-right",children:u?u(c):c})]},c));return e.jsxs("div",{className:"relative w-full max-w-[300px] ml-4 -mb-[100px] ",style:{zIndex:10},children:[a&&e.jsx("label",{className:"font-sm pl-2",children:a}),e.jsxs("div",{className:"flex flex-row justify-center inline-block align-middle pt-2.5",children:[n.map((c,d)=>e.jsx(i,{value:s[d],color:c,fmt:r},d)),!l&&e.jsx(i,{value:"N/A",color:"#d0d0ce",className:"ml-1"})]})]})},L$=({size:t,domain:s,range:n,fmt:r,title:a})=>{Math.min(...s.filter(c=>c));const l=Math.max(...s.filter(c=>c)),i=({value:c,color:d,fmt:u,className:p})=>{};return e.jsxs("div",{className:"absolute float-left mt-[20px] m-5 rounded-md",style:{zIndex:10},children:[a&&e.jsx("label",{className:"font-md pl-2",children:a}),e.jsxs("div",{className:"flex flex-col justify-center inline-block align-middle pt-2.5",children:[e.jsx("div",{id:"legend",children:e.jsx("svg",{id:"legend_svg",xmlns:"http://www.w3.org/2000/svg"})}),e.jsx(i,{value:l,fmt:r})]})]})},G0=({domain:t=[],range:s=[],title:n,scaleType:r="quantile",type:a="Choropleth",format:l="0.2s",size:i,show:c=!0,hideNA:d=!1})=>{if(!c)return null;switch(r){case"linear":js().domain([Math.min(...t),Math.max(...t)]).range(s);break;case"quantile":wa().domain(t).range(s);break;case"quantize":Hn().domain(t).range(s);break;case"threshold":ps().domain(t).range(s);break}const u=typeof l=="function"?l:il(l);return a==="Choropleth"?e.jsx(k$,{hideNA:d,domain:t,range:s,fmt:u,size:i,title:n}):e.jsx(L$,{domain:t,range:s,fmt:u,size:i,title:n})},J0=(t,s)=>t*Math.pow(2,s),Ma=(t,s)=>Math.floor(t/Math.pow(2,s)),Oo=(t,s)=>J0(t.getUint16(s+1,!0),8)+t.getUint8(s),q0=(t,s)=>J0(t.getUint32(s+2,!0),16)+t.getUint16(s,!0),I$=(t,s,n,r,a)=>{if(t!=r.getUint8(a))return t-r.getUint8(a);const l=Oo(r,a+1);if(s!=l)return s-l;const i=Oo(r,a+4);return n!=i?n-i:0},T$=(t,s,n,r)=>{const a=K0(t,s|128,n,r);return a?{z:s,x:n,y:r,offset:a[0],length:a[1],is_dir:!0}:null},em=(t,s,n,r)=>{const a=K0(t,s,n,r);return a?{z:s,x:n,y:r,offset:a[0],length:a[1],is_dir:!1}:null},K0=(t,s,n,r)=>{let a=0,l=t.byteLength/17-1;for(;a<=l;){const i=l+a>>1,c=I$(s,n,r,t,i*17);if(c>0)a=i+1;else if(c<0)l=i-1;else return[q0(t,i*17+7),t.getUint32(i*17+13,!0)]}return null},M$=(t,s)=>t.is_dir&&!s.is_dir?1:!t.is_dir&&s.is_dir?-1:t.z!==s.z?t.z-s.z:t.x!==s.x?t.x-s.x:t.y-s.y,Y0=(t,s)=>{const n=t.getUint8(s*17);return{z:n&127,x:Oo(t,s*17+1),y:Oo(t,s*17+4),offset:q0(t,s*17+7),length:t.getUint32(s*17+13,!0),is_dir:n>>7===1}},tm=t=>{const s=[],n=new DataView(t);for(let r=0;r<n.byteLength/17;r++)s.push(Y0(n,r));return B$(s)},B$=t=>{t.sort(M$);const s=new ArrayBuffer(17*t.length),n=new Uint8Array(s);for(let r=0;r<t.length;r++){const a=t[r];let l=a.z;a.is_dir&&(l=l|128),n[r*17]=l,n[r*17+1]=a.x&255,n[r*17+2]=a.x>>8&255,n[r*17+3]=a.x>>16&255,n[r*17+4]=a.y&255,n[r*17+5]=a.y>>8&255,n[r*17+6]=a.y>>16&255,n[r*17+7]=a.offset&255,n[r*17+8]=Ma(a.offset,8)&255,n[r*17+9]=Ma(a.offset,16)&255,n[r*17+10]=Ma(a.offset,24)&255,n[r*17+11]=Ma(a.offset,32)&255,n[r*17+12]=Ma(a.offset,48)&255,n[r*17+13]=a.length&255,n[r*17+14]=a.length>>8&255,n[r*17+15]=a.length>>16&255,n[r*17+16]=a.length>>24&255}return s},A$=(t,s)=>{if(t.byteLength<17)return null;const n=t.byteLength/17,r=Y0(t,n-1);if(r.is_dir){const a=r.z,l=s.z-a,i=Math.trunc(s.x/(1<<l)),c=Math.trunc(s.y/(1<<l));return{z:a,x:i,y:c}}return null};async function O$(t){const s=await t.getBytes(0,512e3),n=new DataView(s.data),r=n.getUint32(4,!0),a=n.getUint16(8,!0),l=new TextDecoder("utf-8"),i=JSON.parse(l.decode(new DataView(s.data,10,r)));let c=ao.Unknown;i.compression==="gzip"&&(c=ao.Gzip);let d=0;"minzoom"in i&&(d=+i.minzoom);let u=0;"maxzoom"in i&&(u=+i.maxzoom);let p=0,m=0,h=0,f=-180,g=-85,x=180,y=85;if(i.bounds){const N=i.bounds.split(",");f=+N[0],g=+N[1],x=+N[2],y=+N[3]}if(i.center){const N=i.center.split(",");p=+N[0],m=+N[1],h=+N[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:a*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:ao.None,tileCompression:c,tileType:td.Mvt,minZoom:d,maxZoom:u,minLon:f,minLat:g,maxLon:x,maxLat:y,centerZoom:h,centerLon:p,centerLat:m,etag:s.etag}}async function P$(t,s,n,r,a,l,i){let c=await n.getArrayBuffer(s,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(c=tm(c));const d=em(new DataView(c),r,a,l);if(d){let m=(await s.getBytes(d.offset,d.length,i)).data;const h=new DataView(m);return h.getUint8(0)==31&&h.getUint8(1)==139&&(m=fa(new Uint8Array(m))),{data:m}}const u=A$(new DataView(c),{z:r,x:a,y:l});if(u){const p=T$(new DataView(c),u.z,u.x,u.y);if(p){let m=await n.getArrayBuffer(s,p.offset,p.length,t);t.specVersion===1&&(m=tm(m));const h=em(new DataView(m),r,a,l);if(h){let g=(await s.getBytes(h.offset,h.length,i)).data;const x=new DataView(g);return x.getUint8(0)==31&&x.getUint8(1)==139&&(g=fa(new Uint8Array(g))),{data:g}}}}}const Z0={getHeader:O$,getZxy:P$};let X0=class{constructor(){this.tile=(s,n)=>{if(s.type=="json"){const r=s.url.substr(10);let a=this.tiles.get(r);return a||(a=new Po(r),this.tiles.set(r,a)),a.getHeader().then(l=>{const i={tiles:[s.url+"/{z}/{x}/{y}"],minzoom:l.minZoom,maxzoom:l.maxZoom,bounds:[l.minLon,l.minLat,l.maxLon,l.maxLat]};n(null,i,null,null)}).catch(l=>{n(l,null,null,null)}),{cancel:()=>{}}}else{const r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),a=s.url.match(r);if(!a)throw new Error("Invalid PMTiles protocol URL");const l=a[1];let i=this.tiles.get(l);i||(i=new Po(l),this.tiles.set(l,i));const c=a[2],d=a[3],u=a[4],p=new AbortController,m=p.signal;let h=()=>{p.abort()};return i.getHeader().then(f=>{i.getZxy(+c,+d,+u,m).then(g=>{g?n(null,new Uint8Array(g.data),g.cacheControl,g.expires):f.tileType==td.Mvt?n(null,new Uint8Array,null,null):n(null,null,null,null)}).catch(g=>{g.name!=="AbortError"&&n(g,null,null,null)})}),{cancel:h}}},this.tiles=new Map}add(s){this.tiles.set(s.source.getKey(),s)}get(s){return this.tiles.get(s)}};function Kn(t,s){return(s>>>0)*4294967296+(t>>>0)}function D$(t,s){const n=s.buf;let r,a;if(a=n[s.pos++],r=(a&112)>>4,a<128||(a=n[s.pos++],r|=(a&127)<<3,a<128)||(a=n[s.pos++],r|=(a&127)<<10,a<128)||(a=n[s.pos++],r|=(a&127)<<17,a<128)||(a=n[s.pos++],r|=(a&127)<<24,a<128)||(a=n[s.pos++],r|=(a&1)<<31,a<128))return Kn(t,r);throw new Error("Expected varint not more than 10 bytes")}function Ba(t){const s=t.buf;let n,r;return r=s[t.pos++],n=r&127,r<128||(r=s[t.pos++],n|=(r&127)<<7,r<128)||(r=s[t.pos++],n|=(r&127)<<14,r<128)||(r=s[t.pos++],n|=(r&127)<<21,r<128)?n:(r=s[t.pos],n|=(r&15)<<28,D$(n,t))}function R$(t,s,n,r){if(r==0){n==1&&(s[0]=t-1-s[0],s[1]=t-1-s[1]);const a=s[0];s[0]=s[1],s[1]=a}}const F$=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function V$(t,s,n){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(s>Math.pow(2,t)-1||n>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");const r=F$[t],a=Math.pow(2,t);let l=0,i=0,c=0;const d=[s,n];let u=a/2;for(;u>0;)l=(d[0]&u)>0?1:0,i=(d[1]&u)>0?1:0,c+=u*u*(3*l^i),R$(u,d,l,i),u=u/2;return r+c}var ao=(t=>(t[t.Unknown=0]="Unknown",t[t.None=1]="None",t[t.Gzip=2]="Gzip",t[t.Brotli=3]="Brotli",t[t.Zstd=4]="Zstd",t))(ao||{});async function Q0(t,s){if(s===1||s===0)return t;if(s===2){if(typeof globalThis.DecompressionStream>"u")return fa(new Uint8Array(t));{let r=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}}else throw Error("Compression method not supported")}var td=(t=>(t[t.Unknown=0]="Unknown",t[t.Mvt=1]="Mvt",t[t.Png=2]="Png",t[t.Jpeg=3]="Jpeg",t[t.Webp=4]="Webp",t[t.Avif=5]="Avif",t))(td||{});const H$=127;function z$(t,s){let n=0,r=t.length-1;for(;n<=r;){const a=r+n>>1,l=s-t[a].tileId;if(l>0)n=a+1;else if(l<0)r=a-1;else return t[a]}return r>=0&&(t[r].runLength===0||s-t[r].tileId<t[r].runLength)?t[r]:null}let U$=class{constructor(s){this.url=s.includes("localhost")?"http://"+s:"https://"+s}getKey(){return this.url}async getBytes(s,n,r){let a;r||(a=new AbortController,r=a.signal);let l=await fetch(this.url,{signal:r,headers:{Range:"bytes="+s+"-"+(s+n-1)}});if(l.status===416&&s===0){const d=l.headers.get("Content-Range");if(!d||!d.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const u=+d.substr(8);l=await fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(u-1)}})}if(l.status>=300)throw Error("Bad response code: "+l.status);const i=l.headers.get("Content-Length");if(l.status===200&&(!i||+i>n))throw a&&a.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:await l.arrayBuffer(),etag:l.headers.get("ETag")||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}}};function fs(t,s){const n=t.getUint32(s+4,!0),r=t.getUint32(s+0,!0);return n*Math.pow(2,32)+r}function W$(t,s){const n=new DataView(t),r=n.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:fs(n,8),rootDirectoryLength:fs(n,16),jsonMetadataOffset:fs(n,24),jsonMetadataLength:fs(n,32),leafDirectoryOffset:fs(n,40),leafDirectoryLength:fs(n,48),tileDataOffset:fs(n,56),tileDataLength:fs(n,64),numAddressedTiles:fs(n,72),numTileEntries:fs(n,80),numTileContents:fs(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:s}}function eg(t){const s={buf:new Uint8Array(t),pos:0},n=Ba(s),r=[];let a=0;for(let l=0;l<n;l++){const i=Ba(s);r.push({tileId:a+i,offset:0,length:0,runLength:1}),a+=i}for(let l=0;l<n;l++)r[l].runLength=Ba(s);for(let l=0;l<n;l++)r[l].length=Ba(s);for(let l=0;l<n;l++){const i=Ba(s);i===0&&l>0?r[l].offset=r[l-1].offset+r[l-1].length:r[l].offset=i-1}return r}function G$(t){const s=new DataView(t);return s.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):s.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}let ra=class extends Error{};async function J$(t,s,n,r){const a=await t.getBytes(0,16384),l=new DataView(a.data);if(l.getUint16(0,!0)!==19792)throw new Error(`Wrong magic number for PMTiles archive got ${l.getUint16(0,!0)} not 19729`);if(G$(a.data)<3)return[await Z0.getHeader(t)];const i=a.data.slice(0,H$);let c=a.etag;r&&a.etag!=r&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),c=void 0);const d=W$(i,c);if(n){const u=a.data.slice(d.rootDirectoryOffset,d.rootDirectoryOffset+d.rootDirectoryLength),p=t.getKey()+"|"+(d.etag||"")+"|"+d.rootDirectoryOffset+"|"+d.rootDirectoryLength,m=eg(await s(u,d.internalCompression));return[d,[p,m.length,m]]}return[d,void 0]}async function q$(t,s,n,r,a){const l=await t.getBytes(n,r);if(a.etag&&a.etag!==l.etag)throw new ra(l.etag);const i=await s(l.data,a.internalCompression),c=eg(i);if(c.length===0)throw new Error("Empty directory is invalid");return c}let K$=class{constructor(s=100,n=!0,r=Q0){this.cache=new Map,this.maxCacheEntries=s,this.counter=1,this.prefetch=n,this.decompress=r}async getHeader(s,n){const r=s.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,await this.cache.get(r).data;const a=new Promise((l,i)=>{J$(s,this.decompress,this.prefetch,n).then(c=>{c[1]&&this.cache.set(c[1][0],{lastUsed:this.counter++,data:Promise.resolve(c[1][2])}),l(c[0]),this.prune()}).catch(c=>{i(c)})});return this.cache.set(r,{lastUsed:this.counter++,data:a}),a}async getDirectory(s,n,r,a){const l=s.getKey()+"|"+(a.etag||"")+"|"+n+"|"+r;if(this.cache.has(l))return this.cache.get(l).lastUsed=this.counter++,await this.cache.get(l).data;const i=new Promise((c,d)=>{q$(s,this.decompress,n,r,a).then(u=>{c(u),this.prune()}).catch(u=>{d(u)})});return this.cache.set(l,{lastUsed:this.counter++,data:i}),i}async getArrayBuffer(s,n,r,a){const l=s.getKey()+"|"+(a.etag||"")+"|"+n+"|"+r;if(this.cache.has(l))return this.cache.get(l).lastUsed=this.counter++,await this.cache.get(l).data;const i=new Promise((c,d)=>{s.getBytes(n,r).then(u=>{if(a.etag&&a.etag!==u.etag)throw new ra(u.etag);c(u.data),this.cache.has(l),this.prune()}).catch(u=>{d(u)})});return this.cache.set(l,{lastUsed:this.counter++,data:i}),i}prune(){if(this.cache.size>=this.maxCacheEntries){let s=1/0,n;this.cache.forEach((r,a)=>{r.lastUsed<s&&(s=r.lastUsed,n=a)}),n&&this.cache.delete(n)}}async invalidate(s,n){this.cache.delete(s.getKey()),await this.getHeader(s,n)}},Po=class{constructor(s,n,r){typeof s=="string"?this.source=new U$(s):this.source=s,r?this.decompress=r:this.decompress=Q0,n?this.cache=n:this.cache=new K$}async getHeader(){return await this.cache.getHeader(this.source)}async getZxyAttempt(s,n,r,a){const l=V$(s,n,r),i=await this.cache.getHeader(this.source);if(i.specVersion<3)return Z0.getZxy(i,this.source,this.cache,s,n,r,a);if(s<i.minZoom||s>i.maxZoom)return;let c=i.rootDirectoryOffset,d=i.rootDirectoryLength;for(let u=0;u<=3;u++){const p=await this.cache.getDirectory(this.source,c,d,i),m=z$(p,l);if(m)if(m.runLength>0){const h=await this.source.getBytes(i.tileDataOffset+m.offset,m.length,a);if(i.etag&&i.etag!==h.etag)throw new ra(h.etag);return{data:await this.decompress(h.data,i.tileCompression),cacheControl:h.cacheControl,expires:h.expires}}else c=i.leafDirectoryOffset+m.offset,d=m.length;else return}throw Error("Maximum directory depth exceeded")}async getZxy(s,n,r,a){try{return await this.getZxyAttempt(s,n,r,a)}catch(l){if(l instanceof ra)return this.cache.invalidate(this.source,l.message),await this.getZxyAttempt(s,n,r,a);throw l}}async getMetadataAttempt(){const s=await this.cache.getHeader(this.source),n=await this.source.getBytes(s.jsonMetadataOffset,s.jsonMetadataLength);if(s.etag&&s.etag!==n.etag)throw new ra(n.etag);const r=await this.decompress(n.data,s.internalCompression),a=new TextDecoder("utf-8");return JSON.parse(a.decode(r))}async getMetadata(){try{return await this.getMetadataAttempt()}catch(s){if(s instanceof ra)return this.cache.invalidate(this.source,s.message),await this.getMetadataAttempt();throw s}}};const tg={type:"pmtiles",protocolInit:t=>{const s=new X0;return t.addProtocol("pmtiles",s.tile),s},sourceInit:(t,s,n)=>{const r=new Po(s.url);t.add(r)}},sd=({falcor:t,layerProps:s,legend:n,layerType:r})=>{const a=w.useRef(r?r():W0());return e.jsxs("div",{className:"w-full h-full border border-pink-400 relative",children:[n&&e.jsx(G0,{...n}),e.jsx(ul,{falcor:t,mapOptions:{protocols:[tg],styles:[{name:"blank",style:{sources:{},version:8,layers:[{id:"background",type:"background",layout:{visibility:"visible"},paint:{"background-color":"rgba(208, 208, 206, 0)"}}]}}]},layers:[a.current],layerProps:s,CustomSidebar:()=>e.jsx("div",{})}),e.jsx("div",{className:"px-6 py-10 absolute bottom-0 right-0",children:e.jsx("i",{className:" text-2xl text-slate-400 -rotate-45 fal fa-location-circle"})})]})},_r=({falcor:t,layerProps:s,legend:n,layerType:r})=>{const a=w.useRef(r?r():W0());return e.jsxs("div",{className:"w-full h-full relative",children:[e.jsx(G0,{...n}),e.jsx(ul,{mapOptions:{protocols:[tg],interactive:!1,navigationControl:!1,styles:[{name:"blank",style:{sources:{},version:8,layers:[{id:"background",type:"background",layout:{visibility:"visible"},paint:{"background-color":"rgba(208, 208, 206, 0)"}}]}}]},navigationControl:!1,layers:[a.current],layerProps:s,CustomSidebar:()=>e.jsx("div",{})}),e.jsx("div",{className:"px-6 py-10 absolute bottom-0 right-0",children:e.jsx("i",{className:" text-2xl text-slate-400 -rotate-45 fal fa-location-circle"})})]})},Vi=Js(5,"Oranges"),sg=(t=[],s=[])=>!(t!=null&&t.length)||!(s!=null&&s.length)?[]:t!=null&&t.length&&(s!=null&&s.length)?dl(t,Math.min(t==null?void 0:t.length,s==null?void 0:s.length)):[],Y$=(t,s)=>{const n=sg(t,s);return ps().domain(n).range(s)},Z$=({geoid:t,data:s=[],columns:n=[],paintFn:r,colors:a=[],...l})=>{var m;if(!(s!=null&&s.length)||!(a!=null&&a.length))return{};const i=s.map(h=>h.geoid),c=(((m=t+""||"")==null?void 0:m.substring(0,2))||i[0]||"00").substring(0,2),d={},u=Y$(s.map(h=>r?r(h):h[n==null?void 0:n[0]]).filter(h=>h),a),p=sg(s.map(h=>r?r(h):h[n==null?void 0:n[0]]).filter(h=>h),a);for(let h=0;h<=999;h+=1){const f=c+h.toString().padStart(3,"0"),g=s.find(y=>y.geoid===f)||{},x=r?r(g):g[n==null?void 0:n[0]];d[f]=i.includes(f)&&x?u(x):"#d0d0ce"}return{geoColors:d,domain:p}};async function ng({geoid:t,disasterNumber:s,ealViewId:n,type:r="total_losses",numColors:a="5",colors:l=Vi,size:i="1",height:c=500},d){var Z,X,H,z,W;if(!n||!t||!s)return console.log("getdata not running",n,t,s),{};const u=Y=>["dama",oe,"viewDependencySubgraphs","byViewId",Y],p=`substring(${((Z=Kt[r])==null?void 0:Z.geoColumn)||"geoid"}, 1, 5)`,m=((X=Kt[r])==null?void 0:X.disasterNumberColumn)||"disaster_number",h=Array.isArray((H=Kt[r])==null?void 0:H.columns)?(z=Kt[r])==null?void 0:z.columns:Object.values(((W=Kt[r])==null?void 0:W.columns)||{}),f=JSON.stringify({aggregatedLen:!0,filter:{[m]:[s]},groupBy:[m,p]}),g={geoid:`${p} as geoid`,...(h||[]).reduce((Y,U)=>({...Y,[U]:`sum(${U}) as ${U}`}),{})},x=Y=>["dama",oe,"viewsbyId",Y,"options",f],y=Y=>["dama",oe,"views","byId",Y,"attributes",["source_id","view_id","version","_modified_timestamp"]],j=await d.get(u(n)),N=C(j,["json",...u(n),"dependencies"]),_=N==null?void 0:N.find(Y=>Y.type==="tl_state"),E=N==null?void 0:N.find(Y=>{var U;return Y.type===((U=Kt[r])==null?void 0:U.type)});if(!(E!=null&&E.view_id))return{};E==null||E.view_id;let L=Kt[r].title,S=await d.get([...x(E.view_id),"length"],y(E.view_id));const k=C(S,["json",...x(E.view_id),"length"]),$=await d.get([...x(E.view_id),"databyIndex",{from:0,to:k-1},Object.values(g)]);let I=Object.values(C($,["json",...x(E.view_id),"databyIndex"],{}));I=[...Array(k).keys()].map(Y=>Object.keys(g).reduce((U,q)=>({...U,[q]:I[Y][g[q]]}),{}));const T=["st_asgeojson(st_orientedenvelope(st_union(geom)), 9, 1)  as geom"],A={from:0,to:0},R=C(I,[0,"geoid"])||(t==null?void 0:t.substring(0,2)),O=({view_id:Y})=>["dama",oe,"viewsbyId",Y,"options",JSON.stringify({filter:{geoid:[R.substring(0,2)]}}),"databyIndex"];S=await d.get([...O(_),A,T]);const M=C(S,["json",...O(_),0,T]);console.log("do I get geom",M,S);const{geoColors:D,domain:P}=Z$({geoid:t,data:I,columns:h,paintFn:Kt[r].paintFn,colors:l}),F=C(d.getCache(),["dama",oe,"views","byId",E.view_id,"attributes"],{}),B=[...new Set(Object.keys(D||{}).map(Y=>Y.substring(0,5)))],V=[{id:"counties",source:{type:"vector",url:"https://tiles.availabs.org/data/tiger_carto.json"}}],G=[{id:"counties",source:"counties","source-layer":"s365_v778",type:"fill",filter:["in",["get","geoid"],["literal",B]],paint:{"fill-color":["get",["get","geoid"],["literal",D]]}},{id:"counties-line",source:"counties","source-layer":"s365_v778",type:"line",filter:["in",["get","geoid"],["literal",B]],paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,22,2],"line-color":"#efefef","line-opacity":.5}}];return{view:Kt[r],ealViewId:n,disasterNumber:s,geoid:t,type:r,title:L,domain:P,sources:V,layers:G,attributionData:F,size:i,height:c,colors:l,mapFocus:M?C(JSON.parse(M),"bbox",null):null,showLegend:Kt[r].legend!==!1}}const ag=({value:t,onChange:s,size:n})=>{const{falcor:r,falcorCache:a}=et();let l=b.useMemo(()=>t&&tt(t)?JSON.parse(t):{},[t]);const i="/",c=343,[d,u]=b.useState(!0),[p,m]=b.useState(""),[h,f]=b.useState({ealViewId:(l==null?void 0:l.ealViewId)||837,geoid:(l==null?void 0:l.geoid)||"36",disasterNumber:(l==null?void 0:l.disasterNumber)||null,type:(l==null?void 0:l.type)||"total_losses",typeId:l==null?void 0:l.typeId,data:l==null?void 0:l.data,mapFocus:l.mapFocus,numColors:(l==null?void 0:l.numColors)||5,shade:(l==null?void 0:l.shade)||"Oranges",colors:(l==null?void 0:l.colors)||Vi,title:l==null?void 0:l.title,height:(l==null?void 0:l.height)||500});b.useEffect(()=>{delete h.img,f({...h,...l})},[l]),b.useEffect(()=>{(async()=>{const{geoid:y,disasterNumber:j,ealViewId:N,type:_,colors:E,height:L}=h;if(!y||!j)console.log("not going to load mfer"),m("Please Select a Geography & Disaster");else{m(void 0),u(!0);let S=await ng({geoid:y,disasterNumber:j,ealViewId:N,type:_,colors:E,size:n,height:L},r);console.log("testing got data",t===JSON.stringify({...l,...S}),"args"),t!==JSON.stringify({...l,...S})&&s(JSON.stringify({...l,...S})),u(!1)}})()},[h]);const g=b.useMemo(()=>(console.log("setting Layer Props",l),{ccl:{...l,change:x=>{t!==JSON.stringify({...l,...x})&&(console.log("change from map"),s(JSON.stringify({...l,...x})))}}}),[l]);return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:c,view_id:h.ealViewId,onChange:x=>f({...h,ealViewId:x}),className:"flex-row-reverse"}),e.jsx(rt,{value:h.geoid,onChange:x=>f({...h,geoid:x}),className:"flex-row-reverse"}),e.jsx(Jn,{view_id:h.ealViewId,value:h.disasterNumber,geoid:h.geoid,onChange:x=>f({...h,disasterNumber:x}),className:"flex-row-reverse"}),e.jsx(ze,{label:"Type:",types:Object.keys(Kt).map(x=>({label:x.replace("_"," "),value:x})),type:h.type,setType:x=>{f({...h,colors:Kt[x].colors||Vi,type:x})}}),!Kt[h.type].colors&&e.jsx(cl,{title:"Colors: ",numColors:h.numColors,setNumColors:x=>f({...h,numColors:x}),shade:h.shade,setShade:x=>f({...h,shade:x}),colors:h.colors,setColors:x=>f({...h,colors:x})}),e.jsx(ze,{label:"Size:",types:[{label:"X Small",value:200},{label:"Small",value:500},{label:"Medium",value:700},{label:"Large",value:900}],type:h.height,setType:x=>f({...h,height:x})})]}),d?e.jsx(dt,{}):p?e.jsx("div",{className:"p-5 text-center",children:p}):e.jsxs(w.Fragment,{children:[e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${h.height}px`},children:e.jsx(sd,{falcor:r,layerProps:g,legend:{size:n,domain:(h==null?void 0:h.domain)||[],range:h.colors,title:h.title,show:Kt[h.type].legend!==!1}})}),e.jsx(ct,{baseUrl:i,attributionData:h.attributionData})]})]})})};ag.settings={hasControls:!0,name:"ElementEdit"};const X$=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);const n="/",r=s==null?void 0:s.attributionData,a={ccl:{...s}};return e.jsxs("div",{className:"relative w-full p-6",children:[e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${s.height}px`},children:e.jsx(_r,{layerProps:a,legend:{size:s.size,domain:(s==null?void 0:s.domain)||[],range:s.colors,title:s.title,show:s.showLegend}})}),e.jsx(ct,{baseUrl:n,attributionData:r})]})},Q$={name:"Map: FEMA Disaster Loss",type:"Map",variables:[{name:"geoid",default:"36"},{name:"disasterNumber",default:"1406"},{name:"ealViewId",default:837,hidden:!0},{name:"type",hidden:!0},{name:"size",hidden:!0},{name:"height",hidden:!0}],getData:ng,EditComp:ag,ViewComp:X$},xs={title:function(t,s,n){const r=Object.keys(this.consequences).find(l=>this.consequences[l]===n),a=Object.keys(this.attributes).find(l=>this.attributes[l]===s);return`NRI ${t} ${r||""} ${a}`},type:"nri",attributes:{"Average # of events per year":"afreq",Exposure:"exp",EAL:"eal"},consequences:{Property:"b",Crop:"a",Population:"p","Population $":"pe",Total:"t"},dataSources:[{label:"NRI Counties",value:"nri",geoLayer:"counties",geomCol:"stcofips",geomView:285},{label:"NRI Census Tracts",value:"nri_tracts",geoLayer:"tracts",geomCol:"tractfips",geomView:285},{label:"AVAIL EAL",value:"avail_counties",geoLayer:"counties",geomCol:"stcofips",geomView:285}]},Hl={"1/3":236,"2/3":420,"1/2":420,2:420,1:420,[void 0]:420},eE=(t,s,n)=>{if(t.showLegend===!1)return null;const r=s.getContext("2d");r.drawImage(n,0,0);let a=0,l=20,i=t.legend.title?80:50;if(r.fillStyle="white",r.roundRect(a,l,Hl[t==null?void 0:t.size]+15,i,5),r.fill(),t.legend.title){r.font=((t==null?void 0:t.size)==="1/3","1rem Arial"),r.fillStyle="#232323",l+=20;const m=t.legend.title;r.fillText(m,a+10,l,Hl[t==null?void 0:t.size]),l+=10}a+=10,l+=10;const c=Hl[t.size]/(t.legend.range.length+1.1);t.legend.range.forEach((m,h)=>{r.fillStyle=m,r.fillRect(a+h*c,l,c,20)}),r.fillStyle="#d0d0ce",r.fillRect(5+a+t.legend.range.length*c,l,c,20);let d;switch(t.legend.type){case"quantile":d=wa().domain(t.legend.domain).range(t.legend.range);break;case"quantize":d=Hn().domain(t.legend.domain).range(t.legend.range);break;case"threshold":d=ps().domain(t.legend.domain).range(t.legend.range);break}const u=typeof t.legend.format=="function"?t.legend.format:il(t.legend.format);return a+=3,l+=33,r.fillStyle="#232323",r.font=(t==null?void 0:t.size)==="1/3"?"10px Arial":"11px Arial",r.textAlign="right",t.legend.range.forEach((m,h)=>{const f=u(d==null?void 0:d.invertExtent(m)[1]);r.fillText(f,a+c+h*c,l)}),r.fillText("N/A",5+a+c+t.legend.range.length*c,l),0};let tE=class extends ml{constructor(n){super(n);ye(this,"name","ccl");ye(this,"id","ccl");ye(this,"data",[]);ye(this,"sources",[{id:"counties",source:{type:"vector",url:"https://tiles.availabs.org/data/tiger_carto.json"}},{id:"cosubs",source:{type:"vector",tiles:["https://graph.availabs.org/dama-admin/hazmit_dama/tiles/1003/{z}/{x}/{y}/t.pbf?cols=substring(geoid, 1, 5) as geoid"],format:"pbf"}},{id:"tracts",source:{type:"vector",url:"https://tiles.availabs.org/data/tl_2020_36_tract.json"}}]);ye(this,"layers",[{id:"counties",source:"counties","source-layer":"s365_v778",type:"fill",paint:{"fill-color":"#e1e1e1"}},{id:"tracts",source:"tracts","source-layer":"tl_2020_36_tract",type:"fill",paint:{"fill-color":"#e1e1e1"}},{id:"counties-line",source:"counties","source-layer":"s365_v778",type:"line",paint:{"line-width":["interpolate",["linear"],["zoom"],5,2,22,4],"line-color":"#000","line-opacity":.5}},{id:"cosubs-line",source:"cosubs","source-layer":"view_1003",type:"line",paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,22,1.5],"line-dasharray":[2,2],"line-color":"#999","line-opacity":.7}}]);ye(this,"legend",{Title:n=>"",type:"threshold",format:"0.2s",domain:[0,25,50,75,100],range:ds(5,"RdYlGn",!1),show:!0});ye(this,"onClick",{layers:["counties","tracts"],callback:(n,r)=>{this.props.onClick&&this.props.onClick(n,r)}})}init(n,r,a){n.fitBounds([-125.0011,24.9493,-66.9326,49.5904],{duration:0}),n.on("idle",l=>{const i=document.querySelector("canvas.maplibregl-canvas"),c=document.createElement("canvas");let d;c.width=i.width,c.height=i.height,c.getContext("2d").drawImage(i,0,0),eE({legend:this.legend,showLegend:this.props.showLegend,filters:this.filters,size:this.props.size},c,i),d=c.toDataURL(),this.img=d,this.props.change&&this.props.change({filters:this.filters,img:d,bounds:n.getBounds(),legend:this.legend,style:this.style})})}handleMapFocus(n,r){if(r.mapFocus)try{n.fitBounds(r.mapFocus,{duration:0,padding:50})}catch{n.fitBounds([-125.0011,24.9493,-66.9326,49.5904],{duration:0})}else n.fitBounds([-125.0011,24.9493,-66.9326,49.5904],{duration:0})}paintMap(n,r){let{geoColors:a={},domain:l=[],colors:i=[],title:c="",geoLayer:d="counties"}=r;this.legend.domain=l,this.legend.range=i,this.legend.title=c;const u=d==="counties"?"tracts":"counties";n.setLayoutProperty(d,"visibility","visible"),n.setFilter(d,["in",["get","geoid"],["literal",Object.keys(a)]]),n.setPaintProperty(d,"fill-color",["get",["get","geoid"],["literal",a]]);const p=[...new Set(Object.keys(a).map(m=>m.substring(0,5)))];n.setLayoutProperty("counties-line","visibility","visible"),n.setFilter("counties-line",["in",["get","geoid"],["literal",p]]),n.setLayoutProperty("cosubs-line","visibility","visible"),n.setFilter("cosubs-line",["in",["get","geoid"],["literal",p]]),n.setLayoutProperty(u,"visibility","none")}receiveProps(n,r,a,l){this.paintMap(a,n),this.handleMapFocus(a,n)}};const sE=(t={})=>new tE(t),nE={"1/3":236,"2/3":420,"1/2":420,2:420,1:420,[void 0]:420};function aE(t,s,n){let r={svg:null,x:0,y:0,mimetype:"image/png",quality:.92,width:"auto",height:"auto",outputFormat:"base64"};for(let a in t)r[a]=t[a];return new Promise(function(a,l){let i;if(typeof r.svg=="string"){let p=document.createElement("div");p.style.display="none",p.innerHTML=r.svg,i=p.firstElementChild}else i=r.svg;let c=new XMLSerializer().serializeToString(i),d="data:image/svg+xml;base64,"+btoa(c);const u=new Image;u.onload=function(){let p,m;r.width==="auto"&&r.height!=="auto"?p=this.width/this.height*r.height:r.width==="auto"?p=this.naturalWidth:p=r.width,r.height==="auto"&&r.width!=="auto"?m=this.height/this.width*r.width:r.height==="auto"?m=this.naturalHeight:m=r.height,s.drawImage(this,t.x,t.y,p,m),a(n.toDataURL(r.mimetype,r.quality))},u.src=d})}const rE=async(t,s,n)=>{if(t.showLegend===!1)return null;const r=s.getContext("2d");let a=0,l=20,i=nE[t==null?void 0:t.size];if(t.legend.title){r.font=((t==null?void 0:t.size)==="1/3","1rem Arial"),r.fillStyle="#232323",l+=20;const p=t.legend.title;r.fillText(p,a+10,l,i),l+=10}var c=document.getElementById("legend_svg");let{width:d,height:u}=c.getBBox();return await aE({svg:document.getElementById("legend_svg"),mimetype:"image/png",x:a,y:l,width:d,height:u,quality:1,outputFormat:"base64"},r,s).then(function(p){r.drawImage(n,0,0)}).catch(function(p){console.error(p)}),0};class oE extends ml{constructor(n){super(n);ye(this,"name","ccl");ye(this,"id","ccl");ye(this,"data",[]);ye(this,"sources",[{id:"counties",source:{type:"vector",url:"https://tiles.availabs.org/data/tiger_carto.json"}},{id:"cousub-label-points",source:{type:"geojson",data:{type:"FeatureCollection",features:[]}}},{id:"tracts",source:{type:"vector",url:"https://tiles.availabs.org/data/tl_2020_36_tract.json"}},{id:"cosubs",source:{type:"vector",tiles:["https://graph.availabs.org/dama-admin/hazmit_dama/tiles/1003/{z}/{x}/{y}/t.pbf?cols=substring(geoid, 1, 5) as geoid,namelsad"],format:"pbf"}},{id:"circles",source:{type:"geojson",data:{type:"FeatureCollection",features:[]}}}]);ye(this,"layers",[{id:"counties",source:"counties","source-layer":"s365_v778",type:"fill",paint:{"fill-color":"#e1e1e1"}},{id:"counties-line",source:"counties","source-layer":"s365_v778",type:"line",paint:{"line-width":["interpolate",["linear"],["zoom"],5,2,22,4],"line-color":"#000","line-opacity":.5}},{id:"cosubs-line",source:"cosubs","source-layer":"view_1003",type:"line",paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,22,1.5],"line-dasharray":[2,2],"line-color":"#999","line-opacity":.7}},{id:"tracts",source:"tracts","source-layer":"tl_2020_36_tract",type:"fill",paint:{"fill-color":"#e1e1e1"}},{id:"tracts-line",source:"tracts","source-layer":"tl_2020_36_tract",type:"line",paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,22,2],"line-color":"#ffffff","line-opacity":.3}},{id:"circles",source:"circles",type:"circle",paint:{"circle-color":["get","color"],"circle-stroke-color":["get","borderColor"],"circle-stroke-width":1,"circle-opacity":.5,"circle-radius":["get","radius"]}},{id:"cousub-labels",source:"cousub-label-points",type:"symbol",layout:{"text-field":["get","namelsad"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":.5,"text-justify":"auto","text-size":10},paint:{"text-color":"#343434"}}]);ye(this,"legend",{Title:n=>"",type:"threshold",format:"0.2s",domain:[0,25,50,75,100],range:ds(5,"RdYlGn",!1),show:!0})}init(n,r,a){n.fitBounds([-125.0011,24.9493,-66.9326,49.5904],{duration:0}),n.on("idle",async l=>{const i=document.querySelector("canvas.maplibregl-canvas"),c=document.createElement("canvas");let d;c.width=i.width,c.height=i.height;const u=c.getContext("2d");this.props.showLegend?await rE({legend:this.legend,showLegend:this.props.showLegend,filters:this.filters,size:this.props.size},c,i):(u.beginPath(),u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.drawImage(i,0,0)),d=c.toDataURL(),this.img=d,this.props.change&&this.props.change({filters:this.filters,img:d,bounds:n.getBounds(),legend:this.legend,style:this.style})})}handleMapFocus(n,r){if(r.mapFocus)try{n.fitBounds(r.mapFocus,{duration:0})}catch{n.fitBounds([-125.0011,24.9493,-66.9326,49.5904],{duration:0})}else n.fitBounds([-125.0011,24.9493,-66.9326,49.5904],{duration:0})}paintMap(n,r){let{geoColors:a={},domain:l=[],colors:i=[],title:c="",geoLayer:d="counties",geoJson:u={}}=r;this.legend.domain=l,this.legend.range=i,this.legend.title=c;const p=d==="counties"?"tracts":"counties";n.setFilter(d,["in",["get","geoid"],["literal",Object.keys(a)]]),n.setFilter(`${d}-line`,["in",["get","geoid"],["literal",Object.keys(a)]]),n.setLayoutProperty(p,"visibility","none"),n.setLayoutProperty(`${p}-line`,"visibility","none"),n.getSource("circles").setData(u);const m=[...new Set(Object.keys(a).map(f=>f.substring(0,5)))];n.setLayoutProperty("counties-line","visibility","visible"),n.setFilter("counties-line",["in",["get","geoid"],["literal",m]]),n.setLayoutProperty("cosubs-line","visibility","visible"),n.setFilter("cosubs-line",["in",["get","geoid"],["literal",m]]);let h=[];setTimeout(function(){h=n.queryRenderedFeatures({layers:["cosubs-line"]});let f=h.reduce((g,x)=>{if(!g[x.properties.namelsad])g[x.properties.namelsad]=x;else{let y=My({type:"FeatureCollection",features:[g[x.properties.namelsad],x]});g[x.properties.namelsad]=y,g[x.properties.namelsad].properties=x.properties}return g},[]);console.log("rendered features",h,f),n.getSource("cousub-label-points").setData({type:"FeatureCollection",features:Object.values(f).map((g,x)=>({type:"Feature",id:x,properties:g.properties,geometry:{type:"Point",coordinates:kd(g.geometry).geometry.coordinates}}))}),console.log("label features",{type:"FeatureCollection",features:Object.values(f).map((g,x)=>({type:"Feature",id:x,properties:g.properties,geometry:{type:"Point",coordinates:kd(g.geometry).geometry.coordinates}}))})},500)}receiveProps(n,r,a,l){this.paintMap(a,n),this.handleMapFocus(a,n)}}const lE=(t={})=>new oE(t),sm={"1/3":290,"2/3":370,"1/2":370,2:370,1:370,[void 0]:370},iE=({size:t,domain:s,range:n,fmt:r,title:a})=>{const l=({value:i,color:c,fmt:d,className:u,i:p})=>{const m=`${sm[t]/(n.length+1)}px`,h="40px",f="20px";return e.jsxs("div",{className:`flex flex-col h-[${h}] ${u}`,style:{width:m},children:[e.jsx("div",{className:`h-[${f}]`,style:{backgroundColor:c,width:m}}),e.jsx("div",{className:`h-[${f}] text-xs text-right`,style:{width:m},children:d?d(i):i})]},p)};return e.jsxs("div",{className:`relative w-[${sm[t]}px] float-left mt-[20px] m-5 -mb-[100px] rounded-md`,style:{zIndex:10},children:[a&&e.jsx("label",{className:"font-sm pl-2",children:a}),e.jsxs("div",{className:"flex flex-row justify-center inline-block align-middle pt-2.5",children:[n.map((i,c)=>e.jsx(l,{i:c,value:s[c],color:i,fmt:r},c)),e.jsx(l,{value:"N/A",color:"#d0d0ce",className:"ml-1"})]})]})},cE=({size:t,domain:s,range:n,fmt:r,title:a})=>{const l=Math.min(...s.filter(d=>d)),i=Math.max(...s.filter(d=>d)),c=({value:d,color:u,fmt:p,className:m})=>{var h=110,f=150,g=lt("#legend > svg").attr("width",f).attr("height",h),x=js().domain([l,i]).range(n),y=[l,i],j=60,N=120,_=105;g.selectAll("legend").data(y).enter().append("circle").attr("cx",j).attr("cy",function(E){return _-+x(E)}).attr("r",function(E){return+x(E)}).style("fill","none").attr("stroke","#3f3f3f"),g.selectAll("legend").data(y).enter().append("line").attr("x1",function(E){return j+x(E)}).attr("x2",N).attr("y1",function(E){return _-x(E)}).attr("y2",function(E){return _-x(E)}).attr("stroke","black").style("stroke-dasharray","2,2"),g.selectAll("legend").data(y).enter().append("text").attr("x",N).attr("y",function(E){return _-x(E)}).text(function(E){return p(E)}).style("font-size",12).attr("alignment-baseline","middle")};return e.jsxs("div",{className:"absolute float-left mt-[20px] m-5 rounded-md",style:{zIndex:10},children:[a&&e.jsx("label",{className:"font-md pl-2",children:a}),e.jsxs("div",{className:"flex flex-col justify-center inline-block align-middle pt-2.5",children:[e.jsx("div",{id:"legend",children:e.jsx("svg",{id:"legend_svg",xmlns:"http://www.w3.org/2000/svg"})}),e.jsx(c,{value:i,fmt:r})]})]})},dE=({domain:t=[],range:s=[],title:n,scaleType:r="quantile",type:a="Choropleth",format:l="0.2s",size:i,show:c=!0})=>{if(!c)return null;switch(r){case"linear":js().domain([Math.min(...t),Math.max(...t)]).range(s);break;case"quantile":wa().domain(t).range(s);break;case"quantize":Hn().domain(t).range(s);break;case"threshold":ps().domain(t).range(s);break}const d=typeof l=="function"?l:il(l);return a==="Choropleth"?e.jsx(iE,{domain:t,range:s,fmt:d,size:i,title:n}):e.jsx(cE,{domain:t,range:s,fmt:d,size:i,title:n})},uE={type:"pmtiles",protocolInit:t=>{const s=new X0;return t.addProtocol("pmtiles",s.tile),s},sourceInit:(t,s,n)=>{const r=new Po(s.url);t.add(r)}},qs=({falcor:t,layerProps:s,legend:n,interactive:r=!0,layers:a=["Choropleth"]})=>{const l={Choropleth:sE,Circles:lE},i=w.useRef(a.map(c=>l[c]()));return e.jsxs("div",{className:"relative w-full h-full ",children:[e.jsx(dE,{...n}),e.jsx(ul,{falcor:t,mapOptions:{protocols:[uE],interactive:r,navigationControl:!1,styles:[{name:"blank",style:{sources:{},version:8,layers:[{id:"background",type:"background",layout:{visibility:"visible"},paint:{"background-color":"rgba(208, 208, 206, 0)"}}],glyphs:"https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=mU28JQ6HchrQdneiq6k9",sprite:"https://api.maptiler.com/maps/satellite/sprite"}},{name:"Light",style:"https://api.maptiler.com/maps/dataviz-light/style.json?key=mU28JQ6HchrQdneiq6k9"}]},navigationControl:!1,layers:i.current,layerProps:s,CustomSidebar:()=>e.jsx("div",{})}),e.jsx("div",{className:"px-6 py-10 absolute bottom-0 right-0",children:e.jsx("i",{className:" text-2xl text-slate-400 -rotate-45 fal fa-location-circle"})})]})},rg=(t=[],s=[])=>!(t!=null&&t.length)||!(s!=null&&s.length)?[]:t!=null&&t.length&&(s!=null&&s.length)?dl(t,Math.min(t==null?void 0:t.length,s==null?void 0:s.length)):[],mE=(t,s)=>{const n=rg(t,s);return ps().domain(n).range(s)},pE=({geoid:t,data:s=[],columns:n=[],paintFn:r,colors:a=[],...l})=>{if(!(s!=null&&s.length)||!(a!=null&&a.length))return{};s.map(u=>u.geoid);const i={},c=mE(s.map(u=>r?r(u):u[n==null?void 0:n[0]]).filter(u=>u),a),d=rg(s.map(u=>r?r(u):u[n==null?void 0:n[0]]).filter(u=>u),a);return s.forEach(u=>{const p=r?r(u):u[n==null?void 0:n[0]];i[u.geoid]=p?c(p):"#d0d0ce"}),{geoColors:i,domain:d}};async function og({geoAttribute:t,geoid:s,version:n,attribute:r,colors:a,title:l,dataSource:i,size:c,height:d,hazard:u,consequence:p,typeId:m,dataSourceSRCId:h,dataSourceViewId:f,numColors:g,shade:x},y){var W,Y,U,q,te,K,ne;const _=(W=xs.dataSources.find(J=>J.value===i))==null?void 0:W.geomCol,E=[u==="total"?`eal_val${p||"t"}`:`${(Y=Ne[u])==null?void 0:Y.prefix}_${r}${p||""}`],L=JSON.stringify({filter:{[`substring(${_}, 1, ${(U=s==null?void 0:s.toString())==null?void 0:U.length})`]:[s]}}),S={geoid:`${_} as geoid`,...(E||[]).reduce((J,ae)=>({...J,[ae]:`${ae}`}),{})},k=J=>["dama",oe,"viewsbyId",J,"options",L],$=J=>["dama",oe,"views","byId",J,"attributes",["source_id","view_id","version","_modified_timestamp"]],I=await y.get([...k(m),"length"],$(m)),T=C(I,["json",...k(m),"length"]),A=await y.get([...k(m),"databyIndex",{from:0,to:T-1},Object.values(S)]);let R=Object.values(C(A,["json",...k(m),"databyIndex"],{}));R=[...Array(T).keys()].map(J=>Object.keys(S).reduce((ae,de)=>({...ae,[de]:R[J][S[de]]}),{}));const O=["st_asgeojson(st_orientedenvelope(st_union(geom)), 9, 1)  as geom"],M={from:0,to:0},D=C(R,[0,"geoid"])||((q=s==null?void 0:s.toString())==null?void 0:q.substring(0,2)),P=J=>{var ae;return["dama",oe,"viewsbyId",J,"options",JSON.stringify({filter:{geoid:[((ae=s==null?void 0:s.toString())==null?void 0:ae.length)>=5?s:D.substring(0,2)]}}),"databyIndex"]},F=await y.get([...P(((te=s==null?void 0:s.toString())==null?void 0:te.length)===5?286:285),M,O]),B=C(F,["json",...P(((K=s==null?void 0:s.toString())==null?void 0:K.length)===5?286:285),0,O]),V=C(JSON.parse(B),"bbox"),{geoColors:G,domain:Z}=pE({geoid:s,data:R,columns:E,paintFn:xs.paintFn,colors:a}),X=C(y.getCache(),["dama",oe,"views","byId",m,"attributes"],{}),H=(ne=xs.dataSources.find(J=>J.value===i))==null?void 0:ne.geoLayer;return{data:R,geoAttribute:t,geoid:s,version:n,attribute:r,colors:a,mapFocus:V,attributionData:X,geoColors:G,domain:Z,geoLayer:H,layerProps:{ccl:{view:xs,data:R,geoColors:G,mapFocus:V,domain:Z,colors:a,title:l,hazard:u,attribute:r,consequence:p,dataSource:i,dataSourceSRCId:h,dataSourceViewId:f,geoLayer:H,height:d,size:c}},title:l,dataSource:i,size:c,height:d,dataSourceSRCId:h,dataSourceViewId:f,hazard:u,consequence:p,typeId:m,numColors:g,shade:x}}const lg=({value:t,onChange:s,size:n})=>{const{falcor:r,falcorCache:a}=et();let l=t&&tt(t)?JSON.parse(t):{};const i="/",[c,d]=b.useState((l==null?void 0:l.dataSource)||"avail_counties"),[u,p]=b.useState(l==null?void 0:l.dataSourceSRCId),[m,h]=b.useState(l==null?void 0:l.dataSourceViewId),[f,g]=b.useState(l==null?void 0:l.typeId),[x,y]=b.useState(!0),[j,N]=b.useState(l==null?void 0:l.status),[_,E]=b.useState((l==null?void 0:l.geoid)||"36"),[L,S]=b.useState((l==null?void 0:l.hazard)||"total");b.useState(l==null?void 0:l.data);const[k,$]=b.useState((l==null?void 0:l.attribute)||"eal"),[I,T]=b.useState((l==null?void 0:l.consequence)||"t");b.useState(l==null?void 0:l.mapFocus);const[A,R]=b.useState((l==null?void 0:l.numColors)||5),[O,M]=b.useState((l==null?void 0:l.shade)||"Oranges"),[D,P]=b.useState((l==null?void 0:l.colors)||Js(5,"Oranges")),[F,B]=b.useState(l==null?void 0:l.title),[V,G]=b.useState((l==null?void 0:l.height)||500),Z=X=>["dama",oe,"viewDependencySubgraphs","byViewId",X];return b.useEffect(()=>{y(!0),p({avail_counties:343,nri:159,nri_tracts:346}[c])},[c]),b.useEffect(()=>{async function X(){if(y(!0),c==="avail_counties"){const H=await r.get(Z(m)),W=C(H,["json",...Z(m),"dependencies"],[]).find(Y=>Y.type==="nri");if(!W)return y(!1),N("This component only supports EAL versions that use Fusion data."),Promise.resolve();g(W.view_id)}else g(m)}X()},[u,m]),b.useEffect(()=>{async function X(){var z;if(!_||!L||!k||k!=="afreq"&&!I)return!I&&N("Please Select a Consequence."),!k&&N("Please Select an Attribute."),!L&&N("Please Select a Hazard."),!_&&N("Please Select a Geography."),Promise.resolve();N(void 0),y(!0),N(void 0),B(xs.title(L==="total"?"":(z=Ne[L])==null?void 0:z.name,k,I));const H=await og({geoid:_,attribute:k,colors:D,title:F,dataSource:c,size:n,height:V,hazard:L,consequence:I,typeId:f,dataSourceSRCId:u,dataSourceViewId:m,numColors:A,shade:O},r);s(JSON.stringify({...H})),y(!1)}X()},[f,_,L,k,I,A,O,D,F,c,n,V,u,m]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(ze,{label:"Data Source:",types:xs.dataSources,type:c,setType:X=>{h(void 0),p(void 0),d(X)}}),e.jsx(Ct,{source_id:u,view_id:m,onChange:h,className:"flex-row-reverse"}),e.jsx(rt,{value:_,onChange:E,className:"flex-row-reverse"}),e.jsx(Gs,{hazard:L,setHazard:X=>{X==="total"&&$("eal"),S(X)},showTotal:!0}),e.jsx(ze,{label:"Attribute:",types:Object.keys(xs.attributes).map(X=>({label:X.replace("_"," "),value:xs.attributes[X]})),type:k,setType:X=>{$(X),X==="afreq"&&T(null)},disabled:!L||L==="total",disabledTitle:"Please Select a Hazard."}),e.jsx(ze,{label:"Consequence:",types:Object.keys(xs.consequences).filter(X=>{var H,z;return!L||L==="total"?!["Population","Population $"].includes(X):(z=(H=Ne[L])==null?void 0:H.consequences)==null?void 0:z.includes(xs.consequences[X])}).map(X=>({label:X.replace("_"," "),value:xs.consequences[X]})),type:I,setType:T,disabled:k==="afreq"||!k,disabledTitle:"Frequency is independent of Consequence.",autoSelect:!1}),e.jsx(cl,{title:"Colors: ",numColors:A,setNumColors:R,shade:O,setShade:M,colors:D,setColors:P}),e.jsx(ze,{label:"Size:",types:[{label:"Small",value:500},{label:"Medium",value:700},{label:"Large",value:900}],type:V,setType:X=>{G(X)}})]}),x?e.jsx(dt,{}):j?e.jsx("div",{className:"p-5 text-center",children:j}):e.jsxs(w.Fragment,{children:[e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${V}px`},children:e.jsx(qs,{interactive:!0,falcor:r,layerProps:l.layerProps,legend:{domain:l.domain,range:D,title:F,size:n}})}),e.jsx(ct,{baseUrl:i,attributionData:l.attributionData})]})]})})};lg.settings={hasControls:!0,name:"ElementEdit"};const hE=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);const n="/",r=s==null?void 0:s.attributionData;return e.jsxs("div",{className:"relative w-full p-6",children:[s.img?e.jsx("div",{className:"h-80vh flex-1 flex flex-col",children:e.jsx("img",{alt:"Choroplath Map",src:C(s,["img"])})}):e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${s.height}px`},children:e.jsx(qs,{interactive:!1,layerProps:s.layerProps,legend:{size:s.size,domain:(s==null?void 0:s.domain)||[],range:s.colors,title:s.title,show:s.showLegend}})}),e.jsx(ct,{baseUrl:n,attributionData:r})]})},fE={name:"Map: NRI",type:"Map",variables:[{name:"geoid",default:"36"},{name:"dataSources",hidden:!0},{name:"dataSource",hidden:!0},{name:"version",hidden:!0},{name:"geoAttribute",hidden:!0},{name:"hazard",hidden:!0},{name:"consequence",hidden:!0},{name:"attribute",default:"eal",hidden:!0},{name:"typeId",hidden:!0},{name:"dataSourceSRCId",hidden:!0},{name:"dataSourceViewId",hidden:!0},{name:"title",hidden:!0},{name:"dataSource",hidden:!0},{name:"size",hidden:!0},{name:"height",hidden:!0},{name:"numColors",hidden:!0},{name:"shade",hidden:!0},{name:"colors",hidden:!0,default:Js(5,"Oranges")}],getData:og,EditComp:lg,ViewComp:hE},nm=["36000","36001","36002","36003","36004","36005","36006","36007","36008","36009","36010","36011","36012","36013","36014","36015","36016","36017","36018","36019","36020","36021","36022","36023","36024","36025","36026","36027","36028","36029","36030","36031","36032","36033","36034","36035","36036","36037","36038","36039","36040","36041","36042","36043","36044","36045","36046","36047","36048","36049","36050","36051","36052","36053","36054","36055","36056","36057","36058","36059","36060","36061","36062","36063","36064","36065","36066","36067","36068","36069","36070","36071","36072","36073","36074","36075","36076","36077","36078","36079","36080","36081","36082","36083","36084","36085","36086","36087","36088","36089","36090","36091","36092","36093","36094","36095","36096","36097","36098","36099","36100","36101","36102","36103","36104","36105","36106","36107","36108","36109","36110","36111","36112","36113","36114","36115","36116","36117","36118","36119","36120","36121","36122","36123","36124","36125","36126","36127","36128","36129","36130","36131","36132","36133","36134","36135","36136","36137","36138","36139","36140","36141","36142","36143","36144","36145","36146","36147","36148","36149","36150","36151","36152","36153","36154","36155","36156","36157","36158","36159","36160","36161","36162","36163","36164","36165","36166","36167","36168","36169","36170","36171","36172","36173","36174","36175","36176","36177","36178","36179","36180","36181","36182","36183","36184","36185","36186","36187","36188","36189","36190","36191","36192","36193","36194","36195","36196","36197","36198","36199","36200","36201","36202","36203","36204","36205","36206","36207","36208","36209","36210","36211","36212","36213","36214","36215","36216","36217","36218","36219","36220","36221","36222","36223","36224","36225","36226","36227","36228","36229","36230","36231","36232","36233","36234","36235","36236","36237","36238","36239","36240","36241","36242","36243","36244","36245","36246","36247","36248","36249","36250","36251","36252","36253","36254","36255","36256","36257","36258","36259","36260","36261","36262","36263","36264","36265","36266","36267","36268","36269","36270","36271","36272","36273","36274","36275","36276","36277","36278","36279","36280","36281","36282","36283","36284","36285","36286","36287","36288","36289","36290","36291","36292","36293","36294","36295","36296","36297","36298","36299","36300","36301","36302","36303","36304","36305","36306","36307","36308","36309","36310","36311","36312","36313","36314","36315","36316","36317","36318","36319","36320","36321","36322","36323","36324","36325","36326","36327","36328","36329","36330","36331","36332","36333","36334","36335","36336","36337","36338","36339","36340","36341","36342","36343","36344","36345","36346","36347","36348","36349","36350","36351","36352","36353","36354","36355","36356","36357","36358","36359","36360","36361","36362","36363","36364","36365","36366","36367","36368","36369","36370","36371","36372","36373","36374","36375","36376","36377","36378","36379","36380","36381","36382","36383","36384","36385","36386","36387","36388","36389","36390","36391","36392","36393","36394","36395","36396","36397","36398","36399","36400","36401","36402","36403","36404","36405","36406","36407","36408","36409","36410","36411","36412","36413","36414","36415","36416","36417","36418","36419","36420","36421","36422","36423","36424","36425","36426","36427","36428","36429","36430","36431","36432","36433","36434","36435","36436","36437","36438","36439","36440","36441","36442","36443","36444","36445","36446","36447","36448","36449","36450","36451","36452","36453","36454","36455","36456","36457","36458","36459","36460","36461","36462","36463","36464","36465","36466","36467","36468","36469","36470","36471","36472","36473","36474","36475","36476","36477","36478","36479","36480","36481","36482","36483","36484","36485","36486","36487","36488","36489","36490","36491","36492","36493","36494","36495","36496","36497","36498","36499","36500","36501","36502","36503","36504","36505","36506","36507","36508","36509","36510","36511","36512","36513","36514","36515","36516","36517","36518","36519","36520","36521","36522","36523","36524","36525","36526","36527","36528","36529","36530","36531","36532","36533","36534","36535","36536","36537","36538","36539","36540","36541","36542","36543","36544","36545","36546","36547","36548","36549","36550","36551","36552","36553","36554","36555","36556","36557","36558","36559","36560","36561","36562","36563","36564","36565","36566","36567","36568","36569","36570","36571","36572","36573","36574","36575","36576","36577","36578","36579","36580","36581","36582","36583","36584","36585","36586","36587","36588","36589","36590","36591","36592","36593","36594","36595","36596","36597","36598","36599","36600","36601","36602","36603","36604","36605","36606","36607","36608","36609","36610","36611","36612","36613","36614","36615","36616","36617","36618","36619","36620","36621","36622","36623","36624","36625","36626","36627","36628","36629","36630","36631","36632","36633","36634","36635","36636","36637","36638","36639","36640","36641","36642","36643","36644","36645","36646","36647","36648","36649","36650","36651","36652","36653","36654","36655","36656","36657","36658","36659","36660","36661","36662","36663","36664","36665","36666","36667","36668","36669","36670","36671","36672","36673","36674","36675","36676","36677","36678","36679","36680","36681","36682","36683","36684","36685","36686","36687","36688","36689","36690","36691","36692","36693","36694","36695","36696","36697","36698","36699","36700","36701","36702","36703","36704","36705","36706","36707","36708","36709","36710","36711","36712","36713","36714","36715","36716","36717","36718","36719","36720","36721","36722","36723","36724","36725","36726","36727","36728","36729","36730","36731","36732","36733","36734","36735","36736","36737","36738","36739","36740","36741","36742","36743","36744","36745","36746","36747","36748","36749","36750","36751","36752","36753","36754","36755","36756","36757","36758","36759","36760","36761","36762","36763","36764","36765","36766","36767","36768","36769","36770","36771","36772","36773","36774","36775","36776","36777","36778","36779","36780","36781","36782","36783","36784","36785","36786","36787","36788","36789","36790","36791","36792","36793","36794","36795","36796","36797","36798","36799","36800","36801","36802","36803","36804","36805","36806","36807","36808","36809","36810","36811","36812","36813","36814","36815","36816","36817","36818","36819","36820","36821","36822","36823","36824","36825","36826","36827","36828","36829","36830","36831","36832","36833","36834","36835","36836","36837","36838","36839","36840","36841","36842","36843","36844","36845","36846","36847","36848","36849","36850","36851","36852","36853","36854","36855","36856","36857","36858","36859","36860","36861","36862","36863","36864","36865","36866","36867","36868","36869","36870","36871","36872","36873","36874","36875","36876","36877","36878","36879","36880","36881","36882","36883","36884","36885","36886","36887","36888","36889","36890","36891","36892","36893","36894","36895","36896","36897","36898","36899","36900","36901","36902","36903","36904","36905","36906","36907","36908","36909","36910","36911","36912","36913","36914","36915","36916","36917","36918","36919","36920","36921","36922","36923","36924","36925","36926","36927","36928","36929","36930","36931","36932","36933","36934","36935","36936","36937","36938","36939","36940","36941","36942","36943","36944","36945","36946","36947","36948","36949","36950","36951","36952","36953","36954","36955","36956","36957","36958","36959","36960","36961","36962","36963","36964","36965","36966","36967","36968","36969","36970","36971","36972","36973","36974","36975","36976","36977","36978","36979","36980","36981","36982","36983","36984","36985","36986","36987","36988","36989","36990","36991","36992","36993","36994","36995","36996","36997","36998","36999"];async function ig({geoid:t="36",ealViewId:s,size:n="1",height:r=500},a){return{ealViewId:s,geoid:t,title:"Flood Plain Map",sources:[{id:"hazmit_dama_s379_v841_1695834411623",source:{url:"pmtiles://graph.availabs.org/tiles/hazmit_dama_s379_v841_1695834411623.pmtiles",type:"vector"},protocol:"pmtiles"},{id:"counties",source:{type:"vector",url:"https://tiles.availabs.org/data/tiger_carto.json"}}],layers:[{id:"counties",source:"counties","source-layer":"s365_v778",type:"fill",filter:["in",["get","geoid"],["literal",nm]],paint:{"fill-color":"#d0d0ce"}},{id:"counties-line",source:"counties","source-layer":"s365_v778",type:"line",filter:["in",["get","geoid"],["literal",nm]],paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,22,2],"line-color":"#efefef","line-opacity":.5}},{id:"q3_500",type:"fill",filter:["all",["in","q3",["get","gfid"]],["==","X",["get","fld_zone"]]],paint:{"fill-color":"DodgerBlue","fill-opacity":1},source:"hazmit_dama_s379_v841_1695834411623","source-layer":"s379_v841"},{id:"q3_100",type:"fill",filter:["all",["in","q3",["get","gfid"]],["!=","X",["get","fld_zone"]]],paint:{"fill-color":"DodgerBlue","fill-opacity":.3},source:"hazmit_dama_s379_v841_1695834411623","source-layer":"s379_v841"},{id:"NFHL_500",type:"fill",filter:["all",["in","NHFL",["get","gfid"]],["==","X",["get","fld_zone"]]],paint:{"fill-color":"Orange","fill-opacity":1},source:"hazmit_dama_s379_v841_1695834411623","source-layer":"s379_v841"},{id:"NFHL_100",type:"fill",filter:["all",["in","NHFL",["get","gfid"]],["!=","X",["get","fld_zone"]]],paint:{"fill-color":"Orange","fill-opacity":.3},source:"hazmit_dama_s379_v841_1695834411623","source-layer":"s379_v841"},{id:"ble_500",type:"fill",filter:["all",["in","BLE",["get","gfid"]],["==","X",["get","fld_zone"]]],paint:{"fill-color":"green","fill-opacity":.5},source:"hazmit_dama_s379_v841_1695834411623","source-layer":"s379_v841"},{id:"ble_100",type:"fill",filter:["all",["in","BLE",["get","gfid"]],["!=","X",["get","fld_zone"]]],paint:{"fill-color":"green","fill-opacity":.3},source:"hazmit_dama_s379_v841_1695834411623","source-layer":"s379_v841"},{id:"PRELIMINARY_500",type:"fill",filter:["all",["in","PRELIMINARY",["get","gfid"]],["==","X",["get","fld_zone"]]],paint:{"fill-color":"magenta","fill-opacity":1},source:"hazmit_dama_s379_v841_1695834411623","source-layer":"s379_v841"},{id:"PRELIMINARY_100",type:"fill",filter:["all",["in","PRELIMINARY",["get","gfid"]],["!=","X",["get","fld_zone"]]],paint:{"fill-color":"magenta","fill-opacity":.3},source:"hazmit_dama_s379_v841_1695834411623","source-layer":"s379_v841"}],attributionData:{},size:n,height:r,domain:["FEMA Preliminary Maps","FEMA DFIRM","BLE","FEMA Q3 Map"],colors:["Magenta","Orange","Green","DodgerBlue"],mapFocus:[-79.761313,40.477399,-71.777491,45.01084],showLegend:!0}}const cg=({value:t,onChange:s,size:n})=>{const{falcor:r,falcorCache:a}=et();let l=b.useMemo(()=>t&&tt(t)?JSON.parse(t):{},[t]);const i="/",c=343,[d,u]=b.useState(!0),[p,m]=b.useState(""),[h,f]=b.useState({ealViewId:(l==null?void 0:l.ealViewId)||837,geoid:(l==null?void 0:l.geoid)||"36",type:(l==null?void 0:l.type)||"total_losses",data:l==null?void 0:l.data,mapFocus:l.mapFocus,title:l==null?void 0:l.title,height:(l==null?void 0:l.height)||500});b.useEffect(()=>{delete h.img,f({...h,...l})},[l]),b.useEffect(()=>{(async()=>{const{geoid:y,ealViewId:j,type:N,colors:_,height:E}=h;m(void 0),u(!0);let L=await ig({geoid:y,ealViewId:j,size:n,height:E});console.log("testing got data",t===JSON.stringify({...l,...L}),"args"),t!==JSON.stringify({...l,...L})&&s(JSON.stringify({...l,...L})),u(!1)})()},[h]);const g=b.useMemo(()=>(console.log("setting Layer Props",l),{ccl:{...l}}),[l]);return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:c,view_id:h.ealViewId,onChange:x=>f({...h,ealViewId:x}),className:"flex-row-reverse"}),e.jsx(ze,{label:"Size:",types:[{label:"X Small",value:200},{label:"Small",value:500},{label:"Medium",value:700},{label:"Large",value:900}],type:h.height,setType:x=>f({...h,height:x})})]}),d?e.jsx(dt,{}):p?e.jsx("div",{className:"p-5 text-center",children:p}):e.jsxs(w.Fragment,{children:[e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${h.height}px`},children:e.jsx(sd,{falcor:r,layerProps:g,legend:{size:n,domain:(h==null?void 0:h.domain)||[],range:h.colors,title:h.title,show:h.showLegend,format:x=>x,hideNA:!0}})}),e.jsx(ct,{baseUrl:i,attributionData:h.attributionData})]})]})})};cg.settings={hasControls:!0,name:"ElementEdit"};const gE=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);const n="/",r=s==null?void 0:s.attributionData,a={ccl:{...s}};return console.log("render view",s),e.jsxs("div",{className:"relative w-full p-6",children:[s.img?e.jsx("div",{className:"h-80vh flex-1 flex flex-col",children:e.jsx("img",{alt:"Choroplath Map",src:C(s,["img"])})}):e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${s.height}px`},children:e.jsx(_r,{layerProps:a,legend:{size:s.size,domain:(s==null?void 0:s.domain)||[],range:s.colors,title:s.title,format:l=>l,show:s.showLegend}})}),e.jsx(ct,{baseUrl:n,attributionData:r})]})},xE={name:"Map: Floodplains",type:"Map",variables:[{name:"geoid",default:"36"},{name:"ealViewId",default:837,hidden:!0}],getData:ig,EditComp:cg,ViewComp:gE},zl={'{"flood_zone":["AH","A","VE","AO","AE"]}':{color:"#6e0093",name:"1%"},'{"flood_zone":["X"]}':{color:"#2a6400",name:"0.2%"}},bE={[JSON.stringify({value_source:["ogs"]})]:"State Owned",[JSON.stringify({critical:["not null"]})]:"Critical"},dg=({floodPlain:t=[],hazard:s=[],buildingType:n})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{children:[bE[n]," assets in high hazard risk areas"]}),e.jsxs("div",{className:"flex flex-rows flex-wrap gap-2 text-xs align-middle",children:[Array.isArray(t)&&(t!=null&&t.length)?t.map(r=>{var a,l,i;return e.jsxs("div",{className:"h-full flex",children:[e.jsx("span",{className:"rounded-full m-1 shrink-0",style:{height:"10px",width:"10px",backgroundColor:(a=zl[r])==null?void 0:a.color}}),e.jsx("label",{className:"pl-1",children:(l=zl[r])==null?void 0:l.name})]},(i=zl[r])==null?void 0:i.name)}):null,Object.keys(Ne).filter(r=>!s||s.includes(r)).sort((r,a)=>Ne[r].name.localeCompare(Ne[a].name)).map(r=>e.jsxs("div",{className:"h-full flex flex-wrap",children:[e.jsx("span",{className:"rounded-full m-1 shrink-0",style:{height:"10px",width:"10px",backgroundColor:C(Ne,[r,"color"],"#d0d0ce")}}),e.jsx("label",{className:"pl-1",children:Ne[r].name})]},r))]})]}),yE=({geoid:t,data:s=[],columns:n=[],geoAttribute:r,paintFn:a})=>{var d,u,p;if(!(s!=null&&s.length))return{};const l=s.map(m=>m[r]),i=(((d=t==null?void 0:t.toString())==null?void 0:d.substring(0,2))||l[0]||"00").substring(0,2),c={};if((u=l[0])==null||u.toString().length,((p=t==null?void 0:t.toString())==null?void 0:p.length)===5)c[t]="#d3d3d3";else for(let m=0;m<=999;m+=1){const h=i+m.toString().padStart(3,"0"),f=s.find(x=>x.geoid===h)||{},g=a?a(f):f[n==null?void 0:n[0]];c[h]=l.includes(h)&&g?colorScale(g):"#d3d3d3"}return{geoColors:c,geoLayer:"counties"}},vE=t=>{try{return JSON.parse(t)}catch{return null}},jE=(t,s)=>s.filter(n=>t[`nri_${Ne[n].prefix}_eals`]>=0).sort((n,r)=>+t[`nri_${Ne[r].prefix}_eals`]-+t[`nri_${Ne[n].prefix}_eals`])[0],wE=({data:t=[],hazard:s,floodPlain:n})=>{const r={100:"#6e0093",500:"#2a6400"},a=2;return{type:"FeatureCollection",features:t.map(i=>{var d;const c=n.length&&["AH","A","VE","AO","AE"].includes(i.flood_zone)?r[100]:n.length&&["X"].includes(i.flood_zone)?r[500]:(d=Ne[jE(i,s)])==null?void 0:d.color;return{type:"Feature",properties:{color:c,borderColor:c,radius:a,...i},geometry:vE(i["st_asgeojson(st_centroid(footprint)) as building_centroid"])}})}};async function ug({geoAttribute:t,geoid:s,version:n,hazard:r,colors:a,title:l,dataSource:i,size:c,height:d,floodPlain:u,numColors:p,buildingType:m,hazardScoreThreshold:h},f){var Z,X,H,z;const y=JSON.stringify({filter:{...t&&{[`substring(${t}::text, 1, ${(Z=s==null?void 0:s.toString())==null?void 0:Z.length})`]:[s]},...JSON.parse(m||"{}")}}),j=["dama",oe,"viewsbyId",n,"options",y,"length"],N=["dama",oe,"viewsbyId",n,"options",y,"databyIndex"],_=["building_id","address","st_asgeojson(st_centroid(footprint)) as building_centroid",...Array.isArray(r)?r.map(W=>{var Y;return`nri_${(Y=Ne[W])==null?void 0:Y.prefix}_eals`}):[],"flood_zone"],E=["dama",oe,"views","byId",n,"attributes"],L=["source_id","view_id","version","_modified_timestamp"];await f.get(j);const S=C(f.getCache(),j,0);await f.get([...N,{from:0,to:S-1},[t,..._]]),await f.get([...E,L]),console.log("d?",Object.values(C(f.getCache(),N,{})),r,u);const k=Object.values(C(f.getCache(),N,{})).filter(W=>(r==null?void 0:r.length)&&r.reduce((Y,U)=>{var q,te;return Y||typeof W[`nri_${(q=Ne[U])==null?void 0:q.prefix}_eals`]!="object"&&W[`nri_${(te=Ne[U])==null?void 0:te.prefix}_eals`]>=h},!1)||(u==null?void 0:u.length)&&u.reduce((Y,U)=>{var q;return Y||typeof W.flood_zone!="object"&&(((q=JSON.parse(U))==null?void 0:q.flood_zone)||[]).includes(W.flood_zone)},!1)),$=["st_asgeojson(st_orientedenvelope(st_union(geom)), 9, 1)  as geom"],I={from:0,to:0},T=C(k,[0,"geoid"])||((X=s==null?void 0:s.toString())==null?void 0:X.substring(0,2)),A=W=>{var Y;return["dama",oe,"viewsbyId",W,"options",JSON.stringify({filter:{geoid:[((Y=s==null?void 0:s.toString())==null?void 0:Y.length)>=5?s:T.substring(0,2)]}}),"databyIndex"]},R=await f.get([...A(((H=s==null?void 0:s.toString())==null?void 0:H.length)===5?286:285),I,$]),O=C(R,["json",...A(((z=s==null?void 0:s.toString())==null?void 0:z.length)===5?286:285),0,$]),M=C(JSON.parse(O),"bbox"),D=C(f.getCache(),E,{}),{geoColors:P,domain:F,geoLayer:B}=yE({geoid:s,data:k,columns:_,geoAttribute:t}),V=wE({data:k,hazard:r,floodPlain:u}),G={ccl:{data:(k||[]).map(W=>({building_id:W.building_id,address:typeof W.address!="object"?W.address:null,floodPlain:["AH","A","VE","AO","AE"].includes(W.flood_zone)?"1%":["X"].includes(W.flood_zone)?"0.2%":"None",...r.sort((Y,U)=>{var q,te;return+W[`nri_${(q=Ne[U])==null?void 0:q.prefix}_eals`]-+W[`nri_${(te=Ne[Y])==null?void 0:te.prefix}_eals`]}).reduce((Y,U)=>{var q;return{...Y,[`${U} Score`]:+W[`nri_${(q=Ne[U])==null?void 0:q.prefix}_eals`]}},{})})),dataFormat:W=>W,idCol:"building_id",showLegend:!1,geoJson:V,geoColors:P,domain:F,mapFocus:M,colors:a,title:l,attributes:_,geoAttribute:t,dataSource:i,version:n,geoLayer:B,height:d,size:c}};return{data:k,geoAttribute:t,geoid:s,version:n,colors:a,mapFocus:M,attributionData:D,geoColors:P,domain:F,geoLayer:B,layerProps:G,title:l,dataSource:i,size:c,height:d,hazard:r,floodPlain:u,numColors:p,buildingType:m,hazardScoreThreshold:h}}const mg=({value:t,onChange:s,size:n})=>{const{falcor:r,falcorCache:a}=et();let l=t&&tt(t)?JSON.parse(t):{};const i="/",[c,d]=b.useState((l==null?void 0:l.dataSources)||[]),[u,p]=b.useState(l==null?void 0:l.dataSource),[m,h]=b.useState((l==null?void 0:l.version)||842),[f,g]=b.useState(l==null?void 0:l.geoAttribute),[x,y]=b.useState((l==null?void 0:l.buildingType)||JSON.stringify({value_source:["ogs"]})),[j,N]=b.useState((l==null?void 0:l.floodPlain)||[]),[_,E]=b.useState((l==null?void 0:l.hazard)||[]),[L,S]=b.useState((l==null?void 0:l.hazardScoreThreshold)||70),[k,$]=b.useState(!0),[I,T]=b.useState(l==null?void 0:l.status),[A,R]=b.useState((l==null?void 0:l.geoid)===""?l==null?void 0:l.geoid:(l==null?void 0:l.geoid)||"36"),[O,M]=b.useState(l==null?void 0:l.data);b.useState(l==null?void 0:l.mapFocus);const[D,P]=b.useState((l==null?void 0:l.numColors)||5);b.useState((l==null?void 0:l.shade)||"Oranges");const[F,B]=b.useState((l==null?void 0:l.colors)||Js(5,"Oranges")),[V,G]=b.useState(l==null?void 0:l.title),[Z,X]=b.useState((l==null?void 0:l.height)||500),z=["dama",oe,"sources","byCategory","Buildings"];return b.useEffect(()=>{async function W(){$(!0),T(void 0),await r.get(z),d(C(r.getCache(),[...z,"value"],[])),$(!1)}W()},[]),b.useEffect(()=>{var Y,U,q;const W=(((U=(Y=c.find(te=>te.source_id===u))==null?void 0:Y.metadata)==null?void 0:U.columns)||((q=c.find(te=>te.source_id===u))==null?void 0:q.metadata)||[]).find(te=>te.display==="geoid-variable");W!=null&&W.name&&g(W==null?void 0:W.name)},[c,u]),b.useEffect(()=>{async function W(){var U;if(!f||!m||!u||!x||!A){!(x!=null&&x.length)&&T("Please select Building Type."),!(f!=null&&f.length)&&T("No geo attribute found."),!((U=A==null?void 0:A.toString())!=null&&U.length)&&T("Please select a geography."),!m&&T("Please select a version."),!u&&T("Please select a Datasource."),$(!1);return}$(!0),T(void 0);const Y=await ug({geoAttribute:f,geoid:A,version:m,colors:F,title:V,dataSource:u,size:n,height:Z,hazard:_,floodPlain:j,numColors:D,buildingType:x,hazardScoreThreshold:L},r);s(JSON.stringify({...Y})),$(!1)}W()},[f,A,m,F,V,u,n,Z,_,j,D,x,L]),console.log("data",O),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(ze,{label:"Data Source:",types:c.map(W=>({label:W.name,value:W.source_id})),type:u,setType:W=>{g(void 0),h(void 0),M([]),p(W)}}),e.jsx(Ct,{source_id:u,view_id:m,onChange:h,className:"flex-row-reverse"}),e.jsx(rt,{value:A,onChange:R,className:"flex-row-reverse"}),e.jsx(ze,{label:"Building Type:",types:[{label:"State Owned",value:JSON.stringify({value_source:["ogs"]})},{label:"Critical",value:JSON.stringify({critical:["not null"]})}],type:x,setType:y}),e.jsx(k0,{className:"my-1 bg-white rounded-md w-3/4 shrink flex-row-reverse",label:"Filter by",value:[...j,..._],onChange:W=>{const Y=W.filter(q=>q.type==="floodplain").map(q=>q.key),U=W.filter(q=>q.type==="hazard").map(q=>q.key).sort((q,te)=>Ne[q].name.localeCompare(Ne[te].name));M([]),N(Y),E(U)},options:[{label:"1%",key:JSON.stringify({flood_zone:["AH","A","VE","AO","AE"]}),type:"floodplain"},{label:"0.2%",key:JSON.stringify({flood_zone:["X"]}),type:"floodplain"},...Object.keys(Ne).sort((W,Y)=>Ne[W].name.localeCompare(Ne[Y].name)).map((W,Y)=>({label:Ne[W].name,key:W,type:"hazard"}))]}),_!=null&&_.length?e.jsxs("div",{className:"w-full flex flex-row text-sm",children:[e.jsx("label",{className:"shrink-0 pr-2 py-2 my-1 w-1/4",children:"Threshold:"}),e.jsx("input",{className:"p-2 my-1 bg-white rounded-md w-3/4 shrink",type:"number",placeholder:"Table Page Size",value:L,onChange:W=>S(W.target.value),onWheel:W=>W.target.blur()},"pageSizeInput")]}):null,e.jsx(ze,{label:"Size:",types:[{label:"Small",value:500},{label:"Medium",value:700},{label:"Large",value:900}],type:Z,setType:W=>{X(W)}})]}),k?e.jsx(dt,{}):I?e.jsx("div",{className:"p-5 text-center",children:I}):e.jsxs(w.Fragment,{children:[e.jsx(dg,{floodPlain:j,hazard:_,buildingType:x}),e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${Z}px`},children:e.jsx(qs,{interactive:!0,falcor:r,layerProps:l.layerProps,legend:{domain:l.domain,range:F,title:V,size:n,show:!1},layers:["Circles"]})}),e.jsx(ct,{baseUrl:i,attributionData:l.attributionData})]})]})})};mg.settings={hasControls:!0,name:"ElementEdit"};const NE=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):s!=null&&s.img?e.jsx("div",{className:"h-80vh flex-1 flex flex-col",children:e.jsx("img",{alt:"Choroplath Map",src:C(s,["img"])})}):e.jsxs(w.Fragment,{children:[e.jsxs("div",{className:"flex-none w-full p-1",style:{height:`${s==null?void 0:s.height}px`},children:[e.jsx(dg,{floodPlain:s==null?void 0:s.floodPlain,hazard:s==null?void 0:s.hazard,buildingType:s==null?void 0:s.buildingType}),e.jsx(qs,{interactive:!1,layerProps:s.layerProps,legend:{show:!1},layers:["Circles"]})]}),e.jsx(ct,{baseUrl:"/",attributionData:s.attributionData})]})})},CE={name:"Map: Buildings",type:"Map",variables:[{name:"geoid",default:"36"},{name:"dataSources",hidden:!0},{name:"dataSource",hidden:!0},{name:"version",hidden:!0},{name:"geoAttribute",hidden:!0},{name:"hazard",hidden:!0},{name:"title",hidden:!0},{name:"size",hidden:!0},{name:"height",hidden:!0},{name:"floodPlain",hidden:!0},{name:"buildingType",hidden:!0},{name:"hazardScoreThreshold",hidden:!0},{name:"numColors",hidden:!0},{name:"colors",hidden:!0,default:Js(5,"Oranges")}],getData:ug,EditComp:mg,ViewComp:NE},Hi=t=>typeof(t==null?void 0:t.value)=="object"?Hi(t.value):(t==null?void 0:t.value)||t,pg=({data:t=[],columns:s=[],filterValue:n={},pageSize:r,sortBy:a={},baseUrl:l,attributionData:i,striped:c})=>{var m,h;const d=s.map(f=>({...f,Cell:g=>{let x=Hi(g.value);return x=["integer","number"].includes(g.column.type)?us(x||0,f.isDollar):x,e.jsx("div",{children:x})}})),u=(m=d.find(f=>{var g;return f.accessor===((g=Object.keys(a))==null?void 0:g[0])}))==null?void 0:m.accessor,p=t.filter(f=>!Object.keys(n||{}).length||Object.keys(n).reduce((g,x)=>{var j;const y=Hi(f[x]);return g&&(y==null?void 0:y.toString().toLowerCase().includes((j=n[x])==null?void 0:j.toLowerCase()))},!0));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-5",children:(t==null?void 0:t.length)>0&&(s==null?void 0:s.length)>0&&e.jsx(St,{columns:d,data:p,initialPageSize:r,pageSize:r,striped:c,sortBy:u,sortOrder:((h=Object.values(a))==null?void 0:h[0])||"asc"})}),e.jsx(ct,{baseUrl:l,attributionData:i})]})},pl=({showTotal:t,data:s,columns:n,setLoading:r})=>{if(!(t!=null&&t.length)&&!s.find(l=>l.totalRow)||!(s!=null&&s.length)||!(n!=null&&n.length))return;if(!(t!=null&&t.length)&&s.find(l=>l.totalRow)){const l=s.findIndex(i=>i.totalRow);s.splice(l,1);return}r(!0);const a=t.reduce((l,i)=>(l[i]=s.filter(c=>!c.totalRow).reduce((c,d)=>c+(+d[i]||0),0),l),{});if(a[n[0].accessor]="Total",a.totalRow=!0,s.find(l=>l.totalRow)){const l=s.findIndex(i=>i.totalRow);s[l]=a}else s.push(a);console.log("show total",t,a,n,s),r(!1)},hg=({value:t,onChange:s})=>{var te,K,ne,J,ae,de,ue,fe,ve,se,me,xe;const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",[i,c]=b.useState((a==null?void 0:a.dataSources)||[]),[d,u]=b.useState(a==null?void 0:a.dataSource),[p,m]=b.useState(a==null?void 0:a.version),[h,f]=b.useState(a==null?void 0:a.geoAttribute),[g,x]=b.useState(!0),[y,j]=b.useState(a==null?void 0:a.status),[N,_]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[E,L]=b.useState((a==null?void 0:a.filters)||{}),[S,k]=b.useState((a==null?void 0:a.filterValue)||{}),[$,I]=b.useState((a==null?void 0:a.visibleCols)||[]),[T,A]=b.useState((a==null?void 0:a.pageSize)||5),[R,O]=b.useState((a==null?void 0:a.sortBy)||{}),[M,D]=b.useState((a==null?void 0:a.notNull)||[]),[P,F]=b.useState((a==null?void 0:a.showTotal)||[]),B="Social Vulnerability",V=JSON.stringify({filter:{...h&&{[`substring(${h}::text, 1, ${(te=N==null?void 0:N.toString())==null?void 0:te.length})`]:[N]}},exclude:{...M.length&&M.reduce((re,Q)=>({...re,[Q]:["null"]}),{})}}),G=["dama",oe,"viewsbyId",p,"options",V,"length"],Z=["dama",oe,"viewsbyId",p,"options",V,"databyIndex"],X=["dama",oe,"sources","byCategory",B],H=["dama",oe,"views","byId",p,"attributes"],z=["source_id","view_id","version","_modified_timestamp"];b.useEffect(()=>{async function re(){x(!0),j(void 0),await n.get(X),c(C(n.getCache(),[...X,"value"],[])),x(!1)}re()},[]),b.useEffect(()=>{var Q,pe,ge;const re=(((pe=(Q=i.find(le=>le.source_id===d))==null?void 0:Q.metadata)==null?void 0:pe.columns)||((ge=i.find(le=>le.source_id===d))==null?void 0:ge.metadata)||[]).find(le=>le.display==="geoid-variable");re!=null&&re.name&&f(re==null?void 0:re.name)},[i,d]),b.useEffect(()=>{async function re(){if(!($!=null&&$.length)||!p||!d){!($!=null&&$.length)&&j("Please select columns."),!(h!=null&&h.length)&&j("No geo attribute found."),!p&&j("Please select a version."),!d&&j("Please select a Datasource."),x(!1);return}x(!0),j(void 0),await n.get(G);const Q=Math.min(C(n.getCache(),G,0),250);await n.get([...Z,{from:0,to:Q-1},$]),await n.get([...H,z]),x(!1)}re()},[d,p,N,$,M,h]);let W=b.useMemo(()=>Object.values(C(r,Z,{})),[r]);const Y=C(r,H,{}),U=((ne=(K=i.find(re=>re.source_id===d))==null?void 0:K.metadata)==null?void 0:ne.columns)||((J=i.find(re=>re.source_id===d))==null?void 0:J.metadata),q=$.map(re=>U.find(Q=>Q.name===re)).filter(re=>re).map(re=>({Header:re.display_name||re.name,accessor:re.name,align:re.align||"right",width:re.width||"15%",filter:re.filter||E[re.name],info:re.desc,...re}));return b.useEffect(()=>{pl({showTotal:P,data:W,columns:q,setLoading:x})},[r,Z,P,W,q]),b.useEffect(()=>{g||s(JSON.stringify({attributionData:Y,status:y,geoid:N,pageSize:T,sortBy:R,data:W,columns:q,filters:E,filterValue:S,visibleCols:$,geoAttribute:h,notNull:M,showTotal:P,dataSource:d,dataSources:i,version:p}))},[Y,y,N,T,R,W,q,E,S,$,h,M,P,d,i,p]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(ze,{label:"Data Source:",types:i.map(re=>({label:re.name,value:re.source_id})),type:d,setType:re=>{m(void 0),F([]),I([]),W=[],u(re)}}),e.jsx(Ct,{source_id:d,view_id:p,onChange:m,className:"flex-row-reverse"}),e.jsx(rt,{value:N,onChange:_,className:"flex-row-reverse"}),e.jsx(Ls,{cols:(ve=(fe=((de=(ae=i.find(re=>re.source_id===d))==null?void 0:ae.metadata)==null?void 0:de.columns)||((ue=i.find(re=>re.source_id===d))==null?void 0:ue.metadata)||[])==null?void 0:fe.filter(re=>["data-variable","meta-variable","geoid-variable"].includes(re.display)))==null?void 0:ve.map(re=>re.name),metadata:((me=(se=i.find(re=>re.source_id===d))==null?void 0:se.metadata)==null?void 0:me.columns)||((xe=i.find(re=>re.source_id===d))==null?void 0:xe.metadata)||[],visibleCols:$,setVisibleCols:I,filters:E,setFilters:L,filterValue:S,setFilterValue:k,pageSize:T,setPageSize:A,sortBy:R,setSortBy:O,notNull:M,setNotNull:D,showTotal:P,setShowTotal:F})]}),g?e.jsx(dt,{}):y?e.jsx("div",{className:"p-5 text-center",children:y}):e.jsx(pg,{geoid:N,data:W,columns:q,filterValue:S,pageSize:T,sortBy:R,attributionData:Y,baseUrl:l})]})})};hg.settings={hasControls:!0,name:"ElementEdit"};const _E=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(pg,{...s,baseUrl:"/"})})},SE={name:"Table: Social Vulnerability",type:"Table",deprecated:!0,EditComp:hg,ViewComp:_E},fg=({data:t=[],columns:s=[],pageSize:n,baseUrl:r,attributionData:a,striped:l})=>{if(!(t!=null&&t.length)||!(s!=null&&s.length))return null;const i=b.useMemo(()=>t,[t]),c=b.useMemo(()=>s,[s]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-5",children:(t==null?void 0:t.length)>0&&(s==null?void 0:s.length)>0&&e.jsx(St,{columns:c,data:i,initialPageSize:5,striped:l})}),e.jsx(ct,{baseUrl:r,attributionData:a})]})},$E=({className:t,versions:s={},onChange:n})=>{const r=Object.keys(s)||[],[a,l]=b.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(f0,{showSelector:a,setShowSelector:l,hide:!1}),r.map(i=>e.jsx(Ct,{controlDisplay:!0,showSelectorControl:a,source_id:i,view_id:s==null?void 0:s[i],onChange:c=>n({...s||{},[i]:c}),className:t}))]})},EE={bin1:"Low Vulnerability",bin2:"Medium Low",bin3:"Medium",bin4:"Medium High",bin5:"High Vulnerability"},Aa={378:{data:"RPL_THEMES",population:"E_TOTPOP"},352:{data:"RPL_THEMES",population:"E_TOTPOP"},353:{data:"COMB_SC",population:"POP_CNT"},354:{data:"TC",population:"TPF"}};async function gg({version:t,dataSources:s,dataSource:n,geoid:r,visibleCols:a},l){var S;const c=["dama",oe,"sources","byCategory","Social Vulnerability"],d=k=>["dama",oe,"views","byId",k,"attributes"],u=["source_id","view_id","version","_modified_timestamp"],p=(k,$)=>{var I;return JSON.stringify({filter:{...k&&{[`substring(${k}::text, 1, ${(I=r==null?void 0:r.toString())==null?void 0:I.length})`]:[r]}},exclude:{[$]:[-999]}})},m=(k,$)=>[`SUM(${$})::integer as population`,`MIN(${k})::double precision as min`,`MAX(${k})::double precision - MIN(${k})::double precision as range`],h=(k,$)=>["dama",oe,"viewsbyId",k,"options",$,"databyIndex"],f=k=>{var $;return JSON.stringify({filter:{...k&&{[`substring(${k}::text, 1, ${($=r==null?void 0:r.toString())==null?void 0:$.length})`]:[r]}}})},g=(k,$,I,T)=>[`sum(
            CASE WHEN ${k}::double precision >= ${$} and ${k}::double precision < (${I} * 0.2) + ${$}
            THEN ${T?`${T}::integer`:"1"} ELSE 0
            END) as bin1`,`sum(
            CASE WHEN ${k}::double precision >= (${I} * 0.2) + ${$} and ${k}::double precision < (${I} * 0.4) + ${$}
            THEN ${T?`${T}::integer`:"1"} ELSE 0
            END) as bin2`,`sum(
            CASE WHEN ${k}::double precision >= (${I} * 0.4) + ${$} and ${k}::double precision < (${I} * 0.6) + ${$}
            THEN ${T?`${T}::integer`:"1"} ELSE 0
            END) as bin3`,`sum(
            CASE WHEN ${k}::double precision >= (${I} * 0.6) + + ${$} and ${k}::double precision < (${I} * 0.8) + ${$}
            THEN ${T?`${T}::integer`:"1"} ELSE 0
            END) as bin4`,`sum(
            CASE WHEN ${k}::double precision >= (${I} * 0.8) + ${$}
            THEN ${T?`${T}::integer`:"1"} ELSE 0
            END) as bin5`],x=(k,$)=>["dama",oe,"viewsbyId",k,"options",$,"databyIndex"];if(await l.get(c),s=C(l.getCache(),[...c,"value"],[]),!(n!=null&&n.length))return n=[(S=s[0])==null?void 0:S.source_id],{dataSources:s,dataSource:n,geoid:r,visibleCols:a};const y=Object.keys(t||{}).filter(k=>t[k]).map(k=>{var O,M,D;const $=s.find(P=>P.source_id==k),I=(D=(M=((O=$==null?void 0:$.metadata)==null?void 0:O.columns)||($==null?void 0:$.metadata)||[])==null?void 0:M.find(P=>P.display==="geoid-variable"))==null?void 0:D.name,T=Aa[+k].data,A=Aa[+k].population,R=p(I,T);return[...h(t[k],R),{from:0,to:0},m(T,A)]});if(!y.length)return;await l.get(...y);const j=Object.keys(t||{}).filter(k=>t[k]).map(k=>{var P,F,B;const $=s.find(V=>V.source_id==k),I=(B=(F=((P=$==null?void 0:$.metadata)==null?void 0:P.columns)||($==null?void 0:$.metadata)||[])==null?void 0:F.find(V=>V.display==="geoid-variable"))==null?void 0:B.name,T=Aa[+k].data,A=Aa[+k].population,R=p(I,T),O=C(l.getCache(),[...h(t[k],R),0],{}),M=Object.keys(O).reduce((V,G)=>(V[G.split("as ")[1]]=O[G],V),{}),D=f(I);return[...x(t[k],D),{from:0,to:0},g(T,M.min,M.range,a==="pct_population"?A:void 0)]});if(!j.length)return;await l.get(...j);const N=Object.keys(t||{}).filter(k=>t[k]&&n.includes(parseInt(k))).map(k=>{var F,B,V;const $=s.find(G=>G.source_id==k),I=(V=(B=((F=$==null?void 0:$.metadata)==null?void 0:F.columns)||($==null?void 0:$.metadata)||[])==null?void 0:B.find(G=>G.display==="geoid-variable"))==null?void 0:V.name,T=Aa[+k].data,A=p(I,T),R=C(l.getCache(),[...h(t[k],A),0],{}),O=Object.keys(R).reduce((G,Z)=>(G[Z.split("as ")[1]]=R[Z],G),{}),M=f(I),D=C(l.getCache(),[...x(t[k],M),0],{}),P=Object.keys(D).reduce((G,Z)=>{const X=a==="pct_population"?`${(D[Z]/((O==null?void 0:O.population)||1)*100||0).toFixed(2)} %`:D[Z];return G[Z.split("as ")[1]]=X,G},{});return{dataset:$==null?void 0:$.name,...P}}),_=await l.get([...d(Object.values(t)),u]),E=Object.values(t||{}).map(k=>C(_,["json",...d(k)],{})),L=Object.keys(N[0]||{}).map(k=>({Header:EE[k]||k,accessor:k}));return{data:N,attributionData:E,columns:L,version:t,dataSources:s,dataSource:n,geoid:r,visibleCols:a}}const xg=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",[i,c]=b.useState((a==null?void 0:a.dataSource)||[]),[d,u]=b.useState((a==null?void 0:a.version)||{}),[p,m]=b.useState(!0),[h,f]=b.useState(a==null?void 0:a.status),[g,x]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[y,j]=b.useState((a==null?void 0:a.visibleCols)||"num_tracts");return b.useEffect(()=>{async function N(){m(!0),f(void 0);const _=await gg({version:d,dataSources:a.dataSources,dataSource:i,geoid:g,visibleCols:y},n);s(JSON.stringify({..._})),m(!1)}N()},[i,d,g,y]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(ze,{label:"Data Source:",multi:!0,types:(a.dataSources||[]).map(N=>({label:N.name,value:N.source_id})),type:i,setType:c}),e.jsx($E,{versions:typeof i=="object"&&i.reduce((N,_)=>({...N,[_]:d[_]}),{}),onChange:u,className:"flex-row-reverse"}),e.jsx(rt,{value:g,onChange:x,className:"flex-row-reverse"}),e.jsx(ze,{label:"Display:",types:[{label:"# Tracts",value:"num_tracts"},{label:"% Population",value:"pct_population"}],type:y,setType:j})]}),p?e.jsx(dt,{}):h?e.jsx("div",{className:"p-5 text-center",children:h}):e.jsx(fg,{data:a.data,columns:a.columns,attributionData:a.attributionData,baseUrl:l})]})})};xg.settings={hasControls:!0,name:"ElementEdit"};const kE=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(fg,{...s,baseUrl:"/"})})},LE={name:"Table: Social Vulnerability Summary",type:"Table",variables:[{name:"version",default:{},hidden:!0},{name:"dataSources",default:[],hidden:!0},{name:"dataSource",default:[],hidden:!0},{name:"geoid",default:"36"},{name:"visibleCols",default:"num_tracts",hidden:!0}],getData:gg,EditComp:xg,ViewComp:kE},zi=t=>typeof(t==null?void 0:t.value)=="object"?zi(t.value):(t==null?void 0:t.value)||t,bg=({data:t=[],columns:s=[],filterValue:n={},pageSize:r,sortBy:a={},baseUrl:l,attributionData:i,striped:c,fetchData:d})=>{var h,f;const u=s.map(g=>({...g,Cell:x=>{var j;let y=zi(x==null?void 0:x.value);return y=["integer","number"].includes((j=x==null?void 0:x.column)==null?void 0:j.type)?us(y||0,g==null?void 0:g.isDollar):y,e.jsx("div",{children:y})}})),p=(h=u.find(g=>{var x;return g.accessor===((x=Object.keys(a))==null?void 0:x[0])}))==null?void 0:h.accessor,m=t.filter(g=>!Object.keys(n||{}).length||Object.keys(n).reduce((x,y)=>{var N;const j=zi(g[y]);return x&&(j==null?void 0:j.toString().toLowerCase().includes((N=n[y])==null?void 0:N.toLowerCase()))},!0));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-5",children:Object.values(m[0]||{}).find(g=>typeof g=="object")?"Something went wrong. Please try changing the selection / settings.":e.jsx(St,{columns:u,data:m,initialPageSize:r,pageSize:r,striped:c,sortBy:p,sortOrder:((f=Object.values(a))==null?void 0:f[0])||"asc",fetchData:d})}),e.jsx(ct,{baseUrl:l,attributionData:i})]})},IE=({groupBy:t,fn:s,columnsToFetch:n})=>{const r=n.map(a=>a.includes(" AS")?a.split(" AS")[0]:a.split(" as")[0]);return t.length?r.filter(a=>!a.includes("sum(")&&!a.includes("array_to_string")&&!a.includes("count(")).length===t.length:r.filter(a=>a.includes("sum(")||a.includes("array_to_string")||a.includes("count(")).length===0},Ul=t=>{try{return JSON.parse(t)}catch{return{}}},yg=({value:t,onChange:s})=>{var me,xe,re,Q,pe,ge;const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",[i,c]=b.useState((a==null?void 0:a.dataSources)||[]),[d,u]=b.useState(a==null?void 0:a.dataSource),[p,m]=b.useState((a==null?void 0:a.version)||842),[h,f]=b.useState(a==null?void 0:a.geoAttribute),[g,x]=b.useState(!0),[y,j]=b.useState(a==null?void 0:a.status),[N,_]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[E,L]=b.useState((a==null?void 0:a.filters)||{}),[S,k]=b.useState((a==null?void 0:a.filterValue)||{}),[$,I]=b.useState((a==null?void 0:a.visibleCols)||[]),[T,A]=b.useState((a==null?void 0:a.pageSize)||5),[R,O]=b.useState((a==null?void 0:a.sortBy)||{}),[M,D]=b.useState((a==null?void 0:a.groupBy)||[]),[P,F]=b.useState((a==null?void 0:a.notNull)||[]),[B,V]=b.useState((a==null?void 0:a.showTotal)||[]),[G,Z]=b.useState((a==null?void 0:a.fn)||[]),[X,H]=b.useState({}),[z,W]=b.useState((a==null?void 0:a.hiddenCols)||[]),[Y,U]=b.useState((a==null?void 0:a.colSizes)||{}),q="Buildings",te=({groupBy:le,notNull:ie,geoAttribute:be,geoid:_e})=>{var Re;return JSON.stringify({aggregatedLen:!!le.length,filter:{...be&&{[`substring(${be}::text, 1, ${(Re=_e==null?void 0:_e.toString())==null?void 0:Re.length})`]:[_e]}},exclude:{...ie.length&&ie.reduce((Pe,Ge)=>({...Pe,[Ge]:["null"]}),{})},groupBy:le})},K=le=>["dama",oe,"viewsbyId",p,"options",le,"length"],ne=le=>["dama",oe,"viewsbyId",p,"options",le,"databyIndex"],J=["dama",oe,"sources","byCategory",q],ae=["dama",oe,"views","byId",p,"attributes"],de=["source_id","view_id","version","_modified_timestamp"];b.useEffect(()=>{async function le(){x(!0),j(void 0),await n.get(J),c(C(n.getCache(),[...J,"value"],[])),x(!1)}le()},[]),b.useEffect(()=>{var ie,be;const le=(((be=(ie=i.find(_e=>_e.source_id===d))==null?void 0:ie.metadata)==null?void 0:be.columns)||[]).find(_e=>_e.display==="geoid-variable");le!=null&&le.name&&f(le==null?void 0:le.name)},[i,d]),b.useEffect(()=>{async function le(){if(!($!=null&&$.length)||!p||!d){!d&&j("Please select a Datasource."),!p&&j("Please select a version."),!($!=null&&$.length)&&j("Please select columns."),x(!1);return}if(!IE({groupBy:M,fn:G,columnsToFetch:$.map(be=>G[be]?G[be]:be)})){j("Please make appropriate grouping selections."),x(!1);return}x(!0),j(void 0),await n.get(K(te({groupBy:M,notNull:P,geoAttribute:h,geoid:N})));const ie=Math.min(C(n.getCache(),K(te({groupBy:M,notNull:P,geoAttribute:h,geoid:N})),0),590);await n.get([...ne(te({groupBy:M,notNull:P,geoAttribute:h,geoid:N})),{from:0,to:ie-1},$.map(be=>G[be]?G[be]:be)]),await n.get([...ae,de]),x(!1)}le()},[d,p,N,$,G,M,P,h]),b.useEffect(()=>{async function le(){var _e,Re;const ie=(Re=(_e=i.find(Pe=>Pe.source_id===d))==null?void 0:_e.metadata)==null?void 0:Re.columns,be=ie==null?void 0:ie.filter(Pe=>$.includes(Pe.name)&&["meta-variable","geoid-variable"].includes(Pe.display)&&Pe.meta_lookup);if(be!=null&&be.length){const Pe=await be.filter(Ge=>{var Ue;return(Ue=Ul(Ge.meta_lookup))==null?void 0:Ue.view_id}).reduce(async(Ge,Ue)=>{var ot;const ut=await Ge,at=Ul(Ue.meta_lookup),Bt=JSON.stringify({aggregatedLen:at.aggregatedLen,filter:{...(at==null?void 0:at.geoAttribute)&&{[`substring(${at.geoAttribute}::text, 1, ${(ot=N==null?void 0:N.toString())==null?void 0:ot.length})`]:[N]},...(at==null?void 0:at.filter)||{}}}),Ut=at.attributes,Wt=at.keyAttribute,Xt=["dama",oe,"viewsbyId",at.view_id,"options",Bt,"length"],Te=await n.get(Xt),we=C(Te,["json",...Xt],0);if(!we)return Promise.resolve();const De=["dama",oe,"viewsbyId",at.view_id,"options",Bt,"databyIndex"],Ce=await n.get([...De,{from:0,to:we-1},Ut]),Xe=Object.values(C(Ce,["json",...De],{})).reduce((Vt,Gt)=>({...Vt,[Gt[Wt]]:{...Ut.reduce((ka,_d)=>({...ka,[_d]:Gt[_d]}),{})}}),{});return{...ut,[Ue.name]:Xe}},{});H(Pe)}}le()},[d,$,N]);const ue=(xe=(me=i.find(le=>le.source_id===d))==null?void 0:me.metadata)==null?void 0:xe.columns,fe=b.useMemo(()=>{const le=ue==null?void 0:ue.filter(ie=>$.includes(ie.name)&&["meta-variable","geoid-variable"].includes(ie.display));return le!=null&&le.length?Object.values(C(r,ne(te({groupBy:M,notNull:P,geoAttribute:h,geoid:N})),{})).map(ie=>(le.forEach(be=>{var Pe;const _e=Ul(be.meta_lookup),Re=G[be.name]||be.name;if(_e!=null&&_e.view_id){const Ge=X[be.name]||[],Ue=ie[Re];Ue!=null&&Ue.includes(",")?ie[Re]=Ue.split(",").map(ut=>{var at;return((at=Ge[ut.trim()])==null?void 0:at.name)||ut.trim()}).join(", "):ie[Re]=((Pe=Ge[Ue])==null?void 0:Pe.name)||Ue}else ie[Re]=_e[ie[Re]]||ie[Re]}),ie)):Object.values(C(r,ne(te({groupBy:M,notNull:P,geoAttribute:h,geoid:N})),{}))},[r,X,ue,$,M,P,h,N]),ve=C(r,ae,{}),se=$.map(le=>ue==null?void 0:ue.find(ie=>ie.name===le)).filter(le=>le&&!z.includes(le.name)).map(le=>{var ie;return{Header:le.display_name||le.name,accessor:G[le.name]||le.name,align:le.align||"right",width:Y[le.name]||"15%",filter:le.filter||E[le.name],info:le.desc,...le,type:(ie=G[le.name])!=null&&ie.includes("array_to_string")?"string":le.type}});return b.useEffect(()=>{pl({showTotal:B,data:fe,columns:se,setLoading:x})},[B,fe,se]),b.useEffect(()=>{g||s(JSON.stringify({attributionData:ve,status:y,geoid:N,pageSize:T,sortBy:R,groupBy:M,fn:G,notNull:P,showTotal:B,colSizes:Y,data:fe,columns:se,filters:E,filterValue:S,visibleCols:$,hiddenCols:z,geoAttribute:h,dataSource:d,dataSources:i,version:p}))},[ve,y,N,T,R,M,G,P,B,Y,fe,se,E,S,$,z,h,d,i,p]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(ze,{label:"Data Source:",types:i.map(le=>({label:le.name,value:le.source_id})),type:d,setType:le=>{I([]),u(le)}}),e.jsx(Ct,{source_id:d,view_id:p,onChange:m,className:"flex-row-reverse"}),e.jsx(rt,{value:N,onChange:_,className:"flex-row-reverse"}),e.jsx(Ls,{cols:(((Q=(re=i.find(le=>le.source_id===d))==null?void 0:re.metadata)==null?void 0:Q.columns)||[]).filter(le=>["data-variable","meta-variable","geoid-variable"].includes(le.display)).map(le=>le.name),metadata:((ge=(pe=i.find(le=>le.source_id===d))==null?void 0:pe.metadata)==null?void 0:ge.columns)||[],visibleCols:$,setVisibleCols:I,hiddenCols:z,setHiddenCols:W,filters:E,setFilters:L,filterValue:S,setFilterValue:k,pageSize:T,setPageSize:A,groupBy:M,setGroupBy:D,fn:G,setFn:Z,sortBy:R,setSortBy:O,notNull:P,setNotNull:F,showTotal:B,setShowTotal:V,colSizes:Y,setColSizes:U})]}),g?e.jsx(dt,{}):y?e.jsx("div",{className:"p-5 text-center",children:y}):e.jsx(bg,{geoid:N,data:fe,columns:se,filterValue:S,pageSize:T,sortBy:R,attributionData:ve,baseUrl:l})]})})};yg.settings={hasControls:!0,name:"ElementEdit"};const TE=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(bg,{...s,baseUrl:"/"})})},ME={name:"Table: Buildings",type:"Table",deprecated:!0,EditComp:yg,ViewComp:TE},vg=(t=[],s=[])=>!(t!=null&&t.length)||!(s!=null&&s.length)?[]:t!=null&&t.length&&(s!=null&&s.length)?dl(t,Math.min(t==null?void 0:t.length,s==null?void 0:s.length)):[],BE=(t,s)=>{const n=vg(t,s);return ps().domain(n).range(s)},AE=({geoid:t,data:s=[],columns:n=[],geoAttribute:r,paintFn:a,colors:l=[],...i})=>{var h,f;if(!(s!=null&&s.length)||!(l!=null&&l.length))return{};const c=s.map(g=>g[r]);(h=(t==null?void 0:t.substring(0,2))||c[0]||"00")==null||h.substring(0,2);const d={},u=((f=c[0])==null?void 0:f.toString().length)===5?"counties":"tracts",p=BE(s.map(g=>a?a(g):+g[n==null?void 0:n[0]]).filter(g=>g),l),m=vg(s.map(g=>a?a(g):+g[n==null?void 0:n[0]]).filter(g=>g&&g>=0),l);return s.forEach(g=>{const x=a?a(g):+g[n==null?void 0:n[0]];d[g[r]]=x?p(x):"#d0d0ce"}),{geoColors:d,domain:m,geoLayer:u}};async function jg({geoAttribute:t,geoid:s,version:n,attribute:r,colors:a,title:l,dataSource:i,size:c,height:d},u){var D,P,F,B;const h=JSON.stringify({filter:{...t&&{[`substring(${t}::text, 1, ${(D=s==null?void 0:s.toString())==null?void 0:D.length})`]:[s]}}}),f=["dama",oe,"viewsbyId",n,"options",h,"length"],g=["dama",oe,"viewsbyId",n,"options",h,"databyIndex"],x=["dama",oe,"views","byId",n,"attributes"],y=["source_id","view_id","version","_modified_timestamp"];await u.get(f);const j=C(u.getCache(),f,0);await u.get([...g,{from:0,to:j-1},[t,r]]),await u.get([...x,y]);const N=Object.values(C(u.getCache(),g,{})),_=["st_asgeojson(st_orientedenvelope(st_union(geom)), 9, 1)  as geom"],E={from:0,to:0},L=C(N,[0,"geoid"])||((P=s==null?void 0:s.toString())==null?void 0:P.substring(0,2)),S=V=>{var G;return["dama",oe,"viewsbyId",V,"options",JSON.stringify({filter:{geoid:[((G=s==null?void 0:s.toString())==null?void 0:G.length)>=5?s:L.substring(0,2)]}}),"databyIndex"]},k=await u.get([...S(((F=s==null?void 0:s.toString())==null?void 0:F.length)===5?286:285),E,_]),$=C(k,["json",...S(((B=s==null?void 0:s.toString())==null?void 0:B.length)===5?286:285),0,_]),I=C(JSON.parse($),"bbox"),T=C(u.getCache(),x,{}),{geoColors:A,domain:R,geoLayer:O}=AE({geoid:s==null?void 0:s.toString(),data:N,columns:[r],geoAttribute:t,colors:a});return{data:N,geoAttribute:t,geoid:s,version:n,attribute:r,colors:a,mapFocus:I,attributionData:T,geoColors:A,domain:R,geoLayer:O,layerProps:{ccl:{data:N,geoColors:A,domain:R,mapFocus:I,colors:a,title:l,attribute:r,geoAttribute:t,dataSource:i,version:n,geoLayer:O,height:d,size:c}},title:l,dataSource:i,size:c,height:d}}const wg=({value:t,onChange:s,size:n})=>{var Z,X,H;const{falcor:r,falcorCache:a}=et();let l=t&&tt(t)?JSON.parse(t):{};const i="/",[c,d]=b.useState((l==null?void 0:l.dataSources)||[]),[u,p]=b.useState(l==null?void 0:l.dataSource),[m,h]=b.useState(l==null?void 0:l.version),[f,g]=b.useState(l==null?void 0:l.attribute),[x,y]=b.useState(l==null?void 0:l.geoAttribute),[j,N]=b.useState(!0),[_,E]=b.useState(l==null?void 0:l.status),[L,S]=b.useState((l==null?void 0:l.geoid)||"36"),[k,$]=b.useState(l==null?void 0:l.data),[I,T]=b.useState((l==null?void 0:l.numColors)||5),[A,R]=b.useState((l==null?void 0:l.shade)||"Oranges"),[O,M]=b.useState((l==null?void 0:l.colors)||Js(5,"Oranges")),[D,P]=b.useState(l==null?void 0:l.title),[F,B]=b.useState((l==null?void 0:l.height)||500),G=["dama",oe,"sources","byCategory","Social Vulnerability"];return b.useEffect(()=>{async function z(){N(!0),E(void 0),await r.get(G),d(C(r.getCache(),[...G,"value"],[])),N(!1)}z()},[]),b.useEffect(()=>{var W,Y,U;const z=(((Y=(W=c.find(q=>q.source_id===u))==null?void 0:W.metadata)==null?void 0:Y.columns)||((U=c.find(q=>q.source_id===u))==null?void 0:U.metadata)||[]).find(q=>q.display==="geoid-variable");z!=null&&z.name&&y(z==null?void 0:z.name)},[c,u]),b.useEffect(()=>{async function z(){if(!L||!f||!x||!m||!u){!u&&E("Please select a Datasource."),!m&&E("Please select a version."),!(x!=null&&x.length)&&E("No geo attribute found."),!(f!=null&&f.length)&&E("Please select columns."),!L&&E("Please Select a Geography."),N(!1);return}N(!0),E(void 0);const W=await jg({geoAttribute:x,geoid:L,version:m,attribute:f,colors:O,title:D,dataSource:u,size:n,height:F},r);s(JSON.stringify({...W})),N(!1)}z()},[u,m,x,f,L,D,u,n,F]),b.useEffect(()=>{var z,W,Y,U;P(((U=(((W=(z=c.find(q=>q.source_id===u))==null?void 0:z.metadata)==null?void 0:W.columns)||((Y=c.find(q=>q.source_id===u))==null?void 0:Y.metadata)||[]).find(q=>q.name===f))==null?void 0:U.display_name)||f)},[c,u,f]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(ze,{label:"Data Source:",types:c.map(z=>({label:z.name,value:z.source_id})),type:u,setType:z=>{g(void 0),y(void 0),h(void 0),$([]),p(z)}}),e.jsx(Ct,{source_id:u,view_id:m,onChange:h,className:"flex-row-reverse"}),e.jsx(rt,{value:L,onChange:S,className:"flex-row-reverse"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Attribute:"}),e.jsxs("select",{className:"bg-white w-full pl-3 rounded-md my-1",value:f,onChange:z=>g(z.target.value),children:[e.jsx("option",{value:void 0,children:"Please select an attribute"},""),(((X=(Z=c.find(z=>z.source_id===u))==null?void 0:Z.metadata)==null?void 0:X.columns)||((H=c.find(z=>z.source_id===u))==null?void 0:H.metadata)||[]).filter(z=>["data-variable","meta-variable"].includes(z.display)).map(z=>e.jsx("option",{value:z.name,children:z.display_name||z.name},z.name))]})]}),e.jsx(cl,{title:"Colors: ",numColors:I,setNumColors:T,shade:A,setShade:R,colors:O,setColors:M}),e.jsx(ze,{label:"Size:",types:[{label:"Small",value:500},{label:"Medium",value:700},{label:"Large",value:900}],type:F,setType:z=>{B(z)}})]}),j?e.jsx(dt,{}):_?e.jsx("div",{className:"p-5 text-center",children:_}):e.jsxs(w.Fragment,{children:[e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${F}px`},children:e.jsx(qs,{interactive:!0,falcor:r,layerProps:l.layerProps,legend:{domain:l.domain,range:O,title:D,size:n},layers:["Choropleth"]})}),e.jsx(ct,{baseUrl:i,attributionData:l.attributionData})]})]})})};wg.settings={hasControls:!0,name:"ElementEdit"};const OE=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);const n="/",r=s==null?void 0:s.attributionData;return e.jsxs("div",{className:"relative w-full p-6",children:[s.img?e.jsx("div",{className:"h-80vh flex-1 flex flex-col",children:e.jsx("img",{alt:"Choroplath Map",src:C(s,["img"])})}):e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${s.height}px`},children:e.jsx(qs,{interactive:!1,layerProps:s.layerProps,legend:{size:s.size,domain:(s==null?void 0:s.domain)||[],range:s.colors,title:s.title,show:s.showLegend}})}),e.jsx(ct,{baseUrl:n,attributionData:r})]})},PE={name:"Map: Social Vulnerability",type:"Map1",variables:[{name:"geoid",default:"36"},{name:"dataSources",hidden:!0},{name:"dataSource",hidden:!0},{name:"version",hidden:!0},{name:"geoAttribute",hidden:!0},{name:"attribute",hidden:!0},{name:"title",hidden:!0},{name:"dataSource",hidden:!0},{name:"size",hidden:!0},{name:"height",hidden:!0},{name:"colors",hidden:!0,default:Js(5,"Oranges")}],getData:jg,EditComp:wg,ViewComp:OE};function DE({data:t,height:s,radius:n,fontSizeOuter:r,fontSizeInner:a}){const i=t.find(c=>c.label)?12:0;return e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:0,y:i,width:"100%",height:s,rx:n,fill:"rgba(159,159,159,0.7)"},"bar-bg"),t.map(({value:c,showValue:d=!0,valueFloat:u="left",valueCutoff:p=0,label:m,color:h,width:f},g)=>{const x=g===0?0:t.filter((y,j)=>j<g).reduce((y,j)=>+y+ +j.width,0);return e.jsxs(w.Fragment,{children:[e.jsx("rect",{x:0,y:i,width:`${x+ +f}%`,height:s,rx:n,fill:h},`bar-${m}`),m&&e.jsxs("text",{fill:"black",fillOpacity:"1",x:0,y:5,textAnchor:"left",rotate:"0",kerning:"auto",fontSize:a,children:[" ",m," "]}),c&&d&&(u==="left"||u==="right"&&+f>p)&&e.jsxs("text",{fill:"white",fillOpacity:"1",x:u==="left"?10:`${x+ +f-c.toString().length-1}%`,y:i+4+s/2,textAnchor:"right",textRendering:"auto",fontStyle:"normal",fontVariant:"normal",fontWeight:"bold",fontSize:r,paintOrder:"stroke",children:[" ",c," "]})]},g)}).reverse()]})}const Wl=({data:t,height:s=30,radius:n=15,fontSizeOuter:r="14.5px",fontSizeInner:a="12.5px",margin:l={left:0,top:5,right:1,bottom:1}})=>e.jsx("svg",{className:"w-full",height:s+l.top+l.bottom+10,children:e.jsx("g",{transform:`translate(${l.left}, ${l.top})`,children:e.jsx(DE,{data:t,height:s,radius:n,fontSizeOuter:r,fontSizeInner:a})})}),RE=[["#f5b899","#f8b46f","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],["#f5b899","#f8b46f","#ffa342","#ff8218","#e76100","#c94e00","#be4000","#9d3400","#792606"],["#ffb950","#FFAD33","#FF931F","#FF7E33","#FA5E1F","#B81702","#A50104","#8E0103","#7A0103"],["#FFB600","#FFAA00","#FF9E00","#FF9100","#FF8500","#FF7900","#FF6D00","#FF6000","#FF4800"]],FE=Hn().domain([0,101]).range(RE[2]),Gl=(t,s="%")=>e.jsxs("span",{className:"pl-1",children:[t,e.jsx("span",{className:"text-xs pl-1",children:s==="%"?"%":`events/${s==="daily"?"day":"yr"}`})]}),am=({isTotal:t,hazard:s,statePercentile:n,nationalPercentile:r,hazardPercentileArray:a,hazardPercentile:l,actualLoss:i,actualLossWithPop:c,eal:d,exposure:u,frequency:p,frequencySum:m,numEvents:h,numSevereEvents:f,numFEMADeclared:g,deaths:x,injuries:y,size:j,style:N,visibleCols:_,isGrid:E=!0})=>{var R,O,M,D;const L={large:"flex flex-col pt-2 text-sm",small:`flex ${N==="full"?"flex-row":"flex-col"} flex-wrap justify-between pt-2 ${E?"text-xs":"text-sm"}`},S={large:"flex flex-col justify-between shrink-0 ml-5 pt-2",small:"flex flex-col divide-y  text-center"},k=`font-medium ${d?"text-gray-800":"text-gray-400"} ${E?"text-sm":"text-xl"} overflow-wrap`,$={large:30,small:12},I={large:20,small:10},T={large:"14.5px",small:"12.5px"},A={large:"13.5px",small:"11.5px"};return e.jsxs("div",{className:`border border-gray-200 rounded-lg p-5 ${d?"bg-slate-50 text-gray-900":"bg-slate-200 text-gray-400"}`,children:[e.jsxs("div",{className:`w-full border-b-4 rounded flex flex-wrap items-center font-medium tracking-wide uppercase ${E?"text-base":"text-lg"}`,style:{borderColor:d?C(Ne,[s,"color"],""):"#ccc"},children:[!t&&e.jsx("div",{className:`rounded-full mr-2 mb-0 font-bold ${(R=Ne[s])==null?void 0:R.icon}`,style:{height:"15px",width:"15px",color:d?C(Ne,[s,"color"],""):"#ccc"}}),t?"Total":(O=Ne[s])==null?void 0:O.name]}),e.jsxs("div",{className:`w-full ${j==="large"?"flex flex-row justify-between":""}`,children:[e.jsxs("div",{className:"w-full pr-1",children:[_.includes("National Percentile Bar")&&e.jsxs("div",{className:"w-full pt-1",children:[e.jsx("div",{className:S[j],children:e.jsx("label",{className:L[j],children:"Risk"})}),e.jsx(Wl,{data:[{label:"",value:r==null?void 0:r.toFixed(2),color:FE(r),width:r}],height:$[j],radius:I[j],fontSizeInner:T[j],fontSizeOuter:A[j]})]}),t&&_.includes("Loss Distribution Bar")&&e.jsx("div",{className:"w-full pt-4",children:e.jsx(Wl,{data:(a||[]).map((P,F)=>({label:"",value:P.label,showValue:!0,valueFloat:"right",valueCutoff:10,color:P.color,width:P.value})),width:n,height:$[j],radius:I[j],fontSizeInner:T[j],fontSizeOuter:A[j]})})]}),e.jsxs("div",{className:S[j],children:[_.includes("Expected Annual Loss (EAL)")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{className:t?"break-word w-[25px]":"",children:t?"Expected Annual Loss (EAL)":"EAL"}),e.jsx("span",{className:k,children:Qe(d,2,!0)}),!t&&_.includes("Hazard Percentile Bar")&&e.jsx(Wl,{data:[{label:"",value:`${l}%`,color:(M=Ne[s])==null?void 0:M.color,width:l}],height:$[j],radius:I[j],fontSizeInner:T[j],fontSizeOuter:A[j]})]}),!t&&_.includes("Actual Loss")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"Actual Loss"}),e.jsx("span",{className:k,children:Qe(i,2,!0)})]}),!t&&_.includes("Actual Loss (with Population)")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"Actual Loss (with Population)"}),e.jsx("span",{className:k,children:Qe(c,2,!0)})]}),!t&&_.includes("Exposure")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"Exposure"}),e.jsx("span",{className:k,children:Qe(u,2,!0)})]}),!t&&_.includes("# Events")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"# Events"}),e.jsx("span",{className:k,children:Qe(h)})]}),!t&&_.includes("# Severe Events")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"# Severe Events"}),e.jsx("span",{className:k,children:Qe(f)})]}),!t&&_.includes("# FEMA Declared Disasters")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"# FEMA Declared Disasters"}),e.jsx("span",{className:k,children:Qe(g)})]}),!t&&_.includes("Frequency (yearly)")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"Frequency"}),e.jsx("span",{className:k,children:Gl((D=p||0)==null?void 0:D.toFixed(2),"yearly")})]}),!t&&_.includes("Frequency (daily)")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"Frequency"}),e.jsx("span",{className:k,children:Gl(((p||0)/365).toFixed(2),"daily")})]}),!t&&_.includes("Frequency (%)")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"Frequency"}),e.jsx("span",{className:k,children:Gl(p?(p/m*100).toFixed(2):0,"%")})]}),!t&&_.includes("Deaths")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"Deaths"}),e.jsx("span",{className:k,children:Qe(x)})]}),!t&&_.includes("Injuries")&&e.jsxs("div",{className:L[j],children:[e.jsx("label",{children:"Injuries"}),e.jsx("span",{className:k,children:Qe(y)})]})]})]})]})},Ng=({visibleCols:t=[],hazard:s,hazardPercentileArray:n=[],size:r,style:a,isTotal:l,type:i,geoid:c,attributionData:d,baseUrl:u})=>{var p,m,h,f,g,x,y,j,N,_,E,L,S;return e.jsxs(e.Fragment,{children:[i==="grid"?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 2xl:grid-cols-4 gap-2 mt-10",children:Object.keys(Ne).filter(k=>!s||!Array.isArray(s)||!s.length||s.includes(k)).sort((k,$)=>Ne[k].name.localeCompare(Ne[$].name)).map(k=>{var $,I,T,A,R,O,M,D,P,F,B,V,G;return e.jsx("div",{children:e.jsx(am,{visibleCols:t,hazard:k,statePercentile:($=n.find(Z=>Z.key===k))==null?void 0:$.statePercentile,nationalPercentile:(I=n.find(Z=>Z.key===k))==null?void 0:I.nationalPercentile,hazardPercentileArray:n,hazardPercentile:(T=n.find(Z=>Z.key===k))==null?void 0:T.value,actualLoss:(A=n.find(Z=>Z.key===k))==null?void 0:A.actualLoss,actualLossWithPop:(R=n.find(Z=>Z.key===k))==null?void 0:R.actualLossWithPop,exposure:(O=n.find(Z=>Z.key===k))==null?void 0:O.exposure,frequency:(M=n.find(Z=>Z.key===k))==null?void 0:M.frequency,frequencySum:n.reduce((Z,X)=>Z+ +X.frequency,0),numEvents:(D=n.find(Z=>Z.key===k))==null?void 0:D.numEvents,numSevereEvents:(P=n.find(Z=>Z.key===k))==null?void 0:P.numSevereEvents,numFEMADeclared:(F=n.find(Z=>Z.key===k))==null?void 0:F.numFEMADeclared,deaths:(B=n.find(Z=>Z.key===k))==null?void 0:B.deaths,injuries:(V=n.find(Z=>Z.key===k))==null?void 0:V.injuries,geoid:c,isTotal:!1,size:r,style:a,eal:(G=n.find(Z=>Z.key===k))==null?void 0:G.eal})},k)})}):e.jsx(am,{visibleCols:t,hazard:s==="total"?"":s,statePercentile:(p=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:p.statePercentile,nationalPercentile:(m=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:m.nationalPercentile,hazardPercentileArray:n,hazardPercentile:(h=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:h.value,actualLoss:(f=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:f.actualLoss,actualLossWithPop:(g=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:g.actualLossWithPop,exposure:(x=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:x.exposure,frequency:(y=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:y.frequency,frequencySum:n.reduce((k,$)=>k+ +$.frequency,0),numEvents:(j=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:j.numEvents,numSevereEvents:(N=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:N.numSevereEvents,numFEMADeclared:(_=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:_.numFEMADeclared,deaths:(E=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:E.deaths,injuries:(L=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:L.injuries,geoid:c,isTotal:l,size:r,style:a,eal:(S=n.filter(k=>k.key===s||s==="total")[0])==null?void 0:S.eal,isGrid:!1}),e.jsx(ct,{baseUrl:u,attributionData:d})]})},VE=(t,s,n)=>{s&&n([])},Cg=(t,s,n,r)=>{let a=t.map(l=>l.key);a=a.includes("all")?r.map(l=>l.key).filter(l=>l&&l!=="all"):a.includes(null)?[]:a,s(a.includes("all")?r.filter(l=>l.key&&l.key!=="all"):a.includes(null)?[]:t),n&&n(a)},HE=({props:t,selected:s,setSelected:n,onChange:r})=>e.jsxs("div",{className:"w-fit inline-block ml-2",children:[t.label,e.jsx("button",{className:"hover:text-red-300 animate ml-1 p-1 rounded-md rbt-token-remove-button",onClick:a=>{const l=s.filter(i=>i.key!==t.key);Cg(l,n,r)},children:e.jsx("i",{className:"fa fa-close"})})]}),zE=(t,s,n,...r)=>e.jsx(cn,{className:"bg-slate-100  overflow-hidden z-10",...s,children:t.map((a,l)=>e.jsx(dn,{className:"block hover:bg-slate-200 text-xl tracking-wide pl-1",option:a,position:l,children:a.label}))}),UE=({className:t,value:s,onChange:n,showAll:r=!1})=>{const[a,l]=b.useState([]),i=[...r?[{key:"all",label:"Select All"},{key:null,label:"Clear All"}]:[],...Object.keys(Ne).sort((c,d)=>Ne[c].name.localeCompare(Ne[d].name)).map((c,d)=>({key:c,label:Ne[c].name}))];return b.useEffect(()=>{if(!s)return;const c=i.filter(d=>Array.isArray(s)&&s.includes(d.key))||[];l(c)},[s]),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"FEMA Disaster:"}),e.jsxs("div",{className:`flex flex row ${t} w-full shrink my-1 bg-white p-1 pl-3 rounded-l-md`,children:[e.jsx("i",{className:"fa fa-search font-light text-xl bg-white rounded-r-md"}),e.jsx(Ko,{className:"w-full",multiple:!0,onSearch:VE,minLength:0,id:"hazard-search",placeholder:"Search for a FEMA Disaster...",options:i,labelKey:c=>`${c==null?void 0:c.label}`,defaultSelected:a,onChange:c=>Cg(c,l,n,i),selected:a,inputProps:{className:"flex flex-row flex-wrap"},renderMenu:zE,renderToken:c=>e.jsx(HE,{props:c,selected:a,setSelected:l,onChange:n})},"hazard-search")]})]})},rm=Object.keys(Ne).reduce((t,s)=>({...t,[s]:`sum(${C(Ne,[s,"prefix"],"total")}_afreq) as ${C(Ne,[s,"prefix"],"total")}_freq`}),{}),om=Object.keys(Ne).reduce((t,s)=>({...t,[s]:`sum(${C(Ne,[s,"prefix"],"total")}_expt) as ${C(Ne,[s,"prefix"],"total")}_exp`}),{}),WE=Object.keys(Ne).reduce((t,s)=>({...t,[s]:`sum(${C(Ne,[s,"prefix"],"total")}_evnts) as ${C(Ne,[s,"prefix"],"total")}_evnts`}),{});async function _g({ealSourceId:t=343,ealViewId:s,isTotal:n,geoid:r,hazard:a,severeEventThreshold:l,type:i,visibleCols:c,style:d},u){var q,te;const p=n?"total_rank":"hazard_rank",m=n?"nri_eal_total":"nri_eal";r=""+r;let h=`substring(stcofips, 1, ${(q=r==null?void 0:r.toString())==null?void 0:q.length})`,f=JSON.stringify({filter:{[h]:[r]},groupBy:[h]}),g=K=>["dama",oe,"viewsbyId",K,"options",f],x="sum(fusion_property_damage) + sum(fusion_crop_damage) as actual_damage",y="sum(fusion_property_damage) + sum(fusion_crop_damage) + (sum(swd_population_damage) * 11600000) as actual_damage_with_population",j=`count(distinct CASE WHEN coalesce(fusion_property_damage, 0) + coalesce(fusion_crop_damage, 0) + coalesce(swd_population_damage, 0) >= ${l} THEN event_id ELSE null END) as num_severe_events`,N=`count(distinct CASE WHEN disaster_number is not null AND coalesce((fusion_property_damage), 0) + coalesce((fusion_crop_damage), 0)+ coalesce((swd_population_damage), 0) > 0 
							  THEN disaster_number 
							  WHEN disaster_number is null THEN event_id::text
						END) as num_events`,_="COALESCE(array_length(array_remove(array_agg(distinct CASE WHEN coalesce((fusion_property_damage), 0) + coalesce((fusion_crop_damage), 0)+ coalesce((swd_population_damage), 0) > 0 THEN disaster_number ELSE null END), null), 1), 0) as num_fema_declared",E="sum(deaths_direct) + sum(deaths_indirect) as deaths",L="sum(injuries_direct) + sum(injuries_indirect) as injuries",S=`substring(geoid, 1, ${(te=r==null?void 0:r.toString())==null?void 0:te.length})`,k=[`${S} as geoid`,"nri_category",x,y,N,j,_,E,L],$=[`${S} as geoid`,x,y],I=JSON.stringify({aggregatedLen:!0,filter:n?{[S]:[r]}:{[S]:[r]},exclude:{"EXTRACT(YEAR from coalesce(fema_incident_begin_date, swd_begin_date))":["null"]},groupBy:[S,"nri_category"]}),T=JSON.stringify({aggregatedLen:!0,filter:n?{[S]:[r]}:{[S]:[r]},exclude:{"EXTRACT(YEAR from coalesce(fema_incident_begin_date, swd_begin_date))":["null"]},groupBy:[S]}),A=K=>["dama",oe,"viewsbyId",K,"options",I],R=K=>["dama",oe,"viewsbyId",K,"options",T];const O=await u.get(["dama",oe,"viewDependencySubgraphs","byViewId",s],["comparative_stats",oe,"byEalIds","source",t,"view",s,"byGeoid",r]),M=C(O,["json","dama",oe,"viewDependencySubgraphs","byViewId",s,"dependencies"]),D=M.find(K=>K.type==="nri"),P=M.find(K=>K.type==="fusion");if(!P)return{};const F=await u.get([...A(P.view_id),"length"]),B=C(F,["json",...A(P.view_id),"length"],0),V=[...A(P.view_id),"databyIndex",{from:0,to:B-1},k],G=[...R(P.view_id),"databyIndex",{from:0,to:0},$],Z=["dama",oe,"views","byId",[s,D.view_id,P.view_id],"attributes",["source_id","view_id","version","_modified_timestamp"]],X=n&&B?[V,G,Z]:!n&&B?[[...g(D.view_id),"databyIndex",{from:0,to:B-1},[...Object.values(rm),...Object.values(om),...Object.values(WE)]],V,G,Z]:[];await u.get(...X);const H=u.getCache(),z=K=>C(H,["dama",oe,"views","byId",K,"attributes"],{}),W=[s,D.view_id,P.view_id].map(K=>{var ne,J,ae,de,ue;return{source_id:(ne=z(K))==null?void 0:ne.source_id,view_id:(J=z(K))==null?void 0:J.view_id,version:(ae=z(K))==null?void 0:ae.version,_modified_timestamp:(ue=(de=z(K))==null?void 0:de._modified_timestamp)==null?void 0:ue.value}});return{hazardPercentileArray:C(H,["comparative_stats",oe,"byEalIds","source",t,"view",s,"byGeoid",r,"value"],[]).filter(K=>K.geoid==r&&Ne[K.nri_category]).map(K=>({key:K.nri_category,label:Ne[K.nri_category].name,color:Ne[K.nri_category].color,value:(K.nri_eal*100/K.nri_eal_total).toFixed(2),eal:C(K,m,0),nationalPercentile:C(K,p,0)*100,actualLoss:(Object.values(C(H,n?[...R(P.view_id),"databyIndex"]:[...A(P.view_id),"databyIndex"],{})).find(ne=>ne.nri_category===K.nri_category)||{})[x],actualLossWithPop:(Object.values(C(H,n?[...R(P.view_id),"databyIndex"]:[...A(P.view_id),"databyIndex"],{})).find(ne=>ne.nri_category===K.nri_category)||{})[y],numSevereEvents:(Object.values(C(H,[...A(P.view_id),"databyIndex"],{})).find(ne=>ne.nri_category===K.nri_category)||{})[j],numEvents:(Object.values(C(H,[...A(P.view_id),"databyIndex"],{})).find(ne=>ne.nri_category===K.nri_category)||{})[N],numFEMADeclared:(Object.values(C(H,[...A(P.view_id),"databyIndex"],{})).find(ne=>ne.nri_category===K.nri_category)||{})[_],deaths:(Object.values(C(H,[...A(P.view_id),"databyIndex"],{})).find(ne=>ne.nri_category===K.nri_category)||{})[E],injuries:(Object.values(C(H,[...A(P.view_id),"databyIndex"],{})).find(ne=>ne.nri_category===K.nri_category)||{})[L],exposure:C(H,[...g(D.view_id),"databyIndex",0,om[K.nri_category]]),frequency:C(H,[...g(D.view_id),"databyIndex",0,rm[K.nri_category]],0)})).sort((K,ne)=>+ne.value-+K.value),attributionData:W,size:i==="card"&&a!=="total"?"small":i==="card"&&a==="total"?"large":"small",visibleCols:c,style:d,ealViewId:s,geoid:r,hazard:a,isTotal:n,type:i,severeEventThreshold:l}}const GE=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l=343,[i,c]=b.useState((a==null?void 0:a.ealViewId)||837),[d,u]=b.useState(!0),[p,m]=b.useState((a==null?void 0:a.hazard)||"total"),[h,f]=b.useState((a==null?void 0:a.type)||"card"),[g,x]=b.useState((a==null?void 0:a.style)||"compact"),[y,j]=b.useState(a==null?void 0:a.status),[N,_]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[E,L]=b.useState((a==null?void 0:a.isTotal)||p==="total"&&h==="card"),[S,k]=b.useState((a==null?void 0:a.visibleCols)||[]),[$,I]=b.useState(a.severeEventThreshold||1e6),T=[{label:"National Percentile Bar",forTotal:void 0},{label:"Loss Distribution Bar",forTotal:!0},{label:"Hazard Percentile Bar",forTotal:!1},{label:"Expected Annual Loss (EAL)",forTotal:void 0},{label:"Actual Loss",forTotal:!1},{label:"Actual Loss (with Population)",forTotal:!1},{label:"Exposure",forTotal:!1},{label:"# Events",forTotal:!1},{label:"Frequency (yearly)",forTotal:!1},{label:"Frequency (daily)",forTotal:!1},{label:"Frequency (%)",forTotal:!1},{label:"# Severe Events",forTotal:!1},{label:"# FEMA Declared Disasters",forTotal:!1},{label:"Deaths",forTotal:!1},{label:"Injuries",forTotal:!1}];w.useEffect(()=>{async function M(){j(N?void 0:"Please Select a Geography"),u(!0),j(void 0);const D=await _g({ealSourceId:l,ealViewId:i,geoid:N,hazard:p,isTotal:E,type:h,visibleCols:S,severeEventThreshold:$,style:g},n);s(JSON.stringify({...D})),u(!1)}M()},[i,N,p,E,h,S,$,g]);const A=a.size,R=a.attributionData,O=a.hazardPercentileArray;return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:l,view_id:i,onChange:c,className:"flex-row-reverse"}),e.jsx(rt,{value:N,onChange:_,className:"flex-row-reverse"}),e.jsx(ze,{label:"Component Type:",types:["card","grid"],type:h,setType:M=>{m(M==="grid"?null:"total"),L(M==="card"),f(M)}}),e.jsx(ze,{label:"Component Style:",types:["compact","full"],type:g,setType:x}),h==="grid"?e.jsx(UE,{value:p==="total"||!p?Object.keys(Ne):Array.isArray(p)?p:[p],onChange:m,className:"flex-row-reverse",showAll:!0}):e.jsx(Gs,{hazard:p,setHazard:M=>{L(M==="total"),m(M)},showTotal:!0}),e.jsx(Ls,{cols:T.filter(M=>M.forTotal===E||M.forTotal===void 0).map(M=>M.label),visibleCols:S,setVisibleCols:k}),S.includes("# Severe Events")&&e.jsxs("div",{className:"w-full pt-2 mt-3 flex flex-row text-sm",children:[e.jsx("label",{className:"shrink-0 pr-2 py-2 my-1 w-1/4",children:"Severe Events Threshold:"}),e.jsx("input",{className:"p-2 ml-2 my-1 bg-white rounded-md w-full shrink",type:"number",value:$,onChange:M=>I(M.target.value),onWheel:M=>M.target.blur(),placeholder:"Enter Threshold"})]})]}),e.jsx("div",{className:"relative w-full p-1",children:d?e.jsx(dt,{}):y?e.jsx("div",{className:"p-5 text-center",children:y}):e.jsx("div",{children:e.jsx(Ng,{visibleCols:S,hazard:p,hazardPercentileArray:O,size:A,style:g,isTotal:E,type:h,attributionData:R,baseUrl:"/"})})})]})})},JE=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"",children:e.jsx(Ng,{...s,baseUrl:"/"})})},qE={name:"Card: Hazard Risk",type:"Card/Grid",variables:[{name:"ealSourceId",default:343,hidden:!0},{name:"ealViewId",default:837,hidden:!0},{name:"geoid",default:"36"},{name:"hazard",default:"total",hidden:!0},{name:"isTotal",default:!0,hidden:!0},{name:"type",default:"card",hidden:!0},{name:"visibleCols",default:[],hidden:!0},{name:"severeEventThreshold",default:1e6,hidden:!0},{name:"style",default:"compact",hidden:!0}],getData:_g,EditComp:GE,ViewComp:JE},Ui=t=>typeof(t==null?void 0:t.value)=="object"?Ui(t.value):(t==null?void 0:t.value)||t,Sg=({data:t=[],columns:s=[],nriAttributes:n,filterValue:r={},pageSize:a,sortBy:l={},baseUrl:i,attributionData:c,geoid:d,striped:u})=>{var f,g;const p=s.map(x=>(x.Header,{...x,Cell:y=>{let j=Ui(y.value);return j=x.isText?j:us(j||0,x.isDollar),e.jsx("div",{children:j})}})),m=(f=p.find(x=>{var y;return x.Header===((y=Object.keys(l))==null?void 0:y[0])}))==null?void 0:f.accessor,h=t.filter(x=>!Object.keys(r||{}).length||Object.keys(r).reduce((y,j)=>{var E,L;const N=(E=n.find(S=>S.label===j))==null?void 0:E.value,_=Ui(x[N]);return y&&(_==null?void 0:_.toString().toLowerCase().includes((L=r[j])==null?void 0:L.toLowerCase()))},!0));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-5",children:(t==null?void 0:t.length)>0&&(s==null?void 0:s.length)>0&&e.jsx(St,{columns:p,data:h,initialPageSize:a,pageSize:a,striped:u,sortBy:m,sortOrder:((g=Object.values(l))==null?void 0:g[0])||"asc"})}),e.jsx(ct,{baseUrl:i,attributionData:c})]})},ro={type:"nri",attributes:{"Frequency (yearly)":"afreq",Exposure:"exp",EAL:"eal"},consequences:{Property:"b",Crop:"a",Population:"p","Population $":"pe",Total:"t"},dataSources:[{label:"NRI Counties",value:"nri",geoLayer:"counties",geomCol:"stcofips",geomColLabel:"County",geomView:286},{label:"NRI Census Tracts",value:"nri_tracts",geoLayer:"tracts",geomCol:"tractfips",geomColLabel:"Tract",geomView:286},{label:"Derive From EAL Version Dependency",value:"avail_counties",geoLayer:"counties",geomCol:"stcofips",geomColLabel:"County",geomView:286}],columns:function(t,s){var r;if(!t||t==="total")return[];const n=[{value:"stcofips",label:"County",filter:"text",width:"20%",isText:!0}];return s==="nri_tracts"&&n.push({value:(r=this.dataSources.find(a=>a.value===s))==null?void 0:r.geomCol,label:"Tract",filter:"text",width:"20%",isText:!0}),n.push(...Object.keys(this.attributes).reduce((a,l)=>{var d;let i={value:`${(d=Ne[t])==null?void 0:d.prefix}_${this.attributes[l]}`,label:`${l}`,isDollar:!1};const c=Object.keys(this.consequences).filter(u=>{var p,m;return(m=(p=Ne[t])==null?void 0:p.consequences)==null?void 0:m.includes(this.consequences[u])}).map(u=>({value:`${i.value}${this.consequences[u]}`,label:`${u} ${i.label}`,isDollar:!0}));return l==="Frequency (yearly)"?[...a,i]:[...a,...c]},[])),n}},KE=343,YE=159,ZE=346,XE={avail_counties:KE,nri:YE,nri_tracts:ZE};async function $g({dataSource:t,geoid:s,filters:n,dataSourceViewId:r,hazard:a,visibleCols:l,pageSize:i,sortBy:c,filterValue:d,dataSourceSRCId:u},p){var F,B,V,G,Z,X,H;let m;const h=(F=ro.dataSources.find(z=>z.value===t))==null?void 0:F.geomView,f=(B=ro.dataSources.find(z=>z.value===t))==null?void 0:B.geomCol,g=ro.columns(a,t),x=JSON.stringify({aggregatedLen:!1,filter:{[`substring(${f}, 1, ${(V=s==null?void 0:s.toString())==null?void 0:V.length})`]:[s]}}),y=JSON.stringify({filter:{[`substring(${f}, 1, ${(G=s==null?void 0:s.toString())==null?void 0:G.length})`]:[s]}}),j=z=>["dama",oe,"viewsbyId",z,"options"];let N=(Z=g.find(z=>z.value==="stcofips"||z.value==="tractfips"))==null?void 0:Z.label;const _=JSON.stringify({...s&&{filter:{[`substring(geoid, 1, ${(X=s==null?void 0:s.toString())==null?void 0:X.length})`]:[s]}}}),E=z=>["dama",oe,"viewsbyId",z,"options",_],L=z=>["dama",oe,"viewDependencySubgraphs","byViewId",z];if(n={...n,...g.filter(z=>z.filter).reduce((z,W)=>({...z,[W.label]:W.filter}),{})},t==="avail_counties"){const z=await p.get(L(r));if(m=(H=C(z,["json",...L(r),"dependencies"]).find(Y=>Y.type==="nri"))==null?void 0:H.view_id,!m)return{}}else m=r;if(!m)return{};const S=await p.get([...E(h),"length"]),k=C(S,["json",...E(h),"length"],0);k&&await p.get([...E(h),"databyIndex",{from:0,to:k-1},["geoid","namelsad"]]);const $=await p.get([...j(m),x,"length"]),I=Math.min(C($,["json",...j(m),x,"length"],0),250),T={from:0,to:I-1};await p.get([...j(m),y,"databyIndex",T,g.map(z=>z.value)],["dama",oe,"views","byId",m,"attributes",["source_id","view_id","version","_modified_timestamp"]]);const A=p.getCache(),R=Object.values(C(A,[...E(h),"databyIndex"],{})),O=z=>(z.map(W=>{var Y;W.stcofips=((Y=R==null?void 0:R.find(U=>U.geoid===W.stcofips))==null?void 0:Y.namelsad)||W.stcofips}),z),M=Object.values(C(A,[...j(m),y,"databyIndex"],{}));O(M);const D=l.map(z=>g.find(W=>W.label===z)).filter(z=>z).map(z=>({Header:z.label,accessor:z.value,align:z.align||"right",width:z.width||"15%",filter:z.filter||n[z.label],...z})),P=C(A,["dama",oe,"views","byId",m,"attributes"],{});return{dataSource:t,dataSourceSRCId:u,dataSourceViewId:r,typeId:m,hazard:a,geoid:s,data:M,columns:D,visibleCols:l,pageSize:i,sortBy:c,filterValue:d,attributionData:P,nriAttributes:g,anchorCols:N}}const Eg=({value:t,onChange:s})=>{var M;const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",[i,c]=b.useState((a==null?void 0:a.dataSource)||"avail_counties"),[d,u]=b.useState((a==null?void 0:a.dataSourceSRCId)||343),[p,m]=b.useState((a==null?void 0:a.dataSourceViewId)||837),[h,f]=b.useState(!0),[g,x]=b.useState(a==null?void 0:a.status),[y,j]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[N,_]=b.useState((a==null?void 0:a.filters)||{}),[E,L]=b.useState((a==null?void 0:a.filterValue)||{}),[S,k]=b.useState((a==null?void 0:a.visibleCols)||[]),[$,I]=b.useState((a==null?void 0:a.pageSize)||5),[T,A]=b.useState((a==null?void 0:a.sortBy)||{}),[R,O]=b.useState(a==null?void 0:a.hazard);return b.useEffect(()=>{async function D(){if(!y||!R){!y&&x("Please Select a Geography"),!R&&x("Please Select a Hazard");return}else x(void 0);f(!0),x(void 0);const P=await $g({dataSource:i,dataSourceSRCId:d,dataSourceViewId:p,geoid:y,filters:N,hazard:R,visibleCols:S,pageSize:$,sortBy:T,filterValue:E},n);s(JSON.stringify({...P})),f(!1)}D()},[y,R,i,d,p,$,T,N,E,S]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(ze,{label:"Data Source:",types:ro.dataSources,type:i,setType:D=>{u(XE[D]),m(void 0),k([]),c(D)}}),e.jsx(Ct,{source_id:d,view_id:p,onChange:m,className:"flex-row-reverse"}),e.jsx(rt,{value:y,onChange:j,className:"flex-row-reverse"}),e.jsx(Gs,{hazard:R,setHazard:O}),e.jsx(Ls,{cols:(M=a.nriAttributes)==null?void 0:M.map(D=>D.label),anchorCols:a.anchorCols?[a.anchorCols]:[],visibleCols:S,setVisibleCols:k,filters:N,setFilters:_,filterValue:E,setFilterValue:L,pageSize:$,setPageSize:I,sortBy:T,setSortBy:A})]}),h?e.jsx(dt,{}):g?e.jsx("div",{className:"p-5 text-center",children:g}):e.jsx(Sg,{geoid:y,data:a.data,columns:a.columns,nriAttributes:a.nriAttributes,filterValue:E,pageSize:$,sortBy:T,attributionData:a.attributionData,baseUrl:l})]})})};Eg.settings={hasControls:!0,name:"ElementEdit"};const QE=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(Sg,{...s,baseUrl:"/"})})},e7={name:"Table: NRI",type:"Table",variables:[{name:"dataSource",default:"avail_counties",hidden:!0},{name:"dataSourceSRCId",default:343,hidden:!0},{name:"dataSourceViewId",default:837,hidden:!0},{name:"typeId",default:837,hidden:!0},{name:"geoid",default:"36"},{name:"filters",default:[],hidden:!0},{name:"filterValue",default:{},hidden:!0},{name:"visibleCols",default:[],hidden:!0},{name:"sortBy",default:{},hidden:!0}],getData:$g,EditComp:Eg,ViewComp:QE},kg=({value:t,onChange:s})=>{const n=t&&tt(t)?JSON.parse(t):{},r={text:"",size:"4xl",color:"000000"},[a,l]=b.useState((n==null?void 0:n.bgColor)||"rgba(0,0,0,0)"),[i,c]=b.useState((n==null?void 0:n.text)||t||r);b.useEffect(()=>{s(JSON.stringify({bgColor:a,text:i}))},[a,i]);const d=gt.lexical.EditComp;return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsx(Di,{title:"Background: ",className:"w-full px-2 py-1 flex flex-row text-sm items-center border border-dashed",color:a,setColor:l}),e.jsx(d,{value:i,onChange:c,bgColor:a})]})})};kg.settings={hasControls:!0,name:"ElementEdit"};const t7=({value:t})=>{var a,l,i,c,d,u,p,m;if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);const n=(s==null?void 0:s.text)||t;if(!n||((l=(a=n==null?void 0:n.root)==null?void 0:a.children)==null?void 0:l.length)===1&&((u=(d=(c=(i=n==null?void 0:n.root)==null?void 0:i.children)==null?void 0:c[0])==null?void 0:d.children)==null?void 0:u.length)===0||((m=(p=n==null?void 0:n.root)==null?void 0:p.children)==null?void 0:m.length)===0)return null;const r=gt.lexical.ViewComp;return e.jsx("div",{children:e.jsx(r,{value:n,bgColor:s==null?void 0:s.bgColor})})},lm={name:"Card: Callout",hideInSelector:!0,EditComp:kg,ViewComp:t7},Ps={fusion:{title:"Fusion Losses",type:"fusion",columns:{"Property Loss":"sum(fusion_property_damage) as property_damage","Crop Loss":"sum(fusion_crop_damage) as crop_damage","Population Loss":"sum(swd_population_damage) * 11000000 as population_damage","Deaths, Injuries":"sum(COALESCE(deaths_direct, 0) + COALESCE(deaths_indirect, 0) + COALESCE(injuries_direct, 0) + COALESCE(injuries_indirect, 0)) as deaths_injuries","Total Loss":"sum(COALESCE(fusion_property_damage, 0) + COALESCE(fusion_crop_damage, 0)) as total_loss","Total Loss (incl Population)":"sum(COALESCE(fusion_property_damage, 0) + COALESCE(fusion_crop_damage, 0) + (COALESCE(swd_population_damage, 0) * 11000000)) as total_loss_with_pop"},rawColumns:{"Property Loss":"fusion_property_damage","Crop Loss":"fusion_crop_damage","Population Loss":"swd_population_damage","Deaths, Injuries":"COALESCE(deaths_direct, 0) + COALESCE(deaths_indirect, 0) + COALESCE(injuries_direct, 0) + COALESCE(injuries_indirect, 0)","Total Loss":"COALESCE(fusion_property_damage, 0) + COALESCE(fusion_crop_damage, 0)","Total Loss (incl Population)":"COALESCE(fusion_property_damage, 0) + COALESCE(fusion_crop_damage, 0) + COALESCE(swd_population_damage, 0)"}}},s7=async({falcor:t,choroplethPath:s,attributionPath:n,choroplethAttributes:r,typeId:a,setLoading:l,setData:i})=>{const c=await t.get([...s(a.view_id),"length"],n(a.view_id)),d=C(c,["json",...s(a.view_id),"length"]);if(!d)return Promise.resolve();const u=await t.get([...s(a.view_id),"databyIndex",{from:0,to:d-1},Object.values(r)]);let p=Object.values(C(u,["json",...s(a.view_id),"databyIndex"],{}));if(p=[...Array(d).keys()].map(m=>Object.keys(r).reduce((h,f)=>({...h,[f]:p[m][r[f]]}),{})),!(p!=null&&p.length))return l(!1),Promise.resolve();i(p)},n7=async({falcor:t,eventMagnitudePath:s,attributionPath:n,circlesPath:r,countyCentroidPath:a,countyCentroidOptions:l,countyCentroidAttributes:i,eventMagnitudeAttributes:c,circlesOptions:d,circlesAttributes:u,typeId:p,nceiEView:m,countyView:h,setLoading:f,setData:g,attribute:x})=>{const y=await t.get([...s(p.view_id),"length"],n(p.view_id)),j=C(y,["json",...s(p.view_id),"length"]);if(!j)return f(!1),Promise.resolve();const N=await t.get([...s(p.view_id),"databyIndex",{from:0,to:j-1},Object.values(c)]);let _=Object.values(C(N,["json",...s(p.view_id),"databyIndex"],{}));if(_=[...Array(j).keys()].map($=>Object.keys(c).reduce((I,T)=>({...I,[T]:_[$][c[T]]}),{})),!(_!=null&&_.length))return f(!1),Promise.resolve();const E=_.map($=>$.event_id);await t.get([...r(m.view_id),d(E),"databyIndex",{from:0,to:E.length-1},Object.values(u)]);let L=Object.values(C(t.getCache(),[...r(m.view_id),d(E),"databyIndex"],{}));const S=[...new Set([...L.filter($=>$.begin_lat===0).map($=>$["substring(geoid, 1, 5) as geoid"]),..._.filter($=>!$.event_id).map($=>$.geoid)])],k=[];if(L.filter($=>$.begin_lat!==0).forEach(({event_id:$,"ST_AsGeoJson(ST_setSrid(ST_MakePoint(begin_lon, begin_lat), 4326)) as point":I,...T})=>{var O,M,D;const A=(O=_.find(P=>P.event_id===$))==null?void 0:O[Ps.fusion.columns[x]],R=(M=_.find(P=>P.event_id===$))==null?void 0:M.nri_category;k.push({event_id:$,location:I,magnitude:A,color:(D=Ne[R])==null?void 0:D.color})}),S.length){await t.get([...a(h.view_id),l(S),"databyIndex",{from:0,to:S.length-1},Object.values(i)]);const $=Object.values(C(t.getCache(),[...a(h.view_id),l(S),"databyIndex"],{}));L.filter(I=>I.begin_lat===0).forEach(({event_id:I,"substring(geoid, 1, 5) as geoid":T})=>{var M,D,P,F;const A=(M=$.find(B=>B.geoid===T))==null?void 0:M[i.centroid],R=(D=_.find(B=>B.event_id===I))==null?void 0:D.nri_category,O=(P=_.find(B=>B.event_id===I))==null?void 0:P[Ps.fusion.columns[x]];A&&k.push({event_id:I,location:A,magnitude:O,color:(F=Ne[R])==null?void 0:F.color})}),_.filter(I=>!I.event_id).forEach(({geoid:I,nri_category:T,...A})=>{var M,D;const R=(M=$.find(P=>P.geoid===I))==null?void 0:M[i.centroid],O=A[Ps.fusion.columns[x]];R&&k.push({event_id:`${I} FEMA Event (No NCEI match)`,location:R,magnitude:O,color:(D=Ne[T])==null?void 0:D.color})})}g(k)},a7=async({geoid:t,data:s,pgEnv:n,falcor:r,stateView:a,setMapfocus:l})=>{const i=["st_asgeojson(st_orientedenvelope(st_union(geom)), 9, 1)  as geom"],c={from:0,to:0},d=C(s,[0,"geoid"])||(t==null?void 0:t.substring(0,2)),u=({view_id:h})=>["dama",n,"viewsbyId",h,"options",JSON.stringify({filter:{geoid:[d.substring(0,2)]}}),"databyIndex"],p=await r.get([...u(a),c,i]),m=C(p,["json",...u(a),0,i]);m&&l(C(JSON.parse(m),"bbox"))},Lg=(t=[],s=[])=>!(t!=null&&t.length)||!(s!=null&&s.length)?[]:t!=null&&t.length&&(s!=null&&s.length)?dl(t,Math.min(t==null?void 0:t.length,s==null?void 0:s.length)):[],r7=(t,s)=>{const n=Lg(t,s);return ps().domain(n).range(s)},o7=(t=[])=>js().domain([Math.min(...t),Math.max(...t)]).range([5,50]),l7=({geoid:t,data:s=[],columns:n=[],paintFn:r,colors:a=[],...l})=>{if(!(s!=null&&s.length)||!(a!=null&&a.length))return{};const i=s.map(m=>m.geoid),c=((t==null?void 0:t.substring(0,2))||i[0]||"00").substring(0,2),d={},u=r7(s.map(m=>r?r(m):m[n==null?void 0:n[0]]).filter(m=>m),a),p=Lg(s.map(m=>r?r(m):m[n==null?void 0:n[0]]).filter(m=>m),a);for(let m=0;m<=999;m+=1){const h=c+m.toString().padStart(3,"0"),f=s.find(x=>x.geoid===h)||{},g=r?r(f):f[n==null?void 0:n[0]];d[h]=i.includes(h)&&g?u(g):"#d3d3d3"}return{geoColors:d,domain:p}},i7=t=>{try{return JSON.parse(t)}catch{return null}},c7=({data:t=[]})=>{const s=o7(t.filter(r=>!isNaN(+r.magnitude)).map(r=>+r.magnitude));return{type:"FeatureCollection",features:t.map(r=>({type:"Feature",properties:{color:r.color,borderColor:"#6e6e6e",radius:s(+r.magnitude),...r},geometry:i7(r.location)}))}},Ig=({value:t,onChange:s,size:n})=>{var ge,le;const{falcor:r,falcorCache:a}=et();let l=t&&tt(t)?JSON.parse(t):{};const i="/",c=343,[d,u]=b.useState((l==null?void 0:l.ealViewId)||837),[p,m]=b.useState(!0),[h,f]=b.useState(l==null?void 0:l.status),[g,x]=b.useState((l==null?void 0:l.geoid)||"36"),[y,j]=b.useState((l==null?void 0:l.type)||"Choropleth"),[N,_]=b.useState((l==null?void 0:l.attribute)||"Property Loss"),[E,L]=b.useState((l==null?void 0:l.hazard)||"hail"),[S,k]=b.useState(l==null?void 0:l.typeId),[$,I]=b.useState(l==null?void 0:l.data),[T,A]=b.useState(l==null?void 0:l.mapFocus),[R,O]=b.useState((l==null?void 0:l.numColors)||5),[M,D]=b.useState((l==null?void 0:l.shade)||"Oranges"),[P,F]=b.useState((l==null?void 0:l.colors)||Js(5,"Oranges")),[B,V]=b.useState(l==null?void 0:l.title),[G,Z]=b.useState((l==null?void 0:l.height)||500),X=ie=>["dama",oe,"viewDependencySubgraphs","byViewId",ie],H="geoid",z=Object.values(Ps.fusion.columns),W=JSON.stringify({aggregatedLen:!0,filter:{[`substring(${H}, 1, ${(ge=g==null?void 0:g.toString())==null?void 0:ge.length})`]:[g],nri_category:[E]},groupBy:[H]}),Y={geoid:`${H} as geoid`,event_ids:"array_agg(distinct event_id) as event_ids",...(z||[]).reduce((ie,be)=>({...ie,[be]:`${be}`}),{})},U=ie=>["dama",oe,"viewsbyId",ie,"options",W],q=Object.values(Ps.fusion.columns),te=JSON.stringify({aggregatedLen:!0,filter:{[`substring(${H}, 1, ${(le=g==null?void 0:g.toString())==null?void 0:le.length})`]:[g],nri_category:[E]},exclude:{[Ps.fusion.rawColumns[N]]:["null",0]},groupBy:[H,"event_id","nri_category"]}),K={geoid:`${H} as geoid`,event_id:"event_id",nri_category:"nri_category",...(q||[]).reduce((ie,be)=>({...ie,[be]:`${be}`}),{})},ne=ie=>["dama",oe,"viewsbyId",ie,"options",te],J=ie=>JSON.stringify({filter:{event_id:ie}}),ae={geoid:`substring(${H}, 1, 5) as geoid`,event_id:"event_id",lat:"begin_lat",lon:"begin_lon",point:"ST_AsGeoJson(ST_setSrid(ST_MakePoint(begin_lon, begin_lat), 4326)) as point"},de=ie=>["dama",oe,"viewsbyId",ie,"options"],ue=ie=>JSON.stringify({filter:{geoid:ie}}),fe={geoid:"geoid",centroid:"st_asgeojson(st_centroid(geom)) as centroid"},ve=ie=>["dama",oe,"viewsbyId",ie,"options"],se=ie=>["dama",oe,"views","byId",ie,"attributes",["source_id","view_id","version","_modified_timestamp"]];b.useEffect(()=>{async function ie(){if(g)f(void 0);else return!g&&f("Please Select a Geography"),Promise.resolve();return m(!0),f(void 0),r.get(X(d)).then(async be=>{const _e=C(be,["json",...X(d),"dependencies"]),Re=_e.find(ut=>ut.type==="tl_state"),Pe=_e.find(ut=>ut.type==="tl_county"),Ge=_e.find(ut=>ut.type==="fusion"),Ue=_e.find(ut=>ut.type==="ncei_storm_events_enhanced");if(!Ge)return m(!1),f("This component only supports EAL versions that use Fusion data."),Promise.resolve();k(Ge.view_id),V(`Fusion ${N}`),y==="Choropleth"&&await s7({falcor:r,choroplethPath:U,attributionPath:se,choroplethAttributes:Y,typeId:Ge,setLoading:m,setData:I}),y==="Circles"&&await n7({falcor:r,eventMagnitudePath:ne,attributionPath:se,circlesPath:de,countyCentroidPath:ve,countyCentroidOptions:ue,countyCentroidAttributes:fe,eventMagnitudeAttributes:K,circlesOptions:J,circlesAttributes:ae,typeId:Ge,nceiEView:Ue,countyView:Pe,setLoading:m,setData:I,attribute:N}),await a7({geoid:g,data:$,pgEnv:oe,falcor:r,stateView:Re,setMapfocus:A}),m(!1)})}ie()},[g,d,y,R,M,P,E,N]);const{geoColors:me,domain:xe}=l7({geoid:g,data:$,columns:z,paintFn:ie=>ie[Ps.fusion.columns[N]],colors:P}),re=c7({data:$}),Q=C(a,["dama",oe,"views","byId",S,"attributes"],{}),pe=b.useMemo(()=>({ccl:{view:Ps.fusion,data:($||[]).map(ie=>({event_id:ie.event_id,magnitude:ie.magnitude})),domain:y==="Circles"?[...new Set($.map(ie=>ie.magnitude))]:xe,range:y==="Circles"?[5,50]:P,showLegend:!0,geoJson:re,hazard:E,attribute:N,type:y,geoColors:me,mapFocus:T,colors:P,title:B,size:n,height:G,change:ie=>s(JSON.stringify({...ie,domain:y==="Circles"?[...new Set($.map(be=>be.magnitude))]:xe,range:y==="Circles"?[5,50]:P,ealViewId:d,geoid:g,hazard:E,geoJson:re,attribute:N,status:h,type:y,typeId:S,attributionData:Q,data:$,geoColors:me,mapFocus:T,numColors:R,colors:P,height:G}))}}),[d,g,E,re,N,h,y,S,Q,$,me,T,xe,R,P,G,B,n]);return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(Ct,{source_id:c,view_id:d,onChange:u,className:"flex-row-reverse"}),e.jsx(rt,{value:g,onChange:x,className:"flex-row-reverse"}),e.jsx(Gs,{hazard:E,setHazard:ie=>{I([]),L(ie)}}),e.jsx(ze,{label:"Type:",types:["Choropleth","Circles"],type:y,setType:ie=>{I([]),j(ie)}}),e.jsx(ze,{label:"Attribute:",types:Object.keys(Ps.fusion.columns).map(ie=>({label:ie,value:ie})),type:N,setType:_}),y==="Choropleth"&&e.jsx(cl,{title:"Colors: ",numColors:R,setNumColors:O,shade:M,setShade:D,colors:P,setColors:F}),e.jsx(ze,{label:"Size:",types:[{label:"Small",value:500},{label:"Medium",value:700},{label:"Large",value:900}],type:G,setType:ie=>{Z(ie)}})]}),p?e.jsx(dt,{}):h?e.jsx("div",{className:"p-5 text-center",children:h}):e.jsxs(w.Fragment,{children:[e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${G}px`},children:e.jsx(qs,{falcor:r,layerProps:pe,legend:{domain:y==="Circles"?[...new Set($.map(ie=>ie.magnitude))]:xe,range:y==="Circles"?[5,50]:P,title:B,scaleType:y==="Circles"?"linear":"quantile",type:y},layers:[y]})}),e.jsx(ct,{baseUrl:i,attributionData:Q})]})]})})};Ig.settings={hasControls:!0,name:"ElementEdit"};const d7=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);const n="/",r=s==null?void 0:s.attributionData;return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsxs("div",{className:"h-80vh flex-1 flex flex-col",children:[e.jsx("img",{alt:"Choroplath Map",src:C(s,["img"])}),e.jsx(ct,{baseUrl:n,attributionData:r})]})})},u7={name:"Map: Fusion Events Map",type:"Map",EditComp:Ig,ViewComp:d7},Wi=t=>typeof(t==null?void 0:t.value)=="object"?Wi(t.value):(t==null?void 0:t.value)||t,Tg=({data:t=[],columns:s=[],filterValue:n={},pageSize:r,sortBy:a={},baseUrl:l,attributionData:i,striped:c,fetchData:d})=>{var h,f;const u=s.map(g=>({...g,Cell:x=>{let y=Wi(x.value);return y=["integer","number"].includes(x.column.type)?us(y||0,g.isDollar):y,e.jsx("div",{children:y})}})),p=(h=u.find(g=>{var x;return g.accessor===((x=Object.keys(a))==null?void 0:x[0])}))==null?void 0:h.accessor,m=t.filter(g=>!Object.keys(n||{}).length||Object.keys(n).reduce((x,y)=>{var N;const j=Wi(g[y]);return x&&(j==null?void 0:j.toString().toLowerCase().includes((N=n[y])==null?void 0:N.toLowerCase()))},!0));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-5",children:e.jsx(St,{columns:u,data:m,initialPageSize:r,pageSize:r,striped:c,sortBy:p,sortOrder:((f=Object.values(a))==null?void 0:f[0])||"asc",fetchData:d})}),e.jsx(ct,{baseUrl:l,attributionData:i})]})},m7=({groupBy:t,fn:s,columnsToFetch:n})=>{const r=n.map(a=>a.includes(" AS")?a.split(" AS")[0]:a.split(" as")[0]);return t.length?r.filter(a=>!a.includes("sum(")&&!a.includes("array_to_string")&&!a.includes("count(")).length===t.length:r.filter(a=>a.includes("sum(")||a.includes("array_to_string")||a.includes("count(")).length===0},Jl=t=>{try{return JSON.parse(t)}catch{return{}}},Mg=({value:t,onChange:s})=>{var ae,de,ue,fe,ve,se,me,xe,re;const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",[i,c]=b.useState((a==null?void 0:a.dataSources)||[]),[d,u]=b.useState(a==null?void 0:a.dataSource),[p,m]=b.useState(a==null?void 0:a.version),[h,f]=b.useState(a==null?void 0:a.geoAttribute),[g,x]=b.useState(!0),[y,j]=b.useState(a==null?void 0:a.status),[N,_]=b.useState((a==null?void 0:a.geoid)||"36"),[E,L]=b.useState((a==null?void 0:a.filters)||{}),[S,k]=b.useState((a==null?void 0:a.filterValue)||{}),[$,I]=b.useState((a==null?void 0:a.visibleCols)||[]),[T,A]=b.useState((a==null?void 0:a.pageSize)||5),[R,O]=b.useState((a==null?void 0:a.sortBy)||{}),[M,D]=b.useState((a==null?void 0:a.groupBy)||[]),[P,F]=b.useState((a==null?void 0:a.notNull)||[]),[B,V]=b.useState((a==null?void 0:a.fn)||[]),[G,Z]=b.useState({}),X="Open Fema Data",H=({groupBy:Q,notNull:pe,geoAttribute:ge,geoid:le})=>{var ie;return JSON.stringify({aggregatedLen:!!Q.length,filter:{...ge&&{[`substring(${ge}::text, 1, ${(ie=le==null?void 0:le.toString())==null?void 0:ie.length})`]:[le]}},exclude:{...pe.length&&pe.reduce((be,_e)=>({...be,[_e]:["null"]}),{})},groupBy:Q})},z=Q=>["dama",oe,"viewsbyId",p,"options",Q,"length"],W=Q=>["dama",oe,"viewsbyId",p,"options",Q,"databyIndex"],Y=["dama",oe,"sources","byCategory",X],U=["dama",oe,"views","byId",p,"attributes"],q=["source_id","view_id","version","_modified_timestamp"];b.useEffect(()=>{async function Q(){x(!0),j(void 0),await n.get(Y),c(C(n.getCache(),[...Y,"value"],[])),x(!1)}Q()},[]),b.useEffect(()=>{var ge,le,ie,be,_e,Re;const Q=(((le=(ge=i.find(Pe=>Pe.source_id===d))==null?void 0:ge.metadata)==null?void 0:le.columns)||((ie=i.find(Pe=>Pe.source_id===d))==null?void 0:ie.metadata)||[]).find(Pe=>Pe.display==="geoid-variable"),pe=(be=Q==null?void 0:Q.name)!=null&&be.includes(" AS")?(_e=Q==null?void 0:Q.name)==null?void 0:_e.split(" AS")[0]:(Re=Q==null?void 0:Q.name)==null?void 0:Re.split(" as")[0];pe&&f(pe)},[i,d]),b.useEffect(()=>{async function Q(){if(!($!=null&&$.length)||!p||!d){!d&&j("Please select a Datasource."),!p&&j("Please select a version."),!($!=null&&$.length)&&j("Please select columns."),x(!1);return}if(!m7({groupBy:M,fn:B,columnsToFetch:$.map(ge=>B[ge]?B[ge]:ge)})){j("Please make appropriate grouping selections."),x(!1);return}x(!0),j(void 0),await n.get(z(H({groupBy:M,notNull:P,geoAttribute:h,geoid:N})));const pe=Math.min(C(n.getCache(),z(H({groupBy:M,notNull:P,geoAttribute:h,geoid:N})),0),250);await n.get([...W(H({groupBy:M,notNull:P,geoAttribute:h,geoid:N})),{from:0,to:pe-1},$.map(ge=>B[ge]?B[ge]:ge)]),await n.get([...U,q]),x(!1)}Q()},[d,p,N,$,B,M,P,h]),b.useEffect(()=>{async function Q(){var le,ie,be;const pe=((ie=(le=i.find(_e=>_e.source_id===d))==null?void 0:le.metadata)==null?void 0:ie.columns)||((be=i.find(_e=>_e.source_id===d))==null?void 0:be.metadata)||[],ge=pe==null?void 0:pe.filter(_e=>$.includes(_e.name)&&["meta-variable","geoid-variable"].includes(_e.display)&&_e.meta_lookup);if(ge!=null&&ge.length){const _e=await ge.filter(Re=>{var Pe;return(Pe=Jl(Re.meta_lookup))==null?void 0:Pe.view_id}).reduce(async(Re,Pe)=>{var Ce;const Ge=await Re,Ue=Jl(Pe.meta_lookup),ut=JSON.stringify({aggregatedLen:Ue.aggregatedLen,filter:{...(Ue==null?void 0:Ue.geoAttribute)&&{[`substring(${Ue.geoAttribute}::text, 1, ${(Ce=N==null?void 0:N.toString())==null?void 0:Ce.length})`]:[N]},...(Ue==null?void 0:Ue.filter)||{}}}),at=Ue.attributes,Bt=Ue.keyAttribute,Ut=["dama",oe,"viewsbyId",Ue.view_id,"options",ut,"length"],Wt=await n.get(Ut),Xt=C(Wt,["json",...Ut],0);if(!Xt)return Promise.resolve();const Te=["dama",oe,"viewsbyId",Ue.view_id,"options",ut,"databyIndex"],we=await n.get([...Te,{from:0,to:Xt-1},at]),De=Object.values(C(we,["json",...Te],{})).reduce((Xe,ot)=>({...Xe,[ot[Bt]]:{...at.reduce((Vt,Gt)=>({...Vt,[Gt]:ot[Gt]}),{})}}),{});return{...Ge,[Pe.name]:De}},{});Z(_e)}}Q()},[d,$,N]);const te=((de=(ae=i.find(Q=>Q.source_id===d))==null?void 0:ae.metadata)==null?void 0:de.columns)||((ue=i.find(Q=>Q.source_id===d))==null?void 0:ue.metadata)||[],K=b.useMemo(()=>{const Q=te==null?void 0:te.filter(pe=>$.includes(pe.name)&&["meta-variable","geoid-variable"].includes(pe.display));return Q!=null&&Q.length?Object.values(C(r,W(H({groupBy:M,notNull:P,geoAttribute:h,geoid:N})),{})).map(pe=>(Q.forEach(ge=>{var ie;const le=Jl(ge.meta_lookup);if(le!=null&&le.view_id){const be=G[ge.name]||[];pe[ge.name]=((ie=be[pe[ge.name]])==null?void 0:ie.name)||pe[ge.name]}else pe[ge.name]=le[pe[ge.name]]||pe[ge.name]}),pe)):Object.values(C(r,W(H({groupBy:M,notNull:P,geoAttribute:h,geoid:N})),{}))},[r,G,te,$,M,P,h,N]),ne=C(r,U,{}),J=$.map(Q=>te.find(pe=>pe.name===Q)).filter(Q=>Q).map(Q=>{var pe;return{Header:Q.display_name||Q.name,accessor:B[Q.name]||Q.name,align:Q.align||"right",width:Q.width||"15%",filter:Q.filter||E[Q.name],info:Q.desc,...Q,type:(pe=B[Q.name])!=null&&pe.includes("array_to_string")?"string":Q.type}});return b.useEffect(()=>{g||s(JSON.stringify({attributionData:ne,status:y,geoid:N,pageSize:T,sortBy:R,groupBy:M,fn:B,notNull:P,data:K,columns:J,filters:E,filterValue:S,visibleCols:$,geoAttribute:h,dataSource:d,dataSources:i,version:p}))},[ne,y,N,T,R,M,B,P,K,J,E,S,$,h,d,i,p]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(ze,{label:"Data Source:",types:i.map(Q=>({label:Q.name,value:Q.source_id})),type:d,setType:Q=>{m(void 0),I([]),f(void 0),L([]),D([]),u(Q)}}),e.jsx(Ct,{source_id:d,view_id:p,onChange:m,className:"flex-row-reverse"}),e.jsx(rt,{value:N,onChange:_,className:"flex-row-reverse"}),e.jsx(Ls,{cols:(((ve=(fe=i.find(Q=>Q.source_id===d))==null?void 0:fe.metadata)==null?void 0:ve.columns)||((se=i.find(Q=>Q.source_id===d))==null?void 0:se.metadata)||[]).filter(Q=>["data-variable","meta-variable","geoid-variable"].includes(Q.display)).map(Q=>Q.name),metadata:((xe=(me=i.find(Q=>Q.source_id===d))==null?void 0:me.metadata)==null?void 0:xe.columns)||((re=i.find(Q=>Q.source_id===d))==null?void 0:re.metadata)||[],visibleCols:$,setVisibleCols:I,filters:E,setFilters:L,filterValue:S,setFilterValue:k,pageSize:T,setPageSize:A,groupBy:M,setGroupBy:D,fn:B,setFn:V,sortBy:R,setSortBy:O,notNull:P,setNotNull:F})]}),g?e.jsx(dt,{}):y?e.jsx("div",{className:"p-5 text-center",children:y}):e.jsx(Tg,{geoid:N,data:K,columns:J,filterValue:S,pageSize:T,sortBy:R,attributionData:ne,baseUrl:l})]})})};Mg.settings={hasControls:!0,name:"ElementEdit"};const p7=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(Tg,{...s,baseUrl:"/"})})},h7={name:"Table: Open Fema Data",type:"Table",deprecated:!0,EditComp:Mg,ViewComp:p7},Bg=t=>typeof(t==null?void 0:t.value)=="object"?Bg(t.value):(t==null?void 0:t.value)||t,Ag=({defaultOpen:t=!1,data:s,columns:n,filters:r,setFilters:a,setExtFilterValues:l})=>{const[i,c]=b.useState(t),d=w.useMemo(()=>n.reduce((u,p)=>({...u,[p.accessor]:[...new Set(s.reduce((m,h)=>{var x,y;const f=p.openOut?(y=(x=h.expand)==null?void 0:x.find(j=>j.accessor===p.accessor))==null?void 0:y.originalValue:h[p.accessor];let g=Bg(f);return Array.isArray(g)?[...m,...g]:typeof g=="object"?m:[...m,g]},[]))]}),{}),[n,s]);return n.length?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:`justify-end flex items-center pl-2 ${i?"text-red-300 hover:text-red-500":"text-blue-300 hover:text-blue-600"} transition ease-in`,title:i?"Close Filters":"Open Filters",onClick:u=>c(!i),children:[e.jsx("i",{className:i?"fa fa-close text-lg px-1":"fa fa-gear text-lg px-1"}),e.jsx("label",{className:"text-sm",children:i?"Close Filters":"Open Filters"})]}),e.jsxs("div",{className:i?"w-full flex flex-row flex-wrap bg-white border-2 border-blue-100 px-4 py-2":"hidden",children:[e.jsx("label",{className:"text-xs font-bold",children:"Filter table:"}),n.map(u=>e.jsxs("div",{className:"w-full pt-2 mt-1 flex flex-row text-sm items-top",children:[e.jsx("label",{className:"shrink-0 pr-2 py-2 my-1 w-1/4 font-medium",children:u.display_name||u.Header}),e.jsx("div",{className:"p-2 ml-0 my-1 bg-white rounded-md w-full shrink",children:e.jsx(k0,{className:"flex-row-reverse border-2",value:r[u.accessor],options:d[u.accessor].map(p=>({key:p,label:p})).sort((p,m)=>{var h;return typeof p.label=="string"&&((h=p.label)==null?void 0:h.localeCompare(m.label))}),onChange:p=>{l&&l({...r,[u.accessor]:p.map(m=>m.key)}),a({...r,[u.accessor]:p.map(m=>m.key)})},noLabel:!0})})]},u.name))]})]}):null},Do={abbreviate:(t,s)=>Qe(t,1,s),comma:(t,s)=>us(t,s)},Gi=t=>typeof(t==null?void 0:t.value)=="object"?Gi(t.value):(t==null?void 0:t.value)||t,Og=({data:t=[],columns:s=[],filterValue:n={},extFilterValues:r={},setExtFilterValues:a,pageSize:l,sortBy:i={},baseUrl:c,attributionData:d,striped:u,fetchData:p,extFiltersDefaultOpen:m,hiddenCols:h,showCsvDownload:f})=>{var _,E;const[g,x]=b.useState(r),y=s.filter(L=>!h.includes(L.name)&&!L.openOut).map(L=>({...L,Cell:S=>{var I,T,A;const k=Gi(S.value);let $=S.column.formatFn&&Do[S.column.formatFn]?Do[S.column.formatFn](k,L.isDollar):["integer","number"].includes(S.column.type)?us(k||0,L.isDollar):Array.isArray(k)?k.join(", "):k;return typeof $=="object"?e.jsx("div",{}):(I=L.link)!=null&&I.isLink?e.jsx(je,{to:`${((T=L.link)==null?void 0:T.location)||""}${k}`,children:((A=L.link)==null?void 0:A.linkText)||$}):e.jsx("div",{children:$})}})),j=(_=y.find(L=>{var S;return L.accessor===((S=Object.keys(i))==null?void 0:S[0])}))==null?void 0:_.accessor,N=t.filter(L=>{var S;return!((S=Object.keys(g))!=null&&S.length)||Object.keys(g).filter(k=>g[k].length).reduce((k,$)=>{var R;const T=s.find(O=>O.accessor===$).openOut?(R=L.expand)==null?void 0:R.find(O=>O.accessor===$):L[$],A=Gi(T);return k&&g[$].includes(A)},!0)});return e.jsxs(e.Fragment,{children:[e.jsx(Ag,{defaultOpen:m,columns:s.filter(L=>L.extFilter),data:t,filters:g,setFilters:x,setExtFilterValues:a}),e.jsx("div",{className:"py-1",children:e.jsx(St,{columns:y,data:N,initialPageSize:l,pageSize:l,striped:u,sortBy:j,sortOrder:((E=Object.values(i))==null?void 0:E[0])||"asc",csvDownload:f,fetchData:p})}),e.jsx(ct,{baseUrl:c,attributionData:d})]})},$n=t=>typeof(t==null?void 0:t.value)=="object"?$n(t.value):(t==null?void 0:t.value)||t,f7=(t,s,n)=>{s&&n([])},Pg=(t,s,n)=>{var a;let r=(a=t[0])==null?void 0:a.key;s(t),n&&n(r)},g7=({props:t,selected:s,setSelected:n,onChange:r})=>e.jsxs("div",{className:"w-fit inline-block ml-2",children:[t.label,e.jsx("button",{className:"hover:text-red-300 animate ml-1 p-1 rounded-md rbt-token-remove-button",onClick:a=>{const l=s.filter(i=>i.key!==t.key);Pg(l,n,r)},children:e.jsx("i",{className:"fa fa-close"})})]}),x7=({results:t,menuProps:s,labelKey:n,filter:r,filters:a,setFilter:l,onChange:i,...c})=>e.jsxs(cn,{className:"bg-slate-100 overflow-hidden z-10 rounded-md",...s,children:[e.jsx("div",{className:"flex flex-row flex-wrap items-center justify-start gap-1 p-1 bg-slate-200 text-xs font-bold",children:a.map(({icon:d,label:u,value:p,filterText:m})=>{const h=r===m,f=g=>p?i(p):l(h?null:m);return e.jsxs("button",{title:`Filter by: ${m}`,className:`py-1 px-2 my-0.5 
                                    ${h?"bg-slate-300 hover:bg-blue-300":"bg-slate-100 hover:bg-blue-100"} 
                                     rounded-md`,onClick:f,children:[e.jsx("i",{className:`${d} pr-2 pl-1`}),u]},m)})}),t.map((d,u)=>e.jsx(dn,{className:"block hover:bg-slate-200 text-xl tracking-wide pl-1",option:d,position:u,children:d.label}))]}),nd=({className:t,label:s,value:n,onChange:r,options:a=[],filters:l=[],showAll:i=!1,placeholder:c="Search..."})=>{const[d,u]=b.useState([]),[p,m]=b.useState(""),[h,f]=b.useState(a);return b.useEffect(()=>{if(!n)return;const g=a.filter(x=>x.key===n);u(g)},[n]),b.useEffect(()=>{f(a.filter(g=>{var x;return!p||((x=g==null?void 0:g.label)==null?void 0:x.toLowerCase().includes(p.toLowerCase()))}))},[a,p]),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsxs("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:[s," Version:"]}),e.jsxs("div",{className:`flex flex row ${t} w-3/4 shrink my-1`,children:[e.jsx("i",{className:"fa fa-search font-light text-xl bg-white pr-2 pt-1 rounded-r-md"}),e.jsx(Ko,{className:"w-full",onSearch:f7,minLength:0,id:"search",placeholder:c,options:h,labelKey:g=>`${g==null?void 0:g.label}`,defaultSelected:d,onChange:g=>Pg(g,u,r),selected:d,inputProps:{className:"bg-white w-full p-1 pl-3 rounded-l-md"},renderMenu:(g,x,y)=>x7({results:g,menuProps:x,labelKey:y,filters:l,filter:p,setFilter:m,onChange:r}),renderToken:g=>e.jsx(g7,{props:g,selected:d,setSelected:u,onChange:r})},"search")]})]})},b7=({groupBy:t,fn:s,columnsToFetch:n})=>{const r=n.map(a=>a.includes(" AS")?a.split(" AS")[0]:a.split(" as")[0]);return t.length?r.filter(a=>!a.includes("sum(")&&!a.includes("array_to_string")&&!a.includes("count(")).length===t.length:r.filter(a=>a.includes("sum(")||a.includes("array_to_string")||a.includes("count(")).length===0},oo=t=>{try{return JSON.parse(t)}catch{return{}}},Ga=t=>t.includes(" AS")?t.split(" AS")[0]:t.split(" as")[0];async function y7({dataSources:t,dataSource:s,visibleCols:n,geoid:r,dataPath:a,options:l,groupBy:i,fn:c,notNull:d,geoAttribute:u,disasterNumber:p,disasterNumberCol:m,columns:h},f){var y,j;const g=(j=(y=(t||[]).find(N=>N.source_id===s))==null?void 0:y.metadata)==null?void 0:j.columns,x=g==null?void 0:g.filter(N=>n.includes(N.name)&&["meta-variable","geoid-variable"].includes(N.display)&&N.meta_lookup);if(x!=null&&x.length){const N=f.getCache(),_=Object.values(C(N,a(l({groupBy:i,notNull:d,geoAttribute:u,geoid:r,disasterNumber:p,disasterNumberCol:m})),{}));if(!(_!=null&&_.length))return{};const E=x.reduce((S,k)=>{const $=c[k.name]||k.name,{formatValuesToMap:I="none"}=oo(k.meta_lookup),T={parseInt:A=>parseInt(A),none:A=>A};return{...S,[Ga($)]:[...new Set(_.map(A=>A[$]).filter(A=>!(A.$type==="atom"&&!A.value)).reduce((A,R)=>R!=null&&R.includes(",")?[...A,...R.split(",").map(O=>T[I](O.trim()))]:[...A,T[I](R)],[]))].filter(A=>A)}},{});return await x.filter(S=>{var k;return(k=oo(S.meta_lookup))==null?void 0:k.view_id}).reduce(async(S,k)=>{var Y,U,q;const $=await S,I=c[k.name]||k.name,T=oo(k.meta_lookup),{attributes:A,geoAttribute:R,filterAttribute:O,formatValuesToMap:M,keyAttribute:D,valueAttribute:P,view_id:F,filter:B,aggregatedLen:V}=T,G=JSON.stringify({aggregatedLen:V,filter:{...((Y=E==null?void 0:E[Ga(k.name)])==null?void 0:Y.length)&&{[O||Ga(k.name)]:E==null?void 0:E[Ga(k.name)]},...R&&((U=r==null?void 0:r.toString())==null?void 0:U.length)&&{[`substring(${R}::text, 1, ${(q=r==null?void 0:r.toString())==null?void 0:q.length})`]:[r]},...B||{}}}),Z=["dama",oe,"viewsbyId",F,"options",G,"length"],X=await f.get(Z),H=C(X,["json",...Z],0);if(!H)return Promise.resolve();const z=["dama",oe,"viewsbyId",F,"options",G,"databyIndex"];await f.chunk([...z,{from:0,to:H-1},A]);const W=Object.values(C(f.getCache(),z,{})).reduce((te,K)=>({...te,[K[D]]:{...A.reduce((ne,J)=>({...ne,[J]:K[J]}),{})}}),{});return{...$,[I]:W}},{})}return{}}const Fr=(t,s,n)=>n?`${s} (${t})`:s,v7=({metadata:t,visibleCols:s,dataPath:n,options:r,groupBy:a,fn:l,notNull:i,geoAttribute:c,geoid:d,disasterNumber:u,disasterNumberCol:p,metaLookupByViewId:m,columns:h},f)=>{const g=f.getCache(),x=t==null?void 0:t.filter(y=>s.includes(y.name)&&["meta-variable","geoid-variable"].includes(y.display));return x!=null&&x.length?im(Object.values(C(g,n(r({groupBy:a,notNull:i,geoAttribute:c,geoid:d,disasterNumber:u,disasterNumberCol:p})),{})).map(y=>(x.forEach(j=>{var S;const N=oo(j.meta_lookup),_=l[j.name]||j.name,{keepId:E,valueAttribute:L="name"}=N;if(N!=null&&N.view_id){const k=(m==null?void 0:m[_])||[],$=y[_];typeof $=="string"&&($!=null&&$.includes(","))?y[_]=$.split(",").map(I=>{var T;return Fr(I.trim(),((T=k[I.trim()])==null?void 0:T[L])||I.trim(),E)}).join(", "):y[_]=Fr($,((S=k[$])==null?void 0:S[L])||$,E)}else{const k=y[_];typeof k=="string"&&(k!=null&&k.includes(","))?y[_]=k.split(",").map($=>Fr($.trim(),N[$.trim()]||$.trim(),E)).join(", "):y[_]=Fr(y[_],N[y[_]]||y[_],E)}}),y)),h,l,u,p):im(Object.values(C(g,n(r({groupBy:a,notNull:i,geoAttribute:c,geoid:d,disasterNumber:u,disasterNumberCol:p})),{})),h,l,u,p)},im=(t,s,n,r,a)=>{const l=s.filter(i=>i.openOut);return l!=null&&l.length?t.map(c=>{const d={...c};return d.expand=[],d.expand.push(...l.filter(u=>{var p;return u.name!==a||!r||r&&$n(c[u.accessor])&&((p=$n(c[u.accessor]))==null?void 0:p.includes(r))}).map(u=>{const p=$n(c[u.accessor]);return{key:u.display_name||u.name,accessor:u.accessor,value:Array.isArray(p)?p.join(", "):typeof p=="object"?"":p,originalValue:Array.isArray(p)?p:typeof p=="object"?"":p}})),l.forEach(u=>delete d[u.accessor]),d}).filter(c=>{var d,u;return!r||r&&c[a]&&typeof c[a]!="object"&&((u=(d=c[a])==null?void 0:d.toString())==null?void 0:u.includes(r))}):t.filter(i=>{var c,d;return!r||!i[a]||r&&i[a]&&typeof i[a]!="object"&&((d=(c=i[a])==null?void 0:c.toString())==null?void 0:d.includes(r))})};async function Ji({dataSources:t,dataSource:s,version:n,geoid:r,geoAttribute:a,disasterNumber:l,groupBy:i,fn:c,visibleCols:d,fetchData:u=!0,data:p,columns:m,pageSize:h,sortBy:f,notNull:g,colSizes:x,filters:y,filterValue:j,formatFn:N,hiddenCols:_,showTotal:E,extFilterCols:L,extFilterValues:S,openOutCols:k,colJustify:$,striped:I,extFiltersDefaultOpen:T,customColName:A,linkCols:R,showCsvDownload:O},M){var z,W,Y,U;const D=({groupBy:q,notNull:te,geoAttribute:K,geoid:ne,disasterNumber:J,disasterNumberCol:ae})=>{var de,ue;return JSON.stringify({aggregatedLen:!!(q!=null&&q.length),filter:{...K&&((de=ne==null?void 0:ne.toString())==null?void 0:de.length)&&{[`substring(${K}::text, 1, ${(ue=ne==null?void 0:ne.toString())==null?void 0:ue.length})`]:[ne]},...J&&ae&&{[Ga(ae)]:[J]}},exclude:{...(te==null?void 0:te.length)&&te.reduce((fe,ve)=>({...fe,[ve]:["null"]}),{})},groupBy:q})},P=q=>["dama",oe,"viewsbyId",n,"options",q,"length"],F=q=>["dama",oe,"viewsbyId",n,"options",q,"databyIndex"],B=["dama",oe,"views","byId",n,"attributes"],V=["source_id","view_id","version","_modified_timestamp"],G=((W=(z=(t||[]).find(q=>q.source_id===s))==null?void 0:z.metadata)==null?void 0:W.columns)||((Y=(t||[]).find(q=>q.source_id===s))==null?void 0:Y.metadata)||[];let Z,X;if(u){X=(d||[]).map(J=>G.find(ae=>ae.name===J)).filter(J=>J).map(J=>{var ae,de;return{Header:(A==null?void 0:A[J.name])||(J==null?void 0:J.display_name)||(J==null?void 0:J.name),accessor:(c==null?void 0:c[J==null?void 0:J.name])||(J==null?void 0:J.name),align:($==null?void 0:$[J==null?void 0:J.name])||(J==null?void 0:J.align)||rr(J==null?void 0:J.type),width:(x==null?void 0:x[J.name])||"15%",minWidth:(x==null?void 0:x[J.name])||"15%",maxWidth:(x==null?void 0:x[J.name])||"15%",filter:(J==null?void 0:J.filter)||(y==null?void 0:y[J==null?void 0:J.name]),formatFn:N==null?void 0:N[J==null?void 0:J.name],extFilter:L==null?void 0:L.includes((c==null?void 0:c[J==null?void 0:J.name])||(J==null?void 0:J.name)),info:J.desc,openOut:(ae=k||[])==null?void 0:ae.includes(J==null?void 0:J.name),link:R==null?void 0:R[J==null?void 0:J.name],...J,type:(de=c==null?void 0:c[J==null?void 0:J.name])!=null&&de.includes("array_to_string")?"string":J==null?void 0:J.type}});const q=((U=X.find(J=>{var ae,de;return((ae=J.name)==null?void 0:ae.includes("disaster_number"))&&!((de=J.name)!=null&&de.toLowerCase().includes("case"))}))==null?void 0:U.name)||"disaster_number",te=(c==null?void 0:c[q])||q;console.time(`getData falcor calls ${n}`),await M.get(P(D({groupBy:i,notNull:g,geoAttribute:a,geoid:r,disasterNumber:l,disasterNumberCol:te})));const K=Math.min(C(M.getCache(),P(D({groupBy:i,notNull:g,geoAttribute:a,geoid:r,disasterNumber:l,disasterNumberCol:te})),0),100);await M.get([...F(D({groupBy:i,notNull:g,geoAttribute:a,geoid:r,disasterNumber:l,disasterNumberCol:te})),{from:0,to:K-1},(d||[]).map(J=>c[J]?c[J]:J)]),await M.get([...B,V]);const ne=await y7({dataSources:t,dataSource:s,visibleCols:d,geoid:r,dataPath:F,options:D,groupBy:i,fn:c,notNull:g,geoAttribute:a,disasterNumber:l,disasterNumberCol:te,columns:X},M);Z=v7({metadata:G,visibleCols:d,dataPath:F,options:D,groupBy:i,fn:c,notNull:g,geoAttribute:a,geoid:r,disasterNumber:l,disasterNumberCol:te,metaLookupByViewId:ne,columns:X},M),Z=(Z||p).filter(J=>J.totalRow||!Object.keys(j||{}).length||Object.keys(j).reduce((ae,de)=>{var fe;const ue=$n(J[de]);return ae&&(ue==null?void 0:ue.toString().toLowerCase().includes((fe=j[de])==null?void 0:fe.toLowerCase()))},!0)),pl({showTotal:E,data:Z,columns:X,filterValue:j,setLoading:()=>{}})}else X=d.map(q=>G.find(te=>te.name===q)).filter(q=>q).map(q=>{var te,K;return{Header:(A==null?void 0:A[q.name])||(q==null?void 0:q.display_name)||(q==null?void 0:q.name),accessor:(c==null?void 0:c[q==null?void 0:q.name])||(q==null?void 0:q.name),align:($==null?void 0:$[q==null?void 0:q.name])||(q==null?void 0:q.align)||rr(q==null?void 0:q.type),width:(x==null?void 0:x[q.name])||"15%",minWidth:(x==null?void 0:x[q.name])||"15%",maxWidth:(x==null?void 0:x[q.name])||"15%",filter:(q==null?void 0:q.filter)||(y==null?void 0:y[q==null?void 0:q.name]),formatFn:N==null?void 0:N[q==null?void 0:q.name],extFilter:L==null?void 0:L.includes((c==null?void 0:c[q==null?void 0:q.name])||(q==null?void 0:q.name)),info:q.desc,openOut:(te=k||[])==null?void 0:te.includes(q==null?void 0:q.name),link:R==null?void 0:R[q==null?void 0:q.name],...q,type:(K=c==null?void 0:c[q==null?void 0:q.name])!=null&&K.includes("array_to_string")?"string":q==null?void 0:q.type}});const H=C(M.getCache(),B,{});return{data:u?Z:p,columns:X||m,attributionData:H,geoid:r,disasterNumber:l,geoAttribute:a,pageSize:h,sortBy:f,groupBy:i,fn:c,notNull:g,showTotal:E,colSizes:x,filters:y,filterValue:j,formatFn:N,visibleCols:d,hiddenCols:_,dataSource:s,dataSources:t,version:n,extFilterCols:L,extFilterValues:S,colJustify:$,striped:I,extFiltersDefaultOpen:T,customColName:A,linkCols:R,openOutCols:k,showCsvDownload:O}}const Dg=({value:t,onChange:s})=>{var ut,at,Bt,Ut,Wt,Xt;const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",[i,c]=b.useState((a==null?void 0:a.dataSources)||[]),[d,u]=b.useState(a==null?void 0:a.dataSource),[p,m]=b.useState(a==null?void 0:a.version),[h,f]=b.useState(a==null?void 0:a.geoAttribute),[g,x]=b.useState(!0),[y,j]=b.useState(a==null?void 0:a.status),[N,_]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[E,L]=b.useState(a==null?void 0:a.disasterNumber),[S,k]=b.useState((a==null?void 0:a.filters)||{}),[$,I]=b.useState((a==null?void 0:a.filterValue)||{}),[T,A]=b.useState((a==null?void 0:a.formatFn)||{}),[R,O]=b.useState((a==null?void 0:a.visibleCols)||[]),[M,D]=b.useState((a==null?void 0:a.pageSize)||5),[P,F]=b.useState((a==null?void 0:a.sortBy)||{}),[B,V]=b.useState((a==null?void 0:a.groupBy)||[]),[G,Z]=b.useState((a==null?void 0:a.notNull)||[]),[X,H]=b.useState((a==null?void 0:a.showTotal)||[]),[z,W]=b.useState((a==null?void 0:a.fn)||[]),[Y,U]=b.useState((a==null?void 0:a.hiddenCols)||[]),[q,te]=b.useState((a==null?void 0:a.colSizes)||{}),[K,ne]=b.useState((a==null?void 0:a.extFilterCols)||[]),[J,ae]=b.useState((a==null?void 0:a.extFilterValues)||{}),[de,ue]=b.useState((a==null?void 0:a.openOutCols)||[]),[fe,ve]=b.useState((a==null?void 0:a.colJustify)||{}),[se,me]=b.useState((a==null?void 0:a.striped)||!1),[xe,re]=b.useState((a==null?void 0:a.extFiltersDefaultOpen)||!1),[Q,pe]=b.useState((a==null?void 0:a.customColName)||{}),[ge,le]=b.useState((a==null?void 0:a.linkCols)||{}),[ie,be]=b.useState((a==null?void 0:a.showCsvDownload)||!1),Re=["dama",oe,"sources","byCategory","Cenrep"];b.useEffect(()=>{async function Te(){x(!0),j(void 0),await n.get(Re),c(C(n.getCache(),[...Re,"value"],[])),x(!1)}Te()},[]),b.useEffect(()=>{var De,Ce,Xe;const Te=(Xe=(((Ce=(De=i.find(ot=>ot.source_id===d))==null?void 0:De.metadata)==null?void 0:Ce.columns)||[]).find(ot=>ot.display==="geoid-variable"))==null?void 0:Xe.name,we=Te!=null&&Te.includes(" AS")?Te.split(" AS")[0]:Te!=null&&Te.includes(" as")?Te.split(" as")[0]:Te;we&&f(we)},[d]),b.useEffect(()=>{async function Te(){if(i&&(!(R!=null&&R.length)||!p||!d)){!d&&j("Please select a Datasource."),!p&&j("Please select a version."),!(R!=null&&R.length)&&j("Please select columns."),x(!1);return}if(!b7({groupBy:B,fn:z,columnsToFetch:R.map(De=>z[De]?z[De]:De)})){j("Please make appropriate grouping selections."),x(!1);return}x(!0),j(void 0);const we=await Ji({dataSources:i,dataSource:d,geoAttribute:h,geoid:N,disasterNumber:E,pageSize:M,sortBy:P,groupBy:B,fn:z,notNull:G,showTotal:X,colSizes:q,filters:S,filterValue:$,formatFn:T,visibleCols:R,hiddenCols:Y,version:p,extFilterCols:K,extFilterValues:J,openOutCols:de,colJustify:fe,striped:se,extFiltersDefaultOpen:xe,customColName:Q,linkCols:ge,fetchData:!0},n);s(JSON.stringify({...we})),x(!1)}Te()},[d,N,E,h,B,z,G,X,$,T,R,p]),b.useEffect(()=>{async function Te(){x(!0),j(void 0);const we=await Ji({dataSources:i,dataSource:d,geoAttribute:h,geoid:N,disasterNumber:E,pageSize:M,sortBy:P,groupBy:B,fn:z,notNull:G,showTotal:X,colSizes:q,filters:S,filterValue:$,formatFn:T,visibleCols:R,hiddenCols:Y,version:p,extFilterCols:K,extFilterValues:J,openOutCols:de,colJustify:fe,striped:se,extFiltersDefaultOpen:xe,customColName:Q,linkCols:ge,data:Pe,columns:Ue,showCsvDownload:ie,fetchData:!1},n);s(JSON.stringify({...we})),x(!1)}Te()},[M,P,G,q,S,$,Y,X,T,K,J,de,fe,se,xe,Q,ge,ie]);const Pe=a.data,Ge=a.attributionData,Ue=a.columns;return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(nd,{className:"flex-row-reverse p-0",label:"Data Source:",options:i.map(Te=>({label:Te.name,key:Te.source_id})).sort((Te,we)=>Te.label.localeCompare(we.label)),value:d,onChange:Te=>{O([]),f(void 0),ne([]),u(+Te)},placeholder:"Please select a data source"}),e.jsx(Ct,{source_id:d,view_id:p,onChange:m,className:"flex-row-reverse"}),e.jsx(rt,{value:N,onChange:_,className:"flex-row-reverse"}),(((at=(ut=i.find(Te=>Te.source_id===d))==null?void 0:ut.metadata)==null?void 0:at.columns)||[]).find(Te=>Te.name.includes("disaster_number")&&!Te.name.toLowerCase().includes("case"))?e.jsx(Jn,{view_id:837,value:E,geoid:N,onChange:L,className:"flex-row-reverse"}):null,e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsx("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:" Striped: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:se,onChange:Te=>me(!se),className:`
                                    ${se?"bg-indigo-600":"bg-gray-200"}
                                    relative inline-flex 
                                     h-4 w-10 shrink
                                     cursor-pointer rounded-full border-2 border-transparent 
                                     transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                                     focus:ring-indigo-600 focus:ring-offset-2`,children:[e.jsx("span",{className:"sr-only",children:"toggle striped table by"}),e.jsx("span",{"aria-hidden":"true",className:`
                                        ${se?"translate-x-5":"translate-x-0"}
                                        pointer-events-none inline-block 
                                        h-3 w-4
                                        transform rounded-full bg-white shadow ring-0 t
                                        transition duration-200 ease-in-out`})]},"striped-table")})]}),e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsx("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:" External filters default open: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:xe,onChange:Te=>re(!xe),className:`
                                ${xe?"bg-indigo-600":"bg-gray-200"}
                                relative inline-flex 
                                 h-4 w-10 shrink
                                 cursor-pointer rounded-full border-2 border-transparent 
                                 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                                 focus:ring-indigo-600 focus:ring-offset-2`,children:[e.jsx("span",{className:"sr-only",children:"toggle External filters default open by"}),e.jsx("span",{"aria-hidden":"true",className:`
                                    ${xe?"translate-x-5":"translate-x-0"}
                                    pointer-events-none inline-block 
                                    h-3 w-4
                                    transform rounded-full bg-white shadow ring-0 t
                                    transition duration-200 ease-in-out`})]},"striped-table")})]}),e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsx("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:" Show CSV Download: "}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:ie,onChange:Te=>be(!ie),className:`
                                ${ie?"bg-indigo-600":"bg-gray-200"}
                                relative inline-flex 
                                 h-4 w-10 shrink
                                 cursor-pointer rounded-full border-2 border-transparent 
                                 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                                 focus:ring-indigo-600 focus:ring-offset-2`,children:[e.jsx("span",{className:"sr-only",children:"toggle External filters default open by"}),e.jsx("span",{"aria-hidden":"true",className:`
                                    ${ie?"translate-x-5":"translate-x-0"}
                                    pointer-events-none inline-block 
                                    h-3 w-4
                                    transform rounded-full bg-white shadow ring-0 t
                                    transition duration-200 ease-in-out`})]},"striped-table")})]}),e.jsx(Ls,{cols:(((Ut=(Bt=i.find(Te=>Te.source_id===d))==null?void 0:Bt.metadata)==null?void 0:Ut.columns)||[]).filter(Te=>["data-variable","meta-variable","geoid-variable"].includes(Te.display)).map(Te=>Te.name),metadata:((Xt=(Wt=i.find(Te=>Te.source_id===d))==null?void 0:Wt.metadata)==null?void 0:Xt.columns)||[],visibleCols:R,setVisibleCols:O,hiddenCols:Y,setHiddenCols:U,filters:S,setFilters:k,filterValue:$,setFilterValue:I,formatFn:T,setFormatFn:A,pageSize:M,setPageSize:D,groupBy:B,setGroupBy:V,fn:z,setFn:W,sortBy:P,setSortBy:F,notNull:G,setNotNull:Z,showTotal:X,setShowTotal:H,colSizes:q,setColSizes:te,extFilterCols:K,setExtFilterCols:ne,openOutCols:de,setOpenOutCols:ue,colJustify:fe,setColJustify:ve,customColName:Q,setCustomColName:pe,linkCols:ge,setLinkCols:le})]}),g?e.jsx(dt,{}):y?e.jsx("div",{className:"p-5 text-center",children:y}):e.jsx(Og,{geoid:N,data:Pe,columns:Ue,hiddenCols:Y,filterValue:$,extFilterValues:J,setExtFilterValues:ae,extFiltersDefaultOpen:xe,pageSize:M,sortBy:P,attributionData:Ge,striped:se,showCsvDownload:ie,baseUrl:l})]})})};Dg.settings={hasControls:!0,name:"ElementEdit"};const j7=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(Og,{...s,baseUrl:"/"})})},w7={name:"Table: Cenrep",type:"Table",variables:[{name:"dataSources",hidden:!0},{name:"dataSource",hidden:!0},{name:"version",hidden:!0},{name:"geoAttribute",hidden:!0},{name:"geoid",default:"36"},{name:"disasterNumber",default:null},{name:"pageSize",hidden:!0},{name:"sortBy",hidden:!0},{name:"groupBy",hidden:!0},{name:"fn",hidden:!0},{name:"notNull",hidden:!0},{name:"showTotal",hidden:!0},{name:"colSizes",hidden:!0},{name:"filters",hidden:!0},{name:"filterValue",hidden:!0},{name:"formatFn",hidden:!0},{name:"visibleCols",hidden:!0},{name:"hiddenCols",hidden:!0},{name:"extFilterCols",hidden:!0,default:[]},{name:"colJustify",hidden:!0,default:{}},{name:"striped",hidden:!0,default:!1},{name:"extFiltersDefaultOpen",hidden:!0,default:!1},{name:"customColName",hidden:!0,default:{}},{name:"linkCols",hidden:!0,default:{}},{name:"openOutCols",hidden:!0,default:[]},{name:"extFilterValues",hidden:!0,default:{}},{name:"showCsvDownload",hidden:!0,default:!1}],getData:Ji,EditComp:Dg,ViewComp:j7},N7=[{name:"dataSources",hidden:!0},{name:"dataSource",hidden:!0},{name:"version",hidden:!0},{name:"geoAttribute",hidden:!0},{name:"pageSize",hidden:!0},{name:"dataSize",hidden:!0,default:100},{name:"sortBy",hidden:!0},{name:"groupBy",hidden:!0},{name:"fn",hidden:!0},{name:"notNull",hidden:!0},{name:"showTotal",hidden:!0},{name:"colSizes",hidden:!0},{name:"filters",hidden:!0},{name:"filterValue",hidden:!0},{name:"formatFn",hidden:!0},{name:"visibleCols",hidden:!0},{name:"hiddenCols",hidden:!0},{name:"extFilterCols",hidden:!0,default:[]},{name:"colJustify",hidden:!0,default:{}},{name:"striped",hidden:!0,default:!1},{name:"extFiltersDefaultOpen",hidden:!0,default:!1},{name:"customColName",hidden:!0,default:{}},{name:"linkCols",hidden:!0,default:{}},{name:"openOutCols",hidden:!0,default:[]},{name:"extFilterValues",hidden:!0,default:{}},{name:"showCsvDownload",hidden:!0,default:!1},{name:"additionalVariables",hidden:!0,default:[]}],cm=t=>t.includes(" AS")?t.split(" AS")[0]:t.split(" as")[0],C7=(t,s,n)=>{const r=s.filter(a=>a.openOut);return r!=null&&r.length?t.map(l=>{const i={...l};return i.expand=[],i.expand.push(...r.map(c=>{const d=$n(l[c.accessor]);return{key:c.Header||c.display_name||c.name,accessor:c.accessor,value:Array.isArray(d)?d.join(", "):typeof d=="object"?"":d,originalValue:Array.isArray(d)?d:typeof d=="object"?"":d}})),r.forEach(c=>delete i[c.accessor]),i}):t};async function qi({dataSources:t,dataSource:s,version:n,geoAttribute:r,groupBy:a,fn:l,visibleCols:i,fetchData:c=!0,data:d,columns:u,pageSize:p,dataSize:m,sortBy:h,notNull:f,colSizes:g,filters:x,filterValue:y,formatFn:j,hiddenCols:N,showTotal:_,extFilterCols:E,extFilterValues:L,openOutCols:S,colJustify:k,striped:$,extFiltersDefaultOpen:I,customColName:T,linkCols:A,showCsvDownload:R,additionalVariables:O=[]},M){var U,q,te;console.log("additional variables",O);const D=O.filter(K=>K.action==="include").reduce((K,ne)=>({...K,[cm(ne.name)]:K[ne.name]?[...K[ne.name],ne.defaultValue]:[ne.defaultValue]}),{}),P=O.filter(K=>K.action==="exclude").reduce((K,ne)=>({...K,[cm(ne.name)]:K[ne.name]?[...K[ne.name],ne.defaultValue]:[ne.defaultValue]}),{}),F=((q=(U=(t||[]).find(K=>K.source_id===s))==null?void 0:U.metadata)==null?void 0:q.columns)||((te=(t||[]).find(K=>K.source_id===s))==null?void 0:te.metadata)||[],B=F==null?void 0:F.filter(K=>i.includes(K.name)&&["meta-variable","geoid-variable"].includes(K.display)&&K.meta_lookup).reduce((K,{name:ne,meta_lookup:J})=>(K[ne]=J,K),{}),V=({groupBy:K,notNull:ne,sortBy:J})=>JSON.stringify({aggregatedLen:!!(K!=null&&K.length),filter:{...D},exclude:{...(ne==null?void 0:ne.length)&&ne.reduce((ae,de)=>({...ae,[de]:["null"]}),{}),...P},groupBy:K,orderBy:J,meta:B}),G=K=>["dama",oe,"viewsbyId",n,"options",K,"length"],Z=K=>["dama",oe,"viewsbyId",n,"options",K,"databyIndex"],X=["dama",oe,"views","byId",n,"attributes"],H=["source_id","view_id","version","_modified_timestamp"];let z,W;if(c){W=(i||[]).map(J=>F.find(ae=>ae.name===J)).filter(J=>J).map(J=>{var ae,de;return{Header:(T==null?void 0:T[J.name])||(J==null?void 0:J.display_name)||(J==null?void 0:J.name),accessor:(l==null?void 0:l[J==null?void 0:J.name])||(J==null?void 0:J.name),align:(k==null?void 0:k[J==null?void 0:J.name])||(J==null?void 0:J.align)||rr(J==null?void 0:J.type),width:(g==null?void 0:g[J.name])||"15%",minWidth:(g==null?void 0:g[J.name])||"15%",maxWidth:(g==null?void 0:g[J.name])||"15%",filter:(J==null?void 0:J.filter)||(x==null?void 0:x[J==null?void 0:J.name]),formatFn:j==null?void 0:j[J==null?void 0:J.name],extFilter:E==null?void 0:E.includes((l==null?void 0:l[J==null?void 0:J.name])||(J==null?void 0:J.name)),info:J.desc,openOut:(ae=S||[])==null?void 0:ae.includes((l==null?void 0:l[J==null?void 0:J.name])||(J==null?void 0:J.name)),link:A==null?void 0:A[J==null?void 0:J.name],...J,type:(de=l==null?void 0:l[J==null?void 0:J.name])!=null&&de.includes("array_to_string")?"string":J==null?void 0:J.type}}),console.time(`getData falcor calls ${n}`),await M.get(G(V({groupBy:a,notNull:f,sortBy:h})));const K=Math.min(C(M.getCache(),G(V({groupBy:a,notNull:f,sortBy:h})),0),m);await M.get([...Z(V({groupBy:a,notNull:f,sortBy:h})),{from:0,to:K-1},(i||[]).map(J=>l[J]?l[J]:J)]),await M.get([...X,H]);const ne=C7(Object.values(C(M.getCache(),Z(V({groupBy:a,notNull:f,sortBy:h})),{})),W||u);z=(z||ne||d||[]).filter(J=>J.totalRow||!Object.keys(y||{}).length||Object.keys(y).reduce((ae,de)=>{var fe;const ue=$n(J[de]);return ae&&(ue==null?void 0:ue.toString().toLowerCase().includes((fe=y[de])==null?void 0:fe.toLowerCase()))},!0)),pl({showTotal:_,data:z,columns:W,filterValue:y,setLoading:()=>{}})}else W=i.map(K=>F.find(ne=>ne.name===K)).filter(K=>K).map(K=>{var ne,J;return{Header:(T==null?void 0:T[K.name])||(K==null?void 0:K.display_name)||(K==null?void 0:K.name),accessor:(l==null?void 0:l[K==null?void 0:K.name])||(K==null?void 0:K.name),align:(k==null?void 0:k[K==null?void 0:K.name])||(K==null?void 0:K.align)||rr(K==null?void 0:K.type),width:(g==null?void 0:g[K.name])||"15%",minWidth:(g==null?void 0:g[K.name])||"15%",maxWidth:(g==null?void 0:g[K.name])||"15%",filter:(K==null?void 0:K.filter)||(x==null?void 0:x[K==null?void 0:K.name]),formatFn:j==null?void 0:j[K==null?void 0:K.name],extFilter:E==null?void 0:E.includes((l==null?void 0:l[K==null?void 0:K.name])||(K==null?void 0:K.name)),info:K.desc,openOut:(ne=S||[])==null?void 0:ne.includes((l==null?void 0:l[K==null?void 0:K.name])||(K==null?void 0:K.name)),link:A==null?void 0:A[K==null?void 0:K.name],...K,type:(J=l==null?void 0:l[K==null?void 0:K.name])!=null&&J.includes("array_to_string")?"string":K==null?void 0:K.type}});const Y=C(M.getCache(),X,{});return{data:c?z:d,columns:W||u,attributionData:Y,geoAttribute:r,pageSize:p,dataSize:m,sortBy:h,groupBy:a,fn:l,notNull:f,showTotal:_,colSizes:g,filters:x,filterValue:y,formatFn:j,visibleCols:i,hiddenCols:N,dataSource:s,dataSources:t,version:n,extFilterCols:E,extFilterValues:L,colJustify:k,striped:$,extFiltersDefaultOpen:I,customColName:T,linkCols:A,openOutCols:S,showCsvDownload:R,additionalVariables:O}}const lo=t=>t.includes(" AS")?t.split(" AS")[0]:t.split(" as")[0],_7=t=>{try{return JSON.parse(t)}catch{return{}}},S7=async({column:t,meta:s,values:n,pgEnv:r,falcor:a})=>{var k;const l=_7(s),{attributes:i,geoAttribute:c,filterAttribute:d,formatValuesToMap:u,keyAttribute:p,valueAttribute:m="name",keepId:h=!0,view_id:f,filter:g,aggregatedLen:x}=l;if(!f)return{};const y=JSON.stringify({aggregatedLen:x,filter:{...((k=n==null?void 0:n[lo(t.name)])==null?void 0:k.length)&&{[d||lo(t.name)]:n==null?void 0:n[lo(t.name)]},...g||{}}}),j=["dama",r,"viewsbyId",f,"options",y,"length"],N=await a.get(j),_=C(N,["json",...j],0);if(!_)return{};const E=["dama",r,"viewsbyId",f,"options",y,"databyIndex"];await a.chunk([...E,{from:0,to:_-1},i]);const L=Object.values(C(a.getCache(),E,{})),S=L.reduce(($,I)=>($[I[p]]=h?`${I[m]} (${I[p]})`:I[m],$),{});return console.log("returning meta",L,S),S},$7=async({falcor:t,filter:s,pgEnv:n,version:r,setFilterData:a,metadata:l,setIsLoadingData:i})=>{var y;if(!s.name)return;i(!0);const c=JSON.stringify({aggregatedLen:!0,groupBy:[lo(s.name)]}),d=["dama",n,"viewsbyId",r,"options",c,"length"],u=["dama",n,"viewsbyId",r,"options",c,"databyIndex"],p=[s.name];await t.get(d);const m=C(t.getCache(),d,0);if(!m)return Promise.resolve();await t.chunk([...u,{from:0,to:m-1},p]);const h=Object.values(C(t.getCache(),u,{})).map(j=>j[s.name]).sort((j,N)=>typeof j=="string"?j.localeCompare(N):j-N),f=(y=l.find(j=>j.name===s.name))==null?void 0:y.meta_lookup,g=await S7({column:s,meta:f,values:h,pgEnv:n,falcor:t}),x=h.map(j=>({value:j,label:(g==null?void 0:g[j])||j}));a(x),i(!1)},E7=({filters:t,setFilters:s,columns:n,metadata:r,falcor:a,pgEnv:l,version:i})=>{const[c,d]=b.useState(!1),[u,p]=b.useState(!0),[m,h]=b.useState({name:"",type:"simple",action:"include",defaultValue:""}),[f,g]=b.useState([]),[x,y]=b.useState(!1);return b.useEffect(()=>{$7({falcor:a,filter:m,pgEnv:l,version:i,setFilterData:g,metadata:r,setIsLoadingData:y})},[m]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsxs("div",{className:"w-full flex flex-col sm:flex-row justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Filters: "}),e.jsx("button",{className:`rounded-md shrink-0
                    ${c?"bg-green-600 hover:bg-green-500":"bg-blue-600 hover:bg-blue-500"} 
                    text-white text-xs p-1.5 h-fit transition ease-in-out`,onClick:()=>{p(!u),setTimeout(()=>d(!c),10)},children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-check"})," Done"]}):"+ Add filters"})]}),e.jsxs("div",{className:`flex 
                    ${u?"hidden":"block"} 
                    ${c?"opacity-100":"opacity-0"} 
                    transition-opacity ease-in-out delay-150 duration-300 w-full mt-2`,children:[e.jsxs("select",{className:"appearance-auto align-bottom shrink-0 p-2 my-1 w-1/4 bg-white rounded-md",value:m.name,onChange:j=>{var N;return h({name:j.target.value,type:"simple",action:"include",defaultValue:"",displayName:((N=n.find(_=>_.name===j.target.value))==null?void 0:N.display_name)||j.target.value})},children:[e.jsx("option",{defaultValue:void 0,children:"Please select column"},0),n.map((j,N)=>e.jsx("option",{value:j.name,children:j.display_name||j.name},N))]}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("select",{className:"appearance-auto align-bottom shrink-0 p-1 my-1 bg-white rounded-md mx-1",value:m.action,onChange:j=>h({...m,action:j.target.value}),children:[{label:"Include",value:"include"},{label:"Exclude",value:"exclude"}].map((j,N)=>e.jsx("option",{value:j.value,children:j.label},N))}),e.jsxs("select",{className:"appearance-auto w-1/2 align-bottom shrink-0 p-2 my-1 bg-white rounded-md mx-1",value:m.defaultValue,onChange:j=>h({...m,defaultValue:j.target.value}),children:[e.jsx("option",{defaultValue:void 0,children:x?"Loading...":"Please select"},0),f.map((j,N)=>e.jsx("option",{value:j.value||j,children:typeof(j.label||j)=="string"?j.label||j:JSON.stringify(j.label||j)},N))]}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-500 text-white text-xs rounded-md p-1.5 my-1 transition ease-in-out",onClick:()=>{s([...t,m])},children:"Add"})]})]})]}),e.jsxs("div",{className:"w-full flex flex-col sm:flex-row items-center border-y hover:bg-blue-100 rounded-md",children:[e.jsx("div",{className:"shrink-0 p-2 my-1 w-full sm:w-1/4",children:"Column"}),e.jsxs("div",{className:"flex w-full justify-between pr-2",children:[e.jsx("div",{className:"shrink-0 p-2 my-1",children:"Action"}),e.jsx("div",{className:"shrink-0 p-2 my-1",children:"Value"}),e.jsx("div",{})]})]}),t.map(j=>{var N;return e.jsxs("div",{className:"w-full flex flex-col sm:flex-row items-center border-y hover:bg-blue-100 rounded-md",children:[e.jsx("div",{className:"shrink-0 p-2 my-1 w-full sm:w-1/4",children:j.displayName||j.name}),e.jsxs("div",{className:"flex w-full justify-between pr-2",children:[e.jsx("div",{className:"shrink-0 p-2 my-1",children:j.action}),e.jsx("div",{className:"shrink-0 p-2 my-1",children:((N=f.find(_=>_.value===j.defaultValue))==null?void 0:N.label)||j.defaultValue}),e.jsx("button",{className:"h-fit rounded-md p-1 my-1",onClick:()=>{s(t.filter(_=>!(_.name===j.name&&_.defaultValue===j.defaultValue&&_.action===j.action)))},children:e.jsx("i",{className:"fa fa-trash text-red-300 hover:text-red-500 transition ease-in-out"})})]})]},j.name)})]})},ql=({label:t,value:s,setValue:n})=>e.jsxs("div",{className:"block w-full flex mt-1",children:[e.jsxs("label",{className:"align-bottom shrink-0pr-2 py-2 my-1 w-1/4",children:[" ",t,": "]}),e.jsx("div",{className:"align-bottom p-2 pl-0 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:s,onChange:r=>n(!s),className:`
                                    ${s?"bg-indigo-600":"bg-gray-200"}
                                    relative inline-flex 
                                     h-4 w-10 shrink
                                     cursor-pointer rounded-full border-2 border-transparent 
                                     transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                                     focus:ring-indigo-600 focus:ring-offset-2`,children:[e.jsxs("span",{className:"sr-only",children:["toggle ",t]}),e.jsx("span",{"aria-hidden":"true",className:`
                                        ${s?"translate-x-5":"translate-x-0"}
                                        pointer-events-none inline-block 
                                        h-3 w-4
                                        transform rounded-full bg-white shadow ring-0 t
                                        transition duration-200 ease-in-out`})]},t)})]}),Ki=t=>typeof(t==null?void 0:t.value)=="object"?Ki(t.value):(t==null?void 0:t.value)||t,k7=t=>{var s,n,r,a;return(a=(r=(n=(s=t==null?void 0:t.toString())==null?void 0:s.toLowerCase())==null?void 0:n.replace(" (county)",""))==null?void 0:r.replace(".",""))==null?void 0:a.replace(/ /g,"_")},Rg=({data:t=[],columns:s=[],filterValue:n={},extFilterValues:r={},setExtFilterValues:a,pageSize:l,sortBy:i={},baseUrl:c,attributionData:d,striped:u,fetchData:p,extFiltersDefaultOpen:m,hiddenCols:h,showCsvDownload:f})=>{var N,_;const[g,x]=b.useState(r),y=s.filter(E=>!h.includes(E.name)&&!E.openOut).map(E=>({...E,Cell:L=>{var I,T,A;const S=Ki(L.value),k=L.column.name==="geoid"?k7(S):S;let $=L.column.formatFn&&Do[L.column.formatFn]?Do[L.column.formatFn](S,E.isDollar):Array.isArray(S)?S.join(", "):S;return typeof $=="object"?e.jsx("div",{}):(I=E.link)!=null&&I.isLink?e.jsx(je,{to:`${((T=E.link)==null?void 0:T.location)||""}${k}`,children:((A=E.link)==null?void 0:A.linkText)||$}):e.jsx("div",{children:$})}}));(N=y.find(E=>{var L;return E.accessor===((L=Object.keys(i))==null?void 0:L[0])}))==null||N.accessor;const j=t.filter(E=>{var L;return!((L=Object.keys(g))!=null&&L.length)||Object.keys(g).filter(S=>g[S].length).reduce((S,k)=>{var A;const I=s.find(R=>R.accessor===k).openOut?(A=E.expand)==null?void 0:A.find(R=>R.accessor===k):E[k],T=Ki(I);return S&&g[k].includes(T)},!0)});return e.jsxs(e.Fragment,{children:[e.jsx(Ag,{defaultOpen:m,columns:s.filter(E=>E.extFilter),data:t,filters:g,setFilters:x,setExtFilterValues:a}),e.jsx("div",{className:"py-1",children:e.jsx(St,{columns:y,data:j,initialPageSize:l,pageSize:l,striped:u,sortBy:Object.keys(i)[0],sortOrder:((_=Object.values(i))==null?void 0:_[0])||"asc",csvDownload:f,fetchData:p})}),e.jsx(ct,{baseUrl:c,attributionData:d})]})},L7=({groupBy:t,fn:s,columnsToFetch:n})=>{const r=n.map(a=>a.includes(" AS")?a.split(" AS")[0]:a.split(" as")[0]);return t.length?r.filter(a=>!a.includes("sum(")&&!a.includes("array_to_string")&&!a.includes("count(")).length===t.length:r.filter(a=>a.includes("sum(")||a.includes("array_to_string")||a.includes("count(")).length===0},Fg=({value:t,onChange:s})=>{var at,Bt,Ut,Wt,Xt,Te,we,De;const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const l="/",[i,c]=b.useState((a==null?void 0:a.dataSources)||[]),[d,u]=b.useState(a==null?void 0:a.dataSource),[p,m]=b.useState(a==null?void 0:a.version),[h,f]=b.useState(a==null?void 0:a.geoAttribute),[g,x]=b.useState(!0),[y,j]=b.useState(a==null?void 0:a.status),[N,_]=b.useState((a==null?void 0:a.filters)||{}),[E,L]=b.useState((a==null?void 0:a.filterValue)||{}),[S,k]=b.useState((a==null?void 0:a.formatFn)||{}),[$,I]=b.useState((a==null?void 0:a.visibleCols)||[]),[T,A]=b.useState((a==null?void 0:a.pageSize)||5),[R,O]=b.useState((a==null?void 0:a.dataSize)||100),[M,D]=b.useState((a==null?void 0:a.sortBy)||{}),[P,F]=b.useState((a==null?void 0:a.groupBy)||[]),[B,V]=b.useState((a==null?void 0:a.notNull)||[]),[G,Z]=b.useState((a==null?void 0:a.showTotal)||[]),[X,H]=b.useState((a==null?void 0:a.fn)||[]),[z,W]=b.useState((a==null?void 0:a.hiddenCols)||[]),[Y,U]=b.useState((a==null?void 0:a.colSizes)||{}),[q,te]=b.useState((a==null?void 0:a.extFilterCols)||[]),[K,ne]=b.useState((a==null?void 0:a.extFilterValues)||{}),[J,ae]=b.useState((a==null?void 0:a.openOutCols)||[]),[de,ue]=b.useState((a==null?void 0:a.colJustify)||{}),[fe,ve]=b.useState((a==null?void 0:a.striped)||!1),[se,me]=b.useState((a==null?void 0:a.extFiltersDefaultOpen)||!1),[xe,re]=b.useState((a==null?void 0:a.customColName)||{}),[Q,pe]=b.useState((a==null?void 0:a.linkCols)||{}),[ge,le]=b.useState((a==null?void 0:a.showCsvDownload)||!1),[ie,be]=b.useState((a==null?void 0:a.additionalVariables)||[]),Re=["dama",oe,"sources","byCategory","Cenrep"];async function Pe(){if(i&&(!($!=null&&$.length)||!p||!d)){!d&&j("Please select a Datasource."),!p&&j("Please select a version."),!($!=null&&$.length)&&j("Please select columns."),x(!1);return}if(!L7({groupBy:P,fn:X,columnsToFetch:$.map(Xe=>X[Xe]?X[Xe]:Xe)})){j("Please make appropriate grouping selections."),x(!1);return}x(!0),j(void 0);const Ce=await qi({dataSources:i,dataSource:d,geoAttribute:h,pageSize:T,dataSize:R,sortBy:M,groupBy:P,fn:X,notNull:B,showTotal:G,colSizes:Y,filters:N,filterValue:E,formatFn:S,visibleCols:$,hiddenCols:z,version:p,extFilterCols:q,extFilterValues:K,openOutCols:J,colJustify:de,striped:fe,extFiltersDefaultOpen:se,customColName:xe,linkCols:Q,data:Ge,columns:ut,showCsvDownload:ge,additionalVariables:ie,fetchData:!0},n);s(JSON.stringify({...Ce})),x(!1)}b.useEffect(()=>{async function Ce(){x(!0),j(void 0),await n.get(Re),c(C(n.getCache(),[...Re,"value"],[])),x(!1)}Ce()},[]),b.useEffect(()=>{var ot,Vt,Gt;const Ce=(Gt=(((Vt=(ot=i.find(ka=>ka.source_id===d))==null?void 0:ot.metadata)==null?void 0:Vt.columns)||[]).find(ka=>ka.display==="geoid-variable"))==null?void 0:Gt.name,Xe=Ce!=null&&Ce.includes(" AS")?Ce.split(" AS")[0]:Ce!=null&&Ce.includes(" as")?Ce.split(" as")[0]:Ce;Xe&&f(Xe)},[d]),b.useEffect(()=>{async function Ce(){x(!0),j(void 0);const Xe=await qi({dataSources:i,dataSource:d,geoAttribute:h,pageSize:T,dataSize:R,sortBy:M,groupBy:P,fn:X,notNull:B,showTotal:G,colSizes:Y,filters:N,filterValue:E,formatFn:S,visibleCols:$,hiddenCols:z,version:p,extFilterCols:q,extFilterValues:K,openOutCols:J,colJustify:de,striped:fe,extFiltersDefaultOpen:se,customColName:xe,linkCols:Q,data:Ge,columns:ut,showCsvDownload:ge,additionalVariables:ie,fetchData:!1},n);s(JSON.stringify({...Xe})),x(!1)}Ce()},[T,R,M,Y,N,E,z,S,q,K,de,fe,se,xe,Q,ge]);const Ge=a.data,Ue=a.attributionData,ut=a.columns;return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(nd,{className:"flex-row-reverse p-0",label:"Data Source:",options:i.map(Ce=>({label:Ce.name,key:Ce.source_id})).sort((Ce,Xe)=>Ce.label.localeCompare(Xe.label)),value:d,onChange:Ce=>{I([]),te([]),f(void 0),u(+Ce)},placeholder:"Please select a data source"}),e.jsx(Ct,{source_id:d,view_id:p,onChange:m,className:"flex-row-reverse"}),e.jsx(E7,{falcor:n,pgEnv:oe,version:p,filters:ie,setFilters:be,columns:(((Bt=(at=i.find(Ce=>Ce.source_id===d))==null?void 0:at.metadata)==null?void 0:Bt.columns)||[]).filter(Ce=>["data-variable","meta-variable","geoid-variable"].includes(Ce.display)),metadata:((Wt=(Ut=i.find(Ce=>Ce.source_id===d))==null?void 0:Ut.metadata)==null?void 0:Wt.columns)||[]}),e.jsx(ql,{label:"Striped",value:fe,setValue:ve}),e.jsx(ql,{label:"External filters default open",value:se,setValue:me}),e.jsx(ql,{label:"Show CSV Download",value:ge,setValue:le}),e.jsx(Ls,{cols:(((Te=(Xt=i.find(Ce=>Ce.source_id===d))==null?void 0:Xt.metadata)==null?void 0:Te.columns)||[]).filter(Ce=>["data-variable","meta-variable","geoid-variable"].includes(Ce.display)).map(Ce=>Ce.name),metadata:((De=(we=i.find(Ce=>Ce.source_id===d))==null?void 0:we.metadata)==null?void 0:De.columns)||[],visibleCols:$,setVisibleCols:I,hiddenCols:z,setHiddenCols:W,filters:N,setFilters:_,filterValue:E,setFilterValue:L,formatFn:S,setFormatFn:k,pageSize:T,setPageSize:A,dataSize:R,setDataSize:O,groupBy:P,setGroupBy:F,fn:X,setFn:H,sortBy:M,setSortBy:D,notNull:B,setNotNull:V,showTotal:G,setShowTotal:Z,colSizes:Y,setColSizes:U,extFilterCols:q,setExtFilterCols:te,openOutCols:J,setOpenOutCols:ae,colJustify:de,setColJustify:ue,customColName:xe,setCustomColName:re,linkCols:Q,setLinkCols:pe}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"bg-blue-600 hover:bg-blue-500 text-white w-full sm:w-fit sm:flex-end rounded-md p-1.5 transition ease-in-out",onClick:()=>Pe(),children:"Generate"})})]}),g?e.jsx(dt,{}):y?e.jsx("div",{className:"p-5 text-center",children:y}):e.jsx(Rg,{data:Ge,columns:ut,hiddenCols:z,filterValue:E,extFilterValues:K,setExtFilterValues:ne,extFiltersDefaultOpen:se,pageSize:T,sortBy:M,attributionData:Ue,striped:fe,showCsvDownload:ge,baseUrl:l})]})})};Fg.settings={hasControls:!0,name:"ElementEdit"};const I7=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(Rg,{...s,baseUrl:"/"})})},T7={name:"Table: Cenrep II",type:"Table",variables:N7,getData:qi,EditComp:Fg,ViewComp:I7};async function Vg({pgEnv:t,geoid:s,dataSource:n,version:r,geoAttribute:a,visibleCols:l,id:i,bgColor:c,columnHeader:d,columnColors:u},p){var N;const m=_=>["dama",t,"viewsbyId",r,"options",_,"length"],h=_=>["dama",t,"viewsbyId",r,"options",_,"databyIndex"],f=["dama",t,"views","byId",r,"attributes"],g=["source_id","view_id","version","_modified_timestamp"],x=({geoAttribute:_,geoid:E})=>JSON.stringify({filter:{..._&&{[_]:[E]}}});await p.get(m(x({geoAttribute:a,geoid:s}))),await p.get([...h(x({geoAttribute:a,geoid:s})),{from:0,to:1-1},l]),await p.get([...f,g]);const j=(N=l==null?void 0:l.map(_=>{var L;return{text:((L=Object.values(C(p.getCache(),h(x({geoAttribute:a,geoid:s})),{}))[0])==null?void 0:L[_])||"",header:d==null?void 0:d[_],color:u==null?void 0:u[_]}}))==null?void 0:N.filter(_=>{var E,L,S;return console.log("???????????/",_==null?void 0:_.text),_.text&&typeof _.text!="object"&&((S=(L=(E=_==null?void 0:_.text)==null?void 0:E.toString())==null?void 0:L.trim())==null?void 0:S.toLowerCase())!=="null"});return{id:i+1,bgColor:c,text:M7(j),hideSection:!(j!=null&&j.length),geoAttribute:a,geoid:s,visibleCols:l,pgEnv:t,dataSource:n,version:r,columnHeader:d,columnColors:u}}const M7=t=>({root:{children:t==null?void 0:t.map(s=>{var n,r;return{children:[{detail:0,format:0,mode:"normal",...(s==null?void 0:s.color)&&{style:`color: ${(n=s.color)==null?void 0:n.text};background-color: ${(r=s.color)==null?void 0:r.bg};padding: 4px 12px;border: 1px solid;border-color: #60a5fa;border-radius: 8px;`},text:s.text,type:"text",version:1},{detail:0,format:0,mode:"normal",text:`

`,type:"text",version:1}],direction:"ltr",format:"",indent:0,type:s.header?"heading":"paragraph",tag:s.header?s.header:"",version:1}}),direction:"ltr",format:"",indent:0,type:"root",version:1}}),B7=({title:t,className:s,color:n,setColor:r})=>e.jsxs("div",{className:s,children:[e.jsx("label",{className:"shrink-0 pr-2 w-1/4",children:t}),e.jsx("input",{id:"background",list:"colors",className:"rounded-md shrink",type:"color",value:n,onChange:a=>r(a.target.value)}),e.jsx("datalist",{id:"colors",children:["#1e3a8a","#1e40af","#1d4ed8","#2563eb","#3b82f6","#60a5fa","#93c5fd","#bfdbfe","#dbeafe","#eff6ff","#713f12","#854d0e","#a16207","#ca8a04","#eab308","#facc15","#fde047","#fef08a","#fef9c3","#fefce8"].map(a=>e.jsx("option",{children:a}))})]}),Hg=({value:t,onChange:s})=>{var F,B,V,G;const{falcor:n,falcorCache:r}=et(),[a,l]=b.useState(1),i=t&&tt(t)?JSON.parse(t):{},c={text:"",size:"4xl",color:"000000"},[d,u]=b.useState((i==null?void 0:i.bgColor)||"rgba(0,0,0,0)"),[p,m]=b.useState((i==null?void 0:i.text)||t||c),[h,f]=b.useState(!0),[g,x]=b.useState(i==null?void 0:i.status),[y,j]=b.useState((i==null?void 0:i.dataSources)||[]),[N,_]=b.useState(i==null?void 0:i.dataSource),[E,L]=b.useState((i==null?void 0:i.version)||857),[S,k]=b.useState((i==null?void 0:i.geoAttribute)||"county"),[$,I]=b.useState((i==null?void 0:i.geoid)||"36001"),[T,A]=b.useState((i==null?void 0:i.visibleCols)||[]),[R,O]=b.useState((i==null?void 0:i.columnHeader)||{}),[M,D]=b.useState((i==null?void 0:i.columnColors)||{});b.useEffect(()=>{async function Z(){f(!0),x(void 0);const H=["dama",oe,"sources","byCategory","Cenrep"];await n.get(H),j(C(n.getCache(),[...H,"value"],[])),f(!1)}Z()},[]),b.useEffect(()=>{var X,H;const Z=(((H=(X=y.find(z=>z.source_id===N))==null?void 0:X.metadata)==null?void 0:H.columns)||[]).find(z=>z.display==="geoid-variable");Z!=null&&Z.name&&k(Z==null?void 0:Z.name)},[y,N]);const P=gt.lexical.EditComp;return b.useEffect(()=>{async function Z(){if(!E||!N){!N&&x("Please select a Datasource."),!E&&x("Please select a version."),f(!1);return}f(!0),x(void 0);const X=await Vg({pgEnv:oe,geoid:$,dataSource:N,version:E,geoAttribute:S,visibleCols:T,id:a,bgColor:d,columnHeader:R,columnColors:M},n);l(X.id),m(X.text),s(JSON.stringify({...X})),f(!1)}Z()},[N,E,$,S,T,d,R,M]),console.log("version",E),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(nd,{className:"flex-row-reverse p-0",label:"Data Source:",options:y.map(Z=>({label:Z.name,key:Z.source_id})).sort((Z,X)=>Z.label.localeCompare(X.label)),value:N,onChange:Z=>{A([]),k(void 0),_(+Z)},placeholder:"Please select a data source"}),e.jsx(Ct,{source_id:N,view_id:E,onChange:L,className:"flex-row-reverse"}),e.jsx(rt,{value:$,onChange:I,className:"flex-row-reverse"}),e.jsx(B7,{title:"Background: ",className:"w-full flex flex-row text-sm items-center",color:d,setColor:u}),e.jsx(Ls,{cols:(((B=(F=y.find(Z=>Z.source_id===N))==null?void 0:F.metadata)==null?void 0:B.columns)||[]).filter(Z=>["data-variable","meta-variable","geoid-variable"].includes(Z.display)).map(Z=>Z.name),metadata:((G=(V=y.find(Z=>Z.source_id===N))==null?void 0:V.metadata)==null?void 0:G.columns)||[],visibleCols:T,setVisibleCols:A,columnHeader:R,setColumnHeader:O,columnColors:M,setColumnColors:D})]}),h?e.jsx(dt,{}):g||e.jsx(P,{value:p,onChange:s,bgColor:d,id:a},a)]})})};Hg.settings={hasControls:!0,name:"ElementEdit"};const A7=({value:t})=>{var a,l,i,c,d,u,p,m;if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);const n=(s==null?void 0:s.text)||t;if(!n||((l=(a=n==null?void 0:n.root)==null?void 0:a.children)==null?void 0:l.length)===1&&((u=(d=(c=(i=n==null?void 0:n.root)==null?void 0:i.children)==null?void 0:c[0])==null?void 0:d.children)==null?void 0:u.length)===0||((m=(p=n==null?void 0:n.root)==null?void 0:p.children)==null?void 0:m.length)===0)return null;const r=gt.lexical.ViewComp;return e.jsx("div",{children:e.jsx(r,{value:n,bgColor:s==null?void 0:s.bgColor})})},O7={name:"Data Text Box",variables:[{name:"pgEnv",default:"hazmit_dms",hidden:!0},{name:"geoid",default:"36001"},{name:"dataSource",hidden:!0},{name:"version",hidden:!0},{name:"geoAttribute",hidden:!0},{name:"visibleCols",default:[],hidden:!0},{name:"columnHeader",default:[],hidden:!0},{name:"columnColors",default:[],hidden:!0},{name:"bgColor",default:"rgba(0,0,0,0)",hidden:!0}],getData:Vg,EditComp:Hg,ViewComp:A7},P7="bg-slate-100 p-5 text-center flex flex-col border rounded-md",zg=({title:t,value:s,change:n,year:r,compareYear:a,invertColors:l,valuePrefix:i,valueSuffix:c,maximumFractionDigits:d=2})=>e.jsxs("div",{className:P7,children:[e.jsx("label",{className:"text-sm",children:t}),e.jsxs("label",{className:"text-3xl font-bold",children:[s&&i,s?s.toLocaleString("en-us",{maximumFractionDigits:d}):"This census data variable is not available at this geography.",s&&c]}),e.jsxs("span",{className:`text-sm font-bold ${n>0&&l,"text-blue-500"}`,children:[Math.abs(n),"% ",n>0?"Growth":"Decline"]}),e.jsxs("span",{className:"text-xs  justify-left",children:[r," vs ",a]})]}),D7={B01003:{name:"Overall Population",variables:[{name:"Overall population",value:"B01003_001E"}]},B01002:{name:"Median Age By Sex",variables:[{name:"Median Age",value:"B01002_001E"},{name:"Male",value:"B01002_002E"},{name:"Female",value:"B01002_003E"}]},B02001:{name:"Racial Population",variables:[{name:"Total",value:"B02001_001E"},{name:"White",value:"B02001_002E"},{name:"Black or African American",value:"B02001_003E"},{name:"American Indian and Alaska Native",value:"B02001_004E"},{name:"Asian",value:"B02001_005E"},{name:"Native Hawaiian and Other Pacific Islander",value:"B02001_006E"},{name:"Other race ",value:"B02001_007E"},{name:"Two or more races",value:"B02001_008E"},{name:"Two races including other race",value:"B02001_009E"},{name:"Two races excluding other race and three or more races",value:"B02001_010E"}]},B19057:{name:"Public Assistance Income for Households",variables:[{name:"Total",value:"B19057_001E"},{name:"With public assistance income",value:"B19057_002E"},{name:"No public assistance income",value:"B19057_003E"}]},B23025:{name:"Employment Status",variables:[{name:"Total",value:"B23025_001E"},{name:"In labor force",value:"B23025_002E"},{name:"Civilian labor force",value:"B23025_003E"},{name:"Civilian labor force Employed",value:"B23025_004E"},{name:"Civilian labor force Unemployed",value:"B23025_005E"},{name:"Armed forces",value:"B23025_006E"},{name:"Not in labor force",value:"B23025_007E"}]},B01001:{name:"Sex by Age",variables:[{name:"Total Population",value:"B01001_001E"},{name:"Male Population",value:"B01001_002E"},{name:"Male Under 5",value:"B01001_003E"},{name:"Male 5-9",value:"B01001_004E"},{name:"Male 10-14",value:"B01001_005E"},{name:"Male 15-17",value:"B01001_006E"},{name:"Male 18-19",value:"B01001_007E"},{name:"Male 20",value:"B01001_008E"},{name:"Male 21",value:"B01001_009E"},{name:"Male 22-24",value:"B01001_010E"},{name:"Male 25-29",value:"B01001_011E"},{name:"Male 30-34",value:"B01001_012E"},{name:"Male 35-39",value:"B01001_013E"},{name:"Male 40-44",value:"B01001_014E"},{name:"Male 45-49",value:"B01001_015E"},{name:"Male 50-54",value:"B01001_016E"},{name:"Male 55-59",value:"B01001_017E"},{name:"Male 60-61",value:"B01001_018E"},{name:"Male 62-64",value:"B01001_019E"},{name:"Male 65-66",value:"B01001_020E"},{name:"Male 67-69",value:"B01001_021E"},{name:"Male 70-74",value:"B01001_022E"},{name:"Male 75-79",value:"B01001_023E"},{name:"Male 80-84",value:"B01001_024E"},{name:"Male 85 over",value:"B01001_025E"},{name:"Female Population",value:"B01001_026E"},{name:"Female Under 5",value:"B01001_027E"},{name:"Female 5-9",value:"B01001_028E"},{name:"Female 10-14",value:"B01001_029E"},{name:"Female 15-17",value:"B01001_030E"},{name:"Female 18-19",value:"B01001_031E"},{name:"Female 20",value:"B01001_032E"},{name:"Female 21",value:"B01001_033E"},{name:"Female 22-24",value:"B01001_034E"},{name:"Female 25-29",value:"B01001_035E"},{name:"Female 30-34",value:"B01001_036E"},{name:"Female 35-39",value:"B01001_037E"},{name:"Female 40-44",value:"B01001_038E"},{name:"Female 45-49",value:"B01001_039E"},{name:"Female 50-54",value:"B01001_040E"},{name:"Female 55-59",value:"B01001_041E"},{name:"Female 60-61",value:"B01001_042E"},{name:"Female 62-64",value:"B01001_043E"},{name:"Female 65-66",value:"B01001_044E"},{name:"Female 67-69",value:"B01001_045E"},{name:"Female 70-74",value:"B01001_046E"},{name:"Female 75-79",value:"B01001_047E"},{name:"Female 80-84",value:"B01001_048E"},{name:"Female 85 over",value:"B01001_049E"}]},B16001:{name:"Language Spoken at Home by Ability to Speak English",variables:[{name:"Spanish or Spanish Creole Speak English very well",value:"B16001_004E"},{name:"Spanish or Spanish Creole Speak English Less than very well",value:"B16001_005E"},{name:"French (incl. Patois,Cajun) Speak English very well",value:"B16001_007E"},{name:"French (incl. Patois,Cajun) Speak English Less than very well",value:"B16001_008E"},{name:"French Creole Speak English very well",value:"B16001_010E"},{name:"French Creole Speak English Less than very well",value:"B16001_011E"},{name:"Italian Speak English very well",value:"B16001_013E"},{name:"Italian Speak English Less than very well",value:"B16001_014E"},{name:"Portuguese or Portuguese Creole Speak English very well",value:"B16001_016E"},{name:"Portuguese or Portuguese Creole Speak English Less than very well",value:"B16001_017E"},{name:"German Speak English very well",value:"B16001_019E"},{name:"German Speak English Less than very well",value:"B16001_020E"},{name:"Yiddish Speak English very well",value:"B16001_022E"},{name:"Yiddish Speak English Less than very well",value:"B16001_023E"},{name:"Tagalog Speak English very well ",value:"B16001_094E"},{name:"Tagalog Speak English Less than very well ",value:"B16001_095E"},{name:"Greek Speak English very well",value:"B16001_030E"},{name:"Greek Speak English Less than very well",value:"B16001_031E"},{name:"Russian Speak English very well",value:"B16001_034E"},{name:"Russian Speak English Less than very well",value:"B16001_035E"},{name:"Polish Speak English very well",value:"B16001_037E"},{name:"Polish Speak English Less than very well",value:"B16001_038E"},{name:"Serbo-Croatian Speak English very well",value:"B16001_040E"},{name:"Serbo-Croatian Speak English Less than very well",value:"B16001_041E"},{name:"Other Salvic Languages Speak English very well",value:"B16001_043E"},{name:"Other Salvic Languages Speak English Less than very well",value:"B16001_044E"},{name:"Other Asian Languages Speak English very well ",value:"B16001_091E"},{name:"Other Asian Languages Speak English Less than very well ",value:"B16001_092E"},{name:"Persian Speak English very well",value:"B16001_049E"},{name:"Persian Speak English Less than very well",value:"B16001_050E"},{name:"Gujarati Speak English very well",value:"B16001_052E"},{name:"Gujarati Speak English Less than very well",value:"B16001_053E"},{name:"Hindi Speak English very well",value:"B16001_055E"},{name:"Hindi Speak English Less than very well",value:"B16001_056E"},{name:"Urdu Speak English very well",value:"B16001_058E"},{name:"Urdu Speak English Less than very well",value:"B16001_059E"},{name:"Other Indic languages Speak English very well",value:"B16001_061E"},{name:"Other Indic languages Speak English Less than very well",value:"B16001_062E"},{name:"Other Indo-European languages Speak English very well",value:"B16001_064E"},{name:"Other Indo-European languages Speak English Less than very well",value:"B16001_065E"},{name:"Chinese Speak English very well",value:"B16001_067E"},{name:"Chinese Speak English Less than very well",value:"B16001_068E"},{name:"Japanese Speak English very well",value:"B16001_070E"},{name:"Japanese Speak English Less than very well",value:"B16001_071E"},{name:"Korean Speak English very well",value:"B16001_073E"},{name:"Korean Speak English Less than very well",value:"B16001_074E"},{name:"Mon-Khmer Cambodian Speak English very well",value:"B16001_076E"},{name:"Mon-Khmer Cambodian Speak English Less than very well",value:"B16001_077E"}]},B19013:{name:"Median Household Income",variables:[{name:"Household income",value:"B19013_001E"}]},B23008:{name:"Own children under 18 years in families and subfamilies",variables:[{name:"Total",value:"B23008_001E"},{name:"Under 6 years",value:"B23008_002E"},{name:"Living with two parents",value:"B23008_003E"},{name:"Both Parents in labor force",value:"B23008_004E"},{name:"Father only in labor force",value:"B23008_005E"},{name:"Mother only in labor force",value:"B23008_006E"},{name:"Neither parent in labor force",value:"B23008_007E"},{name:"Living with one parent",value:"B23008_008E"},{name:"Living with father",value:"B23008_009E"},{name:"In labor force",value:"B23008_010E"},{name:"Not in labor force",value:"B23008_011E"},{name:"Living with mother",value:"B23008_012E"},{name:"In labor force",value:"B23008_013E"},{name:"Not in labor force",value:"B23008_014E"},{name:"6 to 17 years",value:"B23008_015E"},{name:"Living with two parents",value:"B23008_016E"},{name:"Both Parents in labor force",value:"B23008_017E"},{name:"Father only in labor force",value:"B23008_018E"},{name:"Mother only in labor force",value:"B23008_019E"},{name:"Neither parent in labor force",value:"B23008_020E"},{name:"Living with one parent",value:"B23008_021E"},{name:"Living with father",value:"B23008_022E"},{name:"In labor force",value:"B23008_023E"},{name:"Not in labor force",value:"B23008_024E"},{name:"Living with mother",value:"B23008_025E"},{name:"In labor force",value:"B23008_026E"},{name:"Not in labor force",value:"B23008_027E"}]},B25002:{name:"Occupancy Status",variables:[{name:"Total",value:"B25002_001E"},{name:"Occupied Units",value:"B25002_002E"},{name:"Vacant Units",value:"B25002_003E"}]},B17001:{name:"Poverty Status by Sex by Age",variables:[{name:"Male Under 5",value:"B17001_004E"},{name:"Male 5 years",value:"B17001_005E"},{name:"Male 6-11 years",value:"B17001_006E"},{name:"Male 12-14 years",value:"B17001_007E"},{name:"Male 15 years",value:"B17001_008E"},{name:"Male 16-17 years",value:"B17001_009E"},{name:"Male 18-24 years",value:"B17001_010E"},{name:"Male 25-34 years",value:"B17001_011E"},{name:"Male 35-44 years",value:"B17001_012E"},{name:"Male 45-54 years",value:"B17001_013E"},{name:"Male 55-64 years",value:"B17001_014E"},{name:"Male 65-74 years",value:"B17001_015E"},{name:"Male 75 years over",value:"B17001_016E"},{name:"Female Under 5",value:"B17001_018E"},{name:"Female 5 years",value:"B17001_019E"},{name:"Female 6-11 years",value:"B17001_020E"},{name:"Female 12-14 years",value:"B17001_021E"},{name:"Female 15 years",value:"B17001_022E"},{name:"Female 16-17 years",value:"B17001_023E"},{name:"Female 18-24 years",value:"B17001_024E"},{name:"Female 25-34 years",value:"B17001_025E"},{name:"Female 35-44 years",value:"B17001_026E"},{name:"Female 45-54 years",value:"B17001_027E"},{name:"Female 55-64 years",value:"B17001_028E"},{name:"Female 65-74 years",value:"B17001_029E"},{name:"Female 75 years over",value:"B17001_030E"},{name:"Male Under 5",value:"B17001_033E"},{name:"Male 5 years",value:"B17001_034E"},{name:"Male 6-11 years",value:"B17001_035E"},{name:"Male 12-14 years",value:"B17001_036E"},{name:"Male 15 years",value:"B17001_037E"},{name:"Male 16-17 years",value:"B17001_038E"},{name:"Male 18-24 years",value:"B17001_039E"},{name:"Male 25-34 years",value:"B17001_040E"},{name:"Male 35-44 years",value:"B17001_041E"},{name:"Male 45-54 years",value:"B17001_042E"},{name:"Male 55-64 years",value:"B17001_043E"},{name:"Male 65-74 years",value:"B17001_044E"},{name:"Male 75 years over",value:"B17001_045E"},{name:"Female Under 5",value:"B17001_047E"},{name:"Female 5 years",value:"B17001_048E"},{name:"Female 6-11 years",value:"B17001_049E"},{name:"Female 12-14 years",value:"B17001_050E"},{name:"Female 15 years",value:"B17001_051E"},{name:"Female 16-17 years",value:"B17001_052E"},{name:"Female 18-24 years",value:"B17001_053E"},{name:"Female 25-34 years",value:"B17001_054E"},{name:"Female 35-44 years",value:"B17001_055E"},{name:"Female 45-54 years",value:"B17001_056E"},{name:"Female 55-64 years",value:"B17001_057E"},{name:"Female 65-74 years",value:"B17001_058E"},{name:"Female 75 years over",value:"B17001_059E"}]},B15003:{name:"Educational Attainment",variables:[{name:"No schooling completed",value:"B15003_002E"},{name:"Nursery School",value:"B15003_003E"},{name:"Kindergarten",value:"B15003_004E"},{name:"1st grade",value:"B15003_005E"},{name:"2nd grade",value:"B15003_006E"},{name:"3rd grade",value:"B15003_007E"},{name:"4th grade",value:"B15003_008E"},{name:"5th grade",value:"B15003_009E"},{name:"6th grade",value:"B15003_010E"},{name:"7th grade",value:"B15003_011E"},{name:"8th grade",value:"B15003_012E"},{name:"9th grade",value:"B15003_013E"},{name:"10th grade",value:"B15003_014E"},{name:"11th grade",value:"B15003_015E"},{name:"12th grade or no diploma",value:"B15003_016E"},{name:"Regular High School diploma",value:"B15003_017E"},{name:"GED or alternative credential",value:"B15003_018E"},{name:"Some college less than 1 year",value:"B15003_019E"},{name:"Some college,1 or more years,no degree",value:"B15003_020E"},{name:"Associate`s degree",value:"B15003_021E"},{name:"Bachelor`s degree",value:"B15003_022E"},{name:"Master`s degree",value:"B15003_023E"},{name:"Professional School degree",value:"B15003_024E"},{name:"Doctorate degree",value:"B15003_025E"}]},B19119:{name:"Median Family Income by Family Size",variables:[{name:"Total",value:"B19119_001E"},{name:"2-person families",value:"B19119_002E"},{name:"3-person families",value:"B19119_003E"},{name:"4-person families",value:"B19119_004E"},{name:"5-person families",value:"B19119_005E"},{name:"6-person families",value:"B19119_006E"},{name:"7-person families",value:"B19119_007E"}]},B19013A:{name:"Median household income, White",variables:[{name:" White ",value:"B19013A_001E"}]},B19013B:{name:"Median household income, Black or African American",variables:[{name:"Black or African American",value:"B19013B_001E"}]},B19013C:{name:"Median household income, American Indian or Alaska Native",variables:[{name:"American Indian or Alaska Native",value:"B19013C_001E"}]},B19013D:{name:"Median household income, Asian",variables:[{name:"Asian",value:"B19013D_001E"}]},B19013E:{name:"Median household income, Native Hawaiian and Other Pacific Islander",variables:[{name:"Native Hawaiian and Other Pacific Islander",value:"B19013E_001E"}]},B19013F:{name:"Median household income, Some Other Race",variables:[{name:"Some Other Race",value:"B19013F_001E"}]},B19013G:{name:"Median household income, Two or more races",variables:[{name:"Two or more races",value:"B19013G_001E"}]},B19013H:{name:"Median household income, White, Not Hispanic or Latino",variables:[{name:"White, Not Hispanic or Latino",value:"B19013H_001E"}]},B19013I:{name:"Median household income, Hispanic or Latino",variables:[{name:"Hispanic or Latino",value:"B19013I_001E"}]},B21001:{name:"Civilian Population 18 Years and Over",variables:[{name:"Total",value:"B21001_001E"},{name:"Total veteran",value:"B21001_002E"},{name:"Total non veteran",value:"B21001_003E"},{name:"Total Male",value:"B21001_004E"},{name:"Total Male veteran",value:"B21001_005E"},{name:"Total Male non veteran",value:"B21001_006E"},{name:"Total Male 18-34 years",value:"B21001_007E"},{name:"Male 18-34 years veteran",value:"B21001_008E"},{name:"Male 18-34 years non veteran",value:"B21001_009E"},{name:"Total Male 35-54 years",value:"B21001_010E"},{name:"Male 35-54 years veteran",value:"B21001_011E"},{name:"Male 35-54 years non veteran",value:"B21001_012E"},{name:"Total Male 55-64 years",value:"B21001_013E"},{name:"Male 55-64 years veteran",value:"B21001_014E"},{name:"Male 55-64 years non veteran",value:"B21001_015E"},{name:"Total Male 65-74 years",value:"B21001_016E"},{name:"Male 65-74 years veteran",value:"B21001_017E"},{name:"Male 65-74 years non veteran",value:"B21001_018E"},{name:"Total Male 75 years over",value:"B21001_019E"},{name:"Male 75 years over veteran",value:"B21001_020E"},{name:"Male 75 years over non veteran",value:"B21001_021E"},{name:"Total Female",value:"B21001_022E"},{name:"Total Female veteran",value:"B21001_023E"},{name:"Total Female non veteran",value:"B21001_024E"},{name:"Total Female 18-34 years",value:"B21001_025E"},{name:"Female 18-34 years veteran",value:"B21001_026E"},{name:"Female 18-34 years non veteran",value:"B21001_027E"},{name:"Total Female 35-54 years",value:"B21001_028E"},{name:"Female 35-54 years veteran",value:"B21001_029E"},{name:"Female 35-54 years non veteran",value:"B21001_030E"},{name:"Total Female 55-64 years",value:"B21001_031E"},{name:"Female 55-64 years veteran",value:"B21001_032E"},{name:"Female 55-64 years non veteran",value:"B21001_033E"},{name:"Total Female 65-74 years",value:"B21001_034E"},{name:"Female 65-74 years veteran",value:"B21001_035E"},{name:"Female 65-74 years non veteran",value:"B21001_036E"},{name:"Total Female 75 years over",value:"B21001_037E"},{name:"Female 75 years over veteran",value:"B21001_038E"},{name:"Female 75 years over non veteran",value:"B21001_039E"}]},B25004:{name:"Vacancy Status",variables:[{name:"Total",value:"B25004_001E"},{name:"For rent",value:"B25004_002E"},{name:"Rented,not occupied",value:"B25004_003E"},{name:"For sale only",value:"B25004_004E"},{name:"Sold,not occupied",value:"B25004_005E"},{name:"For seasonal, recreational, or occasional use",value:"B25004_006E"},{name:"For migrant workers",value:"B25004_007E"},{name:"Other vacant",value:"B25004_008E"}]},B25118:{name:"Occupied Housing Units",variables:[{name:"Total",value:"B25118_001E"},{name:"Owner Occupied",value:"B25118_002E"},{name:"Less than $5,000",value:"B25118_003E"},{name:"$5k-$9,999",value:"B25118_004E"},{name:"$10k-$14,999",value:"B25118_005E"},{name:"$15k-$19,999",value:"B25118_006E"},{name:"$20k-$24,999",value:"B25118_007E"},{name:"$25k-$34,999",value:"B25118_008E"},{name:"$35k-$49,999",value:"B25118_009E"},{name:"$50k-$74,999",value:"B25118_010E"},{name:"$75k-$99,999",value:"B25118_011E"},{name:"$100k-$149,999",value:"B25118_012E"},{name:"$150k or more",value:"B25118_013E"},{name:"Renter Occupied",value:"B25118_014E"},{name:"Less than $5,000",value:"B25118_015E"},{name:"$5k-$9,999",value:"B25118_016E"},{name:"$10k-$14,999",value:"B25118_017E"},{name:"$15k-$19,999",value:"B25118_018E"},{name:"$20k-$24,999",value:"B25118_019E"},{name:"$25k-$34,999",value:"B25118_020E"},{name:"$35k-$49,999",value:"B25118_021E"},{name:"$50k-$74,999",value:"B25118_022E"},{name:"$75k-$99,999",value:"B25118_023E"},{name:"$100k-$149,999",value:"B25118_024E"},{name:"$150k or more",value:"B25118_025E"}]},B25087:{name:"Owner-Occupied Housing Units",variables:[{name:"Housing units with a mortgage",value:"B25087_002E"},{name:"Less than $200",value:"B25087_003E"},{name:"$200-$299",value:"B25087_004E"},{name:"$300-$399",value:"B25087_005E"},{name:"$400-$499",value:"B25087_006E"},{name:"$500-$599",value:"B25087_007E"},{name:"$600-$699",value:"B25087_008E"},{name:"$700-$799",value:"B25087_009E"},{name:"$800-$899",value:"B25087_010E"},{name:"$900-$999",value:"B25087_011E"},{name:"$1,000-$1,249",value:"B25087_012E"},{name:"$1,250-$1,499",value:"B25087_013E"},{name:"$1,500-$1,999",value:"B25087_014E"},{name:"$2,000-$2,499",value:"B25087_015E"},{name:"$2,500-$2,999",value:"B25087_016E"},{name:"$3,000-$3,499",value:"B25087_017E"},{name:"$3,500-$3,999",value:"B25087_018E"},{name:"$4,000 or more",value:"B25087_019E"},{name:"Housing units without a mortgage",value:"B25087_020E"},{name:"Less than $100",value:"B25087_021E"},{name:"$100-$149",value:"B25087_022E"},{name:"$150-$199",value:"B25087_023E"},{name:"$200-$249",value:"B25087_024E"},{name:"$250-$299",value:"B25087_025E"},{name:"$300-$349",value:"B25087_026E"},{name:"$350-$399",value:"B25087_027E"},{name:"$400-$499",value:"B25087_028E"},{name:"$500-$599",value:"B25087_029E"},{name:"$600-$699",value:"B25087_030E"},{name:"$700-$799",value:"B25087_031E"},{name:"$800-$899",value:"B25087_032E"},{name:"$900-$999",value:"B25087_033E"},{name:"$1000-$1099",value:"B25087_034E"},{name:"$1100-$1199",value:"B25087_035E"},{name:"$1200-$1299",value:"B25087_036E"},{name:"$1300-$1399",value:"B25087_037E"},{name:"$1400-$1499",value:"B25087_038E"},{name:"$1500 or more",value:"B25087_039E"}]},B14003:{name:"Sex by School Enrollment by Type of School by Age",variables:[{name:"ages 3 and 4, enrolled in school",value:"B14003_004E"},{name:"ages 5 to 9, enrolled in school",value:"B14003_005E"},{name:"ages 10 to 14, enrolled in school",value:"B14003_006E"},{name:"ages 15 to 17, enrolled in school",value:"B14003_007E"},{name:"ages 18 and 19, enrolled in school",value:"B14003_008E"},{name:"ages 20 to 24, enrolled in school",value:"B14003_009E"},{name:"ages 25 to 34, enrolled in school",value:"B14003_010E"},{name:"ages 35 and over, enrolled in school",value:"B14003_011E"},{name:"ages 3 and 4, enrolled in private school",value:"B14003_013E"},{name:"ages 5 to 9, enrolled in private school",value:"B14003_014E"},{name:"ages 10 to 14, enrolled in private school",value:"B14003_015E"},{name:"ages 15 to 17, enrolled in private school",value:"B14003_016E"},{name:"ages 18 and 19, enrolled in private school",value:"B14003_017E"},{name:"ages 20 to 24, enrolled in private school",value:"B14003_018E"},{name:"ages 25 to 34, enrolled in private school",value:"B14003_019E"},{name:"ages 35 and over, enrolled in private school",value:"B14003_020E"},{name:"ages 3 and 4, not enrolled in school",value:"B14003_022E"},{name:"ages 5 to 9, not enrolled in school",value:"B14003_023E"},{name:"ages 10 to 14, not enrolled in school",value:"B14003_024E"},{name:"ages 15 to 17, not enrolled in school",value:"B14003_025E"},{name:"ages 18 and 19, not enrolled in school",value:"B14003_026E"},{name:"ages 20 to 24, not enrolled in school",value:"B14003_027E"},{name:"ages 25 to 34, not enrolled in school",value:"B14003_028E"},{name:"ages 35 and over, not enrolled in school",value:"B14003_029E"},{name:"3 and 4 years",value:"B14003_032E"},{name:"5 to 9 years",value:"B14003_033E"},{name:"10 to 14 years",value:"B14003_034E"},{name:"15 to 17 years",value:"B14003_035E"},{name:"18 and 19 years",value:"B14003_036E"},{name:"20 to 24 years",value:"B14003_037E"},{name:"25 to 34 years",value:"B14003_038E"},{name:"35 years and over",value:"B14003_039E"},{name:"3 and 4 years",value:"B14003_041E"},{name:"5 to 9 years",value:"B14003_042E"},{name:"10 to 14 years",value:"B14003_043E"},{name:"15 to 17 years",value:"B14003_044E"},{name:"18 and 19 years",value:"B14003_045E"},{name:"20 to 24 years",value:"B14003_046E"},{name:"25 to 34 years",value:"B14003_047E"},{name:"35 years and over",value:"B14003_048E"},{name:"3 and 4 years",value:"B14003_050E"},{name:"5 to 9 years",value:"B14003_051E"},{name:"10 to 14 years",value:"B14003_052E"},{name:"15 to 17 years",value:"B14003_053E"},{name:"18 and 19 years",value:"B14003_054E"},{name:"20 to 24 years",value:"B14003_055E"},{name:"25 to 34 years",value:"B14003_056E"},{name:"35 years and over",value:"B14003_057E"}]},B25091:{name:"Mortgage Status by Selected Monthly Owner Costs as a Percentage of Household Income",variables:[{name:"Less than 10.0 percent",value:"B25091_003E"},{name:"10.0 to 14.9 percent",value:"B25091_004E"},{name:"15.0 to 19.9 percent",value:"B25091_005E"},{name:"20.0 to 24.9 percent",value:"B25091_006E"},{name:"25.0 to 29.9 percent",value:"B25091_007E"},{name:"30.0 to 34.9 percent",value:"B25091_008E"},{name:"35.0 to 39.9 percent",value:"B25091_009E"},{name:"40.0 to 49.9 percent",value:"B25091_010E"},{name:"50.0 percent or more",value:"B25091_011E"},{name:"Less than 10.0 percent",value:"B25091_014E"},{name:"10.0 to 14.9 percent",value:"B25091_015E"},{name:"15.0 to 19.9 percent",value:"B25091_016E"},{name:"20.0 to 24.9 percent",value:"B25091_017E"},{name:"25.0 to 29.9 percent",value:"B25091_018E"},{name:"30.0 to 34.9 percent",value:"B25091_019E"},{name:"35.0 to 39.9 percent",value:"B25091_020E"},{name:"40.0 to 49.9 percent",value:"B25091_021E"},{name:"50.0 percent or more",value:"B25091_022E"}]}},R7={w:12,h:9,static:!0},an="#ff9999",rn="#b3b3ff",dm=/\w{6}(\w?)_(\d{3})\w/,um=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Oa=t=>t.reduce((s,n)=>[...s,...F7(n)],[]),F7=t=>{const s=t.split("...");if(s.length===1)return s;const[n,r]=s,a=dm.exec(n),l=dm.exec(r);if(a[1]!==l[1]&&a[2]===l[2]){const i=a[1],c=l[1],d=[];let u=i;for(;u<=c;){d.push(n.replace(`${i}_`,`${u}_`));const p=um.indexOf(u);u=um[p+1]}return d}else if(a[2]!==l[2]&&a[1]===l[1]){const i=+a[2],c=+l[2],d=[];for(let u=i;u<=c;++u)d.push(n.replace(`_${a[2]}`,`_${`000${u}`.slice(-3)}`));return d}return[n]},Ug=t=>{const s=C(t,"children",[]);return s.length?s.reduce((n,r)=>(n.push(...Ug(r)),n),[]):[C(t,"censusKey")].filter(Boolean)},V7=t=>{const{bars:s,stackByYear:n,stacks:r}=t;if(n&&r)return r.map(l=>l.censusKey);const a=[];for(const l of s)for(const i of l.stacks)a.push(i.censusKey);return a},Wg=(t,s)=>{const n=C(s,["geoid","length"],0),r=window.innerWidth<992;let a=0,l=0;const i=[new mm(0,-1,12,1)];return t.filter(({showForGeoidLength:c=n,hideWhenCompact:d=!1})=>c===n||d&&r).reduce((c,d,u)=>{const p=JSON.parse(JSON.stringify(d));if(p.type==="ProfileFooter"||p.type==="ProfileHeader")return p;if(p.broadCensusKey){const h=D7[p.broadCensusKey];p.censusKeys=h.variables.map(f=>f.value),p.name=h.name,p.title=h.name}p.left&&p.left.keys&&p.right&&p.right.keys&&(p.left.keys=Oa(p.left.keys),p.right.keys=Oa(p.right.keys),p.censusKeys=[...p.left.keys,...p.right.keys]),p.left&&p.left.slice&&p.censusKeys&&(p.left.keys=p.censusKeys.slice(...p.left.slice)),p.right&&p.right.slice&&p.censusKeys&&(p.right.keys=p.censusKeys.slice(...p.right.slice)),p.censusKey&&!p.censusKeys&&(p.censusKeys=[p.censusKey]),p.divisorKey&&!p.divisorKeys&&(p.divisorKeys=[p.divisorKey]),p.type==="CensusTreemap"&&(p.censusKeys=Ug(p.tree)),p.type==="CensusStackedBarChart"&&(p.censusKeys=V7(p)),p.censusKeys&&(p.censusKeys=Oa(p.censusKeys)),p.divisorKeys&&(p.divisorKeys=Oa(p.divisorKeys)),p.subtractKeys&&(p.subtractKeys=Oa(p.subtractKeys)),p.censusKeys&&(p.censusKeysMoE=p.censusKeys.reduce((h,f)=>{const g=/(.+)E$/;return g.test(f)&&h.push(f.replace(g,(x,y)=>y+"M")),h},[])),p.divisorKeys&&(p.divisorKeysMoE=p.divisorKeys.reduce((h,f)=>{const g=/(.+)E$/;return g.test(f)&&h.push(f.replace(g,(x,y)=>y+"M")),h},[])),p.subtractKeys&&(p.subtractKeysMoE=p.subtractKeys.reduce((h,f)=>{const g=/(.+)E$/;return g.test(f)&&h.push(f.replace(g,(x,y)=>y+"M")),h},[])),p.divisorKeys&&!p.yFormat&&(p.yFormat=",.1%");const m=Object.assign({},R7,p.layout);if(r)m.x=0,m.w=3,m.y=l,m.h=p.type==="CensusStatBox"?4:m.h,p.layout=m,l+=m.h;else{m.w=Math.min(12,m.w),m.x!==void 0?a=m.x:a+m.w>12&&(a=0),m.y!==void 0&&(l=m.y);const h=new mm(a,l,m.w,m.h);for(;Gg(h,i);)h.translateY(1);m.y===void 0&&H7(h,i),i.push(h),p.layout=h.getLayout(),a+=h.w,l=i.reduce((f,g)=>Math.max(g.bottom(),f),l)}return c.push(p),c},[])},hl=(t,s)=>Object.keys(t).reduce((n,r)=>(n[r]=Wg(t[r],s),n),{}),Gg=(t,s)=>s.reduce((n,r)=>n||r.intersects(t),!1),H7=(t,s)=>{for(t.translateY(-1);!Gg(t,s);)t.translateY(-1);t.translateY(1)};class mm{constructor(s,n,r,a){this.x=s,this.y=n,this.w=r,this.h=a}getLayout(){return{x:this.x,y:this.y,w:this.w,h:this.h}}top(){return this.y}bottom(){return this.y+this.h}left(){return this.x}right(){return this.x+this.w}translate(s,n){this.x+=s,this.y+=n}translateX(s){this.translate(s,0)}translateY(s){this.translate(0,s)}intersects(s){return!(this.right()<=s.left()||this.left()>=s.right()||this.bottom()<=s.top()||this.top()>=s.bottom())}}const Jg=(t,s,n=0)=>{const r=C(s,["meta",t,"label"],t);if(typeof r!="string")return t;let a=r.split("!!");return a.length>n&&(a=a.slice(n)),a.join(", ")},z7=[{type:"TextBox",header:"SOCIAL WELFARE",body:"Metrics related to the individual and collective social well-being of the Capital Region and it’s communities.",layout:{h:5,w:12}},{type:"CensusStatBox",title:"Median Household Income, White",valuePrefix:"$",censusKeys:["B19013A_001E"],showCompareYear:!0,maximumFractionDigits:1,layout:{w:3,h:6}},{type:"CensusStatBox",title:"Median Household Income, Black",valuePrefix:"$",censusKeys:["B19013B_001E"],showCompareYear:!0,maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{type:"CensusBarChart",title:"Median Household Income by Race and Ethnicity",censusKeys:["B19013A_001E","B19013B_001E","B19013D_001E","B19013I_001E"],yFormat:"$,d",censusKeyLabels:{B19013A_001E:"White",B19013B_001E:"Black or African American Alone",B19013D_001E:"Asian",B19013I_001E:"Hispanic or Latino"},layout:{w:9,h:12}},{type:"CensusStatBox",title:"Median Household Income, Hispanic or Latino",valuePrefix:"$",censusKeys:["B19013I_001E"],showCompareYear:!0,maximumFractionDigits:1,layout:{w:3,h:6}},{type:"CensusStatBox",title:"Median Household Income, Asian",valuePrefix:"$",censusKeys:["B19013D_001E"],showCompareYear:!0,maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{type:"CensusLineChart",title:"Median Household Income by Race and Ethnicity",censusKeys:["B19013A_001E","B19013B_001E","B19013D_001E","B19013I_001E"],marginLeft:75,yFormat:"$,d",censusKeyLabels:{B19013A_001E:"White",B19013B_001E:"Black or African American Alone",B19013D_001E:"Asian",B19013I_001E:"Hispanic or Latino"},layout:{w:9,h:12}},{type:"CensusCompareBarChart",broadCensusKey:"B17001",left:{key:"Below Poverty Level",slice:[0,26]},right:{key:"Above Poverty Level",slice:[26,52]},showCompare:!1,showCompareGeoid:!1,marginLeft:150,layout:{h:12},labels:["Male Under age 5","Male age 5","Male ages 6-11","Male ages 12-14","Male ages 15","Male ages 16-17","Male ages 18-24","Male ages 25-34","Male ages 35-44","Male ages 45-54","Male ages 55-64","Male ages 65-74","Male ages 75 and over","Female Under age 5","Female age 5","Female ages 6-11","Female ages 12-14","Female ages 15","Female ages 16-17","Female ages 18-24","Female ages 25-34","Female ages 35-44","Female ages 45-54","Female ages 55-64","Female ages 65-74","Female ages 75 and over"]},{type:"CensusBarChart",title:"Median Family Income by Family Size",censusKeys:["B19119_001E...B19119_007E"],years:["2017"],yFormat:"$,d"},{type:"CensusStatBox",censusKeys:["B22001_002E"],showCompareYear:!0,invertColors:!0,title:"Households that Received Food Stamps/SNAP in the Past 12 Months",layout:{w:3,h:6}},{type:"CensusStatBox",censusKeys:["B09010_002E"],showCompareYear:!0,invertColors:!0,title:"Households with Children Under Age 18 Receiving Public Assistance (e.g., Food Stamps/SNAP)",layout:{w:3,h:6,x:0}},{type:"CensusBarChart",title:"Receipt of SNAP by Race and Ethnicity",marginLeft:75,showCompare:!1,marginLeft:250,orientation:"horizontal",layout:{h:12},censusKeys:["B22005A_002E","B22005B_002E","B22005C_002E","B22005D_002E","B22005E_002E","B22005F_002E","B22005G_002E","B22005H_002E","B22005I_002E"],censusKeyLabels:{B22005A_002E:"White",B22005B_002E:"Black or African American Alone",B22005C_002E:"American Indian and Alaska Native",B22005D_002E:"Asian",B22005E_002E:"Native Hawaiian and Other Pacific Islander",B22005F_002E:"Some Other Race Alone",B22005G_002E:"Two or More Races",B22005H_002E:"White Alone, Not Hispanic or Latino",B22005I_002E:"Hispanic or Latino"},layout:{w:9,h:12}},{type:"CensusBarChart",title:"Language Spoken at Home by Ability to Speak English",hideWhenCompact:!0,censusKeys:["C16001_005E","C16001_008E","C16001_011E","C16001_014E","C16001_017E","C16001_020E","C16001_023E","C16001_029E","C16001_035E","C16001_038E"],orientation:"horizontal",marginLeft:400,sorted:!0,layout:{h:12}},{type:"TextBox",header:"Food Access Research Atlas by the United States Department of Agriculture",subheader:"Data Visualization",body:"Map of Food Insecure Areas",link:"https://www.ers.usda.gov/data-products/food-access-research-atlas/go-to-the-atlas/",layout:{h:5,w:12}},{type:"TextBox",header:"Child Care Regulated Programs",subheader:"Data",body:"Information on OCFS regulated child care programs, which includes program overview information and violation history.",link:"https://data.ny.gov/Human-Services/Child-Care-Regulated-Programs/cb42-qumz/data",layout:{h:5,w:12}},{type:"TextBox",header:"New York State Division of Criminal Justice Services",subheader:"Data Downloads and Report Publications",body:"Criminal justice data by county from New York State Division of Criminal Justice Services including Violent Crimes, Domestic Violence Victims, Arrests, Dispositions, Youth Justice Data, and more",link:"https://www.criminaljustice.ny.gov/crimnet/ojsa/stats.htm",layout:{h:5,w:12}}],U7=[{type:"TextBox",header:"EDUCATION",body:"Education is key to preparing children for success as adults and for ensuring the economic and civic vitality of our region. ",layout:{h:3,w:12}},{type:"CensusStatBox",title:"Total Ages 5-19 Not Enrolled in School",censusKeys:["B14003_023E","B14003_024E","B14003_025E","B14003_026E","B14003_051E","B14003_052E","B14003_053E","B14003_054E"],amount:!0,showCompareYear:!0,maximumFractionDigits:1,invertColors:!0,layout:{w:3,h:6}},{title:"School Enrollment by Sex",showCompareGeoid:!1,type:"CensusCompareBarChart",marginLeft:310,layout:{h:12},left:{key:"Male",color:an,keys:["B14003_004E","B14003_005E","B14003_006E","B14003_007E","B14003_008E","B14003_009E","B14003_013E","B14003_014E","B14003_015E","B14003_016E","B14003_017E","B14003_018E","B14003_022E","B14003_023E","B14003_024E","B14003_025E","B14003_026E","B14003_027E"]},right:{key:"Female",color:rn,keys:["B14003_032E","B14003_033E","B14003_034E","B14003_035E","B14003_036E","B14003_037E","B14003_041E","B14003_042E","B14003_043E","B14003_044E","B14003_045E","B14003_046E","B14003_050E","B14003_051E","B14003_052E","B14003_053E","B14003_054E","B14003_055E"]},marginLeft:250,layout:{w:9,h:12},labels:["Ages 3 and 4, enrolled in school","Ages 5 to 9, enrolled in school","Ages 10 to 14, enrolled in school","Ages 15 to 17, enrolled in school","Ages 18 and 19, enrolled in school","Ages 20 to 24, enrolled in school","Ages 3 and 4, enrolled in private school","Ages 5 to 9, enrolled in private school","Ages 10 to 14, enrolled in private school","Ages 15 to 17, enrolled in private school","Ages 18 and 19, enrolled in private school","Ages 20 to 24, enrolled in private school","Ages 3 and 4, not enrolled in school","Ages 5 to 9, not enrolled in school","Ages 10 to 14, not enrolled in school","Ages 15 to 17, not enrolled in school","Ages 18 and 19, not enrolled in school","Ages 20 to 24, not enrolled in school"]},{type:"CensusStatBox",title:"Percent Ages 3-4 Enrolled in School",censusKeys:["B14003_004E","B14003_013E","B14003_032E","B14003_041E"],divisorKeys:["B14003_004E","B14003_013E","B14003_022E","B14003_032E","B14003_041E","B14003_050E"],sumType:"pct",valueSuffix:"%",maximumFractionDigits:1,showCompareYear:!0,layout:{w:3,h:6}},{type:"CensusStatBox",title:"Total With No High School Diploma or Equivalent",censusKeys:["B15003_002E...B15003_016E"],showCompareYear:!0,maximumFractionDigits:1,invertColors:!0,layout:{w:3,h:6,x:0}},{type:"CensusBarChart",title:"Educational Attainment",orientation:"horizontal",marginLeft:225,censusKeys:["B15003_016E...B15003_025E"],layout:{w:9,h:12}},{type:"CensusStatBox",title:"Percent of Population 25 and Over with No High School Diploma or Equivalent",sumType:"pct",valueSuffix:"%",maximumFractionDigits:1,censusKeys:["B15003_002E...B15003_016E"],divisorKeys:["B15003_001E"],showCompareYear:!0,invertColors:!0,layout:{w:3,h:6,x:0}},{type:"CensusStatBox",title:"Total With Bachelors Degree or Higher",censusKeys:["B15003_022E...B15003_025E"],showCompareYear:!0,maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{type:"CensusStatBox",title:"Percent of Population with Bachelors Degree or Higher",sumType:"pct",divisorKey:"B23025_001E",valueSuffix:"%",maximumFractionDigits:1,censusKeys:["B15003_022E...B15003_025E"],divisorKeys:["B01003_001E"],showCompareYear:!0,layout:{w:3,h:6,x:0}},{type:"CensusPieChart",title:"Educational Attainment",legendWidth:260,layout:{w:9,h:12},censusKeys:["B15003_016E...B15003_025E"]},{title:"Sex by School Enrollment by Level of School by Type of School",type:"CensusCompareBarChart",showCompareGeoid:!1,marginLeft:310,hideWhenCompact:!0,layout:{h:12},left:{key:"Male",color:an,keys:["B14002_004E...B14002_025E"]},right:{key:"Female",color:rn,keys:["B14002_028E...B14002_049E"]},labels:["Enrolled in nursery school preschool","Enrolled in nursery school preschool, Public school","Enrolled in nursery school preschool, Private school","Enrolled in kindergarten","Enrolled in kindergarten, Public School","Enrolled in kindergarten, Private School","Enrolled in grade 1 to grade 4","Enrolled in grade 1 to grade 4, Public School","Enrolled in grade 1 to grade 4, Private School","Enrolled in grade 5 to grade 8","Enrolled in grade 5 to grade 8, Public School","Enrolled in grade 5 to grade 8, Private School","Enrolled in grade 9 to grade 12","Enrolled in grade 9 to grade 12, Public School","Enrolled in grade 9 to grade 12, Private School","Enrolled in college undergraduate years","Enrolled in college undergraduate years, Public School","Enrolled in college undergraduate years, Private School","Enrolled in graduate or professional school","Enrolled in graduate or professional school, Public School","Enrolled in graduate or professional school, Private School"]},{title:"Median Earnings by Sex by Educational Attainment Ages 25 and Over",type:"CensusCompareBarChart",showCompareGeoid:!1,yFormat:"$,d",marginLeft:200,left:{key:"Male",color:an,keys:["B20004_008E...B20004_012E"]},right:{key:"Female",color:rn,keys:["B20004_014E...B20004_018E"]},labels:["Less than high school graduate","High school graduate","Some college or associate's degree","EBachelor's degree","Graduate or professional degree"]},{type:"TextBox",header:"ELSi from the National Center for Education Statistics",subheader:"Data Downloads",body:"The Elementary/Secondary Information System (ElSi) is an NCES web application that allows users to quickly view public and private school data and create custom tables and charts using data from the Common Core of Data (CCD) and Private School Survey (PSS). ElSi utilizes variables that are frequently requested by users for producing tables. It is a fast, easy way to obtain basic statistical data on U.S. schools. When generating custom tables, ElSi allows the user to choose row variables, column variables and filters to refine the data included in tables produced. Data includes School Attendance Rates Kindergarten Readiness, Absenteeism K-3, Dropouts, Grade 3 Pass Rates, Grade 3 Reading, Public High School Graduation Rates, Participation in Free Lunch, and more.",link:"https://nces.ed.gov/ccd/elsi/",layout:{h:8,w:12}}],W7=[{type:"CensusStatBox",censusKeys:["B01003_001E"],showCompareYear:!0,title:"Population",layout:{w:3,h:6}},{id:"2",type:"CensusStatBox",title:"Median Age",showCompareYear:!0,showColors:!1,censusKeys:["B01002_001E"],maximumFractionDigits:0,demographics:!0,layout:{w:3,h:6,x:0}},{type:"CensusMap",title:"Population",censusKeys:["B01003_001E"],layout:{h:12,w:9,x:3}},{type:"CensusCompareBarChart",broadCensusKey:"B01001",showCompareGeoid:!1,left:{key:"Male",slice:[2,25],color:an},right:{key:"Female",slice:[26,49],color:rn},layout:{h:12},marginLeft:115,labels:["Under Age 5","Ages 5-9","Ages 10-14","Ages 15-17","Ages 18-19","Ages 20","Ages 21","Ages 22-24","Ages 25-29","Ages 30-34","Ages 35-39","Ages 40-44","Ages 45-49","Ages 50-54","Ages 55-59","Ages 60-61","Ages 62-64","Ages 65-66","Ages 67-69","Ages 70-74","Ages 75-79","Ages 80-84","Ages 85 and over"]},{type:"CensusStatBox",title:"Median Household Income",valuePrefix:"$",showCompareYear:!0,censusKeys:["B19013_001E"],layout:{w:3,h:9,x:0}},{type:"CensusLineChart",title:"Median Household Income",censusKeys:["B19013_001E"],marginLeft:75,yFormat:"$,d",legendWidth:175,censusKeyLabels:{B19013_001E:"Median Household Income"},layout:{w:9,h:9}},{type:"CensusStatBox",title:"Poverty Rate",sumType:"pct",censusKeys:["B17001_002E"],divisorKey:"B17001_001E",showCompareYear:!0,valueSuffix:"%",maximumFractionDigits:1,invertColors:!0,layout:{w:3,h:9}},{type:"CensusLineChart",title:"Pct of Population with Income in the Past 12 Months Below Poverty Level",censusKeys:["B17001_002E"],divisorKeys:["B17001_001E"],sumType:"pct",yFormat:",.1%",legendWidth:175,layout:{w:9,h:9}},{title:"Percent Vacant Housing Units",type:"CensusStatBox",sumType:"pct",showCompareYear:!0,invertColors:!0,censusKeys:["B25002_003E"],divisorKey:"B25002_001E",valueSuffix:"%",maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{title:"Vacant Housing Units",type:"CensusStatBox",showCompareYear:!0,invertColors:!0,censusKeys:["B25002_003E"],layout:{w:3,h:6,x:0}},{type:"CensusLineChart",title:"Percent Vacant Housing Units",legendWidth:175,sumType:"pct",yFormat:",.1%",censusKeys:["B25002_003E"],divisorKeys:["B25002_001E"],layout:{w:9,h:12}},{type:"CensusLineChart",title:"Population by Race and Ethnicity",marginLeft:75,censusKeys:["B02008_001E","B02009_001E","B02011_001E","B03002_012E"],censusKeyLabels:{B02008_001E:"White",B02009_001E:"Black or African American",B02011_001E:"Asian",B03002_012E:"Hispanic or Latino"},layout:{w:12,h:9}},{type:"CensusLineChart",title:"Per Capita Income By Race and Ethnicity",marginLeft:75,yFormat:"$,d",censusKeys:["B19301A_001E","B19301B_001E","B19301D_001E","B19301I_001E"],censusKeyLabels:{B19301A_001E:"White",B19301B_001E:"Black or African American Alone",B19301D_001E:"Asian",B19301I_001E:"Hispanic or Latino"}},{type:"CensusRadarGraph",title:"Per Capita Income By Race and Ethnicity",format:"$,d",censusKeys:["B19301A_001E","B19301B_001E","B19301C_001E","B19301D_001E","B19301E_001E","B19301F_001E","B19301H_001E","B19301I_001E"],censusKeyLabels:{B19301A_001E:"White",B19301B_001E:"Black or African American Alone",B19301C_001E:"American Indian and Alaska Native",B19301D_001E:"Asian",B19301E_001E:"Native Hawaiian and Other Pacific Islander",B19301F_001E:"Some Other Race Alone",B19301H_001E:"White Alone, Not Hispanic or Latino",B19301I_001E:"Hispanic or Latino"}},{type:"TextBox",header:"ALICE from United Way",subheader:"Reports, Visualizations, and Data Downloads",body:"The ALICE (Asset Limited, Income Constrained, Employed) Project was initiated by United Way of Northern New Jersey several years ago to bring focus to the families and individuals who work but whose salaries do not provide sufficient resources to meet basic needs. The ALICE Project developed a methodology using publicly available census, employment, wage, cost of living and other data to help to understand the extent of ALICE in our communities, those who are above the federal poverty level, but below a sustainable wage.",link:"https://www.unitedforalice.org/new-york",layout:{h:6}}],G7=[{type:"TextBox",header:"HOUSING",body:"Housing is an important asset to our region. Old and new developments offer a diverse mix of styles, materials and landscapes that make the region an attractive place to call home. ",layout:{h:3,w:12}},{title:"Total Housing Units",type:"CensusStatBox",yearPosition:"block",censusKeys:["B25002_001E"],showCompareYear:!0,layout:{w:3,h:8}},{title:"Total Housing Units",type:"CensusLineChart",sumType:"sum",showCompare:!0,marginLeft:100,censusKeys:["B25002_001E"],groupBy:"geoids",layout:{w:9,h:8}},{title:"Vacant Housing Units - Includes For Sale Vacant, Sold Vacant, and Other Vacant",type:"CensusStatBox",censusKeys:["B25004_004E","B25004_005E","B25004_008E"],showCompareYear:!0,invertColors:!0,layout:{w:3,h:6}},{title:"Percent Vacant Housing Units - Includes All Vacancy Types",type:"CensusLineChart",sumType:"pct",censusKeys:["B25002_003E"],divisorKey:"B25002_001E",marginLeft:100,layout:{w:9,h:9}},{title:"Percent Vacant Housing Units - Includes For Sale Vacant, Sold Vacant, and Other Vacant",type:"CensusStatBox",sumType:"pct",censusKeys:["B25004_004E","B25004_005E","B25004_008E"],divisorKey:"B25002_001E",valueSuffix:"%",showCompareYear:!0,invertColors:!0,maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{title:"Units for Rent",type:"CensusStatBox",censusKeys:["B25004_002E"],showCompareYear:!0,showColors:!1,layout:{w:3,h:6,x:0}},{type:"CensusLineChart",title:"Vacancy Status",showCompare:!1,censusKeys:["B25004_002E","B25004_003E","B25004_004E","B25004_005E","B25004_006E","B25004_007E","B25004_008E"],layout:{w:9,h:9},legendWidth:325},{title:"Percent Homeowners 65 and Older",type:"CensusStatBox",sumType:"pct",censusKeys:["B25007_009E","B25007_010E","B25007_011E"],divisorKey:"B25007_001E",valueSuffix:"%",showCompareYear:!0,showColors:!1,maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{title:"Percent Homeowners 65 and Older",type:"CensusBarChart",censusKeys:["B25007_009E","B25007_010E","B25007_011E"],layout:{w:9,h:12}},{title:"Homeowners 65 and Older",type:"CensusStatBox",censusKeys:["B25007_009E","B25007_010E","B25007_011E"],showCompareYear:!0,showColors:!1,layout:{w:3,h:6}},{type:"CensusStatBox",title:"Number of Mortgages with Monthly Owner Costs Above 30%",censusKeys:["B25091_008E","B25091_009E","B25091_010E","B25091_011E","B25091_019E","B25091_020E","B25091_021E","B25091_022E"],showCompareYear:!0,invertColors:!0,layout:{w:3,h:9,x:0}},{type:"CensusCompareBarChart",title:"Homeowner Cost by % of Monthly Income",showCompareGeoid:!1,orientation:"horizontal",marginLeft:140,left:{key:"With Mortgage",keys:["B25091_003E","B25091_004E","B25091_005E","B25091_006E","B25091_007E","B25091_008E","B25091_009E","B25091_010E","B25091_011E"]},right:{key:"Without Mortgage",keys:["B25091_014E","B25091_015E","B25091_016E","B25091_017E","B25091_018E","B25091_019E","B25091_020E","B25091_021E","B25091_022E"]},labels:["Less than 10.0 percent","10.0 to 14.9 percent","15.0 to 19.9 percent","20.0 to 24.9 percent","25.0 to 29.9 percent","30.0 to 34.9 percent","35.0 to 39.9 percent","40.0 to 49.9 percent","50.0 percent or more"],layout:{w:9,h:9}},{type:"CensusCompareBarChart",title:"Tenure by Household Income in the Past 12 Months",showCompareGeoid:!1,marginLeft:140,left:{key:"Owner Occupied",keys:["B25118_003E","B25118_004E","B25118_005E","B25118_006E","B25118_007E","B25118_008E","B25118_009E","B25118_010E","B25118_011E","B25118_012E","B25118_013E"]},right:{key:"Renter Occupied",keys:["B25118_015E","B25118_016E","B25118_017E","B25118_018E","B25118_019E","B25118_020E","B25118_021E","B25118_022E","B25118_023E","B25118_024E","B25118_025E"]},labels:["Less Than $5,000","$5,000 to $9,999","$10,000 to $14,999","$15,000 to $19,999","$20,000 to $24,999","$25,000 to $34,999","$35,000 to $49,999","$50,000 to $74,999","$75,000 to $99,999","$100,000 to $149,999","$150,000 or more"]},{type:"CensusBarChart",title:"Mortgate Status and Selected Monthly Owner Costs",orientation:"horizontal",hideWhenCompact:!0,marginLeft:260,censusKeys:["B25087_003E","B25087_004E","B25087_005E","B25087_006E","B25087_007E","B25087_008E","B25087_009E","B25087_010E","B25087_011E","B25087_012E","B25087_013E","B25087_014E","B25087_015E","B25087_016E","B25087_017E","B25087_018E","B25087_019E"]},{type:"TextBox",header:"US Census Building Permits Survey",subheader:"Data Downloads",body:"This page provides data on the number of new housing units authorized by building permits. Data are available monthly, year- to- date, and annually at the national, state, selected metropolitan area, county and place levels. The data are from the Building Permits Survey.",link:"https://www.census.gov/construction/bps/",layout:{h:7,w:12}}],J7=[{type:"TextBox",header:"ECONOMY",body:"The economic security of individuals and families is essential to achieving the values of American society. For complex reasons, this financial security is beyond the means of many in our community.",layout:{h:5,w:12}},{type:"CensusStatBox",title:"Percent of Population Over 16 Years-old, Not in Labor Force",sumType:"pct",censusKeys:["B23025_007E"],divisorKey:"B23025_001E",showCompareYear:!0,invertColors:!0,valueSuffix:"%",maximumFractionDigits:1,layout:{w:3,h:9}},{type:"CensusBarChart",title:"Employment Status for the Population 16 Years and Over",orientation:"horizontal",marginLeft:250,legendPosition:"bottom-right",censusKeys:["B23025_001E...B23025_007E"],hideWhenCompact:!0,layout:{w:9,h:9}},{type:"CensusStatBox",title:"Percent of Labor Force Unemployed (census proxy for unemployment rate)",sumType:"pct",censusKeys:["B23025_005E"],divisorKey:"B23025_002E",showCompareYear:!0,valueSuffix:"%",invertColors:!0,maximumFractionDigits:1,layout:{w:3,h:9}},{type:"CensusCompareBarChart",title:"Labor Force Participation",showCompareGeoid:!1,orientation:"horizontal",marginLeft:275,layout:{w:9,h:9},left:{key:"Male",color:an,keys:["C23002A_004E...C23002A_009E","C23002A_011E...C23002A_014E"]},right:{key:"Female",color:rn,keys:["C23002A_017E...C23002A_022E","C23002A_024E...C23002A_027E"]},labels:["16 to 64 years In labor force","16 to 64 years In labor force In Armed Forces","16 to 64 years In labor force Civilian","16 to 64 years In labor force Civilian Employed","16 to 64 years In labor force Civilian Unemployed","16 to 64 years Not in labor force","65 years and over In labor force","65 years and over In labor force Employed","65 years and over In labor force Unemployed","65 years and over Not in labor force"]},{type:"QCEWStatBox",title:"Annual Average Employment Level",source:["Quarterly Census of Empoloyment and Wages"],dataType:"annual_avg_emplvl",showForGeoidLength:5,showCompareYear:!0,showAllYears:!0,layout:{w:3,h:6}},{type:"QCEWStatBox",valuePrefix:"$",format:"fnum",title:"Total Annual Wages",source:["Quarterly Census of Empoloyment and Wages"],dataType:"total_annual_wages",showForGeoidLength:5,showCompareYear:!0,showAllYears:!0,layout:{x:0,w:3,h:6}},{type:"QCEWStackedBarChart",title:"Annual Average Employment Level",source:["Quarterly Census of Empoloyment and Wages"],dataType:"annual_avg_emplvl",showForGeoidLength:5,showAllYears:!0,layout:{w:9,h:12}},{type:"CensusStackedBarChart",title:"Industries by civilian employed population 16 years and over",layout:{w:12,h:12},stackByYear:!0,stacks:[{title:"Agriculture, forestry, fishing and hunting",censusKey:"S2403_C01_003E",color:"#e41a1c"},{title:"Mining, quarrying, and oil and gas extraction",censusKey:"S2403_C01_004E",color:"#e41a1c"},{title:"Utilities",censusKey:"S2403_C01_011E",color:"#8dd3c7"},{title:"Construction",censusKey:"S2403_C01_005E",color:"#377eb8"},{title:"Manufacturing",censusKey:"S2403_C01_006E",color:"#ffffb3"},{title:"Wholesale trade",censusKey:"S2403_C01_007E",color:"#4daf4a"},{title:"Retail trade",censusKey:"S2403_C01_008E",color:"#bebada"},{title:"Transportation and warehousing",censusKey:"S2403_C01_010E",color:"#984ea3"},{title:"Information",censusKey:"S2403_C01_012E",color:"#fb8072"},{title:"Finance and insurance",censusKey:"S2403_C01_014E",color:"#ff7f00"},{title:"Real estate and rental and leasing",censusKey:"S2403_C01_015E",color:"#80b1d3"},{title:"Professional, scientific, and technical services",censusKey:"S2403_C01_017E",color:"#ffff33"},{title:"Management of companies and enterprises",censusKey:"S2403_C01_018E",color:"#fdb462"},{title:"Administrative and support and waste management services",censusKey:"S2403_C01_019E",color:"#a65628"},{title:"Educational services",censusKey:"S2403_C01_021E",color:"#b3de69"},{title:"Health care and social assistance",censusKey:"S2403_C01_022E",color:"#f781bf"},{title:"Arts, entertainment, and recreation",censusKey:"S2403_C01_024E",color:"#fccde5"},{title:"Accommodation and food services",censusKey:"S2403_C01_025E",color:"#999999"},{title:"Other services, except public administration",censusKey:"S2403_C01_026E",color:"#d9d9d9"},{title:"Public administration",censusKey:"S2403_C01_027E",color:"#d9d9d9"}]},{type:"CensusTreemap",title:"Industries by civilian employed population 16 years and over",layout:{w:12,h:12},tree:{title:"Industries by Occupation",children:[{title:"Agriculture, forestry, fishing and hunting, and mining",color:"#e41a1c",children:[{title:"Agriculture, forestry, fishing and hunting",censusKey:"S2403_C01_003E"},{title:"Mining, quarrying, and oil and gas extraction",censusKey:"S2403_C01_004E"}]},{title:"Construction",color:"#377eb8",children:[{title:"Construction",censusKey:"S2403_C01_005E"}]},{title:"Manufacturing",color:"#ffffb3",children:[{title:"Manufacturing",censusKey:"S2403_C01_006E"}]},{title:"Wholesale trade",color:"#4daf4a",children:[{title:"Wholesale trade",censusKey:"S2403_C01_007E"}]},{title:"Retail trade",color:"#bebada",children:[{title:"Retail trade",censusKey:"S2403_C01_008E"}]},{title:"Transportation and warehousing, and utilities",color:"#984ea3",children:[{title:"Transportation and warehousing",censusKey:"S2403_C01_010E"},{title:"Utilities",color:"#8dd3c7",censusKey:"S2403_C01_011E"}]},{title:"Information",color:"#fb8072",children:[{title:"Information",censusKey:"S2403_C01_012E"}]},{title:"Finance and insurance, and real estate and rental and leasing",color:"#80b1d3",children:[{title:"Finance and insurance",color:"#ff7f00",censusKey:"S2403_C01_014E"},{title:"Real estate and rental and leasing",censusKey:"S2403_C01_015E"}]},{title:"Professional, scientific, and management, and administrative and waste management services",color:"#ffff33",children:[{title:"Professional, scientific, and technical services",censusKey:"S2403_C01_017E"},{title:"Management of companies and enterprises",color:"#fdb462",censusKey:"S2403_C01_018E"},{title:"Administrative and support and waste management services",color:"#a65628",censusKey:"S2403_C01_019E"}]},{title:"Educational services, and health care and social assistance",color:"#b3de69",children:[{title:"Educational services",censusKey:"S2403_C01_021E"},{title:"Health care and social assistance",color:"#f781bf",censusKey:"S2403_C01_022E"}]},{title:"Arts, entertainment, and recreation, and accommodation and food services",color:"#fccde5",children:[{title:"Arts, entertainment, and recreation",censusKey:"S2403_C01_024E"},{title:"Accommodation and food services",color:"#999999",censusKey:"S2403_C01_025E"}]},{title:"Other services",color:"#d9d9d9",children:[{title:"Other services, except public administration",censusKey:"S2403_C01_026E"},{title:"Public administration",censusKey:"S2403_C01_027E"}]}]}},{type:"CensusBarChart",title:"Industry by Median Earnings",orientation:"horizontal",marginLeft:480,yFormat:"$,d",censusKeys:["B24031_001E...B24031_027E"],removeLeading:1,hideWhenCompact:!0,layout:{w:12,h:17}},{type:"CensusTreemap",title:"Occupations by civilian employed population 16 years and over",layout:{w:12,h:12},tree:{title:"Occupations",children:[{title:"Management, business, science, and arts occupations",children:[{title:"Management, business, and financial occupations",censusKey:"S2401_C01_003E"},{title:"Management occupations",censusKey:"S2401_C01_004E"},{title:"Business and financial operations occupations",censusKey:"S2401_C01_005E"},{title:"Computer, engineering, and science occupations",censusKey:"S2401_C01_006E"},{title:"Computer and mathematical occupations",censusKey:"S2401_C01_007E"},{title:"Architecture and engineering occupations",censusKey:"S2401_C01_008E"},{title:"Life, physical, and social science occupations",censusKey:"S2401_C01_009E"},{title:"Education, legal, community service, arts, and media occupations",censusKey:"S2401_C01_010E"},{title:"Community and social service occupations",censusKey:"S2401_C01_011E"},{title:"Legal occupations",censusKey:"S2401_C01_012E"},{title:"Educational instruction, and library occupations",censusKey:"S2401_C01_013E"},{title:"Arts, design, entertainment, sports, and media occupations",censusKey:"S2401_C01_014E"},{title:"Healthcare practitioners and technical occupations",censusKey:"S2401_C01_015E"},{title:"Health diagnosing and treating practitioners and other technical occupations",censusKey:"S2401_C01_016E"},{title:"Health technologists and technicians",censusKey:"S2401_C01_017E"}]},{title:"Service Occupation",children:[{title:"Healthcare support occupations",censusKey:"S2401_C01_019E"},{title:"Protective service occupations",censusKey:"S2401_C01_020E"},{title:"Firefighting and prevention, and other protective service workers including supervisors",censusKey:"S2401_C01_021E"},{title:"Law enforcement workers including supervisors",censusKey:"S2401_C01_022E"},{title:"Food preparation and serving related occupations",censusKey:"S2401_C01_023E"},{title:"Building and grounds cleaning and maintenance occupations",censusKey:"S2401_C01_024E"},{title:"Personal care and service occupations",censusKey:"S2401_C01_025E"}]},{title:"Sales and Office Occupations",children:[{title:"Sales and related occupations",censusKey:"S2401_C01_027E"},{title:"Office and administrative support occupations",censusKey:"S2401_C01_028E"}]},{title:"Natural resources, construction, and maintenance occupations",children:[{title:"Farming, fishing, and forestry occupations",censusKey:"S2401_C01_030E"},{title:"Construction and extraction occupations",censusKey:"S2401_C01_031E"},{title:"Installation, maintenance, and repair occupations",censusKey:"S2401_C01_032E"}]},{title:"Production, transportation, and material moving occupations",children:[{title:"Production occupations",censusKey:"S2401_C01_034E"},{title:"Transportation occupations",censusKey:"S2401_C01_035E"},{title:"Material moving occupations",censusKey:"S2401_C01_036E"}]}]}},{type:"TextBox",header:"Upstate Alliance for the Creative Economy",subheader:"Data, Reports",body:"",link:"http://www.upstatecreative.org/",layout:{h:5,w:12}},{type:"TextBox",header:"Center for Economic Growth (CEG) - Economic Scorecard",subheader:"Reports and Visualizations",body:"CEG’s Capital Region Economic Scorecards are a quarterly feature of the organization’s newsletter, The CEG Indicator, and are oﬀered exclusively to our investors. These scorecards track 30 mostly local economic indicators to provide our investors with insights into the health of the region’s economy and the direction in which it is headed. There are ﬁve scorecards: Quarterly Performance Overview; Economic Conditions, Manufacturing, Consumer and Transportation.",link:"http://go.ceg.org/l/189672/2019-07-24/l2gpl6",layout:{h:7,w:12}}],q7=[{type:"TextBox",header:"HEALTH",body:"This section takes a population-based approach to our region's health by exploring access to health care, and will one day include indicators measuring the prevalence of selected diseases, mortality rates and behavioral health.",layout:{h:5,w:12}},{type:"CensusStatBox",title:"Covered by Health Insurance",censusKeys:["B27001_004E","B27001_007E","B27001_010E","B27001_013E","B27001_016E","B27001_019E","B27001_022E","B27001_025E","B27001_028E","B27001_032E","B27001_035E","B27001_038E","B27001_041E","B27001_044E","B27001_047E","B27001_050E","B27001_053E","B27001_056E"],showCompareYear:!0,maximumFractionDigits:1,layout:{w:3,h:6}},{type:"CensusStatBox",title:"Percent Health Coverage",sumType:"pct",censusKeys:["B27001_004E","B27001_007E","B27001_010E","B27001_013E","B27001_016E","B27001_019E","B27001_022E","B27001_025E","B27001_028E","B27001_032E","B27001_035E","B27001_038E","B27001_041E","B27001_044E","B27001_047E","B27001_050E","B27001_053E","B27001_056E"],divisorKey:"B27001_001E",showCompareYear:!0,valueSuffix:"%",maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{type:"CensusBarChart",title:"Age by Disability Status by Health Insurance Coverage Status",hideWhenCompact:!0,censusKeys:["B18135_004E","B18135_005E","B18135_006E","B18135_007E","B18135_009E","B18135_010E","B18135_011E","B18135_012E","B18135_015E","B18135_016E","B18135_017E","B18135_018E","B18135_020E","B18135_021E","B18135_022E","B18135_023E","B18135_026E","B18135_027E","B18135_028E","B18135_029E","B18135_031E","B18135_032E","B18135_033E","B18135_034E"],censusKeyLabels:{B18135_004E:"< 19 years, w/ disability, Total health insurance coverage",B18135_005E:"< 19 years, w/ disability, Private health insurance coverage",B18135_006E:"< 19 years, w/ disability, Public health insurance coverage",B18135_007E:"< 19 years, w/ disability, No health insurance coverage",B18135_009E:"< 19 years, No disability, Total insurance coverage",B18135_010E:"< 19 years, No disability, Private health insurance coverage",B18135_011E:"< 19 years, No disability, Public health insurance coverage",B18135_012E:"< 19 years, No disability, No health insurance coverage",B18135_015E:"19-64 years, w/ disability, Total health insurance coverage",B18135_016E:"19-64 years, w/ disability, Private health insurance coverage",B18135_017E:"19-64 years, w/ disability, Public health insurance coverage",B18135_018E:"19-64 years, w/ disability, No health insurance coverage",B18135_020E:"19-64 years, No disability, Total health insurance coverage",B18135_021E:"19-64 years, No disability, Private health insurance coverage",B18135_022E:"19-64 years, No disability, Public health insurance coverage",B18135_023E:"19-64 years, No disability, No health insurance coverage",B18135_026E:"65+, w/ disability, Total health insurance coverage",B18135_027E:"65+, w/ disability, Private health insurance coverage",B18135_028E:"65+, w/ disability, Public health insurance coverage",B18135_029E:"65+, w/ disability, No health insurance coverage",B18135_031E:"65+, No disability, Total health insurance coverage",B18135_032E:"65+, No disability, Private health insurance coverage",B18135_033E:"65+, No disability, Public health insurance coverage",B18135_034E:"65+, No disability, No health insurance coverage"},orientation:"horizontal",marginLeft:350,layout:{w:9,h:12}},{type:"CensusStatBox",title:"Veterans",censusKeys:["B21001_002E"],showCompareYear:!0,showColors:!1,maximumFractionDigits:1,layout:{w:3,h:9}},{type:"CensusCompareBarChart",title:"Civilian Population 18 Years and Over",showCompareGeoid:!1,orientation:"horizontal",marginLeft:175,layout:{w:9,h:9},left:{key:"Male",color:an,keys:["B21001_007E...B21001_021E"]},right:{key:"Female",color:rn,keys:["B21001_025E...B21001_039E"]},labels:["Total 18-34","18-34 years, veteran","18-34 years, non-veteran","Total 35-54 years","35-54 years, veteran","35-54 years, non-veteran","Total 55-64 years","55-64 years, veteran","55-64 years, non-veteran","Total 65-74 years","65-74 years, veteran","65-74 years, non-veteran","Total 75 years and over","75 years and over, veteran","75 years and over, non-veteran"]},{type:"TextBox",header:"New York State Community Health Indicator Reports (CHIRS)",subheader:"Data, Reports, and Visualizations",body:"The New York State Community Health Indicator Reports (CHIRS) were developed in 2012, and are annually updated to consolidate and provide information regarding health indicators in the County Health Assessment Indicators (CHAI) for all communities in New York. Data previously provided in these reports have now been incorporated into the CHIRS Dashboard and are displayed in enhanced, more interactive data views. The CHIRS Dashboard tracks about 350 indicators organized by 15 health topics, and is updated annually to include the most recent year of data available for these indicators. Additionally, each of 62 counties in NYS has their own dashboard which allows for comparison of each county's data in relationship to that county's region and NYS totals, and includes at-a-glance comparisons of the two most recent data points. Visualizations include tables, maps, charts, and graphs at the state and county levels. This dashboard is a key resource for assessing county trends and can assist in tracking intervention progress.",link:"https://www.health.ny.gov/statistics/chac/indicators/",layout:{h:9,w:12}}],K7=Wg(q7),Y7=[{type:"TextBox",header:"TRANSPORTATION",body:"This section provides indicators on how the labor force in our region commutes to work and on car ownership.",layout:{h:3,w:12}},{type:"CensusStatBox",title:"Total Bike-Ped ",censusKeys:["B08006_014E","B08006_015E"],amount:!0,showCompareYear:!0,maximumFractionDigits:1,layout:{w:3,h:6}},{type:"CensusStatBox",title:"Bike-Ped as a Percent of Total Commuters",sumType:"pct",showCompareYear:!0,censusKeys:["B08006_014E","B08006_015E"],divisorKey:"B23025_001E",valueSuffix:"%",maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{type:"CensusBarChart",title:"Means of Transportation to Work",hideWhenCompact:!0,censusKeys:["B08006_002E","B08006_003E","B08006_004E","B08006_005E","B08006_006E","B08006_007E","B08006_008E","B08006_009E","B08006_014E","B08006_015E","B08006_016E","B08006_017E"],orientation:"horizontal",marginLeft:300,layout:{w:9,h:12}},{type:"CensusStatBox",title:"Total Public Transportation ",censusKeys:["B08006_008E"],showCompareYear:!0,amount:!0,maximumFractionDigits:1,layout:{w:3,h:6}},{type:"CensusStatBox",title:"Public Transportation as a Percent of Total Commuters",sumType:"pct",showCompareYear:!0,censusKeys:["B08006_008E"],divisorKey:"B23025_001E",valueSuffix:"%",maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{title:"Means of Transportation to Work by Sex",hideWhenCompact:!0,type:"CensusCompareBarChart",showCompareGeoid:!1,marginLeft:340,left:{key:"Male",color:an,keys:["B08006_019E","B08006_020E","B08006_021E","B08006_022E","B08006_023E","B08006_024E","B08006_025E","B08006_016E","B08006_031E","B08006_032E","B08006_033E","B08006_034E"]},right:{key:"Female",color:rn,keys:["B08006_036E","B08006_037E","B08006_038E","B08006_039E","B08006_040E","B08006_041E","B08006_042E","B08006_043E","B08006_048E","B08006_049E","B08006_050E","B08006_051E"]},labels:["Car, Truck or Van","Car, Truck or Van, Drove Alone","Car, Truck or Van, Carpooled","Car, Truck or Van, 2-Person Carpool","Car, Truck or Van, 3-Person Carpool","Car, Truck or Van, 4-Person Carpool","Public Transportation (Excluding Taxi)","Public Transportation (Excluding Taxi), Bus or Trolley Bus","Bicycle","Walked","Taxicab, Motorcycle, or Other","Worked at Home"],layout:{w:9,h:12}},{type:"CensusStatBox",title:"Total No Vehicle Available",censusKeys:["B08541_002E"],showCompareYear:!0,amount:!0,maximumFractionDigits:1,layout:{w:3,h:6}},{type:"CensusBarChart",title:"Vehicle Availability",censusKeys:["B08541_002E","B08541_003E","B08541_004E","B08541_005E"],layout:{w:9,h:6}},{type:"CensusStatBox",title:"Total Worked at Home ",censusKeys:["B08006_017E"],showCompareYear:!0,amount:!0,maximumFractionDigits:1,layout:{w:3,h:6}},{type:"CensusStatBox",title:"Work at Home as a Percent of Total Commuters",sumType:"pct",showCompareYear:!0,censusKeys:["B08006_017E"],divisorKey:"B08006_001E",valueSuffix:"%",maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{type:"CensusLineChart",title:"Means of Transportation to Work",censusKeys:["B08006_003E","B08006_004E","B08006_008E","B08006_014E","B08006_015E","B08006_017E"],marginLeft:100,layout:{w:9,h:12}},{type:"CensusStatBox",title:"Total Drove Alone ",censusKeys:["B08006_003E"],showCompareYear:!0,amount:!0,maximumFractionDigits:1,layout:{w:3,h:6}},{type:"CensusStatBox",title:"Drove Alone as a Percent of Total Commuters",sumType:"pct",showCompareYear:!0,censusKeys:["B08006_003E"],divisorKey:"B23025_001E",valueSuffix:"%",maximumFractionDigits:1,layout:{w:3,h:6,x:0}},{type:"CensusBarChart",title:"Travel Time to Work",censusKeys:["B08303_002E...B08303_013E"],orientation:"horizontal",marginLeft:130,layout:{w:9,h:12}},{type:"CensusBarChart",title:"Travel Time to Work by Mode",hideWhenCompact:!0,censusKeys:["B08134_012E","B08134_013E","B08134_014E","B08134_015E","B08134_016E","B08134_017E","B08134_018E","B08134_019E","B08134_020E","B08134_022E","B08134_023E","B08134_024E","B08134_025E","B08134_026E","B08134_027E","B08134_028E","B08134_029E","B08134_030E","B08134_032E","B08134_033E","B08134_034E","B08134_035E","B08134_036E","B08134_037E","B08134_038E","B08134_039E","B08134_062E","B08134_063E","B08134_064E","B08134_065E","B08134_066E","B08134_067E","B08134_068E","B08134_069E","B08134_070E","B08134_102E","B08134_103E","B08134_104E","B08134_105E","B08134_106E","B08134_107E","B08134_108E","B08134_109E","B08134_110E","B08134_112E","B08134_113E","B08134_114E","B08134_115E","B08134_116E","B08134_117E","B08134_118E","B08134_119E","B08134_120E"],labels:["Car, Truck, or Van: Less than 10 minutes","Car, Truck, or Van: 15 to 19 minutes","Car, Truck, or Van: 20 to 24 minutes","Car, Truck, or Van: 25 to 29 minutes","Car, Truck, or Van: 30 to 34 minutes","Car, Truck, or Van: 35 to 44 minutes ","Car, Truck, or Van: 45 to 59 minutes","Car, Truck, or Van: 60 or more minutes","Drove Alone: Less than 10 minutes","Drove Alone: 15 to 19 minutes","Drove Alone: 20 to 24 minutes","Drove Alone: 25 to 29 minutes","Drove Alone: 30 to 34 minutes","Drove Alone: 35 to 44 minutes ","Drove Alone: 45 to 59 minutes","Drove Alone: 60 or more minutes","Carpooled: Less than 10 minutes","Carpooled: 15 to 19 minutes","Carpooled: 20 to 24 minutes","Carpooled: 25 to 29 minutes","Carpooled: 30 to 34 minutes","Carpooled: 35 to 44 minutes ","Carpooled: 45 to 59 minutes","Carpooled: 60 or more minutes","Public Transportation: Less than 10 minutes","Public Transportation: 15 to 19 minutes","Public Transportation: 20 to 24 minutes","Public Transportation: 25 to 29 minutes","Public Transportation: 30 to 34 minutes","Public Transportation: 35 to 44 minutes ","Public Transportation: 45 to 59 minutes","Public Transportation: 60 or more minutes","Walked: Less than 10 minutes","Walked: 15 to 19 minutes","Walked: 20 to 24 minutes","Walked: 25 to 29 minutes","Walked: 30 to 34 minutes","Walked: 35 to 44 minutes ","Walked: 45 to 59 minutes","Walked: 60 or more minutes","Taxicab, motorcycle, bicycle, or other means: Less than 10 minutes","Taxicab, motorcycle, bicycle, or other means: 15 to 19 minutes","Taxicab, motorcycle, bicycle, or other means: 20 to 24 minutes","Taxicab, motorcycle, bicycle, or other means: 25 to 29 minutes","Taxicab, motorcycle, bicycle, or other means: 30 to 34 minutes","Taxicab, motorcycle, bicycle, or other means: 35 to 44 minutes ","Taxicab, motorcycle, bicycle, or other means: 45 to 59 minutes","Taxicab, motorcycle, bicycle, or other means: 60 or more minutes"],orientation:"horizontal",marginLeft:350,layout:{w:12,h:18}},{type:"CensusCompareBarChart",title:"Travel Time to Work by Sex",showCompareGeoid:!1,left:{key:"Male",color:an,keys:["B08412_015E...B08412_026E"]},right:{key:"Female",color:rn,keys:["B08412_028E...B08412_039E"]},marginLeft:130,labels:["Less Than 5 Minutes","5 to 9 Minutes","10 to 14 Minutes","15 to 19 Minutes","20 to 24 Minutes","25 to 29 Minutes","30 to 34 Minutes","35 to 39 Minutes","40 to 44 Minutes","45 to 59 Minutes","60 to 89 Minutes","90 or More Minutes"]},{type:"CensusBarChart",title:"Travelled by Public Transportation to Work by Earnings",censusKeys:["B08119_028E...B08119_036E"],orientation:"horizontal",marginLeft:330},{type:"CensusBarChart",title:"Walked to Work by Earnings",censusKeys:["B08119_037E...B08119_045E"],orientation:"horizontal",marginLeft:175},{type:"CensusBarChart",title:"Walked to Work by Age",censusKeys:["B08101_033E...B08101_040E"],orientation:"horizontal",marginLeft:175}],Z7=[{type:"ZCTAList",title:"ZIP Code Tabulation Areas (ZCTA)",layout:{w:12,h:9,x:0}},{type:"UNSDList",title:"Unified School Districts",layout:{w:12,h:9,x:0}}],pm={Overview:W7,Economy:J7,"Social Welfare":z7,Health:K7,Education:U7,Housing:G7,Transportation:Y7,Links:Z7},ms=Object.keys(pm).reduce((t,s,n)=>(t[s]=pm[s].map((r,a)=>(r.graphId=`${s}-${a}`,r.id=r.id||`local-profile-${r.type}-${r.title||r.broadCensusKey||r.header}`,r.id=r.id.replace(/\s/g,"_"),r)),t),{});function Yi(t,s){var r;const n={[s]:ms[s]};return hl(n,{geoid:{length:(r=t==null?void 0:t.toString())==null?void 0:r.length}})[s]}function X7(t,s,n,r,a,l,i,c){const d=(h,f,g)=>{const x=C(t,["acs",h,f,g],-666666666);return x===-666666666?0:x};let u=c.reduce((h,f)=>h+s.reduce((g,x)=>g+d(f,l,x),0),0);const p=c.reduce((h,f)=>h+n.reduce((g,x)=>g+d(f,l,x),0),0);if(u-=p,r==="avg")u/=c.length;else if(r==="pct"){let h=c.reduce((f,g)=>f+a.reduce((x,y)=>x+d(g,l,y),0),0);u/=h,u*=100}if(!u)return{value:"",change:""};let m=0;if(i){let h=c.reduce((g,x)=>g+s.reduce((y,j)=>y+d(x,i,j),0),0),f=c.reduce((g,x)=>g+n.reduce((y,j)=>y+d(x,i,j),0),0);if(h-=f,r==="pct"){let g=c.reduce((x,y)=>x+a.reduce((j,N)=>j+d(y,l,N),0),0);h/=g,h*=100}m=(u-h)/h*100,m=isNaN(m)?0:+m.toFixed(2)}return{value:u,change:m}}async function qg({geoid:t,category:s,title:n},r){const a=Yi(t,s).filter(_=>_.type==="CensusStatBox").find(_=>_.title===n);if(!a)return console.log("config",n,Yi(t,s).filter(_=>_.type==="CensusStatBox")),{};const{censusKeys:l=[],divisorKeys:i=[],subtractKeys:c=[],sumType:d,invertColors:u,valuePrefix:p,valueSuffix:m,maximumFractionDigits:h}=a,f=2016,g=2021,x=[g,f];await r.get(["acs",[t,void 0].filter(Boolean),x,[...l,...i,...c]],["acs","meta",[...l,...i,...c],"label"]);const{value:j,change:N}=X7(r.getCache(),l,c,d,i,g,f,[t]);return{geoid:t,value:j,change:N,year:g,compareYear:f,title:n,category:s,invertColors:u,valuePrefix:p,valueSuffix:m,maximumFractionDigits:h}}const Kg=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const[l,i]=b.useState(!0),[c,d]=b.useState(a==null?void 0:a.status),[u,p]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[m,h]=b.useState(a.category||"Housing"),[f,g]=b.useState([]),[x,y]=b.useState(a.title||"Total Housing Units");return b.useEffect(()=>{const j=Yi(u,m).filter(N=>N.type==="CensusStatBox").map(N=>N.title);g(j),y(j.includes(x)?x:j[0])},[m,u]),b.useEffect(()=>{async function j(){if(u)d(void 0);else return d("Please Select a Geography"),Promise.resolve();i(!0),d(void 0);const N=await qg({geoid:u,category:m,title:x},n);s(JSON.stringify(N)),i(!1)}j()},[u,m,x]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(rt,{value:u,onChange:p,className:"flex-row-reverse"}),e.jsx(ze,{label:"Category:",type:m,setType:h,types:Object.keys(ms).filter(j=>ms[j].find(N=>N.type==="CensusStatBox"))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Attribute:"}),e.jsx("select",{className:"bg-white w-full pl-3 rounded-md my-1",onChange:j=>y(j.target.value),value:x,children:f.map(j=>e.jsx("option",{value:j,children:j},j))})]})]}),l?e.jsx(dt,{}):c?e.jsx("div",{className:"p-5 text-center",children:c}):e.jsx(zg,{title:x,value:a.value,change:a.change,year:a.year,compareYear:a.compareYear,invertColors:a.invertColors,valuePrefix:a.valuePrefix,valueSuffix:a.valueSuffix,maximumFractionDigits:a.maximumFractionDigits})]})})};Kg.settings={hasControls:!0,name:"ElementEdit"};const Q7=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(zg,{...s,baseUrl:"/"})})},ek={name:"Card: Census",type:"Hero Stats",variables:[{name:"geoid",default:"36"},{name:"category",default:"Housing",hidden:!0},{name:"title",default:"Total Housing Units",hidden:!0}],getData:qg,EditComp:Kg,ViewComp:Q7},Yg=({title:t,data:s=[],geoid:n})=>{const r=Math.max(...s.map(a=>a[n]));return e.jsxs(e.Fragment,{children:[e.jsx("label",{children:t}),e.jsx(ba,{data:s,keys:[n],indexBy:"id",xScale:{domain:s.map(a=>a.id)},axisBottom:{tickDensity:3,axisColor:"#000",axisOpacity:0,rotateDeg:-90},yScale:{domain:[0,r]},axisLeft:{format:a=>Qe(a,0),gridLineOpacity:0,showGridLines:!0,ticks:5,axisColor:"#000",axisOpacity:0},paddingInner:.1,hoverComp:{HoverComp:Cr,valueFormat:Qe}},"id")]})};function Zi(t,s){var r;const n={[s]:ms[s]};return hl(n,{geoid:{length:(r=t==null?void 0:t.toString())==null?void 0:r.length}})[s]}const tk=(t,s)=>s.censusKeys.reduce((n,r)=>(n.push([...s.geoids,s.compareGeoid].filter(a=>!!a).reduce((a,l,i)=>{const c=C(s,"year",2017),d=+C(t,["acs",l,c,r],-666666666);return d!==-666666666&&(a[l]=d,++a.num),a},{id:r,num:0})),n),[]).filter(n=>n.num>0),sk=(t,s)=>[...s.geoids,s.compareGeoid].filter(n=>!!n).reduce((n,r)=>{const a=C(s,"divisorKeys",[]),l=C(s,"subtractKeys",[]);if(a.length||l.length){let i=s.censusKeys.reduce((u,p,m)=>{const h=C(s,"year",2017),f=+C(t,["acs",r,h,p],0);return f!==-666666666&&(u+=f),u},0);const c=l.reduce((u,p,m)=>{const h=C(s,"year",2017),f=+C(t,["acs",r,h,p],0);return f!==-666666666&&(u+=f),u},0);i-=c;const d=a.reduce((u,p,m)=>{const h=C(s,"year",2017),f=+C(t,["acs",r,h,p],0);return f!==-666666666&&(u+=f),u},0);n.push({id:r,value:d===0?i:i/d,num:1,geoid:r})}else n.push(s.censusKeys.reduce((i,c,d)=>{const u=C(s,"year",2017),p=+C(t,["acs",r,u,c],0);return p!==-666666666&&(i[c]=p,++i.num),i},{id:r,num:0,geoid:r}));return n},[]).filter(n=>n.num>0),nk=(t,s)=>C(s,"groupBy","censusKeys")==="censusKeys"?tk(t,s):sk(t,s);async function Zg({geoid:t,category:s,title:n},r){var x;const a=Zi(t,s).filter(y=>y.type==="CensusBarChart").find(y=>y.title===n);if(!a)return console.log("config",n,Zi(t,s)),{};const{censusKeys:l=[],divisorKeys:i=[],subtractKeys:c=[],groupBy:d}=a,u=2016,p=2021,m=[p,u];await r.get(["acs",[t,void 0].filter(Boolean),m,[...l,...i,...c]],["acs","meta",[...l,...i,...c],"label"]);const f=nk(r.getCache(),{...a,geoids:[t],year:p}),g=(x=r.getCache())==null?void 0:x.acs;return{geoid:t,year:p,data:f.map(y=>{var j;return{...y,id:((j=a==null?void 0:a.censusKeyLabels)==null?void 0:j[y.id.split("-")[1]])||Jg(y.id.includes("-")?y.id.split("-")[1]:y.id,g)||y.id}}),title:n,category:s}}const Xg=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const[l,i]=b.useState(!0),[c,d]=b.useState(a==null?void 0:a.status),[u,p]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[m,h]=b.useState(a.category||"Housing"),[f,g]=b.useState([]),[x,y]=b.useState(a.title||"Percent Homeowners 65 and Older");return b.useEffect(()=>{const j=Zi(u,m).filter(N=>N.type==="CensusBarChart").map(N=>N.title);g(j),y(j.includes(x)?x:j[0])},[m,u]),b.useEffect(()=>{async function j(){if(u)d(void 0);else return d("Please Select a Geography"),Promise.resolve();i(!0),d(void 0);const N=await Zg({geoid:u,category:m,title:x},n);s(JSON.stringify(N)),i(!1)}j()},[u,m,x]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(rt,{value:u,onChange:p,className:"flex-row-reverse"}),e.jsx(ze,{label:"Category:",type:m,setType:h,types:Object.keys(ms).filter(j=>ms[j].find(N=>N.type==="CensusBarChart"))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Attribute:"}),e.jsx("select",{className:"bg-white w-full pl-3 rounded-md my-1",onChange:j=>y(j.target.value),value:x,children:f.map(j=>e.jsx("option",{value:j,children:j},j))})]})]}),l?e.jsx(dt,{}):c?e.jsx("div",{className:"p-5 text-center",children:c}):e.jsx(Yg,{title:a.title,geoid:u,data:a.data,year:a.year,compareYear:a.compareYear})]})})};Xg.settings={hasControls:!0,name:"ElementEdit"};const ak=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(Yg,{...s,baseUrl:"/"})})},rk={name:"Graph: Census Bar",type:"Hero Stats",variables:[{name:"geoid",default:"36"},{name:"category",default:"Housing",hidden:!0},{name:"title",default:"Percent Homeowners 65 and Older",hidden:!0}],getData:Zg,EditComp:Xg,ViewComp:ak},ok=({colors:t,labels:s})=>{var n;return e.jsx("div",{children:(n=Object.keys(t))==null?void 0:n.map(r=>e.jsxs("div",{className:"flex flex-row items-center space-between",children:[e.jsx("div",{className:"w-[10px] h-[10px] rounded-full",style:{backgroundColor:t[r]}}),e.jsx("label",{className:"text-sm ml-2",children:s[r]})]},r))})},Qg=({title:t,data:s=[],keys:n=[],geoid:r})=>{var c,d;const a=Math.max(...s.reduce((u,p)=>[...u,n.reduce((m,h)=>m+ +p[h],0)],[])),l=(c=s[0])==null?void 0:c.keyMap,i=(d=s[0])==null?void 0:d.colorMap;return e.jsxs("div",{children:[e.jsx("label",{children:t}),e.jsxs("div",{className:"flex flex-row h-[500px]",children:[e.jsx(ba,{data:s,keys:n,indexBy:"index",xScale:{domain:s.map(u=>u.index)},axisBottom:{tickDensity:3,axisColor:"#000",axisOpacity:0},yScale:{domain:[0,a]},axisLeft:{format:u=>Qe(u,0),gridLineOpacity:0,showGridLines:!0,ticks:5,axisColor:"#000",axisOpacity:0},paddingInner:.1,colors:(u,p,m,h)=>i[h],hoverComp:{HoverComp:Cr,valueFormat:Qe,keyFormat:u=>(l==null?void 0:l[u])||u},groupMode:"stacked"},"index"),e.jsx(ok,{colors:i,labels:l})]})]})};function Xi(t,s){var r;const n={[s]:ms[s]};return hl(n,{geoid:{length:(r=t==null?void 0:t.toString())==null?void 0:r.length}})[s]}const lk=(t,s)=>{const[n]=s.geoids;let r=[],a=[];if(s.stackByYear&&s.stacks){const l=s.years;a=s.stacks.map((i,c)=>`key-${c}`),r=l.map(i=>{const c={index:String(i),keyMap:{},ckMap:{},colorMap:{}};return s.stacks.reduce((d,u,p)=>{const m=+C(t,["acs",n,i,u.censusKey],-666666666);if(m!==-666666666){const h=`key-${p}`;d[h]=m,d.keyMap[h]=u.title,d.ckMap[h]=u.censusKey,d.colorMap[h]=u.color||DEFAULT_COLORS[p]}return d},c)})}else{const l=C(s,"year",2017);let i=0;r=C(s,"bars",[]).map(c=>{i=Math.max(i,c.stacks.length);const d={index:c.title,keyMap:{},ckMap:{},colorMap:{}};return c.stacks.reduce((u,p,m)=>{const h=+C(t,["acs",n,l,p.censusKey],-666666666);if(h!==-666666666){const f=`key-${m}`;u[f]=h,u.keyMap[f]=p.title,u.ckMap[f]=p.censusKey,u.colorMap[f]=p.color||c.color||DEFAULT_COLORS[m]}return u},d)});for(let c=0;c<i;++c)a.push(`key-${c}`);r.sort((c,d)=>{const[u,p]=a.reduce((m,h)=>[m[0]+C(c,h,0),m[1]+C(d,h,0)],[0,0]);return u-p})}return{barData:r,keys:a}};async function ex({geoid:t,category:s,title:n},r){var x;const a=Xi(t,s).filter(y=>y.type==="CensusStackedBarChart").find(y=>y.title===n);if(!a)return console.log("config",n,Xi(t,s)),{};const{censusKeys:l=[],censusKeysMoE:i=[],divisorKeys:c=[],divisorKeysMoE:d=[],subtractKeys:u=[],groupBy:p}=a,m=Sa(2010,2021);await r.get(["acs",[t,void 0].filter(Boolean),m,[...l,...i,...c,...d,...u]],["acs","meta",[...l,...c],"label"]);const{barData:f,keys:g}=lk(r.getCache(),{...a,geoids:[t],years:m});return(x=r.getCache())==null||x.acs,{geoid:t,data:f,keys:g,title:n,category:s}}const tx=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const[l,i]=b.useState(!0),[c,d]=b.useState(a==null?void 0:a.status),[u,p]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[m,h]=b.useState(a.category||"Economy"),[f,g]=b.useState([]),[x,y]=b.useState(a.title||"Industries by civilian employed population 16 years and over");return b.useEffect(()=>{const j=Xi(u,m).filter(N=>N.type==="CensusStackedBarChart").map(N=>N.title);g(j),y(j.includes(x)?x:j[0])},[m,u]),b.useEffect(()=>{async function j(){if(u)d(void 0);else return d("Please Select a Geography"),Promise.resolve();i(!0),d(void 0);const N=await ex({geoid:u,category:m,title:x},n);s(JSON.stringify(N)),i(!1)}j()},[u,m,x]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(rt,{value:u,onChange:p,className:"flex-row-reverse"}),e.jsx(ze,{label:"Category:",type:m,setType:h,types:Object.keys(ms).filter(j=>ms[j].find(N=>N.type==="CensusStackedBarChart"))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Attribute:"}),e.jsx("select",{className:"bg-white w-full pl-3 rounded-md my-1",onChange:j=>y(j.target.value),value:x,children:f.map(j=>e.jsx("option",{value:j,children:j},j))})]})]}),l?e.jsx(dt,{}):c?e.jsx("div",{className:"p-5 text-center",children:c}):e.jsx(Qg,{title:a.title,geoid:u,data:a.data,keys:a.keys,year:a.year,compareYear:a.compareYear})]})})};tx.settings={hasControls:!0,name:"ElementEdit"};const ik=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(Qg,{...s,baseUrl:"/"})})},ck={name:"Graph: Census Stacked Bar",type:"Graph",variables:[{name:"geoid",default:"36"},{name:"category",default:"Economy",hidden:!0},{name:"title",default:"Industries by civilian employed population 16 years and over",hidden:!0}],getData:ex,EditComp:tx,ViewComp:ik},hm=["#ff0404","#18e71a","#7a3a00","#192e98","#b804ff","#e7186e","#595959","#185e57"],dk=({data:t,colors:s,getLegendLabel:n})=>e.jsx("div",{children:t==null?void 0:t.map((r,a)=>e.jsxs("div",{className:"flex flex-row items-center space-between",children:[e.jsx("div",{className:"w-[10px] h-[10px] rounded-full",style:{backgroundColor:s[a]}}),e.jsx("label",{className:"text-sm ml-2",children:r.id})]},a))}),sx=({title:t,data:s=[],geoid:n,sumType:r})=>e.jsxs(e.Fragment,{children:[e.jsx("label",{children:t}),e.jsxs("div",{className:"flex flex-row h-[300px]",children:[e.jsx(L8,{data:s,colors:hm,axisBottom:{tickDensity:3,axisColor:"#000",axisOpacity:.1,showGridLines:!0},axisLeft:{format:a=>Qe(a,r==="pct"?2:0),gridLineOpacity:.1,showGridLines:!0,ticks:5,axisColor:"#000",axisOpacity:0}},"id"),e.jsx(dk,{data:s,colors:hm})]})]});function Qi(t,s){var r;const n={[s]:ms[s]};return hl(n,{geoid:{length:(r=t==null?void 0:t.toString())==null?void 0:r.length}})[s]}function uk(t,s){const{censusKeys:n=[],divisorKeys:r=[],subtractKeys:a=[]}=s;return n.map((l,i)=>({id:`${t}-${l}`,geoid:t,censusKey:l,title:s.title,data:s.years.reduce((c,d)=>{let u=C(s,`acs[${t}][${d}][${l}]`,-666666666);if(u===-666666666)return c;let p=0;if(n.length===1?p=a.reduce((m,h)=>{const f=C(s,["acs",t,d,h],-666666666);return f===-666666666?m:m+f},0):p=C(s,`acs[${t}][${d}][${a[i]}]`,0),isNaN(p)||(u-=+p),s.sumType==="pct"){const m=C(s,`acs[${t}][${d}][${r[i]}]`,1);m!==null&&!isNaN(m)&&(u=u/m)}return c.push({x:+d,y:u}),c},[])}))}async function nx({geoid:t,category:s,title:n},r){var g;const a=Qi(t,s).filter(x=>x.type==="CensusLineChart").find(x=>x.title===n);if(!a)return console.log("config",a,n,Qi(t,s)),{};const{censusKeys:l=[],divisorKeys:i=[],subtractKeys:c=[],sumType:d}=a,u=2021,p=Sa(2010,2021);await r.get(["acs",[t,void 0].filter(Boolean),p,[...l,...i,...c]],["acs","meta",[...l,...i,...c],"label"]);const h=uk(t,{...a,...r.getCache(),geoids:[t],years:p}),f=(g=r.getCache())==null?void 0:g.acs;return{geoid:t,year:u,data:h.map(x=>{var y;return{...x,id:((y=a==null?void 0:a.censusKeyLabels)==null?void 0:y[x.id.split("-")[1]])||Jg(x.id.split("-")[1],f)||x.id}}),title:n,category:s,sumType:d}}const ax=({value:t,onChange:s})=>{const{falcor:n,falcorCache:r}=et();let a=t&&tt(t)?JSON.parse(t):{};const[l,i]=b.useState(!0),[c,d]=b.useState(a==null?void 0:a.status),[u,p]=b.useState((a==null?void 0:a.geoid)===""?a==null?void 0:a.geoid:(a==null?void 0:a.geoid)||"36"),[m,h]=b.useState(a.category||"Housing"),[f,g]=b.useState([]),[x,y]=b.useState(a.title||"Percent Homeowners 65 and Older");return b.useEffect(()=>{const j=Qi(u,m).filter(N=>N.type==="CensusLineChart").map(N=>N.title);g(j),y(j.includes(x)?x:j[0])},[m,u]),b.useEffect(()=>{async function j(){if(u)d(void 0);else return d("Please Select a Geography"),Promise.resolve();i(!0),d(void 0);const N=await nx({geoid:u,category:m,title:x},n);s(JSON.stringify(N)),i(!1)}j()},[u,m,x]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(rt,{value:u,onChange:p,className:"flex-row-reverse"}),e.jsx(ze,{label:"Category:",type:m,setType:h,types:Object.keys(ms).filter(j=>ms[j].find(N=>N.type==="CensusLineChart"))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Attribute:"}),e.jsx("select",{className:"bg-white w-full pl-3 rounded-md my-1",onChange:j=>y(j.target.value),value:x,children:f.map(j=>e.jsx("option",{value:j,children:j},j))})]})]}),l?e.jsx(dt,{}):c?e.jsx("div",{className:"p-5 text-center",children:c}):e.jsx(sx,{title:a.title,geoid:u,data:a.data,year:a.year,compareYear:a.compareYear,sumType:a.sumType})]})})};ax.settings={hasControls:!0,name:"ElementEdit"};const mk=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s!=null&&s.status?e.jsx("div",{className:"p-5 text-center",children:s==null?void 0:s.status}):e.jsx(sx,{...s,baseUrl:"/"})})},pk={name:"Graph: Census Line",type:"Hero Stats",variables:[{name:"geoid",default:"36"},{name:"category",default:"Housing",hidden:!0},{name:"title",default:"Percent Homeowners 65 and Older",hidden:!0}],getData:nx,EditComp:ax,ViewComp:mk};class rx extends U0{constructor(){super(...arguments);ye(this,"onHover",{layers:["counties","tracts"],HoverComp:({data:n,layer:r})=>e.jsxs("div",{style:{maxHeight:"300px"},className:"rounded relative p-4 overflow-auto scrollbarXsm bg-white",children:[e.jsx("div",{className:"text-blue-500 font-bold",children:n==null?void 0:n.county}),e.jsx("div",{className:"text-xs text-slate-400 uppercase font-bold",children:"Plan status"}),e.jsx("div",{className:"text-sm",children:n==null?void 0:n.plan_status}),e.jsx("div",{className:"text-xs text-slate-400 uppercase font-bold",children:"Plan Approval Date"}),e.jsx("div",{className:"text-sm",children:n==null?void 0:n.approval_date})]}),callback:(n,r,a)=>{let{data:l}=this.props;return l.find(c=>{var d,u;return""+c.geoid==""+((u=(d=r==null?void 0:r[0])==null?void 0:d.properties)==null?void 0:u.geoid)})||{}}})}}const ox=["#a50026","#fee08b","#1a9850"],ec=()=>e.jsxs("div",{className:"absolute top-4 left-4 bg-white p-4",children:["County LHMP Status",[{name:"Approved Plan",color:"#1a9850"},{name:"Plan Update in Progress",color:"#fee08b"},{name:"Plan Expired. No Update in Progress.",color:"#a50026"}].map(t=>e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx("div",{className:"h-6 w-6 rounded",style:{backgroundColor:t.color}}),e.jsxs("div",{className:"flex-1 px-2 text-sm text-slate-600",children:[" ",t.name," "]})]}))]}),fm=t=>{if(!t||t==="NULL")return null;const s=new Date,n=new Date(t);return n.setFullYear(n.getFullYear()+5),Math.ceil((n.getTime()-s.getTime())/(1e3*60*60*24))/365};async function hk({geoid:t,version:s,colors:n=ox,size:r=1,height:a=500,...l},i){var A,R;const c="geoid";s=880;const d=["county","approval_date","under_fema_review_yes_no","update_in_progress"],u=JSON.stringify({filter:{[`substring(${c}::text, 1, ${(A=t==null?void 0:t.toString())==null?void 0:A.length})`]:[t]}}),p=["dama",oe,"viewsbyId",s,"options",u,"length"],m=["dama",oe,"viewsbyId",s,"options",u,"databyIndex"],h=["dama",oe,"views","byId",s,"attributes"],f=["source_id","view_id","version","_modified_timestamp"],g=await i.get(p),x=C(g,["json",...p],0),y=await i.get([...m,{from:0,to:x-1},[c,...d]]),j=await i.get([...h,f]),N=C(j,["json",...h],{}),_=Object.values(C(y,["json",...m],{}));if(!(_!=null&&_.length)||!(n!=null&&n.length))return{};const E=_.map(O=>O[c]+"");((t==null?void 0:t.substring(0,2))||E[0]||"00").substring(0,2);const L={};(R=E[0])==null||R.toString().length,_.map(O=>fm(O[d==null?void 0:d[0]])||-5);const S=ps().domain([-22,-.01,0]).range(["#efb700","#d73027","#1a9850"]),k=[-22,-1,0];return _.forEach(O=>{let M=fm(O.approval_date)||-5;O.plan_status="Plan Approved",M<0&&(O.under_fema_review_yes_no||O.update_in_progress)?(M=-23,O.plan_status="Update in Progress"):M<0?O.plan_status="Plan Expired, No Update in Progress":O.plan_status="Plan Approved",L[O[c]+""]=M?S(M):"#d0d0ce"}),{geoid:t,title:"County Plan Status Map",domain:k,sources:[{id:"counties",source:{type:"vector",url:"https://tiles.availabs.org/data/tiger_carto.json"}}],layers:[{id:"counties",source:"counties","source-layer":"s365_v778",type:"fill",filter:["==","36",["slice",["string",["get","geoid"]],0,2]],paint:{"fill-color":["get",["get","geoid"],["literal",L]]}},{id:"counties-line",source:"counties","source-layer":"s365_v778",type:"line",filter:["in",["get","geoid"],["literal",E]],paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,22,2],"line-color":"#efefef","line-opacity":.5}}],attributionData:N,size:r,height:a,colors:n,mapFocus:[-79.761313,40.477399,-71.777491,45.01084],data:_}}const lx=({value:t,onChange:s,size:n})=>{const{falcor:r,falcorCache:a}=et();let l=t&&tt(t)?JSON.parse(t):{};const i="/",[c,d]=b.useState((l==null?void 0:l.dataSources)||[]),[u,p]=b.useState(l==null?void 0:l.dataSource),[m,h]=b.useState((l==null?void 0:l.version)||880),[f,g]=b.useState((l==null?void 0:l.geoAttribute)||"geoid"),[x,y]=b.useState(!0),[j,N]=b.useState(l==null?void 0:l.status),[_,E]=b.useState({geoid:(l==null?void 0:l.geoid)||"36",data:(l==null?void 0:l.data)||[],type:(l==null?void 0:l.type)||"total_losses",typeId:l==null?void 0:l.typeId,mapFocus:l.mapFocus||[-79.761313,40.477399,-71.777491,45.01084],numColors:(l==null?void 0:l.numColors)||5,colors:(l==null?void 0:l.colors)||ox,title:(l==null?void 0:l.title)||"County Plan Status Map",height:(l==null?void 0:l.height)||500,attributionData:l.attributionData||{},size:1}),S=["dama",oe,"sources","byCategory","county statuses"];$e(),b.useEffect(()=>{async function $(){y(!0),N(void 0),await r.get(S),d(C(r.getCache(),[...S,"value"],[])),y(!1)}$()},[]),b.useEffect(()=>{(async()=>{console.log("load on compdataChange");const{geoid:I,colors:T,height:A,size:R}=_;if(!I)console.log("not going to load mfer"),N("Please Select a Geography ");else{N(void 0),y(!0);let O=await hk({geoid:I,version:m,colors:T,size:R,height:A},r);t!==JSON.stringify({...l,...O})&&s(JSON.stringify({...l,...O})),y(!1)}})()},[_,m]);const k=b.useMemo(()=>({ccl:{...l,change:$=>{$.img=void 0,t!==JSON.stringify({...l,...$})&&s(JSON.stringify({...l,...$}))}}}),[l]);return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(ze,{label:"Data Source:",types:c.map($=>({label:$.name,value:$.source_id})),type:u,setType:$=>{g(void 0),h(void 0),p($)}}),e.jsx(Ct,{source_id:u,view_id:m,onChange:h,className:"flex-row-reverse"}),e.jsx(rt,{value:_.geoid,onChange:$=>E({..._,geoid:$}),className:"flex-row-reverse"}),e.jsx(ze,{label:"Size:",types:[{label:"Small",value:500},{label:"Medium",value:700},{label:"Large",value:900}],type:_.height,setType:$=>E({..._,height:$})})]}),x?e.jsx(dt,{}):j?e.jsx("div",{className:"p-5 text-center",children:j}):e.jsxs(w.Fragment,{children:[e.jsxs("div",{className:"flex-none w-full p-1 relative",style:{height:`${_.height||"500"}px`},children:[e.jsx(ec,{}),e.jsx(sd,{falcor:r,layerType:()=>new rx,layerProps:k,legend:!1})]}),e.jsx(ct,{baseUrl:i,attributionData:_.attributionData})]})]})})};lx.settings={hasControls:!0,name:"ElementEdit"};const fk=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return s==null||s.attributionData,console.log("test 123",s),e.jsx("div",{className:"relative w-full p-6",children:s.img?e.jsxs("div",{className:"h-80vh flex-1 flex flex-col relative",children:[e.jsx(ec,{}),e.jsx("img",{alt:"Choroplath Map",src:C(s,["img"])})]}):e.jsxs("div",{className:"flex-none w-full p-1 relative",style:{height:`${s.height}px`},children:[e.jsx(ec,{}),e.jsx(_r,{layerProps:{ccl:s},layerType:()=>new rx,legend:{show:!1}})]})})},gk={name:"Map: County Status",type:"Map",EditComp:lx,ViewComp:fk},xk=({geoid:t,colors:s=[],...n})=>{var l;const r={},a=((l=t==null?void 0:t.toString())==null?void 0:l.substring(0,2))||"36";for(let i=0;i<=999;i+=1){const c=a+i.toString().padStart(3,"0");r[c]=c==t?"#ffda00":"#d0d0ce"}return{geoColors:r}};async function ix({geoid:t,size:s,height:n,numColors:r,shade:a},l){var j;const c=["st_asgeojson(st_orientedenvelope(st_union(geom)), 9, 1)  as geom"],d={from:0,to:0},u=(j=t==null?void 0:t.toString())==null?void 0:j.substring(0,2),p=N=>["dama",oe,"viewsbyId",N,"options",JSON.stringify({filter:{geoid:[u.substring(0,2)]}}),"databyIndex"],m=await l.get([...p(285),d,c]),h=C(m,["json",...p(285),0,c]),f=C(JSON.parse(h),"bbox")||[-79.761313,40.477399,-71.777491,45.01084],{geoColors:g}=xk({geoid:t}),x="counties";return{geoid:t,mapFocus:f,geoColors:g,geoLayer:x,layerProps:{ccl:{view:{},data:[],geoColors:g,mapFocus:f,geoLayer:x,height:n,size:s}},size:s,height:n,numColors:r,shade:a}}const cx=({value:t,onChange:s,size:n})=>{const{falcor:r,falcorCache:a}=et();let l=t&&tt(t)?JSON.parse(t):{};const[i,c]=b.useState(!0),[d,u]=b.useState(l==null?void 0:l.status),[p,m]=b.useState((l==null?void 0:l.geoid)===""?l==null?void 0:l.geoid:(l==null?void 0:l.geoid)||"36"),[h,f]=b.useState((l==null?void 0:l.numColors)||5),[g,x]=b.useState((l==null?void 0:l.shade)||"Oranges"),[y,j]=b.useState((l==null?void 0:l.height)||500);return b.useEffect(()=>{async function N(){if(p)u(void 0);else return!p&&u("Please Select a Geography."),Promise.resolve();c(!0),u(void 0);const _=await ix({geoid:p,size:n,height:y,numColors:h,shade:g},r);s(JSON.stringify({..._})),c(!1)}N()},[p,n,y,h,g]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:["Edit Controls",e.jsx(rt,{value:p,onChange:m,className:"flex-row-reverse"}),e.jsx(ze,{label:"Size:",types:[{label:"X-Small",value:300},{label:"Small",value:500},{label:"Medium",value:700},{label:"Large",value:900}],type:y,setType:N=>{j(N)}})]}),i?e.jsx(dt,{}):d?e.jsx("div",{className:"p-5 text-center",children:d}):e.jsx(w.Fragment,{children:e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${y}px`},children:e.jsx(qs,{interactive:!0,falcor:r,layerProps:l.layerProps,legend:{show:!1}})})})]})})};cx.settings={hasControls:!0,name:"ElementEdit"};const bk=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx("div",{className:"relative w-full p-6",children:s.img?e.jsx("div",{className:"h-80vh flex-1 flex flex-col",children:e.jsx("img",{alt:"Choroplath Map",src:C(s,["img"])})}):e.jsx("div",{className:"flex-none w-full p-1",style:{height:`${s.height}px`},children:e.jsx(qs,{interactive:!1,layerProps:s.layerProps,legend:{show:!1}})})})},yk={name:"Map: County Highlight",type:"Map",variables:[{name:"geoid",default:"36"},{name:"size",hidden:!0},{name:"height",hidden:!0},{name:"numColors",hidden:!0},{name:"shade",hidden:!0},{name:"colors",hidden:!0,default:Js(5,"Oranges")}],getData:ix,EditComp:cx,ViewComp:bk},vk=285,jk=286,gm=837,wk=(t,s,n)=>{s&&n([])},Nk=(t,s,n,r,a,l,i)=>{const c=C(t,[0,"geoid"]),d=C(t,[0,"disasterNumber"]);if(c||c===""){const u={0:"",2:"/state",5:"/county"};s(t),i?i(c):l(`${u[c==null?void 0:c.length]}/${c}`)}else d?(s(t),i?i(d):l(`/disaster/${d}`)):s([])},Ck=(t,s,n,...r)=>e.jsx(cn,{className:"bg-slate-100  overflow-hidden z-10",...s,children:t.map((a,l)=>e.jsx(dn,{className:"block hover:bg-slate-200 text-xl tracking-wide pl-1",option:a,position:l,children:a.name}))}),_k=async({falcor:t,pgEnv:s})=>{const n=["geoid","stusps","name"],r=JSON.stringify({}),a=["dama",s,"viewsbyId",vk,"options",r],l=await t.get([...a,"length"]),i=C(l,["json",...a,"length"]);if(i>0){const c={from:0,to:i-1},d=await t.get([...a,"databyIndex",c,n]);return Object.values(C(d,["json",...a,"databyIndex"],{}))}},Sk=async({falcor:t,pgEnv:s,statesData:n,setGeoData:r})=>{const a={geoid:"geoid",name:"namelsad as name"},l=Object.values(a),i=JSON.stringify({}),c=["dama",s,"viewsbyId",jk,"options",i],d=await t.get([...c,"length"]),u=C(d,["json",...c,"length"]);if(u>0){const p={from:0,to:u-1},m=await t.get([...c,"databyIndex",p,l]),h=Object.values(C(m,["json",...c,"databyIndex"],{})).filter(f=>f.geoid).map(f=>{const g=C(n.find(x=>x.geoid===f.geoid.substring(0,2)),"stusps","");return{geoid:f.geoid,name:`${f[a.name]}, ${g}`}});h.push(...n.map(f=>({geoid:f.geoid,name:`State of ${f.name}`}))),h.push({geoid:"",name:"United States"}),r(h)}},$k=async({falcor:t,pgEnv:s,setDisastersData:n,statesData:r})=>{const a=x=>["dama",s,"viewDependencySubgraphs","byViewId",x],l=["disaster_number","declaration_title","fips_state_code"],i=JSON.stringify({aggregatedLen:!0,exclude:{disaster_number:Sa(3e3,3999)},groupBy:l}),c=x=>["dama",s,"viewsbyId",x,"options",i],d=await t.get(a(gm)),p=C(d,["json",...a(gm),"dependencies"]).find(x=>x.type==="disaster_declarations_summaries_v2"),m=p.view_id;if(!p)return;const h=await t.get([...c(m),"length"]),f=C(h,["json",...c(m),"length"],0);await t.chunk([...c(m),"databyIndex",{from:0,to:f-1},l]);const g=[...Object.values(C(t.getCache(),[...c(m),"databyIndex"],{})).filter(x=>typeof x.disaster_number!="object").map(x=>{const y=C(r.find(j=>j.geoid===x.fips_state_code),"stusps","");return{disasterNumber:x.disaster_number,name:`${x.declaration_title} (${x.disaster_number}), ${y}`}})];n(g)},dx=({showLabel:t=!0,className:s,value:n,onChange:r})=>{const a=$e(),{falcor:l,falcorCache:i}=et(),[c,d]=b.useState([]),[u,p]=b.useState([]),[m,h]=b.useState([]);b.useEffect(()=>{async function g(){const x=await _k({falcor:l,pgEnv:oe});await Sk({falcor:l,pgEnv:oe,statesData:x,setGeoData:d}),await $k({falcor:l,pgEnv:oe,setDisastersData:p,statesData:x})}g()},[oe,l]);const f=()=>e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-search font-light text-xl shadow bg-white p-4 rounded-r-md"}),e.jsx(Yo,{className:"w-full",isLoading:!1,onSearch:wk,minLength:2,id:"geography-search",placeholder:"Search for a Disaster or a Geography...",options:[...c,...u],labelKey:g=>`${g.name}`,defaultSelected:m,onChange:g=>Nk(g,h,n,c,u,a,r),selected:m,inputProps:{className:"bg-white shadow  w-full  p-4 text-xl rounded-l-md"},renderMenu:Ck},"geography-search")]});return t?e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Geography:"}),e.jsx("div",{className:`flex flex row ${s} w-3/4 shrink my-1`,children:e.jsx(f,{})})]}):e.jsx("div",{className:`flex w-full items-center ${s}`,children:e.jsx(f,{})})},ma="flex-row-reverse p-5 text-lg rounded-md",ux=({value:t,onChange:s})=>{let n=t&&tt(t)?JSON.parse(t):{};const[r,a]=b.useState((n==null?void 0:n.type)||[]);return b.useEffect(()=>{s(JSON.stringify({type:r}))},[r]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsx(ze,{type:r,setType:a,types:["Geography","Disaster"],multi:!0}),r!=null&&r.includes("Disaster")&&(r!=null&&r.includes("Geography"))?e.jsx(dx,{view_id:837,className:ma,showLabel:!1}):r!=null&&r.includes("Disaster")?e.jsx(Jn,{view_id:837,className:ma,showLabel:!1}):e.jsx(rt,{className:ma,showLabel:!1})]})})};ux.settings={hasControls:!0,name:"ElementEdit"};const Ek=({value:t})=>{var n;const s=tt(t)?(n=JSON.parse(t))==null?void 0:n.type:t;return e.jsx("div",{className:"relative w-full p-6",children:e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"relative",children:s!=null&&s.includes("Disaster")&&(s!=null&&s.includes("Geography"))?e.jsx(dx,{className:ma,showLabel:!1}):s!=null&&s.includes("Disaster")?e.jsx(Jn,{view_id:837,className:ma,showLabel:!1}):e.jsx(rt,{className:ma,showLabel:!1})})})})},kk={name:"Search Bar",type:"Functionality",EditComp:ux,ViewComp:Ek};function mx({position:t="above",bgImg:s="/img/header.png",logo:n="/img/nygov-logo.png",title:r="MitigateNY",bgClass:a="",subTitle:l="New York State Hazard Mitigation Plan",note:i="2023 Update"}){return e.jsxs("div",{className:`h-[300px] bg-cover bg-center w-full flex ${a}`,style:{backgroundImage:`url("${s}")`},children:[e.jsx("div",{className:"p-2",children:n&&e.jsx("img",{src:n,alt:"NYS Logo"})}),e.jsxs("div",{className:"flex-1 flex flex-col  items-center p-4",children:[e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"text-3xl sm:text-7xl font-bold text-[#f2a91a] text-right w-full text-display",children:r&&e.jsx("div",{children:r})}),e.jsx("div",{className:"text-lg tracking-wider pt-2 sm:text-3xl font-bold text-slate-200 text-right w-full uppercase",children:l&&e.jsx("div",{children:l})}),e.jsx("div",{className:"text-lg tracking-wider sm:text-xl font-bold text-slate-200 text-right w-full uppercase",children:i&&e.jsx("div",{children:i})}),e.jsx("div",{className:"flex-1"})]})]})}async function Lk({position:t="above",bgImg:s="/img/header.png",logo:n="/img/nygov-logo.png",bgClass:r="",title:a="MitigateNY",subTitle:l="New York State Hazard Mitigation Plan",note:i="2023 Update"}){return{position:t,bgImg:s,bgClass:r,logo:n,title:a,subTitle:l,note:i}}const px=({value:t,onChange:s,size:n})=>{let r=b.useMemo(()=>t&&tt(t)?JSON.parse(t):{},[t]);b.useState(!0),b.useState("");const[a,l]=b.useState({position:r.position||"above",bgImg:r.bgImg||"",logo:r.logo||"",title:r.title||"MitigateNY",subTitle:r.subTitle||"New York State Hazard Mitigation Plan",note:r.note||"2023 Update",bgClass:r.bgClass||""});return b.useEffect(()=>{t!==JSON.stringify(a)&&s(JSON.stringify(a))},[a]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:[e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Title:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.title,onChange:i=>l({...a,title:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"subTitle:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.subTitle,onChange:i=>l({...a,subTitle:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Note:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.note,onChange:i=>l({...a,note:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Bg Class:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.bgClass,onChange:i=>l({...a,bgClass:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"bgImg:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.bgImg,onChange:i=>l({...a,bgImg:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"logo:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.logo,onChange:i=>l({...a,logo:i.target.value})})})]}),e.jsx(ze,{label:"Position:",types:[{label:"Above",value:"above"},{label:"Below",value:"below"}],type:a.position,setType:i=>l({...a,position:i})})]}),e.jsx(mx,{...a})]})})},Ik=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx(mx,{...s})};px.settings={hasControls:!0,name:"ElementEdit"};const Tk={name:"Header: Default",type:"Header",variables:[{name:"bgImg",default:"/img/header.png"},{name:"logo",default:"/img/nygov-logo.png"},{name:"title",default:"MitigateNY"},{name:"subTitle",default:"New York State Hazard Mitigation Plan"},{name:"bgClass",default:""},{name:"note",default:"2023 Update"}],getData:Lk,EditComp:px,ViewComp:Ik};function hx({title:t="",bgClass:s="",subTitle:n="County Profile",link:r="#",mapLayer:a={}}){return e.jsxs("div",{className:"h-[300px] bg-cover bg-center w-full flex border-2 border-blue-500 bg-gradient-to-tl rounded-lg from-blue-400 to-blue-700",children:[e.jsx("div",{className:"p-2 h-full w-[250px] pl-8",children:e.jsx(_r,{layerProps:{ccl:a},legend:{show:!1}})}),e.jsxs("div",{className:"flex-1 flex flex-col  items-center p-4",children:[e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"text-3xl sm:text-7xl font-bold text-[#f2a91a] text-right w-full text-display",children:t&&e.jsx("div",{children:t})}),e.jsx("div",{className:"text-lg tracking-wider pt-2 sm:text-3xl font-bold text-slate-200 text-right w-full uppercase",children:n&&e.jsx("div",{children:n})}),e.jsxs("div",{className:"text-sm tracking-wider sm:text-sm font-bold text-slate-200 text-right w-full uppercase",children:[e.jsx("i",{className:"fa fa-arrow-up-right-from-square text-xl"})," ",e.jsxs("a",{href:r,target:"_blank",className:"border-b",children:["  Local Hazard Mitigation Plan ",e.jsx("i",{className:"fa fa-book"})]})]}),e.jsx("div",{className:"flex-1"})]})]})}function fx(t){return t=""+t,{sources:[{id:"counties",source:{type:"vector",url:"https://tiles.availabs.org/data/tiger_carto.json"}}],layers:[{id:"counties",source:"counties","source-layer":"s365_v778",type:"fill",filter:["in",t.substring(0,2),["string",["get","geoid"]]],paint:{"fill-color":["case",["has",["to-string",["get","geoid"]],["literal",{[t]:"#f2a91a"}]],["get",["to-string",["get","geoid"]],["literal",{[t]:"#f2a91a"}]],"#e1e1e1"]}},{id:"counties-line",source:"counties","source-layer":"s365_v778",type:"line",filter:["in",t.substring(0,2),["string",["get","geoid"]]],paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,22,1],"line-color":"#7e7e7e","line-opacity":.5}}],mapFocus:[-79.761313,40.477399,-71.777491,45.01084]}}const Mk=({geoid:t,title:s,subTitle:n,link:r="2023 Update"})=>(console.log("county header getData",s),new Promise((a,l)=>{a({title:s,subTitle:n,link:r,mapLayer:fx(t)})})),gx=({value:t,onChange:s,size:n})=>{let r=b.useMemo(()=>t&&tt(t)?JSON.parse(t):{},[t]);b.useState(!0),b.useState("");const[a,l]=b.useState({geoid:r.geoid||"36001",title:r.title||"",subTitle:r.subTitle||"County Profile",link:r.link||"2023 Update",mapLayer:r.mapLayer||fx(r.geoid||"36001")});return b.useEffect(()=>{t!==JSON.stringify(a)&&s(JSON.stringify(a))},[a]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:[e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Title:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.title,onChange:i=>l({...a,title:i.target.value})})})]}),e.jsx(rt,{value:a.geoid,onChange:i=>l({...a,geoid:i}),className:"flex-row-reverse"}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"subTitle:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.subTitle,onChange:i=>l({...a,subTitle:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Note:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.note,onChange:i=>l({...a,note:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Bg Class:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.bgClass,onChange:i=>l({...a,bgClass:i.target.value})})})]})]}),e.jsx(hx,{...a})]})})},Bk=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx(hx,{...s})};gx.settings={hasControls:!0,name:"ElementEdit"};const Ak={name:"Header: County",type:"Header",variables:[{name:"geoid",default:"36001"},{name:"title",default:"MitigateNY"},{name:"subTitle",default:"New York State Hazard Mitigation Plan"},{name:"link",default:"2023 Update"}],getData:Mk,EditComp:gx,ViewComp:Bk},pa={};for(const t in $t.schemeGroups)$t.schemeGroups[t].forEach(s=>{const n=$t[s];for(const r in n)r in pa||(pa[r]=[]),pa[r].push({type:`${t[0].toUpperCase()}${t.slice(1)}`,name:s,category:"Colorbrewer",colors:n[r]})});const xx=(t,s,n=!1)=>{let r=C(pa,[t],[]).reduce((a,l)=>l.name===s?l.colors:a,[]).slice();return n&&r.reverse(),r},Ok=["",null],zs=t=>Ok.includes(t)?!0:isNaN(t),Pk=({pgEnv:t}={})=>{const{falcor:s,falcorCache:n}=Us.useFalcor();return w.useEffect(()=>{s.get(["dama",t,"sources","length"])},[s,t]),w.useEffect(()=>{const r=C(n,["dama",t,"sources","length"],0);r&&s.get(["dama",t,"sources","byIndex",{from:0,to:r-1},"attributes",["source_id","name","metadata","categories","type"]])},[s,n,t]),w.useMemo(()=>{const r=C(n,["dama",t,"sources","length"],0);return ws(r).reduce((a,l)=>{const i=C(n,["dama",t,"sources","byIndex",l,"value"],null);if(i!=null&&i.length){const c=C(n,[...i,"attributes"]);a.push(c)}return a},[]).filter(a=>{const l=C(a,["categories","value"],[]);return Array.isArray(l)?l.reduce((i,c)=>i||c.includes("Cenrep"),!1):!1}).sort((a,l)=>a.name.localeCompare(l.name))},[n,t])},Dk=({pgEnv:t,sourceId:s=null}={})=>{const{falcor:n,falcorCache:r}=Us.useFalcor();return w.useEffect(()=>{zs(s)||n.get(["dama",t,"sources","byId",s,"views","length"])},[n,t,s]),w.useEffect(()=>{const a=C(r,["dama",t,"sources","byId",s,"views","length"],0);a&&n.get(["dama",t,"sources","byId",s,"views","byIndex",{from:0,to:a-1},"attributes",["view_id","source_id","version","metadata"]])},[n,r,t,s]),w.useMemo(()=>{const a=C(r,["dama",t,"sources","byId",s,"views","length"],0);return ws(a).reduce((l,i)=>{const c=C(r,["dama",t,"sources","byId",s,"views","byIndex",i,"value"],null);if(c!=null&&c.length){const d=C(r,[...c,"attributes"]);l.push(d)}return l},[]).sort((l,i)=>i.view_id-l.view_id)},[r,t,s])},ad=t=>t.split(/\s(?:as|AS)\s/),Ja=t=>ad(t)[0],Rk=({activeView:t,xAxisColumn:s,yAxisColumns:n,filters:r,pgEnv:a,category:l})=>{const{falcor:i,falcorCache:c}=Us.useFalcor(),d=w.useMemo(()=>s?JSON.stringify({aggregatedLen:!0,groupBy:[Ja(s.name),Ja(C(l,"name",""))].filter(Boolean),filter:r.reduce((p,m)=>(p[Ja(m.column.name)]=m.values,p),{})}):"{}",[s,r,l]),u=w.useMemo(()=>n.reduce((p,m)=>{const{name:h,aggMethod:f}=m,[g,x]=ad(h);return p[`${f}(${g}) AS ${x||g}`]=x||g,p},{}),[n]);return w.useEffect(()=>{if(!t)return;const p=t.view_id;i.get(["dama",a,"viewsbyId",p,"options",d,"length"])},[i,a,t,d]),w.useEffect(()=>{if(!t)return;const p=t.view_id;let m=C(c,["dama",a,"viewsbyId",p,"options",d,"length"],0);m=Math.min(m,250);const h=[C(s,"name",null),...Object.keys(u),C(l,"name",null)].filter(Boolean);m&&!zs(m)&&h.length&&i.get(["dama",a,"viewsbyId",p,"options",d,"databyIndex",ws(m),h])},[i,c,a,t,s,d,u,l]),w.useMemo(()=>{if(!t)return[[],0];if(!s)return[[],0];console.log("???????????????",s,n);const p=t.view_id;let m=C(c,["dama",a,"viewsbyId",p,"options",d,"length"],0);m=Math.min(m,250);const h=Ja(C(l,"name","")),f=ws(m).reduce((x,y)=>{const j=C(c,["dama",a,"viewsbyId",p,"options",d,"databyIndex",y]);if(console.log("?????????????????????",j),j)for(const N in u){let _=j[s.name];typeof _=="object"&&"value"in _&&(_=_.value);let E=j[N];typeof E=="object"&&"value"in E&&(E=E.value);let L=h?j[h]:u[N];typeof L=="object"&&"value"in L&&(L=L.value),_&&!zs(E)&&L&&x.push({index:_,value:+E,type:L})}return x},[]);console.log("useGetViewData::data",f);const{sortMethod:g}=s;return g!=="none"&&f.sort((x,y)=>{switch(g){case"ascending":return String(x.index).localeCompare(String(y.index));case"descending":return String(y.index).localeCompare(String(x.index))}}),[f,m]},[c,a,t,d,s,u,l])},Fk=({activeView:t,column:s,pgEnv:n})=>{const{falcor:r,falcorCache:a}=Us.useFalcor();w.useState(0),w.useState([]);const l=w.useMemo(()=>s?JSON.stringify({aggregatedLen:!0,groupBy:[Ja(s.name)]}):"{}",[s]),i=w.useMemo(()=>{if(!s)return{};const[c,d]=ad(s.name);return{"COUNT(1) AS count":d||c}},[s]);return w.useEffect(()=>{if(!t||!s)return;const c=t.view_id;r.get(["dama",n,"viewsbyId",c,"options",l,"length"])},[r,n,t,l,s]),w.useEffect(()=>{if(!t||!s)return;const c=t.view_id;let d=C(a,["dama",n,"viewsbyId",c,"options",l,"length"],0);d=Math.min(1e3,d);const u=[C(s,"name",null),...Object.keys(i)].filter(Boolean);d&&!zs(d)&&u.length&&r.get(["dama",n,"viewsbyId",c,"options",l,"databyIndex",ws(d),u])},[r,a,n,t,l,s,i]),w.useMemo(()=>{if(!t)return[];if(!s)return[];const c=t.view_id;let d=C(a,["dama",n,"viewsbyId",c,"options",l,"length"],0);return d=Math.min(1e3,d),ws(d).reduce((u,p)=>{const m=C(a,["dama",n,"viewsbyId",c,"options",l,"databyIndex",p]);return m&&u.push({value:m[s.name],count:+m["COUNT(1) AS count"]}),u},[]).sort((u,p)=>zs(u.value)||zs(p.value)?String(u.value).localeCompare(String(p.value)):+u.value-+p.value)},[a,n,t,l,s,i])},Vk=({activeSource:t,setActiveSource:s,pgEnv:n})=>{const r=Pk({pgEnv:n}),[a,l]=w.useState(C(t,"source_id",null)),i=w.useCallback(c=>{l(c),s(r.find(d=>d.source_id===c))},[r,s]);return e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Sources"}),e.jsx(Nn,{options:r,accessor:c=>c.name,valueAccessor:c=>c.source_id,value:a,onChange:i,placeholder:"Select a source..."})]})},Hk=({view:t,activeViewId:s,setViewId:n})=>{const r=w.useCallback(i=>{n(t.view_id)},[t.view_id]),a=w.useMemo(()=>t.view_id===s,[t.view_id,s]),l=w.useMemo(()=>C(t,["version","value"],t.version),[t]);return e.jsxs("div",{className:`
        w-fit cursor-pointer border-b-2 hover:bg-gray-300
        ${a?"border-current":"border-transparent"}
      `,onClick:r,children:[a?e.jsx("div",{className:"inline-block mr-2",children:"Active Version:"}):null,e.jsx("div",{className:"inline-block",children:l?zs(l)?`${l}`:`Version ${l}`:null})]})},zk=({activeSource:t,setActiveView:s,activeView:n,pgEnv:r})=>{const a=t==null?void 0:t.source_id,l=Dk({sourceId:a,pgEnv:r}),[i,c]=w.useState(null);w.useEffect(()=>{c(null)},[a]),w.useEffect(()=>{i||c(C(l,[0,"view_id"],null))},[c,i,l]),w.useEffect(()=>{s(l.find(h=>h.view_id===i))},[s,l,i]);const[d,u]=w.useState(!1),p=w.useCallback(h=>{h.stopPropagation(),u(f=>!f)},[]);w.useEffect(()=>{u(!1)},[i]);const m=w.useMemo(()=>C(n,["version","value"],n==null?void 0:n.version)||null,[n]);return e.jsx("div",{children:l.length?e.jsxs("div",{children:[m?d?e.jsx("div",{style:{maxHeight:"300px"},className:"overflow-auto",children:l.map(h=>e.jsx(Hk,{view:h,setViewId:c,activeViewId:i},h.view_id))}):e.jsxs("div",{className:"border-b-2 border-current w-fit",children:[e.jsx("div",{className:"inline-block mr-2",children:"Active Version:"}),e.jsx("div",{className:"inline-block",children:m?zs(m)?`${m}`:`Version ${m}`:null})]}):null,l.length<2?null:e.jsx("div",{className:"text-blue-500 cursor-pointer inline-block",onClick:p,children:d?"close":"select another version"})]}):null})},hn=t=>`${t.display_name||t.name} (${t.type})`,bx=({column:t,select:s,isActive:n})=>{const r=w.useCallback(a=>{a.stopPropagation(),s(t)},[s,t]);return e.jsxs("div",{onClick:r,className:`
        w-full min-w-fit whitespace-nowrap px-2 py-1 pr-4
        ${n?"bg-gray-300 hover:bg-gray-400":"hover:bg-gray-300"} cursor-pointer
      `,children:[n?e.jsx("span",{className:"fa fa-check px-1 py-1"}):null,hn(t)]})},yx=({current:t,options:s,disabledOptions:n=[],colKey:r,update:a})=>{const l=w.useCallback(i=>{a({[r]:i.target.id})},[a,r]);return e.jsx("div",{className:"inline-block flex",children:s.map((i,c)=>e.jsx("div",{id:i,onClick:n.includes(i)?null:l,className:`
              ${c>0?"ml-2":""} border-current
              ${i===t?"font-bold  border-b-2":n.includes(i)?"cursor-not-allowed opacity-50":"cursor-pointer opacity-50 hover:border-b hover:opacity-100"}
            `,children:i},i))})},vx=({column:t})=>e.jsx("span",{className:"py-1 px-4 hover:bg-gray-300 rounded",children:hn(t)}),Uk=["none","ascending","descending"],Wk=({column:t,update:s})=>{const[n,r]=w.useState(!1),a=w.useCallback(i=>{i.stopPropagation(),r(!0)},[]),l=w.useCallback(i=>{i.stopPropagation(),r(!1)},[]);return e.jsxs("div",{className:"relative flex overflow-visible",onMouseEnter:a,onMouseLeave:l,children:[e.jsx(vx,{column:t}),e.jsxs("div",{className:`
          ${n?"w-fit overflow-auto":"w-0 h-0 overflow-hidden"}
          bg-white top-0 left-0 absolute z-10
        `,children:[e.jsx("div",{className:"py-1 px-4 border-b-2",children:hn(t)}),e.jsx("div",{className:"px-2 pb-2 whitespace-nowrap overflow-visible",children:e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"mr-2",children:"Sort Method:"}),e.jsx(yx,{current:t.sortMethod,options:Uk,colKey:"sortMethod",update:s})]})})]})]})},Gk=t=>{const{columns:s,xAxisColumn:n,setXAxisColumn:r,updateXAxisColumn:a,activeSource:l}=t,[i,c]=w.useState(!1),d=w.useCallback(m=>{m.stopPropagation(),c(!0)},[]),u=w.useCallback(m=>{m.stopPropagation(),c(!1)},[]);w.useMemo(()=>n?hn(n):null,[n]);const p=w.useCallback(m=>{r({...m,sortMethod:"none"}),c(!1)},[n,r]);return e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-4 font-bold py-1",children:"X Axis:"}),e.jsxs("div",{className:"hover:bg-gray-300 rounded px-2 py-1 relative mr-2",onMouseEnter:d,onMouseLeave:u,children:[e.jsx("span",{className:"fa fa-list py-1 px-2"}),n?null:l?e.jsx("span",{className:"ml-2 py-1",children:"Select a column..."}):e.jsx("span",{className:"ml-2 py-1",children:"Select a source..."}),e.jsx("div",{className:`
            ${i?"w-fit max-h-[300px] overflow-auto":"w-0 h-0 overflow-hidden"}
            bg-white top-0 left-0 absolute z-10
          `,children:s.map(m=>e.jsx(bx,{column:m,select:p,isActive:m.name===(n==null?void 0:n.name)},m.name))})]}),n?e.jsx(Wk,{column:n,update:a}):null]})},Jk=["SUM","AVG","COUNT"],qk=({column:t,update:s})=>{const[n,r]=w.useState(!1),a=w.useCallback(d=>{d.stopPropagation(),r(!0)},[]),l=w.useCallback(d=>{d.stopPropagation(),r(!1)},[]),i=w.useCallback(d=>{s(t.name,d)},[s,t.name]),c=w.useMemo(()=>["integer","number"].includes(t.type)?[]:["SUM","AVG"],[t.type]);return e.jsxs("div",{className:"relative flex overflow-visible",onMouseEnter:a,onMouseLeave:l,children:[e.jsx(vx,{column:t}),e.jsxs("div",{className:`
          ${n?"w-fit overflow-auto":"w-0 h-0 overflow-hidden"}
          bg-white top-0 left-0 absolute z-10
        `,children:[e.jsx("div",{className:"py-1 px-4 border-b-2",children:hn(t)}),e.jsx("div",{className:"px-2 pb-2 whitespace-nowrap overflow-visible",children:e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"mr-2",children:"Aggregation Method:"}),e.jsx(yx,{current:t.aggMethod,options:Jk,disabledOptions:c,colKey:"aggMethod",update:i})]})})]})]})},Kk=t=>{const{columns:s,yAxisColumns:n,setYAxisColumns:r,updateYAxisColumn:a,activeSource:l}=t,[i,c]=w.useState(!1),d=w.useCallback(m=>{m.stopPropagation(),c(!0)},[]),u=w.useCallback(m=>{m.stopPropagation(),c(!1)},[]),p=w.useCallback(m=>{const h=n.reduce((f,g)=>f||g.name===m.name,!1);r(h?n.filter(f=>f.name!==m.name):[...n,{...m,aggMethod:["integer","number"].includes(m.type)?"SUM":"COUNT"}])},[n,r]);return w.useCallback(m=>{r(n.filter(h=>h.name!==m.name))},[n,r]),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-4 font-bold py-1",children:"Y Axis:"}),e.jsxs("div",{className:"hover:bg-gray-300 rounded px-2 py-1 relative mr-2",onMouseEnter:d,onMouseLeave:u,children:[e.jsx("span",{className:"fa fa-list py-1 px-2"}),n.length?null:l?e.jsx("span",{className:"ml-2 py-1",children:"Select a column..."}):e.jsx("span",{className:"ml-2 py-1",children:"Select a source..."}),e.jsx("div",{className:`
            ${i?"w-fit max-h-[300px] overflow-auto":"w-0 h-0 overflow-hidden"}
            bg-white top-0 left-0 absolute z-10
          `,children:s.map(m=>e.jsx(bx,{column:m,select:p,isActive:n.reduce((h,f)=>h||f.name===m.name,!1)},m.name))})]}),n.map((m,h)=>e.jsx("div",{className:`flex overflow-visible ${h>0?"ml-2":""}`,children:e.jsx(qk,{column:m,update:a},m.name)},m.name))]})},rd=xx(12,"Set3"),Yk=xx(7,"RdYlGn"),Zk=()=>({title:{title:"",position:"start",fontSize:32,fontWeight:"bold"},description:"",bgColor:"#ffffff",textColor:"#000000",colors:{type:"palette",value:[...rd]},height:300,width:void 0,margins:{marginTop:20,marginRight:20,marginBottom:50,marginLeft:100},xAxis:{label:"",rotateLabels:!1,showGridLines:!1,tickSpacing:1},yAxis:{label:"",showGridLines:!0,tickFormat:"Integer"},legend:{show:!0,label:"",width:300,height:50},tooltip:{show:!0,fontSize:12}}),Xk=({title:t,position:s,fontSize:n,fontWeight:r})=>{const a=w.useMemo(()=>`justify-${s}`,[s]);return t?e.jsx("div",{className:`w-full flex ${a} mb-4`,children:e.jsx("div",{style:{fontSize:`${n}px`,fontWeight:r},children:t})}):null},jx=t=>{const{graphFormat:s,activeGraphType:n,viewData:r}=t,a=w.useMemo(()=>SL(n.GraphComp),[n]),[l,i]=w.useState(null),[c,d]=w.useState(640);return w.useEffect(()=>{if(!l)return;const{width:u}=l.getBoundingClientRect();d(u)},[l]),e.jsxs("div",{ref:i,className:"w-full h-fit",style:{backgroundColor:C(s,"bgColor","#ffffff"),color:C(s,"textColor","#000000"),padding:`${C(s,"padding",1)}rem`},children:[e.jsx(Xk,{...s.title}),e.jsx("div",{className:"h-fit",children:n?e.jsx(a,{data:r,title:C(s,"title",""),height:C(s,"height",300),width:C(s,"width",c),bgColor:C(s,"bgColor","#ffffff"),colors:C(s,"colors"),orientation:C(s,"orientation","vertical"),groupMode:C(s,"groupMode","stacked"),xAxis:{label:C(s,["xAxis","label"]),rotateLabels:C(s,["xAxis","rotateLabels"],!1),tickSpacing:C(s,["xAxis","tickSpacing"],!0),showGridLines:C(s,["xAxis","showGridLines"],!0)},yAxis:{label:C(s,["yAxis","label"]),rotateLabels:C(s,["yAxis","rotateLabels"],!1),showGridLines:C(s,["yAxis","showGridLines"],!0),tickFormat:C(s,["yAxis","tickFormat"],void 0)},margins:C(s,"margins",{}),legend:C(s,"legend",{}),tooltip:C(s,"tooltip",{})}):null})]})},Qk=({value:t,onChange:s,disableScale:n=!1})=>{const r=w.useCallback(a=>{s(a.target.value)},[s]);return e.jsxs("div",{className:"grid grid-cols-2 gap-4 border-b-2 border-current w-1/2",children:[e.jsx("div",{className:"flex items-center mr-3 cursor-pointer w-fit",children:e.jsxs("label",{htmlFor:"palette",className:"flex items-center cursor-pointer font-bold",children:["Select a color palette",e.jsx("input",{type:"radio",name:"radio-group",value:"palette",id:"palette",className:"ml-2 cursor-pointer",checked:t==="palette",onChange:r})]})}),e.jsx("div",{className:"flex items-center ml-3 cursor-pointer w-fit",children:e.jsxs("label",{htmlFor:"scale",className:`
            flex items-center cursor-pointer font-bold
            ${n?"opacity-50":""}
          `,children:["Create a color scale",e.jsx("input",{type:"radio",name:"radio-group",value:"scale",id:"scale",className:"ml-2 cursor-pointer",checked:t==="scale",onChange:r,disabled:n})]})})]})},eL=({graphType:t,format:s,edit:n,editAll:r,dataDomain:a})=>{var i,c;const l=w.useCallback(d=>{const u=[["colors","type"],d],p=[];d==="palette"?p.push(["colors","value"],[...rd]):p.push(["colors","value"],{type:"quantize",range:[...Yk]}),r([u,p])},[r]);return e.jsxs("div",{className:"px-6 py-2 relative h-full",children:[e.jsx("div",{className:"font-bold text-xl",children:"Color Editor"}),e.jsx(Qk,{disableScale:t!=="Bar Graph",value:s.colors.type,onChange:l}),((i=s==null?void 0:s.colors)==null?void 0:i.type)==="palette"?e.jsx(sL,{current:s.colors.value,edit:n}):((c=s==null?void 0:s.colors)==null?void 0:c.type)==="scale"?e.jsx(oL,{current:s.colors.value,edit:n,editAll:r,dataDomain:a}):null]})},od=({palette:t})=>e.jsx("div",{className:"flex",children:t.map(s=>e.jsx("div",{style:{backgroundColor:s},className:"first:rounded-l last:rounded-r h-3 w-6"},s))}),tL=({select:t,palette:s,isActive:n})=>{const r=w.useCallback(a=>{t(s)},[t,s]);return e.jsx("div",{onClick:r,className:`
        first:mt-0 mt-1 w-fit rounded-lg
        ${n?"outline outline-2":"cursor-pointer"}
      `,children:e.jsx(od,{palette:s})})},wx=({select:t,current:s})=>{const[n,r]=w.useState(s.length),a=w.useCallback(u=>{r(u.target.value)},[]),l=w.useMemo(()=>Object.keys(pa).map(Number),[]),[i,c]=w.useState(!1),d=w.useMemo(()=>Oy(pa[n],u=>u.type).map(([u,p])=>i?[u,p.map(m=>({...m,colors:[...m.colors].reverse()}))]:[u,p.map(m=>({...m,colors:[...m.colors]}))]).sort((u,p)=>u[0].localeCompare(p[0])),[n,i]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-4 gap-4",children:e.jsxs("div",{className:"col-span-2 grid grid-cols-2 gap-4 border-b-2 border-gray-500 pb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 w-48",children:"Palette Lengths:"}),e.jsx("div",{className:"w-64",children:e.jsx("select",{value:n,onChange:a,className:"text-xs font-medium px-2 py-1 bg-white w-full",style:{outline:"none",border:"none"},children:l.map(u=>e.jsx("option",{value:u,children:u},u))})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 w-48",children:"Reverse Palettes:"}),e.jsx("div",{className:"w-64",children:e.jsx(Cx,{value:i,onChange:c})})]})]})}),e.jsx("div",{className:"grid gap-4 grid-cols-4",children:d.map(([u,p])=>e.jsxs("div",{children:[e.jsx("div",{className:"border-b-2 border-gray-400",children:u}),e.jsx("div",{className:"h-fit max-h-[12.5rem] overflow-auto p-1",children:p.map((m,h)=>e.jsx(tL,{palette:m.colors,isActive:Fe(m.colors,s),select:t},m.colors.join("-")))})]},u))})]})},sL=({current:t,edit:s})=>{const n=w.useCallback(r=>{s(["colors","value"],[...r])},[s]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center border-b-2 border-gray-600 mb-1 w-1/2",children:[e.jsx("span",{className:"mr-2 whitespace-nowrap w-32",children:"Current Palette:"}),e.jsx(od,{palette:t})]}),e.jsx(wx,{current:t,select:n})]})},nL=["quantize","quantile","linear","threshold"],aL=()=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"fa fa-chevron-right"}),e.jsx("span",{className:"fa fa-chevron-right"}),e.jsx("span",{className:"fa fa-chevron-right"})]}),rL=()=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"fa fa-chevron-left"}),e.jsx("span",{className:"fa fa-chevron-left"}),e.jsx("span",{className:"fa fa-chevron-left"})]}),oL=({current:t,edit:s,editAll:n,dataDomain:r})=>{const{type:a,range:l,domain:i}=t,[c,d]=w.useState(!1),u=w.useCallback(g=>{d(x=>!x)},[]),p=w.useCallback(g=>{d(!1)},[]),m=w.useCallback(g=>{const x=g.target.value;n([[["colors","value","type"],x],[["colors","value","domain"],void 0]]),x!=="threshold"&&d(!1)},[n,r]),h=w.useCallback(g=>{s(["colors","value","range"],[...g])},[s]),f=w.useCallback(g=>{s(["colors","value","domain"],g)},[s]);return e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex border-b-2 border-gray-600 mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 whitespace-nowrap w-32",children:"Scale Type:"}),e.jsx("select",{value:a,onChange:m,className:"text-xs font-medium px-2 py-1 bg-white",children:nL.map(g=>e.jsx("option",{value:g,children:g},g))})]}),e.jsx("div",{className:"flex-1 flex items-center justify-end",children:a!=="threshold"?null:e.jsxs("button",{onClick:u,className:"px-2 py-1 text-xs font-medium rounded-none bg-white",style:{outline:"none",border:"none"},children:[e.jsxs("span",{className:"mr-4",children:[c?"Close":"Open"," Threshold Editor"]}),c?e.jsx(rL,{}):e.jsx(aL,{})]})})]}),e.jsxs("div",{className:"flex items-center border-b-2 border-gray-600 mb-1",children:[e.jsx("span",{className:"mr-2 whitespace-nowrap w-32",children:"Scale Range:"}),e.jsx(od,{palette:l})]})]})}),e.jsx(wx,{current:l,select:h}),e.jsx("div",{className:`
          w-1/2 absolute right-0 top-0 bottom-0 bg-gray-400
          ${c?"block":"hidden w-0 h-0 p-0 overflow-hidden"}
        `,children:e.jsx(lL,{dataDomain:r,domain:i||[],range:l,edit:f,type:a,children:e.jsx("button",{style:{transform:"translate(-50%, -150%)"},className:`
              w-8 h-8 rounded absolute
              flex items-center justify-center
              bg-gray-400 hover:bg-gray-500
              top-0 right-0 border-0
            `,onClick:p,children:e.jsx("span",{className:"fa fa-close"})})})})]})},Nx=Mt(",d"),Vr=Mt(",.2f"),xn=({label:t,children:s})=>e.jsxs("div",{className:"flex py-2 items-center",children:[t?e.jsx("div",{className:"w-20 text-right font-bold",children:t}):null,e.jsx("div",{className:"flex-1 text-right",children:s})]}),xm=(t,s)=>{const[n,r]=ur(t),a=r-n,l=Math.round(a/(s+1));return ws(s+1).reduce((i,c)=>{if(!i.length)i.push(n+l);else{if(i.length===s)return i;{const d=i[i.length-1];i.push(d+l)}}return i},[])},lL=({dataDomain:t,domain:s,range:n,edit:r,children:a,type:l})=>{const[i,c]=w.useState([]);w.useEffect(()=>{if(l==="threshold"&&t.length&&i.length!==n.length+1){const _=xm(t,n.length-1);r(_),c([..._])}},[t,n.length,r,l]);const d=w.useCallback((_,E)=>{c(L=>{const S=[...L];return S[E]=_,S.sort((k,$)=>k-$)})},[]),u=w.useCallback(_=>{c(E=>[...E,0])},[]),p=w.useCallback(_=>{c(E=>E.filter(L=>L!==_))},[]),m=w.useMemo(()=>i.length+1===n.length&&!Fe(i,s),[n,i]),h=w.useCallback(_=>{m&&r([...i])},[r,m,i]),f=w.useCallback(_=>{c(xm(t,n.length-1))},[t,n]),{count:g,min:x,max:y,mean:j,median:N}=w.useMemo(()=>{const[_,E]=ur(t);return{count:Nx(t.length),min:Vr(_),max:Vr(E),mean:Vr(By(t)),median:Vr(Ay(t))}},[t]);return e.jsxs("div",{className:`
        px-6 py-2 relative h-full relative
      `,children:[a,e.jsx("div",{className:"font-bold text-xl",children:"Threshold Editor"}),e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold border-b-2 border-current",children:"Data Statistics:"}),e.jsxs("pre",{children:[e.jsxs(xn,{label:"Count:",children:[g,"   "]}),e.jsx(xn,{label:"Minimum:",children:x}),e.jsx(xn,{label:"Mean:",children:j}),e.jsx(xn,{label:"Median:",children:N}),e.jsx(xn,{label:"Maximum:",children:y})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold border-b-2 border-current",children:"Current Thresholds:"}),e.jsxs("pre",{children:[i.map((_,E)=>e.jsx(xn,{children:e.jsx(iL,{value:_,index:E,edit:d,remove:p})},_)),e.jsx(xn,{children:e.jsx("span",{className:"fa fa-plus hover:text-green-500 cursor-pointer",onClick:u})})]})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 grid grid-cols-2 gap-8 px-6 pb-8",children:[e.jsx(En,{onClick:f,children:"Reset Thresholds"}),e.jsx(En,{onClick:h,disabled:!m,children:"Save Thresholds"})]})]})]})},iL=({value:t,index:s,remove:n,edit:r})=>{const a=w.useCallback(h=>{n(t)},[n,t]),[l,i]=w.useState(!1),[c,d]=w.useState(""),u=w.useCallback(h=>{d(h.target.value)},[]),p=w.useCallback(h=>{i(!0),d(String(t))},[t]),m=w.useCallback(h=>{r(+c,s),i(!1),d("")},[r,s,c]);return w.useEffect(()=>{t===0&&i(!0)},[t]),e.jsxs(e.Fragment,{children:[l?e.jsx("input",{value:c,onChange:u,className:"px-2 py-1 text-right",style:{outline:"none",border:"none"}}):Nx(t),l?e.jsx("span",{className:"ml-4 fa fa-floppy-disk hover:text-green-600 cursor-pointer",onClick:m}):e.jsx("span",{className:"ml-4 fa fa-edit hover:text-blue-600 cursor-pointer",onClick:p}),e.jsx("span",{className:"ml-4 fa fa-trash hover:text-red-600 cursor-pointer",onClick:a})]})},cL=({editKey:t,edit:s,current:n})=>{const r=w.useCallback(a=>{s([t],a)},[t,s]);return e.jsx("div",{children:e.jsx(Mw,{value:n,onChange:r})})},bm=({isOpen:t,children:s})=>(w.useCallback(n=>{n.stopPropagation()},[]),e.jsx("div",{className:`
        pointer-events-none
        ${t?"fixed inset-0 z-50":"hidden h-0 w-0 overflow-hidden"}
      `,children:s})),En=({style:t={},...s})=>e.jsx("button",{...s,style:{outline:"none",...t},className:`
        px-4 py-2 cursor-pointer w-full font-medium text-xs bg-white
        border-0 border-none outline-0 ring-0 rounded-none relative
        disabled:cursor-not-allowed disabled:opacity-50
      `}),Cx=({value:t,onChange:s})=>{const n=w.useCallback(r=>{s(!t)},[s,t]);return e.jsx("div",{className:"px-4 py-3 bg-white flex items-center cursor-pointer w-full",onClick:n,children:e.jsx("div",{className:`
          rounded-full w-full h-2 relative transition duration-500
          ${t?"bg-green-300":"bg-gray-300"}
        `,children:e.jsx("div",{style:{transform:"translate(-50%, -25%)",transition:"left 500ms"},className:`
            w-4 h-4 rounded-full absolute transition duration-500
            ${t?"left-full bg-green-700":"left-0 bg-gray-700"}
          `})})})},dL=({value:t,onChange:s,...n})=>{const r=w.useCallback(a=>{s(a.target.value)},[s]);return e.jsx("div",{className:"w-full",children:e.jsx("input",{...n,className:`
          px-4 py-2 bg-white cursor-pointer w-full font-medium text-xs
          outline-none
        `,value:t,onChange:r})})},uL=({value:t,onChange:s,options:n})=>{const r=w.useCallback(a=>{s(a.target.value)},[s]);return e.jsx("div",{className:"w-60",children:e.jsx("select",{value:t,onChange:r,className:`
          px-4 py-2 bg-white cursor-pointer w-full font-medium text-xs
          border-0 border-none outline-0 ring-0 rounded-none
        `,children:n.map(a=>e.jsx("option",{value:a,children:a},a))})})},jt=({path:t,type:s,value:n,onChange:r,...a})=>{const l=w.useCallback(i=>{r(t,s==="number"?+i:i)},[t,r,s]);return e.jsx("div",{className:"w-60",children:s==="boolean"?e.jsx(Cx,{value:n,onChange:l}):s==="select"?e.jsx(uL,{...a,value:n,onChange:l}):e.jsx(dL,{type:s,...a,value:n,onChange:l})})},mL=["start","center","end"],pL=["lighter","normal","bold"],hL=Mt(".2r"),Kl=(t,s)=>n=>`${hL(n/t)}${s}`,Qa={Integer:",d","Fixed Point - 2 deciamls":",.2f","Fixed Point - 1 deciaml":",.1f","SI-suffix - 3 significant digits":".3s","SI-suffix - 2 significant digits":".2s",Millions:Kl(1e6,"m"),Billions:Kl(1e9,"bn"),Trillions:Kl(1e12,"tr")},fL=Object.keys(Qa),gL=({format:t,edit:s,activeGraphType:n,dataDomain:r})=>{const a=w.useCallback((_,E)=>{s([[_,E]])},[s]),l=w.useCallback(_=>{s(_)},[s]),[i,c]=w.useState(!1),d=w.useCallback(_=>{_.stopPropagation(),c(!0)},[]),u=w.useCallback(_=>{_.stopPropagation(),c(!1)},[]),[p,m]=w.useState(null),h=w.useCallback((_,E)=>{_.stopPropagation(),m(E)},[]),f=w.useCallback((_,E)=>{_.stopPropagation(),m(null)},[]),g=w.useMemo(()=>_L[n.GraphComp],[n]),x=w.useMemo(()=>C(t,"textColor"),[t]),y=w.useMemo(()=>C(t,"bgColor"),[t]),j=w.useMemo(()=>{const{type:_,value:E}=t.colors;return _==="palette"?E:E.range},[t]),N=w.useMemo(()=>C(t,"orientation","vertical"),[t]);return e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[e.jsx("div",{className:"font-bold text-xl col-span-2",children:"Graph Options"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"General"}),e.jsxs("div",{className:"pl-4 text-sm",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Height"}),e.jsx(jt,{type:"number",path:["height"],value:C(t,["height"],0),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Background Color"}),e.jsx("div",{className:"w-60",children:e.jsx(En,{onClick:_=>h(_,"bgColor"),style:{backgroundImage:`linear-gradient(to right, ${y}, ${x}, ${y})`,color:y},children:"Open Color Selector"})})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Grid / Text Color"}),e.jsx("div",{className:"w-60",children:e.jsx(En,{onClick:_=>h(_,"textColor"),style:{backgroundImage:`linear-gradient(to right, ${x}, ${y}, ${x})`,color:x},children:"Open Color Selector"})})]}),e.jsx(bm,{isOpen:!!p,children:e.jsxs("div",{className:`
                h-[42.5vh] bg-gray-300 absolute bottom-0 left-0 right-0
                pointer-events-auto
              `,children:[e.jsx("button",{style:{transform:"translate(50%, -150%)"},className:`
                  w-8 h-8 rounded absolute
                  flex items-center justify-center
                  bg-gray-300 hover:bg-gray-400
                  top-0 left-0 border-0
                `,onClick:f,children:e.jsx("span",{className:"fa fa-close"})}),e.jsx(cL,{editKey:p,edit:a,current:C(t,p)})]})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold",children:[n.type," Options"]}),e.jsxs("div",{className:"pl-4 text-sm",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Palette"}),e.jsx("div",{className:"w-60",children:e.jsx(En,{onClick:d,style:{backgroundImage:`linear-gradient(to right, ${j})`,color:y},children:"Open Palette Editor"})})]}),e.jsx(bm,{isOpen:i,children:e.jsxs("div",{className:`
                h-[42.5vh] bg-gray-300 absolute bottom-0 left-0 right-0
                pointer-events-auto
              `,children:[e.jsx("button",{style:{transform:"translate(50%, -150%)"},className:`
                  w-8 h-8 rounded absolute
                  flex items-center justify-center
                  bg-gray-300 hover:bg-gray-400
                  top-0 left-0 border-0
                `,onClick:u,children:e.jsx("span",{className:"fa fa-close"})}),e.jsx(eL,{edit:a,editAll:l,format:t,graphType:n.type,dataDomain:r})]})}),g.map(({label:_,path:E,defaultValue:L,...S})=>e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:_}),e.jsx(jt,{...S,path:E,value:C(t,E,L),onChange:a})]},_))]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Margins"}),e.jsxs("div",{className:"pl-4 text-sm",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Top"}),e.jsx(jt,{type:"number",path:["margins","marginTop"],value:C(t,["margins","marginTop"],0),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Right"}),e.jsx(jt,{type:"number",path:["margins","marginRight"],value:C(t,["margins","marginRight"],0),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Bottom"}),e.jsx(jt,{type:"number",path:["margins","marginBottom"],value:C(t,["margins","marginBottom"],0),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Left"}),e.jsx(jt,{type:"number",path:["margins","marginLeft"],value:C(t,["margins","marginLeft"],0),onChange:a})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Title"}),e.jsxs("div",{className:"pl-4 text-sm",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Title"}),e.jsx(jt,{type:"text",path:["title","title"],value:C(t,["title","title"],""),placeholder:"Enter a title...",onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Position"}),e.jsx(jt,{type:"select",options:mL,path:["title","position"],value:C(t,["title","position"],""),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Font Size"}),e.jsx(jt,{type:"number",min:10,path:["title","fontSize"],value:C(t,["title","fontSize"],""),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Font Weight"}),e.jsx(jt,{type:"select",options:pL,path:["title","fontWeight"],value:C(t,["title","fontWeight"],""),onChange:a})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Legend"}),e.jsxs("div",{className:"pl-4 text-sm",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Show Legend"}),e.jsx(jt,{type:"boolean",path:["legend","show"],value:C(t,["legend","show"],!0),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Width"}),e.jsx(jt,{type:"number",min:50,path:["legend","width"],value:C(t,["legend","width"],""),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Height"}),e.jsx(jt,{type:"number",min:50,path:["legend","height"],value:C(t,["legend","height"],""),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Label"}),e.jsx(jt,{type:"text",path:["legend","label"],value:C(t,["legend","label"],""),onChange:a})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Tooltip"}),e.jsxs("div",{className:"pl-4 text-sm",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Show Tooltip"}),e.jsx(jt,{type:"boolean",path:["tooltip","show"],value:C(t,["tooltip","show"],!0),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Font Size"}),e.jsx(jt,{type:"number",min:10,path:["tooltip","fontSize"],value:C(t,["tooltip","fontSize"],!0),onChange:a})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold",children:["X Axis (",N==="vertical"?"bottom axis":"left axis",")"]}),e.jsxs("div",{className:"pl-4 text-sm",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Label"}),e.jsx(jt,{type:"text",path:["xAxis","label"],value:C(t,["xAxis","label"],""),placeholder:"Enter a label...",onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Show Grid Lines"}),e.jsx(jt,{type:"boolean",path:["xAxis","showGridLines"],value:C(t,["xAxis","showGridLines"],""),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Tick Spacing"}),e.jsx(jt,{type:"number",min:1,path:["xAxis","tickSpacing"],value:C(t,["xAxis","tickSpacing"]),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Rotate Labels"}),e.jsx(jt,{type:"boolean",path:["xAxis","rotateLabels"],value:C(t,["xAxis","rotateLabels"],!1),onChange:a})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold",children:["Y Axis (",N==="vertical"?"left axis":"bottom axis",")"]}),e.jsxs("div",{className:"pl-4 text-sm",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Label"}),e.jsx(jt,{type:"text",path:["yAxis","label"],value:C(t,["yAxis","label"],""),placeholder:"Enter a label...",onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Show Grid Lines"}),e.jsx(jt,{type:"boolean",path:["yAxis","showGridLines"],value:C(t,["yAxis","showGridLines"],""),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Value Format"}),e.jsx(jt,{type:"select",options:fL,path:["yAxis","tickFormat"],value:C(t,["yAxis","tickFormat"],""),onChange:a})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/3 flex items-center",children:"Rotate Labels"}),e.jsx(jt,{type:"boolean",path:["yAxis","rotateLabels"],value:C(t,["yAxis","rotateLabels"],!1),onChange:a})]})]})]})]})},_x=(t,s,n="index")=>w.useMemo(()=>Py(t.map(a=>a[n])).reduce((a,l,i)=>(i%s===0&&a.push(l),a),[]),[t,s]),Sx=t=>{const{data:s,margins:n,height:r,width:a,xAxis:l,yAxis:i,colors:c,legend:d}=t,u=_x(s,l.tickSpacing),p=w.useMemo(()=>{const{marginTop:m,marginBottom:h}=n;return m+h>r?m+h+100:r},[r,n]);return w.useMemo(()=>({x:{type:"point",label:l.label,grid:l.showGridLines,textAnchor:l.rotateLabels?"start":"middle",tickRotate:l.rotateLabels?45:0,axis:"bottom",ticks:u},y:{axis:"left",grid:i.showGridLines,tickFormat:Qa[i.tickFormat],label:i.label},color:{legend:d.show,width:d.width,height:d.height,label:d.label,range:c.value},height:p,width:a,...n}),[n,p,a,l,i,c,d])},xL=t=>{const{data:s,margins:n,height:r,width:a,xAxis:l,yAxis:i,colors:c,bgColor:d,legend:u,tooltip:p,groupMode:m="stacked",orientation:h="vertical"}=t,f=c.type==="palette",g=m==="stacked",x=h==="vertical",[y,j]=w.useState(null),N=_x(s,l.tickSpacing),_=w.useMemo(()=>{const{marginTop:T,marginBottom:A}=n;return T+A>r?T+A+100:r},[r,n]),[E,L]=w.useMemo(()=>x?[Dy,bc]:[Ry,Fy],[x]),S=w.useMemo(()=>x?{type:"band",axis:"bottom",label:g?l.label:null,grid:l.showGridLines,textAnchor:l.rotateLabels?"start":"middle",tickRotate:l.rotateLabels?45:0,ticks:g?N:void 0}:{axis:"bottom",grid:i.showGridLines,tickFormat:Qa[i.tickFormat],textAnchor:i.rotateLabels?"start":"middle",tickRotate:i.rotateLabels?45:0,label:g?i.label:null},[x,g,l,i,N]),k=w.useMemo(()=>x?{axis:"left",grid:i.showGridLines,textAnchor:i.rotateLabels?"start":"middle",tickRotate:i.rotateLabels?45:0,tickFormat:Qa[i.tickFormat],label:g?i.label:null}:{type:"band",axis:"left",label:g?l.label:null,grid:l.showGridLines,textAnchor:l.rotateLabels?"start":"middle",tickRotate:l.rotateLabels?45:0,ticks:g?N:void 0},[x,g,l,i,N]),$=w.useMemo(()=>g||!x?void 0:{axis:"top",ticks:N,label:l.label},[g,x,N,l]),I=w.useMemo(()=>g||x?void 0:{axis:"left",ticks:N,label:i.label},[g,x,N,i]);return w.useEffect(()=>{if(!y||!s.length)return;const T=[L([0]),E(s,g?{x:x?"index":"value",y:x?"value":"index",fill:f?"type":"value",sort:x?{x:"x",order:null}:{y:"y",order:null}}:{x:x?"type":"value",fx:x?"index":void 0,y:x?"value":"type",fy:x?void 0:"index",fill:f?"type":"value",sort:x?{fx:"x",order:null}:{fy:"y",order:null}})];p.show&&x?T.push(ho(s,xp(Vy({x:"index",y:"value"})))):p.show&&!x&&T.push(ho(s,Hy({fill:d,fontSize:p.fontSize,x:"value",y:"index"})));const A=yc({x:S,fx:$,y:k,fy:I,color:{legend:u.show,width:u.width,height:u.height,label:u.label,range:f?c.value:c.value.range,domain:c.value.domain||void 0,type:f?void 0:c.value.type,tickFormat:f?void 0:Qa[i.tickFormat]},height:_,width:a,...n,marks:T});return y.append(A),()=>A.remove()},[y,s,n,_,a,i,p,c,u,f,g,x,S,k,$,I]),e.jsx("div",{ref:j})},bL={type:"Bar Graph",GraphComp:"BarGraph",Component:xL,EditorOptions:[{label:"Orientation",type:"select",path:["orientation"],options:["vertical","horizontal"],defaultValue:"vertical"},{label:"Group Mode",type:"select",path:["groupMode"],options:["stacked","grouped"],defaultValue:"stacked"}]},yL=t=>{const{data:s,bgColor:n,tooltip:r}=t,[a,l]=w.useState(null),i=Sx(t);return w.useEffect(()=>{if(!a||!s.length)return;const c=[bc([0]),zy(s,{x:"index",y:"value",stroke:"type",sort:{x:"x",order:null}})];r.show&&c.push(ho(s,xp({fill:n,fontSize:r.fontSize,x:"index",y:"value"})));const d=yc({...i,marks:c});return a.append(d),()=>d.remove()},[a,s,i,r,n]),e.jsx("div",{ref:l})},vL={type:"Line Graph",GraphComp:"LineGraph",Component:yL},jL=t=>{const{data:s,bgColor:n,tooltip:r}=t,[a,l]=w.useState(null),i=Sx(t);return w.useEffect(()=>{if(!a||!s.length)return;const c=[bc([0]),Uy(s,{x:"index",y:"value",stroke:"type",sort:{x:"x",order:null}}),Wy(s,Ld({x:"index",y:"value",textFill:n}))];r.show&&c.push(ho(s,Ld({fill:n,fontSize:r.fontSize,x:"index",y:"value"})));const d=yc({...i,marks:c});return a.append(d),()=>d.remove()},[a,s,i,n,r]),e.jsx("div",{ref:l})},wL={type:"Scatter Plot",GraphComp:"ScatterPlot",Component:jL},NL=[bL,vL,wL],[$x,CL,_L]=NL.reduce((t,s)=>{const{type:n,GraphComp:r,Component:a,EditorOptions:l}=s;return t[0].push({type:n,GraphComp:r}),t[1][r]=a,t[2][r]=l||[],t},[[],{},{}]),SL=t=>CL[t],$L=({activeGraphType:t,setActiveGraphType:s})=>e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Graphs"}),e.jsx(Nn,{options:$x,accessor:n=>n.type,value:t,onChange:s,placeholder:"Select a graph..."})]}),EL=()=>e.jsx("div",{children:"You Must Add Data Columns to Graph Before Adding Filters"}),kL=["equals","includes"],LL=Mt(",d"),IL=Mt(",.2f"),TL=t=>zs(t)?t:Math.floor(+t)===+t?LL(t):IL(t),ML=t=>{const{columns:s,viewData:n,filters:r,addFilter:a,removeFilter:l,activeView:i,pgEnv:c}=t,d=w.useMemo(()=>{const I=r.reduce((T,A)=>(T.add(A.column),T),new Set);return s.filter(T=>!I.has(T.name))},[s,r]),[u,p]=w.useState(null),[m,h]=w.useState(null),f=m==="includes",g=Fk({activeView:i,column:u,pgEnv:c}),[x,y]=w.useState([]),j=w.useCallback(I=>{I==="equals"&&y(T=>T.slice(0,1)),h(I)},[]),N=w.useCallback(I=>{y([I])},[]),_=w.useCallback(I=>{y(I)},[]),E=w.useCallback(I=>{f?_(I):N(I)},[f,N,_]),L=w.useMemo(()=>f?x:x[0],[x,f]),S=w.useMemo(()=>!!x.length,[x]),k=w.useCallback(I=>{I.stopPropagation(),a({column:u,type:m,values:x}),p(null),h(null),y([])},[u,m,x,a]),$=w.useCallback(I=>{p(null),h(null),y([])},[]);return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"font-bold text-xl col-span-2",children:"Graph Filters"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.length?e.jsx(Nn,{placeholder:"Select a column...",options:d,accessor:hn,value:u,onChange:p}):e.jsx(EL,{}),u?e.jsx(Nn,{placeholder:"Select a filter type...",options:kL,value:m,onChange:j}):null]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:!g.length||!m?null:e.jsx(Nn,{multi:f,removable:!0,placeholder:`Select filter ${f?"values":"value"}`,options:g,accessor:I=>`${I.value} (count ${I.count})`,valueAccessor:I=>I.value,value:L,onChange:E})}),e.jsxs("div",{className:"col-span-2 grid grid-cols-2 gap-4",children:[e.jsx(En,{onClick:$,children:"Reset Filter Settings"}),e.jsx(En,{disabled:!S,onClick:k,children:"Add Filter"})]}),r.length?e.jsx("div",{className:"col-span-2",children:e.jsx(AL,{filters:r,remove:l})}):null]})},BL=({filter:t,remove:s})=>{const n=w.useCallback(r=>{r.stopPropagation(),s(t)},[s,t]);return e.jsxs("tr",{children:[e.jsx("td",{className:"py-1",children:hn(t.column)}),e.jsx("td",{className:"py-1",children:t.type}),e.jsx("td",{className:"py-1",children:t.values.map(r=>e.jsx("div",{children:TL(r)},r))}),e.jsx("td",{className:"py-1",children:e.jsx("button",{onClick:n,className:`
            px-4 py-1 bg-white rounded
            outline-red-500 hover:outline hover:outline-2
            hover:text-red-500
          `,children:e.jsx("span",{className:"fa fa-trash"})})})]})},AL=({filters:t,remove:s})=>e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-center",children:"Current Filters"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1 border-b border-current",children:"Column Name"}),e.jsx("th",{className:"py-1 border-b border-current",children:"Filter Type"}),e.jsx("th",{className:"py-1 border-b border-current",children:"Filter Value"}),e.jsx("th",{className:"py-1 border-b border-current",children:"Remove Filter"})]})}),e.jsx("tbody",{className:"text-center",children:t.map(n=>e.jsx(BL,{filter:n,remove:s},n.column.name))})]})]}),OL=()=>e.jsx("div",{children:"You Must Add Data Columns to Graph Before Adding a Category"}),PL=t=>{const{columns:s,activeView:n,category:r,setCategory:a}=t;return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"font-bold text-xl col-span-2",children:"Category Selector"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.length?e.jsx(Nn,{removable:!0,placeholder:"Select a column...",options:s,accessor:hn,value:r,onChange:a}):e.jsx(OL,{})})]})},DL=Mt(",d"),RL=t=>{const{state:s}=JSON.parse(t||"{}");return{activeSource:C(s,"activeSource",void 0),activeView:C(s,"activeView",void 0),activeGraphType:C(s,"activeGraphType",$x[0]),xAxisColumn:C(s,"xAxisColumn",void 0),yAxisColumns:C(s,"yAxisColumns",[]),graphFormat:C(s,"graphFormat",Zk()),filters:C(s,"filters",[]),category:C(s,"category",null)}},FL=(t,s)=>{const{type:n,...r}=s;switch(n){case"set-active-source":return{...t,activeSource:r.source,xAxisColumn:void 0,yAxisColumns:[],filters:[],category:null};case"set-active-view":return{...t,activeView:r.view};case"set-active-graph-type":{const a={...t,activeGraphType:r.graph};return r.graph.type==="Line Graph"&&a.graphFormat.colors.type!=="palette"&&(a.graphFormat={...a.graphFormat,colors:{type:"palette",value:[...rd]}}),a}case"set-x-axis-column":return{...t,xAxisColumn:r.column};case"update-x-axis-column":{const{update:a}=r;return{...t,xAxisColumn:{...t.xAxisColumn,...a}}}case"set-y-axis-columns":return{...t,yAxisColumns:r.columns};case"update-y-axis-column":{const{name:a,update:l}=r;return{...t,yAxisColumns:t.yAxisColumns.map(i=>i.name===a?{...i,...l}:i)}}case"edit-graph-format":{const a=In({},t.graphFormat);return r.paths.forEach(([l,i])=>{he(a,l,i)}),{...t,graphFormat:a}}case"add-filter":return{...t,filters:[...t.filters,r.filter]};case"remove-filter":return{...t,filters:t.filters.filter(a=>a!==r.filter)};case"set-category":return{...t,category:r.category};default:return t}},VL=({onChange:t,value:s,pgEnv:n="hazmit_dama"})=>{const[r,a]=w.useReducer(FL,s,RL),l=w.useCallback(M=>{a({type:"set-active-source",source:M})},[]),i=w.useCallback(M=>{a({type:"set-active-view",view:M})},[]),c=w.useCallback(M=>{a({type:"set-active-graph-type",graph:M})},[]),d=w.useCallback(M=>{a({type:"set-x-axis-column",column:M})},[]),u=w.useCallback(M=>{a({type:"update-x-axis-column",update:M})},[]),p=w.useCallback(M=>{a({type:"set-y-axis-columns",columns:M})},[]),m=w.useCallback((M,D)=>{a({type:"update-y-axis-column",name:M,update:D})},[]),h=w.useCallback(M=>{a({type:"edit-graph-format",paths:M})},[]),f=w.useCallback(M=>{a({type:"add-filter",filter:M})},[]),g=w.useCallback(M=>{a({type:"remove-filter",filter:M})},[]),x=w.useCallback(M=>{a({type:"set-category",category:M})},[]),{activeSource:y,activeView:j,activeGraphType:N,xAxisColumn:_,yAxisColumns:E,graphFormat:L,filters:S,category:k}=r,$=w.useMemo(()=>C(r,["activeSource","metadata","value","columns"])||[],[y]),[I,T]=Rk({pgEnv:n,activeView:j,xAxisColumn:_,yAxisColumns:E,filters:S,category:k}),A=w.useMemo(()=>I.map(M=>M.value),[I]),R=w.useMemo(()=>{const{state:M,viewData:D}=JSON.parse(s||"{}");return!!I.length&&(!Fe(M,r)||!Fe(I,D))},[r,I,s]),O=w.useCallback(M=>{R&&t(JSON.stringify({state:r,viewData:I}))},[t,r,I,R]);return w.useEffect(()=>{R&&O()},[R,O]),console.log("DMSGraphComponent::index::viewData",I),e.jsxs("div",{className:"bg-gray-200 p-4 grid grid-cols-1 gap-2",children:[e.jsx(Vk,{pgEnv:n,activeSource:y,setActiveSource:l}),e.jsx(zk,{pgEnv:n,activeSource:y,setActiveView:i,activeView:j}),y?e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Amount of data:"})," ",DL(T)," rows"]}):null,e.jsx($L,{activeGraphType:N,setActiveGraphType:c}),e.jsx(Gk,{columns:$,xAxisColumn:_,setXAxisColumn:d,updateXAxisColumn:u,activeSource:y}),e.jsx(Kk,{columns:$,yAxisColumns:E,setYAxisColumns:p,updateYAxisColumn:m,activeSource:y}),e.jsx(jx,{graphFormat:L,activeGraphType:N,viewData:I}),e.jsx(ML,{columns:$,viewData:I,filters:S,addFilter:f,removeFilter:g,activeView:j,pgEnv:n}),e.jsx(PL,{columns:$,category:k,setCategory:x,activeView:j,pgEnv:n}),e.jsx(gL,{format:L,edit:h,activeGraphType:N,dataDomain:A})]})},HL=({value:t})=>{const{state:s,viewData:n}=w.useMemo(()=>JSON.parse(t||"{}"),[t]);if(!s)return null;const{graphFormat:r,activeGraphType:a}=s;return C(n,"length",0)?e.jsx(jx,{graphFormat:r,activeGraphType:a,viewData:n}):null},zL={name:"DMS Graph Component",type:"Graph",EditComp:VL,ViewComp:HL},UL={"Card: Callout":lm,"Card: Hazard Risk":qE,"Card: Declared vs Non-Declared Loss":h9,"Card: FEMA Disaster Info":J9,"Card: FEMA Disaster Loss Summary":Z9,"Card: Census":ek,"Table: Disasters":H9,"Table: FEMA Disaster Loss by Program":t$,"Table: NRI":e7,"Table: Social Vulnerability":SE,"Table: Social Vulnerability Summary":LE,"Table: Buildings":ME,"Table: Open Fema Data":h7,"Table: Cenrep":w7,"Table: Cenrep II":T7,"Graph: Historic Loss by Disaster Number":n9,"Graph: Historic Loss by Hazard Type":u9,"Graph: Declared vs Non-Declared Loss":o9,"Graph: Census Bar":rk,"Graph: Census Stacked Bar":ck,"Graph: Census Line":pk,"Graph: DMS Graph Component":zL,"Map: Fusion Events Map":u7,"Map: FEMA Disaster Loss":Q$,"Map: NRI":fE,"Map: Social Vulnerability":PE,"Map: Buildings":CE,"Map: Floodplains":xE,"Map: County Status":gk,"Map: County Highlight":yk,"Header: Default Header":Tk,"Header: County Header":Ak,lexical:{...lm,name:"Rich Text",hideInSelector:!1},"Data Text Box":O7,"Search Bar":kk},Zs="nuetral",bn="white",ns="blue",WL={page:{wrapper1:"w-full flex-1 flex flex-col  ",wrapper2:"w-full h-full flex-1 flex flex-row px-1 md:px-6 py-6 bg-gradient-to-r from-[#f8f4ec] to-[#fefefe] flex flex-row",wrapper3:"flex flex-1 w-full  flex-col  relative text-md font-light leading-7 p-4 min-h-[calc(100vh_-_51px)]"},navPadding:{1:"pt-0 ",2:"md:pt-12 pt-0",3:"md:pt-24 pt-0"},sidenav:(t={})=>{const{color:s="white",size:n="compact",subMenuStyle:r="inline",responsive:a="top"}=t;let l={top:"hidden md:block",side:"hidden md:block",none:""},i={white:{contentBg:`bg-${bn}`,contentBgAccent:"bg-neutral-100",accentColor:`${ns}-600`,accentBg:`hover:bg-${ns}-400`,borderColor:`border-${Zs}-100`,textColor:`text-${Zs}-600`,textColorAccent:"text-slate-800",highlightColor:`text-${Zs}-800`},transparent:{contentBg:"bg-neutral-100",contentBgAccent:"bg-neutral-100",accentColor:`${ns}-600`,accentBg:`hover:bg-${ns}-400`,borderColor:`border-${Zs}-100`,textColor:`text-${Zs}-600`,textColorAccent:"text-slate-800",highlightColor:`text-${Zs}-800`},dark:{contentBg:"bg-neutral-800",contentBgAccent:"bg-neutral-900",accentColor:"white",accentBg:"",borderColor:"border-neutral-700",textColor:"text-slate-300",textColorAccent:"text-slate-100",highlightColor:`text-${bn}`},bright:{contentBg:`bg-${ns}-700`,accentColor:`${ns}-400`,accentBg:`hover:bg-${ns}-400`,borderColor:`border-${ns}-600`,textColor:`text-${bn}`,highlightColor:`text-${bn}-500`}},c={none:{wrapper:"w-0 overflow-hidden",sideItem:"flex mx-2 pr-4 py-2 text-base ",topItem:"flex items-center text-sm px-4 border-r h-12",icon:"mr-3 text-lg"},compact:{fixed:"ml-0 md:ml-44",wrapper:"w-44 p-1 pt-4",sideItem:"flex mx-2 pr-4 py-2 text-base ",topItem:"flex items-center text-sm px-4 border-r h-12",icon:"mr-3 text-lg"},full:{fixed:"",wrapper:"w-full",sideItem:"flex px-4 py-2 text-base font-base border-b ",topItem:"flex pr-4 py-2 text-sm font-light",icon:"mr-4 text-2xl"},mini:{fixed:"ml-0 md:ml-20",wrapper:"w-20 overflow-x-hidden p-1 pt-4",sideItem:"flex pr-4 py-4 text-base font-base border-b",topItem:"flex px-4 items-center text-sm font-light ",icon:"w-20 mr-4 text-4xl",sideItemContent:"hidden"},micro:{fixed:"ml-0 md:ml-14",wrapper:"w-14 overflow-x-hidden",itemWrapper:"p-1",sideItem:"flex text-base font-base",topItem:"flex mx-6 pr-4 py-2 text-sm font-light",icon:"w-12 text-2xl hover:bg-neutral-900 px-2 py-3 my-2 rounded-lg mr-4 hover:text-blue-500",sideItemContent:"hidden"}},d={inline:{indicatorIcon:"fa fa-angle-right",indicatorIconOpen:"fa fa-angle-down",subMenuWrapper:"w-full",subMenuParentWrapper:"flex flex-col w-full"},flyout:{indicatorIcon:"fa fa-angle-down",indicatorIconOpen:"fa fa-angle-right",subMenuWrapper:`absolute ml-${c[n].width-8}`,subMenuParentWrapper:"flex flex-row",subMenuWrapperTop:"absolute top-full"}};return{fixed:`md:${c[n].fixed}`,logoWrapper:`${c[n].wrapper} ${i[s].contentBgAccent} ${i[s].textColorAccent}`,sidenavWrapper:`${l[a]} ${i[s].contentBg} ${c[n].wrapper} h-full z-20`,menuIconSide:` text-${i[s].accentColor} ${c[n].icon} group-hover:${i[s].highlightColor}`,itemsWrapper:`${i[s].borderColor} ${c[n].itemWrapper}  `,navitemSide:`
            group font-sans flex flex-col
            ${c[n].sideItem} ${i[s].textColor} ${i[s].borderColor}
            hover:${i[s].highlightColor}
            focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
            transition-all cursor-pointer
         `,navItemContent:`${c[n].sideItemContent}`,navitemSideActive:`
            group font-sans flex flex-col
            ${c[n].sideItem} text-blue-500 ${i[s].borderColor}
            hover:${i[s].highlightColor}
            focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
            transition-all cursor-pointer
          `,...d[r],vars:{colors:i,sizes:c,mobile:l}}},topnav:({color:t="white",size:s="compact"})=>{let n={white:{contentBg:"bg-gradient-to-r from-[#f8f4ec] to-[#fefefe]",accentColor:"[#da4e00]",accentBg:"hover:bg-[#da4e00]",borderColor:`border-${Zs}-100`,textColor:`text-${Zs}-500`,highlightColor:`text-${bn}`},bright:{contentBg:`bg-${ns}-700`,accentColor:`${ns}-400`,accentBg:`hover:bg-${ns}-400`,borderColor:`border-${ns}-600`,textColor:`text-${bn}`,highlightColor:`text-${bn}`}},r={compact:{menu:"hidden md:flex flex-1 justify-end",sideItem:"flex mx-6 pr-4 py-2 text-sm font-light hover:pl-4",topItem:`flex items-center text-lg  font-medium px-8  h-16 ${n[t].textColor} ${n[t].borderColor}
            ${n[t].accentBg} hover:${n[t].highlightColor}`,activeItem:`flex items-center text-lg  font-medium px-8 border-b border-[#da4e00]  h-16 ${n[t].textColor} ${n[t].borderColor}
            ${n[t].accentBg} hover:${n[t].highlightColor}`,icon:"mr-3 text-md fa-fw",responsive:"md:hidden"},inline:{menu:"flex flex-1",sideItem:"flex mx-4 pr-4 py-4 text-base font-base border-b hover:pl-4",topItem:`flex px-4 py-2 mx-2 font-medium text-gray-400 border-b-2 ${n[t].textColor} ${n[t].borderColor}
          hover:border-gray-300 hover:text-gray-700 border-gray-100 `,activeItem:`flex px-4 py-2 mx-2 font-medium text-blue-600 border-b-2 ${n[t].textColor} ${n[t].borderColor} border-blue-600 `,icon:"mr-4 text-2xl",responsive:"hidden"}};return{topnavWrapper:`w-full ${n[t].contentBg} `,topnavContent:"flex w-full h-full",topnavMenu:`${r[s].menu} h-full overflow-x-auto overflow-y-hidden scrollbar-sm`,menuIconTop:`text-[#da4e00] ${r[s].icon} group-hover:${n[t].highlightColor}`,menuOpenIcon:"fa fa-bars",menuCloseIcon:'fa fa-xmark fa-fw"',navitemTop:`
            group font-sans
            ${r[s].topItem}
            focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
            transition cursor-pointer
        `,topmenuRightNavContainer:"hidden md:block h-full",navitemTopActive:` group font-sans
            ${r[s].activeItem}
            focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300
            transition cursor-pointer
          `,mobileButton:`${r[s].responsive} ${n[t].contentBg} inline-flex items-center justify-center p-2  text-gray-400 hover:bg-gray-100 `,vars:{colors:n,sizes:r}}}},GL=t=>{try{JSON.parse(t)}catch{return!1}return!0};function Ex({title:t="",bgClass:s="",subTitle:n="County Profile",link:r="#",mapLayer:a={}}){return e.jsxs("div",{className:"h-[300px] bg-cover bg-center w-full flex   bg-gradient-to-tr from-[#f8f4ec] to-[#fefefe]",children:[e.jsx("div",{className:"p-2 h-full w-[350px] pl-8",children:e.jsx(_r,{layerProps:{ccl:a},legend:{show:!1}})}),e.jsxs("div",{className:"flex-1 flex flex-col  items-center p-4",children:[e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"text-3xl sm:text-7xl font-bold text-[#f2a91a] text-right w-full text-display",children:t&&e.jsx("div",{children:t})}),e.jsx("div",{className:"text-lg tracking-wider pt-2 sm:text-3xl font-bold text-slate-200 text-right w-full uppercase",children:n&&e.jsx("div",{children:n})}),e.jsx("div",{className:"flex-1"})]})]})}async function kx(t,s){var p;const r=["st_asgeojson(st_envelope(ST_Simplify(geom, 0.5)), 9, 1) as geom"],a={from:0,to:0},l=(p=t==null?void 0:t.toString())==null?void 0:p.substring(0,2),i=m=>["dama",rh,"viewsbyId",m,"options",JSON.stringify({filter:{geoid:[l.substring(0,2)]}}),"databyIndex"],c=await s.get([...i(285),a,r]),d=C(c,["json",...i(285),0,r]),u=C(JSON.parse(d),"bbox");return{sources:[{id:"counties",source:{type:"vector",url:"https://tiles.availabs.org/data/tiger_carto.json"}}],layers:[{id:"counties",source:"counties","source-layer":"s365_v778",type:"fill",filter:["==",["string",t.substring(0,2)],["slice",["string",["get","geoid"]],0,2]],paint:{"fill-color":["case",["has",["to-string",["get","geoid"]],["literal",{[t]:"#f2a91a"}]],["get",["to-string",["get","geoid"]],["literal",{[t]:"#f2a91a"}]],"#d0d0ce"]}},{id:"counties-line",source:"counties","source-layer":"s365_v778",type:"line",filter:["in",t.substring(0,2),["slice",["string",["get","geoid"]],0,2]],paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,22,1],"line-color":"#efefef","line-opacity":.5}}],mapFocus:u}}const JL=async({geoid:t,title:s,subTitle:n,link:r="2023 Update"},a)=>{console.log("county header getData",s);const l=await kx(t,a);return{title:s,subTitle:n,link:r,mapLayer:l}},Lx=({value:t,onChange:s,size:n})=>{let r=b.useMemo(()=>t&&GL(t)?JSON.parse(t):{},[t]);b.useState(!0),b.useState("");const[a,l]=b.useState({geoid:r.geoid||"36001",title:r.title||"",subTitle:r.subTitle||"County Profile",link:r.link||"2023 Update",mapLayer:r.mapLayer||kx(r.geoid||"36001")});return b.useEffect(()=>{t!==JSON.stringify(a)&&s(JSON.stringify(a))},[a]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-md border-blue-500 bg-blue-50 p-2 m-1",children:[e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Title:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.title,onChange:i=>l({...a,title:i.target.value})})})]}),e.jsx(rt,{value:a.geoid,onChange:i=>l({...a,geoid:i}),className:"flex-row-reverse"}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"subTitle:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.subTitle,onChange:i=>l({...a,subTitle:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Note:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.note,onChange:i=>l({...a,note:i.target.value})})})]}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-between",children:[e.jsx("label",{className:"shrink-0 pr-2 py-1 my-1 w-1/4",children:"Bg Class:"}),e.jsx("div",{className:"flex flex row w-3/4 shrink my-1",children:e.jsx("input",{type:"text",value:a.bgClass,onChange:i=>l({...a,bgClass:i.target.value})})})]})]}),e.jsx(Ex,{...a})]})})},qL=({value:t})=>{if(!t)return"";let s=typeof t=="object"?t["element-data"]:JSON.parse(t);return e.jsx(Ex,{...s})};Lx.settings={hasControls:!0,name:"ElementEdit"};const KL={name:"Header: County 2",type:"Header",variables:[{name:"geoid",default:"36001"},{name:"title",default:"MitigateNY"},{name:"subTitle",default:"New York State Hazard Mitigation Plan"},{name:"link",default:""}],getData:JL,EditComp:Lx,ViewComp:qL},ym=[{value:"wind",name:"Wind"},{value:"wildfire",name:"Wildfire"},{value:"tsunami",name:"Tsunami/Seiche"},{value:"tornado",name:"Tornado"},{value:"riverine",name:"Flooding"},{value:"lightning",name:"Lightning"},{value:"landslide",name:"Landslide"},{value:"icestorm",name:"Ice Storm"},{value:"hurricane",name:"Hurricane"},{value:"heatwave",name:"Heat Wave"},{value:"hail",name:"Hail"},{value:"earthquake",name:"Earthquake"},{value:"drought",name:"Drought"},{value:"avalanche",name:"Avalanche"},{value:"coldwave",name:"Coldwave"},{value:"winterweat",name:"Snow Storm"},{value:"volcano",name:"Volcano"},{value:"coastal",name:"Coastal Hazards"}],YL=t=>{const[s,n]=w.useState({dataset:"severeWeather",datasets:[{name:"AVAIL Fusion Events Data",value:"severeWeather"},{name:"AVAIL Fusion Annual County Data",value:"sba"}],state_fips:null,county:"",geolevel:"counties",geolevels:[{name:"County",value:"counties",disabled:!1},{name:"Municipality",value:"cousubs",disabled:!0},{name:"Tracts",value:"tracts",disabled:!0}],geolevels_sba:[{name:"County",value:"counties",disabled:!1},{name:"Zip Codes",value:"zip_codes",disabled:!0}],hazard:new Map,user_hazards:[],data:[],loading:!1,changed:!1});let r=[],a=[];return e.jsx("form",{children:e.jsx("div",{className:"w-full max-w-full ",children:e.jsxs("div",{className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Data Download"})}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 row-gap-6 col-gap-4 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-6",children:[e.jsxs("label",{htmlFor:"username",className:"block text-sm font-medium leading-5 text-gray-700 flex-initial",children:["Data Set ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("div",{className:"mt-1 flex rounded-md shadow-sm",children:e.jsx("select",{className:"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500",onChange:()=>{},value:s.dataset,id:"dataset",required:!0,children:s.datasets.map((l,i)=>e.jsx("option",{value:l.value,children:l.name},i))})}),e.jsx("div",{className:"text-red-600 text-xs",children:s.dataset===""?"Please select a dataset":null})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsxs("label",{htmlFor:"username",className:"block text-sm font-medium leading-5 text-gray-700 flex-initial",children:["State ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("div",{className:"mt-1 flex rounded-md shadow-sm",children:e.jsxs("select",{className:"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500",onChange:()=>{},value:s.state_fips,id:"state_fips",children:[e.jsx("option",{value:"",children:"---Select a state---"},0),r.length>0?r.map((l,i)=>e.jsx("option",{value:l.fips,children:l.name},i+1)):null]})}),e.jsx("div",{className:"text-red-600 text-xs",children:s.state_fips?null:"Please select a State"})]}),e.jsxs("div",{className:"sm:col-span-6",children:[e.jsx("label",{htmlFor:"county",className:"block text-sm font-medium leading-5 text-gray-700",children:"County"}),e.jsx("div",{className:"mt-1 flex rounded-md shadow-sm",children:e.jsxs("select",{className:"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500",onChange:()=>{},value:s.county,id:"county",children:[e.jsx("option",{value:"",children:"---Select all Counties---"},0),a.length>0?a.map((l,i)=>e.jsx("option",{value:l.value,children:l.name},i+1)):null]})})]}),e.jsx("div",{className:"sm:col-span-6",children:e.jsx("div",{className:"mt-6 ",children:e.jsxs("fieldset",{children:[e.jsxs("div",{className:"relative flex items-start",children:[e.jsxs("div",{className:"flex items-center h-5",children:[e.jsxs("legend",{className:"text-base font-medium text-gray-900 flex-initial",children:["Hazards ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{id:"hazard",type:"checkbox",name:"all",value:"all",className:"form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out ml-2",onChange:()=>{},checked:s.hazard.get(...ym.map(l=>l.value===!0?l.value:!1))})]}),e.jsx("div",{className:"ml-3 text-sm leading-5",children:e.jsx("label",{htmlFor:"comments",className:"font-medium text-gray-700",children:"Select All"})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:ym.map((l,i)=>e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"hazard",type:"checkbox",name:l.name,value:l.value,className:"form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out",onChange:()=>{},checked:s.hazard.get(l.value)})}),e.jsx("div",{className:"ml-3 text-sm leading-5",children:e.jsx("label",{htmlFor:"comments",className:"font-medium text-gray-700",children:l.name})})]})},i))}),e.jsx("div",{className:"text-red-600 text-xs",children:s.hazard.size===0?"Please select at least one hazard":null})]})})}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"flex justify",children:Gy(s.data)||s.changed?e.jsxs("button",{onClick:()=>{},className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded inline-flex items-center",children:[e.jsx("svg",{className:"fill-current w-4 h-4 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"})}),e.jsx("span",{children:"Export Data"})]}):e.jsxs("button",{className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded inline-flex items-center",children:[e.jsx("svg",{className:"fill-current w-4 h-4 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"})}),e.jsx(CSVLink,{style:{width:"100%"},data:s.data,filename:`${s.state_fips&&s.state_fips!==""?(void 0).props.geoData[s.state_fips].name:""}_${s.dataset}_${s.county!==""?(void 0).props.geoData[s.county].name:"all"}_${s.geolevel}.csv`,children:"Download CSV"})]})}),s.loading?"Fetching Data ...":null]})]})]})})})};function Ix(){return e.jsx("div",{className:"mt-0 min-h-screen",children:e.jsxs("div",{className:"relative max-w-screen-xl mx-auto pt-12 px-4 sm:px-6 lg:px-8",children:[e.jsxs("svg",{className:"absolute top-0 left-full transform -translate-x-1/2 -translate-y-3/4 lg:left-auto lg:right-full lg:translate-x-2/3 lg:translate-y-1/4",width:404,height:784,fill:"none",viewBox:"0 0 404 784",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"8b1b5f72-e944-4457-af67-0c6d15a99f38",x:0,y:0,width:20,height:20,patternUnits:"userSpaceOnUse",children:e.jsx("rect",{x:0,y:0,width:4,height:4,className:"text-gray-200",fill:"currentColor"})})}),e.jsx("rect",{width:404,height:784,fill:"url(#8b1b5f72-e944-4457-af67-0c6d15a99f38)"})]}),e.jsxs("div",{className:"relative lg:grid lg:grid-cols-3 lg:col-gap-8",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("h3",{className:"text-3xl leading-9 font-extrabold tracking-tight text-gray-900 sm:text-4xl sm:leading-10",children:"Download Data for Planning."}),e.jsxs("div",{className:"mt-10 sm:grid sm:grid-cols-2 sm:col-gap-8 sm:row-gap-10 lg:col-span-2 lg:mt-0",children:[e.jsx("div",{className:"mt-10 sm:mt-0 col-span-2",children:e.jsxs("div",{className:"mt-5",children:[e.jsx("h4",{className:"text-lg leading-6 font-medium text-gray-900"}),e.jsx("p",{className:"mt-2 text-base leading-6 text-gray-500",children:"This page allows users to download natural hazard loss data at a variety of geographies including the NCEI Storm Events Data, the SBA Disaster Loans, and the FEMA Public Assistance and Individual Assistance datasets. Below you can find instructions for setting specific parameters to download the data that works for you."})]})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"mt-5",children:[e.jsx("h4",{className:"text-lg leading-6 font-medium text-gray-900",children:"National Data"}),e.jsx("p",{className:"mt-2 text-base leading-6 text-gray-500",children:"To download national data simply the select the dataset of your choice and leave all filters unselected. Click export data."})]})}),e.jsx("div",{className:"mt-10 sm:mt-0 col-span-2",children:e.jsxs("div",{className:"mt-5 col",children:[e.jsx("h4",{className:"text-lg leading-6 font-medium text-gray-900",children:"County Data"}),e.jsx("p",{className:"mt-2 text-base leading-6 text-gray-500",children:"You can pull any of the three datasets for any state or county the United States and Puerto Rico by using the State filter to select the state or county. You can also select the state first and the use the County filter to select all of the counties or a single county within that state."})]})}),e.jsx("div",{className:"mt-10 sm:mt-0 col-span-2"})]})]}),e.jsx("div",{className:"mt-10 sm:grid sm:grid-cols-2 sm:col-gap-8 sm:row-gap-10 lg:col-span-2 lg:mt-0",children:e.jsx("div",{className:"w-full sm:grid sm:col-gap-8 sm:row-gap-10 lg:col-span-2 lg:mt-0 pl-4",children:e.jsx(YL,{})})})]})]})})}const ZL=async({geoid:t,title:s,subTitle:n,link:r="2023 Update"},a)=>{console.log("county header getData",s);const l=await getMapLayer(t,a);return{title:s,subTitle:n,link:r,mapLayer:l}},Tx=({value:t,onChange:s,size:n})=>e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"relative",children:e.jsx(Ix,{})})}),XL=({value:t})=>{if(!t)return"";let s={};return e.jsx(Ix,{...s})};Tx.settings={hasControls:!0,name:"ElementEdit"};const QL={name:"Header: Data Download",type:"Header",variables:[{name:"view_id",default:"36001"},{name:"geoid"}],getData:ZL,EditComp:Tx,ViewComp:XL},eI={"Header: County Header II":KL,"Header: Download Component":QL};af("selector",t0);Q6({...UL,...eI});const tI={...j_(c8({app:"dms-site",type:"docs-ctp",pgEnv:rh,logo:e.jsx(fi,{}),rightMenu:e.jsx(nh,{}),baseUrl:"",checkAuth:ah,useFalcor:et,theme:WL}),Rp),name:"CMS",sideNav:{size:"none"},topNav:{size:"none"}},Es={source_id:"source_id",name:"name",display_name:"display_name",type:"type",update_interval:"update_interval",category:"category",categories:"categories",description:"description",statistics:"statistics",metadata:"metadata"},fn={view_id:"view_id",source_id:"source_id",data_type:"data_type",interval_version:"interval_version",geography_version:"geography_version",version:"version",source_url:"source_url",publisher:"publisher",table_schema:"table_schema",table_name:"table_name",data_table:"data_table",download_url:"download_url",tiles_url:"tiles_url",start_date:"start_date",end_date:"end_date",last_updated:"last_updated",statistics:"statistics",metadata:"metadata",user_id:"user_id",etl_context_id:"etl_context_id",view_dependencies:"view_dependencies",_created_timestamp:"_created_timestamp",_modified_timestamp:"_modified_timestamp"},ts=t=>Object.entries(t||{}).reduce((s,n)=>{const[r,a]=n;return typeof a.value<"u"?s[r]=a.value:s[r]=a,s},{}),ce=w.createContext(void 0),ss=({children:t,fullWidth:s,hideBreadcrumbs:n,isListAll:r})=>e.jsxs("div",{className:`${s?"":"max-w-6xl mx-auto"} h-full flex flex-col`,children:[n?"":e.jsx("div",{className:"",children:e.jsx(nI,{fullWidth:s,isListAll:r})}),e.jsx("div",{className:"flex-1 flex flex-col",children:t})]}),pt=({baseUrl:t=""})=>e.jsx("div",{className:"pt-[2px]",children:e.jsx("div",{className:"h-full z-50",children:e.jsx(Cc,{control:e.jsxs("div",{className:"px-2 flex text-lg",children:[e.jsx("div",{className:" font-medium text-gray-800",children:" Data Manager"}),e.jsx("div",{className:"fal fa-angle-down px-3 mt-[6px] "})]}),className:"text-gray-800 group z-50",openType:"click",children:e.jsxs("div",{className:"p-1 bg-blue-500 text-base z-40",children:[e.jsx("div",{className:"py-1 ",children:Rs(`${t}/`,"fa fa-files flex-shrink-0  pr-1","Sources")},"Sources"),e.jsx("div",{className:"py-1 ",children:Rs(`${t}/mapeditor`,"fa fa-pen-to-square flex-shrink-0  pr-1","Map Editor")},"Map Editor"),e.jsx("div",{className:"py-1 ",children:Rs(`${t}/tasks`,"fa fa-list flex-shrink-0  pr-1","Activity")},"Activity"),e.jsx("div",{className:"py-1 ",children:Rs(`${t}/create/source`,"fa fa-file-plus flex-shrink-0  pr-1","Upload")},"Upload")]})})})}),sI=()=>{const{baseUrl:t="/",user:s={}}={};return e.jsx("div",{className:"pt-[2px]",children:(s==null?void 0:s.authLevel)>=5?e.jsx("div",{className:"h-full",children:e.jsx(Cc,{control:e.jsxs("div",{className:"px-2 flex text-lg",children:[e.jsx("div",{className:" font-medium text-gray-800",children:" Data Manager"}),e.jsx("div",{className:"fal fa-angle-down px-3 mt-[6px] "})]}),className:"text-gray-800 group",openType:"click",children:e.jsx("div",{className:"p-1 bg-blue-500 text-base",children:e.jsx("div",{className:"py-1 ",children:Rs(`${t}/create/source`,"fa fa-file-plus flex-shrink-0  pr-1","Add New Datasource")})})})}):e.jsx("div",{})})},nI=({fullWidth:t,isListAll:s})=>{const{sourceId:n,page:r,cat1:a,cat2:l}=Ye(),{pgEnv:i,baseUrl:c,falcor:d,falcorCache:u}=w.useContext(ce);b.useEffect(()=>{async function m(){return n?await d.get(["dama",i,"sources","byId",n,"attributes",["categories","name","data_type"]]):Promise.resolve({})}m()},[d,n,i]);const p=b.useMemo(()=>{let m=ts(C(u,["dama",i,"sources","byId",n],{attributes:{}}).attributes),h=C(m,"categories[0]",!1)||[a,l].filter(g=>g),f=typeof h!="object"?[]:h.map((g,x)=>({name:g,href:`${c}${s?"/listall":""}/cat/${x>0?h[x-1]+"/":""}${g}`}));return f.push({name:m.name}),f},[u,n,i,a,l,c]);return e.jsx("nav",{className:"border-b border-gray-200 flex ","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:`${t?"w-full":"max-w-screen-xl w-full mx-auto"}  px-4 flex space-x-4 sm:px-6 lg:px-8`,children:[e.jsx("li",{className:"flex",children:e.jsx("div",{className:"flex items-center",children:e.jsxs(je,{to:`${c||"/"}${s?"/listall":""}`,className:"hover:text-[#bbd4cb] text-[#679d89]",children:[e.jsx("i",{className:"fad fa-database flex-shrink-0 h-5 w-5","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Data Sources"})]})})}),p.map((m,h)=>e.jsx("li",{className:"flex",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"flex-shrink-0 w-6 h-full text-gray-300",viewBox:"0 0 30 44",preserveAspectRatio:"none",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:e.jsx("path",{d:"M.293 0l22 22-22 22h1.414l22-22-22-22H.293z"})}),m.href?e.jsx(je,{to:m.href,className:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700","aria-current":m.current?"page":void 0,children:m.name}):e.jsx("div",{className:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700","aria-current":m.current?"page":void 0,children:m.name})]})},h))]})})},ld=t=>{try{JSON.parse(t)}catch{return!1}return!0},Mx=t=>{const s={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return t?new Date(t).toLocaleDateString(void 0,s):""},io=t=>typeof t=="object"?t!=null&&t.value?io(t.value):"N/A":t;function aI(...t){return t.filter(Boolean).join(" ")}async function rI({falcor:t,pgEnv:s,viewId:n}){const r=await t.get(["dama",s,"viewDependencySubgraphs","byViewId",n]),a=await t.get(["dama",s,"views","byId",n,"dependents"]),l=[],i=[];C(r,["json","dama",s,"viewDependencySubgraphs","byViewId",n,"dependencies"],[]).forEach(c=>{l.push(c.source_id),i.push(c.view_id)}),C(a,["json","dama",s,"views","byId",n,"dependents"],[]).forEach(c=>{l.push(c.source_id),i.push(c.view_id)}),await t.get(["dama",s,"sources","byId",l,"attributes",["type","name"]]),await t.get(["dama",s,"views","byId",[n,...i],"attributes",["version","metadata","_modified_timestamp","last_updated"]])}const oI=({dependencies:t={},viewId:s,srcMeta:n,viewMeta:r,baseUrl:a})=>{const[l,i]=b.useState(!1),c=C(t.dependencies.find(d=>d.view_id.toString()===s.toString()),"view_dependencies")||[];return c!=null&&c.length?e.jsxs("div",{className:"w-full my-2",children:[e.jsxs("div",{className:"w-full bg-blue-100 hover:bg-blue-200 text-lg rounded-md p-2",onClick:d=>i(!l),children:[e.jsx("i",{className:`fa fa-angle-${l?"down":"right"}`})," Dependencies"]}),e.jsxs("div",{className:l?"block shadow":"hidden",children:[e.jsx("div",{className:"py-4 sm:py-2 mt-2 sm:grid sm:grid-cols-5 sm:gap-4 sm:px-6 border-b-2",children:["Source Name","Type","Version","Last Updated"].map(d=>e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:typeof d=="object"?JSON.stringify(d):d},d))}),e.jsx("div",{className:"sm:divide-y sm:divide-gray-200",children:t.dependencies.filter(d=>c.includes(d.view_id)).map((d,u)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-5 sm:gap-4 sm:px-6",children:[e.jsx("div",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-midivle",children:e.jsx(je,{to:`${a}/source/${d.source_id}/overview`,children:C(n,[d.source_id,"attributes","name"])})},`${u}_1`),e.jsx("div",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-midivle",children:e.jsx(je,{to:`${a}/source/${d.source_id}/overview`,children:C(n,[d.source_id,"attributes","type"])})},`${u}_2`),e.jsx("div",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-midivle",children:e.jsx(je,{to:`${a}/source/${d.source_id}/versions/${d.view_id}`,children:C(r,[d.view_id,"attributes","version"])})},`${u}_3`),e.jsx("div",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-midivle",children:e.jsx(je,{to:`${a}/source/${d.source_id}/versions/${d.view_id}`,children:typeof C(r,[d.view_id,"attributes","_modified_timestamp","value"])=="object"?"":C(r,[d.view_id,"attributes","_modified_timestamp","value"])})},`${u}_4`),e.jsx("div",{className:"mt-1 text-sm text-red-400 sm:mt-0",children:e.jsxs("span",{className:"float-right italic",children:[" ",C(r,[d.view_id,"attributes","metadata","value","authoritative"])==="true"?"":"outdated"]})},`${u}_5`)]},`${u}_0`))})]})]}):null},lI=({dependents:t=[],viewId:s,srcMeta:n,viewMeta:r})=>{const[a,l]=b.useState(!1),{baseUrl:i}=b.useContext(ce);return e.jsxs("div",{className:"w-full my-2",children:[e.jsxs("div",{className:"w-full bg-blue-100 hover:bg-blue-200 text-lg rounded-md p-2",onClick:c=>l(!a),children:[e.jsx("i",{className:`fa fa-angle-${a?"down":"right"}`})," Dependents"]}),e.jsxs("div",{className:a?"block shadow":"hidden",children:[e.jsx("div",{className:"py-4 sm:py-2 mt-2 sm:grid sm:grid-cols-5 sm:gap-4 sm:px-6 border-b-2",children:["Source Name","Type","Version","Last Updated"].map(c=>e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:c},c))}),e.jsx("div",{className:"sm:divide-y sm:divide-gray-200",children:t.map((c,d)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-5 sm:gap-4 sm:px-6",children:[e.jsx("div",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-midivle",children:e.jsx(je,{to:`${i}/source/${c.source_id}/overview`,children:C(n,[c.source_id,"attributes","name"])})},`${d}_1`),e.jsx("div",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-midivle",children:e.jsx(je,{to:`${i}/source/${c.source_id}/overview`,children:C(n,[c.source_id,"attributes","type"])})},`${d}_2`),e.jsx("div",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-midivle",children:e.jsx(je,{to:`${i}/source/${c.source_id}/versions/${c.view_id}`,children:C(r,[c.view_id,"attributes","version"])})},`${d}_3`),e.jsx("div",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-midivle",children:e.jsx(je,{to:`${i}/source/${c.source_id}/versions/${c.view_id}`,children:typeof C(r,[c.view_id,"attributes","_modified_timestamp","value"])=="object"?"":C(r,[c.view_id,"attributes","_modified_timestamp","value"])})},`${d}_4`),e.jsx("div",{className:"mt-1 text-sm text-red-400 sm:mt-0",children:e.jsxs("span",{className:"float-right italic",children:[" ",C(r,[c.view_id,"attributes","metadata","value","authoritative"])==="true"?"":"outdated"]})},`${d}_5`)]},`${d}_0`))})]})]})},iI=({startValue:t,attr:s,viewId:n,cancel:r=()=>{}})=>{const[a,l]=b.useState(""),{pgEnv:i,baseUrl:c,falcor:d}=b.useContext(ce);b.useEffect(()=>{l(t)},[t]);const u=(p,m)=>{n&&d.set({paths:[["dama",i,"views","byId",n,"attributes",p]],jsonGraph:{dama:{[i]:{views:{byId:{[n]:{attributes:{[p]:m}}}}}}}}).then(h=>{r()})};return e.jsxs("div",{className:"w-full flex",children:[e.jsx(Un,{className:"flex-1 px-2 shadow bg-blue-100 focus:ring-blue-700 focus:border-blue-500  border-gray-300 rounded-none rounded-l-md",value:a,onChange:p=>l(p)}),e.jsx(We,{themeOptions:{size:"sm",color:"primary"},onClick:p=>u(s,a),children:" Save "}),e.jsx(We,{themeOptions:{size:"sm",color:"cancel"},onClick:p=>r(),children:" Cancel "})]})},cI=["CSV","ESRI Shapefile","GeoJSON","GPKG"],Yl={open:!1,loading:!1,fileTypes:[],columns:[],enableGroupedBy:!1,groupedByColumn:""},dI=({inputName:t,checked:s,onChange:n})=>e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx("input",{id:t,name:t,type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:s,onChange:()=>n(t)}),e.jsx("label",{htmlFor:t,className:"ml-2 text-sm text-gray-900",children:t})]}),uI=({children:t})=>e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[e.jsx("div",{className:"flex justify-between items-center w-1/2 text-md leading-6 text-gray-900",children:e.jsx("div",{className:"text-center h-fit",children:"Split data files"})}),e.jsx("div",{className:"flex mt-2 text-sm items-center",children:"Split up data based on a specified column"}),t]}),mI=({options:t,modalState:s,onChange:n})=>e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx("div",{className:"flex mt-2 text-sm items-center",children:"Output will have 1 file per distinct value in:"}),e.jsx("select",{className:"w-full bg-blue-100 rounded mr-2 px-1 flex text-sm",value:s,onChange:r=>n(r.target.value),children:t.map((r,a)=>e.jsx("option",{className:"ml-2 truncate ",value:r,children:r},a))})]}),pI=({onChange:t,modalState:s})=>e.jsx("div",{className:"mt-3 text-center sm:mt-0 sm:text-left",children:e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx("input",{id:"enableGroupedBy",name:"enableGroupedBy",value:!0,type:"radio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:s,onChange:()=>t(!0)}),e.jsx("label",{htmlFor:"enableGroupedBy",className:"ml-2 text-sm text-gray-900",children:"Yes"}),e.jsx("input",{id:"disableGroupedBy",name:"disableGroupedBy",value:!0,type:"radio",className:"h-4 w-4 ml-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:!s,onChange:()=>t(!1)}),e.jsx("label",{htmlFor:"enableGroupedBy",className:"ml-2 text-sm text-gray-900",children:"No"})]})}),vm=({options:t,modalState:s,onChange:n,title:r})=>e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left max-h-[700px] overflow-y-auto",children:[e.jsxs("div",{className:"flex w-full justify-between items-center p-2 w-1/2 text-md leading-6 text-gray-900",children:[e.jsxs("div",{className:"text-center h-fit",children:[r,":"]}),e.jsx("div",{children:e.jsx(We,{themeOptions:{size:"sm"},onClick:()=>{s.length===t.length?n([]):n(t)},children:"Toggle All"})})]}),e.jsxs("div",{className:"flex mt-2 text-sm items-center",children:["One or more must be selected",s.length>0?e.jsx(vc,{className:"ml-2 text-green-700 h-4 w-4"}):e.jsx(Jy,{className:"ml-2 text-red-700 h-4 w-4"})]}),t==null?void 0:t.map(a=>e.jsx(dI,{inputName:a,checked:s.includes(a),onChange:n},`${a}_checkbox`))]});function hI({view:t}){const{viewId:s,sourceId:n}=Ye(),{pgEnv:r,baseUrl:a,user:l,falcorCache:i}=b.useContext(ce),[c,d]=b.useState(Yl),u=N=>{let _;Array.isArray(N)?_=N:c.fileTypes.includes(N)?_=c.fileTypes.filter(E=>E!==N):(_=[...c.fileTypes],_.push(N)),d({...c,fileTypes:_})},p=N=>{let _;Array.isArray(N)?_=N:c.columns.includes(N)?_=c.columns.filter(E=>E!==N):(_=[...c.columns],_.push(N)),d({...c,columns:_})},m=N=>d({...c,open:N}),h=N=>d({...c,enableGroupedBy:N}),f=N=>d({...c,groupedByColumn:N}),g=b.useMemo(()=>{let N=C(i,["dama",r,"sources","byId",t.source_id,"attributes","metadata","value"],[]);return N=N!=null&&N.columns?N.columns:N,Array.isArray(N)?N.map(_=>_.name):[]},[i,t]),x=b.useMemo(()=>g?{...Yl,columns:g}:Yl,[g]);b.useEffect(()=>{g&&d({...c,columns:g})},[g]);const y=()=>{(async()=>{try{const _={source_id:n,view_id:s,fileTypes:c.fileTypes,columns:c.columns,user_id:l.id,email:l.email,groupedByColumn:c.groupedByColumn};d({...c,loading:!0});const L=await(await fetch(`${Rt}/dama-admin/${r}/gis-dataset/create-download`,{method:"POST",body:JSON.stringify(_),headers:{"Content-Type":"application/json"}})).json();d(x)}catch(_){console.log(_),d({...c,loading:!1,open:!0})}})()},j="w-full flex-1 text-center border shadow p-2 font-medium rounded-md hover:text-white";return e.jsxs("div",{className:"w-72 px-5",children:[l.authLevel>=10?e.jsxs("div",{className:"w-full flex flex-col p-1",children:[e.jsxs("button",{className:`${j} bg-blue-300 hover:bg-blue-600 mb-1`,onClick:()=>{d({...c,open:!0})},children:[e.jsx("i",{className:"fa fa-download"})," Create Download"]}),e.jsxs(je,{className:`${j} bg-red-300 border-red-200 hover:bg-red-600`,to:`${a}/source/${n}/versions/${s}/delete`,children:[e.jsx("i",{className:"fad fa-trash"})," Delete View"]})]}):"",e.jsxs(Qw,{open:c.open,setOpen:m,themeOptions:{size:"large"},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fad fa-layer-group text-blue-600","aria-hidden":"true"})}),e.jsx("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full",children:e.jsx("div",{className:"text-lg align-center font-semibold leading-6 text-gray-900",children:"Create Data Download"})})]}),e.jsxs("div",{className:"pl-10 grid grid-cols-3",children:[e.jsx(vm,{title:"File Types",options:cI,modalState:c.fileTypes,onChange:u}),e.jsx(vm,{title:"Columns",options:g,modalState:c.columns,onChange:p}),e.jsxs(uI,{children:[e.jsx(pI,{onChange:h,modalState:c.enableGroupedBy}),c.enableGroupedBy&&e.jsx(mI,{options:c.columns,modalState:c.groupedByColumn,onChange:f})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",disabled:c.loading||c.fileTypes.length===0||c.columns.length===0,className:"disabled:bg-slate-300 disabled:cursor-warning inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto",onClick:y,children:c.loading?"Sending request...":"Start download creation"}),e.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>m(!1),children:"Cancel"})]})]})]})}const fI={source_url:"source url",_created_timestamp:"Created",_modified_timestamp:"Updated",geography_version:"Geography Version",interval_version:"Interval Version",data_type:"Data Type"},Zl=({attr:t,editing:s,setEditing:n,user:r,val:a,view:l,display:i="row",valueClass:c="w-3/4 font-semibold"})=>e.jsxs("div",{className:"w-full flex justify-between group hover:bg-blue-50 rounded-lg items-middle",children:[e.jsxs("div",{className:`w-full flex flex-col sm:flex-${i} items-center pb-2 pt-5 px-1`,children:[e.jsx("dt",{className:"w-1/4 text-sm font-medium text-gray-500 capitalize",children:fI[t]||t}),e.jsx("dd",{className:"w-3/4 text-sm text-gray-900 sm:mt-0",children:s===t?e.jsx("div",{className:"pt-3 pr-8",children:e.jsx(iI,{startValue:a,attr:t,viewId:l.view_id,cancel:()=>n(null)})}):e.jsx("div",{className:c||"w-3/4 font-semibold",children:t==="source_url"?e.jsx(je,{to:a||"#",children:a||"N/A"}):a||"N/A"})})]}),r.authLevel>5&&n?e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer p-2",onClick:d=>n(s===t?null:t),children:e.jsx("i",{className:"fad fa-pencil absolute p-2 -ml-4 rounded hover:bg-blue-500 hover:text-white "})}):""]}),Bx=({view:t,columns:s=[],flexDir:n="col",showControls:r=!1})=>{var m,h;const[a,l]=b.useState(null),{user:i}=b.useContext(ce),c={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},d=new Date(io((m=t._created_timestamp)==null?void 0:m.value)).toLocaleDateString(void 0,c),u=new Date(io((h=t._modified_timestamp)==null?void 0:h.value)).toLocaleDateString(void 0,c),p="text-blue-600 font-semibold";return e.jsx("div",{className:"overflow-hidden",children:e.jsxs("div",{className:"flex justify-between border-t border-gray-200 px-4 py-5 sm:p-0",children:[e.jsx("div",{className:`w-full flex flex-${n}`,children:Object.keys(fn).filter(f=>!(s!=null&&s.length)||s.includes(f)).filter(f=>!["view_id","source_id","description","statistics","category","table_schema","table_name","data_table","tiles_url","last_updated","view_dependencies","start_date","end_date","download_url","user_id","etl_context_id","_created_timestamp","_modified_timestamp","metadata"].includes(f)).map((f,g)=>{let x=io(t[f]);return e.jsx(Zl,{attr:f,val:x,editing:a,setEditing:l,view:t,user:i},g)})}),e.jsxs("div",{className:"w-fit flex flex-col space-between",children:[(!s.length||s.includes("_created_timestamp"))&&e.jsx(Zl,{attr:"_created_timestamp",val:d,view:t,user:i,display:"col",valueClass:p}),(!s.length||s.includes("_modified_timestamp"))&&e.jsx(Zl,{attr:"_modified_timestamp",val:u,view:t,user:i,display:"col",valueClass:p}),r&&e.jsx(hI,{view:t})]})]})})};function gI(){var f;const{viewId:t,sourceId:s}=Ye(),{pgEnv:n,baseUrl:r,falcor:a,falcorCache:l}=b.useContext(ce);b.useEffect(()=>{rI({falcor:a,pgEnv:n,viewId:t})},[t,n,a]);const i=C(l,["dama",n,"viewDependencySubgraphs","byViewId",t,"value"],{dependencies:[]}),c=C(l,["dama",n,"views","byId",t,"dependents","value"],[]),d=C(l,["dama",n,"sources","byId"],{}),u=C(l,["dama",n,"views","byId"],{}),p=C(l,["dama",n,"views","byId",t,"attributes"],{}),m=C(l,["dama",n,"sources","byId",s,"attributes","name"],""),h=typeof(p==null?void 0:p.version)=="object"?null:p==null?void 0:p.version;return e.jsx("div",{className:"overflow-hidden flex flex-col md:flex-row",children:e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"flex justify-between",children:e.jsxs("div",{className:"flex-1 sm:px-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between overflow-hidden sm:mt-0 sm:col-span-3",children:e.jsxs("div",{className:"py-2 px-2 text-2xl text-gray-700 font-medium ",children:[m," - ",h||t]})}),e.jsxs("div",{children:[e.jsx(Bx,{view:p,baseUrl:r,showControls:!0}),i!=null&&i.dependencies&&((f=i==null?void 0:i.dependencies)==null?void 0:f.length)>0?e.jsx(oI,{viewId:t,dependencies:i,srcMeta:d,viewMeta:u,baseUrl:r}):"",c&&c.length>0?e.jsx(lI,{viewId:t,dependents:c,srcMeta:d,viewMeta:u,baseUrl:r}):""]})]})})})})}function xI({view:t}){var s;return(s=t==null?void 0:t.metadata)!=null&&s.download?e.jsxs("div",{className:"inline-flex rounded-md shadow-sm",children:[e.jsx("button",{type:"button",className:"relative inline-flex items-center rounded-l-md bg-white px-10 py-[12px] text-md font-semibold text-blue-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-10",children:"Download"}),e.jsxs(Oe,{as:"div",className:"absolute ml-32 block",children:[e.jsxs(Oe.Button,{className:"relative inline-flex items-center rounded-r-md bg-white px-2 py-3 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-10",children:[e.jsx("span",{className:"sr-only",children:"Open options"}),e.jsx(bp,{className:"h-5 w-5","aria-hidden":"true"})]}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsx(Oe.Items,{className:"absolute z-20 right-0 -mr-1 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:e.jsx("div",{className:"py-1",children:Object.keys(t.metadata.download).map((n,r)=>e.jsx(Oe.Item,{children:({active:a})=>e.jsx("a",{href:t.metadata.download[n].replace("$HOST",`${Rt}`),className:aI(a?"bg-gray-100 text-gray-900":"text-gray-700","block px-4 py-2 text-sm"),children:n})},r))})})})]})]}):"Download Not Available"}async function bI({falcor:t,pgEnv:s,viewId:n}){const r=await t.get(["dama",s,"views","byId",n,"dependents"],["dama",s,"views","byId",n,"attributes","source_id"]),a=[],l=[];C(r,["json","dama",s,"views","byId",n,"dependents"]).forEach(c=>{a.push(c.source_id),l.push(c.view_id)}),await t.get(["dama",s,"sources","byId",a,"attributes",["type","name"]]),await t.get(["dama",s,"views","byId",l,"attributes",["version","metadata","_modified_timestamp","last_updated"]]);const i=t.getCache();return{dependents:C(i,["dama",s,"views","byId",n,"dependents","value"],[]),sourceId:C(r,["json","dama",s,"views","byId",n,"attributes","source_id"],[]),srcMeta:C(i,["dama",s,"sources","byId"],{}),viewMeta:C(i,["dama",s,"views","byId"],{})}}const Ax=({text:t,viewId:s,sourceId:n,pgEnv:r,baseUrl:a,falcor:l})=>{const i=$e();return e.jsx("button",{className:"bg-red-50 hover:bg-red-400 hover:text-white p-2",onClick:async()=>{await fetch(`${Rt}/dama-admin/${r}/deleteDamaView`,{method:"POST",body:JSON.stringify({view_id:s}),headers:{"Content-Type":"application/json"}}),await l.invalidate(["dama",r,"sources","byId",n,"views","length"]),i(`${a}/source/${n}/versions`)},children:t})},yI=({dependents:t,viewId:s,srcMeta:n,viewMeta:r})=>e.jsxs("div",{className:"w-full p-4 shadow mb-4",children:[e.jsx("label",{className:"text-lg",children:"Dependents"}),e.jsx("div",{className:"py-4 sm:py-2 mt-2 sm:grid sm:grid-cols-5 sm:gap-20 sm:px-6 border-b-2",children:["Source Name","Type","Version","Last Updated"].map(a=>e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:a},a))}),e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:t.map((a,l)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-5 sm:gap-20 sm:px-6",children:[e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:e.jsx(je,{to:`/source/${a.source_id}/overview`,children:C(n,[a.source_id,"attributes","name"])})},`${l}_1`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:e.jsx(je,{to:`/source/${a.source_id}/overview`,children:C(n,[a.source_id,"attributes","type"])})},`${l}_2`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:e.jsx(je,{to:`/source/${a.source_id}/views/${a.view_id}`,children:C(r,[a.view_id,"attributes","version"])})},`${l}_3`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:e.jsx(je,{to:`/source/${a.source_id}/views/${a.view_id}`,children:typeof C(r,[a.view_id,"attributes","_modified_timestamp","value"])=="object"?"":C(r,[a.view_id,"attributes","_modified_timestamp","value"])})},`${l}_4`),e.jsx("dd",{className:"mt-1 text-sm text-red-400 sm:mt-0",children:e.jsxs("span",{className:"float-right italic",children:[" ",C(r,[a.view_id,"attributes","metadata","value","authoritative"])==="true"?"":"outdated"]})},`${l}_5`)]},`${l}_0`))})]}),vI=(t,s,n,r,a,l,i,c)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-4 flex justify-between",children:[e.jsx("label",{children:"The View has following dependents:"}),e.jsx(Ax,{text:"Delete anyway",viewId:n,sourceId:s,pgEnv:l,baseUrl:i,falcor:c})]}),e.jsx("div",{className:"bg-red-50",children:e.jsx(yI,{viewId:n,srcMeta:r,viewMeta:a,dependents:t})})]}),jI=(t,s,n,r,a)=>e.jsxs("div",{className:"pb-4 flex justify-between",children:[e.jsx("label",{children:"No dependents found."}),e.jsx(Ax,{text:"Confirm Delete",viewId:t,sourceId:s,pgEnv:n,baseUrl:r,falcor:a})]});function wI(){const{sourceId:t,viewId:s}=Ye(),{pgEnv:n,baseUrl:r,falcor:a,falcorCache:l}=w.useContext(ce);b.useEffect(()=>{bI({falcor:a,pgEnv:n,viewId:s})},[s,n,a]);const i=C(l,["dama",n,"views","byId",s,"dependents","value"],[]),c=C(l,["dama",n,"sources","byId"],{}),d=C(l,["dama",n,"views","byId"],{});return e.jsxs("div",{className:"w-full p-4 bg-white my-1 block border shadow",children:[e.jsxs("div",{className:"pb-4 font-bold",children:["Delete ",e.jsx("i",{children:s})]}),i.length?vI(i,t,s,c,d,n,r,a):jI(s,t,n,r,a)]})}const Ox=({source:t,views:s,meta:n})=>{const{pgEnv:r,baseUrl:a,user:l}=w.useContext(ce),{sourceId:i,viewId:c,vPage:d}=Ye();return d==="delete"?e.jsx(wI,{}):c?e.jsx(gI,{}):e.jsx("div",{children:e.jsx(St,{disableFilters:!0,disableSortBy:!0,sortBy:"_created_timestamp",data:s,columns:[{Header:"Version Id",accessor:u=>e.jsxs(je,{className:"text-blue-500",to:`${a}/source/${i}/versions/${u.view_id}`,children:[" ",u.version||u.view_id]})},{Header:"User",accessor:"user_id"},{Header:"Uploaded",accessor:u=>Mx(u._created_timestamp)},{Header:" Download",accessor:u=>e.jsx(xI,{view:u}),disableFilters:!0}],striped:!0})})},NI=(t,s)=>{t=C(t,"current",t),w.useEffect(()=>{if(!t)return;const n=r=>{t&&!t.contains(r.target)&&s(r)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[t,s])},CI=({source:t,symbology:s={},entityType:n="sources"})=>{const[r,a]=w.useState([]),{pgEnv:l,falcor:i}=w.useContext(ce),c=n==="sources"?t.source_id:s.symbology_id,d=w.useCallback(p=>{i.set({paths:[["dama",l,n,"byId",c,"attributes","categories"]],jsonGraph:{dama:{[l]:{[n]:{byId:{[c]:{attributes:{categories:JSON.stringify(p)}}}}}}}}).then(()=>{})},[l,i,c]),u=n==="sources"?t:s;return w.useEffect(()=>{const p=C(u,"categories",[]);Array.isArray(p)?a(p):a([])},[u]),[r,d]},jm=({children:t,remove:s,indices:n,editing:r,className:a=""})=>{const l=w.useCallback(i=>{s(...n)},[s,n]);return e.jsxs("div",{className:`
        overflow-hidden text-ellipsis whitespace-nowrap ${a}
        flex-1 flex items-center py-1 pl-2 pr-4 bg-blue-200 text-blue-600 font-light hover:bg-blue-50 mr-2 rounded-md my-1
      `,children:[e.jsx("div",{className:"flex-1",children:t}),r?e.jsx("button",{onClick:l,className:"hover:text-red-500 pl-2",children:e.jsx("span",{className:"fas fa-remove"})}):null]})},_I=()=>e.jsx("span",{className:"fas fa-caret-right mx-1"}),SI=t=>e.jsx("span",{...t,className:`
        fas fa-plus p-1 rounded cursor-pointer
        text-blue-500 hover:bg-blue-500 hover:text-white
      `}),$I=t=>{const{categories:s,parent:n,addNewCategory:r,removeCategory:a,editingCategories:l}=t,i=s.length,[c,d]=w.useState(!1),u=w.useCallback(h=>{h.stopPropagation(),d(!0)},[]),p=w.useCallback(h=>{h.stopPropagation(),d(!1)},[]),m=w.useCallback(h=>{r(h,n),d(!1)},[r,n,p]);return e.jsxs("div",{className:`flex flex-col border-current ${l?"border-b":""}`,children:[e.jsxs("div",{className:`flex ${l?"border-b":""}`,children:[e.jsx(jm,{className:"font-bold flex-1",remove:a,indices:[n,0],editing:c||l,children:s[0]}),!l||c?null:e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(SI,{onClick:u})})]}),e.jsx("div",{className:"flex ml-4",children:s.slice(1).map((h,f)=>e.jsxs(jm,{remove:a,indices:[n,f+1],editing:c||l,children:[e.jsx("span",{children:h}),f<i-2?e.jsx(_I,{}):null]},h))}),c?e.jsx(Dx,{isSub:!0,stopEditing:p,addNewCategory:m}):null]})},Px=t=>{const{editingCategories:s,stopEditingCategories:n}=t,[r,a]=CI(t),l=w.useCallback((c,d=-1)=>{a(d===-1?[...r,[c]]:r.reduce((u,p,m)=>(m===d?u.push([...p,c]):u.push(p),u),[]))},[r,a]),i=w.useCallback((c,d=0)=>{if(d===0){const u=[...r];u.splice(c,1),a(u)}else r[c].splice(d,1),a(r)},[r,a]);return e.jsxs("div",{children:[r==null?void 0:r.map((c,d)=>e.jsx($I,{categories:c,parent:d,editingCategories:s,addNewCategory:l,removeCategory:i},d)),s?e.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[e.jsx(Dx,{addNewCategory:l}),e.jsx(We,{onClick:n,themeOptions:{size:"sm",color:"cancel"},children:"Stop editing categories"})]}):null]})},EI=({onChange:t,...s})=>{const n=w.useCallback(l=>{t(l.target.value)},[t]),[r,a]=w.useState(null);return w.useEffect(()=>{r&&r.focus()},[r]),e.jsx("input",{type:"text",ref:a,...s,className:"px-2 w-full",onChange:n})},Dx=({addNewCategory:t,stopEditing:s,isSub:n=!1})=>{const[r,a]=w.useState(""),l=w.useCallback(p=>{p.stopPropagation(),t(r),a("")},[t,r]),i=w.useCallback(p=>{typeof s=="function"&&s(p),a("")},[s]),c=w.useCallback(p=>{p.key==="Enter"||p.keyCode===13?l(p):(p.key==="Escape"||p.keyCode===27)&&i(p)},[l,i]),[d,u]=w.useState(null);return NI(d,i),e.jsx("div",{ref:u,className:"px-2 py-1 bg-gray-100 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mb-1",children:e.jsx(EI,{type:"text",value:r,onChange:a,onKeyDown:c})}),e.jsx("div",{className:"px-2 rounded bg-gray-200 text-center",children:r?"Press Enter to save or Esc to cancel":`Start typing to add new ${n?"subcategory":"category"}`})]})})},wm=t=>(t.display_name?1:0)+(t.description?1:0),Nm=(t,s)=>wm(s)-wm(t),kI=({source:t,...s})=>{w.useContext(ce),t.source_id;const[n,r]=w.useState([]),[a,l]=w.useState(15),i=gt.lexical.ViewComp;if(w.useEffect(()=>{const p=JSON.parse(JSON.stringify(C(t,"metadata",[])));if(Array.isArray(p))r(p.sort(Nm).map(m=>({display:"",...m})));else if(p&&"columns"in p){const m=C(p,"columns",[]);Array.isArray(m)?r(m.sort(Nm).map(h=>({display:"",...h}))):r([])}else r([])},[t]),!n||!n.map||n.length===0)return e.jsx("div",{children:" Metadata Not Available "});const c=["column","description"].map(p=>({Header:p,accessor:p,align:"left",width:p==="column"?"30%":"70%",minWidth:p==="column"?"30%":"70%",maxWidth:p==="column"?"30%":"70%"})),d=n==null?void 0:n.length,u=n.filter((p,m)=>m<a).map(p=>({column:e.jsxs("div",{className:"pr-8 font-bold",children:[C(p,"display_name",C(p,"name"))||"No Name",e.jsxs("span",{className:"italic pl-1 pt-3 pr-8 font-light",children:["(",C(p,"type"),")"]})]}),description:C(p,["desc","root"])?e.jsx(i,{value:C(p,"desc")}):e.jsx("div",{className:"pl-6",children:C(p,"desc")||"No Description"})}));return e.jsxs(e.Fragment,{children:[e.jsx(St,{columns:c,data:u,pageSize:a,striped:!0}),d>15?e.jsx("div",{className:"float-right text-blue-600 underline text-sm cursor-pointer",onClick:()=>l(a===15?d:15),children:a>15?"see less":"see more"}):null]})},LI=({source:t,pageSize:s,...n})=>e.jsx("div",{className:"w-full flex-1 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6",children:e.jsx("div",{className:"col-span-3",children:e.jsx(kI,{source:t,pageSize:s})})}),$a=async({sourceId:t,pgEnv:s,falcor:n,metadata:r,setMetadata:a,col:l,value:i})=>{const c=r.map(d=>d.name===l?{...d,...i}:d);await a(c),await n.call(["dama","sources","metadata","update"],[s,t,{columns:c}])},Rx=({value:t,setValue:s,save:n,cancel:r})=>e.jsxs("div",{className:"w-full flex flex-col h-full border border-lime-300",children:[e.jsx("div",{children:e.jsx("textarea",{className:"flex-1 w-full px-2 shadow bg-blue-100 min-h-[200px] focus:ring-blue-700 focus:border-blue-500  border-gray-300 rounded-none rounded-l-md",onChange:a=>s(a.target.value),children:t})}),e.jsxs("div",{className:"flex py-2",children:[e.jsx("div",{className:"flex-1"}),e.jsx(We,{themeOptions:{size:"sm",color:"primary"},onClick:a=>n(t),children:" Save "}),e.jsx(We,{themeOptions:{size:"sm",color:"cancel"},onClick:a=>r(),children:" Cancel "})]})]}),id=({value:t,setValue:s,save:n,cancel:r})=>e.jsxs("div",{className:"w-full flex flex-1 flex-col",children:[e.jsx("input",{className:"p-2 flex-1 px-2 shadow bg-blue-100 focus:ring-blue-700 focus:border-blue-500  border-gray-300 rounded-none rounded-md",value:t,onChange:a=>s(a.target.value)}),e.jsxs("div",{className:"flex self-end",children:[e.jsx(We,{themeOptions:{size:"sm",color:"primary"},onClick:a=>n(t),children:" Save "}),e.jsx(We,{themeOptions:{size:"sm",color:"cancel"},onClick:a=>r(),children:" Cancel "})]})]}),Fx=({Comp:t,value:s,setValue:n,save:r,cancel:a})=>e.jsxs("div",{className:"w-full flex flex-1 flex-col",children:[e.jsx(t,{value:s,onChange:n}),e.jsxs("div",{className:"flex self-end",children:[e.jsx(We,{themeOptions:{size:"sm",color:"primary"},onClick:l=>r(s),children:" Save "}),e.jsx(We,{themeOptions:{size:"sm",color:"cancel"},onClick:l=>a(),children:" Cancel "})]})]}),Xl=({metadata:t,setMetadata:s,col:n,startValue:r,attr:a,sourceId:l,type:i="text",setEditing:c=()=>{},cancel:d=()=>{}})=>{const[u,p]=b.useState(r),{pgEnv:m,baseUrl:h,falcor:f}=w.useContext(ce),g=gt.lexical.EditComp;b.useEffect(()=>{p(r)},[r]);const x=y=>{$a({sourceId:l,pgEnv:m,falcor:f,metadata:t,setMetadata:s,col:n,value:{[a]:y}}).then(()=>c(null))};return i==="textarea"?e.jsx(Rx,{value:u,setValue:p,save:x,cancel:d}):i==="lexical"?e.jsx(Fx,{Comp:g,value:u,setValue:p,save:x,cancel:d}):e.jsx(id,{value:u,setValue:p,save:x,cancel:d})},Ql=({metadata:t,setMetadata:s,col:n,startValue:r,attr:a,sourceId:l,type:i="text",setEditing:c=()=>{},cancel:d=()=>{}})=>{const[u,p]=b.useState(r&&ld(r)?JSON.parse(r):r),{pgEnv:m,baseUrl:h,falcor:f}=w.useContext(ce),g=gt.lexical.EditComp;b.useEffect(()=>{p(r)},[r]);const x=()=>{console.log("saving",u),l&&f.set({paths:[["dama",m,"sources","byId",l,"attributes",a]],jsonGraph:{dama:{[m]:{sources:{byId:{[l]:{attributes:{[a]:i==="lexical"?JSON.stringify(u):u}}}}}}}}).then(y=>{d()})};return i==="textarea"?e.jsx(Rx,{value:u,setValue:p,save:x,cancel:d}):i==="lexical"?e.jsx(Fx,{Comp:g,value:u,setValue:p,save:x,cancel:d}):e.jsx(id,{value:u,setValue:p,save:x,cancel:d})},Hr=({user:t,editing:s,setEditing:n,attr:r})=>(t==null?void 0:t.authLevel)<=5?null:e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:a=>n(s===r?null:r),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12 mt-3 p-2.5 rounded hover:bg-blue-500 hover:text-white "})}),Vx=t=>{var s,n;return(n=(s=ld(t)?JSON.parse(t):t)==null?void 0:s.root)!=null&&n.children?t:{root:{children:[{children:[{detail:0,format:0,mode:"normal",text:t||"No Description",type:"text",version:1},{detail:0,format:0,mode:"normal",text:`

`,type:"text",version:1}],tag:"",direction:"ltr",format:"",indent:0,type:"paragraph",version:1}],direction:"ltr",format:"",indent:0,type:"root",version:1}}},II=({source:t,views:s,activeViewId:n})=>{var N,_,E,L,S,k,$,I;const[r,a]=w.useState(null),l=w.useCallback(T=>{a(null)},[]),{pgEnv:i,baseUrl:c,user:d}=w.useContext(ce),u=n||((N=s[0])==null?void 0:N.view_id),p=(_=s[(s==null?void 0:s.length)-1])==null?void 0:_.view_id,m={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},h=new Date(((L=(E=s.filter(T=>T.view_id===u))==null?void 0:E[0])==null?void 0:L._created_timestamp)||"").toLocaleDateString(void 0,m),f=new Date(((k=(S=s.filter(T=>T.view_id===p))==null?void 0:S[0])==null?void 0:k._modified_timestamp)||"").toLocaleDateString(void 0,m),g=gt.lexical.ViewComp,x={update_interval:"update interval"},y=($=C(t,["metadata","columns"],C(t,"metadata",[])))==null?void 0:$.length,j=t.description;return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex flex-col w-full md:w-[70%]",children:[e.jsxs("div",{className:"flex justify-between group",children:[e.jsx("div",{className:"flex-1",children:e.jsx("dd",{className:"mt-1 text-2xl text-blue-600 font-medium overflow-hidden sm:mt-0 sm:col-span-3",children:r==="name"?e.jsx("div",{className:"pt-3 pr-8",children:e.jsx(Ql,{startValue:t.name,attr:"name",sourceId:t.source_id,cancel:l})}):e.jsx("div",{className:"py-2 px-2",children:t.name})})}),e.jsx(Hr,{attr:"name",user:d,editing:r,setEditing:a})]}),e.jsxs("div",{className:"w-full pl-4 py-2 sm:pl-6 flex justify-between group",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm text-gray-500 pr-14",children:r==="description"?e.jsx(Ql,{startValue:j,attr:"description",type:"lexical",sourceId:t==null?void 0:t.source_id,cancel:l}):e.jsx("div",{className:"pr-8",children:t.description?e.jsx(g,{value:Vx(j)}):e.jsx("div",{className:"min-h-10",children:"No Description"})})})}),e.jsx(Hr,{attr:"description",user:d,editing:r,setEditing:a})]}),e.jsx("div",{className:"ml-4",children:e.jsx(Bx,{view:((I=s.filter(T=>T.view_id===u))==null?void 0:I[0])||{},columns:["publisher","source_url"],flexDir:"col"})})]}),e.jsxs("div",{className:"w-full md:w-[30%]",children:[e.jsxs("div",{className:"mt-2 flex flex-col px-6 text-sm text-gray-600",children:["Created",e.jsx("span",{className:"text-l font-medium text-blue-600 ",children:h})]}),e.jsxs("div",{className:"mt-2 flex flex-col px-6 text-sm text-gray-600",children:["Updated",e.jsx("span",{className:"text-l font-medium text-blue-600 ",children:f})]}),e.jsxs("div",{className:"flex justify-between group",children:[e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-2 sm:gap-1 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 mt-1.5",children:"Categories"}),e.jsx("dd",{className:"text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"pb-2 px-2 relative",children:e.jsx(Px,{source:t,editingCategories:r==="categories",stopEditingCategories:l})})})]}),e.jsx(Hr,{attr:"categories",user:d,editing:r,setEditing:a})]},"categories"),e.jsx("div",{className:"mx-5",children:e.jsx("div",{className:"flex flex-row w-full",children:Object.keys(Es).filter(T=>["type","update_interval"].includes(T)).map((T,A)=>{let R=typeof t[T]=="object"?JSON.stringify(t[T]):t[T];return e.jsxs("div",{className:"w-1/2 flex justify-between group hover:bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"w-full flex flex-col space-between items-left",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500 px-1 capitalize",children:x[T]||T}),e.jsx("div",{className:"w-full text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:r===T?e.jsx("div",{className:"pt-3 pr-8 z-10",children:e.jsx(Ql,{startValue:R,attr:T,sourceId:t.source_id,cancel:l})}):e.jsx("div",{className:"w-full py-2 px-2 font-semibold truncate uppercase",children:R||"N/A"})})]}),e.jsx(Hr,{attr:T,user:d,editing:r,setEditing:a})]},T)})})})]})]}),e.jsxs("div",{className:"flex items-center p-2 mx-4 text-blue-600 hover:bg-blue-50 rounded-md",children:["Columns",e.jsx("span",{className:"bg-blue-200 text-blue-600 text-xs p-1 ml-2 shrink-0 grow-0 rounded-lg flex items-center justify-center border border-blue-300",children:y})]}),e.jsx(LI,{source:t}),e.jsxs("div",{className:"py-5 pr-2",children:[e.jsx("div",{className:"p-2 mx-4 text-blue-600 hover:bg-blue-50 rounded-md",children:"Versions"}),e.jsx("div",{className:"px-5",children:e.jsx(Ox,{source:t,views:s})})]})]})},TI=({source:t})=>{const{pgEnv:s,baseUrl:n,falcor:r,falcorCache:a}=w.useContext(ce);b.useEffect(()=>{async function i(){const c=["dama",s,"sources","byId",t.source_id,"views","length"],d=await r.get(c);await r.get(["dama",s,"sources","byId",t.source_id,"views","byIndex",{from:0,to:C(d.json,c,0)-1},"attributes",Object.values(fn)])}i()},[r,a,t,s]);const l=gt.lexical.ViewComp;return e.jsx("div",{className:"w-full p-4 bg-white hover:bg-blue-50 block border shadow flex",children:e.jsxs("div",{children:[e.jsx(je,{to:`${n}/source/${t.source_id}`,className:"text-xl font-medium w-full block",children:e.jsx("span",{children:t.name})}),e.jsx("div",{children:(C(t,"categories",[])||[]).map(i=>(typeof i=="string"?[i]:i).map((c,d)=>e.jsx(je,{to:`${n}/cat/${d>0?i[d-1]+"/":""}${c}`,className:"text-xs p-1 px-2 bg-blue-200 text-blue-600 mr-2",children:c},d)))}),e.jsx(je,{to:`${n}/source/${t.source_id}`,className:"py-2 block",children:e.jsx(l,{value:Vx(t.description)})})]})})},MI=()=>{var N,_;const[t,s]=b.useState(""),{cat1:n,cat2:r,...a}=Ye(),{pgEnv:l,baseUrl:i,falcor:c,falcorCache:d,user:u}=w.useContext(ce),[p,m]=b.useState("asc"),h=((_=(N=window.location.pathname.replace(`${i}/`,""))==null?void 0:N.split("/"))==null?void 0:_[0])==="listall";b.useEffect(()=>{async function E(){const L=["dama",l,"sources","length"],S=await c.get(L);await c.get(["dama",l,"sources","byIndex",{from:0,to:C(S.json,L,0)-1},"attributes",Object.values(Es)],["dama-info",l,"settings"])}E()},[c,l]);const f=b.useMemo(()=>Object.values(C(d,["dama",l,"sources","byIndex"],{})).map(E=>ts(C(d,E.value,{attributes:{}}).attributes)),[d,l]),g=b.useMemo(()=>C(d,["dama-info",l,"settings","value","filtered_categories"],[]),[d,l]),x=[...new Set(f.filter(E=>{var L;return h||!h&&!((L=E.categories)!=null&&L.find(S=>g.find(k=>S.includes(k))))}).reduce((E,L)=>{var S;return[...E,...((S=L.categories)==null?void 0:S.map(k=>k[0]))||[]]},[]))].sort(),y=x.reduce((E,L)=>{var S;return E[L]=(S=f.filter(k=>{var $;return($=k.categories)==null?void 0:$.find(I=>I.includes(L))}))==null?void 0:S.length,E},{}),j="bg-transparent hover:bg-blue-100 rounded-sm p-2 ml-0.5 border-2";return e.jsxs(ss,{baseUrl:i,isListAll:h,children:[e.jsxs("div",{className:"py-4 flex flex-rows items-center",children:[e.jsx("input",{className:"w-full text-lg p-2 border border-gray-300 ",placeholder:"Search datasources",value:t,onChange:E=>s(E.target.value)}),e.jsx("button",{className:j,title:"Toggle Sort",onClick:()=>m(p==="asc"?"desc":"asc"),children:e.jsx("i",{className:`fa-solid ${p==="asc"?"fa-arrow-down-z-a":"fa-arrow-down-a-z"} text-xl text-blue-400`})}),e.jsx(je,{to:h?`${i}`:`${i}/listall`,className:j,title:h?"View Key Sources":"View All Sources",children:e.jsx("i",{className:`fa-solid ${h?"fa-filter-list":"fa-list-ul"} text-xl text-blue-400`})}),(u==null?void 0:u.authed)&&u.authLevel===10&&e.jsx(je,{to:`${i}/settings`,className:j,title:"Settings",children:e.jsx("i",{className:"fa-solid fa-gear text-xl text-blue-400"})})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"w-1/4 flex flex-col space-y-1.5 max-h-[80dvh] overflow-auto scrollbar-sm",children:(x||[]).sort((E,L)=>E.localeCompare(L)).map(E=>e.jsxs(je,{className:`${n===E||r===E?"bg-blue-100":"bg-white"} hover:bg-blue-50 p-2 rounded-md flex items-center`,to:`${i}${h?"/listall":""}/cat/${E}`,children:[e.jsx("i",{className:"fa fa-category"})," ",E,e.jsx("div",{className:"bg-blue-200 text-blue-600 text-xs w-5 h-5 ml-2 shrink-0 grow-0 rounded-lg flex items-center justify-center border border-blue-300",children:y[E]})]},E))}),e.jsx("div",{className:"w-3/4 flex flex-col space-y-1.5 ml-1.5 max-h-[80dvh] overflow-auto scrollbar-sm",children:f.filter(E=>{var L;return h||!h&&!((L=E.categories)!=null&&L.find(S=>g.find(k=>S.includes(k))))}).filter(E=>{let L=!0;return n&&(L=!1,(C(E,"categories",[])||[]).forEach(S=>{S[0]===n&&(!r||S[1]===r)&&(L=!0)})),L}).filter(E=>{let L=E.name+" "+((E==null?void 0:E.categories)||[]).reduce((S,k)=>(S+=Array.isArray(k)?k.join(" "):typeof k=="string"?k:"",S),"");return!t.length>2||L.toLowerCase().includes(t.toLowerCase())}).sort((E,L)=>{var k;return(p==="asc"?1:-1)*((k=E.name)==null?void 0:k.localeCompare(L.name))}).map((E,L)=>e.jsx(TI,{source:E,baseUrl:i},L))})]})]})},BI=({sourceId:t,metadata:s,setMetadata:n,col:r,value:a})=>{const{pgEnv:l,falcor:i}=w.useContext(ce),c=w.useCallback(async d=>{await $a({sourceId:t,pgEnv:l,falcor:i,metadata:s,setMetadata:n,col:r,value:{display:d.target.value}})},[r,s]);return e.jsx("div",{className:"border border-blue-100",children:e.jsxs("select",{className:"appearance-auto pl-3 pr-4 py-2.5 bg-blue-50 w-full bg-white mr-2 flex items-center justify-between text-sm",value:a,onChange:c,children:[e.jsx("option",{value:"",children:"none"}),e.jsx("option",{value:"meta-variable",children:"meta variable"}),e.jsx("option",{value:"data-variable",children:"data variable"}),e.jsx("option",{value:"geoid-variable",children:"fips variable"}),e.jsx("option",{value:"geom-variable",children:"geom variable"})]})})},AI=({metadata:t,setMetadata:s,col:n,startValue:r,sourceId:a,setEditing:l=()=>{}})=>{const{pgEnv:i,baseUrl:c,falcor:d}=w.useContext(ce),[u,p]=b.useState(!1),[m,h]=b.useState(r);b.useEffect(()=>{h(r)},[r]);const f=g=>{$a({sourceId:a,pgEnv:i,falcor:d,metadata:t,setMetadata:s,col:n,value:{meta_lookup:g}}),p(!1),l(null)};return u?e.jsx(id,{value:m,setValue:h,save:f,cancel:()=>p(!1)}):e.jsxs("div",{className:"text-xs font-thin flex flex-row mt-1",children:[e.jsx("div",{className:"border p-1 h-30 max-h-[300px] overflow-auto scrollbar-sm",children:e.jsx(qy,{data:ld(r)?JSON.parse(r):{},shouldExpandNode:Ky,style:Yy})}),e.jsx("div",{className:"-ml-10 mt-2 z-10",children:e.jsx(We,{themeOptions:{size:"xs",color:"transparent"},onClick:g=>p(!u),children:" Edit "})})]})},OI=({sourceId:t,pgEnv:s,falcor:n,metadata:r,setMetadata:a,col:l})=>{const i=[...r,l];a(i),n.set({paths:[["dama",s,"sources","byId",t,"attributes","metadata"]],jsonGraph:{dama:{[s]:{sources:{byId:{[t]:{attributes:{metadata:JSON.stringify(i)}}}}}}}}).then(c=>console.log("RES:",c))},PI=({metadata:t,setMetadata:s,sourceId:n})=>{const{pgEnv:r,baseUrl:a,falcor:l}=w.useContext(ce),[i,c]=b.useState();return e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("input",{placeholder:"enter column name",className:"p-2 w-full flex-1 px-2 border rounded-lg",value:i,onChange:d=>c(d.target.value)}),e.jsx(We,{themeOptions:{size:"sm",color:"primary"},onClick:d=>OI({sourceId:n,pgEnv:r,falcor:l,metadata:t,setMetadata:s,col:{name:i,origin:"calculated-column"}}),children:"Add Column"})]})},DI=({sourceId:t,pgEnv:s,falcor:n,metadata:r,setMetadata:a,col:l})=>{const i=r.filter(c=>c.name!==l);a(i),n.set({paths:[["dama",s,"sources","byId",t,"attributes","metadata"]],jsonGraph:{dama:{[s]:{sources:{byId:{[t]:{attributes:{metadata:JSON.stringify(i)}}}}}}}}).then(c=>console.log("RES:",c))},RI=({col:t,metadata:s,setMetadata:n,sourceId:r})=>{const{pgEnv:a,falcor:l}=w.useContext(ce);return e.jsx("div",{className:"float-right",children:e.jsx(We,{themeOptions:{size:"xs",color:"cancel"},onClick:i=>DI({sourceId:r,pgEnv:a,falcor:l,metadata:s,setMetadata:n,col:t}),children:e.jsx("i",{className:"fad fa-trash p-2 pt-3 rounded"})})})},FI=({sourceId:t,metadata:s,setMetadata:n,col:r,value:a})=>{const{pgEnv:l,falcor:i}=w.useContext(ce),c=w.useCallback(async d=>{await $a({sourceId:t,pgEnv:l,falcor:i,metadata:s,setMetadata:n,col:r,value:{defaultFn:d.target.value}})},[r,s]);return e.jsx("div",{className:"border border-blue-100 h-fit",children:e.jsxs("select",{className:"appearance-auto pl-3 pr-4 py-2.5 bg-blue-50 w-full bg-white text-sm",value:a,onChange:c,children:[e.jsx("option",{value:null,children:"none"}),e.jsx("option",{value:"Sum",children:"sum"}),e.jsx("option",{value:"Count",children:"count"}),e.jsx("option",{value:"List",children:"list"})]})})},VI=({sourceId:t,metadata:s,setMetadata:n,col:r,value:a})=>{const{pgEnv:l,falcor:i}=w.useContext(ce),c=w.useCallback(async d=>{await $a({sourceId:t,pgEnv:l,falcor:i,metadata:s,setMetadata:n,col:r,value:{type:d.target.value}})},[r,s]);return e.jsx("div",{className:"border border-blue-100",children:e.jsxs("select",{className:"appearance-auto pl-3 pr-4 py-2.5 h-fit w-full bg-white mr-2 text-sm",value:a,onChange:c,children:[e.jsx("option",{value:null,children:"none"}),e.jsx("option",{value:"integer",children:"integer"}),e.jsx("option",{value:"number",children:"number"}),e.jsx("option",{value:"string",children:"string"}),e.jsx("option",{value:"boolean",children:"boolean"}),e.jsx("option",{value:"object",children:"object"})]})})},HI=({sourceId:t,metadata:s,setMetadata:n,col:r,value:a})=>{const{pgEnv:l,falcor:i}=w.useContext(ce),c=w.useCallback(async d=>{await $a({sourceId:t,pgEnv:l,falcor:i,metadata:s,setMetadata:n,col:r,value:{isDollar:d}})},[r,s]);return e.jsxs("div",{className:"block w-full flex mt-1 items-center",children:[e.jsx("label",{className:"align-bottom shrink py-2 my-1 text-sm",children:" Is Dollar: "}),e.jsx("div",{className:"align-bottom p-2 my-1 rounded-md shrink self-center",children:e.jsxs(Tt,{checked:a,onChange:c,className:`
                         ${a?"bg-indigo-600":"bg-gray-200"}
                         relative inline-flex 
                         h-4 w-10 shrink
                         cursor-pointer rounded-full border-2 border-transparent 
                         transition-colors duration-200 ease-in-out focus:outline-none focus:ring-0.5
                         focus:ring-indigo-600 focus:ring-offset-2`,children:[e.jsx("span",{className:"sr-only",children:"toggle is dollar by"}),e.jsx("span",{"aria-hidden":"true",className:`
                            ${a?"translate-x-5":"translate-x-0"}
                            pointer-events-none inline-block 
                            h-3 w-4
                            transform rounded-full bg-white shadow ring-0
                            transition duration-200 ease-in-out
                            `})]},`isDollar-${r}`)})]})},Cm=({source:t,colOrigin:s,...n})=>{const{user:r}=w.useContext(ce),[a,l]=w.useState([]),[i,c]=w.useState(null),d=gt.lexical.ViewComp,{authLevel:u}=r,p=u<5?"grid-cols-6":"grid-cols-8",m=[{name:"Column",auth:!1,Comp:()=>e.jsx(e.Fragment,{}),width:2},{name:"Description",auth:!1,width:3},{name:"Type",auth:!1},{name:"Display",auth:!0,minAuthLevel:5},{name:"Default Fn",auth:!0,minAuthLevel:5}];return w.useEffect(()=>{const h=JSON.parse(JSON.stringify(C(t,["metadata","columns"],C(t,"metadata",[]))));if(Array.isArray(h)){const f=h.map(g=>({display:"",...g}));l(f)}else l([])},[t]),!a||!a.map||a.length===0?e.jsx("div",{children:" Metadata Not Available "}):e.jsxs("div",{className:"overflow-hidden",children:[u>5&&s==="calculated-column"&&e.jsx(PI,{sourceId:t.source_id,metadata:a,setMetadata:l}),e.jsx("div",{className:`py-4 sm:py-2 sm:grid sm:${p} sm:gap-4 sm:px-6 border-b-2`,children:m.filter(h=>(!h.auth||h.auth&&u>=h.minAuthLevel)&&(!h.hasOwnProperty("condition")||h.condition)).map((h,f)=>e.jsx("dd",{className:`text-sm font-medium text-gray-600 col-span-${h.width||1}`,children:h.name},f))}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:a.filter(h=>h.origin===s).map((h,f)=>e.jsxs("div",{className:`py-4 sm:py-5 sm:grid sm:${p} sm:gap-4 sm:px-6`,children:[e.jsxs("dt",{className:"text-sm text-gray-900 col-span-2",children:[e.jsxs("div",{className:"flex flex-row justify-between group",children:[i===`${h.name}-columnName`?e.jsx("div",{className:"pt-3 pr-8",children:e.jsx(Xl,{metadata:a,setMetadata:l,col:h.name,startValue:C(h,"name")||"No Display Name",attr:"name",sourceId:t.source_id,setEditing:c,cancel:()=>c(null)})}):e.jsx("div",{className:"pt-3 pr-8",children:C(h,"name")||"No Name"}),u>5&&h.origin==="calculated-column"?e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:g=>c(`${h.name}-columnName`),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12 p-2 pt-3 hover:bg-blue-500 rounded focus:bg-blue-700 hover:text-white "})}):""]}),e.jsxs("div",{className:"flex flex-row justify-between group",children:[i===`${h.name}-displayName`?e.jsx("div",{className:"pt-3 pr-8",children:e.jsx(Xl,{metadata:a,setMetadata:l,col:h.name,startValue:C(h,"display_name")||"No Display Name",attr:"display_name",sourceId:t.source_id,setEditing:c,cancel:()=>c(null)})}):e.jsx("div",{className:"pt-3 pr-8 font-bold",children:C(h,"display_name")||"No Display Name"}),u>5?e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:g=>c(`${h.name}-displayName`),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12 p-2 pt-3 hover:bg-blue-500 rounded focus:bg-blue-700 hover:text-white "})}):""]})]}),e.jsxs("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 flex flex-row justify-between group col-span-3",children:[i===`${h.name}-description`?e.jsx("div",{className:"pr-8",children:e.jsx(Xl,{type:"lexical",metadata:a,setMetadata:l,col:h.name,startValue:C(h,"desc")||"No Description",attr:"desc",sourceId:t.source_id,setEditing:c,cancel:()=>c(null)})}):e.jsx("div",{className:"pr-8",children:e.jsx(d,{value:C(h,"desc","No Desc")})}),u>5?e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:g=>c(`${h.name}-description`),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12 p-2 hover:bg-blue-500 rounded focus:bg-blue-700 hover:text-white "})}):""]}),e.jsxs("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0",children:[u>5&&h.origin==="calculated-column"?e.jsx(VI,{metadata:a,setMetadata:l,col:h.name,value:h.type,sourceId:t.source_id}):e.jsx("div",{className:"text-gray-400 italic",children:h.type}),u>5&&["integer","number"].includes(h.type)?e.jsx(HI,{metadata:a,setMetadata:l,col:h.name,value:h.isDollar,sourceId:t.source_id}):null]}),u>5&&e.jsxs("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0",children:[e.jsx(BI,{metadata:a,setMetadata:l,col:h.name,value:h.display,sourceId:t.source_id}),["meta-variable","geoid-variable"].includes(h.display)&&e.jsx(AI,{metadata:a,setMetadata:l,col:h.name,startValue:C(h,"meta_lookup")||"No Meta Lookup Available",attr:"meta_lookup",sourceId:t.source_id,setEditing:c,cancel:()=>c(null)})]}),u>5&&e.jsxs("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 flex flex-row",children:[e.jsx(FI,{metadata:a,setMetadata:l,col:h.name,value:h.defaultFn,sourceId:t.source_id}),h.origin==="calculated-column"&&e.jsx(RI,{metadata:a,setMetadata:l,col:h.name,sourceId:t.source_id})]})]},f))})})]})},zI=({source:t,views:s,...n})=>e.jsxs("div",{className:"w-full flex-1 sm:px-6 divide-y-4 grid gap-y-6 ",children:[e.jsx(Cm,{source:t,colOrigin:void 0}),e.jsx(Cm,{source:t,colOrigin:"calculated-column"})]}),UI=({source:t,views:s,user:n,baseUrl:r})=>{const a=Math.max(...s.map(d=>parseInt(d.version)||0))+1,[l,i]=b.useState(a),c=w.useMemo(()=>{let d=C(t,"type","").substring(0,3)==="tl_"?"tiger_2017":t.type;return C(Zt,`[${d}].sourceCreate.component`,()=>e.jsxs("div",{children:[" Cannot create new ",t.type," version. "]}))},[t]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-sm font-medium text-gray-500 ",children:[e.jsx("label",{children:"Version Name:"}),e.jsx("input",{className:"p-2",placeholder:l,onChange:d=>i(d.target.value)},"versionName")]}),e.jsx(c,{source:t,existingSource:t,user:n,newVersion:l,baseUrl:r})]})},WI=({uploads:t=[],sourceId:s=null})=>{const n=$e(),{baseUrl:r}=w.useContext(ce);return e.jsx("div",{className:"w-full p-4 bg-white shadow mb-4",children:t&&t.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-4 sm:py-2 mt-2 sm:grid sm:grid-cols-5 sm:gap-4 sm:px-6 border-b-2",children:["Id","Status","Initial Event Id","Latest Event Id","Last Updated"].map(a=>e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:a},a))}),e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200 odd:bg-white even:bg-slate-50",children:(t||[]).map((a,l)=>{var i;return e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-5 sm:gap-4 sm:px-6 cursor-pointer hover:bg-slate-200",onClick:()=>n(`${r}/source/${s}/uploads/${a==null?void 0:a.etl_context_id}`),children:[e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:a==null?void 0:a.etl_context_id},`${l}_1`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:typeof(a==null?void 0:a.etl_status)=="string"?a==null?void 0:a.etl_status:""},`${l}_2`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:typeof(a==null?void 0:a.initial_event_id)=="number"?a==null?void 0:a.initial_event_id:""},`${l}_3`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:typeof(a==null?void 0:a.latest_event_id)=="number"?a==null?void 0:a.latest_event_id:""},`${l}_4`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:(i=a==null?void 0:a._modified_timestamp)==null?void 0:i.value},`${l}_5`)]},`${l}_0`)})})]}):e.jsx("div",{className:"text-center",children:"No Actions found"})})},Hx="gis-dataset",zx=`${Hx}:ogr_data`,GI="upload",JI=`${GI}:GIS_FILE_UPLOAD_PROGRESS`,qI="final",KI=[JI,zx],YI="gis_dataset";function ZI({ctxId:t}){var f,g,x;const{pgEnv:s,falcor:n,falcorCache:r}=w.useContext(ce),a=`${Rt}/dama-admin/${s}`,[l,i]=b.useState(!1),[c,d]=b.useState(!1),[u,p]=b.useState();b.useEffect(()=>{async function y(){await n.get(["dama",s,"etlContexts","byEtlContextId",t])}y()},[n,s,t]);const m=b.useMemo(()=>C(r,["dama",s,"etlContexts","byEtlContextId",t,"value"]),[r]);b.useEffect(()=>{async function y(){var j,N;return(j=m==null?void 0:m.meta)!=null&&j.source_id?await n.get(["dama",s,"sources","byId",(N=m==null?void 0:m.meta)==null?void 0:N.source_id,"attributes","type"]):null}y()},[n,s,(f=m==null?void 0:m.meta)==null?void 0:f.source_id]);const h=b.useMemo(()=>{var y;return C(r,["dama",s,"sources","byId",(y=m==null?void 0:m.meta)==null?void 0:y.source_id,"attributes"])},[r]);return b.useEffect(()=>{var _;const y=m==null?void 0:m.events.some(E=>E.type.toLowerCase().includes(qI)),j=m==null?void 0:m.events.find(E=>{var L;return(L=E.type)==null?void 0:L.toLowerCase().includes("initial")}),N=((_=j==null?void 0:j.type)==null?void 0:_.split(":")[0])===Hx||(h==null?void 0:h.type)===YI;if(m!=null&&m.events&&N&&!y){const L=(m==null?void 0:m.events.filter(k=>k.type===zx)).map(k=>k.payload.data),S=L[L.length-1];p(S),i(!0)}else p(void 0),i(!1)},[m==null?void 0:m.events]),b.useEffect(()=>{const y=async()=>{n.invalidate(["dama",s,"etlContexts","byEtlContextId",t]),await n.get(["dama",s,"etlContexts","byEtlContextId",t])};if(l&&!c){let j=setInterval(y,3e3);d(j)}else c&&!l&&(clearInterval(c),y(),i(!1),d(null),p(void 0))},[l,c,a,u]),e.jsxs("div",{className:"w-full p-4 bg-white shadow mb-4",children:[u!==void 0&&e.jsx(XI,{progress:u}),m&&(m!=null&&m.events)&&((g=m==null?void 0:m.events)!=null&&g.length)?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-4 sm:py-2 mt-2 sm:grid sm:grid-cols-5 sm:gap-4 sm:px-6 border-b-2",children:["Id","Event Type","Data","Timestamp"].map(y=>e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:y},y))}),e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200 odd:bg-white even:bg-slate-50",children:(((x=m==null?void 0:m.events)==null?void 0:x.filter(y=>!KI.includes(y.type)))||[]).map((y,j)=>{var N,_;return e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-5 sm:gap-4 sm:px-6 cursor-pointer hover:bg-slate-200",children:[e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle break-words",children:y==null?void 0:y.event_id},`${j}_1`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle break-words",children:(N=y==null?void 0:y.type)==null?void 0:N.split(":").pop()},`${j}_2`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle break-words",children:JSON.stringify((_=y==null?void 0:y.payload)==null?void 0:_.data)},`${j}_3`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle break-words",children:y._created_timestamp},`${j}_4`)]},`${j}_0`)})})]}):e.jsx("div",{className:"text-center",children:"No Events found"})]})}const XI=({progress:t})=>{const s={display:"inline-block",height:"100%",width:"100%",backgroundColor:"whitesmoke",borderRadius:40,margin:0},n={display:"inline-block",height:"84%",width:`${t}%`,backgroundColor:"#3b82f680",borderRadius:40,textAlign:"right"},r={padding:10,color:"black",fontWeight:900};return e.jsxs("div",{style:s,children:[e.jsxs("span",{style:{fontWeight:"bold",paddingLeft:"10px",paddingRight:"10px"},children:[" ","Proccessed:"]}),e.jsx("div",{style:n,children:e.jsx("span",{style:r,children:`${t}%`})})]})},QI=({})=>{const{pgEnv:t,falcor:s,falcorCache:n}=w.useContext(ce),{viewId:r,page:a,sourceId:l}=Ye();if(a==="uploads"&&r)return e.jsx(ZI,{ctxId:r});b.useEffect(()=>{async function c(){const d=["dama",t,"etlContextsbyDamaSourceId",[l],"length"],u=await s.get(d);await s.get(["dama",t,"etlContextsbyDamaSourceId",[l],"byIndex",{from:0,to:C(u.json,d,0)-1},["etl_context_id","_created_timestamp","etl_status","_modified_timestamp","initial_event_id","latest_event_id"]])}c()},[s,t,l]);const i=b.useMemo(()=>{let c=C(n,["dama",t,"etlContextsbyDamaSourceId",[l],"byIndex"]);return c&&Object.values(c).map(d=>C(n,d.value,{})).filter(d=>Object.keys(d).length>0)},[n,l]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex",children:e.jsx("div",{className:"flex-1 pl-3 pr-4 py-2",children:"Actions"})}),e.jsx(WI,{uploads:i,sourceId:l})]})},tc=["etl_status","etl_context_id","created_at","terminated_at","source_id","parent_context_id","type","payload","user"];function eT(t){const s=t instanceof Date?t:new Date(t),n=new Intl.RelativeTimeFormat("en"),r={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},a=(s.getTime()-Date.now())/1e3;for(let l in r)if(r[l]<Math.abs(a)){const i=a/r[l];return n.format(Math.round(i),l)}}const tT=t=>{const{value:s}=t;return e.jsx("div",{children:eT(s)})},sT=t=>{const{value:s}=t;let n="";return parseInt(s)<2e3?n=`${s} ms`:parseInt(s)<6e5?n=`${Math.floor(s/1e3)} seconds`:parseInt(s)<36e5?n=`${Math.floor(s/1e3/60)} minutes`:n=`${Math.floor(s/1e3/60/60)} hours`,isNaN(n)&&(n=""),e.jsx("div",{children:n})},Ux=({value:t})=>typeof t=="string"&&(t!=null&&t.includes("@"))?t:typeof t!="object"?`User ${t}`:"",nT=[{accessor:"etl_context_id",Header:"ETL Context ID"},{accessor:"type",Header:"Type",Cell:({value:t})=>{const s=t.split(":")[0].replace("-"," ");return e.jsx("div",{className:"capitalize",children:s})}},{accessor:"source_name",Header:"Source Name",Cell:({value:t})=>typeof t=="string"?t:""},{accessor:"user",Header:"User",Cell:Ux},{accessor:"created_at",Header:"Started",Cell:tT},{accessor:"duration",Header:"Duration",Cell:sT},{accessor:"etl_status",Header:"ETL Status"}],Pa=10,Wx=t=>{const{sourceId:s}=t,{pgEnv:n,falcor:r,falcorCache:a,baseUrl:l}=w.useContext(ce),[i,c]=w.useState(0),d=w.useMemo(()=>ws(i*Pa,i*Pa+Pa),[i,Pa]),u=s?["dama",n,"latest","events","for","source",s,"length"]:["dama",n,"latest","events","length"],p=s?["dama",n,"latest","events","for","source",s,d,tc]:["dama",n,"latest","events",d,tc];w.useEffect(()=>{(async()=>{await r.get(u)})()},[r,n]);const m=w.useMemo(()=>C(a,u),[r,a,n]);w.useEffect(()=>{(async()=>{await r.get(p).then(y=>{const j=p.slice(0,p.length-2),N=Object.values(C(y,["json",...j])).map(_=>_.source_id).filter(_=>!!_);return r.get(["dama",n,"sources","byId",N,"attributes","name"])})})()},[r,n,d]);const h=w.useMemo(()=>{const x=p.slice(0,p.length-2);return d.map(y=>({...C(a,[...x,y])})).map(y=>{if(y.source_id){const j=C(a,["dama",n,"sources","byId",y.source_id,"attributes","name"]);y.source_name=typeof j=="string"?j:""}return y}).filter(y=>!!y.etl_context_id)},[d,a]),f=$e(),g=w.useCallback((x,y)=>{x.ctrlKey?window.open(`${l}/task/${y.values.etl_context_id}`,"_blank"):f(`${l}/task/${y.values.etl_context_id}`)},[f]);return e.jsx(St,{data:h,columns:nT,pageSize:Pa,manualPagination:!0,numRecords:m,onPageChange:c,manualCurrentPage:i,onRowClick:g,sortBy:"created_at",sortOrder:"desc",disableFilters:!0,disableSortBy:!0})},aT=({source:t,views:s,activeViewId:n})=>{const r=["Guest User","Public User","Agency User"],a=["view","download"],l=Object.assign({},...r.map(x=>({[x]:Object.assign({},...a.map(y=>({[y]:!1})))})));w.useState(l);const{sourceId:i}=Ye(),{pgEnv:c,baseUrl:d,user:u,falcor:p}=w.useContext(ce),{visibility:m="visible"}=(t==null?void 0:t.statistics)||{},{access:h=l}=(t==null?void 0:t.statistics)||{},f=async()=>{const x=(t==null?void 0:t.statistics)||{};x.visibility=m=="hidden"?"visible":"hidden",await p.set({paths:[["dama",c,"sources","byId",i,"attributes","statistics"]],jsonGraph:{dama:{[c]:{sources:{byId:{[i]:{attributes:{statistics:JSON.stringify(x)}}}}}}}})},g=async(x,y,j)=>{const N=JSON.parse(JSON.stringify(h));N[x][y]=j.target.checked;const _=(t==null?void 0:t.statistics)||{};_.access=N,await p.set({paths:[["dama",c,"sources","byId",i,"attributes","statistics"]],jsonGraph:{dama:{[c]:{sources:{byId:{[i]:{attributes:{statistics:JSON.stringify(_)}}}}}}}})};return e.jsxs("div",{children:[e.jsxs("div",{className:" flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex justify-between group",children:e.jsx("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:e.jsx("dd",{className:"mt-1 text-2xl text-gray-700 font-medium overflow-hidden sm:mt-0 sm:col-span-3",children:"Admin"})})}),e.jsxs("div",{className:"flex-1 border-b-2 ",children:[e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"flex items-center border-t-2 ",children:e.jsx("div",{className:"py-3 px-6 text-blue-500 font-medium text-lg",children:" Access Controls"})})}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",style:{paddingRight:"40px"}}),e.jsx("th",{className:"text-center",children:"Show"}),e.jsx("th",{className:"text-center",children:"Download"})]})}),e.jsx("tbody",{children:r.map((x,y)=>e.jsxs("tr",{className:"border-b-2 ",children:[e.jsx("td",{className:"p-2",children:x}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:h[x].view,onChange:j=>g(x,"view",j)})}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:h[x].download,onChange:j=>g(x,"download",j)})})]},y))})]})]})]}),e.jsxs("div",{className:"w-72 ",children:[e.jsx("div",{children:" Admin Actions "}),e.jsx("div",{className:"w-full p-1 flex",children:e.jsxs(je,{className:"w-full flex-1 text-center border shadow hover:bg-blue-100 p-4",to:`${d}/source/${t.source_id}/meta_advanced`,children:["Advanced Metadata ",e.jsx("i",{className:"fa fa-circle-info"})]})}),e.jsx("div",{className:"w-full p-1 flex",children:e.jsxs(je,{className:"w-full flex-1 text-center border shadow hover:bg-blue-100 p-4",to:`${d}/source/${t.source_id}/add_version`,children:["Add Version ",e.jsx("i",{className:"fad fa-upload"})]})}),e.jsx("div",{className:"flex w-full p-1",children:e.jsxs(je,{onClick:f,className:"w-full flex-1 text-center border shadow hover:bg-blue-100 p-4",style:{backgroundColor:m=="visible"?"lightgreen":"#FF7276"},children:["Visibile ",m=="visible"?"ON":"OFF"]})}),e.jsx("div",{className:"w-full p-1 flex",children:e.jsxs(je,{className:"w-full flex-1 text-center bg-red-100 border border-red-200 shadow hover:bg-red-400 hover:text-white p-4",to:`${d}/delete/source/${t.source_id}`,children:["Delete ",e.jsx("i",{className:"fad fa-trash"})]})})]})]}),e.jsx("div",{className:"py-10 px-2",children:e.jsx(Wx,{sourceId:i})})]})},ei={overview:{name:"Overview",path:"",component:II},versions:{name:"Versions",path:"/versions",hidden:"true",component:Ox},uploads:{name:"Uploads",path:"/uploads",authLevel:5,hidden:!0,component:QI},add_version:{name:"Add Version",path:"/add_version",authLevel:5,hidden:!0,component:UI},meta_advanced:{name:"Metadata",path:"/meta_advanced",hidden:!0,component:zI},admin:{name:"Admin",path:"/admin",authLevel:10,component:aT}},co={},Ro={};for(const t in $t.schemeGroups)Ro[t]={},$t.schemeGroups[t].forEach(s=>{const n=$t[s];Ro[t][s]=n;for(const r in n)r in co||(co[r]=[]),co[r].push({type:`${t[0].toUpperCase()}${t.slice(1)}`,name:s,category:"Colorbrewer",colors:n[r]})});const rT=t=>{const{color:s,hoveringParent:n,onMouseEnter:r=null,onMouseLeave:a=null,isFirst:l,isLast:i}=t,[c,d]=w.useState(!1),u=w.useMemo(()=>typeof r!="function"?null:m=>{d(!0),r(s,m)},[s,r]),p=w.useMemo(m=>typeof a!="function"?null:h=>{d(!1),a(s,h)},[s,a]);return e.jsx("div",{className:`
        flex-1 relative
        ${r?"hover:outline hover:outline-1 outline-current":""}
        ${l&&i?"rounded":l?"rounded-l":i?"rounded-r":""}
      `,onMouseEnter:u,onMouseLeave:p,style:{backgroundColor:s,opacity:c||!n?"100%":"50%",zIndex:c?50:0}})},Sr=({colors:t,onMouseEnter:s,onMouseLeave:n,height:r=4})=>{const[a,l]=w.useState(!1),i=w.useCallback(d=>{l(!!s)},[s]),c=w.useCallback(d=>{l(!1)},[]);return e.jsx("div",{className:"flex rounded w-full",style:{height:`${r*.25}rem`},onMouseEnter:i,onMouseLeave:c,children:t.map((d,u)=>e.jsx(rT,{color:d,onMouseEnter:s,onMouseLeave:n,hoveringParent:a,isFirst:u===0,isLast:u===t.length-1},d))})},kn=t=>t==null||typeof t=="string"&&!t.length?!1:Array.isArray(t)?t.reduce((s,n)=>s||kn(n),!1):typeof t=="number"&&isNaN(t)?!1:typeof t=="object"?Object.values(t).reduce((s,n)=>s||kn(n),!1):!0,oT=t=>{const s=C(t,"current",t);return s?s.getBoundingClientRect():{width:0,height:0,x:0,y:0}},lT=(t,s=null)=>{const[n,r]=w.useState({width:0,height:0,x:0,y:0}),a=w.useCallback(()=>{const{width:l,height:i,x:c,y:d}=oT(t);(l!==n.width||i!==n.height)&&(typeof s=="function"&&s({width:l,height:i,x:c,y:d}),r({width:l,height:i,x:c,y:d}))},[t,n,s]);return w.useEffect(()=>(window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}),[a]),w.useEffect(()=>{a()},[a]),n},iT=t=>t.split("s+").map(s=>s.split("").map((n,r)=>r===0?n.toUpperCase():n).join("")).join(" "),Gx=[],Jx=()=>{},Fo=t=>t,qx=t=>{t.stopPropagation()},Kx=(t,s,n,r,a=[])=>t.reduce((l,i,c)=>(s.includes(r(i))&&l.push({display:n(i),value:r(i),key:c}),Kx(C(i,"children",[]),s,n,r,l)),a),Dn=t=>{const{options:s=Gx,value:n=null,onChange:r=Jx,isMulti:a=!1,displayAccessor:l=Fo,valueAccessor:i=Fo,xDirection:c=0,zIndex:d=5,placeholder:u="Select a value...",disabled:p=!1,DisplayItem:m=Xx,isDropdown:h=!1,searchable:f=!1,removable:g=!0,InputContainer:x=Zx,maxOptions:y=null,children:j}=t,N=w.useMemo(()=>kn(n)?Array.isArray(n)?n:[n]:[],[n]),[_,E]=w.useState(null),[L,S]=w.useState(!1),k=w.useCallback(H=>{H.stopPropagation(),S(z=>!z)},[]);w.useCallback(H=>{H.stopPropagation(),S(!0)},[]);const $=w.useCallback(H=>{H.stopPropagation(),S(!1)},[]);cd(_,$);const[I,T]=w.useState(),[A,R]=w.useState(c),[O,M]=w.useState(0);w.useEffect(()=>{if(!I||!L){M(0);return}const H=I.getBoundingClientRect(),z=window.innerHeight,W=window.innerWidth;H.x+H.width>W&&R(Y=>-Y),H.y+H.height>z&&M(z-(H.y+H.height))},[I,L]);const[D,P]=w.useState(""),F=w.useCallback(H=>{const z=i(H);if(P(""),a)if(N.includes(z)){const W=N.filter(Y=>Y!==z);(g||W.length)&&r(W)}else r([...N,z]);else g&&N.includes(z)?r(null):r(z),kn(z)&&S(!1)},[N,r,a,g,l,i]),B=w.useCallback(H=>{a&&N.includes(H)?r(N.filter(z=>z!==H)):!a&&N.includes(H)&&r(null)},[N,r,a]),V=w.useMemo(()=>Kx(s,N,l,i),[s,N,l,i]),G=w.useMemo(()=>s.reduce((H,z)=>H||!!C(z,["children","length"],0),!1),[s]),Z=w.useMemo(()=>eb(s,{keys:[{name:"label",getFn:l}],threshold:.25}),[s,l]),X=w.useCallback(H=>C(H,"DisplayItem",m),[m]);return Z(D),e.jsxs("div",{ref:E,className:"relative cursor-pointer",onClick:k,children:[h?j:e.jsx(uT,{placeholder:u,disabled:p,removable:g,remove:B,displayValues:V}),e.jsxs("div",{ref:T,className:`absolute w-full max-w-full ${L?"h-fit":"hidden h-0"}`,style:{zIndex:d,top:`calc(100% + ${O}px)`,left:A===1?"100%":A==0?"0%":null,right:A===-1?"100%":null,paddingTop:"0.25rem"},children:[!f||G||s.length<10?null:e.jsx("div",{className:"w-full",style:{bottom:A?"100%":null,position:A?"absolute":"block"},onClick:qx,children:e.jsx(x,{children:e.jsx(fl,{value:D,onChange:P,placeholder:"search options..."})})}),s.length?null:e.jsx(m,{children:"No options available..."}),e.jsx("div",{className:"w-full min-w-fit scrollbar-xs",style:{maxHeight:G?null:"20rem",overflow:G?null:"auto"},children:Z(D).slice(0,y||1/0).map((H,z)=>{const W=X(H),Y=i(H);return e.jsx(Yx,{...t,options:C(H,"children",[]),xDirection:1,zIndex:d+5,select:F,Value:N,children:e.jsx(Qx,{disabled:!kn(Y),select:F,option:H,children:e.jsx(W,{value:Y,active:N.includes(Y),hasChildren:!!C(H,["children","length"],0),children:l(H)})})},z)})})]})]})},Yx=t=>{const{options:s=Gx,Value:n=null,select:r=Jx,displayAccessor:a=Fo,valueAccessor:l=Fo,xDirection:i,zIndex:c,DisplayItem:d=Xx,searchable:u=!1,InputContainer:p=Zx,maxOptions:m=null,children:h}=t,[f,g]=w.useState(!1),x=w.useCallback(O=>{g(!0)},[]),y=w.useCallback(O=>{g(!1)},[]),[j,N]=w.useState(),[_,E]=w.useState(i),[L,S]=w.useState(0);w.useEffect(()=>{if(!j)return;const O=j.getBoundingClientRect(),M=window.innerHeight,D=window.innerWidth;O.x+O.width>D&&E(P=>-P),O.y+O.height>M&&S(M-(O.y+O.height))},[j]);const k=w.useMemo(()=>s.reduce((O,M)=>O||!!C(M,["children","length"],0),!1),[s]),[$,I]=w.useState(""),T=w.useCallback(O=>{r(O),I("")},[r]),A=w.useMemo(()=>eb(s,{keys:[{name:"label",getFn:a}],threshold:.25}),[s,a]),R=w.useCallback(O=>C(O,"Item",d),[d]);return Ve(),e.jsxs("div",{className:"relative cursor-pointer",onMouseEnter:s.length?x:null,onMouseLeave:s.length?y:null,children:[h,e.jsx("div",{ref:N,className:`absolute w-full ${f?"h-fit":"hidden h-0"}`,style:{zIndex:c,top:`${L}px`,left:_===1?"100%":_==0?"0%":null,right:_===-1?"100%":null},children:e.jsxs("div",{className:"w-full min-w-fit scrollbar-xs",style:{maxHeight:k?null:"20rem",overflow:k?null:"auto"},children:[!u||k||s.length<10?null:e.jsx("div",{className:"w-full",style:{bottom:_?"100%":null,position:_?"absolute":"block"},onClick:qx,children:e.jsx(p,{className:"rounded-t pt-2",children:e.jsx(fl,{value:$,onChange:I,placeholder:"search options..."})})}),e.jsx("div",{className:"w-fit",children:A($).slice(0,m).map((O,M)=>{const D=R(O),P=l(O);return e.jsx(Yx,{...t,options:C(O,"children",[]),xDirection:_,zIndex:c+5,children:e.jsx(Qx,{select:T,option:O,children:e.jsx(D,{value:P,active:n.includes(P),hasChildren:!!C(O,["children","length"],0),children:a(O)})})},M)})})]})})]})},Zx=({className:t="",children:s})=>{const n=Ve();return e.jsx("div",{className:`${n.bgAccent1} p-1 border-b ${t}`,children:s})},cT=({display:t,value:s,remove:n,removable:r})=>{const a=w.useCallback(i=>{i.stopPropagation(),n(s)},[n,s]),l=Ve();return e.jsxs("div",{className:`
        px-1 flex items-center rounded mt-1 ml-1
        ${r?l.bgAccent1:""}
      `,children:[t,r?e.jsx("span",{onClick:a,className:`
            fa fa-remove text-xs ml-2 px-1 rounded
            ${l.bgAccent3Hover}
          `}):null]})},dT=({children:t})=>{const s=Ve();return e.jsx("div",{className:`px-1 mt-1 ml-1 ${s.textDisabled}`,children:t})},uT=t=>{const{displayValues:s,placeholder:n,disabled:r,remove:a,removable:l}=t,i=Ve();return e.jsx("div",{tabIndex:-1,className:`
        ${i.bgInput} rounded pl-1 pb-1 pr-2 flex flex-wrap
        focus:outline-1 focus:outline focus:outline-current
        hover:outline-1 hover:outline hover:outline-gray-300
      `,children:s.length?s.map((c,d)=>e.jsx(cT,{...c,removable:l,remove:a},c.key)):e.jsx(dT,{children:n})})},Xx=({children:t,active:s,hasChildren:n})=>{const r=Ve();return e.jsxs("div",{className:`
        py-1 px-2 flex items-center text-left min-w-fit max-w-full whitespace-nowrap
        ${s?r.bgAccent3:`${r.bgAccent2Hover} ${r.bgAccent1}`}
      `,children:[e.jsx("div",{className:"flex-1",children:t}),n?e.jsx("span",{className:"fa fa-caret-right ml-2"}):null]})},Qx=({select:t,option:s,disabled:n,children:r})=>{const a=w.useCallback(l=>{l.stopPropagation(),t(s)},[t,s]);return e.jsx("div",{onClick:n?null:a,children:r})},cd=(t,s)=>{t=C(t,"current",t),w.useEffect(()=>{if(!t)return;const n=r=>{t&&!t.contains(r.target)&&s(r)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[t,s])},eb=(t,s)=>{const n=new Zy(t,s);return r=>r?n.search(r).map(a=>a.item):t},mT=(t,s)=>t.split(/\s+/).map(n=>{const[r,...a]=n.split(new RegExp("(?<!^)(?=[A-Z])"));return s.$compositions&&s.$compositions[r]?s.$compositions[r].reduce((l,i)=>{let c=i.$default||"";for(const d of a)d in i&&(c=i[d]);return l.push(c),l},[]).filter(Boolean).join(" "):s[r]||n}).filter(Boolean).join(" "),tb=t=>{const s=JSON.parse(JSON.stringify(t)),n=/^.*[@](.+)\s*/;for(const r in s){if(r==="$compositions")continue;const a=s[r].split(/\s+/);s[r]=a.map(l=>{const i=n.exec(l);if(i){const[,c]=i;return o.replace(`@${c}`,s[c])}return l}).join(" ")}if(s.$compositions)for(const r in s.$compositions)s.$compositions[r].forEach(a=>{for(let l in a){a[l]=a[l].split(/\s+/).map(d=>{const u=n.exec(d);if(u){const[,p]=u;return d.replace(`@${p}`,s[p])}return d}).join(" ");const c=/^\$(.+)$/.exec(a[l]);if(c){const[,d]=c;d in s&&(a[l]=s[d])}}});return s},pT={get:(t,s,n)=>(s in t||(t[s]=mT(s,t)),t[s])},sb=t=>new Proxy(t,pT),hT=[{$default:"rounded inline-block @transition disabled:cursor-not-allowed",Text:"rounded inline-flex items-center justify-center @transition disabled:cursor-not-allowed"},{$default:"@bgInput",Text:"@bg"},{$default:"@textButton",Primary:"@textPrimary",Success:"@textSuccess",Danger:"@textDanger",Info:"@textInfo",Dark:"@text"},{$default:"outline outline-1 @outlineButton",Primary:"outline outline-1 @outlinePrimary",Success:"outline outline-1 @outlineSuccess",Danger:"outline outline-1 @outlineDanger",Info:"outline outline-1 @outlineInfo",Dark:"outline outline-1 @outline",Text:""},{$default:"disabled:hover:bg-white @bgButtonHover @textContrastHover",Primary:"disabled:hover:bg-white @bgPrimaryHover @textContrastHover",Success:"disabled:hover:bg-white @bgSuccessHover @textContrastHover",Danger:"disabled:hover:bg-white @bgDangerHover @textContrastHover",Info:"disabled:hover:bg-white @bgInfoHover @textContrastHover",Dark:"disabled:hover:bg-white @bgContrastHover @textContrastHover",Text:"disabled:hover:bg-gray-100 @bgInputHover"},{$default:"@paddingBase @textBase",Large:"@paddingLarge @textLarge",Small:"@paddingSmall @textSmall"},{Block:"w-full"}],fT=[{$default:`w-full block rounded @transition @text
							cursor-pointer disabled:cursor-not-allowed
							focus:outline-1 focus:outline focus:outline-current
							hover:outline-1 hover:outline hover:outline-gray-300`},{$default:"@paddingBase @textBase",Large:"@paddingLarge @textLarge",Small:"@paddingSmall @textSmall"}],nb={button:hT,input:fT},gT={bgInput:"bg-white",bgInputHover:"hover:bg-white",bgLegend:"bg-gray-300",bgLegendHover:"hover:bg-gray-300",bgContrast:"bg-gray-800",bgContrastHover:"hover:bg-gray-800",textContrast:"text-white",textContrastHover:"hover:text-white",text:"text-gray-800 disabled:text-gray-400 placeholder:text-gray-400",textDisabled:"text-gray-400 disabled:text-gray-400 placeholder:text-gray-400",bg:"bg-gray-100",border:"border-gray-800",outline:"outline-gray-800",textButton:"text-gray-400 disabled:text-gray-400 placeholder:text-gray-400",bgButton:"bg-gray-400",bgButtonHover:"hover:bg-gray-400",borderButton:"border-gray-400",outlineButton:"outline-gray-400",textInfo:"text-teal-400 disabled:text-teal-400 placeholder:text-teal-400",bgInfo:"bg-teal-400",bgInfoHover:"hover:bg-teal-400",borderInfo:"border-teal-400",outlineInfo:"outline-teal-400",textSuccess:"text-green-400 disabled:text-green-400 placeholder:text-green-400",bgSuccess:"bg-green-400",bgSuccessHover:"hover:bg-green-400",borderSuccess:"border-green-400",outlineSuccess:"outline-green-400",textPrimary:"text-blue-400 disabled:text-blue-400 placeholder:text-blue-400",bgPrimary:"bg-blue-400",bgPrimaryHover:"hover:bg-blue-400",borderPrimary:"border-blue-400",outlinePrimary:"outline-blue-400",textDanger:"text-red-400 disabled:text-red-400 placeholder:text-red-400",bgDanger:"bg-red-400",bgDangerHover:"hover:bg-red-400",borderDanger:"border-red-400",outlineDanger:"outline-red-400",textWarning:"text-yellow-400 disabled:text-yellow-400 placeholder:text-yellow-400",bgWarning:"bg-yellow-400",bgWarningHover:"hover:bg-yellow-400",borderWarning:"border-yellow-400",outlineWarning:"outline-yellow-400",textSmall:"text-sm",textBase:"text-base",textLarge:"text-lg",paddingSmall:"py-0 px-1",paddingBase:"py-1 px-2",paddingLarge:"py-2 px-4",bgAccent1:"bg-gray-200",bgAccent2:"bg-gray-300",bgAccent3:"bg-gray-400",bgAccent4:"bg-gray-500",bgAccent1Hover:"hover:bg-gray-200",bgAccent2Hover:"hover:bg-gray-300",bgAccent3Hover:"hover:bg-gray-400",bgAccent4Hover:"hover:bg-gray-500",textHighlight:"text-teal-500",textHighlightHover:"hover:text-teal-500",borderHighlight:"border-teal-500",borderHighlightHover:"hover:border-teal-500",bgHighlight:"bg-teal-500",bgHighlightHover:"hover:bg-teal-500",transition:"transition ease-in-out duration-150",$compositions:nb},xT=tb(gT),bT=sb(xT),ab=w.createContext(bT),Ve=()=>w.useContext(ab),yT=({theme:t,children:s})=>e.jsx(ab.Provider,{value:t,children:s}),Vo=({className:t="button",children:s,...n})=>{const r=Ve();return e.jsx("button",{className:r[t],...n,children:s})},fl=w.forwardRef(({onChange:t,className:s="input",...n},r)=>{const a=w.useCallback(i=>{t(i.target.value)},[t]),l=Ve();return e.jsx("input",{ref:r,...n,onChange:a,className:l[s]})}),Ho=(t,s,n)=>{switch(t){case"quantize":return Hn().domain(ur(s)).range(n);case"quantile":return wa().domain(s).range(n);case"threshold":return ps().domain(s).range(n);case"ordinal":return gp().domain(s).range(n)}},vT=({domain:t,range:s,format:n})=>{const r=w.useMemo(()=>Ho("ordinal",t,s),[t,s]);return w.useMemo(()=>typeof n=="function"?n:Mt(n),[n]),e.jsxs("div",{children:[e.jsx("div",{className:"grid gap-1",style:{gridTemplateColumns:`repeat(${t.length}, minmax(0, 1fr))`},children:t.map(a=>e.jsx(Sr,{colors:[r(a)],height:3},a))}),e.jsx("div",{className:"grid gap-1 text-right",style:{gridTemplateColumns:`repeat(${t.length}, minmax(0, 1fr))`},children:t.map(a=>e.jsx("div",{className:"pr-1",children:a},a))})]})},jT=({children:t})=>{const s=Ve();return e.jsx("div",{className:`
        ${s.bgAccent2} ${s.border}
        border-b border-x rounded-b px-1
      `,children:t})},wT=({range:[t,s],color:n,format:r,isFirst:a,isLast:l})=>t?s?l?e.jsxs("div",{children:[e.jsxs("div",{children:["greater than or equal to ",r(t)]}),e.jsxs("div",{children:["less than or equal to ",r(s)]})]}):e.jsxs("div",{children:[e.jsxs("div",{children:["greater than or equal to ",r(t)]}),e.jsxs("div",{children:["less than ",r(s)]})]}):e.jsx("div",{children:e.jsxs("div",{children:["greater than or equal to ",r(t)]})}):e.jsx("div",{children:e.jsxs("div",{children:["less than ",r(s)]})}),NT=({type:t,domain:s,range:n,showHover:r=!0,format:a=",d"})=>{const l=w.useMemo(()=>Ho(t,s,n),[t,s,n]),i=w.useMemo(()=>typeof a=="function"?a:Mt(a),[a]),[c,d]=w.useState(!1),u=w.useCallback((m,h)=>{d(m)},[]),p=w.useCallback(()=>{d(!1)},[]);return Ve(),e.jsxs("div",{children:[e.jsx(Sr,{colors:n,height:3,onMouseEnter:r?u:null,onMouseLeave:r?p:null}),e.jsx(_T,{type:t,scale:l,format:i}),e.jsx("div",{className:"w-full relative",children:!c||!r?null:e.jsx("div",{className:"absolute w-full left-0 top-0",children:e.jsx(jT,{children:e.jsx(wT,{color:c,range:l.invertExtent(c),format:i,isFirst:c===n[0],isLast:c===n[n.length-1]})})})})]})},CT=({type:t,...s})=>t==="ordinal"?e.jsx(vT,{...s}):e.jsx(NT,{type:t,...s}),_T=({type:t,scale:s,format:n})=>{const r=s.range().length;return t==="threshold"?e.jsxs("div",{className:"flex text-left",children:[e.jsx("div",{style:{width:`${100/r}%`}}),s.domain().map((a,l)=>e.jsx("div",{className:"pl-1",style:{width:`${100/r}%`},children:n(a)},a))]}):e.jsx("div",{className:"flex text-right",children:s.range().map((a,l)=>e.jsx("div",{className:"pr-1",style:{width:`${100/r}%`},children:n(s.invertExtent(a)[1])},a))})},ST=({value:t,onChange:s})=>{const n=w.useCallback(a=>{s(!t)},[s,t]),r=Ve();return e.jsx("div",{onClick:n,className:`
        ${r.bgInput} ${r.input}
      `,children:e.jsx("div",{className:"h-6 w-full flex items-center px-2",children:e.jsx("div",{className:`
            rounded h-2 relative flex flex-1 items-center
            ${r.bgAccent2}
          `,children:e.jsx("div",{className:`
              w-4 h-4 rounded absolute
              ${t?r.bgHighlight:r.bgAccent3}
            `,style:{left:t?"100%":"0%",transform:"translateX(-50%)",transition:"left 150ms"}})})})})},$T=({maplibreMap:t,layer:s,...n})=>null,ti=()=>null,ET=t=>{const s=Ve();return e.jsxs("div",{className:`px-2 py-1 ${s.bg} rounded`,children:[e.jsx("div",{children:"Broke-ass default hover component..."}),e.jsxs("div",{className:"flex items-center flex-col",children:[e.jsx("span",{className:"fa fa-face-sad-tear text-6xl"}),e.jsx("span",{children:"...so sad..."})]}),e.jsx("div",{className:"whitespace-pre-wrap",children:JSON.stringify(t.data,null,3)})]})},_m=750,kT=t=>{const{maplibreMap:s,layer:n,isActive:r,isVisible:a,updateHover:l,styleIndex:i,MapActions:c,resourcesLoaded:d,containerId:u,Protocols:p}=t,{sources:m,layers:h,onClick:f,onHover:g,onBoxSelect:x,RenderComponent:y}=n,j=w.useCallback(O=>{c.updateLayerState(n.id,O)},[c.updateLayerState,n.id]),N=w.useCallback(()=>{c.startLayerLoading(n.id)},[c.startLayerLoading,n.id]),_=w.useCallback(()=>{c.stopLayerLoading(n.id)},[c.stopLayerLoading,n.id]),E=w.useCallback(O=>{c.setResourcesLoaded(n.id,O)},[c.setResourcesLoaded,n.id]),[L,S]=w.useState(0),k=w.useCallback(()=>{S(O=>O+1)},[]),$=w.useCallback(()=>{S(O=>O-1)},[]);w.useEffect(()=>{if(!s||!r)return;E(!1),k(),N(),m.forEach(({id:P,source:F,protocol:B})=>{if(!s.getSource(P)){if(B in p){const{sourceInit:V,Protocol:G}=p[B];V(G,F,s)}s.addSource(P,F)}});const O=()=>{m.forEach(({id:P,source:F})=>{s.getSource(P)&&s.removeSource(P,F)})};h.forEach(P=>{s.getLayer(P.id)||(P.beneath&&s.getLayer(P.beneath)?s.addLayer(P,P.beneath):s.addLayer(P))});const M=()=>{h.forEach(P=>{s!=null&&s.getLayer(P.id)&&(s==null||s.removeLayer(P.id))})};return setTimeout(()=>{$(),_()},_m),()=>{!s||!s.loaded()||(E(!1),M(),O())}},[s,m,h,p,r,k,$,E,N,_]);const I=w.useRef(i);w.useEffect(()=>{if(!s||!r||I.current===i)return;E(!1),k(),N(),m.forEach(({id:M,source:D})=>{s.getSource(M)||s.addSource(M,D)}),h.forEach(M=>{s.getLayer(M.id)||(M.beneath&&s.getLayer(M.beneath)?s.addLayer(M,M.beneath):s.addLayer(M))}),I.current=i,setTimeout(()=>{$(),_()},_m)},[s,m,h,r,k,$,N,_,i,E]),w.useEffect(()=>{if(!s||!r||!f)return;const{layers:O,callback:M=ti}=f;function D(F,{point:B,features:V,lngLat:G}){M.call(n,F,V,G,B)}const P=O.map(F=>{const B=D.bind(null,F);return F==="maplibreMap"?(s.on("click",B),{action:"click",callback:B,layerId:F}):(s.on("click",F,B),{action:"click",callback:B,layerId:F})});return()=>{!s||!s.loaded()||P.forEach(({action:F,callback:B,layerId:V})=>{V==="maplibreMap"?s.off(F,B):s.off(F,V,B)})}},[s,n,f,r]),w.useEffect(()=>{if(!s||!r||!g)return;const{layers:O=[],callback:M=ti,Component:D=ET,property:P=null,filterFunc:F=null,isPinnable:B=!1,zIndex:V=-1}=g,G=new Map;function Z(W,{point:Y,features:U,lngLat:q}){const te=G.get(W)||new Map;G.set(W,new Map);const K=ae=>{ae.forEach(({id:de,source:ue,sourceLayer:fe})=>{if(de!=null)if(te.has(de))G.get(W).set(de,te.get(de)),te.delete(de);else{const ve={id:de,source:ue,sourceLayer:fe};G.get(W).set(de,ve),s.setFeatureState(ve,{hover:!0})}})},ne=new Map;if(P){const ae=U.reduce((de,ue)=>{const fe=C(ue,["properties",P],null);return fe&&(de[fe]=!0),de},{});s.queryRenderedFeatures({layers:[W],filter:["in",["get",P],["literal",Object.keys(ae)]]}).forEach(de=>{de.id&&ne.set(de.id,de)})}if(F){const ae=F.call(n,W,U,q,Y);kn(ae)&&s.queryRenderedFeatures({layers:[W],filter:ae}).forEach(de=>{de.id&&ne.set(de.id,de)})}U.forEach(ae=>{ae.id&&ne.set(ae.id,ae)}),K([...ne.values()]),te.forEach(ae=>{s.setFeatureState(ae,{hover:!1})});const J=M(W,U,q,Y);kn(J)&&l({type:"hover-layer-move",lngLat:q,Component:D,layer:n,layerId:W,isPinnable:B,zIndex:V,data:J})}const X=(W,Y)=>{G.has(Y)&&(G.get(Y).forEach(U=>{W.setFeatureState(U,{hover:!1})}),G.delete(Y))};function H(W,Y){X(s,W),l({type:"hover-layer-leave",layerId:W})}const z=O.reduce((W,Y)=>{let U=Z.bind(n,Y);return W.push({action:"mousemove",callback:U,layerId:Y}),s.on("mousemove",Y,U),U=H.bind(n,Y),W.push({action:"mouseleave",callback:U,layerId:Y}),s.on("mouseleave",Y,U),W},[]);return()=>{!s||!s.loaded()||(z.forEach(({action:W,callback:Y,layerId:U})=>{s.off(W,U,Y)}),G.forEach(W=>{W.forEach(Y=>{s.setFeatureState(Y,{hover:!1})})}))}},[s,n,g,r,l]),w.useEffect(()=>{if(!s||!r||!x)return;const{callback:O=ti,className:M="bg-black bg-opacity-25 border-2 border-black rounded",layers:D,filter:P}=x;let F=[],B,V,G;const Z=document.getElementById(u),X=document.getElementById(`${u}-box-select-blocker`),H=q=>{const te=Z.getBoundingClientRect();return new cs.Point(q.clientX-te.left-Z.clientLeft,q.clientY-te.top-Z.clientTop)},z=q=>{if(document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",Y),s.dragPan.enable(),X.classList.add("pointer-events-none"),X.classList.remove("pointer-events-auto"),G&&(G.remove(),G=null),q){F.forEach(ne=>{s.setFeatureState(ne,{select:!1})});const te=s.queryRenderedFeatures(q,{layers:D,filter:P}),K=new Set;F=te.reduce((ne,J)=>{if(!K.has(J.id)){K.add(J.id);const ae={id:J.id,source:J.source,sourceLayer:J.sourceLayer,properties:J.properties};ne.push(ae),s.setFeatureState(ae,{select:!0})}return ne},[]),O(F)}},W=q=>{q.preventDefault(),V=H(q),G||(G=document.createElement("div"),G.className="absolute top-0 left-0 w-0 h-0 "+M,Z.appendChild(G));var te=Math.min(B.x,V.x),K=Math.max(B.x,V.x),ne=Math.min(B.y,V.y),J=Math.max(B.y,V.y);G.style.transform=`translate( ${te}px, ${ne}px)`,G.style.width=`${K-te}px`,G.style.height=`${J-ne}px`},Y=q=>{z([B,H(q)])},U=q=>{q.shiftKey&&q.button===0&&(document.addEventListener("mousemove",W),document.addEventListener("mouseup",Y),s.dragPan.disable(),X.classList.remove("pointer-events-none"),X.classList.add("pointer-events-auto"),B=H(q))};return Z.addEventListener("mousedown",U,!0),s.boxZoom.disable(),()=>{Z.removeEventListener("mousedown",U),!(!s||!s.loaded())&&s.boxZoom.enable()}},[s,h,n,x,r,u]),w.useEffect(()=>{if(!s||d)return;const O=m.reduce((P,F)=>P&&!!s.getSource(F.id),!0),M=h.reduce((P,F)=>P&&!!s.getLayer(F.id),!0);E(!L&&O&&M)},[s,n.id,m,h,E,L,d]);const[T,A]=w.useState({}),R=w.useCallback((O,M)=>{A(typeof O=="object"?D=>({...D,...O}):D=>{const P={...D,[O]:M};return Fe(D,P)?D:P})},[]);return w.useEffect(()=>{const O=h.reduce((M,D)=>(M[D.id]=C(D,["layout","visibility"],"visible"),M),{});A(O)},[h]),w.useEffect(()=>{s&&d&&h.forEach(({id:O})=>{a&&T[O]!=="none"?s.setLayoutProperty(O,"visibility","visible"):s.setLayoutProperty(O,"visibility","none")})},[s,h,a,d,T]),e.jsx(y,{...t,setLayerVisibility:R,updateLayerState:j,startLayerLoading:N,stopLayerLoading:_})};let LT=-1;const IT=()=>`avl-layer-${++LT}`,TT={sources:[],layers:[],toolbar:["toggle-visibility"],startActive:!0,startVisible:!0,startState:{},filters:{},modals:{},mapActions:[],loadingIndicator:{},isDynamic:!1};class dd{constructor(s={}){ye(this,"RenderComponent",$T);const n={...TT,...s};for(const r in n)this[r]=n[r];this.id=this.id||IT(),this._initialized=!1}onFilterChange(s,n,r){}}const MT=({children:t})=>e.jsx("div",{className:"grid grid-cols-1 gap-1",children:t}),BT=({children:t})=>{const s=Ve();return e.jsx("div",{className:(s==null?void 0:s.LayerSidebarPanelContainer)!=="LayerSidebarPanelContainer"?s.LayerSidebarPanelContainer:`w-80 h-full max-h-full p-1 ${s.bg} rounded-b pointer-events-auto overflow-auto scrollbar-sm`,children:t})},AT=({open:t,children:s})=>{const n=Ve();return e.jsx("div",{className:`
        w-full h-full relative ${t?"p-0":"pr-8"}
      `,style:{transition:"padding 150ms"},children:e.jsx("div",{className:(n==null?void 0:n.LayerSidebarContainer)!=="LayerSidebarContainer"?n.LayerSidebarContainer:"w-full h-full max-h-full relative",children:s})})},OT=({toggle:t,open:s})=>{const n=Ve();return e.jsx("div",{className:"pointer-events-auto",children:e.jsx("div",{onClick:t,className:(n==null?void 0:n.LayerSidebarToggle)!="LayerSidebarToggle"?n.LayerSidebarToggle:`
          h-8 w-8 ${n.bg} text-2xl
          flex items-center justify-center
          cursor-pointer ${s?"rounded-t":"rounded"}
          pointer-events-auto absolute
          ${n.textHighlightHover}
        `,style:{right:s?"0rem":"-2rem",transition:"right 150ms"},children:e.jsx("span",{className:`fa fa-caret-${s?"left":"right"}`})})})},PT=({icon:t,active:s,setTabIndex:n,index:r})=>{const a=w.useCallback(i=>{n(r)},[n,r]),l=Ve();return e.jsx("div",{onClick:a,className:s?(l==null?void 0:l.LayerSidebarTabActive)!="LayerSidebarTabActive"?l==null?void 0:l.LayerSidebarTabActive:` h-8 w-10 rounded-t mr-1 cursor-pointer pointer-events-auto relative ${l.bg} ${l.textHighlight}`:(l==null?void 0:l.LayerSidebarTab)!="LayerSidebarTab"?l==null?void 0:l.LayerSidebarTab:` h-8 w-10 rounded-t mr-1 cursor-pointer pointer-events-auto relative ${l.bgAccent1} ${l.textHighlight}`,children:s?e.jsx("div",{className:"absolute inset-0 flex justify-center items-center",children:e.jsx("span",{className:`${t} `})}):e.jsxs("div",{className:"absolute inset-0 flex justify-center items-center",children:[e.jsx("span",{className:`${t} `}),e.jsx("span",{className:`
            absolute inset-0 flex justify-center items-center
            opacity:100 hover:opacity-25 ${l.text} ${t}
          `})]})})},DT=({children:t})=>{const s=Ve();return e.jsx("div",{className:`border ${s.border} rounded`,children:t})},RT=({children:t,...s})=>{const n=Ve();return e.jsx("span",{className:`${n.bgAccent3Hover} relative px-2 py-1 rounded cursor-pointer`,...s,children:t})},FT=({toggleOpen:t,open:s,children:n})=>{const r=Ve();return e.jsx("div",{onClick:t,className:`
        p-1 w-full rounded-t ${s?"border-b":"rounded-b"}
        ${r.border} ${r.bgAccent2} cursor-pointer
      `,children:n})},VT=({name:t="Unnamed Filter",lastFilter:s,children:n})=>e.jsxs("div",{className:"flex-1 p-1",children:[e.jsx("div",{children:t}),e.jsx("div",{children:n})]}),HT=({mapStyle:t,isActive:s})=>{const n=Ve();return e.jsx("div",{className:`
        flex items-center p-1 border ${n.border} rounded ${n.bgAccent2}
        ${s?`border-r-8 ${n.borderHighlight}`:`cursor-pointer ${n.bgAccent3Hover}`}
      `,children:e.jsx("div",{className:"ml-1 flex-1 h-full flex items-center",children:t.name})})},zT=({open:t,toggleOpen:s,children:n})=>{const r=Ve();return e.jsxs("div",{onClick:s,className:`
        p-1 font-bold flex rounded-t cursor-pointer
        ${r.bgAccent1} ${r.bgAccent2Hover}
        ${t?`border-b ${r.border}`:"rounded-b"}
      `,children:[e.jsx("div",{className:"flex-1",children:n}),e.jsx("div",{children:e.jsx("span",{className:"px-2 py-1",children:e.jsx("span",{className:`fa fa-${t?"minus":"plus"}`})})})]})},UT=({children:t})=>e.jsx("div",{className:"p-1",children:t}),WT=({children:t})=>{const s=Ve();return e.jsx("div",{className:`rounded border ${s.border}`,children:t})},GT=({name:t,title:s,children:n})=>{const r=Ve();return e.jsx("div",{className:`p-1 sticky top-0 ${r.bg}`,children:e.jsxs("div",{className:`
          p-1 relative border rounded pointer-events-auto
          ${r.bgLegend} ${r.bgLegendHover} ${r.border}
        `,children:[e.jsx("div",{children:t||s}),e.jsx("div",{children:n})]})})},JT=({open:t,children:s})=>{const n=Ve();return e.jsx("div",{className:"relative h-full",children:e.jsx("div",{className:`
          w-96 ${n.bg} rounded pointer-events-auto
          max-h-full scrollbar-sm overflow-auto
        `,children:s})})},qT=({layer:t})=>{const s=Ve(),{icon:n="fa-solid fa-spinner",color:r=s.textHighlight}=t.loadingIndicator;return e.jsxs("div",{className:`w-fit flex items-center rounded-l ${s.bg} p-2`,style:{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem",minWidth:"16rem"},children:[e.jsx("div",{className:"flex-1 font-bold mr-4",children:t.name}),e.jsx("div",{className:"flex items-center",style:{fontSize:"2rem"},children:e.jsx("span",{className:`${n} ${r} fa-spin`})})]})},KT=({children:t})=>{const s=Ve();return e.jsx("div",{className:`p-1 rounded ${s.bg} w-fit`,children:e.jsx("div",{className:`border ${s.border} rounded whitespace-nowrap`,children:t})})},YT=({children:t,closeModal:s,dragHandle:n,bringModalToFront:r})=>{const a=Ve();return e.jsxs("div",{id:n,onClick:r,className:`
        p-1 font-bold ${a.bgAccent2} rounded-t flex
        border-b ${a.border} cursor-grabbing
      `,children:[e.jsx("div",{className:"flex-1",children:t}),e.jsx("div",{children:e.jsx("span",{onClick:s,className:"px-2 py-1 hover:bg-gray-400 rounded cursor-pointer",children:e.jsx("span",{className:"fa fa-close"})})})]})},ZT=({children:t})=>e.jsx("div",{className:"p-1",children:t}),XT={HoverComponentContainer:MT,LoadingIndicator:qT,LayerSidebarContainer:AT,LayerSidebarToggle:OT,LayerSidebarTab:PT,LayerSidebarPanelContainer:BT,LayerPanelContainer:DT,LayerPanelHeaderButton:RT,LayerPanelHeaderContainer:FT,LayerPanelFilterContainer:VT,MapStylePanel:HT,ModalContainer:KT,ModalHeaderContainer:YT,ModalContentContainer:ZT,InfoBoxContainer:WT,InfoBoxHeaderContainer:zT,LegendContainer:GT,InfoBoxSidebarContainer:JT,InfoBoxContentContainer:UT},QT=w.createContext(XT),hs=()=>w.useContext(QT),eM=({destroyDynamicLayer:t})=>{const[s,n]=w.useState(0),r=w.useRef();w.useEffect(()=>{s>0&&(r.current=setTimeout(n,1e3,s-1))},[s]);const a=w.useCallback(i=>{i.stopPropagation(),s===0?n(3):(n(0),clearTimeout(r.current),t())},[t,s]),{LayerPanelHeaderButton:l}=hs();return e.jsxs(l,{onClick:a,children:[s?e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-white font-bold",children:s}):null,e.jsx("span",{className:"fa fa-trash text-red-500"})]})},tM=({layer:t,MapActions:s,children:n})=>{const r=w.useCallback(i=>{i.stopPropagation(),s.deactivateLayer(t.id)},[s.deactivateLayer,t.id]),a=w.useCallback(i=>{s.destroyDynamicLayer(t.id)},[s.destroyDynamicLayer,t.id]),{LayerPanelHeaderButton:l}=hs();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-1 font-bold",children:t.name||"AVL Layer"}),e.jsxs("div",{className:"flex-0",children:[t.isDynamic?e.jsx(eM,{destroyDynamicLayer:a}):null,e.jsx(l,{onClick:r,children:e.jsx("span",{className:"fa fa-close"})})]})]}),e.jsx("div",{className:"flex",children:e.jsx("div",{className:"flex-0 flex",children:n})})]})},si=t=>({MapActions:s,layer:n,id:r,...a})=>{const l=w.useCallback(i=>{s.updateFilter(n,r,i)},[s.updateFilter,n,r]);return e.jsx(t,{...a,layer:n,id:r,MapActions:s,onChange:l})},sM=({type:t})=>{const s=Ve();return e.jsxs("div",{className:`px-2 py-1 rounded outline outline-1 ${s.outline}`,children:['Unknown filter type: "',t,'"']})},nM=({layer:t,MapActions:s,filterUpdate:n,...r})=>{const[a,l]=w.useState(!1),i=w.useCallback(g=>{g.stopPropagation(),l(x=>!x)},[]);w.useEffect(()=>{Object.keys(t.filters).forEach(g=>{const{type:x,wrapper:y,Component:j}=t.filters[g];switch(x){case"select":{y?t.filters[g].Filter=si(y(Dn)):t.filters[g].Filter=si(Dn);break}default:j?t.filters[g].Filter=si(j):t.filters[g].Filter=sM}})},[t]);const[c,d]=w.useState([]),u=w.useCallback(()=>{d(Object.keys(t.filters).reduce((g,x)=>{const{Filter:y,isActive:j=!0,...N}=t.filters[x];return y&&j&&g.push({Filter:y,id:x,...N}),g},[]))},[t.filters]);w.useEffect(()=>{u()},[u]),w.useEffect(()=>{if(n){const{filterId:g,prevValue:x,value:y}=n;for(const j in t.filters)j===g&&(t.filters[g].prevValue=x,t.filters[g].value=y);typeof t.onFilterChange=="function"&&t.onFilterChange.call(t,g,y,x),u()}},[t,u,n]);const{LayerPanelContainer:p,LayerPanelHeaderContainer:m,LayerPanelFilterContainer:h}=hs(),f=!!(a&&c.length);return e.jsxs(p,{children:[e.jsx(m,{toggleOpen:i,open:f,children:e.jsx(tM,{layer:t,...r,MapActions:s,open:f,children:C(t,"toolbar",[]).map((g,x)=>e.jsx("div",{className:"",children:e.jsx(oM,{...r,MapActions:s,layer:t,tool:g})},x))})}),e.jsx("div",{className:`${f?"block":"h-0 overflow-hidden invisible"}`,children:c.map(({Filter:g,id:x,name:y,...j},N)=>e.jsx(h,{name:y,lastFilter:N===c.length-1,children:e.jsx(g,{...j,...r,id:x,layer:t,MapActions:s})},x))})]})},aM=t=>{const{activeLayers:s,inactiveLayers:n,MapActions:r,filterUpdate:a,mapName:l,...i}=t,c=Ve();return e.jsxs(e.Fragment,{children:[l?e.jsx("div",{className:`mb-1 font-bold text-lg text-center ${c.bg} sticky top-0`,children:l}):null,n.length?e.jsx(Dn,{isDropdown:!0,options:n,onChange:r.activateLayer,displayAccessor:d=>d.name,valueAccessor:d=>d.id,children:e.jsx("div",{className:`border ${c.border} rounded px-2 py-1 mb-1`,children:"Select a layer..."})}):null,e.jsx("div",{className:"grid grid-cols-1 gap-1",children:s.map(d=>e.jsx(nM,{layer:d,...i,MapActions:r,filterUpdate:a.layerId===d.id?a:null},d.id))})]})},rM=t=>{if(typeof t!="string")return t;switch(t){case"toggle-visibility":return{tooltip:"Toogle Visibility",Icon:({isVisible:s})=>e.jsx("span",{className:`fa fa-eye${s?"":"-slash"}`}),action:({toggleLayerVisibility:s},n)=>s(n.id)};default:return{tooltip:`Unknown Tool "${t}"`,Icon:"fa fa-frown",action:null}}},oM=({tool:t,MapActions:s,layer:n,layerVisibility:r,...a})=>{const l=w.useMemo(()=>rM(t),[t]),i=w.useMemo(()=>typeof l.Icon=="function"?l.Icon:()=>e.jsx("span",{className:l.Icon}),[l]),c=w.useCallback(u=>{u.stopPropagation(),typeof l.action=="function"&&l.action(s,n)},[l,s,n]),{LayerPanelHeaderButton:d}=hs();return e.jsx(d,{onClick:c,children:e.jsx(i,{layer:n,isVisible:C(r,n.id)})})},lM=({legend:t,MapActions:s})=>{const n=w.useCallback(u=>{s.updateLegend({...t,type:u})},[s.updateLegend,t]),r=w.useCallback(u=>{s.updateLegend({...t,range:u})},[s.updateLegend,t]),[a,l]=w.useState(-1),i=Ve(),[c,d]=w.useState(!1);return e.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[e.jsx("div",{className:"font-bold text-lg text-center",children:"Legend Controls"}),e.jsxs("div",{className:`rounded ${i.bgAccent2} border ${i.border}`,children:[e.jsxs("div",{className:`border-b ${i.border}`,children:[e.jsx("div",{className:"px-2 py-1",children:"Current:"}),e.jsx("div",{className:"px-2 pb-2",children:e.jsx(Sr,{height:3,colors:t.range})})]}),e.jsxs("div",{className:"p-1 flex items-center",children:[e.jsx("div",{className:"w-32 text-right",children:"Type:"}),e.jsx("div",{className:"flex-1 ml-1",children:e.jsx(cM,{type:t.type,updateLegend:n})})]}),e.jsxs("div",{className:"p-1 flex items-center",children:[e.jsx("div",{className:"w-32 text-right",children:"Reverse Colors:"}),e.jsx("div",{className:"flex-1 ml-1",children:e.jsx(ST,{value:c,onChange:d})})]})]}),Object.keys(Ro).map((u,p)=>e.jsx(uM,{type:u,startSize:t.range.length,colors:Ro[u],updateLegend:r,isOpen:a===p,setOpen:l,index:p,current:t.range,reverseColors:c},u))]})},iM=[{value:"quantize",name:"Quantize"},{value:"quantile",name:"Quantile"},{value:"threshold",name:"Threshold"},{value:"ordinal",name:"Ordinal"}],cM=({type:t,updateLegend:s})=>{const n=w.useCallback(r=>{s(r)},[s]);return e.jsx(Dn,{removable:!1,options:iM,displayAccessor:r=>r.name,valueAccessor:r=>r.value,onChange:n,value:t})};ws(3,13);const dM=({size:t,sizes:s,setSize:n})=>{const r=Ve();return e.jsxs("div",{className:`flex items-center p-1 rounded border ${r.border}`,children:[e.jsx("div",{className:"flex-0 mr-1",children:"Size:"}),e.jsx("div",{className:"flex-1",children:e.jsx(Dn,{removable:!1,options:s,onChange:n,value:t})})]})},uM=t=>{const{type:s,colors:n,startSize:r,updateLegend:a,isOpen:l,setOpen:i,index:c,current:d,reverseColors:u=!1}=t,[p,m]=w.useState(r),h=w.useCallback(()=>{i(y=>y===c?-1:c)},[c]),f=w.useMemo(()=>Object.keys(n).reduce((y,j)=>{const N=C(n,[j,p],null);return N&&y.push({name:j,colors:u?[...N].reverse():N}),y},[]),[n,p,u]),g=w.useMemo(()=>{const y=new Set;return Object.keys(n).forEach(j=>{Object.keys(n[j]).forEach(N=>y.add(+N))}),[...y]},[n]);w.useEffect(()=>{g.includes(r)&&m(r)},[r,g]);const x=Ve();return e.jsxs("div",{className:`rounded ${x.bgAccent2} border ${x.border}`,children:[e.jsxs("div",{onClick:h,className:`
          flex items-center ${x.border} cursor-pointer px-1
          ${l?"border-b":""}
        `,children:[e.jsx("span",{className:"flex-1",children:iT(s)}),e.jsx("span",{className:"px-2 py-1 flex-0",children:e.jsx("span",{className:`fa fa-${l?"minus":"plus"}`})})]}),l?e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-2",children:[e.jsx(dM,{size:p,sizes:g,setSize:m}),f.map(({name:y,colors:j},N)=>e.jsx(mM,{name:y,colors:j,select:a,isActive:Fe(d,j),reverseColors:u},N))]}):null]})},mM=({colors:t,name:s,select:n,isActive:r,reverseColors:a})=>{const l=w.useCallback(()=>{n(t,s,a)},[n,t,s,a]);return e.jsx("div",{onClick:l,className:`
        cursor-pointer rounded outline outline-2 overflow-hidden
        ${r?"outline-current":"outline-transparent"}
      `,children:e.jsx(Sr,{colors:t,height:3})})},pM=({styleIndex:t,setMapStyle:s,isActive:n,children:r})=>{const a=w.useCallback(l=>{s(t)},[t,s]);return e.jsx("div",{onClick:n?null:a,children:r})},hM=({mapStyles:t,styleIndex:s,MapActions:n})=>{const{MapStylePanel:r}=hs();return e.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[e.jsx("div",{className:"font-bold text-lg text-center",children:"Map Style Selector"}),t.map((a,l)=>e.jsx(pM,{styleIndex:l,setMapStyle:n.setMapStyle,isActive:l===s,children:e.jsx(r,{mapStyle:a,isActive:l===s})},l))]})},Sm={LayersPanel:{icon:"fa-solid fa-layer-group",Panel:aM},StylesPanel:{icon:"fa-solid fa-palette",Panel:hM},LegendPanel:{icon:"fa-sharp fa-solid fa-chart-simple",Panel:lM}},fM=({startOpen:t=!0,Panels:s=[],...n})=>{const[r,a]=w.useState(null),[l,i]=w.useState("fit-content");w.useEffect(()=>{if(!r)return;const{width:j}=r.getBoundingClientRect();i(`${j}px`)},[r]);const[c,d]=w.useState(t),u=w.useCallback(()=>{d(j=>!j)},[]),[p,m]=w.useState(0),h=w.useMemo(()=>s.reduce((j,N)=>(typeof N=="string"&&N in Sm?j.push(Sm[N]):typeof N.Panel=="function"&&typeof N.icon=="string"&&j.push(N),j),[]),[s]),{LayerSidebarContainer:f,LayerSidebarPanelContainer:g,LayerSidebarTab:x,LayerSidebarToggle:y}=hs();return e.jsx("div",{className:"h-full w-full relative",children:e.jsx("div",{className:"h-full w-full relative",children:e.jsxs(f,{open:c,children:[e.jsxs("div",{className:"flex relative",children:[e.jsx("div",{className:`flex flex-1 ${c?"overflow-visible":"overflow-hidden"}`,style:{width:c?l:"0px",transition:"width 150ms",animation:c?"open 150ms":null},children:h.map(({icon:j},N)=>e.jsx(x,{icon:j,active:p===N,setTabIndex:m,index:N},N))}),e.jsx(y,{open:c,toggle:u})]}),e.jsx("div",{className:`
              absolute top-8 bottom-0
              ${c?"overflow-visible":"overflow-hidden"}
            `,style:{width:c?l:"0px",transition:"width 150ms",animation:c?"open 150ms":null},children:e.jsx("div",{ref:a,className:"w-fit h-full",children:e.jsx(g,{children:h.map(({Panel:j},N)=>e.jsx("div",{className:p===N?"block h-full":"h-0 overflow-hidden invisible",children:e.jsx(j,{...n},N)},N))})})})]})})})},gM=({Component:t,Header:s,startOpen:n=!0,...r})=>{const[a,l]=w.useState(n),i=w.useCallback(()=>{l(p=>!p)},[]),{InfoBoxContainer:c,InfoBoxHeaderContainer:d,InfoBoxContentContainer:u}=hs();return e.jsxs(c,{...r,children:[s?e.jsx(d,{open:a,toggleOpen:i,children:typeof s=="function"?e.jsx(s,{...r}):s}):null,e.jsx("div",{className:a?"block":"h-0 overflow-hidden invisible",children:e.jsx(u,{children:e.jsx(t,{...r})})})]})},xM=t=>{const{activeLayers:s,legend:n,...r}=t,a=w.useMemo(()=>s.reduce((d,u)=>(C(u,["infoBoxes","length"],0)&&d.push(u),d),[]),[s]),{InfoBoxSidebarContainer:l,LegendContainer:i}=hs(),c=w.useCallback(({isActive:d=!0},u)=>typeof d=="function"?d({...t,layer:u}):!!d,[t]);return e.jsxs(l,{children:[n.isActive?e.jsx(i,{...n,children:e.jsx(CT,{...n})}):null,a.length?e.jsx("div",{className:`${n.isActive?"px-1 pb-1":"p-1"} grid grid-cols-1 gap-1`,children:a.reduce((d,u)=>(d.push(...u.infoBoxes.filter(p=>c(p,u)).map((p,m)=>e.jsx(gM,{...r,...p,legend:n,layer:u},`${u.id}-${m}`))),d),[])}):null]})},rb=(t,s,n)=>{const{x:l,y:i}=t,c=n,d=`max(
      10px,
      min(calc(${i}px - 50%), calc(${c-10}px - 100%))
    )`;return l<s*.5?`translate(
      ${l+30}px,
      ${d}
    )`:`translate(
    calc(-100% + ${l-30}px),
    ${d}
  )`},bM=({x:t,y:s},n,r)=>r==="left"?`translate(calc(${t}px - 175%), max(50%, min(calc(${n}px - 150%), calc(${s}px - 50%)))) rotate(45deg) skew(-15deg, -15deg)`:`translate(calc(${t}px + 75%), max(50%, min(calc(${n}px - 150%), calc(${s}px - 50%)))) rotate(45deg) skew(-15deg, -15deg)`,yM=({orientation:t,onClick:s,children:n})=>{const r=Ve();return e.jsx("div",{onClick:s,style:{zIndex:1,transform:t==="left"?"translate(-0.75rem, -0.75rem)":"translate(0.75rem, -0.75rem)"},className:`
        rounded absolute inline-block top-0
        ${r.bg} ${r.textHighlightHover} cursor-pointer
        ${t==="left"?"left-0":"right-0"}
      `,children:e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx("span",{className:"fa fa-close"})})})},vM=({children:t,remove:s,id:n,lngLat:r,project:a,width:l,height:i})=>{const c=a(r),d=w.useMemo(()=>c.x<l*.5?"right":"left",[c,l]),u=w.useMemo(()=>({transform:bM(c,i,d)}),[c,d]),p=w.useCallback(f=>{s(n)},[s,n]),m=Ve(),{HoverComponentContainer:h}=hs();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`
          absolute top-0 left-0 z-20
          pointer-events-auto
        `,style:{transform:rb(c,l,i)},children:[e.jsx(h,{children:t}),e.jsx(yM,{orientation:d,onClick:p})]}),e.jsx("div",{style:u,className:`
          absolute w-6 h-6 rounded-bl rounded-tr ${m.bg} top-0 left-0 z-10
        `})]})},jM=({children:t,lngLat:s,project:n,width:r,height:a})=>{const{HoverComponentContainer:l}=hs();return e.jsx("div",{className:`
        absolute top-0 left-0 z-20
        pointer-events-none
      `,style:{transform:rb(n(s),r,a),transition:"transform 0.05s ease-out"},children:e.jsx(l,{children:t})})},wM=t=>({topLeft:C(t,"startPos",[500,500]),dragPos:[0,0],dragging:!1}),NM=(t,s)=>{const{type:n,...r}=s;switch(n){case"drag-start":return{...t,dragPos:[...r.pos],dragging:!0};case"drag-move":{const{topLeft:[a,l],dragPos:[i,c]}=t,{pos:[d,u]}=r;return{...t,dragPos:[d,u],topLeft:[a+(d-i),l+(u-c)]}}case"drag-stop":return{...t,topLeft:[...r.pos],dragging:!1};default:return t}},CM=({padding:t="1rem",dragHandle:s=null,children:n,...r})=>{const[a,l]=w.useReducer(NM,r,wM),i=w.useCallback(m=>{m.stopPropagation(),m.preventDefault(),l({type:"drag-move",pos:[m.clientX,m.clientY]})},[]);w.useEffect(()=>()=>{window.removeEventListener("mousemove",i)},[i]);const[c,d]=w.useState(null),u=w.useMemo(()=>c?typeof s=="string"&&document.getElementById(s)||c:null,[s,c]),p=w.useCallback(m=>{if(!c)return;const h=f=>{window.removeEventListener("mousemove",i);const g=c.getBoundingClientRect(c);l({type:"drag-stop",pos:[g.x,g.y]})};window.addEventListener("mousemove",i),window.addEventListener("mouseup",h,{once:!0}),l({type:"drag-start",pos:[m.clientX,m.clientY]})},[i,c]);return w.useEffect(()=>{if(u)return u.addEventListener("mousedown",p),()=>{u.removeEventListener("mousedown",p)}},[p,u]),w.useEffect(()=>{u&&(a.dragging?(u.classList.remove("cursor-grab"),u.classList.add("cursor-grabbing")):(u.classList.add("cursor-grab"),u.classList.remove("cursor-grabbing")))},[u,a.dragging]),e.jsx("div",{className:`
        fixed inset-0 z-50
        ${a.dragging?"pointer-events-auto":"pointer-events-none"}
      `,children:e.jsx("div",{ref:d,className:`
          fixed inline-block left-0 top-0 z-10 pointer-events-auto
        `,style:{transform:`
            translate(
              MIN(CALC(${window.innerWidth}px - 100% - ${t}), MAX(${t}, ${a.topLeft[0]}px)),
              MIN(CALC(${window.innerHeight}px - 100% - ${t}), MAX(${t}, ${a.topLeft[1]}px))
            )
          `},children:n})})},_M=t=>{const{Header:s=null,startPos:n,MapActions:r,layerId:a,modalId:l,children:i,...c}=t,d=w.useMemo(()=>`modal-drag-handle-${a}-${l}`,[a,l]),u=w.useCallback(()=>{r.closeModal(a,l)},[a,l,r.closeModal]),p=w.useCallback(()=>{r.bringModalToFront(a,l)},[a,l,r.bringModalToFront]),{ModalContainer:m,ModalHeaderContainer:h,ModalContentContainer:f}=hs();return e.jsx(CM,{startPos:n,dragHandle:d,children:e.jsxs(m,{children:[e.jsx(h,{closeModal:u,bringModalToFront:p,dragHandle:d,children:typeof s=="function"?e.jsx(s,{...c,closeModal:u,bringModalToFront:p,MapActions:r,dragHandle:d}):s}),e.jsx(f,{children:i})]})})};let SM=0;const ob=()=>`avl-thing-${++SM}`,$M=[],Da={},lb="pin_outline",EM=[{name:"Dark",style:"https://api.maptiler.com/maps/dataviz-dark/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Light",style:"https://api.maptiler.com/maps/dataviz-light/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Streets",style:"https://api.maptiler.com/maps/streets-v2/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Satellite Streets",style:"https://api.maptiler.com/maps/hybrid/style.json?key=mU28JQ6HchrQdneiq6k9"}],kM={center:[-74.180647,42.58],minZoom:2,zoom:10,preserveDrawingBuffer:!0,styles:EM,attributionControl:!1,navigationControl:!1,protocols:[]},LM={Component:fM,startOpen:!0,Panels:["LayersPanel","StylesPanel","LegendPanel"]},IM={Component:xM},ud=({children:t,onClick:s})=>{const n=Ve();return e.jsx("div",{onClick:s,className:`
        rounded ${n.bg} h-10 w-10
        flex items-center justify-center
        cursor-pointer pointer-events-auto text-2xl
        ${n.textHighlightHover}
      `,children:t})},ib=({action:t,icon:s,MapActions:n})=>{const r=w.useCallback(()=>{typeof t=="function"&&t(n)},[t,n]);return e.jsx(ud,{onClick:r,children:e.jsx("span",{className:s})})},TM=({MapActions:t,maplibreMap:s})=>{const[n,r]=w.useState(0);w.useEffect(()=>{s&&r(s.getBearing())},[s]),w.useEffect(()=>{if(!s)return;const i=c=>{r(s.getBearing())};return s.on("rotate",i),()=>{s.off("rotate",i)}},[s]);const a=w.useCallback(i=>{t.resetView()},[t.resetView]),l=Ve();return e.jsx(ud,{onClick:a,children:e.jsx("span",{className:`
          fa-solid fa-arrow-up w-10 py-1 flex justify-center
          ${l.textHighlightHover}
        `,style:{transform:`rotate(${n}deg)`}})})},MM=({MapActions:t,maplibreMap:s})=>{const[n,r]=w.useState(0);w.useEffect(()=>{s&&r(s.getBearing())},[s]),w.useEffect(()=>{if(!s)return;const d=u=>{r(s.getBearing())};return s.on("rotate",d),()=>{s.off("rotate",d)}},[s]);const a=w.useCallback(d=>{if(!s)return;const u=s.getZoom();s.zoomTo(u*1.1)},[s]),l=w.useCallback(d=>{t.resetView()},[t.resetView]),i=w.useCallback(d=>{if(!s)return;const u=s.getZoom();s.zoomTo(u/1.1)},[s]),c=Ve();return e.jsxs("div",{className:`
        flex flex-row cursor-pointer pointer-events-auto
      `,children:[e.jsx("div",{onClick:i,children:e.jsx("span",{className:`
            fal fa-minus w-10 py-1 flex justify-center
            ${c.textHighlightHover}
          `})}),e.jsx("div",{onClick:a,children:e.jsx("span",{className:`
            fal fa-plus w-10 py-1 flex justify-center
            ${c.textHighlightHover}
          `})}),e.jsx("div",{onClick:l,className:`
          w-10 py-1
          flex justify-center
          ${c.textHighlightHover}
        `,children:e.jsx("span",{className:"fa fa-location-arrow faw",style:{transform:`rotate(${n-45}deg)`}})})]})},BM=({action:t,icon:s,layer:n,MapActions:r})=>{const a=w.useCallback(()=>{typeof t=="function"&&t(n,r)},[t,n,r]);return e.jsx(ud,{onClick:a,children:e.jsx("span",{className:s})})},$m={"reset-view":{Component:TM},"go-home":{Component:ib,icon:"fa-solid fa-house",action:({goHome:t})=>{t()}},"navigation-controls":{Component:MM}},cb={maplibreMap:null,moving:!1,mapStyles:[],styleIndex:0,layerVisibility:{},layerState:{},dynamicLayers:[],activeLayers:{},resourcesLoaded:{},hoverData:{data:[],lngLat:{lng:0,lat:0},hovering:!1},pinnedHoverComps:[],pinnedHoverCompIds:[],filterUpdate:{layerId:null},layersLoading:{},legend:{type:"quantize",domain:[0,1],range:["red","yellow","green"],format:",.2f",name:"Unnamed Legend",isActive:!1},openedModals:[],Protocols:{},initializedLayers:[]},AM=(t,s)=>{var a,l,i,c,d;const{type:n,...r}=s;switch(n){case"toggle-layer-visibility":return{...t,layerVisibility:{...t.layerVisibility,[r.layerId]:!t.layerVisibility[r.layerId]}};case"update-layer-state":{const{layerId:p,layerState:m}=r,h=C(t,["layerState",p],{});return typeof m=="function"?{...t,layerState:{...t.layerState,[p]:{...h,...m(h)}}}:{...t,layerState:{...t.layerState,[p]:{...h,...m}}}}case"create-dynamic-layer":{const{layer:p}=r;return t.dynamicLayers.reduce((h,f)=>h||f.id===p.id,!1)?t:(p.isDynamic=!0,{...t,dynamicLayers:[...t.dynamicLayers,p]})}case"destroy-dynamic-layer":return{...t,dynamicLayers:t.dynamicLayers.filter(p=>p.id!==r.layerId)};case"open-modal":{const{layerId:p,modalId:m}=r,h=t.openedModals.filter(f=>!(f.layerId===p&&f.modalId===m));return{...t,openedModals:[...h,{layerId:p,modalId:m}]}}case"close-modal":{const{layerId:p,modalId:m}=r,h=t.openedModals.filter(f=>!(f.layerId===p&&f.modalId===m));return{...t,openedModals:h}}case"bring-modal-to-front":{const{layerId:p,modalId:m}=r,h=[...t.openedModals].sort((f,g)=>f.layerId===p&&f.modalId===m?1:g.layerId===p&&g.modalId===m?-1:0);return{...t,openedModals:h}}case"update-filter":return{...t,filterUpdate:{...r}};case"hover-layer-move":{const{data:p,layer:m,layerId:h,Component:f,isPinnable:g,zIndex:x,...y}=r;return{...t,hoverData:{data:[...t.hoverData.data.filter(j=>j.layerId!==h),{data:p,Component:f,layer:m,layerId:h,isPinnable:g,zIndex:x}],...y,hovering:!0}}}case"hover-layer-leave":{const{layerId:p}=r,m=t.hoverData.data.filter(h=>h.layerId!==p);return{...t,hoverData:{...t.hoverData,data:m,hovering:!!m.length}}}case"pin-hover-comp":{if(!t.hoverData.hovering)return t;const{lngLat:p,marker:m}=r,h=[...t.hoverData.data].filter(({layerId:f})=>!f.includes(lb)).filter(({isPinnable:f})=>f).sort((f,g)=>g.zIndex-f.zIndex);if(h.length){m.addTo(t.maplibreMap);const f={id:ob(),lngLat:p,marker:m,HoverComps:h},g=[...t.pinnedHoverComps,f],x=(d=(c=(i=(l=(a=g[0])==null?void 0:a.HoverComps[0])==null?void 0:l.layer)==null?void 0:i.filters)==null?void 0:c.geometry)==null?void 0:d.value,y=g.map(j=>{const N=j.HoverComps.length>1?j.HoverComps.find(_=>_.data[1].includes(x)):j.HoverComps[0];return N==null?void 0:N.data[2]}).filter(j=>j!==void 0);return{...t,pinnedHoverCompIds:y,pinnedHoverComps:g}}return t}case"remove-pinned":const u=[];return t.pinnedHoverComps.forEach(p=>{if(p.id!==r.id)return;const m=p.HoverComps[0].data[0];u.push(m)}),{...t,pinnedHoverComps:t.pinnedHoverComps.filter(p=>p.id!==r.id?!0:(p.marker.remove(),!1)),pinnedHoverCompIds:t.pinnedHoverCompIds.filter(p=>!u.includes(p.ogc_fid))};case"layer-loading-start":{const{layerId:p}=r;let m=C(t,["layersLoading",p,"start"],0),h=C(t,["layersLoading",p,"loading"],0);return{...t,layersLoading:{...t.layersLoading,[p]:{start:m||performance.now(),loading:++h}}}}case"layer-loading-stop":{const{layerId:p}=r;let m=C(t,["layersLoading",p,"start"],0),h=C(t,["layersLoading",p,"loading"],0);return{...t,layersLoading:{...t.layersLoading,[p]:{start:h>1?m:0,loading:Math.max(--h,0)}}}}case"activate-layer":return{...t,activeLayers:{...t.activeLayers,[r.layerId]:!0}};case"deactivate-layer":return{...t,activeLayers:{...t.activeLayers,[r.layerId]:!1}};case"update-legend":return{...t,legend:{...t.legend,...r.update}};case"set-resources-loaded":{const{layerId:p,loaded:m}=r;return{...t,resourcesLoaded:{...t.resourcesLoaded,[p]:m}}}case"initialize-layers":{const{layerVisibility:p,layerState:m,activeLayers:h,resourcesLoaded:f,initializedLayers:g}=r;return{...t,initializedLayers:[...t.initializedLayers,...g],layerVisibility:{...t.layerVisibility,...p},layerState:{...t.layerState,...m},activeLayers:{...t.activeLayers,...h},resourcesLoaded:{...t.resourcesLoaded,...f}}}case"update-state":return{...t,...r};case"map-loaded":{const{legend:p,...m}=r;return{...t,...m,initializedLayers:[],legend:{...t.legend,...p}}}case"map-removed":return{...cb};default:return t}},md=t=>{const{accessToken:s,mapOptions:n=Da,id:r,layers:a=$M,layerProps:l=Da,leftSidebar:i=Da,rightSidebar:c=Da,legend:d=Da,mapActions:u=["navigation-controls"],...p}=t,m=w.useRef({containerId:r||ob(),...kM,...n,accessToken:s,legend:d}),[h,f]=w.useReducer(AM,cb);w.useEffect(()=>{const{styles:se,navigationControl:me,legend:xe,protocols:re=[],containerId:Q,...pe}=m.current,ge=re.reduce((be,_e)=>{const{type:Re,protocolInit:Pe,...Ge}=_e;return be[Re]={...Ge,Protocol:Pe(cs)},be},{});let le=0;const ie=new cs.Map({container:Q,...pe,style:se[0].style});return me&&ie.addControl(new cs.NavigationControl,me),ie.on("move",be=>{f({type:"update-state",moving:!0})}),ie.on("moveend",be=>{f({type:"update-state",moving:!1})}),ie.once("load",be=>{f({type:"map-loaded",maplibreMap:ie,mapStyles:se,styleIndex:le,legend:xe,Protocols:ge})}),()=>{f({type:"map-removed"}),ie.remove()}},[]),w.useEffect(()=>{if(!h.maplibreMap)return;const me=[...a,...h.dynamicLayers].filter(xe=>!h.initializedLayers.includes(xe));if(me.length){const xe={},re={},Q={},pe={};me.forEach(ge=>{xe[ge.id]=C(ge,"startVisible",!0),re[ge.id]=C(ge,"startState",{}),Q[ge.id]=C(ge,"startActive",!0),pe[ge.id]=!1;function le(ie){f({type:"update-layer-state",layerId:ge.id,layerState:ie})}ge.updateState=le.bind(ge)}),f({type:"initialize-layers",layerVisibility:xe,layerState:re,activeLayers:Q,resourcesLoaded:pe,initializedLayers:me})}},[h.maplibreMap,a,h.dynamicLayers,h.initializedLayers]),w.useEffect(()=>{a.forEach(se=>{se.props=C(l,se.id,{})})},[a,l,h.pinnedHoverCompIds]),w.useEffect(()=>{a.forEach(se=>{se.state=C(h,["layerState",se.id],{}),se.state={...se.state,pinnedHoverCompIds:h.pinnedHoverCompIds}})},[a,h.layerState,h.pinnedHoverCompIds]);const g=w.useCallback(se=>{f({type:"create-dynamic-layer",layer:se})},[]),x=w.useCallback(se=>{f({type:"destroy-dynamic-layer",layerId:se})},[]),y=w.useCallback((se,me)=>{f({type:"set-resources-loaded",layerId:se,loaded:me})},[]),j=w.useCallback(se=>{f({type:"toggle-layer-visibility",layerId:se})},[]),N=w.useCallback((se,me)=>{f({type:"update-layer-state",layerId:se,layerState:me})},[]),_=w.useCallback(se=>{if(!h.maplibreMap||se===h.styleIndex)return;const me=h.mapStyles[se];me&&(h.maplibreMap.once("styledata",xe=>{f({type:"update-state",styleIndex:se})}),h.maplibreMap.setStyle(me.style))},[h.maplibreMap,h.mapStyles,h.styleIndex]),E=w.useCallback(se=>{f({type:"update-legend",update:se})},[]),L=w.useCallback(se=>{f(se)},[]),S=w.useCallback(({lngLat:se})=>{const me=new cs.Marker().setLngLat(se);f({type:"pin-hover-comp",lngLat:se,marker:me})},[]),k=w.useCallback(se=>{f({type:"remove-pinned",id:se})},[]),$=w.useCallback(se=>{f({type:"layer-loading-start",layerId:se})},[]),I=w.useCallback(se=>{f({type:"layer-loading-stop",layerId:se})},[]),T=w.useCallback((se,me,xe)=>{if(!C(se,["filters",me],null))return;const re=se.filters[me].value;f({type:"update-filter",layerId:se.id,filterId:me,prevValue:re,value:xe})},[]),A=w.useCallback(se=>{f({type:"activate-layer",layerId:se})},[]),R=w.useCallback(se=>{f({type:"deactivate-layer",layerId:se})},[]),O=w.useCallback((se,me)=>{f({type:"open-modal",layerId:se,modalId:me})},[]),M=w.useCallback((se,me)=>{f({type:"close-modal",layerId:se,modalId:me})},[]),D=w.useCallback((se,me)=>{f({type:"bring-modal-to-front",layerId:se,modalId:me})},[]),P=w.useCallback(()=>{if(!h.maplibreMap)return;const{center:se,zoom:me}=m.current;h.maplibreMap.easeTo({pitch:0,bearing:0,center:se,zoom:me})},[h.maplibreMap]),F=w.useCallback((se={})=>{h.maplibreMap&&h.maplibreMap.easeTo({pitch:0,bearing:0,...se})},[h.maplibreMap]),[B,V]=w.useMemo(()=>[...a,...h.dynamicLayers].reduce((se,me)=>(h.activeLayers[me.id]&&h.initializedLayers.includes(me)?se[0].push(me):se[1].push(me),se),[[],[]]),[a,h.dynamicLayers,h.activeLayers,h.initializedLayers]);w.useEffect(()=>{h.maplibreMap&&(h.hoverData.hovering?h.maplibreMap.getCanvas().style.cursor="pointer":h.maplibreMap.getCanvas().style.cursor="")},[h.maplibreMap,h.hoverData.hovering]);const G=w.useMemo(()=>B.filter(se=>C(h,["layersLoading",se.id,"loading"],0)).sort((se,me)=>{const xe=C(h,["layersLoading",se.id,"start"],0),re=C(h,["layersLoading",me.id,"start"],0);return xe-re}),[h.layersLoading,B]),[Z,X]=w.useMemo(()=>{if(!i)return[null,{}];const{Component:se,...me}={...LM,...i};return[se,me]},[i]),[H,z]=w.useMemo(()=>{if(!c)return[null,{}];const{Component:se,...me}={...IM,...c};return[se,me]},[c]),W=w.useMemo(()=>B.reduce((se,me)=>se||C(me,["onHover","isPinnable"],!1),!1),[B]);w.useEffect(()=>{if(W)return h.maplibreMap.on("click",S),()=>{h.maplibreMap.off("click",S)}},[h.maplibreMap,S,W]);const{HoverComps:Y,...U}=w.useMemo(()=>{if(!h.maplibreMap)return{hovering:!1};const{data:se,...me}=h.hoverData;return{HoverComps:[...se].sort((re,Q)=>Q.zIndex-re.zIndex),...me}},[h.hoverData]),q=w.useMemo(()=>B.reduce((se,me)=>(h.openedModals.forEach(({layerId:xe,modalId:re})=>{xe===me.id&&C(me,["modals",re],null)&&se.push({layer:me,key:`${xe}-${re}`,layerId:xe,modalId:re,...C(me,["modals",re],{})})}),se),[]),[B,h.openedModals]),te=w.useMemo(()=>{const se=(u||[]).reduce((me,xe)=>(xe in $m?me.push($m[xe]):typeof xe=="object"&&me.push({Component:ib,icon:"fa-solid fa-gear",...xe}),me),[]);return B.reduce((me,xe)=>(C(xe,"layerActions",[]).forEach(({Component:re=BM,wrapper:Q=null,...pe})=>{me.push({layer:xe,Component:Q?Q(re):re,...pe})}),me),se)},[u,B]),K=w.useCallback(se=>h.maplibreMap?h.maplibreMap.project(se):{x:0,y:0},[h.maplibreMap]),[ne,J]=w.useState(null),ae=lT(ne),de=w.useMemo(()=>({toggleLayerVisibility:j,updateLayerState:N,activateLayer:A,deactivateLayer:R,updateFilter:T,startLayerLoading:$,stopLayerLoading:I,setMapStyle:_,setResourcesLoaded:y,updateLegend:E,openModal:O,closeModal:M,bringModalToFront:D,createDynamicLayer:g,destroyDynamicLayer:x,resetView:F,goHome:P}),[j,N,A,R,T,$,I,_,y,E,O,M,D,g,x,F,P]),ue=Ve(),{LoadingIndicator:fe}=hs(),{current:{containerId:ve}}=m;return e.jsxs("div",{className:`block relative w-full h-full max-w-full max-h-full overflow-visible ${ue.text}`,children:[e.jsx("div",{ref:J,id:ve,className:"w-full h-full relative"}),e.jsx("div",{id:`${ve}-box-select-blocker`,className:"absolute inset-0 z-50 pointer-events-none"}),q.map(({Component:se,key:me,startPos:xe,...re})=>e.jsx(_M,{...re,startPos:xe,legend:h.legend,maplibreMap:h.maplibreMap,MapActions:de,activeLayers:B,inactiveLayers:V,mapStyles:h.mapStyles,styleIndex:h.styleIndex,layerVisibility:h.layerVisibility,layerProps:l,layerState:h.layerState,filterUpdate:h.filterUpdate,layersLoading:h.layersLoading,loadingLayers:G,resourcesLoaded:h.resourcesLoaded,openedModals:h.openedModals,children:e.jsx(se,{...re,legend:h.legend,maplibreMap:h.maplibreMap,MapActions:de,activeLayers:B,inactiveLayers:V,mapStyles:h.mapStyles,styleIndex:h.styleIndex,layerVisibility:h.layerVisibility,layerProps:l,layerState:h.layerState,filterUpdate:h.filterUpdate,layersLoading:h.layersLoading,loadingLayers:G,resourcesLoaded:h.resourcesLoaded,openedModals:h.openedModals})},me)),e.jsxs("div",{className:"flex absolute inset-0 pointer-events-none p-4",children:[i?e.jsx("div",{className:"h-full relative pr-4",children:e.jsx(Z,{...X,legend:h.legend,maplibreMap:h.maplibreMap,MapActions:de,activeLayers:B,inactiveLayers:V,mapStyles:h.mapStyles,styleIndex:h.styleIndex,layerVisibility:h.layerVisibility,layerProps:l,layerState:h.layerState,filterUpdate:h.filterUpdate,layersLoading:h.layersLoading,loadingLayers:G,resourcesLoaded:h.resourcesLoaded,openedModals:h.openedModals})}):null,e.jsxs("div",{className:"flex-1 relative",children:[[...B].reverse().map((se,me)=>e.jsx(kT,{layer:se,legend:h.legend,isActive:C(h,["activeLayers",se.id],!0),isVisible:C(h,["layerVisibility",se.id],!0),isLoading:!!C(h,["layersLoading",se.id,"loading"],!1),resourcesLoaded:!!C(h,["resourcesLoaded",se.id],!1),maplibreMap:h.maplibreMap,updateHover:L,containerId:ve.current,MapActions:de,activeLayers:B,inactiveLayers:V,layerProps:C(l,se.id,{}),layerState:C(h,["layerState",se.id],{}),allLayerProps:l,allLayerState:h.layerState,styleIndex:h.styleIndex,mapStyles:h.mapStyles,layersLoading:h.layersLoading,loadingLayers:G,filterUpdate:h.filterUpdate,openedModals:h.openedModals,Protocols:h.Protocols},se.id)),e.jsx("div",{className:"absolute bottom-0 left-0 grid grid-cols-1 gap-4",children:G.map(se=>e.jsx(fe,{layer:se},se.id))})]}),te.length?e.jsx("div",{className:"relative pl-4",children:e.jsx("div",{className:"flex flex-col h-full justify-end flex-end",children:te.map(({Component:se,...me},xe)=>e.jsx(se,{...me,legend:h.legend,maplibreMap:h.maplibreMap,MapActions:de,activeLayers:B,inactiveLayers:V,mapStyles:h.mapStyles,styleIndex:h.styleIndex,layerVisibility:h.layerVisibility,layerProps:l,layerState:h.layerState,filterUpdate:h.filterUpdate,layersLoading:h.layersLoading,loadingLayers:G,resourcesLoaded:h.resourcesLoaded,openedModals:h.openedModals},xe))})}):null,!c||!B.length?null:e.jsx("div",{className:"h-full relative pl-4",children:e.jsx(H,{...z,legend:h.legend,maplibreMap:h.maplibreMap,MapActions:de,activeLayers:B,inactiveLayers:V,mapStyles:h.mapStyles,styleIndex:h.styleIndex,layerVisibility:h.layerVisibility,layerProps:l,layerState:h.layerState,filterUpdate:h.filterUpdate,layersLoading:h.layersLoading,loadingLayers:G,resourcesLoaded:h.resourcesLoaded,openedModals:h.openedModals})})]}),h.pinnedHoverComps.map(({HoverComps:se,data:me,id:xe,...re})=>b.createElement(vM,{...re,...ae,remove:k,project:K,id:xe,key:xe},se.map(({Component:Q,data:pe,layer:ge,layerId:le})=>e.jsx(Q,{isPinned:!0,legend:h.legend,layer:ge,data:pe,maplibreMap:h.maplibreMap,MapActions:de,activeLayers:B,inactiveLayers:V,mapStyles:h.mapStyles,styleIndex:h.styleIndex,layerVisibility:h.layerVisibility,layerProps:l,layerState:h.layerState,filterUpdate:h.filterUpdate,layersLoading:h.layersLoading,loadingLayers:G,resourcesLoaded:h.resourcesLoaded,openedModals:h.openedModals},le)))),U.hovering?e.jsx(jM,{...U,...ae,project:K,children:Y.filter(({layerId:se})=>!se.includes(lb)).map(({Component:se,layerId:me,...xe})=>e.jsx(se,{...xe,legend:h.legend,maplibreMap:h.maplibreMap,MapActions:de,activeLayers:B,inactiveLayers:V,mapStyles:h.mapStyles,styleIndex:h.styleIndex,layerVisibility:h.layerVisibility,layerProps:l,layerState:h.layerState,filterUpdate:h.filterUpdate,layersLoading:h.layersLoading,loadingLayers:G,resourcesLoaded:h.resourcesLoaded,openedModals:h.openedModals},me))}):null]})};function OM(t){return t.slice().sort(function(s,n){return s-n})}function PM(t){for(var s=0,n,r=0;r<t.length;r++)(r===0||t[r]!==n)&&(n=t[r],s++);return s}function Em(t,s){for(var n=[],r=0;r<t;r++){for(var a=[],l=0;l<s;l++)a.push(0);n.push(a)}return n}function sc(t,s,n,r){var a;if(t>0){var l=(n[s]-n[t-1])/(s-t+1);a=r[s]-r[t-1]-(s-t+1)*l*l}else a=r[s]-n[s]*n[s]/(s+1);return a<0?0:a}function nc(t,s,n,r,a,l,i){if(!(t>s)){var c=Math.floor((t+s)/2);r[n][c]=r[n-1][c-1],a[n][c]=c;var d=n;t>n&&(d=Math.max(d,a[n][t-1]||0)),d=Math.max(d,a[n-1][c]||0);var u=c-1;s<r[0].length-1&&(u=Math.min(u,a[n][s+1]||0));for(var p,m,h,f,g=u;g>=d&&(p=sc(g,c,l,i),!(p+r[n-1][d-1]>=r[n][c]));--g)m=sc(d,c,l,i),h=m+r[n-1][d-1],h<r[n][c]&&(r[n][c]=h,a[n][c]=d),d++,f=p+r[n-1][g-1],f<r[n][c]&&(r[n][c]=f,a[n][c]=g);nc(t,c-1,n,r,a,l,i),nc(c+1,s,n,r,a,l,i)}}function DM(t,s,n){var p;for(var r=((p=s[0])==null?void 0:p.length)||0,a=new Array(r),l=new Array(r),i=t[Math.floor(r/2)],c=0;c<r;++c)c===0?(a[0]=t[0]-i,l[0]=(t[0]-i)*(t[0]-i)):(a[c]=a[c-1]+t[c]-i,l[c]=l[c-1]+(t[c]-i)*(t[c]-i)),s[0][c]=sc(0,c,a,l),n[0][c]=0;for(var d,u=1;u<s.length;++u)u<s.length-1?d=u:d=r-1,nc(d,r-1,u,s,n,a,l)}function zo(t,s){var m;if(s>t.length)return console.log("Ckmeans cannot generate more classes than there are data values"),[];var n=t.length,r=OM(t),a=PM(r);if(a===1)return[r[0]];s=Math.min(a,s);var l=Em(s,n),i=Em(s,n);DM(r,l,i);for(var c=[],d=(((m=i[0])==null?void 0:m.length)||0)-1,u=i.length-1;u>=0;u--){var p=i[u][d];c[u]=r[p],u>0&&(d=p-1)}return c}function RM(t,s){if(t.length<2)return t;const n=Math.min(...t),r=Math.max(...t),a=[n],l=(r-n)/s;for(let i=1;i<s;i++)a.push(a[0]+l*i);return a.push(r),a}function FM(t,s){const n=Math.min(...t),r=Math.max(...t);let a=[];if(s<1)return a.push(r),a;let l=parseInt(s/3),i=.75,c=1.5,d=.5+1.5*c,u=parseInt(s),p=c,m,h=!1,f=r-n;if(km(f,0)&&km(r,0))m=1,h=!0;else{let L=1;m=Math.abs(r)>=Math.abs(n)?Math.abs(r):Math.abs(n),L=parseInt(1+1/(1+p));let S=1>=u?1:u;h=f<m*L*S*1e-7*3}h?(m>10&&(m=9+m/10,m=m*i),l>1&&(m=m/l)):(m=f,u>1&&(m=m/u)),m<20*1e-7&&(m=20*1e-7);let g=Math.pow(10,Math.floor(Math.log10(m))),x=g;2*g-m<p*(m-x)&&(x=2*g,5*g-m<d*(m-x)&&(x=5*g,10*g-m<p*(m-x)&&(x=10*g)));let y=parseInt(Math.floor(n/x+1e-7)),j=parseInt(Math.ceil(r/x-1e-7));for(;y*x>n+1e-7*x;)y=y-1;for(;j*x<r-1e-7*x;)j=j+1;let N=parseInt(Math.floor(.5+j-y));N<l&&(N=l-N,y>=0?(j=j+N/2,y=y-N/2+N%2):(y=y-N/2,j=j+N/2+N%2));let _=y*x,E=parseInt(j-y);a=[];for(let L=1;L<E+1;L++)a.push(_+L*x);if(a.length===0)return a;if(a[0]<n&&a.splice(0,1,n),a[a.length-1]>r&&a.splice(a.length-1,1,r),n<0&&r>0){let L=[];for(let k=0;k<=a.length;k++)L.push(a[k]-0);let S=0;for(let k=1;k<=a.length;k++)Math.abs(L[k])<Math.abs(L[k-1])&&(S=k);a[S]=0}return a}function km(t,s){return t>1||s>1?!1:t>=0&&t<1&&s>=0&&s<1}const uo={};for(const t in $t.schemeGroups)$t.schemeGroups[t].forEach(s=>{const n=$t[s];for(const r in n)r in uo||(uo[r]=[]),uo[r].push({type:`${t[0].toUpperCase()}${t.slice(1)}`,name:s,category:"Colorbrewer",colors:n[r]})});const mo=(t,s)=>C(uo,[t],[]).reduce((n,r)=>r.name===s?r.colors:n,[]).slice(),Lm="pin_outline",VM="static",HM=({data:t,layer:s})=>{const{attributes:n,activeViewId:r,filters:a}=s,{pgEnv:l,falcor:i,falcorCache:c}=w.useContext(ce),d=w.useMemo(()=>C(t,"[0]",null),[t]);let u=(typeof(n==null?void 0:n[0])=="string"?n:n.map(m=>m.name)).filter(m=>!["wkb_geometry"].includes(m));w.useEffect(()=>{i.get(["dama",l,"viewsbyId",r,"databyId",d,u])},[i,l,r,d,n]);const p=w.useMemo(()=>C(c,["dama",l,"viewsbyId",r,"databyId",d],{}),[d,c,r,l]);return e.jsxs("div",{className:"bg-white p-4 max-h-64 max-w-lg scrollbar-xs overflow-y-scroll",children:[e.jsx("div",{className:"font-medium pb-1 w-full border-b ",children:s.source.display_name}),Object.keys(p).length===0?`Fetching Attributes ${d}`:"",Object.keys(p).filter(m=>typeof p[m]!="object").map((m,h)=>e.jsxs("div",{className:"flex border-b pt-1",children:[e.jsx("div",{className:"flex-1 font-medium text-sm pl-1",children:m}),e.jsx("div",{className:"flex-1 text-right font-thin pl-4 pr-1",children:p==null?void 0:p[m]})]},h))]})},zM=({domain:t,range:s,title:n})=>{const a=(i=>{const c=[];if(!(i&&i.length))return s;c.push(`0 - ${new Intl.NumberFormat().format(i[0])}`);for(let d=0;d<i.length-1;d++)c.push(`${new Intl.NumberFormat().format(i[d])} - ${new Intl.NumberFormat().format(i[d+1])}`);return c})(t),l=w.useMemo(()=>Math.min(t.length,s.length),[t.length,s.length]);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"shadow-lg box-content min-h-32 min-w-48 w-fit p-1 border-2 bg-slate-50 bg-opacity-55",children:[e.jsx("div",{className:"flex mb-1",children:e.jsx("div",{className:"flex-1 font-medium",children:n})}),Array.from({length:l}).map((i,c)=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex m-2",children:[e.jsx("div",{className:"flex-none w-16",children:e.jsx("div",{className:"h-8 w-[2px] rounded dark:ring-1 dark:ring-inset dark:ring-white/10 sm:w-full",style:{backgroundColor:s[c],transition:"background-color 0.5s"}})}),e.jsx("div",{className:"flex-initial ml-6 w-32",children:e.jsx("div",{className:"h-6 w-2 ml-1 p-[2px] sm:w-full text-left",children:a[c]})})]})}))]})})},UM=t=>t===null||isNaN(t),WM=(t,s)=>String(t).localeCompare(String(s)),GM=(t,s,n)=>{const r=s.map(a=>UM(a.value)?a.value:+a.value);switch(t){case"quantize":return ur(r);case"threshold":return zo(r.filter(Boolean),n?n-1:6);case"ordinal":return[...new Set(r)].sort(WM);default:return r}},JM=(t,s,n,r)=>{switch(t){case"threshold":return mo(s?s+1:7,n);case"ordinal":return mo(Math.min(12,s),n);default:return mo(7,n)}},qM=t=>{const{layerProps:s,resourcesLoaded:n,maplibreMap:r,activeLayers:a}=t,{filters:l,activeViewId:i,symbology:c,updateLegend:d,sourceId:u,layers:p}=s,m=a[0].state.pinnedHoverCompIds,h=C(l,["activeVar","value"],""),[f,g]=w.useState(null),[x,y]=w.useState(null),{pgEnv:j,falcor:N,falcorCache:_,...E}=w.useContext(ce),L=w.useCallback((O={})=>{const{domain:M=[],range:D=[],format:P=".2s",name:F,title:B,type:V="threshold",data:G=[],color:Z="BrBG",reverse:X=!1,height:H=3,direction:z="vertical",customLegendScale:W}=O,Y={domain:M,range:D,format:P,name:F,title:B,type:V,data:G,color:Z,reverse:X,height:H,direction:z,customLegendScale:W};M.length||(Y.domain=GM(V,G,D.length)),D.length||(Y.range=JM(V,Y.domain.length,Z)),g(Y)},[]),S=w.useRef(null);w.useEffect(()=>{if(!f)return;const{data:O,domain:M,...D}=f;if(f&&!S.current){S.current=D;return}if(!Fe(D,S.current)){S.current=D;const P=JSON.parse(JSON.stringify(c));p.forEach(({id:F,type:B})=>{he(P,`${F}.${B}-color.${h}.settings`,{...D})}),N.call(["dama","sources","metadata","update"],[j,u,{symbology:P}]).then(F=>console.log("SAVE RESPONSE:",F))}},[N,j,u,f,c,h,p]),w.useEffect(()=>{const O=m==null?void 0:m.map(D=>D.ogc_fid),M=p.find(D=>D.id.includes(Lm));if(M){const D=M.id;O.length===0&&O.push(-666666666);const P=["match",["get","ogc_fid"],O,!0,!1];r.getLayer(D)&&(r.setFilter(D,P),O!=null&&O.length?r.setPaintProperty(D,"line-opacity",1):r.setPaintProperty(D,"line-opacity",0))}},[r,c,m]),w.useEffect(()=>{async function O(){if(!r)return;const M=C(c,"sources",[]),D=C(c,"layers",[]),P=C(c,"images",[]);Array.isArray(P)&&await Promise.all(P.filter(F=>!r.hasImage(F.id)&&F.url).map(F=>new Promise((B,V)=>{r.loadImage(F.url,function(G,Z){if(G)throw G;r.hasImage(F.id)||r.addImage(F.id,Z),B()})}))),Array.isArray(M)&&M.forEach(F=>{r.getSource(F.id)||r.addSource(F.id,F.source)}),Array.isArray(D)&&D.forEach(F=>{r.getLayer(F.id)?F.layout&&F.layout.visibility!==void 0&&r.setLayoutProperty(F.id,"visibility",F.layout.visibility):r.addLayer(F)})}O()},[r,c]);const k=C(l,["activeVar","value"],"");w.useEffect(()=>{if(r&&n){if(!k||k==="none"){y(null);return}(Object.keys(c||{})||[]).forEach(O=>{(Object.keys(c[O]||{}).filter(M=>C(c,`[${M}][${k}]`,!1)||C(c,`[${M}][default]`,!1)||C(c,`[${O}][${M}][${k}]`,!1)||C(c,`[${O}][${M}][default]`,!1))||[]).forEach(M=>{var B;const D=C(c,`[${M}][${k}]`,"")||C(c,`[${M}][default]`,"")||C(c,`[${O}][${M}][${k}]`,"")||C(c,`[${O}][${M}][default]`,"");let{value:P,settings:F}=D;if(!P&&F){const{type:V,domain:G,range:Z,data:X}=F,H=Ho(V,G,Z),z=X.reduce((W,Y)=>(W[Y.id]=H(Y.value),W),{});P=["get",["to-string",["get","geoid"]],["literal",z]]}(B=r.getLayer(O))!=null&&B.id&&(["visibility"].includes(M)?r.setLayoutProperty(O,M,P):O.includes(Lm)||r.setPaintProperty(O,M,P)),D.settings&&L(D.settings)})})}},[r,n,c,k,L]),w.useEffect(()=>{c.legend&&L(c.legend)},[c==null?void 0:c.legend]),w.useEffect(()=>{if(!f||!x)return;const{layer_id:O,paintProperty:M}=x;let{value:D}=x;if(!D){const{type:P,domain:F,range:B,data:V}=f,G=Ho(P,F,B),Z=V.reduce((X,H)=>(X[H.id]=G(H.value),X),{});D=["get",["to-string",["get","ogc_fid"]],["literal",Z]]}r.getLayer(O)&&r.setPaintProperty(O,M,D)},[f,x]),w.useEffect(()=>{var O;(O=c==null?void 0:c.layers)==null||O.forEach(M=>{r.getLayer(M.id)&&M.paint&&Object.keys(M.paint).forEach(P=>{const F=r.getPaintProperty(M.id,P);Fe(F,M.paint[P])||r.setPaintProperty(M.id,P,M.paint[P])})})},[c]),w.useEffect(()=>{r&&c&&c.fitToBounds&&r.fitBounds(c.fitToBounds,{duration:400,zoom:c.fitZoom||13})},[r,c]),w.useEffect(()=>{var O,M,D,P;if(r&&c.filter){const F=((O=c.filter)==null?void 0:O.dataKey)??"ogc_fid",B=((M=c.filter)==null?void 0:M.dataIds)??c.filter,V=["match",["get",F],B,!0,!1];(D=c==null?void 0:c.layers)==null||D.forEach(G=>{r.getLayer(G.id)&&!G.id.includes(VM)&&(G.filter?r.setFilter(G.id,["all",G.filter[1],V]):r.setFilter(G.id,V))})}!c.filter&&r&&((P=c==null?void 0:c.layers)==null||P.forEach(F=>{const B=r.getLayer(F.id);B&&F.filter?r.setFilter(F.id,["all",F.filter[1]]):B&&r.setFilter(F.id,["all"])}))},[r,c.filter]);const[$,I]=w.useState(!1),T=w.useCallback(O=>{I(!1)},[]);w.useCallback(O=>{I(M=>!M)},[]);const[A,R]=w.useState();return cd(A,T),f?e.jsxs("div",{ref:R,className:"absolute top-0 left-0 w-96 grid grid-cols-1 gap-4",children:[e.jsx("div",{className:"z-10",children:e.jsx(zM,{...f})}),e.jsx("div",{className:"z-0",children:e.jsx(eB,{legend:f,updateLegend:d,isOpen:$,close:T})})]}):null},KM=({value:t,remove:s})=>{const n=w.useCallback(a=>{a.stopPropagation(),s(t)},[t,s]),r=Ve();return e.jsx("span",{onClick:n,className:`
        fa-solid fa-remove px-2 flex items-center
        ${r.bgAccent3Hover} rounded cursor-pointer
      `})},YM=({domain:t,index:s,disabled:n,remove:r,edit:a})=>{const[l,i]=w.useState(!1),[c,d]=w.useState(""),u=w.useCallback(j=>{j.stopPropagation(),i(!0),d(t)},[t]),p=w.useCallback(j=>{j.stopPropagation(),i(!1),d("")},[t]),m=w.useCallback(j=>{j.stopPropagation(),a(c,s),i(!1),d("")},[s,c,a]),[h,f]=w.useState();w.useEffect(()=>{h&&l&&(h.focus(),h.select())},[h,l]);const[g,x]=w.useState();cd(g,p);const y=Ve();return e.jsxs("div",{ref:x,className:`
        flex px-2 py-1 rounded cursor-pointer
        ${y.bgAccent2Hover}
      `,onClick:u,children:[e.jsxs("div",{className:"w-8 mr-1 py-1",children:["(",s+1,")"]}),e.jsx("div",{className:"flex-1 mr-1",children:l?e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-1 mr-1",children:e.jsx(fl,{ref:f,value:c,onChange:d})}),e.jsx(Vo,{onClick:m,className:"buttonPrimary",children:"Edit"})]}):e.jsx("div",{className:"px-2 py-1",children:t})}),n?null:l?e.jsx(Vo,{onClick:p,className:"buttonDanger",children:"Stop"}):e.jsx(KM,{remove:r,value:t})]})},ZM=({domain:t,range:s,updateLegend:n})=>{const r=w.useCallback(m=>{n(t.filter(h=>h!==m))},[t,n]),[a,l]=w.useState(""),i=w.useCallback(m=>{n([...t,+a].sort((h,f)=>h-f)),l("")},[t,a,n]),c=w.useCallback((m,h)=>{const f=[...t];f.splice(h,1,m),n(f.sort((g,x)=>g-x))},[t,n]),d=w.useCallback(()=>{n(void 0),l("")},[n]),u=w.useMemo(()=>t.length<=2,[t.length]),p=Ve();return e.jsx("div",{className:"absolute left-full top-0",style:{left:"CALC(100% + 1rem)"},children:e.jsx("div",{className:`
          ${p.bg} p-1 pointer-events-auto rounded w-96
        `,children:e.jsxs("div",{className:"border rounded border-current relative",children:[e.jsx("div",{className:`
              p-1 border-b border-current rounded-t flex font-bold
              ${p.bgAccent2}
            `,children:"Threshold Editor"}),e.jsx("div",{className:"p-1",children:e.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[e.jsx("div",{children:"Current Thresholds:"}),t.map((m,h)=>e.jsx(YM,{domain:m,index:h,remove:r,disabled:u,edit:c},m)),e.jsxs("div",{className:`flex border-t pt-1 ${p.border}`,children:[e.jsx("div",{className:"mr-1 flex-1",children:e.jsx(fl,{type:"number",placeholder:"enter a threshold value...",onChange:l,value:a})}),e.jsx(Vo,{onClick:i,disabled:!a,className:"buttonPrimary",children:"Add"})]}),e.jsx("div",{children:e.jsx(Vo,{onClick:d,className:"buttonPrimaryBlock",children:"Reset with 6 bins"})})]})})]})})})},XM=({value:t,onChange:s})=>{const n=w.useCallback(r=>{s(!t)},[s,t]);return Ve(),e.jsx("div",{onClick:n,className:"px-4 py-1 h-8 rounded flex items-center w-full cursor-pointer",children:e.jsx("div",{className:`
          rounded flex-1 h-2 relative flex items-center bg-blue-100
        `,children:e.jsx("div",{className:`
            w-4 h-4 rounded absolute
            ${t?"bg-blue-500":"bg-gray-500"}
          `,style:{left:t?"100%":"0%",transform:"translateX(-50%)",transition:"left 150ms"}})})})},QM=({colors:t,name:s,reverse:n,range:r,updateLegend:a,test:l})=>{const i=w.useMemo(()=>Fe(t,r),[t,r]),c=w.useCallback(()=>{a(t,s,n)},[a,s,t,n]);return e.jsx("div",{onClick:i?null:c,className:`
        outline outline-2 rounded-lg my-2
        ${i?"outline-black":"outline-transparent cursor-pointer"}
      `,children:e.jsx(Sr,{colors:t,height:3})},s)},eB=({legend:t,updateLegend:s,isOpen:n,close:r})=>{const a=w.useCallback(f=>{s({...t,type:f,domain:void 0})},[t,s]),l=w.useCallback((f,g,x)=>{s({...t,range:f,color:g,reverse:x,domain:void 0})},[t,s]),i=w.useCallback((f,g=void 0)=>{s({...t,domain:f,range:g})},[t,s]);w.useState(-1);const[c,d]=w.useState(C(t,["range","length"],7)),[u,p]=w.useState(t.reverse),m=w.useMemo(()=>C(co,c,[]).map(({colors:f,...g})=>({...g,colors:u?[...f].reverse():[...f]})),[c,u]),h=Ve();return n?e.jsxs("div",{className:`
        ${h.bg} p-1 pointer-events-auto rounded w-96 relative
      `,children:[e.jsxs("div",{className:"border rounded border-current relative",children:[e.jsxs("div",{className:`
            p-1 border-b border-current rounded-t flex font-bold
            ${h.bgAccent2}
          `,children:[e.jsx("div",{className:"flex-1",children:"Legend Controls"}),e.jsx("div",{className:"flex-0",children:e.jsx("span",{onClick:r,className:`
                px-2 py-1 rounded cursor-pointer
                ${h.bgAccent3Hover}
              `,children:e.jsx("span",{className:"fa fa-remove"})})})]}),e.jsxs("div",{className:"p-1 grid grid-cols-1 gap-1",children:[e.jsxs("div",{className:"flex items-center px-1",children:[e.jsx("div",{className:"w-40 text-right",children:"Scale Type:"}),e.jsx("div",{className:"flex-1 ml-1",children:e.jsx(aB,{...t,updateLegend:a})})]}),e.jsxs("div",{className:"flex items-center px-1",children:[e.jsx("div",{className:"w-40 text-right",children:"Number of Colors:"}),e.jsx("div",{className:"flex-1 ml-1",children:e.jsx(sB,{size:c,onChange:d})})]}),e.jsxs("div",{className:"flex items-center px-1",children:[e.jsx("div",{className:"w-40 text-right",children:"Reverse Colors:"}),e.jsx("div",{className:"flex-1",children:e.jsx(XM,{value:u,onChange:p})})]}),e.jsx("div",{className:"border-b-2 border-current",children:"Available Legend Colors:"}),e.jsx("div",{className:`
              overflow-auto px-2 rounded ${h.bgAccent2}
              scrollbar-sm scrollbar-blue
            `,style:{height:"30rem"},children:m.map(f=>e.jsx(QM,{...f,range:t.range,updateLegend:l,reverse:u},f.name))})]})]}),t.type!=="threshold"?null:e.jsx(ZM,{...t,updateLegend:i})]}):null},tB=ws(3,13),Im=t=>t,sB=({size:t,onChange:s})=>e.jsx(Dn,{removable:!1,options:tB,displayAccessor:Im,valueAccessor:Im,onChange:s,value:t}),nB=[{value:"quantile",name:"Quantile"},{value:"threshold",name:"Threshold"},{value:"ordinal",name:"Ordinal"}],aB=({type:t,updateLegend:s})=>{const n=w.useCallback(r=>{s(r)},[s]);return e.jsx(Dn,{removable:!1,options:nB,displayAccessor:r=>r.name,valueAccessor:r=>r.value,onChange:n,value:t})};var ip;class rB extends dd{constructor(){super(...arguments);ye(this,"onHover",{layers:(ip=this.layers)==null?void 0:ip.map(n=>(console.log("on hover map",n.id),n.id)),callback:(n,r,a)=>[r[0].id,n,(r[0]||{}).properties],Component:this.hoverComp||HM,isPinnable:this.isPinnable||!0});ye(this,"RenderComponent",qM)}getColorScale(n,r=5,a="Reds"){let l=[0,25,50,75,100];return n.length>r&&(l=zo(n,r)),ps().domain(l).range(mo(r,a))}}const oB=(t={})=>new rB(t),lB={bgInput:"bg-white",bgInputHover:"hover:bg-white",bgContrast:"bg-gray-800",bgContrastHover:"hover:bg-gray-800",textContrast:"text-white",textContrastHover:"hover:text-white",text:"text-gray-800 disabled:text-gray-400 placeholder:text-gray-400",textDisabled:"text-gray-400 disabled:text-gray-400 placeholder:text-gray-400",bg:"bg-white",border:"border-gray-800",outline:"outline-gray-800",textButton:"text-gray-400 disabled:text-gray-400 placeholder:text-gray-400",bgButton:"bg-gray-400",bgButtonHover:"hover:bg-gray-400",borderButton:"shadow",outlineButton:"outline-gray-400",textInfo:"text-teal-400 disabled:text-teal-400 placeholder:text-teal-400",bgInfo:"bg-teal-400",bgInfoHover:"hover:bg-teal-400",borderInfo:"border-teal-400",outlineInfo:"outline-teal-400",textSuccess:"text-green-400 disabled:text-green-400 placeholder:text-green-400",bgSuccess:"bg-green-400",bgSuccessHover:"hover:bg-green-400",borderSuccess:"border-green-400",outlineSuccess:"outline-green-400",textPrimary:"text-blue-400 disabled:text-blue-400 placeholder:text-blue-400",bgPrimary:"bg-blue-400",bgPrimaryHover:"hover:bg-blue-400",borderPrimary:"border-blue-400",outlinePrimary:"outline-blue-400",textDanger:"text-red-400 disabled:text-red-400 placeholder:text-red-400",bgDanger:"bg-red-400",bgDangerHover:"hover:bg-red-400",borderDanger:"border-red-400",outlineDanger:"outline-red-400",textWarning:"text-yellow-400 disabled:text-yellow-400 placeholder:text-yellow-400",bgWarning:"bg-yellow-400",bgWarningHover:"hover:bg-yellow-400",borderWarning:"border-yellow-400",outlineWarning:"outline-yellow-400",textSmall:"text-sm",textBase:"text-base",textLarge:"text-lg",paddingSmall:"py-0 px-1",paddingBase:"py-1 px-2",paddingLarge:"py-2 px-4",bgAccent1:"bg-white",bgAccent2:"bg-white",bgAccent3:"bg-white",bgAccent4:"bg-gray-500",bgAccent1Hover:"hover:bg-gray-200",bgAccent2Hover:"hover:bg-gray-300",bgAccent3Hover:"hover:bg-gray-400",bgAccent4Hover:"hover:bg-gray-500",textHighlight:"text-blue-500",textHighlightHover:"hover:text-blue-500",borderHighlight:"border-blue-500",borderHighlightHover:"hover:border-blue-500",bgHighlight:"bg-blue-500",bgHighlightHover:"hover:bg-blue-500",transition:"transition ease-in-out duration-150",$compositions:nb},iB=tb(lB),cB=sb(iB),db=(t,s)=>t*Math.pow(2,s),Ra=(t,s)=>Math.floor(t/Math.pow(2,s)),Uo=(t,s)=>db(t.getUint16(s+1,!0),8)+t.getUint8(s),ub=(t,s)=>db(t.getUint32(s+2,!0),16)+t.getUint16(s,!0),dB=(t,s,n,r,a)=>{if(t!=r.getUint8(a))return t-r.getUint8(a);const l=Uo(r,a+1);if(s!=l)return s-l;const i=Uo(r,a+4);return n!=i?n-i:0},uB=(t,s,n,r)=>{const a=mb(t,s|128,n,r);return a?{z:s,x:n,y:r,offset:a[0],length:a[1],is_dir:!0}:null},Tm=(t,s,n,r)=>{const a=mb(t,s,n,r);return a?{z:s,x:n,y:r,offset:a[0],length:a[1],is_dir:!1}:null},mb=(t,s,n,r)=>{let a=0,l=t.byteLength/17-1;for(;a<=l;){const i=l+a>>1,c=dB(s,n,r,t,i*17);if(c>0)a=i+1;else if(c<0)l=i-1;else return[ub(t,i*17+7),t.getUint32(i*17+13,!0)]}return null},mB=(t,s)=>t.is_dir&&!s.is_dir?1:!t.is_dir&&s.is_dir?-1:t.z!==s.z?t.z-s.z:t.x!==s.x?t.x-s.x:t.y-s.y,pb=(t,s)=>{const n=t.getUint8(s*17);return{z:n&127,x:Uo(t,s*17+1),y:Uo(t,s*17+4),offset:ub(t,s*17+7),length:t.getUint32(s*17+13,!0),is_dir:n>>7===1}},Mm=t=>{const s=[],n=new DataView(t);for(let r=0;r<n.byteLength/17;r++)s.push(pb(n,r));return pB(s)},pB=t=>{t.sort(mB);const s=new ArrayBuffer(17*t.length),n=new Uint8Array(s);for(let r=0;r<t.length;r++){const a=t[r];let l=a.z;a.is_dir&&(l=l|128),n[r*17]=l,n[r*17+1]=a.x&255,n[r*17+2]=a.x>>8&255,n[r*17+3]=a.x>>16&255,n[r*17+4]=a.y&255,n[r*17+5]=a.y>>8&255,n[r*17+6]=a.y>>16&255,n[r*17+7]=a.offset&255,n[r*17+8]=Ra(a.offset,8)&255,n[r*17+9]=Ra(a.offset,16)&255,n[r*17+10]=Ra(a.offset,24)&255,n[r*17+11]=Ra(a.offset,32)&255,n[r*17+12]=Ra(a.offset,48)&255,n[r*17+13]=a.length&255,n[r*17+14]=a.length>>8&255,n[r*17+15]=a.length>>16&255,n[r*17+16]=a.length>>24&255}return s},hB=(t,s)=>{if(t.byteLength<17)return null;const n=t.byteLength/17,r=pb(t,n-1);if(r.is_dir){const a=r.z,l=s.z-a,i=Math.trunc(s.x/(1<<l)),c=Math.trunc(s.y/(1<<l));return{z:a,x:i,y:c}}return null};async function fB(t){const s=await t.getBytes(0,512e3),n=new DataView(s.data),r=n.getUint32(4,!0),a=n.getUint16(8,!0),l=new TextDecoder("utf-8"),i=JSON.parse(l.decode(new DataView(s.data,10,r)));let c=po.Unknown;i.compression==="gzip"&&(c=po.Gzip);let d=0;"minzoom"in i&&(d=+i.minzoom);let u=0;"maxzoom"in i&&(u=+i.maxzoom);let p=0,m=0,h=0,f=-180,g=-85,x=180,y=85;if(i.bounds){const N=i.bounds.split(",");f=+N[0],g=+N[1],x=+N[2],y=+N[3]}if(i.center){const N=i.center.split(",");p=+N[0],m=+N[1],h=+N[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:a*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:po.None,tileCompression:c,tileType:pd.Mvt,minZoom:d,maxZoom:u,minLon:f,minLat:g,maxLon:x,maxLat:y,centerZoom:h,centerLon:p,centerLat:m,etag:s.etag}}async function gB(t,s,n,r,a,l,i){let c=await n.getArrayBuffer(s,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(c=Mm(c));const d=Tm(new DataView(c),r,a,l);if(d){let m=(await s.getBytes(d.offset,d.length,i)).data;const h=new DataView(m);return h.getUint8(0)==31&&h.getUint8(1)==139&&(m=fa(new Uint8Array(m))),{data:m}}const u=hB(new DataView(c),{z:r,x:a,y:l});if(u){const p=uB(new DataView(c),u.z,u.x,u.y);if(p){let m=await n.getArrayBuffer(s,p.offset,p.length,t);t.specVersion===1&&(m=Mm(m));const h=Tm(new DataView(m),r,a,l);if(h){let g=(await s.getBytes(h.offset,h.length,i)).data;const x=new DataView(g);return x.getUint8(0)==31&&x.getUint8(1)==139&&(g=fa(new Uint8Array(g))),{data:g}}}}}const hb={getHeader:fB,getZxy:gB};class fb{constructor(){this.tile=(s,n)=>{if(s.type=="json"){const r=s.url.substr(10);let a=this.tiles.get(r);return a||(a=new Wo(r),this.tiles.set(r,a)),a.getHeader().then(l=>{const i={tiles:[s.url+"/{z}/{x}/{y}"],minzoom:l.minZoom,maxzoom:l.maxZoom,bounds:[l.minLon,l.minLat,l.maxLon,l.maxLat]};n(null,i,null,null)}).catch(l=>{n(l,null,null,null)}),{cancel:()=>{}}}else{const r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),a=s.url.match(r);if(!a)throw new Error("Invalid PMTiles protocol URL");const l=a[1];let i=this.tiles.get(l);i||(i=new Wo(l),this.tiles.set(l,i));const c=a[2],d=a[3],u=a[4],p=new AbortController,m=p.signal;let h=()=>{p.abort()};return i.getHeader().then(f=>{i.getZxy(+c,+d,+u,m).then(g=>{g?n(null,new Uint8Array(g.data),g.cacheControl,g.expires):f.tileType==pd.Mvt?n(null,new Uint8Array,null,null):n(null,null,null,null)}).catch(g=>{g.name!=="AbortError"&&n(g,null,null,null)})}),{cancel:h}}},this.tiles=new Map}add(s){this.tiles.set(s.source.getKey(),s)}get(s){return this.tiles.get(s)}}function Yn(t,s){return(s>>>0)*4294967296+(t>>>0)}function xB(t,s){const n=s.buf;let r,a;if(a=n[s.pos++],r=(a&112)>>4,a<128||(a=n[s.pos++],r|=(a&127)<<3,a<128)||(a=n[s.pos++],r|=(a&127)<<10,a<128)||(a=n[s.pos++],r|=(a&127)<<17,a<128)||(a=n[s.pos++],r|=(a&127)<<24,a<128)||(a=n[s.pos++],r|=(a&1)<<31,a<128))return Yn(t,r);throw new Error("Expected varint not more than 10 bytes")}function Fa(t){const s=t.buf;let n,r;return r=s[t.pos++],n=r&127,r<128||(r=s[t.pos++],n|=(r&127)<<7,r<128)||(r=s[t.pos++],n|=(r&127)<<14,r<128)||(r=s[t.pos++],n|=(r&127)<<21,r<128)?n:(r=s[t.pos],n|=(r&15)<<28,xB(n,t))}function bB(t,s,n,r){if(r==0){n==1&&(s[0]=t-1-s[0],s[1]=t-1-s[1]);const a=s[0];s[0]=s[1],s[1]=a}}const yB=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function vB(t,s,n){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(s>Math.pow(2,t)-1||n>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");const r=yB[t],a=Math.pow(2,t);let l=0,i=0,c=0;const d=[s,n];let u=a/2;for(;u>0;)l=(d[0]&u)>0?1:0,i=(d[1]&u)>0?1:0,c+=u*u*(3*l^i),bB(u,d,l,i),u=u/2;return r+c}var po=(t=>(t[t.Unknown=0]="Unknown",t[t.None=1]="None",t[t.Gzip=2]="Gzip",t[t.Brotli=3]="Brotli",t[t.Zstd=4]="Zstd",t))(po||{});async function gb(t,s){if(s===1||s===0)return t;if(s===2){if(typeof globalThis.DecompressionStream>"u")return fa(new Uint8Array(t));{let r=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}}else throw Error("Compression method not supported")}var pd=(t=>(t[t.Unknown=0]="Unknown",t[t.Mvt=1]="Mvt",t[t.Png=2]="Png",t[t.Jpeg=3]="Jpeg",t[t.Webp=4]="Webp",t[t.Avif=5]="Avif",t))(pd||{});const jB=127;function wB(t,s){let n=0,r=t.length-1;for(;n<=r;){const a=r+n>>1,l=s-t[a].tileId;if(l>0)n=a+1;else if(l<0)r=a-1;else return t[a]}return r>=0&&(t[r].runLength===0||s-t[r].tileId<t[r].runLength)?t[r]:null}class NB{constructor(s){this.url=s.includes("localhost")?"http://"+s:"https://"+s}getKey(){return this.url}async getBytes(s,n,r){let a;r||(a=new AbortController,r=a.signal);let l=await fetch(this.url,{signal:r,headers:{Range:"bytes="+s+"-"+(s+n-1)}});if(l.status===416&&s===0){const d=l.headers.get("Content-Range");if(!d||!d.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const u=+d.substr(8);l=await fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(u-1)}})}if(l.status>=300)throw Error("Bad response code: "+l.status);const i=l.headers.get("Content-Length");if(l.status===200&&(!i||+i>n))throw a&&a.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:await l.arrayBuffer(),etag:l.headers.get("ETag")||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}}}function gs(t,s){const n=t.getUint32(s+4,!0),r=t.getUint32(s+0,!0);return n*Math.pow(2,32)+r}function CB(t,s){const n=new DataView(t),r=n.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:gs(n,8),rootDirectoryLength:gs(n,16),jsonMetadataOffset:gs(n,24),jsonMetadataLength:gs(n,32),leafDirectoryOffset:gs(n,40),leafDirectoryLength:gs(n,48),tileDataOffset:gs(n,56),tileDataLength:gs(n,64),numAddressedTiles:gs(n,72),numTileEntries:gs(n,80),numTileContents:gs(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:s}}function xb(t){const s={buf:new Uint8Array(t),pos:0},n=Fa(s),r=[];let a=0;for(let l=0;l<n;l++){const i=Fa(s);r.push({tileId:a+i,offset:0,length:0,runLength:1}),a+=i}for(let l=0;l<n;l++)r[l].runLength=Fa(s);for(let l=0;l<n;l++)r[l].length=Fa(s);for(let l=0;l<n;l++){const i=Fa(s);i===0&&l>0?r[l].offset=r[l-1].offset+r[l-1].length:r[l].offset=i-1}return r}function _B(t){const s=new DataView(t);return s.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):s.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}class oa extends Error{}async function SB(t,s,n,r){const a=await t.getBytes(0,16384),l=new DataView(a.data);if(l.getUint16(0,!0)!==19792)throw new Error(`Wrong magic number for PMTiles archive got ${l.getUint16(0,!0)} not 19729`);if(_B(a.data)<3)return[await hb.getHeader(t)];const i=a.data.slice(0,jB);let c=a.etag;r&&a.etag!=r&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),c=void 0);const d=CB(i,c);if(n){const u=a.data.slice(d.rootDirectoryOffset,d.rootDirectoryOffset+d.rootDirectoryLength),p=t.getKey()+"|"+(d.etag||"")+"|"+d.rootDirectoryOffset+"|"+d.rootDirectoryLength,m=xb(await s(u,d.internalCompression));return[d,[p,m.length,m]]}return[d,void 0]}async function $B(t,s,n,r,a){const l=await t.getBytes(n,r);if(a.etag&&a.etag!==l.etag)throw new oa(l.etag);const i=await s(l.data,a.internalCompression),c=xb(i);if(c.length===0)throw new Error("Empty directory is invalid");return c}class EB{constructor(s=100,n=!0,r=gb){this.cache=new Map,this.maxCacheEntries=s,this.counter=1,this.prefetch=n,this.decompress=r}async getHeader(s,n){const r=s.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,await this.cache.get(r).data;const a=new Promise((l,i)=>{SB(s,this.decompress,this.prefetch,n).then(c=>{c[1]&&this.cache.set(c[1][0],{lastUsed:this.counter++,data:Promise.resolve(c[1][2])}),l(c[0]),this.prune()}).catch(c=>{i(c)})});return this.cache.set(r,{lastUsed:this.counter++,data:a}),a}async getDirectory(s,n,r,a){const l=s.getKey()+"|"+(a.etag||"")+"|"+n+"|"+r;if(this.cache.has(l))return this.cache.get(l).lastUsed=this.counter++,await this.cache.get(l).data;const i=new Promise((c,d)=>{$B(s,this.decompress,n,r,a).then(u=>{c(u),this.prune()}).catch(u=>{d(u)})});return this.cache.set(l,{lastUsed:this.counter++,data:i}),i}async getArrayBuffer(s,n,r,a){const l=s.getKey()+"|"+(a.etag||"")+"|"+n+"|"+r;if(this.cache.has(l))return this.cache.get(l).lastUsed=this.counter++,await this.cache.get(l).data;const i=new Promise((c,d)=>{s.getBytes(n,r).then(u=>{if(a.etag&&a.etag!==u.etag)throw new oa(u.etag);c(u.data),this.cache.has(l),this.prune()}).catch(u=>{d(u)})});return this.cache.set(l,{lastUsed:this.counter++,data:i}),i}prune(){if(this.cache.size>=this.maxCacheEntries){let s=1/0,n;this.cache.forEach((r,a)=>{r.lastUsed<s&&(s=r.lastUsed,n=a)}),n&&this.cache.delete(n)}}async invalidate(s,n){this.cache.delete(s.getKey()),await this.getHeader(s,n)}}class Wo{constructor(s,n,r){typeof s=="string"?this.source=new NB(s):this.source=s,r?this.decompress=r:this.decompress=gb,n?this.cache=n:this.cache=new EB}async getHeader(){return await this.cache.getHeader(this.source)}async getZxyAttempt(s,n,r,a){const l=vB(s,n,r),i=await this.cache.getHeader(this.source);if(i.specVersion<3)return hb.getZxy(i,this.source,this.cache,s,n,r,a);if(s<i.minZoom||s>i.maxZoom)return;let c=i.rootDirectoryOffset,d=i.rootDirectoryLength;for(let u=0;u<=3;u++){const p=await this.cache.getDirectory(this.source,c,d,i),m=wB(p,l);if(m)if(m.runLength>0){const h=await this.source.getBytes(i.tileDataOffset+m.offset,m.length,a);if(i.etag&&i.etag!==h.etag)throw new oa(h.etag);return{data:await this.decompress(h.data,i.tileCompression),cacheControl:h.cacheControl,expires:h.expires}}else c=i.leafDirectoryOffset+m.offset,d=m.length;else return}throw Error("Maximum directory depth exceeded")}async getZxy(s,n,r,a){try{return await this.getZxyAttempt(s,n,r,a)}catch(l){if(l instanceof oa)return this.cache.invalidate(this.source,l.message),await this.getZxyAttempt(s,n,r,a);throw l}}async getMetadataAttempt(){const s=await this.cache.getHeader(this.source),n=await this.source.getBytes(s.jsonMetadataOffset,s.jsonMetadataLength);if(s.etag&&s.etag!==n.etag)throw new oa(n.etag);const r=await this.decompress(n.data,s.internalCompression),a=new TextDecoder("utf-8");return JSON.parse(a.decode(r))}async getMetadata(){try{return await this.getMetadataAttempt()}catch(s){if(s instanceof oa)return this.cache.invalidate(this.source,s.message),await this.getMetadataAttempt();throw s}}}const bb={type:"pmtiles",protocolInit:t=>{const s=new fb;return t.addProtocol("pmtiles",s.tile),s},sourceInit:(t,s,n)=>{const r=new Wo(s.url);t.add(r)}};ds(7,"Reds");ds(12,"Set3");const Bm="_pin_outline",kB=[{name:"Streets",style:"https://api.maptiler.com/maps/streets-v2/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Light",style:"https://api.maptiler.com/maps/dataviz-light/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Dark",style:"https://api.maptiler.com/maps/dataviz-dark/style.json?key=mU28JQ6HchrQdneiq6k9"}],LB=t=>t==="http://localhost:3369"?"http://localhost:3370":t+"/tiles",Am=LB(Rt),IB=({views:t})=>{const{viewId:s,sourceId:n,page:r}=Ye(),a=$e(),{baseUrl:l}=w.useContext(ce);return e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"py-3.5 px-2 text-sm text-gray-400",children:"Version : "}),e.jsx("div",{className:"flex-1",children:e.jsx("select",{className:"pl-3 pr-4 py-2.5 border border-blue-100 bg-blue-50 w-full bg-white mr-2 flex items-center justify-between text-sm",value:s,onChange:i=>a(`${l}/source/${n}/${r}/${i.target.value}`),children:t.sort((i,c)=>c.view_id-i.view_id).map((i,c)=>e.jsx("option",{className:"ml-2  truncate",value:i.view_id,children:i.version?i.version:i.view_id},c))})})]})},TB=({source:t,filters:s,setFilters:n,activeViewId:r,layer:a,setTempSymbology:l})=>{const{pgEnv:i,falcor:c,falcorCache:d}=w.useContext(ce),u=w.useMemo(()=>{const _=C(t,["metadata","columns"],C(t,"metadata",[]));return Array.isArray(_)?_:[]},[t]),p=w.useMemo(()=>u.filter(_=>_.display==="data-variable").map(_=>_.name),[u]),m=w.useMemo(()=>u.filter(_=>_.display==="meta-variable").map(_=>_.name),[u]),h=w.useMemo(()=>[...p,...m],[p,m]),f=C(s,["activeVar","value"],""),g=p.includes(f)?"data-variable":"meta-variable";w.useEffect(()=>{c.get(["dama",i,"viewsbyId",r,"data","length"])},[c,i,r]);const[x,y]=w.useState(0);w.useEffect(()=>{const _=C(d,["dama",i,"viewsbyId",r,"data","length"],0);y(_)},[d,i,r]),w.useEffect(()=>{x&&h.length&&c.get(["dama",i,"viewsbyId",r,"databyIndex",{from:0,to:x-1},h])},[c,i,r,x,h]);const[j,N]=w.useState([]);return w.useEffect(()=>{(!f||f==="none")&&N([]);const _=C(d,["dama",i,"viewsbyId",r,"databyId"],{}),E=Object.keys(_).map(L=>{const S=C(_,[L,f],null);return{id:L,var:f,value:S==="null"?null:S}}).filter(L=>L.value!==null);N(E)},[d,i,r,f]),w.useEffect(()=>{if(!j.length)return;const _=JSON.parse(JSON.stringify(C(t,["metadata","symbology"],{}))),E={name:f,type:g==="data-variable"?"threshold":"ordinal",data:j};a.layers.map(({id:S,type:k})=>[S,`${k}-color`,f,"settings"]).forEach(S=>{if(C(_,S,null)){const[$,I,T]=S;_[$][I][T].settings.data=j}else{const[$,I,T]=S;_[$]=_[$]||{},_[$][I]=_[$][I]||{},_[$][I][T]=_[$][I][T]||{},_[$][I][T].settings=E}}),l(_)},[a,j,l,f,g,t]),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("div",{className:"py-3.5 px-2 text-sm text-gray-400",children:"Variable : "}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"pl-3 pr-4 py-2.5 border border-blue-100 bg-blue-50 w-full bg-white mr-2 flex items-center justify-between text-sm",value:f,onChange:_=>n({activeVar:{value:_.target.value}}),children:[e.jsx("option",{className:"ml-2  truncate",value:null,children:"none"}),h==null?void 0:h.map((_,E)=>e.jsx("option",{className:"ml-2  truncate",value:_,children:_},E))]})})]})},MB=({source:t,views:s,HoverComp:n,MapFilter:r=TB,filterData:a={},showViewSelector:l=!0,displayPinnedGeomBorder:i=!1,mapStyles:c})=>{const[d]=Vn(),u=d.get("variable"),{viewId:p}=Ye(),{pgEnv:m,baseUrl:h,user:f}=w.useContext(ce),[g,x]=w.useState(null),[y,j]=b.useState(a),N=w.useCallback(O=>{j(M=>({...M,...O}))},[]),_=u&&!p?u:p,E=w.useMemo(()=>{let O=(s||[]).filter(M=>M.view_id===+_);return C(O,"[0]",s[0])},[s,_]),L=b.useMemo(()=>{var M;let O=C(E,"metadata.tiles",{sources:[],layers:[]});return(M=O==null?void 0:O.sources)==null||M.forEach(D=>{var P;(P=D==null?void 0:D.source)!=null&&P.url&&(D.source.url=D.source.url.replace("$HOST",Am),D.source.url+="?cols=ogc_fid",D.source.url.includes(".pmtiles")&&(D.source.url=D.source.url.replace("https://","pmtiles://").replace("http://","pmtiles://")))}),O},[E]),S=b.useMemo(()=>{let O=C(E,"metadata",{tiles:{sources:[],layers:[]}});return C(O,"tiles.sources",[]).forEach(M=>{var D;(D=M==null?void 0:M.source)!=null&&D.url&&(M.source.url=M.source.url.replace("$HOST",Am))}),O},[E]),k=w.useMemo(()=>C(E,"view_id",null),[E]),[$,I]=w.useState(C(L,"symbology",{})),{sources:T,layers:A}=$,R=w.useMemo(()=>{var P,F,B,V,G;const O=T||C(L,"sources",[]),M=A||C(L,"layers",[]);if(O.length===0||M.length===0)return null;let D=C(t,["metadata","columns"],C(t,"metadata",[]))||[];if(D=Array.isArray(D)?D:[],i&&!M.find(Z=>Z.id.includes(Bm))){const Z=(P=M==null?void 0:M[0])==null?void 0:P.id,X={id:Z+Bm,type:"line",paint:{"line-color":"black","line-width":3,"line-opacity":0},"line-color":"black","line-opacity":0,"line-width":3,source:(F=M==null?void 0:M[0])==null?void 0:F.source,"source-layer":Z};M.push(X)}return console.log("sources",O),(G=(V=(B=O==null?void 0:O[0])==null?void 0:B.source)==null?void 0:V.tiles)!=null&&G[0]&&!O[0].source.tiles[0].includes("?")&&(O[0].source.tiles[0]=O[0].source.tiles[0]+"?cols=ogc_fid"),{name:t.name,pgEnv:m,source:t,activeView:E,filters:y,hoverComp:(n==null?void 0:n.Component)||!1,isPinnable:(n==null?void 0:n.isPinnable)||!1,attributes:D,activeViewId:k,sources:O,layers:M,symbology:C(L,"symbology",{})}},[t,s,L,k,y,T,A,i]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsx(r,{source:t,metaData:S,filters:y,setFilters:N,tempSymbology:$,setTempSymbology:I,activeView:E,activeViewId:k,layer:R}),l?e.jsx(IB,{views:s}):""]}),e.jsx("div",{className:"w-full h-[900px]",children:e.jsx(AB,{layers:[R],layer:R,source:t,tempSymbology:$,setTempSymbology:I,filters:y,mapStyles:c},p)}),f.authLevel>=5?e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:["sources","layers"].map((O,M)=>{let D=JSON.stringify(C(R,O,[]),null,3);return e.jsxs("div",{className:"flex justify-between group",children:[e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-5 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 py-5",children:O}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-4",children:g===O?e.jsx("div",{className:"pt-3 pr-8",children:e.jsx(OB,{startValue:D,attr:O,viewId:k,parentData:C(E,"metadata",{tiles:{}}),cancel:()=>x(null)})}):e.jsx("div",{className:"py-3 pl-2 pr-8",children:e.jsx("pre",{className:"bg-gray-100 tracking-tighter overflow-auto scrollbar-xs",children:D})})})]}),e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:P=>x(g===O?null:O),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12 mt-3 p-2.5 rounded hover:bg-blue-500 hover:text-white "})})]},M)})})}):""]})},BB={type:"pmtiles",protocolInit:t=>{const s=new fb;return t.addProtocol("pmtiles",s.tile),s},sourceInit:(t,s,n)=>{const r=new Wo(s.url);t.add(r)}},AB=({layers:t,layer:s,tempSymbology:n,setTempSymbology:r,source:a,filters:l,mapStyles:i})=>{const[c,d]=w.useState(!1);w.useEffect(()=>(d(!0),()=>d(!1)),[]),w.useContext(ce);const[u,p]=w.useState([]);w.useEffect(()=>{c&&p(x=>{var N;let y=(N=x==null?void 0:x.map(_=>_.activeViewId))==null?void 0:N.filter(Boolean),j=t==null?void 0:t.filter(Boolean).filter(_=>!y.includes(_.activeViewId)).map(_=>oB(_));return[...x==null?void 0:x.filter(_=>y.includes(_.activeViewId)),...j]})},[c,t]);const m=C(l,["activeVar","value"],""),h=w.useMemo(()=>i&&(i==null?void 0:i.length)>0?i:kB,[i]),f=w.useCallback(x=>{if(!m||m==="none")return;const y=s.layers.map(({id:N,type:_})=>[N,`${_}-color`,m]),j=JSON.parse(JSON.stringify(n));y.forEach(([N,_,E])=>{j[N][_][E].settings={...n[N][_][E].settings,...x}}),r(j)},[n,r,s,m]),g=w.useMemo(()=>{let x=t.filter(Boolean).map(y=>y.activeViewId);return u.reduce((y,j)=>{const N=x.indexOf(j.activeViewId);return N!==-1&&(y[j.id]=Ie(t[N]),y[j.id].symbology=Ie(n),y[j.id].updateLegend=f,y[j.id].sourceId=a.source_id,y[j.id].filters=l),y},{})},[t,u,n,f,a.source_id,l]);return e.jsx("div",{className:"w-full h-full",children:e.jsx(yT,{theme:cB,children:e.jsx(md,{mapOptions:{protocols:[BB],zoom:7.3,navigationControl:!1,center:[-73.8,40.79],styles:h},layers:u,layerProps:g,leftSidebar:!1,rightSidebar:!1,mapActions:["navigation-controls"]})})})},OB=({startValue:t,attr:s,viewId:n,parentData:r,cancel:a=()=>{}})=>{const[l,i]=b.useState(""),{pgEnv:c,baseUrl:d,falcor:u}=w.useContext(ce),p=b.useRef(null);b.useEffect(()=>{i(t),p.current.focus()},[t]),b.useEffect(()=>{p.current.style.height="inherit",p.current.style.height=`${p.current.scrollHeight}px`},[l]);const m=async(h,f)=>{console.log("click save 222",h,f,r);let g=JSON.parse(f),x=r||{tiles:{}};if(x.tiles||(x.tiles={}),x.tiles[h]=g,n)try{let y=await u.set({paths:[["dama",c,"views","byId",n,"attributes","metadata"]],jsonGraph:{dama:{[c]:{views:{byId:{[n]:{attributes:{metadata:JSON.stringify(x)}}}}}}}});console.log("set run response",y),a()}catch(y){console.log("error stuff",y,f,r)}};return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"w-full flex",children:e.jsx("textarea",{ref:p,className:"flex-1 px-2 shadow text-base bg-blue-100 focus:ring-blue-700 focus:border-blue-500  border-gray-300 rounded-none rounded-l-md",value:l,onChange:h=>i(h.target.value)})}),e.jsxs("div",{children:[e.jsx(We,{themeOptions:{size:"sm",color:"primary"},onClick:h=>m(s,l),children:" Save "}),e.jsx(We,{themeOptions:{size:"sm",color:"cancel"},onClick:h=>a(),children:" Cancel "})]})]})};function PB(t,s){if(s.type==="update")return{...t,...s.payload};if(s.type==="update_dbColName"){const{rowIdx:n,colName:r}=s.payload,{tableDescriptor:a}=t,l=C(a,["columnTypes",n,"col"]);if(console.log("update_dbColName",s.payload),l===r)return t;const i=Ie(a);return i.columnTypes=a.columnTypes.slice(),i.columnTypes[n]={...i.columnTypes[n],col:r},{...t,tableDescriptor:i}}return t}function DB({progress:t}){const s={display:"inline-block",height:"100%",width:"100%",backgroundColor:"whitesmoke",borderRadius:40,margin:50},n={display:"inline-block",height:"84%",width:`${t}%`,backgroundColor:"#3b82f680",borderRadius:40,textAlign:"right"},r={padding:10,color:"black",fontWeight:900};return e.jsxs("div",{style:s,children:[e.jsxs("span",{style:{fontWeight:"bold",paddingLeft:"10px",paddingRight:"10px"},children:[" ","Sent:"]}),e.jsx("div",{style:n,children:e.jsx("span",{style:r,children:`${t}%`})})]})}function RB({fileUploadStatus:t}){let s;if(!t)s=e.jsx("td",{className:"py-4 text-center",children:"Sending GIS File to server"});else{const{type:n,payload:r}=t;/GIS_FILE_UPLOAD_PROGRESS$/.test(n)?s=e.jsx(DB,{progress:r==null?void 0:r.data}):/GIS_FILE_RECEIVED$/.test(n)?s=e.jsx("td",{className:"py-4 text-center",children:"File Received"}):/START_GIS_FILE_UPLOAD_ANALYSIS$/.test(n)?s=e.jsx("td",{className:"py-4 text-center",children:"Server Analyzing the GIS File"}):/FINISH_GIS_FILE_UPLOAD$/.test(n)?s=e.jsx("td",{className:"py-4 text-center",children:"GIS File Analysis Complete"}):s=e.jsx("td",{className:"py-4 text-center",children:"Processing"})}return e.jsxs("tr",{children:[e.jsx("td",{className:"py-4 text-left",children:"File Upload Status"}),s]})}function FB({uploadedFile:t,fileUploadStatus:s}){return t?e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:e.jsx("span",{children:"File Metadata"})}),e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-4 text-left",children:"Name"}),e.jsx("td",{className:"text-center  p-2",children:t.name})]},"uploaded-file-meta--name"),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-4 text-left",children:"Last Modified"}),e.jsx("td",{className:"text-center  p-2",children:C(t,"lastModifiedDate","").toLocaleString()})]},"uploaded-file-meta--last-mod-ts"),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-4 text-left",children:"Size"}),e.jsx("td",{className:"text-center  p-2",children:Xy(t.size)})]},"uploaded-file-meta--size"),e.jsx(RB,{fileUploadStatus:s})]})})]}):""}function VB({etlContextId:t,uploadErrMsg:s}){return e.jsxs("table",{className:"w-2/3 mx-auto text-center",style:{margin:"40px auto",textAlign:"center",border:"1px solid",borderColor:"back"},children:[e.jsx("thead",{style:{color:"black",backgroundColor:"red",fontWeight:"bolder",textAlign:"center",marginTop:"40px",fontSize:"20px",border:"1px solid",borderColor:"black"},children:e.jsxs("tr",{children:[e.jsxs("th",{style:{border:"1px solid",borderColor:"black"},children:[" ","GIS Dataset Upload Error"]}),e.jsxs("th",{style:{border:"1px solid",borderColor:"black"},children:[" ","ETL Context ID"]})]})}),e.jsx("tbody",{style:{border:"1px solid"},children:e.jsxs("tr",{style:{border:"1px solid"},children:[e.jsx("td",{style:{border:"1px solid",padding:"10px",backgroundColor:"white",color:"darkred"},children:s}),e.jsx("td",{style:{border:"1px solid",backgroundColor:"white"},children:t})]})})]})}function HB({state:t,dispatch:s}){const{etlContextId:n,userId:r,email:a,damaServerPath:l,polling:i,pollingInterval:c,uploadErrMsg:d,uploadedFile:u,fileUploadStatus:p}=t,m=async h=>{try{const f=new FormData;f.append("etlContextId",n),f.append("user_id",r),f.append("email",a),f.append("fileSizeBytes",h.size),f.append("file",h),s({type:"update",payload:{polling:!0,uploadedFile:h}}),console.log("sending upload");const g=await fetch(`${l}/gis-dataset/upload`,{method:"POST",body:f});console.log("sending upload finished ");const x=await g.json();if(Array.isArray(x)){const[{id:y}]=x;s({type:"update",payload:{polling:!1,gisUploadId:y}})}else throw x}catch(f){s({type:"update",payload:{polling:!1,uploadErrMsg:f==null?void 0:f.message,uploadedFile:null}})}};return b.useEffect(()=>{const h=async()=>{const f=`${l}/events/query?etl_context_id=${n}&event_id=-1`,x=await(await fetch(f)).json();s({type:"update",payload:{fileUploadStatus:x[x.length-1]}})};if(i&&!c){let f=setInterval(h,3e3);s({type:"update",payload:{pollingInterval:f}})}else c&&!i&&(clearInterval(c),h(),s({type:"update",payload:{pollingInterval:null}}))},[i,c,l,n,s]),n?u?e.jsx(FB,{uploadedFile:u,fileUploadStatus:p}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full border border-dashed border-gray-300 bg-gray-100",children:e.jsx("div",{className:"p-4",children:e.jsx("button",{children:e.jsx("input",{type:"file",onChange:h=>m(h.target.files[0])})})})}),d?e.jsx(VB,{etlContextId:n,uploadErrMsg:d}):""]}):"no context Id no upload"}const zB=({state:t})=>{const{etlContextId:s,layerName:n,lyrAnlysErrMsg:r,layerAnalysis:a}=t;if(!n)return"";if(r)return e.jsx(UB,{etlContextId:s,errorMsg:r});if(!a)return e.jsx("div",{children:"Analyzing Layer... please wait."});const{layerGeometriesAnalysis:l}=a,{countsByPostGisType:i={}}=l,c=Object.keys(i).sort((d,u)=>i[u]-i[d]);return e.jsxs("div",{children:[e.jsx("span",{className:"py-4 font-bold",children:" Layer Analysis "}),e.jsx("div",{className:"w-full",children:e.jsx("div",{style:{width:"50%",margin:"10px auto"},children:e.jsxs("table",{className:"pt-10 mx-auto border",children:[e.jsx("thead",{style:{backgroundColor:"black",color:"white"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",style:{padding:"10px",borderRight:"1px solid white"},children:"Geometry Type"}),e.jsx("th",{className:"text-center",style:{padding:"10px"},children:"Feature Count"})]})}),e.jsx("tbody",{children:c.map((d,u)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-4 text-center",style:{padding:"10px",border:"1px solid"},children:d}),e.jsx("td",{className:"text-center  p-2",style:{padding:"10px",border:"1px solid"},children:i[d]})]},u))})]})})})]})},UB=({etlContextId:t,errorMsg:s})=>e.jsxs("table",{className:"w-2/3 mx-auto mt-10 text-center border border-gray-300",children:[e.jsx("thead",{className:"bg-red-500 font-bold text-lg",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Layer Analysis Error"}),e.jsx("th",{children:"ETL Context ID"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-red-800 p-4",children:s}),e.jsx("td",{children:t})]})})]});function WB({state:t,dispatch:s}){const{damaServerPath:n,gisUploadId:r,uploadedFile:a,layerNames:l,layerName:i}=t;return b.useEffect(()=>{if(r&&a)try{(async d=>{const u=`${n}/gis-dataset/${d}/layerNames`,m=await(await fetch(u)).json();s({type:"update",payload:{layerNames:m,layerName:m[0]}})})(r)}catch(c){s({type:"update",payload:{lyrAnlysErrMsg:c.message}})}},[r,a,n,s]),b.useEffect(()=>{if(r&&i)try{(async(d,u)=>{const m=await(await fetch(`${n}/gis-dataset/${d}/${u}/layerAnalysis`)).json();s({type:"update",payload:{layerAnalysis:m}})})(r,i)}catch(c){s({type:"update",payload:{lyrAnlysErrMsg:c.message}})}},[r,i,n,s]),l?e.jsxs("div",{className:"border-t border-gray-200 w-full",children:[e.jsx("table",{className:"w-full ",children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"py-4 text-left",children:"Select Layer"}),e.jsx("td",{className:"py-4 text-center",children:e.jsx("select",{className:"text-center w-1/2 bg-white p-2 shadow bg-grey-50 focus:bg-blue-100 border-gray-300",value:i||"",onChange:c=>s({type:"update",payload:{layerName:c.target.value}}),children:["",...l].map(c=>e.jsx("option",{value:c,children:c},c))})})]})})}),e.jsx(zB,{state:t})]}):""}const GB=({publishStatus:t,field:s,col:n,onChange:r})=>e.jsx("input",{className:"w-full p-2 flex-1 shadow bg-grey-50 focus:bg-blue-100 border-gray-300",disabled:t!=="AWAITING",id:s,defaultValue:n||"",onChange:r}),JB=({publishStatus:t,field:s,col:n,availableDbColNames:r,onChange:a})=>{if(!r)return"";const l=n&&r.includes(n),i=`col-names-dropdown-for-${s}`,c=r.filter(Boolean).length>0;return r.length?l&&r.length===1?e.jsx("span",{className:"text-center",children:n}):e.jsxs("select",{className:"w-full p-2 flex-1 shadow bg-grey-50 focus:bg-blue-100 border-gray-300",onChange:d=>a(d.target.value),value:l?n:"",placeholder:"Select the db column name",disabled:!c||t!=="AWAITING",children:[e.jsx("option",{children:"Choose db column "}),r.map((d,u)=>e.jsx("option",{value:d,children:d},u))]},i):e.jsx("span",{style:{color:"darkgray"},children:"All table columns have been assigned."})},qB=({state:t,dispatch:s})=>{const{layerName:n,tableDescriptor:r,publishStatus:a,databaseColumnNames:l,mbtilesOptions:i}=t,[c,d]=b.useState(null),[u,p]=b.useState(null),[m,h]=b.useState(null),[f,g]=b.useState(!0),[x,y]=b.useState(!0),j=r&&r.columnTypes,N=j&&j.reduce(($,{key:I,col:T})=>($[I]=T||null,$),{});if(b.useEffect(()=>{m===null&&N&&h(N)},[m,N]),b.useEffect(()=>{N&&!c&&d(Tr(N,$=>$===null))},[N,c]),b.useEffect(()=>{if(N&&!u){const $=j.reduce((I,{key:T,col:A})=>(I[A]=T||null,I),{});p(Tr($,I=>I===null))}},[N,u]),!n)return"";if(!N)return e.jsxs("span",{className:"w-full p-10 text-center",children:["Please wait... the server is analyzing the ",n," layer. This may take a few moments."]});if(!c)return null;const _=l&&l.length>0?JB:GB,E=new Set(Object.values(N).filter(Boolean).filter($=>l&&l.includes($))),L=$=>{d(Tr(c,()=>$.target.checked)),g(!$.target.checked)},S=$=>{const I=Tr(u,()=>$.target.checked);p(I),y(!$.target.checked),s({type:"update",payload:{mbtilesOptions:{...i,preserveColumns:I}}})},k=l&&l.length>0&&l.filter($=>!E.has($)).filter(Boolean);return e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-bold",children:"Field Names Mappings"}),e.jsx("div",{children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",style:{paddingRight:"40px"},children:"Upload File Columns"}),e.jsx("th",{className:"text-center",children:"Database Column Name"}),e.jsxs("th",{className:"text-center",children:["Omit",e.jsx("input",{className:"ml-2",type:"checkbox",checked:!f,onChange:L})]}),e.jsxs("th",{className:"text-center",children:["Mbtile",e.jsx("input",{className:"ml-2",type:"checkbox",checked:!x,onChange:S})]})]})}),e.jsx("tbody",{children:j.map(({key:$,col:I},T)=>{let A;Array.isArray(k)&&(A=E.has(I)?[I,...k]:k);const R=c[$]?e.jsx("span",{}):e.jsx(_,{availableDbColNames:A,publishStatus:a,field:$,col:I,onChange:O=>{const M=O.target?O.target.value:O;s({type:"update_dbColName",payload:{rowIdx:T,colName:M}})}});return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-4 text-left",children:$}),e.jsx("td",{className:"text-center  p-2",children:R}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:c[$],disabled:A&&A.length===0,onChange:()=>{const O={...c,[$]:!c[$]};d(O);const M=Object.values(O).some(D=>D===!1);g(M),I?s({type:"update_dbColName",payload:{rowIdx:T,colName:""}}):A||s({type:"update_dbColName",payload:{rowIdx:T,colName:m[$]}})}})}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:u[I],disabled:A&&A.length===0,onChange:()=>{const O={...u,[I]:!u[I]};p(O);const M=Object.values(O).some(D=>D===!1);y(M),s({type:"update",payload:{mbtilesOptions:{...i,preserveColumns:O}}})}})})]},$)})})]})})]})};function KB({state:t,dispatch:s}){const{damaSourceId:n,damaServerPath:r,databaseColumnNames:a,gisUploadId:l,layerName:i}=t;return b.useEffect(()=>{(async()=>{if(n&&!a||!l||!i)return;const d=await(await fetch(`${r}/staged-geospatial-dataset/${l}/${i}/tableDescriptor`)).json();if(n){const u=new Set(a);for(const p of d.columnTypes)u.has(p.col)||(p.col="")}return s({type:"update",payload:{tableDescriptor:d}})})()},[n,a,l,i,r,s]),n&&!a?"":e.jsx(qB,{state:t,dispatch:s})}const Om={AWAITING:{text:"Publish",color:"bg-blue-500"},IN_PROGRESS:{text:"Publishing...",color:"bg-amber-500"},PUBLISHED:{text:"Publishing...",color:"bg-amber-500"},ERROR:{text:"Error...",color:"bg-red-500"}};function YB({state:t,dispatch:s}){const{layerName:n,publishStatus:r,uploadErrMsg:a,lyrAnlysErrMsg:l,tableDescriptor:i,damaSourceName:c,damaSourceId:d,damaServerPath:u,etlContextId:p,gisUploadId:m,userId:h,email:f,customViewAttributes:g,sourceType:x,mbtilesOptions:y}=t,{text:j,color:N}=b.useMemo(()=>C(Om,r,Om.AWAITING),[r]);if(!n||a||l||!i)return"";const _=()=>{(async()=>{try{s({type:"update",payload:{publishStatus:"IN_PROGRESS"}}),y&&(y!=null&&y.preserveColumns)&&(Object.keys((y==null?void 0:y.preserveColumns)||{})||[]).length?y.preserveColumns=(Object.keys((y==null?void 0:y.preserveColumns)||{})||[]).filter(T=>(y==null?void 0:y.preserveColumns[T])===!0):y.preserveColumns=[];const L={source_id:d||null,source_values:{name:c,type:x||"gis_dataset"},parent_context_id:p,user_id:h,email:f,tableDescriptor:i,gisUploadId:m,layerName:n,etlContextId:p,customViewAttributes:g,mbtilesOptions:y},k=await(await fetch(`${t.damaServerPath}/gis-dataset/publish`,{method:"POST",body:JSON.stringify(L),headers:{"Content-Type":"application/json"}})).json();console.log("publishFinalEvent",k);const{etl_context_id:$,source_id:I}=k;s({type:"update",payload:{publishStatus:"PUBLISHED",damaSourceId:I,etlContextId:$}})}catch(L){s({type:"update",payload:{publishStatus:"ERROR",publishErrMsg:L.message}}),console.error("==>",L)}})()};return e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("button",{className:`cursor-pointer py-4 px-8 ${N} border-none`,onClick:()=>{console.log("onClick publush",r),(r==="AWAITING"||r==="ERROR")&&_()},children:j})}),e.jsx(ZB,{state:t})]})}function ZB({state:t}){const{etlContextId:s,publishStatus:n,publishErrMsg:r}=t;return n!=="ERROR"?"":e.jsxs("table",{className:"w-2/3",style:{margin:"40px auto",textAlign:"center",border:"1px solid",borderColor:"back"},children:[e.jsx("thead",{style:{color:"black",backgroundColor:"red",fontWeight:"bolder",textAlign:"center",marginTop:"40px",fontSize:"20px",border:"1px solid",borderColor:"black"},children:e.jsxs("tr",{children:[e.jsxs("th",{style:{border:"1px solid",borderColor:"black"},children:[" ","Publish Error"]}),e.jsxs("th",{style:{border:"1px solid",borderColor:"black"},children:[" ","ETL Context ID"]})]})}),e.jsx("tbody",{style:{border:"1px solid"},children:e.jsxs("tr",{style:{border:"1px solid"},children:[e.jsx("td",{style:{border:"1px solid",padding:"10px",backgroundColor:"white",color:"darkred"},children:r}),e.jsx("td",{style:{border:"1px solid",backgroundColor:"white"},children:s})]})})]})}const XB=()=>e.jsx(e.Fragment,{});function yb({source:t={},user:s={},dataType:n="gis_dataset",CustomAttributes:r=XB,tippecanoeOptions:a={},customRules:l={},databaseColumnNames:i=null}){var N,_;const{name:c,source_id:d,type:u}=t,{pgEnv:p,baseUrl:m,falcor:h,user:f}=w.useContext(ce),g=$e(),[x,y]=b.useReducer(PB,{damaSourceId:d,databaseColumnNames:i||(((N=t==null?void 0:t.metadata)==null?void 0:N.columns)||(t==null?void 0:t.metadata)||[]).map(E=>E.name),damaSourceName:c,userId:(s==null?void 0:s.id)??f.id,email:(s==null?void 0:s.email)??f.email,etlContextId:null,customViewAttributes:{years:[]},dataType:n,damaServerPath:`${Rt}/dama-admin/${p}`,gisUploadId:null,fileUploadStatus:null,uploadedFile:null,uploadErrMsg:null,polling:!1,pollingInterval:null,layerNames:null,layerName:null,lyrAnlysErrMsg:null,layerAnalysis:null,tableDescriptor:null,mbtilesOptions:{preserveColumns:{},...a},publishStatus:"AWAITING",publishErrMsg:null,sourceType:u});if(b.useEffect(()=>{y({type:"update",payload:{damaSourceName:c}})},[c]),b.useEffect(()=>{y({type:"update",payload:{sourceType:u}})},[u]),b.useEffect(()=>{x.publishStatus==="PUBLISHED"&&(x.damaSourceId&&x.etlContextId?h.invalidate(["dama",p,"sources","byId",x.damaSourceId,"views","length"]):h.invalidate(["dama",p,"sources","length"]),console.log("publish done",x,x.damaSourceId),g(`${m}/source/${x.damaSourceId}/uploads/${x.etlContextId}`))},[x.publishStatus,x.damaSourceId,p,g]),b.useEffect(()=>{async function E(){const S=+await(await fetch(`${x.damaServerPath}/etl/new-context-id`)).text();y({type:"update",payload:{etlContextId:S}})}E()},[p,x.damaServerPath]),!d&&!c)return e.jsx("div",{children:" Please enter a datasource name."});const j=(_=Object.keys(l))==null?void 0:_.reduce((E,L)=>(l[L](x)!=="canUpload"&&(E=l[L](x)),E),"canUpload");return e.jsxs("div",{children:[e.jsx(r,{state:x,dispatch:y}),j==="canUpload"?e.jsx(HB,{state:x,dispatch:y}):j,e.jsx(WB,{state:x,dispatch:y}),e.jsx(KB,{state:x,dispatch:y}),e.jsx(YB,{state:x,dispatch:y})]})}const QB=({views:t})=>{const{viewId:s,sourceId:n,page:r}=Ye(),[a]=Vn(),l=a.get("variable"),i=$e(),{baseUrl:c}=w.useContext(ce),d=l&&!s?l:s;return e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"py-3.5 px-2 text-sm text-gray-400",children:"Version:"}),e.jsx("div",{className:"flex-1",children:e.jsx("select",{className:"pl-3 pr-4 py-2.5 border border-blue-100 bg-blue-50 w-full bg-white mr-2 flex items-center justify-between text-sm",value:d,onChange:u=>i(`${c}/source/${n}/${r}/${u.target.value}`),children:t==null?void 0:t.sort((u,p)=>p.view_id-u.view_id).map((u,p)=>e.jsx("option",{className:"ml-2  truncate",value:u.view_id,children:u.version?u.version:u.view_id},p))})})]})},eA=()=>e.jsx("div",{}),tA=(t,s)=>({data:t,columns:s==null?void 0:s.map(n=>({Header:n,accessor:n}))}),vb=({source:t,views:s,transform:n=tA,filterData:r={},TableFilter:a=eA,showViewSelector:l=!0,fullWidth:i=!1,striped:c=!1})=>{const{viewId:d}=Ye(),[u,p]=b.useState(r),m=w.useCallback(R=>{p(O=>({...O,...R}))},[]),{pgEnv:h,falcor:f,falcorCache:g,user:x}=w.useContext(ce),y=w.useMemo(()=>C(s==null?void 0:s.filter(R=>R.view_id===parseInt(d)),"[0]",s[0]),[s,d]),j=w.useMemo(()=>C(y,"view_id",null),[y]);w.useEffect(()=>{console.time("getviewLength"),f.get(["dama",h,"viewsbyId",j,"data","length"]).then(R=>{console.timeEnd("getviewLength")})},[h,j]);const N=w.useMemo(()=>C(g,["dama",h,"viewsbyId",j,"data","length"],"No Length"),[h,j,g]),_=w.useMemo(()=>{let R=C(t,["metadata","columns"],C(t,"metadata",[]));return Array.isArray(R)||(R=[]),R.filter(O=>["integer","string","number"].includes(O.type)).map(O=>O.name)},[t]);w.useEffect(()=>{if(N>0){console.log("dataLength",N);let R=Math.min(N,1e4);console.time("getViewData",R),f.chunk(["dama",h,"viewsbyId",j,"databyIndex",Array.from(Array(R-1).keys()),_]).then(O=>{console.timeEnd("getViewData",R)})}},[h,j,N,_]);const E=w.useMemo(()=>Object.values(C(g,["dama",h,"viewsbyId",j,"databyIndex"],[])).map(O=>C(g,O.value,{})),[h,j,g,N]);let L=C(y,["metadata","years"],[]);const{data:S,columns:k}=w.useMemo(()=>n(E,_,u,L,t),[E,_,n,u,L,t]),[$,I]=w.useMemo(()=>{var O;const R=(O=k.filter(M=>M.sortBy))==null?void 0:O[0];return console.log("the col",R),[(R==null?void 0:R.accessor)||"",(R==null?void 0:R.sortBy)||"asc"]},[k]);console.log("sort",$,k);const[T,A]=w.useMemo(()=>i?[{width:"96vw",position:"relative",left:"calc(-50vw + 50%)"},"mt-2 mx-12"]:[{},"max-w-6xl"],[i]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsx(a,{filters:u,setFilters:m,source:t,data:E,columns:k}),l?e.jsx(QB,{views:s}):""]}),e.jsx("div",{className:A,style:T,children:e.jsx(St,{striped:c,data:S,columns:k,sortBy:$,sortOrder:I,pageSize:50})})]})},sA={map:{name:"Map",path:"/map",component:MB},table:{name:"Table",path:"/table",component:vb},sourceCreate:{name:"Create",component:yb}},nA={table:{name:"Table",path:"/table",component:vb},sourceCreate:{name:"Create",component:yb}};function aA(t,s){return s.type==="update"?{...t,...s.payload}:t}const rA=async(t,s,n)=>{console.log("called"),t.setLoading(!0);const r={source_id:(t==null?void 0:t.source_id)||null,user_id:t==null?void 0:t.user_id,name:t==null?void 0:t.name,type:(t==null?void 0:t.type)||"npmrds",pgEnv:n};try{const l=await(await fetch(`${Rt}/dama-admin/${n}/npmrds/publish`,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}})).json();console.log("publishFinalEvent: ",l);const{source_id:i}=l;console.log(i),t.setLoading(!1),i&&s(`/datasources/source/${i}`)}catch(a){t.setLoading(!1),console.log("error : ",a)}};function oA(t){const s=$e(),{loading:n,setLoading:r,...a}=t,l=b.useCallback(()=>{rA({...a,setLoading:r},s,"npmrds")},[a,s,r]);return e.jsx("button",{className:"cursor-pointer bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:l,children:n?e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{className:"mr-2",children:"Publishing"}),e.jsx(go,{scale:.25,color:"#fefefe"})]}):"New Publish"})}const lA=()=>e.jsx(e.Fragment,{});function iA({source:t={},user:s={},dataType:n="npmrds",CustomAttributes:r=lA}){const{name:a,source_id:l,type:i}=t,{baseUrl:c,user:d}=b.useContext(ce),[u,p]=b.useState(!1),[m,h]=b.useReducer(aA,{damaSourceId:l,damaSourceName:a,userId:(s==null?void 0:s.id)??d.id,email:(s==null?void 0:s.email)??d.email,etlContextId:null,dataType:n,damaServerPath:`${Rt}/dama-admin/npmrds`,sourceType:i});return b.useEffect(()=>{h({type:"update",payload:{damaSourceName:a}})},[a]),b.useEffect(()=>{h({type:"update",payload:{sourceType:i}})},[i]),!l&&!a?e.jsx("div",{children:" Please enter a datasource name."}):e.jsx("div",{className:"w-full max-w-lg my-4",children:e.jsx("div",{className:"md:flex md:items-center",children:e.jsx(oA,{loading:u,setLoading:p,source_id:l,user_id:(s==null?void 0:s.id)??d.id,name:t==null?void 0:t.name,type:t==null?void 0:t.type})})})}const cA=({options:t,onChange:s,value:n})=>{function r(i){return!!(n||[]).find(c=>(c==null?void 0:c.value)===(i==null?void 0:i.value))}function a(i){((n||[]).filter(d=>(d==null?void 0:d.value)===(i==null?void 0:i.value))||[]).length>0?l(i):s(d=>[...d,i])}function l(i){const c=(n||[]).filter(d=>(d==null?void 0:d.value)!==(i==null?void 0:i.value));s(c)}return e.jsx("div",{className:"flex items-center justify-center",style:{minWidth:"479px"},children:e.jsx("div",{className:"w-full max-w-xl mx-auto",children:e.jsx(Qy,{as:"div",className:"space-y-1",value:n,onChange:a,children:({open:i})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"inline-block w-full rounded-md shadow-sm",children:e.jsxs(e1,{className:"cursor-default relative w-full rounded-md border border-gray-300 bg-white pl-3 pr-10 py-2 text-left focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition ease-in-out duration-150 sm:text-sm sm:leading-5",children:[!(n||[]).length&&"Select npmrds from list",(n||[]).map(c=>e.jsxs("div",{className:"inline-flex items-center px-1 mr-1 mt-1 rounded text-white bg-blue-400 p-2",children:[c==null?void 0:c.label,e.jsx("div",{className:"ml-1 bg-blue-100 rounded-full cursor-pointer",onClick:()=>l(c),children:e.jsx("svg",{width:"13",height:"13",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.29289 4.29289C4.68342 3.90237 5.31658 3.90237 5.70711 4.29289L10 8.58579L14.2929 4.29289C14.6834 3.90237 15.3166 3.90237 15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L11.4142 10L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L10 11.4142L5.70711 15.7071C5.31658 16.0976 4.68342 16.0976 4.29289 15.7071C3.90237 15.3166 3.90237 14.6834 4.29289 14.2929L8.58579 10L4.29289 5.70711C3.90237 5.31658 3.90237 4.68342 4.29289 4.29289Z",fill:"#4A5568"})})})]},c==null?void 0:c.value)),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M7 7l3-3 3 3m0 6l-3 3-3-3",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]})}),e.jsx(Be,{show:i,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute mt-1 w-full rounded-md bg-white shadow-lg",children:e.jsx(t1,{static:!0,className:"max-h-60 rounded-md py-1 text-base leading-6 shadow-xs overflow-auto focus:outline-none sm:text-sm sm:leading-5",children:(t||[]).map(c=>{const d=r(c);return e.jsx(s1,{value:c,children:({active:u})=>e.jsxs("div",{className:`${u?"text-white bg-blue-600":"text-black-900"} cursor-default select-none relative py-2 pl-8 pr-4`,children:[e.jsx("span",{className:`${d?"font-semibold":"font-normal"} block truncate`,children:c==null?void 0:c.label}),d&&e.jsx("span",{className:`${u?"text-white":"text-blue-600"} absolute inset-y-0 left-0 flex items-center pl-1.5`,children:e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},c==null?void 0:c.value)})})})]})})})})})},dA=t=>{if(t.length===1)return{msgString:null,isValidDateRage:!0};t.sort((r,a)=>Mr(r.start_date).diff(Mr(a.start_date)));let s=!0,n=!1;for(let r=1;r<t.length;r++){const a=Mr(t[r-1].end_date),l=Mr(t[r].start_date);l.isBefore(a)&&(n=!0),l.isSame(a.clone().add(1,"days"))||(s=!1)}return s&&!n?{msgString:null,isValidDateRage:!0}:!s&&!n?{msgString:"Dates are not continuous",isValidDateRage:!1}:!s&&n?{msgString:"Dates are not continuous and they are overlapped",isValidDateRage:!1}:s&&n?{msgString:"Dates are continuous but they are overlapped",isValidDateRage:!1}:{msgString:"Invalid date ranges",isValidDateRage:!1}},Pm=t=>{if(t.length===0)return{};let s=new Date(t[0].start_date),n=new Date(t[0].end_date);for(const{start_date:r,end_date:a}of t){const l=new Date(r),i=new Date(a);l<s&&(s=l),i>n&&(n=i)}return{startDate:s.toISOString().split("T")[0],endDate:n.toISOString().split("T")[0]}},uA={source_id:"source_id",name:"name",display_name:"display_name",type:"type",update_interval:"update_interval",category:"category",categories:"categories",description:"description",statistics:"statistics",metadata:"metadata"},mA={view_id:"view_id",source_id:"source_id",data_type:"data_type",interval_version:"interval_version",geography_version:"geography_version",version:"version",source_url:"source_url",publisher:"publisher",table_schema:"table_schema",table_name:"table_name",data_table:"data_table",download_url:"download_url",tiles_url:"tiles_url",start_date:"start_date",end_date:"end_date",last_updated:"last_updated",statistics:"statistics",metadata:"metadata",user_id:"user_id",etl_context_id:"etl_context_id",view_dependencies:"view_dependencies",_created_timestamp:"_created_timestamp",_modified_timestamp:"_modified_timestamp"},Dm=t=>Object.entries(t||{}).reduce((s,[n,r])=>(s[n]=r.value!==void 0?r.value:r,s),{});function pA({source:t,views:s,activeViewId:n,...r}){const{user:a,pgEnv:l}=b.useContext(ce),{falcor:i,falcorCache:c}=Na(),d=$e(),[u,p]=w.useState(!1),[m,h]=w.useState(!1),[f,g]=w.useState([]),[x,y]=w.useState(null),[j,N]=w.useState(null),[_,E]=w.useState(!1);b.useEffect(()=>{(async()=>{const V=["dama","npmrds","sources","length"],G=await i.get(V);await i.get(["dama","npmrds","sources","byIndex",{from:0,to:Is.get(G.json,V,0)-1},"attributes",Object.values(uA)])})()},[i]);const L=b.useMemo(()=>Object.values(Is.get(c,["dama","npmrds","sources","byIndex"],{})).map(B=>Dm(Is.get(c,B.value,{attributes:{}}).attributes)).filter(B=>(B==null?void 0:B.type)==="npmrds_raw").map(B=>B.source_id),[c]);b.useEffect(()=>{(async()=>{const V=["dama","npmrds","sources","byId",L,"views","length"],G=await i.get(V),Z=L.map(X=>["dama","npmrds","sources","byId",X,"views","byIndex",{from:0,to:Is.get(G.json,["dama","npmrds","sources","byId",X,"views","length"],0)-1},"attributes",Object.values(mA)]);i.get(...Z)})()},[i,L]);const S=b.useMemo(()=>L.reduce((B,V)=>{const G=Object.values(Is.get(c,["dama","npmrds","sources","byId",V,"views","byIndex"],{})).map(Z=>Dm(Is.get(c,Z.value,{attributes:{}}).attributes));return G.length&&(B=Is.uniqBy([...B,...G],"view_id")),B},[]).filter(B=>B&&B.view_id&&B.metadata&&Object.keys(B.metadata||{}).length>0),[c,L]),k=b.useMemo(()=>s.find(B=>Number(B.view_id)===Number(n)),[n,s]),[$,I]=b.useMemo(()=>[(S||[]).filter(B=>((k==null?void 0:k.view_dependencies)||[]).indexOf(Number(B.view_id))===-1),(S||[]).filter(B=>((k==null?void 0:k.view_dependencies)||[]).indexOf(Number(B.view_id))>=0)],[S,n,k,k==null?void 0:k.view_dependencies]),T=b.useMemo(()=>Is.groupBy(Is.orderBy(I,["metadata.start_date","metadata.end_date"],["asc","asc"]),B=>{var V;return(V=B==null?void 0:B.metadata)==null?void 0:V.state_code}),[I]),A=b.useMemo(()=>$.map(B=>{var V,G,Z;return{label:`${(V=B==null?void 0:B.metadata)==null?void 0:V.name} From ${(G=B==null?void 0:B.metadata)==null?void 0:G.start_date} to ${(Z=B==null?void 0:B.metadata)==null?void 0:Z.end_date}`,value:B==null?void 0:B.view_id,metadata:B==null?void 0:B.metadata}}),[$]),R=b.useMemo(()=>[...f,k].filter(B=>B&&B.metadata&&B.metadata.start_date&&B.metadata.end_date).map(B=>{var V,G;return{start_date:(V=B==null?void 0:B.metadata)==null?void 0:V.start_date,end_date:(G=B==null?void 0:B.metadata)==null?void 0:G.end_date}}),[f,k]),{msgString:O,isValidDateRage:M}=b.useMemo(()=>({...dA(R)||{}}),[R]),D=["State","View Id","Version","Start Date","End Date","Tmcs",""],P=async()=>{const B={source_id:(t==null?void 0:t.source_id)||null,view_id:k==null?void 0:k.view_id,user_id:a==null?void 0:a.user_id,npmrds_raw_view_ids:f.map(V=>V.value),name:t==null?void 0:t.name,type:"npmrds",...Pm(R),pgEnv:l};E(!0);try{const G=await(await fetch(`${Rt}/dama-admin/${l}/npmrds/add`,{method:"POST",body:JSON.stringify(B),headers:{"Content-Type":"application/json"}})).json(),{source_id:Z}=G;E(!1),d(`/datasources/source/${Z}`)}catch{E(!1)}},F=async(B,V)=>{const G={source_id:(t==null?void 0:t.source_id)||null,view_id:k==null?void 0:k.view_id,user_id:a==null?void 0:a.user_id,npmrds_raw_removed_view_ids:[B],name:t==null?void 0:t.name,type:"npmrds",...Pm(T[`${V}`].filter(Z=>Z&&Z.metadata&&Z.metadata.start_date&&Z.metadata.end_date&&Z.view_id!==B).map(Z=>{var X,H;return{start_date:(X=Z==null?void 0:Z.metadata)==null?void 0:X.start_date,end_date:(H=Z==null?void 0:Z.metadata)==null?void 0:H.end_date}})),pgEnv:l};E(!0);try{const X=await(await fetch(`${Rt}/dama-admin/${l}/npmrds/remove`,{method:"POST",body:JSON.stringify(G),headers:{"Content-Type":"application/json"}})).json(),{source_id:H}=X;E(!1),d(`/datasources/source/${H}`)}catch{E(!1)}};return e.jsxs("div",{className:"w-full p-5",children:[e.jsxs("div",{className:"flex m-3",children:[e.jsx("div",{className:"justify-start w-full md:w-1/2 px-3 mb-6 md:mb-0",children:e.jsx("label",{className:"block uppercase tracking-wide text-gray-700 text-xl font-bold mb-2",children:"Input Data"})}),e.jsxs("div",{className:"justify-right",children:[e.jsx("button",{className:"cursor-pointer bg-blue-500 hover:bg-blue-700 text-white font-bold mr-3 py-2 px-4 rounded",children:e.jsx("div",{style:{display:"flex"},children:e.jsx("span",{className:"mr-2",children:"Replace"})})}),e.jsx("button",{className:"cursor-pointer bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:()=>p(!0),children:e.jsx("div",{style:{display:"flex"},children:e.jsx("span",{className:"mr-2",children:"Add"})})})]})]}),Object.keys(T).length?e.jsx("div",{className:"overflow-x-auto px-5 py-3",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsx("tr",{children:D.map(B=>e.jsx("th",{className:"py-2 px-4 bg-gray-200 text-left border-b",children:B},B))})}),e.jsx("tbody",{children:Object.keys(T).map(B=>e.jsx(w.Fragment,{children:T[B].map((V,G)=>{var Z,X,H,z,W,Y,U,q;return e.jsxs("tr",{children:[G===0&&e.jsx("td",{rowSpan:T[B].length,className:"py-2 px-4 border-b font-bold",children:B}),e.jsx("td",{className:"py-2 px-4 border-b",children:V==null?void 0:V.view_id},`${B}.${V==null?void 0:V.view_id}`),e.jsx("td",{className:"py-2 px-4 border-b",children:(Z=V==null?void 0:V.metadata)==null?void 0:Z.npmrds_version},`${B}.${(X=V==null?void 0:V.metadata)==null?void 0:X.npmrds_version}`),e.jsx("td",{className:"py-2 px-4 border-b",children:(H=V==null?void 0:V.metadata)==null?void 0:H.start_date},`${B}.${(z=V==null?void 0:V.metadata)==null?void 0:z.start_date}`),e.jsx("td",{className:"py-2 px-4 border-b",children:(W=V==null?void 0:V.metadata)==null?void 0:W.end_date},`${B}.${(Y=V==null?void 0:V.metadata)==null?void 0:Y.end_date}`),e.jsx("td",{className:"py-2 px-4 border-b",children:(U=V==null?void 0:V.metadata)==null?void 0:U.no_of_tmc},`${B}.${(q=V==null?void 0:V.metadata)==null?void 0:q.no_of_tmc}`),G===0||G===T[B].length-1?e.jsx(e.Fragment,{children:e.jsx("td",{className:"py-2 px-4 border-b",children:e.jsx("button",{className:"relative align-middle select-none font-sans font-medium text-center uppercase transition-all disabled:opacity-50 disabled:shadow-none disabled:pointer-events-none w-10 max-w-[40px] h-10 max-h-[40px] rounded-lg text-xs bg-red-500 text-white shadow-md shadow-red-900/10 hover:shadow-lg hover:shadow-red-900/20 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none",type:"button",onClick:()=>{y(V==null?void 0:V.view_id),N(B),h(!0)},children:e.jsx("span",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2",children:e.jsx("i",{className:"fad fa-trash","aria-hidden":"true"})})})},`${B}.${G}`)}):e.jsx(e.Fragment,{children:e.jsx("td",{className:"py-2 px-4 border-b"},`${B}.${G}`)})]},G)})},B))})]})}):e.jsx("div",{className:"p-4 mb-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-red-400",role:"alert",children:e.jsx("span",{className:"font-medium",children:"Please! Add npmrds by clicking Add button"})}),e.jsx(Je,{as:"div",className:"relative z-50",open:u,onClose:()=>p(!1),children:e.jsxs("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-4",children:[e.jsx("span",{className:"inline-block h-screen align-middle","aria-hidden":"true",children:"​"}),e.jsx(di,{children:e.jsxs("div",{className:"inline-block w-full min-w-xl max-w-xl p-6 my-8 text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl",children:[e.jsx(Id,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:"Add Npmrds"}),A&&A.length>0?e.jsxs("div",{className:"relative p-6 flex-auto",children:[O?e.jsx(e.Fragment,{children:e.jsx("div",{className:"p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400",role:"alert",children:e.jsx("span",{className:"font-medium",children:O})})}):null,e.jsx(cA,{options:A,onChange:g,value:f})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"p-4 m-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400",role:"alert",children:e.jsx("span",{className:"font-medium",children:"Npmrds Data for the Addition is not available."})})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{type:"button",className:"inline-flex justify-center px-4 py-2 text-sm text-red-900 bg-red-100 border border-transparent rounded-md hover:bg-red-200 duration-300",onClick:()=>p(!1),children:"Close"}),f&&f.length&&M?e.jsx("button",{className:"ml-3 inline-flex justify-center px-4 py-2 text-sm text-green-900 bg-green-100 border border-transparent rounded-md hover:bg-green-200 duration-300",type:"button",onClick:P,children:_?e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{className:"mr-2",children:"Saving..."}),e.jsx(go,{scale:.25,color:"#fefefe"})]}):"Save Changes"}):null]})]})})]})}),e.jsx(Je,{as:"div",className:"relative z-50",open:m,onClose:()=>h(!1),children:e.jsxs("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-4",children:[e.jsx("span",{className:"inline-block h-screen align-middle","aria-hidden":"true",children:"​"}),e.jsx(di,{children:e.jsxs("div",{className:"inline-block w-full max-w-md p-6 my-8 text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl",children:[e.jsx(Id,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:"Remove Npmrds"}),e.jsx("div",{className:"relative p-6 flex-auto",children:e.jsx("div",{className:"p-4 m-2 text-sm",role:"alert",children:e.jsx("span",{className:"font-medium",children:"Are you sure you want to Remove?"})})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{type:"button",className:"inline-flex justify-center px-4 py-2 text-sm text-red-900 bg-red-100 border border-transparent rounded-md hover:bg-red-200 duration-300",onClick:()=>h(!1),children:"Close"}),e.jsx("button",{type:"button",className:"ml-3 inline-flex justify-center px-4 py-2 text-sm text-green-900 bg-green-100 border border-transparent rounded-md hover:bg-green-200 duration-300",onClick:async()=>{await F(x,j),h(!1)},children:_?e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{className:"mr-2",children:"Deleting..."}),e.jsx(go,{scale:.25,color:"#fefefe"})]}):"Yes"})]})]})})]})})]})}const hA={sourceCreate:{name:"Create",component:iA},manage:{name:"Manage",path:"/manage",component:pA}},Zt={gis_dataset:sA,csv_dataset:nA,npmrds:hA};function fA(t,s){Zt[t]=s}const gA=t=>({"Guest User":-1,"Public User":0,"Agency User":1})[t],jb=t=>{const s=Object.keys(t);let n=Number.MAX_SAFE_INTEGER;return s.map(r=>{t[r].view==!0&&(n=Math.min(n,gA(r)))}),n==Number.MAX_SAFE_INTEGER&&(n=Number.MIN_SAFE_INTEGER),n},wb=()=>e.jsx("div",{className:"h-screen flex-1 flex flex-col text-gray-900 bg-gray-100",children:e.jsxs("div",{className:"flex-1 flex items-center justify-center flex-col",children:[e.jsx("div",{className:"text-8xl font-bold",children:"404"}),e.jsx("div",{className:"text-2xl",children:"Page not Found"}),e.jsx("div",{className:"text-2xl",children:"Oops, Something went missing..."})]})}),xA=({})=>{var E;const{sourceId:t,page:s,viewId:n}=Ye(),[r,a]=b.useState(ei||[]),[l,i]=b.useState(n),{pgEnv:c,baseUrl:d,falcor:u,falcorCache:p,user:m}=w.useContext(ce),h=m.authLevel,f=b.useMemo(()=>s?C(r,`[${s}].component`,r.overview.component):r.overview.component,[s,r]);b.useEffect(()=>{async function L(){const S=["dama",c,"sources","byId",t,"views","length"],k=await u.get(S);return await u.get(["dama",c,"sources","byId",t,"views","byIndex",{from:0,to:C(k.json,S,0)-1},"attributes",Object.values(fn)],["dama",c,"sources","byId",t,"attributes",Object.values(Es)],["dama",c,"sources","byId",t,"meta"])}L()},[t,u,c]);const g=b.useMemo(()=>Object.values(C(p,["dama",c,"sources","byId",t,"views","byIndex"],{})).map(L=>ts(C(p,L.value,{attributes:{}}).attributes)),[p,t,c]);b.useEffect(()=>{if(l&&l!==n&&i(n),!l&&g.length>0){let L=g.filter(S=>{var k;return(k=S==null?void 0:S.metadata)==null?void 0:k.authoritative}).length>0?g.filter(S=>{var k;return(k=S==null?void 0:S.metadata)==null?void 0:k.authoritative}):g;i(L.sort((S,k)=>S._created_timestamp-k._created_timestamp)[0].view_id)}},[g,n]);const x=b.useMemo(()=>{let L=ts(C(p,["dama",c,"sources","byId",t],{attributes:{}}).attributes);if(Zt[L.type]){let S=Object.keys(Zt[L.type]).reduce(($,I)=>((Zt[L.type][I].path||I==="overview")&&($[I]=Zt[L.type][I]),$),{}),k={...ei,...S};a(k)}else a(ei);return L},[p,t,c]),y=jb(((E=x==null?void 0:x.statistics)==null?void 0:E.access)||{}),[j,N]=Vn(),_=w.useCallback(L=>{const S=[];return j.forEach((k,$)=>{S.push(`${$}=${k}`)}),`${d}/source/${t}${L.path}${l&&L.path?"/"+l:""}${S.length?`?${S.join("&")}`:""}`},[d,t,l,j]);return y>h?e.jsx(wb,{}):e.jsxs(ss,{baseUrl:d,children:[e.jsx(_c,{menuItems:Object.values(r).filter(L=>{const S=(L==null?void 0:L.authLevel)||-1,k=m.authLevel||-1;return!L.hidden&&S<=k}).sort((L,S)=>((L==null?void 0:L.authLevel)||-1)-((S==null?void 0:S.authLevel)||-1)).map(L=>({name:L.name,path:_(L)})),themeOptions:{size:"inline"}}),e.jsx("div",{className:"w-full flex-1 bg-white shadow",children:e.jsx(f,{searchParams:j,setSearchParams:N,source:x,views:g,user:m,baseUrl:d,activeViewId:l})})]})},bA=({baseUrl:t})=>{const[s,n]=b.useState(Object.keys(Es).filter(c=>!["source_id","metadata","statistics"].includes(c)).reduce((c,d)=>(c[d]="",c),{})),[r,a]=b.useState(null),{pgEnv:l}=w.useContext(ce);b.useEffect(()=>{(async()=>{const d=(await Promise.all(Object.keys(Zt).map(async u=>Zt[u].getIsAlreadyCreated&&await Zt[u].getIsAlreadyCreated(l)?null:u))).filter(Boolean).reduce((u,p)=>(u[p]=Zt[p],u),{});a(d)})()},[l]);const i=b.useMemo(()=>C(r,`[${s.type}].sourceCreate.component`,()=>e.jsx("div",{})),[r,s.type]);return r===null?e.jsx("div",{children:"Requesting data types statuses"}):e.jsx("div",{children:e.jsxs(ss,{children:[e.jsx("div",{className:"p-4 font-medium",children:" Create New Source "}),e.jsxs("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:[e.jsxs("dl",{className:"sm:divide-y sm:divide-gray-200",children:[Object.keys(Es).filter(c=>!["source_id","metadata","description","type","statistics","category","update_interval","categories","display_name"].includes(c)).map((c,d)=>e.jsx("div",{className:"flex justify-between group",children:e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 py-5",children:c}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"pt-3 pr-8",children:e.jsx(Un,{className:"w-full p-2 flex-1 px-2 shadow bg-grey-50 focus:bg-blue-100  border-gray-300 ",value:C(s,c,""),onChange:u=>{n({...s,[c]:u})}})})})]})},d)),e.jsx("div",{className:"flex justify-between group",children:e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 py-5",children:"Data Type"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"pt-3 pr-8",children:e.jsxs("select",{className:"w-full bg-white p-3 flex-1 shadow bg-grey-50 focus:bg-blue-100  border-gray-300",value:C(s,"type",""),onChange:c=>{n({...s,type:c.target.value})},children:[e.jsx("option",{value:"",disabled:!0,children:"Select your option"}),Object.keys(r||[]).filter(c=>r[c].sourceCreate).map(c=>e.jsx("option",{value:c,className:"p-2",children:c},c))]})})})]})})]}),e.jsx(i,{source:s,baseUrl:t})]})]})})};async function yA({falcor:t,pgEnv:s,sourceId:n}){const r=await t.get(["dama",s,"sources","byId",n,"dependents"]),a=[],l=[];C(r,["json","dama",s,"sources","byId",n,"dependents"]).forEach(i=>{a.push(i.source_id),l.push(i.view_id)}),await t.get(["dama",s,"sources","byId",[...a,n],"attributes",["type","name","display_name"]]),await t.get(["dama",s,"views","byId",l,"attributes",["version","metadata","_modified_timestamp","last_updated"]])}const vA=({text:t})=>{const{falcor:s,baseUrl:n,pgEnv:r}=w.useContext(ce),{sourceId:a}=Ye(),l=$e();async function i(){const d=await(await fetch(`${Rt}/dama-admin/${r}/deleteDamaSource`,{method:"POST",body:JSON.stringify({source_id:a}),headers:{"Content-Type":"application/json"}})).json();console.log("delete response",d),s.invalidate(["dama",r,"sources","length"],["dama",r,"sources","byIndex"],["dama",r,"sources","byId",a]),console.log("navigate to",n),l(n||"/")}return e.jsx("button",{className:"bg-red-50 hover:bg-red-400 hover:text-white p-2",onClick:i,children:"Confirm Delete"})},jA=()=>e.jsxs("div",{className:"pb-4 flex justify-between",children:[e.jsx("label",{children:"No dependents found."}),e.jsx(vA,{text:"Confirm Delete"})]});function wA(){const{pgEnv:t,baseUrl:s,falcor:n,falcorCache:r}=w.useContext(ce),{sourceId:a}=Ye();console.log("delete page",a),b.useEffect(()=>{yA({falcor:n,pgEnv:t,sourceId:a})},[a,t,n]),C(r,["dama",t,"sources","byId",a,"dependents","value"],[]);const l=C(r,["dama",t,"sources","byId",a,"attributes","name"],"");return C(r,["dama",t,"sources","byId"],{}),C(r,["dama",t,"views","byId"],{}),e.jsx("div",{children:e.jsx(ss,{children:e.jsxs("div",{className:"w-full p-4 bg-white my-1 block border shadow",children:[e.jsxs("div",{className:"pb-4 font-bold",children:["Delete ",e.jsx("i",{children:l})]}),jA()]})})})}const or={collection_id:"collection_id",name:"name",description:"description",metadata:"metadata",categories:"categories",source_dependencies:"source_dependencies",user_id:"user_id",_created_timestamp:"_created_timestamp",_modified_timestamp:"_modified_timestamp"},lr={symbology_id:"symbology_id",name:"name",collection_id:"collection_id",description:"description",symbology:"symbology",categories:"categories",_created_timestamp:"_created_timestamp",_modified_timestamp:"_modified_timestamp"},hd=t=>Object.entries(t||{}).reduce((s,n)=>{const[r,a]=n;return typeof a.value<"u"?s[r]=a.value:s[r]=a,s},{}),NA=({collection:t})=>{const{pgEnv:s,baseUrl:n,falcor:r,falcorCache:a}=w.useContext(ce);return b.useEffect(()=>{async function l(){const i=["dama",s,"collections","byId",t.collection_id,"symbologies","length"],c=await r.get(i);await r.get(["dama",s,"collections","byId",t.collection_id,"symbologies","byIndex",{from:0,to:C(c.json,i,0)-1},"attributes",Object.values(lr)])}l()},[r,a,t,s]),e.jsx("div",{className:"w-full p-4 bg-white my-1 hover:bg-blue-50 block border shadow flex justify-between",children:e.jsxs("div",{children:[e.jsx(je,{to:`${n}/collection/${t.collection_id}`,className:"text-xl font-medium w-full block",children:e.jsx("span",{children:t.name})}),e.jsx("div",{children:(C(t,"categories",[])||[]).map(l=>l.map((i,c)=>e.jsx(je,{to:`${n}collections/cat/${c>0?l[c-1]+"/":""}${i}`,className:"text-xs p-1 px-2 bg-blue-200 text-blue-600 mr-2",children:i},c)))}),e.jsx(je,{to:`${n}/collection/${t.collection_id}`,className:"py-2 block",children:t.description})]})})},ni=()=>{const[t,s]=b.useState(""),{cat1:n,cat2:r}=Ye(),{pgEnv:a,baseUrl:l,falcor:i,falcorCache:c}=w.useContext(ce);b.useEffect(()=>{async function u(){const p=["dama",a,"collections","length"],m=await i.get(p);await i.get(["dama",a,"collections","byIndex",{from:0,to:C(m.json,p,0)-1},"attributes",Object.values(or)])}u()},[i,a]);const d=b.useMemo(()=>Object.values(C(c,["dama",a,"collections","byIndex"],{})).map(u=>hd(C(c,u.value,{attributes:{}}).attributes)),[c,a]);return e.jsxs(ss,{baseUrl:l,children:[e.jsxs("div",{className:"flex py-4 justify-between	",children:[e.jsx("div",{className:"flex flex-1 mr-8",children:e.jsx("input",{className:"w-full text-lg p-2 border border-gray-300 ",placeholder:"Search existing collections...",value:t,onChange:u=>s(u.target.value)})}),e.jsx("div",{className:"flex w-36",children:e.jsxs(je,{className:"flex items-center p-3 text-center bg-green-300 border border-green-200 shadow hover:bg-green-500 hover:text-white",to:`${l}/create/collection`,children:["Create new collection",e.jsx("i",{className:"ml-1 fad fa-plus fa-2x"})]})})]}),d.filter(u=>{let p=!0;return n&&(p=!1,(C(u,"categories",[])||[]).forEach(m=>{m[0]===n&&(!r||m[1]===r)&&(p=!0)})),p}).filter(u=>{let p=u.name+" "+C(u,"categories[0]",[]).join(" ");return!t.length>2||p.toLowerCase().includes(t.toLowerCase())}).map((u,p)=>e.jsx(NA,{collection:u,baseUrl:l},p))]})},ai=({startValue:t,attr:s,collectionId:n,type:r="text",cancel:a=()=>{}})=>{const[l,i]=b.useState(""),{pgEnv:c,baseUrl:d,falcor:u}=w.useContext(ce);b.useEffect(()=>{i(t)},[t]);const p=(m,h)=>{n&&u.set({paths:[["dama",c,"collections","byId",n,"attributes",m]],jsonGraph:{dama:{[c]:{collections:{byId:{[n]:{attributes:{[m]:h}}}}}}}}).then(f=>{a()})};return r==="textarea"?e.jsxs("div",{className:"w-full flex flex-col h-full border border-lime-300",children:[e.jsx("div",{children:e.jsx("textarea",{className:"flex-1 w-full px-2 shadow bg-blue-100 min-h-[200px] focus:ring-blue-700 focus:border-blue-500  border-gray-300 rounded-none rounded-l-md",onChange:m=>i(m.target.value),children:l})}),e.jsxs("div",{className:"flex py-2",children:[e.jsx("div",{className:"flex-1"}),e.jsx(We,{themeOptions:{size:"sm",color:"primary"},onClick:m=>p(s,l),children:" Save "}),e.jsx(We,{themeOptions:{size:"sm",color:"cancel"},onClick:m=>a(),children:" Cancel "})]})]}):e.jsxs("div",{className:"w-full flex flex-1",children:[e.jsx(Un,{className:"flex-1 px-2 shadow bg-blue-100 focus:ring-blue-700 focus:border-blue-500  border-gray-300 rounded-none rounded-l-md",value:l,onChange:m=>i(m)}),e.jsx(We,{themeOptions:{size:"sm",color:"primary"},onClick:m=>p(s,l),children:" Save "}),e.jsx(We,{themeOptions:{size:"sm",color:"cancel"},onClick:m=>a(),children:" Cancel "})]})},CA=({collection:t,symbologies:s,activeViewId:n})=>{const[r,a]=w.useState(null),l=w.useCallback(u=>{u.stopPropagation(),a(null)},[]),{pgEnv:i,baseUrl:c,user:d}=w.useContext(ce);return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:" flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between group",children:[e.jsx("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:e.jsx("dd",{className:"mt-1 text-2xl text-gray-700 font-medium overflow-hidden sm:mt-0 sm:col-span-3",children:r==="name"?e.jsx("div",{className:"pt-3 pr-8",children:e.jsx(ai,{startValue:t.name,attr:"name",collectionId:t.collection_id,cancel:l})}):e.jsx("div",{className:"py-2 px-2",children:t.name})})}),d.authLevel>5?e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:u=>a(r==="name"?null:"name"),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12 mt-3 p-2.5 rounded hover:bg-blue-500 hover:text-white "})}):""]}),e.jsxs("div",{className:"w-full pl-4 py-6 hover:py-6 sm:pl-6 flex justify-between group",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"mt-1 text-sm text-gray-500 pr-14",children:r==="description"?e.jsx(ai,{startValue:C(t,"description",""),attr:"description",type:"textarea",collectionId:t==null?void 0:t.collection_id,cancel:l}):C(t,"description",!1)||"No Description"})}),d.authLevel>5?e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:u=>a("description"),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12  p-2 hover:bg-blue-500 rounded focus:bg-blue-700 hover:text-white "})}):""]})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:Object.keys(or).filter(u=>!["collection_id","metadata","description","statistics","category","display_name","name"].includes(u)).map((u,p)=>{let m=typeof t[u]=="object"?JSON.stringify(t[u]):t[u];return u==="categories"?e.jsxs("div",{className:"flex justify-between group",children:[e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 py-5",children:u}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"py-5 px-2 relative"})})]}),d.authLevel>5&&r!==u?e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:h=>a(u),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12 mt-3 p-2.5 rounded hover:bg-blue-500 hover:text-white "})}):null]},u):e.jsxs("div",{className:"flex justify-between group",children:[e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 py-5",children:u}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:r===u?e.jsx("div",{className:"pt-3 pr-8",children:e.jsx(ai,{startValue:m,attr:u,collectionId:t.collection_id,cancel:l})}):e.jsx("div",{className:"py-5 px-2",children:m})})]}),d.authLevel>5?e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:h=>a(r===u?null:u),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12 mt-3 p-2.5 rounded hover:bg-blue-500 hover:text-white "})}):""]},u)})})})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-6 items-center  px-4 py-5 mr-5 sm:p-0",children:[e.jsx("div",{className:"col-span-1 text-xl text-gray-700 font-medium",children:"Symbologies:"}),e.jsx("div",{className:"col-end-7",children:e.jsxs(je,{className:"flex items-center p-1 text-center bg-green-300 border border-green-200 shadow hover:bg-green-500 hover:text-white",to:`${c}/create/collection`,children:["Create new symbology",e.jsx("i",{className:"ml-1 fad fa-plus fa-2x"})]})}),e.jsx("div",{className:"col-span-6"})]})]})};function _A(...t){return t.filter(Boolean).join(" ")}async function SA({falcor:t,pgEnv:s,viewId:n}){const r=await t.get(["dama",s,"viewDependencySubgraphs","byViewId",n]),a=await t.get(["dama",s,"views","byId",n,"dependents"]),l=[],i=[];C(r,["json","dama",s,"viewDependencySubgraphs","byViewId",n,"dependencies"],[]).forEach(c=>{l.push(c.source_id),i.push(c.view_id)}),C(a,["json","dama",s,"views","byId",n,"dependents"],[]).forEach(c=>{l.push(c.source_id),i.push(c.view_id)}),await t.get(["dama",s,"sources","byId",l,"attributes",["type","name"]]),await t.get(["dama",s,"views","byId",[n,...i],"attributes",["version","metadata","_modified_timestamp","last_updated"]])}const $A=({startValue:t,attr:s,viewId:n,cancel:r=()=>{}})=>{const[a,l]=b.useState(""),{pgEnv:i,baseUrl:c,falcor:d}=w.useContext(ce);b.useEffect(()=>{l(t)},[t]);const u=(p,m)=>{n&&d.set({paths:[["dama",i,"views","byId",n,"attributes",p]],jsonGraph:{dama:{[i]:{views:{byId:{[n]:{attributes:{[p]:m}}}}}}}}).then(h=>{console.log("set run",h),r()})};return e.jsxs("div",{className:"w-full flex",children:[e.jsx(Un,{className:"flex-1 px-2 shadow bg-blue-100 focus:ring-blue-700 focus:border-blue-500  border-gray-300 rounded-none rounded-l-md",value:a,onChange:p=>l(p)}),e.jsx(We,{themeOptions:{size:"sm",color:"primary"},onClick:p=>u(s,a),children:" Save "}),e.jsx(We,{themeOptions:{size:"sm",color:"cancel"},onClick:p=>r(),children:" Cancel "})]})},EA=({view:t,columns:s=null})=>{const[n,r]=w.useState(null),{pgEnv:a,baseUrl:l,user:i}=w.useContext(ce);return e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:Object.keys(fn).filter(c=>!s||s.includes(c)).filter(c=>!["view_id","source_id","description","statistics","category","table_schema","table_name","data_table","tiles_url","last_updated","view_dependencies","start_date","end_date","download_url","user_id","etl_context_id"].includes(c)).map((c,d)=>{var p;let u=typeof t[c]=="object"?JSON.stringify((p=t[c])==null?void 0:p.value):t[c];return e.jsxs("div",{className:"flex justify-between group",children:[e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 py-5",children:c}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:n===c?e.jsx("div",{className:"pt-3 pr-8",children:e.jsx($A,{startValue:u,attr:c,viewId:t.view_id,cancel:()=>r(null)})}):e.jsx("div",{className:"py-5 px-2",children:u})})]}),i.authLevel>5?e.jsx("div",{className:"hidden group-hover:block text-blue-500 cursor-pointer",onClick:m=>r(n===c?null:c),children:e.jsx("i",{className:"fad fa-pencil absolute -ml-12 mt-3 p-2.5 rounded hover:bg-blue-500 hover:text-white "})}):""]},d)})})})})};function kA({view:t}){const{viewId:s,sourceId:n}=Ye(),{pgEnv:r,baseUrl:a,user:l}=w.useContext(ce),i=()=>{(async()=>{try{const d={source_id:n,view_id:s};console.log("creating download");const p=await(await fetch(`${Rt}/dama-admin/${r}/gis-dataset/createDownload`,{method:"POST",body:JSON.stringify(d),headers:{"Content-Type":"application/json"}})).json();console.log("createDownload",p)}catch(d){console.error("==>",d)}})()};return e.jsx("div",{className:"w-72 ",children:l.authLevel>=10?e.jsxs("div",{className:"w-full",children:[e.jsx("div",{children:" Admin Actions "}),e.jsx("div",{className:"w-full p-1 flex",children:e.jsx(je,{className:"w-full flex-1 text-center border shadow hover:bg-blue-100 p-4",onClick:i,children:"Create Download"})}),e.jsx("div",{className:"w-full p-1 flex",children:e.jsxs(je,{className:"w-full flex-1 text-center bg-red-100 border border-red-200 shadow hover:bg-red-400 hover:text-white p-4",to:`${a}/source/${n}/versions/${s}/delete`,children:["Delete View ",e.jsx("i",{className:"fad fa-trash"})]})})]}):""})}function LA({view:t}){var s;return(s=t==null?void 0:t.metadata)!=null&&s.download?e.jsxs("div",{className:"inline-flex rounded-md shadow-sm",children:[e.jsx("button",{type:"button",className:"relative inline-flex items-center rounded-l-md bg-white px-10 py-[12px] text-md font-semibold text-blue-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-10",children:"Download"}),e.jsxs(Oe,{as:"div",className:"absolute ml-32 block",children:[e.jsxs(Oe.Button,{className:"relative inline-flex items-center rounded-r-md bg-white px-2 py-3 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-10",children:[e.jsx("span",{className:"sr-only",children:"Open options"}),e.jsx(bp,{className:"h-5 w-5","aria-hidden":"true"})]}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsx(Oe.Items,{className:"absolute z-20 right-0 -mr-1 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:e.jsx("div",{className:"py-1",children:Object.keys(t.metadata.download).map((n,r)=>e.jsx(Oe.Item,{children:({active:a})=>e.jsx("a",{href:t.metadata.download[n].replace("$HOST",`${Rt}`),className:_A(a?"bg-gray-100 text-gray-900":"text-gray-700","block px-4 py-2 text-sm"),children:n})},r))})})})]})]}):"Download Not Available"}function IA(){const{viewId:t,sourceId:s}=Ye(),{pgEnv:n,baseUrl:r,falcor:a,falcorCache:l}=w.useContext(ce);b.useEffect(()=>{SA({falcor:a,pgEnv:n,viewId:t})},[t,n,a]),C(l,["dama",n,"viewDependencySubgraphs","byViewId",t,"value"],{dependencies:[]}),C(l,["dama",n,"views","byId",t,"dependents","value"],[]);const i=C(l,["dama",n,"sources","byId",s,"attributes"],{});C(l,["dama",n,"views","byId"],{});const c=C(l,["dama",n,"views","byId",t,"attributes"],{}),d=typeof(c==null?void 0:c.version)=="object"?null:c==null?void 0:c.version;return e.jsx("div",{className:"overflow-hidden flex flex-col md:flex-row",children:e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"flex justify-between",children:e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dd",{className:"mt-1 text-2xl text-gray-700 font-medium overflow-hidden sm:mt-0 sm:col-span-2",children:e.jsxs("div",{className:"py-2 px-2",children:[i==null?void 0:i.name," - ",d||t]})}),e.jsx("dd",{className:"sm:mt-0 sm:col-span-2",children:e.jsx(EA,{view:c,baseUrl:r})}),e.jsx(kA,{view:c})]})})})})}async function TA({falcor:t,pgEnv:s,viewId:n}){const r=await t.get(["dama",s,"views","byId",n,"dependents"],["dama",s,"views","byId",n,"attributes","source_id"]),a=[],l=[];C(r,["json","dama",s,"views","byId",n,"dependents"]).forEach(c=>{a.push(c.source_id),l.push(c.view_id)}),await t.get(["dama",s,"sources","byId",a,"attributes",["type","name"]]),await t.get(["dama",s,"views","byId",l,"attributes",["version","metadata","_modified_timestamp","last_updated"]]);const i=t.getCache();return{dependents:C(i,["dama",s,"views","byId",n,"dependents","value"],[]),sourceId:C(r,["json","dama",s,"views","byId",n,"attributes","source_id"],[]),srcMeta:C(i,["dama",s,"sources","byId"],{}),viewMeta:C(i,["dama",s,"views","byId"],{})}}const Nb=({text:t,viewId:s,sourceId:n,pgEnv:r,baseUrl:a,falcor:l})=>{const i=$e();return e.jsx("button",{className:"bg-red-50 hover:bg-red-400 hover:text-white p-2",onClick:async()=>{console.log("I am deleteing the view id ",s),await fetch(`${Rt}/dama-admin/${r}/deleteDamaView`,{method:"POST",body:JSON.stringify({view_id:s}),headers:{"Content-Type":"application/json"}}),await l.invalidate(["dama",r,"sources","byId",n,"views","length"]),i(`${a}/source/${n}/versions`)},children:t})},MA=({dependents:t,viewId:s,srcMeta:n,viewMeta:r})=>e.jsxs("div",{className:"w-full p-4 shadow mb-4",children:[e.jsx("label",{className:"text-lg",children:"Dependents"}),e.jsx("div",{className:"py-4 sm:py-2 mt-2 sm:grid sm:grid-cols-5 sm:gap-20 sm:px-6 border-b-2",children:["Source Name","Type","Version","Last Updated"].map(a=>e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:a},a))}),e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:t.map((a,l)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-5 sm:gap-20 sm:px-6",children:[e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:e.jsx(je,{to:`/source/${a.source_id}/overview`,children:C(n,[a.source_id,"attributes","name"])})},`${l}_1`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:e.jsx(je,{to:`/source/${a.source_id}/overview`,children:C(n,[a.source_id,"attributes","type"])})},`${l}_2`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:e.jsx(je,{to:`/source/${a.source_id}/views/${a.view_id}`,children:C(r,[a.view_id,"attributes","version"])})},`${l}_3`),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 align-middle",children:e.jsx(je,{to:`/source/${a.source_id}/views/${a.view_id}`,children:typeof C(r,[a.view_id,"attributes","_modified_timestamp","value"])=="object"?"":C(r,[a.view_id,"attributes","_modified_timestamp","value"])})},`${l}_4`),e.jsx("dd",{className:"mt-1 text-sm text-red-400 sm:mt-0",children:e.jsxs("span",{className:"float-right italic",children:[" ",C(r,[a.view_id,"attributes","metadata","value","authoritative"])==="true"?"":"outdated"]})},`${l}_5`)]},`${l}_0`))})]}),BA=(t,s,n,r,a,l,i,c)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-4 flex justify-between",children:[e.jsx("label",{children:"The View has following dependents:"}),e.jsx(Nb,{text:"Delete anyway",viewId:n,sourceId:s,pgEnv:l,baseUrl:i,falcor:c})]}),e.jsx("div",{className:"bg-red-50",children:e.jsx(MA,{viewId:n,srcMeta:r,viewMeta:a,dependents:t})})]}),AA=(t,s,n,r,a)=>e.jsxs("div",{className:"pb-4 flex justify-between",children:[e.jsx("label",{children:"No dependents found."}),e.jsx(Nb,{text:"Confirm Delete",viewId:t,sourceId:s,pgEnv:n,baseUrl:r,falcor:a})]});function OA(){const{sourceId:t,viewId:s}=Ye(),{pgEnv:n,baseUrl:r,falcor:a,falcorCache:l}=w.useContext(ce);b.useEffect(()=>{TA({falcor:a,pgEnv:n,viewId:s})},[s,n,a]);const i=C(l,["dama",n,"views","byId",s,"dependents","value"],[]),c=C(l,["dama",n,"sources","byId"],{}),d=C(l,["dama",n,"views","byId"],{});return e.jsxs("div",{className:"w-full p-4 bg-white my-1 block border shadow",children:[e.jsxs("div",{className:"pb-4 font-bold",children:["Delete ",e.jsx("i",{children:s})]}),i.length?BA(i,t,s,c,d,n,r,a):AA(s,t,n,r,a)]})}const PA=({source:t,views:s,meta:n})=>{const{pgEnv:r,baseUrl:a,user:l}=w.useContext(ce);$e();const{sourceId:i,viewId:c,vPage:d}=Ye();return d==="delete"?e.jsx(OA,{}):c?e.jsx(IA,{}):e.jsx("div",{className:"",children:e.jsx(St,{data:s,columns:[{Header:"Version Id",accessor:u=>e.jsxs(je,{to:`${a}/source/${i}/versions/${u.view_id}`,children:[" ",u.version||u.view_id," "]})},{Header:"User",accessor:"user_id"},{Header:"Uploaded",accessor:u=>Mx(u._created_timestamp)},{Header:" Download",accessor:u=>e.jsx(LA,{view:u}),disableFilters:!0}]})})},$r=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{d:"M10.5858 12L4.92898 17.6569L6.3432 19.0711L12 13.4143L17.6569 19.0711L19.0711 17.6569L13.4142 12L19.0711 6.34317L17.6569 4.92896L12 10.5858L6.34317 4.92897L4.92896 6.34319L10.5858 12Z"})}),DA=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",className:t,children:e.jsx("path",{d:"M7 0H5V5H0V7H5V12H7V7H12V5H7V0Z"})}),gl=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 13.5C7.82843 13.5 8.5 12.8284 8.5 12C8.5 11.1716 7.82843 10.5 7 10.5C6.17157 10.5 5.5 11.1716 5.5 12C5.5 12.8284 6.17157 13.5 7 13.5ZM13.5 12C13.5 12.8284 12.8284 13.5 12 13.5C11.1716 13.5 10.5 12.8284 10.5 12C10.5 11.1716 11.1716 10.5 12 10.5C12.8284 10.5 13.5 11.1716 13.5 12ZM18.5 12C18.5 12.8284 17.8284 13.5 17 13.5C16.1716 13.5 15.5 12.8284 15.5 12C15.5 11.1716 16.1716 10.5 17 10.5C17.8284 10.5 18.5 11.1716 18.5 12Z"})}),Cb=({className:t="fill-gray-900"})=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:[e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.1278 12C15.1278 13.6863 13.7274 15.0533 12 15.0533C10.2726 15.0533 8.8722 13.6863 8.8722 12C8.8722 10.3137 10.2726 8.94664 12 8.94664C13.7274 8.94664 15.1278 10.3137 15.1278 12ZM13.3717 12C13.3717 12.7395 12.7576 13.339 12 13.339C11.2424 13.339 10.6283 12.7395 10.6283 12C10.6283 11.2604 11.2424 10.6609 12 10.6609C12.7576 10.6609 13.3717 11.2604 13.3717 12Z"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 18C7.90486 18 4.40498 15.512 3 12C4.40498 8.48798 7.90475 6 11.9999 6C16.095 6 19.595 8.48798 21 12C19.595 15.512 16.0951 18 12 18ZM11.9999 7.71429C15.1026 7.71429 17.7877 9.45991 19.0808 12C17.7877 14.5401 15.1027 16.2857 12 16.2857C8.89726 16.2857 6.21206 14.5401 4.91897 12C6.21206 9.45991 8.89715 7.71429 11.9999 7.71429Z"})]}),_b=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{d:"M3 12C3.34629 12.8656 3.81984 13.669 4.3982 14.3883L3.1051 15.6814L4.51932 17.0956L5.80754 15.8074C6.60111 16.4553 7.50288 16.9811 8.48252 17.3552L8.01453 19.1018L9.94638 19.6194L10.4142 17.8735C10.9301 17.9567 11.4599 18 12 18C12.5413 18 13.0722 17.9565 13.5892 17.873L14.0572 19.6194L15.989 19.1018L15.5207 17.354C16.4999 16.9796 17.4012 16.4537 18.1944 15.8058L19.4842 17.0956L20.8984 15.6814L19.6034 14.3863C20.181 13.6676 20.654 12.8648 21 12H19.0808C17.7877 14.5401 15.1027 16.2857 12 16.2857C8.89725 16.2857 6.21206 14.5401 4.91897 12H3Z"})}),RA=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.75146 15.1306V15.1306C6.7516 15.5448 6.41592 15.8807 6.0017 15.8808C5.58749 15.881 5.2516 15.5453 5.25146 15.1311C5.25142 14.9906 5.29183 13.8577 5.72195 12.7308C6.15161 11.6052 7.07875 10.2542 8.93625 10.2542C10.6713 10.2542 11.7208 10.8779 12.6242 11.4218L12.6343 11.4279C13.5029 11.9509 14.2064 12.3744 15.4163 12.3744C15.9048 12.3744 16.2194 12.1925 16.4573 11.9172C16.7183 11.6151 16.9063 11.1726 17.0283 10.6575C17.1484 10.1509 17.1911 9.63239 17.2023 9.23237C17.2078 9.03445 17.2055 8.87034 17.2019 8.75742C17.2001 8.70106 17.198 8.65774 17.1964 8.62967L17.1946 8.59935L17.1942 8.59372C17.1628 8.18088 17.4718 7.82024 17.8847 7.78861C18.2977 7.75696 18.6582 8.06611 18.6898 8.47911L17.942 8.53641C18.6898 8.47911 18.6898 8.47911 18.6898 8.47911L18.69 8.48178L18.6903 8.48614L18.6913 8.4998L18.6941 8.54621C18.6963 8.58534 18.6989 8.64059 18.7011 8.70969C18.7055 8.84767 18.7082 9.042 18.7017 9.27419C18.6888 9.73442 18.6397 10.3629 18.4879 11.0033C18.3382 11.6352 18.0746 12.3396 17.5923 12.8979C17.0869 13.4828 16.3665 13.8744 15.4163 13.8744C13.7881 13.8744 12.7801 13.267 11.9056 12.74C11.8871 12.7289 11.8688 12.7179 11.8505 12.7068C10.993 12.1906 10.2412 11.7542 8.93625 11.7542C8.00391 11.7542 7.46363 12.3742 7.12334 13.2657C6.95675 13.7022 6.86216 14.1544 6.80996 14.5155C6.78413 14.6942 6.76931 14.8461 6.76102 14.9566C6.75321 15.0608 6.75168 15.1221 6.75146 15.1306Z"})}),FA=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.6289 16.4087C18.7672 16.1958 18.7885 15.9274 18.6854 15.6954L14.6854 6.6954C14.5242 6.3327 14.1083 6.15839 13.7367 6.29775L5.73666 9.29775C5.44393 9.40753 5.25 9.68737 5.25 10L5.25 16C5.25 16.4142 5.58578 16.75 6 16.75L18 16.75C18.2539 16.75 18.4905 16.6216 18.6289 16.4087ZM16.8459 15.25L6.75 15.25L6.75 10.5197L13.6017 7.95038L16.8459 15.25Z"})}),VA=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 14.5C13.3807 14.5 14.5 13.3807 14.5 12C14.5 10.6193 13.3807 9.5 12 9.5C10.6193 9.5 9.5 10.6193 9.5 12C9.5 13.3807 10.6193 14.5 12 14.5ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z"})}),xl=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.64645 4.64645C2.84171 4.45118 3.15829 4.45118 3.35355 4.64645L6 7.29289L8.64645 4.64645C8.84171 4.45118 9.15829 4.45118 9.35355 4.64645C9.54882 4.84171 9.54882 5.15829 9.35355 5.35355L6.35355 8.35355C6.15829 8.54882 5.84171 8.54882 5.64645 8.35355L2.64645 5.35355C2.45118 5.15829 2.45118 4.84171 2.64645 4.64645Z"})}),on=["rgb(80, 149, 127)","rgb(159, 161, 69)","rgb(128, 182, 109)","rgb(122, 168, 36)","rgb(96, 117, 159)","rgb(55, 124, 164)","rgb(78, 139, 212)","rgb(104, 198, 222)","rgb(136, 154, 221)","rgb(143, 125, 191)","rgb(158, 101, 179)","rgb(191, 105, 162)","rgb(204, 98, 92)","rgb(235, 147, 96)","rgb(213, 176, 42)","rgb(242, 218, 58)","rgb(173, 122, 103)","rgb(130, 100, 100)","rgb(128, 128, 128)","rgb(204, 204, 204)"],Go=t=>((!t||typeof t!="string")&&(t=on[bl(0,on.length-1)]),"#"+t.match(/\d+/g).map(n=>(+n).toString(16).padStart(2,0)).join``),HA=t=>{const{style:s}=new Option;return s.color=t,s.color},ir=t=>Go(HA(t));function zA(t,s){const n=on[bl(0,on.length-1)];return[{id:t,type:"circle",layout:{visibility:"visible"},paint:{"circle-color":n,"circle-radius":4,"circle-stroke-color":fd(-.4,n),"circle-stroke-width":1},source:`${s.source}_${t}`,"source-layer":s["source-layer"]}]}function UA(t,s){const n=on[bl(0,on.length-1)];return[{id:`${t}_case`,type:"line",layout:{visibility:"visible"},paint:{"line-color":fd(-.4,n),"line-width":3},source:`${s.source}_${t}`,"source-layer":s["source-layer"]},{id:t,type:"line",layout:{visibility:"visible"},paint:{"line-color":n,"line-width":3},source:`${s.source}_${t}`,"source-layer":s["source-layer"]}]}function WA(t,s){const n=on[bl(0,on.length-1)];return[{id:`${t}_case`,type:"line",layout:{visibility:"visible"},paint:{"line-color":fd(-.4,n),"line-width":1},source:`${s.source}_${t}`,"source-layer":s["source-layer"]},{id:t,type:"fill",layout:{visibility:"visible"},paint:{"fill-color":n,"fill-opacity":.75},source:`${s.source}_${t}`,"source-layer":s["source-layer"]}]}const GA=(t,s)=>{const n={fill:WA,line:UA,circle:zA};return n[s==null?void 0:s.type]?n[s==null?void 0:s.type](t,s):[s]},fd=(t,i)=>{var n=parseInt,r=Math.round,[a,l,i,c]=i.split(","),u=t<0,d=u?0:t*255**2,u=u?1+t:1-t;return"rgb"+(c?"a(":"(")+r((u*n(a[3]=="a"?a.slice(5):a.slice(4))**2+d)**.5)+","+r((u*n(l)**2+d)**.5)+","+r((u*n(i)**2+d)**.5)+(c?","+c:")")};function bl(t=0,s=100){return Math.floor(Math.random()*(s-t))+t}const JA=t=>{const s=b.useRef();return b.useEffect(()=>{s.current=t}),s.current},gd={cat1:["rgb(107, 184, 199)","rgb(229, 102, 102)","rgb(172, 114, 165)","rgb(114, 172, 120)","rgb(234, 147, 97)","rgb(166, 140, 217)","rgb(237, 190, 94)","rgb(103, 203, 148)","rgb(209, 152, 77)","rgb(168, 169, 96)"],cat2:["rgb(234, 147, 97)","rgb(136, 154, 221)","rgb(198, 150, 88)","rgb(139, 193, 168)","rgb(225, 184, 81)","rgb(206, 126, 168)","rgb(184, 203, 128)","rgb(152, 135, 196)","rgb(223, 215, 129)","rgb(148, 209, 152)"],cat3:["rgb(119, 170, 221)","rgb(238, 136, 102)","rgb(238, 221, 136)","rgb(255, 170, 187)","rgb(153, 221, 255)","rgb(68, 187, 153)","rgb(187, 204, 51)","rgb(112, 128, 207)","rgb(170, 170, 0)","rgb(170, 68, 153)"],cat4:["rgb(155, 201, 69)","rgb(138, 81, 158)","rgb(228, 136, 7)","rgb(195, 75, 143)","rgb(46, 137, 194)","rgb(60, 175, 154)","rgb(249, 122, 113)","rgb(223, 173, 22)","rgb(116, 116, 205)","rgb(179, 136, 86)"],cat5:["rgb(92, 107, 192)","rgb(255, 167, 38)","rgb(236, 64, 122)","rgb(66, 165, 245)","rgb(255, 112, 67)","rgb(102, 187, 106)","rgb(255, 213, 79)","rgb(38, 166, 154)","rgb(255, 138, 101)","rgb(126, 87, 194)"],cat6:["rgb(204, 102, 119)","rgb(51, 34, 136)","rgb(221, 204, 119)","rgb(17, 119, 51)","rgb(136, 204, 238)","rgb(136, 34, 85)","rgb(68, 170, 153)","rgb(153, 153, 51)","rgb(170, 68, 153)","rgb(238, 119, 51)"],cat7:["rgb(129, 144, 71)","rgb(93, 106, 42)","rgb(172, 114, 165)","rgb(107, 71, 128)","rgb(114, 127, 192)","rgb(76, 89, 154)","rgb(179, 126, 117)","rgb(141, 87, 78)","rgb(166, 140, 43)","rgb(76, 141, 154)"],cat8:["rgb(255, 115, 87)","rgb(255, 142, 66)","rgb(255, 173, 41)","rgb(249, 203, 21)","rgb(147, 208, 83)","rgb(40, 189, 140)","rgb(7, 166, 171)","rgb(64, 142, 191)","rgb(107, 127, 184)","rgb(138, 111, 165)"],cat9:["rgb(201, 63, 54)","rgb(219, 96, 51)","rgb(233, 125, 43)","rgb(242, 154, 38)","rgb(248, 187, 42)","rgb(191, 202, 88)","rgb(139, 179, 111)","rgb(103, 158, 125)","rgb(69, 130, 124)","rgb(40, 109, 128)"]};function Sb({open:t,setOpen:s,width:n="sm:my-8 sm:w-full sm:max-w-lg sm:p-6",initialFocus:r,children:a}){return e.jsx(Be.Root,{show:t,as:b.Fragment,children:e.jsxs(Je,{as:"div",className:"relative z-30 ",initialFocus:r,onClose:s,children:[e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),e.jsx("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:e.jsx("div",{onClick:()=>{s(!1)},className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:e.jsx(Je.Panel,{className:`relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all ${n}`,children:a})})})})]})})}function qA({open:t,setOpen:s}){var h;const n=b.useRef(null),{pgEnv:r,falcor:a,baseUrl:l}=w.useContext(ce),{state:i}=w.useContext(Ze),{collectionId:c}=Ye(),d=$e(),[u,p]=w.useState({name:"",loading:!1}),m=async()=>{var y;const f={name:u.name,collection_id:c,description:"map",symbology:{layers:{}}};console.log("newSymbology",f);let g=await a.call(["dama","symbology","symbology","create"],[r,f]),x=((y=Object.keys(C(g,["json","dama",r,"symbologies","byId"],{})))==null?void 0:y[0])||!1;await a.invalidate(["dama",r,"collections","byId",c,"symbologies","length"]),console.log("created symbology",g,x),x&&(s(!1),d(`${l}/collection/${c}/mapeditor/${x}`))};return e.jsxs(Sb,{open:t,setOpen:s,initialFocus:n,children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fad fa-layer-group text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full",children:[e.jsx(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:"Create New Map"}),e.jsx("div",{className:"mt-2 w-full",children:e.jsx("input",{value:u.name,onChange:f=>p({...i,name:f.target.value}),className:"p-2 bg-slate-100 text-lg font-medium w-full",placeholder:"Map Name"})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsxs("button",{type:"button",disabled:u.loading||((h=u.name)==null?void 0:h.length)<4,className:"disabled:bg-slate-300 disabled:cursor-warning inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto",onClick:m,children:["Creat",u.loading?"ing...":"e"]}),e.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>s(!1),ref:n,children:"Cancel"})]})]})}function KA({button:t}){const{state:s,setState:n,symbologies:r,collection:a}=w.useContext(Ze),{baseUrl:l}=w.useContext(ce),[i,c]=w.useState(!1),d=$e();return e.jsxs("div",{children:[e.jsx(qA,{open:i,setOpen:c}),e.jsxs(Oe,{as:"div",className:"relative inline-block text-left",children:[e.jsx(Oe.Button,{children:t}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsx(Oe.Items,{className:"absolute z-40 -left-[238px]  w-[270px] origin-top-right divide-y divide-gray-100 bg-slate-100 shadow-lg ring-1 ring-black/5 focus:outline-none",children:e.jsxs("div",{className:"px-1 py-1 ",children:[e.jsx(Oe.Item,{children:({active:u})=>e.jsx("div",{onClick:()=>c(!0),className:`${u?"bg-blue-50 ":""} group flex w-full items-center hover:bg-pink-100 text-slate-600 rounded-md px-2 py-2 text-sm`,children:"New Map"})}),e.jsx("div",{className:"w-full border"}),r.map(u=>e.jsx(Oe.Item,{children:e.jsx("div",{onClick:()=>d(`${l}/collection/${a.collection_id}/mapeditor/${u.symbology_id}`),className:"group flex w-full items-center hover:bg-pink-100 text-slate-600 rounded-md px-2 py-2 text-sm",children:u.name})},u.symbology_id))]})})})]})]})}function YA({button:t}){return w.useContext(Ze),e.jsxs(Oe,{as:"div",className:"relative inline-block text-left",children:[e.jsx(Oe.Button,{children:t}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsx(Oe.Items,{className:"absolute right-0 w-36 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",children:e.jsx("div",{className:" py-1 ",children:e.jsx(Oe.Item,{children:({active:s})=>e.jsx("div",{className:`${s?"bg-pink-50 ":""} group flex w-full items-center text-red-400 rounded-md px-2 py-2 text-sm`,onClick:()=>{},children:"Delete"})})})})})]})}function ZA(){const{state:t,setState:s}=w.useContext(Ze);return e.jsx("div",{className:"p-1",children:e.jsxs("div",{className:"flex bg-slate-100 border border-transparent hover:border-slate-300 group rounded-md shadow-sm ring-1 ring-inset ring-slate-100 focus-within:ring-2 focus-within:ring-inset focus-within:ring-pink-600 sm:max-w-md",children:[e.jsx("input",{type:"text",className:"block w-[220px] flex-1 outline-0  bg-transparent p-2 text-slate-800 placeholder:text-gray-400  focus:border-0  sm:leading-6",placeholder:"Select / Create New Map",value:t.name,onChange:n=>s(r=>{r.name=n.target.value})}),t.symbology_id&&e.jsx("div",{className:"flex items-center pt-1.5",children:e.jsx(YA,{button:e.jsx(gl,{className:"cursor-pointer fill-none group-hover:fill-gray-400 group-hover:hover:fill-pink-700"})})}),e.jsx("div",{className:"flex items-center ",children:e.jsx(KA,{button:e.jsxs("div",{className:"flex items-center p-2  border-2 border-transparent h-10  hover fill-slate-400 hover:fill-slate-800 cursor-pointer",children:[" ",e.jsx(xl,{className:""})," "]})})})]})})}const XA=({source:t,selectedSource:s,setSource:n,cat1:r,setCat1:a})=>{const{pgEnv:l,baseUrl:i,falcor:c,falcorCache:d}=w.useContext(ce),u=s.viewId,p=(s==null?void 0:s.sourceId)===t.source_id,m=["dama",l,"sources","byId",t.source_id,"views","length"],h=b.useMemo(()=>parseInt(C(d,m,0)),[d]);b.useEffect(()=>{async function g(){const x=await c.get(m);await c.get(["dama",l,"sources","byId",t.source_id,"views","byIndex",{from:0,to:C(x.json,m,0)-1},"attributes",Object.values(fn)])}g()},[c,d,t,l]);const f=b.useMemo(()=>Object.values(C(d,["dama",l,"sources","byId",t.source_id,"views","byIndex"],{})).map(g=>{var x;return ts((x=C(d,g.value,{}))==null?void 0:x.attributes)}).sort((g,x)=>new Date(x==null?void 0:x._modified_timestamp)-new Date(g==null?void 0:g._modified_timestamp)),[d]);return e.jsxs("div",{children:[e.jsx("div",{className:`w-full p-4 ${p?"bg-blue-100 hover:bg-blue-200":"bg-white hover:bg-blue-50"} block border shadow flex`,onClick:()=>{if(s.sourceId!==t.source_id){const g={...t,add:!0,sourceId:t.source_id};h===1&&f.length===1&&(g.viewId=f[0].view_id),n(g)}else n({...ac,add:!0})},children:e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-medium w-full block",children:e.jsx("span",{children:t.name})}),e.jsx("div",{children:(C(t,"categories",[])||[]).map(g=>(typeof g=="string"?[g]:g).map((x,y)=>{const j=x===r;let N="bg-blue-100 text-blue-400 hover:bg-blue-400";return(p||j)&&(N="bg-blue-300 text-blue-500 hover:bg-blue-400",p&&j&&(N="bg-blue-400 text-blue-600 hover:bg-blue-500")),e.jsx("div",{onClick:_=>{_.stopPropagation(),a(j?"":x)},className:`inline hover:cursor-pointer text-xs p-1 px-2 ${N}  mr-2`,children:x},y)}))}),e.jsx("div",{className:"py-2 block",children:t.description})]})}),p&&e.jsx("div",{className:"bg-gray-200 shadow",children:f.map(g=>{const x=u===g.view_id;return e.jsxs("div",{onClick:()=>{n(x?{...s,viewId:void 0}:{...s,viewId:g.view_id})},className:`flex items-center ${x?"bg-gray-300 hover:bg-gray-400":"hover:bg-gray-300"} px-2`,children:[e.jsx("div",{className:"mx-2",children:g.version??g.view_id}),x&&e.jsx(vc,{className:"ml-2 text-green-700 h-4 w-4"})]},g.view_id)})})]})},QA=({selectedSource:t,setSource:s})=>{var E,L;const[n,r]=b.useState(""),[a,l]=b.useState(),[i,c]=b.useState(),{pgEnv:d,baseUrl:u,falcor:p,falcorCache:m}=w.useContext(ce),[h,f]=b.useState("asc"),g="Unknown",x=((L=(E=window.location.pathname.replace(`${u}/`,""))==null?void 0:E.split("/"))==null?void 0:L[0])==="listall";b.useEffect(()=>{async function S(){const k=["dama",d,"sources","length"],$=await p.get(k);await p.get(["dama",d,"sources","byIndex",{from:0,to:C($.json,k,0)-1},"attributes",Object.values(Es)])}S()},[p,d]);const y=b.useMemo(()=>Object.values(C(m,["dama",d,"sources","byIndex"],{})).map(S=>ts(C(m,S.value,{attributes:{}}).attributes)),[m,d]),j=[...new Set(y.filter(S=>{var k;return x||!x&&!((k=S.categories)!=null&&k.find($=>$.includes(g)))}).reduce((S,k)=>{var $;return[...S,...(($=k.categories)==null?void 0:$.map(I=>I[0]))||[]]},[]))].sort(),N=j.reduce((S,k)=>{var $;return S[k]=($=y.filter(I=>{var T;return(T=I.categories)==null?void 0:T.find(A=>A.includes(k))}))==null?void 0:$.length,S},{}),_="bg-transparent hover:bg-blue-100 rounded-sm p-2 ml-0.5 border-2";return e.jsxs(ss,{baseUrl:u,isListAll:x,hideBreadcrumbs:!0,children:[e.jsxs("div",{className:"py-4 flex flex-rows items-center",children:[e.jsx("input",{className:"w-full text-lg p-2 border border-gray-300 ",placeholder:"Search datasources",value:n,onChange:S=>r(S.target.value)}),e.jsx("button",{className:_,title:"Toggle Sort",onClick:()=>f(h==="asc"?"desc":"asc"),children:e.jsx("i",{className:`fa-solid ${h==="asc"?"fa-arrow-down-z-a":"fa-arrow-down-a-z"} text-xl text-blue-400`})}),e.jsx("div",{onClick:()=>{l(""),r("")},className:_,title:x?"View Key Sources":"View All Sources",children:e.jsx("i",{className:`fa-solid ${x?"fa-filter-list":"fa-list-ul"} text-xl text-blue-400`})})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"w-1/4 flex flex-col space-y-1.5 max-h-[80dvh] overflow-auto scrollbar-sm",children:(j||[]).filter(S=>S!==g).sort((S,k)=>S.localeCompare(k)).map(S=>e.jsxs("div",{className:`${a===S||i===S?"bg-blue-100 hover:bg-blue-200":"bg-white hover:bg-blue-50"}  hover:cursor-pointer p-2 rounded-md flex items-center`,onClick:()=>{l(S===a?"":S)},children:[e.jsx("i",{className:"fa fa-category"}),S,e.jsx("div",{className:"bg-blue-200 text-blue-600 text-xs w-5 h-5 ml-2 shrink-0 grow-0 rounded-lg flex items-center justify-center border border-blue-300",children:N[S]})]},S))}),e.jsx("div",{className:"w-3/4 flex flex-col space-y-1.5 ml-1.5 max-h-[80dvh] overflow-auto scrollbar-sm",children:y.filter(S=>{var k;return x||!x&&!((k=S.categories)!=null&&k.find($=>$.includes(g)))}).filter(S=>{let k=!0;return a&&(k=!1,(C(S,"categories",[])||[]).forEach($=>{$[0]===a&&(!i||$[1]===i)&&(k=!0)})),k}).filter(S=>{let k=S.name+" "+((S==null?void 0:S.categories)||[]).reduce(($,I)=>($+=Array.isArray(I)?I.join(" "):typeof I=="string"?I:"",$),"");return!n.length>2||k.toLowerCase().includes(n.toLowerCase())}).sort((S,k)=>{var I;return(h==="asc"?1:-1)*((I=S.name)==null?void 0:I.localeCompare(k.name))}).map((S,k)=>e.jsx(XA,{cat1:a,setCat1:l,source:S,baseUrl:u,selectedSource:t,setSource:s},k))})]})]})},ac={active:!1,sourceId:null,viewId:null,add:!1};function eO(){const{state:t,setState:s}=w.useContext(Ze),{pgEnv:n,baseUrl:r,falcor:a,falcorCache:l}=w.useContext(ce),[i,c]=w.useState(ac);b.useEffect(()=>{async function h(){const f=["dama",n,"sources","length"],g=await a.get(f);await a.get(["dama",n,"sources","byIndex",{from:0,to:C(g.json,f,0)-1},"attributes",Object.values(Es)])}h()},[a,n]);const d=b.useMemo(()=>Object.values(C(l,["dama",n,"sources","byIndex"],{})).map(h=>ts(C(l,h.value,{attributes:{}}).attributes)),[l,n]);b.useEffect(()=>{async function h(){const{sourceId:f}=i,g=["dama",n,"sources","byId",f,"views","length"],x=await a.get(g);return await a.get(["dama",n,"sources","byId",f,"views","byIndex",{from:0,to:C(x.json,g,0)-1},"attributes",Object.values(fn)])}i.sourceId&&h()},[i.sourceId,a,n]);const u=b.useMemo(()=>Object.values(C(l,["dama",n,"sources","byId",i.sourceId,"views","byIndex"],{})).map(h=>ts(C(l,h.value,{attributes:{}}).attributes)),[l,i.sourceId,n]);b.useMemo(()=>{var h;return((h=t.symbology)==null?void 0:h.layers)||[]},[t.symbology]);const p=()=>{var j,N,_,E,L,S,k,$,I;const h=((j=d.filter(T=>T.source_id===+i.sourceId))==null?void 0:j[0])||{},f=((N=u.filter(T=>T.view_id===+i.viewId))==null?void 0:N[0])||{},g=Math.random().toString(36).replace(/[^a-z]+/g,""),x=(L=(E=(_=f==null?void 0:f.metadata)==null?void 0:_.tiles)==null?void 0:E.layers)==null?void 0:L[0],y={id:g,name:`${h.display_name||h.name} ${f.version||f.view_id}`,source_id:h.source_id,view_id:i.viewId,"layer-type":"simple",type:x.type,sources:(((k=(S=f==null?void 0:f.metadata)==null?void 0:S.tiles)==null?void 0:k.sources)||[]).map(T=>{const A={...T};return A.id=`${T.id}_${g}`,A}),layers:GA(g,x),isVisible:!0,order:((I=Object.keys((($=t==null?void 0:t.symbology)==null?void 0:$.layers)||{}))==null?void 0:I.length)||0};s(T=>{var A;T!=null&&T.symbology||(T.symbology={}),(A=T==null?void 0:T.symbology)!=null&&A.layers||(T.symbology.layers={}),he(T,`symbology.layers[${g}]`,y)}),c({add:!1,sourceId:null,viewId:null})},m=(i==null?void 0:i.sourceId)&&(i==null?void 0:i.viewId);return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"p-1 rounded hover:bg-slate-100 m-1",onClick:()=>c({...i,add:!i.add}),children:i.add?e.jsx($r,{className:"fill-slate-500"}):e.jsx(DA,{className:"fill-slate-500"})}),e.jsxs(Sb,{open:i.add,setOpen:()=>c({...i,add:!i.add}),width:"w-[1200px]",children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fad fa-layer-group text-blue-600","aria-hidden":"true"})}),e.jsx("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full",children:e.jsx(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:"Create New Map"})})]}),e.jsx("div",{className:"mt-2 w-full max-h-[calc(100vh_-_200px)]",children:e.jsx(QA,{selectedSource:i,setSource:c})}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex justify-end",children:[e.jsx("div",{className:"mr-1",children:e.jsx(We,{type:"button",themeOptions:{color:"cancel"},className:"inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>c({...ac}),children:"Cancel"})}),e.jsx("div",{children:e.jsx(We,{type:"button",themeOptions:m?{color:"primary"}:{color:"transparent"},disabled:!m,className:"inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>p(),children:"Add layer"})})]})]})]})}const tO={fill:FA,circle:VA,line:RA};function xd({layer:t,button:s,location:n="left-0"}){const{state:r,setState:a}=w.useContext(Ze);return e.jsxs(Oe,{as:"div",className:"relative inline-block text-left",children:[e.jsx(Oe.Button,{children:s}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsx(Oe.Items,{className:`absolute ${n} mt-1 w-36 origin-top-left divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none`,children:e.jsxs("div",{className:"px-1 py-1 ",children:[e.jsx(Oe.Item,{children:({active:l})=>e.jsx("div",{className:`${l?"bg-blue-50 ":""} group flex w-full items-center text-slate-600 rounded-md px-2 py-2 text-sm`,children:"Zoom to Fit"})}),e.jsx(Oe.Item,{children:({active:l})=>e.jsx("div",{className:`${l?"bg-pink-50 ":""} group flex w-full items-center text-red-400 rounded-md px-2 py-2 text-sm`,onClick:()=>{a(i=>{delete i.symbology.layers[t.id],Object.values(i.symbology.layers).sort((c,d)=>c.order-d.order).forEach((c,d)=>c.order=d)})},children:"Remove"})})]})})})]})}function sO({index:t,layer:s,i:n}){const{state:r,setState:a}=w.useContext(Ze),{activeLayer:l}=r.symbology,i=()=>{a(u=>{u.symbology.activeLayer=l===s.id?"":s.id})},c=tO[s.type]||e.jsx("span",{}),d=s.visible;return e.jsxs("div",{className:`w-full ${l==s.id?"bg-pink-100":""} p-2 py-1 flex border-white/85 border hover:border-pink-500 group items-center`,children:[e.jsx("div",{className:"px-1",children:e.jsx(c,{className:"fill-slate-400"})}),e.jsx("div",{onClick:i,className:"text-sm text-slate-600 font-medium truncate flex-1",children:s.name}),e.jsx("div",{className:"text-sm pt-1 px-0.5 flex items-center",children:e.jsx(xd,{layer:s,button:e.jsx(gl,{className:` ${l==s.id?"fill-pink-100":"fill-white"} cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`})})}),e.jsx("div",{onClick:()=>{a(u=>{u.symbology.layers[s.id].visible=!u.symbology.layers[s.id].visible})},children:d?e.jsx(Cb,{className:` ${l==s.id?"fill-pink-100":"fill-white"} cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`}):e.jsx(_b,{className:` ${l==s.id?"fill-pink-100":"fill-white"} cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`})})]})}function nO(t){const{state:s,setState:n}=w.useContext(Ze),r=b.useMemo(()=>{var l;return((l=s.symbology)==null?void 0:l.layers)||{}},[s]),a=w.useCallback((l,i)=>{n(c=>{const d=Object.values(c.symbology.layers);let u=Object.values(c.symbology.layers).length-1,p=u-l,m=u-i;const[h]=d.splice(p,1);d.splice(m,0,h),d.forEach((f,g)=>{f.order=g}),c.symbology.layers=d.reduce((f,g)=>(f[g.id]=g,f),{})})},[]);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-20 relative",children:e.jsx(Wn,{onDrop:a,offset:{x:16,y:45},children:Object.values(r).sort((l,i)=>i.order-l.order).map((l,i)=>e.jsx(sO,{layer:l,i},l.id))})})})}function aO({layer:t}){const{state:s,setState:n}=w.useContext(Ze),{activeLayer:r}=s.symbology,a=t.isVisible;return e.jsx("div",{onClick:()=>{n(l=>{l.symbology.layers[t.id].isVisible=!l.symbology.layers[t.id].isVisible,l.symbology.layers[t.id].layers.forEach((i,c)=>{let u=C(s,`symbology.layers[${t.id}].layers[${c}].layout.visibility`,"")==="visible"?"none":"visible";l.symbology.layers[t.id].layers[c].layout={visibility:u}})})},children:a?e.jsx(Cb,{className:` ${r==t.id?"fill-pink-100":"fill-white"} cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`}):e.jsx(_b,{className:` ${r==t.id?"fill-pink-100":"fill-white"} cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`})})}const ya={fill:({layer:t,color:s})=>e.jsx("div",{className:"pr-2",children:e.jsx("div",{className:"w-4 h-4 rounded ",style:{backgroundColor:s}})}),circle:({layer:t,color:s})=>{let n=C(t,"layers[0].paint['circle-stroke-color']","#ccc");return e.jsx("div",{className:"pl-0.5 pr-2",children:e.jsx("div",{className:"w-3 h-3 rounded-full ",style:{backgroundColor:s,borderColor:n}})})},line:({layer:t,color:s})=>e.jsx("div",{className:"pr-2",children:e.jsx("div",{className:"w-4 h-1",style:{backgroundColor:s}})})},cr={fill:t=>C(t,"layers[1].paint['fill-color']","#ccc"),circle:t=>C(t,"layers[0].paint['circle-color']","#ccc"),line:t=>C(t,"layers[1].paint['line-color']","#ccc")};function rO({layer:t}){const s=ya[t.type]||ya.fill;let n=(t==null?void 0:t["legend-data"])||[];return typeof cr[t.type](t)=="object"&&cr[t.type](t),(!n||n.length===0)&&(n=[]),e.jsx("div",{className:"w-full max-h-[250px] overflow-x-auto",children:n.map((r,a)=>e.jsxs("div",{className:"w-full flex items-center hover:bg-pink-50",children:[e.jsx("div",{className:"flex items-center h-6 w-10 justify-center  ",children:e.jsx(s,{color:r.color})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-500 h-6 text-sm truncate",children:r.label})]},a))})}function oO({layer:t}){const{state:s,setState:n}=w.useContext(Ze);let{choroplethdata:r,legenddata:a}=b.useMemo(()=>({choroplethdata:C(t,"['choropleth-data']",[]),legenddata:C(t,"['legend-data']",[])}),[s]);const l=ya[t.type]||ya.fill;let i=typeof cr[t.type](t)=="object"?cr[t.type](t):[];const c=Math.max(...r);return(!a||a.length===0)&&(a=[...(i||[]).filter((d,u)=>u>2).map((d,u)=>u%2===1?{color:i[u+1],label:`${i[u+2]} - ${i[u+4]||c}`}:null).filter(d=>d)]),e.jsx("div",{className:"w-full max-h-[250px] overflow-x-auto scrollbar-sm",children:a.map((d,u)=>e.jsxs("div",{className:"w-full flex items-center hover:bg-pink-50",children:[e.jsx("div",{className:"flex items-center h-6 w-10 justify-center  ",children:e.jsx(l,{color:d.color})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-500 h-6 text-sm truncate",children:d.label})]},u))})}function lO({index:t,layer:s,i:n}){const{state:r,setState:a}=w.useContext(Ze),{activeLayer:l}=r.symbology,i=()=>{a(p=>{p.symbology.activeLayer=l===s.id?"":s.id})},c=ya[s.type]||ya.fill;let d=cr[s.type](s);const u=s["layer-type"];return e.jsxs("div",{onClick:i,className:`${l==s.id?"bg-pink-100":""} hover:border-pink-500 group border`,children:[e.jsxs("div",{className:"w-full  p-2 py-1 flex border-blue-50/50 border  items-center",children:[(u==="simple"||!u)&&e.jsx("div",{className:"px-1",children:e.jsx(c,{layer:s,color:d})}),e.jsx("div",{className:"text-sm text-slate-600 font-medium truncate flex-1",children:s.name}),e.jsx("div",{className:"text-sm pt-1 px-0.5 flex items-center",children:e.jsx(xd,{layer:s,button:e.jsx(gl,{className:` ${l==s.id?"fill-pink-100":"fill-white"} cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`})})}),e.jsx(aO,{layer:s})]}),u==="categories"&&e.jsx(rO,{layer:s}),u==="choropleth"&&e.jsx(oO,{layer:s})]})}function iO(t){const{state:s,setState:n}=w.useContext(Ze),r=b.useMemo(()=>{var l;return((l=s.symbology)==null?void 0:l.layers)||{}},[s]),a=w.useCallback((l,i)=>{n(c=>{const d=Object.values(c.symbology.layers);let u=Object.values(c.symbology.layers).length-1,p=u-l,m=u-i;const[h]=d.splice(p,1);d.splice(m,0,h),d.forEach((f,g)=>{f.order=g}),c.symbology.layers=d.reduce((f,g)=>(f[g.id]=g,f),{})})},[]);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-20 relative max-h-[calc(100vh_-_220px)] overflow-x-auto scrollbar-sm ",children:e.jsx(Wn,{onDrop:a,offset:{x:16,y:45},children:Object.values(r).sort((l,i)=>i.order-l.order).map((l,i)=>e.jsx(lO,{layer:l,i},l.id))})})})}function cO(){const{state:t}=w.useContext(Ze),s=["Legend","Layers"];return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-white/95 w-[340px] rounded-lg drop-shadow-lg pointer-events-auto min-h-[400px] max-h-[calc(100vh_-_111px)] scroll-xs",children:[e.jsx(ZA,{}),t.symbology_id&&e.jsxs(mt.Group,{children:[e.jsxs("div",{className:"flex justify-between items-center border-b",children:[e.jsx(mt.List,{children:s.map(n=>e.jsx(mt,{as:b.Fragment,children:({selected:r})=>e.jsx("button",{className:`
                        ${r?"text-slate-600 border-b font-medium border-slate-600":"text-slate-400"} mx-1 text-sm p-2 cursor-pointer
                      `,children:n})},n))}),e.jsx(eO,{})]}),e.jsxs(mt.Panels,{children:[e.jsx(mt.Panel,{children:e.jsx(iO,{})}),e.jsx(mt.Panel,{children:e.jsx(nO,{})})]})]})]})})}const $b={fill:[{label:"Type",type:"inline",controls:[{type:"selectType",params:{options:[{name:"Simple",value:"simple"},{name:"Categories",value:"categories"},{name:"Color Range",value:"choropleth"}]},path:"['layer-type']",datapath:"layers[1].paint['fill-color']"}]},{label:"Color By",type:"inline",conditional:{path:"['layer-type']",conditions:["categories","choropleth"]},controls:[{type:"selectViewColumn",params:{options:[{name:"Column Select",value:"simple"}]},path:"['data-column']"}]},{label:"Categories",type:"popover",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoryControl",params:{options:[{name:"Column Select",value:"simple"}],format:t=>`${((t==null?void 0:t.length)-3||0)/2||"10"} Categories`},path:"layers[1].paint['fill-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoricalColor",path:"['color-set']"}]},{label:"Scale",type:"popover",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"choroplethControl",params:{format:t=>`${((t==null?void 0:t.length)-3||0)/2||"10"} Categories`},path:"layers[1].paint['fill-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"rangeColor",path:"['color-range']"}]},{label:"Fill",type:"popover",conditional:{path:"['layer-type']",conditions:["simple"]},controls:[{type:"color",path:"layers[1].paint['fill-color']"}]},{label:"Stroke",type:"popover",controls:[{type:"color",path:"layers[0].paint['line-color']"},{type:"range",unit:"px",path:"layers[0].paint['line-width']",params:{min:"0",max:"10",step:"0.5",default:"3",units:"px"}}]},{label:"Opacity",type:"inline",controls:[{type:"range",unit:"%",path:"layers[1].paint['fill-opacity']",params:{min:"0",max:"1",step:"0.01",default:"0.75",units:"%",format:t=>Math.round(t*100)}}]}],circle:[{label:"Type",type:"inline",controls:[{type:"selectType",params:{options:[{name:"Simple",value:"simple"},{name:"Categories",value:"categories"},{name:"Color Range",value:"choropleth"}]},path:"['layer-type']",datapath:"layers[0].paint['circle-color']"}]},{label:"Color By",type:"inline",conditional:{path:"['layer-type']",conditions:["categories","choropleth"]},controls:[{type:"selectViewColumn",params:{options:[{name:"Column Select",value:"simple"}]},path:"['data-column']",datapath:"['category-data']"}]},{label:"Categories",type:"popover",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoryControl",params:{options:[{name:"Column Select",value:"simple"}],format:t=>`${((t==null?void 0:t.length)||0)/2||"10"} Categories`},path:"layers[0].paint['circle-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoricalColor",path:"['color-set']"}]},{label:"Scale",type:"popover",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"choroplethControl",params:{format:t=>`${((t==null?void 0:t.length)-3||0)/2||"10"} Categories`},path:"layers[1].paint['circle-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"rangeColor",path:"['color-range']"}]},{label:"Fill",type:"popover",conditional:{path:"['layer-type']",conditions:["simple"]},controls:[{type:"color",path:"layers[0].paint['circle-color']"}]},{label:"Size",type:"inline",controls:[{type:"range",unit:"%",path:"layers[0].paint['circle-radius']",params:{min:"0",max:"20",step:"0.5",default:"3",units:"px"}}]},{label:"Stroke",type:"popover",controls:[{type:"color",path:"layers[0].paint['circle-stroke-color']"},{type:"range",unit:"px",path:"layers[0].paint['circle-stroke-width']",params:{min:"0",max:"20",step:"0.5",default:"3",units:"px"}}]},{label:"Opacity",type:"inline",controls:[{type:"range",unit:"%",path:"layers[0].paint['circle-opacity']",params:{min:"0",max:"1",step:"0.01",default:"0.75",units:"%",format:t=>Math.round(t*100)}}]}],line:[{label:"Type",type:"inline",controls:[{type:"selectType",params:{options:[{name:"Simple",value:"simple"},{name:"Categories",value:"categories"},{name:"Color Range",value:"choropleth"}]},path:"['layer-type']",datapath:"layers[1].paint['line-color']"}]},{label:"Color By",type:"inline",conditional:{path:"['layer-type']",conditions:["categories","choropleth"]},controls:[{type:"selectViewColumn",params:{options:[{name:"Column Select",value:"simple"}]},path:"['data-column']",datapath:"['category-data']"}]},{label:"Categories",type:"popover",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoryControl",params:{options:[{name:"Column Select",value:"simple"}],format:t=>`${((t==null?void 0:t.length)-3||0)/2||"10"} Categories`},path:"layers[1].paint['line-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoricalColor",path:"['color-set']"}]},{label:"Scale",type:"popover",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"choroplethControl",params:{format:t=>`${((t==null?void 0:t.length)-3||0)/2||"10"} Categories`},path:"layers[1].paint['line-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"rangeColor",path:"['color-range']"}]},{label:"Fill",type:"popover",conditional:{path:"['layer-type']",conditions:["simple"]},controls:[{type:"color",path:"layers[1].paint['line-color']"}]},{label:"Size",type:"inline",controls:[{type:"range",unit:"%",path:"layers[1].paint['line-width']",params:{min:"0",max:"20",step:"0.5",default:"3",units:"px"}}]},{label:"Offset",type:"inline",controls:[{type:"range",unit:"%",path:"layers[1].paint['line-offset']",params:{min:"-10",max:"10",step:"0.5",default:"0",units:"px"}}]},{label:"Casing",type:"popover",controls:[{type:"color",path:"layers[0].paint['line-color']"},{type:"range",unit:"px",path:"layers[0].paint['line-width']",params:{min:"0",max:"20",step:"0.5",default:"3",units:"px"}},{type:"range",unit:"px",path:"layers[0].paint['line-offset']",params:{min:"-10",max:"10",step:"0.5",default:"0",units:"px"}}]},{label:"Opacity",type:"inline",controls:[{type:"range",unit:"%",path:"layers[1].paint['line-opacity']",params:{min:"0",max:"1",step:"0.01",default:"0.75",units:"%",format:t=>Math.round(t*100)}}]}]};function dO(t,s,n,r=10,a="#ccc",l){var p,m;let i=JSON.parse(((m=((p=l.filter(h=>h.name===t))==null?void 0:p[0])||{})==null?void 0:m.meta_lookup)||"{}"),d=["match",["to-string",["get",(t||"").includes("AS ")?t.split("AS ")[1]:t]]];Array.from(Array(+r).keys()).forEach((h,f)=>{var x,y;let g=""+((x=s==null?void 0:s[f])==null?void 0:x[t]);g&&g!="[object Object]"&&(d.push(""+((y=s==null?void 0:s[f])==null?void 0:y[t])),d.push(ir(n[f%n.length])))}),d.push(a);const u=(d||[]).filter((h,f)=>f>2).map((h,f)=>f%2===0?{color:h,label:C(i,d[f+2],d[f+2])}:null).filter(h=>h);return{paint:d,legend:u}}function uO(t){let s=typeof t=="object"&&Array.isArray(t);return s&&(t.forEach(n=>{(!n||n==="undefined")&&(s=!1)}),s)}let mO={ckmeans:zo,equalInterval:RM,jenks:zo,pretty:FM},pO=(t,s=2)=>(n=>Math.round(t*n)/n)(Math.pow(10,s));function hO(t,s,n,r=10,a="ckmeans"){let l=["step",["get",t]];if(!Array.isArray(s))return!1;let i=mO[a](s,r).map(u=>pO(u,2));const c=Math.max(...s);if(!Array.isArray(i)||i.length===0)return!1;console.log("max",c),i.forEach((u,p)=>{l.push(n[p]),l.push(+u)}),l.push(n[r-1]);const d=[...(l||[]).filter((u,p)=>p>2).map((u,p)=>p%2===1?{color:l[p+1],label:`${Rm(l[p+2])} - ${Rm(l[p+4]||c)}`}:null).filter(u=>u)];return console.log("legend",d),{paint:l,legend:d}}const Rm=(t,s=2,n=!1)=>t>=1e12?`${n?"$":""} ${(t/1e12).toFixed(s)} T`:t>=1e9?`${n?"$":""} ${(t/1e9).toFixed(s)} B`:t>=1e6?`${n?"$":""} ${(t/1e6).toFixed(s)} M`:t>=1e3?`${n?"$":""} ${(t/1e3).toFixed(s)} K`:typeof t=="object"?"":`${n?"$":""} ${parseInt(t)}`,Qt={seq1:{2:["#f7e76e","#ce141f"],3:["#f7e76e","#ec962a","#ce141f"],4:["#f7e76e","#f1b33d","#e5751d","#ce141f"],5:["#f7e76e","#f3c048","#ec962a","#e1631a","#ce141f"],6:["#f7e76e","#f4c94f","#efa835","#e88321","#de581a","#ce141f"],7:["#f7e76e","#f4ce54","#f1b33d","#ec962a","#e5751d","#dc501a","#ce141f"],8:["#f7e76e","#f5d157","#f2bb43","#eea331","#e98823","#e36b1b","#da491b","#ce141f"],9:["#f7e76e","#f5d45a","#f3c048","#f0ac38","#ec962a","#e77e1f","#e1631a","#d9451b","#ce141f"]},seq2:{2:["#fde89b","#4d53b3"],3:["#fde89b","#f37b8a","#4d53b3"],4:["#fde89b","#ff9e81","#d4629b","#4d53b3"],5:["#fde89b","#ffb080","#f37b8a","#bd5aa4","#4d53b3"],6:["#fde89b","#ffbc82","#fe8f83","#e36a94","#ad57a9","#4d53b3"],7:["#fde89b","#ffc385","#ff9e81","#f37b8a","#d4629b","#a056ac","#4d53b3"],8:["#fde89b","#ffc887","#ffa880","#fb8985","#e86f91","#c85da0","#9755ad","#4d53b3"],9:["#fde89b","#ffcc88","#ffb080","#ff9582","#f37b8a","#de6797","#bd5aa4","#9055af","#4d53b3"]},seq3:{2:["#f2e68c","#035d6d"],3:["#f2e68c","#59a884","#035d6d"],4:["#f2e68c","#87bf84","#319082","#035d6d"],5:["#f2e68c","#a0ca84","#59a884","#1f837f","#035d6d"],6:["#f2e68c","#afd084","#74b684","#409984","#147b7d","#035d6d"],7:["#f2e68c","#bad485","#87bf84","#59a884","#319082","#0e767b","#035d6d"],8:["#f2e68c","#c2d785","#95c584","#6cb284","#479e84","#268881","#097379","#035d6d"],9:["#f2e68c","#c8d986","#a0ca84","#7bb984","#59a884","#3a9683","#1f837f","#077078","#035d6d"]},seq4:{2:["#e8e873","#4b5899"],3:["#e8e873","#2cbaa8","#4b5899"],4:["#e8e873","#62d198","#209eb0","#4b5899"],5:["#e8e873","#84d98c","#2cbaa8","#2d8eaf","#4b5899"],6:["#e8e873","#98dd85","#4ac9a0","#1caaae","#3483ad","#4b5899"],7:["#e8e873","#a5e081","#62d198","#2cbaa8","#209eb0","#397cab","#4b5899"],8:["#e8e873","#afe17e","#75d691","#41c5a2","#1eafad","#2795af","#3d77a9","#4b5899"],9:["#e8e873","#b6e27c","#84d98c","#53cc9d","#2cbaa8","#1ca5af","#2d8eaf","#3f74a8","#4b5899"]},seq5:{2:["#f3cdb4","#c33c3c"],3:["#f3cdb4","#dd8a6c","#c33c3c"],4:["#f3cdb4","#e5a182","#d57259","#c33c3c"],5:["#f3cdb4","#e8ac8d","#dd8a6c","#d16651","#c33c3c"],6:["#f3cdb4","#eab395","#e29879","#d87c61","#ce5e4c","#c33c3c"],7:["#f3cdb4","#ecb79a","#e5a182","#dd8a6c","#d57259","#cc5949","#c33c3c"],8:["#f3cdb4","#edba9d","#e7a788","#e09475","#da8064","#d36b54","#cb5547","#c33c3c"],9:["#f3cdb4","#eebda0","#e8ac8d","#e39b7c","#dd8a6c","#d7785e","#d16651","#ca5246","#c33c3c"]},seq6:{2:["#f6e389","#cd4c71"],3:["#f6e389","#f49566","#cd4c71"],4:["#f6e389","#f7af6b","#ec7b66","#cd4c71"],5:["#f6e389","#f8bc70","#f49566","#e66e68","#cd4c71"],6:["#f6e389","#f8c474","#f6a568","#ef8566","#e26769","#cd4c71"],7:["#f6e389","#f8c976","#f7af6b","#f49566","#ec7b66","#df626b","#cd4c71"],8:["#f6e389","#f8cd79","#f8b76d","#f6a067","#f18a66","#e87467","#dd5f6b","#cd4c71"],9:["#f6e389","#f8d07a","#f8bc70","#f7a869","#f49566","#ee8166","#e66e68","#db5c6c","#cd4c71"]},seq7:{2:["#f2e9a6","#344e31"],3:["#f2e9a6","#8a9968","#344e31"],4:["#f2e9a6","#abb47c","#6b8055","#344e31"],5:["#f2e9a6","#bcc186","#8a9968","#5d734c","#344e31"],6:["#f2e9a6","#c6c98c","#9da974","#778a5c","#546b46","#344e31"],7:["#f2e9a6","#cdce90","#abb47c","#8a9968","#6b8055","#4e6643","#344e31"],8:["#f2e9a6","#d3d293","#b4bb81","#98a570","#7c8e60","#637850","#4b6340","#344e31"],9:["#f2e9a6","#d6d596","#bcc186","#a2ad77","#8a9968","#73865a","#5d734c","#48603e","#344e31"]},seq8:{2:["#d2e2a6","#096b6d"],3:["#d2e2a6","#6ba888","#096b6d"],4:["#d2e2a6","#8cbc91","#4d9480","#096b6d"],5:["#d2e2a6","#9dc596","#6ba888","#3e897b","#096b6d"],6:["#d2e2a6","#a7cb98","#7fb48d","#599c83","#358379","#096b6d"],7:["#d2e2a6","#aecf9b","#8cbc91","#6ba888","#4d9480","#2f7f77","#096b6d"],8:["#d2e2a6","#b3d29c","#95c193","#79b08c","#5e9f85","#448e7d","#2a7c76","#096b6d"],9:["#d2e2a6","#b7d49d","#9dc596","#84b78f","#6ba888","#549982","#3e897b","#277a75","#096b6d"]},seq9:{2:["#ebdbad","#27859c"],3:["#ebdbad","#7eb699","#27859c"],4:["#ebdbad","#a2c39a","#5ba79b","#27859c"],5:["#ebdbad","#b4ca9c","#7eb699","#4b9f9c","#27859c"],6:["#ebdbad","#c0cd9e","#93be99","#68ad9a","#429a9c","#27859c"],7:["#ebdbad","#c7d0a0","#a2c39a","#7eb699","#5ba79b","#3c979d","#27859c"],8:["#ebdbad","#ccd1a1","#adc79b","#8dbc99","#6eb099","#51a29b","#38949d","#27859c"],9:["#ebdbad","#d0d2a3","#b4ca9c","#99c099","#7eb699","#63ab9a","#4b9f9c","#35929d","#27859c"]},seq10:{2:["#d0f0da","#274c72"],3:["#d0f0da","#609fa8","#274c72"],4:["#d0f0da","#82bab7","#438398","#274c72"],5:["#d0f0da","#95c8bf","#609fa8","#387590","#274c72"],6:["#d0f0da","#a0d0c4","#74afb1","#4e8e9f","#336d8b","#274c72"],7:["#d0f0da","#a8d5c7","#82bab7","#609fa8","#438398","#306887","#274c72"],8:["#d0f0da","#aed9ca","#8dc2bb","#6eabae","#5393a1","#3d7b94","#2e6484","#274c72"],9:["#d0f0da","#b2dccc","#95c8bf","#79b3b3","#609fa8","#4a8a9c","#387590","#2c6182","#274c72"]},seq11:{2:["#ffcdc6","#513a8d"],3:["#f3c0b9","#bd6f95","#513a8d"],4:["#f3c0b9","#d3899c","#a15991","#513a8d"],5:["#f3c0b9","#dc96a1","#bd6f95","#915090","#513a8d"],6:["#f3c0b9","#e19ea5","#cb7e99","#ad6293","#864a90","#513a8d"],7:["#f3c0b9","#e5a4a8","#d3899c","#bd6f95","#a15991","#7f478f","#513a8d"],8:["#f3c0b9","#e7a8aa","#d8909f","#c77a98","#b26593","#985491","#79458f","#513a8d"],9:["#f3c0b9","#e8abac","#dc96a1","#ce829a","#bd6f95","#a95e92","#915090","#75438f","#513a8d"]},seq12:{2:["#e9c5ed","#663b91"],3:["#e9c5ed","#aa7dbd","#663b91"],4:["#e9c5ed","#bf94cc","#9466ae","#663b91"],5:["#e9c5ed","#caa0d4","#aa7dbd","#895ba7","#663b91"],6:["#e9c5ed","#d0a7d9","#b78bc6","#9d6fb4","#8255a2","#663b91"],7:["#e9c5ed","#d4acdc","#bf94cc","#aa7dbd","#9466ae","#7d509f","#663b91"],8:["#e9c5ed","#d7b0df","#c59bd1","#b387c4","#a173b6","#8e60aa","#7a4d9d","#663b91"],9:["#e9c5ed","#dab2e1","#caa0d4","#ba8ec9","#aa7dbd","#996cb2","#895ba7","#784b9c","#663b91"]},div1:{2:["#2b8bab","#dc565f"],3:["#2b8bab","#eff4c8","#dc565f"],4:["#2b8bab","#a4d5b5","#e8c68b","#dc565f"],5:["#2b8bab","#7fc4b2","#eff4c8","#e7ac74","#dc565f"],6:["#2b8bab","#69bab1","#c2e2ba","#e9d9a2","#e79c6a","#dc565f"],7:["#2b8bab","#5cb2b1","#a4d5b5","#eff4c8","#e8c68b","#e69165","#dc565f"],8:["#2b8bab","#52adb0","#8fccb3","#cfe7bd","#eae1ac","#e7b87d","#e58962","#dc565f"],9:["#2b8bab","#4ca9b0","#7fc4b2","#b7ddb8","#eff4c8","#e9d299","#e7ac74","#e58360","#dc565f"]},div2:{2:["#448480","#c54b3e"],3:["#448480","#f9dd35","#c54b3e"],4:["#448480","#a0b169","#e9932f","#c54b3e"],5:["#448480","#a0b169","#f9dd35","#e9932f","#c54b3e"],6:["#448480","#82a373","#bec05c","#f0ac30","#e07b31","#c54b3e"],7:["#448480","#82a373","#bec05c","#f9dd35","#f0ac30","#e07b31","#c54b3e"],8:["#448480","#729b77","#a0b169","#cdc755","#f2b830","#e9932f","#db6e32","#c54b3e"],9:["#448480","#729b77","#a0b169","#cdc755","#f9dd35","#f2b830","#e9932f","#db6e32","#c54b3e"]},div3:{3:["#3166aa","#efefef","#c73d4b"],4:["#3166aa","#b6bfd9","#eab7b5","#c73d4b"],5:["#3166aa","#98a8cd","#efefef","#e49a99","#c73d4b"],6:["#3166aa","#869ac6","#cdd2e2","#edcdcc","#e08989","#c73d4b"],7:["#3166aa","#7a91c1","#b6bfd9","#efefef","#eab7b5","#dc7d7e","#c73d4b"],8:["#3166aa","#718bbe","#a5b2d2","#d7dbe6","#eed7d6","#e7a6a5","#da7576","#c73d4b"],9:["#3166aa","#6a86bc","#98a8cd","#c4cbde","#efefef","#ecc5c4","#e49a99","#d86e71","#c73d4b"]},div4:{2:["#518646","#d74528"],3:["#518646","#f8dea0","#d74528"],4:["#518646","#a6b26e","#e8995b","#d74528"],5:["#518646","#a6b26e","#f8dea0","#e8995b","#d74528"],6:["#518646","#8ba35d","#c1c07e","#eeb072","#e38042","#d74528"],7:["#518646","#8ba35d","#c1c07e","#f8dea0","#eeb072","#e38042","#d74528"],8:["#518646","#7d9c56","#a6b26e","#cfc887","#f0bc7e","#e8995b","#e07339","#d74528"],9:["#518646","#7d9c56","#a6b26e","#cfc887","#f8dea0","#f0bc7e","#e8995b","#e07339","#d74528"]},div5:{2:["#59a1a6","#a67b30"],3:["#59a1a6","#f5f5a3","#a67b30"],4:["#59a1a6","#a8cba4","#cdb769","#a67b30"],5:["#59a1a6","#a8cba4","#f5f5a3","#cdb769","#a67b30"],6:["#59a1a6","#8ebda5","#c2d9a4","#dacb7c","#c0a356","#a67b30"],7:["#59a1a6","#8ebda5","#c2d9a4","#f5f5a3","#dacb7c","#c0a356","#a67b30"],8:["#59a1a6","#81b6a5","#a8cba4","#cee0a4","#e1d685","#cdb769","#b9994c","#a67b30"],9:["#59a1a6","#81b6a5","#a8cba4","#cee0a4","#f5f5a3","#e1d685","#cdb769","#b9994c","#a67b30"]},div6:{2:["#8b4583","#4a6147"],3:["#8b4583","#f9f2bf","#4a6147"],4:["#8b4583","#c29ba1","#9ea781","#4a6147"],5:["#8b4583","#c29ba1","#f9f2bf","#9ea781","#4a6147"],6:["#8b4583","#b07e97","#d4b8ab","#bcbf95","#818f6d","#4a6147"],7:["#8b4583","#b07e97","#d4b8ab","#f9f2bf","#bcbf95","#818f6d","#4a6147"],8:["#8b4583","#a77092","#c29ba1","#ddc6b0","#cbcc9f","#9ea781","#738363","#4a6147"],9:["#8b4583","#a77092","#c29ba1","#ddc6b0","#f9f2bf","#cbcc9f","#9ea781","#738363","#4a6147"]},schemeGroups:{sequential:["seq1","seq2","seq3","seq4","seq5","seq6","seq7","seq8","seq9","seq10","seq11","seq12"],singlehue:[],diverging:["div1","div2","div3","div4","div5","div6"]}};function Eb({button:t,children:s}){return w.useContext(Ze),e.jsxs(Oe,{as:"div",className:"relative inline-block text-left w-full",children:[e.jsx(Oe.Button,{className:"w-full",children:t}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsx(Oe.Items,{className:"absolute -right-[10px] w-[226px] max-h-[400px] overflow-auto py-2 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none z-20",children:s})})]})}function fO({path:t,datapath:s,params:n={}}){var $,I;const{state:r,setState:a}=w.useContext(Ze),{falcor:l,falcorCache:i,pgEnv:c}=w.useContext(ce);let{value:d,viewId:u,sourceId:p,paintValue:m,column:h,categories:f,categorydata:g,choroplethdata:x,colors:y,colorrange:j,numCategories:N,numbins:_,method:E,showOther:L}=b.useMemo(()=>({value:C(r,`symbology.layers[${r.symbology.activeLayer}].${t}`,{}),viewId:C(r,`symbology.layers[${r.symbology.activeLayer}].view_id`),sourceId:C(r,`symbology.layers[${r.symbology.activeLayer}].source_id`),paintValue:C(r,`symbology.layers[${r.symbology.activeLayer}].${s}`,{}),column:C(r,`symbology.layers[${r.symbology.activeLayer}]['data-column']`,""),categories:C(r,`symbology.layers[${r.symbology.activeLayer}]['categories']`,{}),categorydata:C(r,`symbology.layers[${r.symbology.activeLayer}]['category-data']`,{}),choroplethdata:C(r,`symbology.layers[${r.symbology.activeLayer}]['choropleth-data']`,{}),colors:C(r,`symbology.layers[${r.symbology.activeLayer}]['color-set']`,gd.cat1),colorrange:C(r,`symbology.layers[${r.symbology.activeLayer}]['color-range']`,Qt.seq1[9]),numbins:C(r,`symbology.layers[${r.symbology.activeLayer}]['num-bins']`,9),method:C(r,`symbology.layers[${r.symbology.activeLayer}]['bin-method']`,"ckmeans"),numCategories:C(r,`symbology.layers[${r.symbology.activeLayer}]['num-categories']`,10),showOther:C(r,`symbology.layers[${r.symbology.activeLayer}]['category-show-other']`,"#ccc")}),[r]);b.useEffect(()=>{p&&l.get(["dama",c,"sources","byId",p,"attributes","metadata"])},[p]);const S=b.useMemo(()=>{let T=C(i,["dama",c,"sources","byId",p,"attributes","metadata","value","columns"],[]);return T.length===0&&(T=C(i,["dama",c,"sources","byId",p,"attributes","metadata","value"],[])),T},[p,i]),k=b.useMemo(()=>{const T=(S==null?void 0:S.length)>0,A=S.reduce((R,O)=>(["integer","number"].includes(O.type)&&(R=!0),R),!1);return[{name:"Simple",value:"simple"},T?{name:"Categories",value:"categories"}:null,A?{name:"Color Range",value:"choropleth"}:null].filter(R=>R)},[S]);return w.useEffect(()=>{if(d==="categories"){let{paint:T,legend:A}=f!=null&&f.paint?f:dO(h,g,y,N,L,S);uO(T)&&!Fe(T,m)&&a(R=>{he(R,`symbology.layers[${r.symbology.activeLayer}].${s}`,T),he(R,`symbology.layers[${r.symbology.activeLayer}]['legend-data']`,A)})}else if(d==="choropleth"){let{paint:T,legend:A}=hO(h,x,j,_,E);T&&!Fe(T,m)&&a(R=>{he(R,`symbology.layers[${r.symbology.activeLayer}].${s}`,T),he(R,`symbology.layers[${r.symbology.activeLayer}]['legend-data']`,A)})}else d==="simple"&&typeof m!="string"&&a(T=>{he(T,`symbology.layers[${r.symbology.activeLayer}].${s}`,Go(null))})},[d,h,g,y,N,L,x,j,_,E]),e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsx("select",{className:"w-full p-2 bg-transparent",value:C(r,`symbology.layers[${r.symbology.activeLayer}].${t}`,n.default||((I=($=n==null?void 0:n.options)==null?void 0:$[0])==null?void 0:I.value)),onChange:T=>a(A=>{he(A,`symbology.layers[${r.symbology.activeLayer}].${t}`,T.target.value)}),children:(k||[]).map((T,A)=>e.jsx("option",{value:T.value,children:T.name},A))})})})}function gO({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(Ze);return e.jsxs("label",{className:"flex",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"color",value:ir(C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,"#ccc")),onChange:a=>r(l=>{he(l,`symbology.layers[${n.symbology.activeLayer}].${t}`,a.target.value)})})}),e.jsx("div",{className:"flex items-center p-2",children:"Custom "})]})}function xO({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(Ze),a=i=>i,l=(s==null?void 0:s.format)||a;return e.jsxs("div",{className:"flex w-full  items-center",children:[e.jsx("div",{className:"flex-1 flex w-full",children:e.jsx("input",{className:'w-full flex-1 accent-slate-600 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">',type:"range",min:s.min||"0",max:s.max||"1",step:s.step||"0.01",value:C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,s.default||"1"),onChange:i=>r(c=>{he(c,`symbology.layers[${n.symbology.activeLayer}].${t}`,+i.target.value)})})}),e.jsx("div",{className:"pl-2",children:e.jsx("input",{className:"w-14 px-2 py-1 bg-transparent",value:`${l(C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,s.default||"1"))}${s.units?s.units:""}`,onChange:()=>{}})})]})}function bO({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(Ze);return e.jsx("label",{className:"flex",children:e.jsx("div",{className:"flex items-center",children:e.jsx("input",{className:"w-full",type:"text",value:C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,(s==null?void 0:s.default)??"#ccc"),onChange:a=>r(l=>{he(l,`symbology.layers[${n.symbology.activeLayer}].${t}`,a.target.value)})})})})}function kb({path:t,params:s={}}){var a,l;const{state:n,setState:r}=w.useContext(Ze);return e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsx("select",{className:"w-full py-2 bg-transparent",value:C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,s.default||((l=(a=s==null?void 0:s.options)==null?void 0:a[0])==null?void 0:l.value)),onChange:i=>r(c=>{he(c,`symbology.layers[${n.symbology.activeLayer}].${t}`,i.target.value)}),children:((s==null?void 0:s.options)||[]).map((i,c)=>e.jsx("option",{value:i.value,children:i.name},c))})})})}function yO({path:t,datapath:s,params:n={}}){const{state:r,setState:a}=w.useContext(Ze),{falcor:l,falcorCache:i,pgEnv:c}=w.useContext(ce),{layerType:d,viewId:u,sourceId:p}=b.useMemo(()=>({layerType:C(r,`symbology.layers[${r.symbology.activeLayer}]['layer-type']`),viewId:C(r,`symbology.layers[${r.symbology.activeLayer}].view_id`),sourceId:C(r,`symbology.layers[${r.symbology.activeLayer}].source_id`)}),[r]),m=b.useMemo(()=>C(r,`symbology.layers[${r.symbology.activeLayer}].${t}`,null),[r]);b.useEffect(()=>{p&&l.get(["dama",c,"sources","byId",p,"attributes","metadata"])},[p]);const h=b.useMemo(()=>{let f=C(i,["dama",c,"sources","byId",p,"attributes","metadata","value","columns"],[]);return f.length===0&&(f=C(i,["dama",c,"sources","byId",p,"attributes","metadata","value"],[])),f},[p,i]);return b.useEffect(()=>{if(m&&d==="categories"){const f=JSON.stringify({groupBy:[m.split("AS ")[0]],exclude:{[m.split("AS ")[0]]:["null"]},orderBy:{2:"desc"}});l.get(["dama",c,"viewsbyId",u,"options",f,"databyIndex",{from:0,to:100},[m,"count(1)::int as count"]])}},[m]),b.useEffect(()=>{if(m&&d==="categories"){const f=JSON.stringify({groupBy:[m.split("AS ")[0]],exclude:{[m.split("AS ")[0]]:["null"]},orderBy:{2:"desc"}});let g=C(i,["dama",c,"viewsbyId",u,"options",f,"databyIndex"],{});a(x=>{he(x,`symbology.layers[${r.symbology.activeLayer}]['category-data']`,g)})}},[m,i]),b.useEffect(()=>{m&&d==="choropleth"&&(async()=>{const g=JSON.stringify({exclude:{[m]:["null"]}}),x=await l.get(["dama",c,"viewsbyId",u,"options",g,"length"]);let y=C(x,["json","dama",c,"viewsbyId",u,"options",g,"length"],0);y>0&&l.get(["dama",c,"viewsbyId",u,"options",g,"databyIndex",{from:0,to:y-1},m])})()},[m]),b.useEffect(()=>{if(d==="choropleth"){const f=JSON.stringify({exclude:{[m]:["null"]}});let g=Object.values(C(i,["dama",c,"viewsbyId",u,"options",f,"databyIndex"],{})).map((x,y)=>x[m]||null).filter(x=>x).sort((x,y)=>x-y);a(x=>{he(x,`symbology.layers[${r.symbology.activeLayer}]['choropleth-data']`,g)})}},[m,i]),e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsx("select",{className:"w-full p-2 bg-transparent",value:m,onChange:f=>a(g=>{let x=C(r,`symbology.layers[${r.symbology.activeLayer}].sources[0].source.tiles[0]`,"no source tiles").split("?")[0];x!=="no source tiles"&&he(g,`symbology.layers[${r.symbology.activeLayer}].sources[0].source.tiles[0]`,x+`?cols=${f.target.value}`),he(g,`symbology.layers[${r.symbology.activeLayer}].categories`,{}),he(g,`symbology.layers[${r.symbology.activeLayer}].${t}`,f.target.value)}),children:(h||[]).filter(f=>!(d==="choropleth"&&!["integer","number"].includes(f.type))).filter(f=>!["wkb_geometry"].includes(f.name)).map((f,g)=>e.jsx("option",{value:f.name,children:f.display_name||f.name},g))})})})}function vO({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(Ze);let a=C(n,`symbology.layers[${n.symbology.activeLayer}]['range-key']`,Qt.schemeGroups.sequential[0]),l=C(n,`symbology.layers[${n.symbology.activeLayer}]['num-bins']`,9),i=C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,Qt[a][l]);return e.jsx("div",{className:"flex w-full items-center",children:e.jsxs(Eb,{button:e.jsxs("div",{className:"flex items-center w-full cursor-pointer flex-1",children:[e.jsx("div",{className:"flex-1 flex justify-center ",children:(i.map?i:[]).map((c,d)=>e.jsx("div",{className:"flex-1 h-4",style:{backgroundColor:c}},d))}),e.jsx("div",{className:"flex items-center px-1 border-2 border-transparent h-8  hover fill-slate-400 hover:fill-slate-800 cursor-pointer",children:e.jsx(xl,{className:""})})]}),children:[e.jsx(Oe.Item,{className:"z-20",children:e.jsx("div",{className:"px-4 font-semibold text-sm text-slate-600",children:"SEQUENTIAL"})}),[...Qt.schemeGroups.sequential,...Qt.schemeGroups.singlehue].map(c=>e.jsx(Oe.Item,{className:"z-20",children:({active:d})=>e.jsxs("div",{className:`${d?"bg-blue-50 ":""} flex`,children:[e.jsx("div",{className:"w-4 h-4"}),e.jsx("div",{className:"flex-1 flex w-full p-2",onClick:()=>r(u=>{he(u,`symbology.layers[${n.symbology.activeLayer}].${t}`,Qt[c][l]),he(u,`symbology.layers[${n.symbology.activeLayer}]['range-key']`,c)}),children:Qt[c][l].map((u,p)=>e.jsx("div",{className:"flex-1 h-4",style:{backgroundColor:u}},p))})]})},c)),e.jsx(Oe.Item,{className:"z-20",children:e.jsx("div",{className:"px-4 font-semibold text-sm text-slate-600",children:"Diverging"})}),Qt.schemeGroups.diverging.map(c=>e.jsx(Oe.Item,{className:"z-20",children:({active:d})=>e.jsxs("div",{className:`${d?"bg-blue-50 ":""} flex`,children:[e.jsx("div",{className:"w-4 h-4"}),e.jsx("div",{className:"flex-1 flex w-full p-2",onClick:()=>r(u=>{he(u,`symbology.layers[${n.symbology.activeLayer}].${t}`,Qt[c][l]),he(u,`symbology.layers[${n.symbology.activeLayer}]['range-key']`,c)}),children:Qt[c][l].map((u,p)=>e.jsx("div",{className:"flex-1 h-4",style:{backgroundColor:u}},p))})]})},c))]})})}function jO({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(Ze);let a=gd,l=C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,a.cat1);return e.jsx("div",{className:"flex w-full items-center",children:e.jsx(Eb,{button:e.jsxs("div",{className:"flex items-center w-full cursor-pointer flex-1",children:[e.jsx("div",{className:"flex-1 flex justify-center ",children:(l.map?l:[]).map((i,c)=>e.jsx("div",{className:"w-4 h-4",style:{backgroundColor:i}},c))}),e.jsx("div",{className:"flex items-center px-1 border-2 border-transparent h-8  hover fill-slate-400 hover:fill-slate-800 cursor-pointer",children:e.jsx(xl,{className:""})})]}),children:Object.keys(a).map(i=>e.jsx(Oe.Item,{className:"z-20",children:({active:c})=>e.jsxs("div",{className:`${c?"bg-blue-50 ":""} flex`,children:[e.jsx("div",{className:"w-4 h-4"}),e.jsx("div",{className:"flex-1 flex w-full p-2",onClick:()=>r(d=>{he(d,`symbology.layers[${n.symbology.activeLayer}].${t}`,a[i])}),children:a[i].map((d,u)=>e.jsx("div",{className:"w-4 h-4",style:{backgroundColor:d}},u))})]})},i))})})}function wO({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(Ze),{falcor:a,falcorCache:l,pgEnv:i}=w.useContext(ce);let{value:c,column:d,categorydata:u,colors:p,sourceId:m}=b.useMemo(()=>({sourceId:C(n,`symbology.layers[${n.symbology.activeLayer}].source_id`),value:C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,{}),column:C(n,`symbology.layers[${n.symbology.activeLayer}]['data-column']`,""),categorydata:C(n,`symbology.layers[${n.symbology.activeLayer}]['category-data']`,{}),colors:C(n,`symbology.layers[${n.symbology.activeLayer}]['color-set']`,gd.cat1)}),[n]);const[h,f]=w.useState();b.useEffect(()=>{m&&a.get(["dama",i,"sources","byId",m,"attributes","metadata"])},[m]);const g=b.useMemo(()=>{var E,L;let _=C(l,["dama",i,"sources","byId",m,"attributes","metadata","value","columns"],[]);return _.length===0&&(_=C(l,["dama",i,"sources","byId",m,"attributes","metadata","value"],[])),JSON.parse(((L=((E=_.filter(S=>S.name===d))==null?void 0:E[0])||{})==null?void 0:L.meta_lookup)||"{}")},[m,l]),x=b.useMemo(()=>Object.values(u).reduce((_,E)=>(typeof E[d]!="object"&&_++,_),0),[u]),y=(Array.isArray(c)?c:[]).filter((_,E)=>E>2).map((_,E)=>E%2===0?{color:_,label:c[E+2]}:null).filter(_=>_),j=CO(Object.values(u).filter(_=>typeof _[d]!="object").map(_=>_[d]),y.map(_=>_.label)).map(_=>({label:_,value:_})),N=C(n,`symbology.layers[${n.symbology.activeLayer}]['category-show-other']`,"#ccc")==="#ccc";return e.jsxs("div",{className:" w-full items-center",children:[h!==void 0&&e.jsx(e.Fragment,{children:e.jsxs("label",{className:"flex",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"color",value:ir(C(n,`symbology.layers[${n.symbology.activeLayer}].categories.legend[${h}].color`,p[h%p.length])),onChange:_=>{const E=[...c],L=[...y];L[h].color=_.target.value;const S=E.indexOf(L[h].label);E.splice(S+1,1,_.target.value),r(k=>{he(k,`symbology.layers[${n.symbology.activeLayer}].categories`,{paint:E,legend:L.map($=>({color:$.color,label:C(g,$.label,$.label)}))})})}})}),e.jsxs("div",{className:"flex items-center p-2",children:["Custom color for ",y[h].label," "]})]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Showing"}),e.jsx("div",{className:"border border-transparent hover:border-slate-200 m-1 rounded ",children:e.jsxs("select",{className:"w-full p-2 bg-transparent text-slate-700 text-sm",value:y.length,onChange:_=>r(E=>{he(E,`symbology.layers[${n.symbology.activeLayer}].['num-categories']`,_.target.value),he(E,`symbology.layers[${n.symbology.activeLayer}].categories`,{})}),children:[e.jsxs("option",{value:y.length,children:[y.length," Categories"]},"def"),[10,20,30,50,100].filter(_=>_<x&&_!==y.length).map((_,E)=>e.jsxs("option",{value:_,children:[_," Categories"]},E))]})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Show Other"}),e.jsx("div",{className:"flex items-center",children:e.jsxs(Tt,{checked:N,onChange:()=>{r(_=>{const E=C(n,`symbology.layers[${n.symbology.activeLayer}]['category-show-other']`,"#ccc")==="#ccc"?"rgba(0,0,0,0)":"#ccc";he(_,`symbology.layers[${n.symbology.activeLayer}]['category-show-other']`,E)})},className:`${N?"bg-blue-500":"bg-gray-200"} relative inline-flex h-4 w-8 items-center rounded-full `,children:[e.jsx("span",{className:"sr-only",children:"Show other"}),e.jsx("div",{className:`${N?"translate-x-5":"translate-x-0"} inline-block h-4 w-4  transform rounded-full bg-white transition border-[0.5] border-slate-600`})]})})]}),e.jsxs("div",{className:"w-full max-h-[250px] overflow-auto",children:[y.map((_,E)=>e.jsxs("div",{className:"group/title w-full flex items-center hover:bg-slate-100",children:[e.jsx("div",{className:"flex items-center h-8 w-8 justify-center  border-r border-b ",onClick:()=>{f(h!==E?E:void 0)},children:e.jsx("div",{className:"w-4 h-4 rounded border-[0.5px] border-slate-600",style:{backgroundColor:_.color}})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-600 border-b h-8 truncate",children:_.label}),e.jsx("div",{className:"group/icon border-b w-8 h-8 flex items-center border-slate-200 cursor-pointer fill-white group-hover/title:fill-slate-300 hover:bg-slate-200",onClick:()=>{const L=[...c],S=y.filter($=>$.label!==_.label),k=L.indexOf(_.label);L.splice(k,2),r($=>{he($,`symbology.layers[${n.symbology.activeLayer}].categories`,{paint:L,legend:S.map(I=>({color:I.color,label:C(g,I.label,I.label)}))})})},children:e.jsx($r,{className:"mx-[6px] cursor-pointer group-hover/icon:fill-slate-500 "})})]},E)),N&&e.jsxs("div",{className:"w-full flex items-center hover:bg-slate-100",children:[e.jsx("div",{className:"flex items-center h-8 w-8 justify-center  border-r border-b ",children:e.jsx("div",{className:"w-4 h-4 rounded border-[0.5px] border-slate-600",style:{backgroundColor:C(n,`symbology.layers[${n.symbology.activeLayer}]['category-show-other']`,"#ccc")}})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-600 border-b h-8 truncate",children:"Other"})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center mx-4",children:"Add Column"}),e.jsx("div",{className:"flex-1 flex items-center mx-4 pb-4",children:e.jsx(Fs,{children:e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsxs("select",{className:"w-full py-2 bg-transparent",value:"",onChange:_=>{const E=[...c],L=[...y],S=E[E.length-2],k=p.map(I=>Go(I)).indexOf(S),$=k<p.length-1?p[k+1]:p[0];L.push({color:$,label:_.target.value}),E.splice(c.length-1,0,_.target.value,Go($)),r(I=>{he(I,`symbology.layers[${n.symbology.activeLayer}].categories`,{paint:E,legend:L.map(T=>({color:T.color,label:C(g,T.label,T.label)}))})})},children:[e.jsx("option",{value:""},-1),(j||[]).map((_,E)=>e.jsx("option",{value:_.value,children:_.label},E))]})})})})})]})]})]})}function NO({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(Ze);w.useContext(ce);let{value:a,column:l,choroplethdata:i,colors:c,numbins:d,method:u,colorKey:p}=b.useMemo(()=>({value:C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,{}),column:C(n,`symbology.layers[${n.symbology.activeLayer}]['data-column']`,""),choroplethdata:C(n,`symbology.layers[${n.symbology.activeLayer}]['choropleth-data']`,{}),colors:C(n,`symbology.layers[${n.symbology.activeLayer}]['color-range']`,Qt.seq1[9]),numbins:C(n,`symbology.layers[${n.symbology.activeLayer}]['num-bins']`,9),colorKey:C(n,`symbology.layers[${n.symbology.activeLayer}]['range-key']`,"seq1"),method:C(n,`symbology.layers[${n.symbology.activeLayer}]['bin-method']`,"ckmeans")}),[n]);const m=Math.max(...i),h=[...(Array.isArray(a)?a:[]).filter((g,x)=>x>2).map((g,x)=>x%2===1?{color:a[x+1],label:`${a[x+2]} - ${a[x+4]||m}`}:null).filter(g=>g)],f=C(n,`symbology.layers[${n.symbology.activeLayer}]['category-show-other']`,"#ccc")==="#ccc";return e.jsxs("div",{className:" w-full items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Showing"}),e.jsx("div",{className:"border border-transparent hover:border-slate-200 m-1 rounded ",children:e.jsx("select",{className:"w-full p-2 bg-transparent text-slate-700 text-sm",value:d,onChange:g=>r(x=>{he(x,`symbology.layers[${n.symbology.activeLayer}].['num-bins']`,g.target.value),he(x,`symbology.layers[${n.symbology.activeLayer}].['color-range']`,Qt[p][g.target.value])}),children:(Object.keys(Qt[p])||[]).map((g,x)=>e.jsx("option",{value:g,children:g},x))})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Method"}),e.jsx("div",{className:"border border-transparent hover:border-slate-200 m-1 rounded ",children:e.jsxs("select",{className:"w-full p-2 bg-transparent text-slate-700 text-sm",value:u,onChange:g=>r(x=>{console.log("SelectViewColumnControl set bin method",t,g.target.value),he(x,`symbology.layers[${n.symbology.activeLayer}]['bin-method']`,g.target.value)}),children:[e.jsx("option",{value:"ckmeans",children:"ck-means"}),e.jsx("option",{value:"jenks",children:"Jenks"}),e.jsx("option",{value:"pretty",children:"Pretty Breaks"}),e.jsx("option",{value:"equalInterval",children:"Equal Interval"})]})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Show Other"}),e.jsx("div",{className:"flex items-center",children:e.jsxs(Tt,{checked:f,onChange:()=>{r(g=>{const x=C(n,`symbology.layers[${n.symbology.activeLayer}]['category-show-other']`,"#ccc")==="#ccc"?"rgba(0,0,0,0)":"#ccc";he(g,`symbology.layers[${n.symbology.activeLayer}]['category-show-other']`,x)})},className:`${f?"bg-blue-500":"bg-gray-200"} relative inline-flex h-4 w-8 items-center rounded-full `,children:[e.jsx("span",{className:"sr-only",children:"Show other"}),e.jsx("div",{className:`${f?"translate-x-5":"translate-x-0"} inline-block h-4 w-4  transform rounded-full bg-white transition border-[0.5] border-slate-600`})]})})]}),e.jsx("div",{className:"w-full max-h-[250px] overflow-auto",children:h.map((g,x)=>e.jsxs("div",{className:"w-full flex items-center hover:bg-slate-100",children:[e.jsx("div",{className:"flex items-center h-8 w-8 justify-center  border-r border-b ",children:e.jsx("div",{className:"w-4 h-4 rounded border-[0.5px] border-slate-600",style:{backgroundColor:g.color}})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-600 border-b h-8 truncate",children:g.label})]},x))})]})}const CO=(t,s)=>t.filter(n=>!s.includes(n)),Lb=({setState:t,availableColumnNames:s})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center mx-4",children:"Add Column"}),e.jsx("div",{className:"flex-1 flex items-center mx-4",children:e.jsx(Fs,{children:e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsxs("select",{className:"w-full py-2 bg-transparent",value:"",onChange:n=>t(n.target.value),children:[e.jsx("option",{value:""},-1),(s||[]).map((n,r)=>e.jsx("option",{value:n.value,children:n.label},r))]})})})})})]}),dr={color:gO,categoricalColor:jO,rangeColor:vO,categoryControl:wO,choroplethControl:NO,range:xO,simple:bO,select:kb,selectType:fO,selectViewColumn:yO};function Fs({children:t}){return e.jsx("div",{className:"rounded-md h-[36px] flex w-full w-[216px] p-2 items-center border border-white/50 hover:bg-white cursor-pointer hover:border-slate-200",children:t})}function _O({values:t,title:s="",children:n}){return e.jsx(Fs,{children:e.jsx(ft,{className:"relative w-full",children:({open:r})=>e.jsxs(e.Fragment,{children:[e.jsx(ft.Button,{className:"w-full",children:e.jsxs("div",{className:"w-full flex items-center group",children:[e.jsx("div",{className:"flex items-center group-hover:flex-1",children:(t||[]).map((a,l)=>e.jsxs(b.Fragment,{children:[a.type==="color"&&e.jsx("div",{className:"h-4 w-4 border",style:{backgroundColor:ir(a.value)}}),e.jsxs("div",{className:"px-1 py-1 truncate",children:[e.jsx("span",{className:"",children:a.type==="color"?ir(a.value):a.value}),a.unit?a.unit:""," "]}),e.jsx("div",{className:"px-1 py-1 truncate",children:l<t.length-1?"/":""})]},l))}),e.jsx("div",{className:"flex items-center ",children:e.jsx(xl,{className:"fill-slate-400 group-hover:fill-slate-800"})})]})}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(ft.Panel,{className:"absolute w-[250px] left-0  z-10 mt-3 -translate-x-[325px] -translate-y-[78px] transform px-4  ",children:({close:a})=>e.jsxs("div",{className:"overflow-hidden rounded-lg shadow-lg ring-1 ring-black/5 bg-white/95",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:" w-full flex text-slate-700 py-1 px-2 text-sm font-semibold tracking-wider",children:s}),e.jsx("div",{onClick:()=>a(),className:"p-0.5 rounded hover:bg-slate-100 m-1 cursor-pointer",children:e.jsx($r,{className:"fill-slate-700"})})]}),e.jsx("div",{className:"relative",children:n})]})})})]})})})}function SO({controls:t}){return w.useContext(Ze),e.jsx(Fs,{children:t.map((s,n)=>{const r=dr[s.type]||dr.simple;return e.jsx(r,{path:s.path,datapath:s.datapath,params:s.params},n)})})}function $O({label:t,controls:s}){const{state:n,setState:r}=w.useContext(Ze),a=b.useMemo(()=>s.map(l=>{var u;const i=p=>p;let d=(((u=l==null?void 0:l.params)==null?void 0:u.format)||i)(C(n,`symbology.layers[${n.symbology.activeLayer}].${l.path}`,""));return{type:l==null?void 0:l.type,unit:l==null?void 0:l.unit,value:d}}),[n,s]);return e.jsx(_O,{values:a,title:t,children:s.map((l,i)=>{const c=dr[l.type]||dr.simple;return e.jsx(c,{path:l.path,datapath:l.datapath,params:l.params},i)})})}const Fm={popover:$O,inline:SO},EO={fill:"Polygons",line:"Lines",circle:"Points"};function kO(t){const{state:s,setState:n}=w.useContext(Ze),r=b.useMemo(()=>{var l,i;return((i=(l=s.symbology)==null?void 0:l.layers)==null?void 0:i[s.symbology.activeLayer])||null},[s]),a=b.useMemo(()=>$b[r.type]||[],[r.type]);return r&&e.jsx("div",{children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"font-bold tracking-wider text-sm text-slate-700",children:EO[r.type]}),a.filter(l=>{if(l.conditional){const i=C(s,`symbology.layers[${s.symbology.activeLayer}].${l.conditional.path}`,"-999");return l.conditional.conditions.includes(i)}else return!0}).map((l,i)=>{let c=Fm[l.type]||Fm.inline;return e.jsxs("div",{className:"flex ",children:[e.jsx("div",{className:"w-16 text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center",children:l.label}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsx(c,{label:l.label,controls:l.controls})})]},i)})]})})}function LO(t,s,n){return n.indexOf(t)===s}const IO=(t,s)=>t.filter(n=>!s.includes(n));function TO({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(Ze),a=b.useMemo(()=>C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,[]),[n,t,s]),l=C(n,`symbology.layers[${n.symbology.activeLayer}].view_id`),i=C(n,`symbology.layers[${n.symbology.activeLayer}].source_id`),{pgEnv:c,falcor:d,falcorCache:u}=b.useContext(ce);b.useEffect(()=>{i&&d.get(["dama",c,"sources","byId",i,"attributes","metadata"])},[i]);const p=b.useMemo(()=>{let x=C(u,["dama",c,"sources","byId",i,"attributes","metadata","value","columns"],[]);return x.length===0&&(x=C(u,["dama",c,"sources","byId",i,"attributes","metadata","value"],[])),x},[i,u]),m=b.useMemo(()=>p.map(x=>x.name),[p]);b.useEffect(()=>{a.length===0&&r(x=>{he(x,`symbology.layers[${n.symbology.activeLayer}].${t}`,p.filter(y=>!["wkb_geometry"].includes(y.name)).map(y=>({column_name:y.name,display_name:(y==null?void 0:y.display_name)||y.name})))})},[p]);const h=b.useMemo(()=>a?typeof a[0]=="string"?a:a.map(x=>x==null?void 0:x.column_name):void 0,[a]),f=b.useMemo(()=>(h?IO(m,h):m).filter(x=>!["wkb_geometry"].includes(x)),[h,m]);w.useEffect(()=>{d.get(["dama",c,"viewsbyId",l,"databyIndex",{from:0,to:100},h])},[d,c,l,h]);const g=b.useMemo(()=>Object.values(C(u,["dama",c,"viewsbyId",l,"databyIndex"],[])).map(x=>x!=null&&x.value?C(u,x.value,""):""),[c,u]);return e.jsxs("div",{className:"flex w-full flex-wrap",children:[e.jsx(MO,{selectedColumns:a,sampleData:g,reorderAttrs:(x,y)=>{const j=[...a],[N]=j.splice(x,1);j.splice(y,0,N),r(_=>{he(_,`symbology.layers[${n.symbology.activeLayer}].${t}`,j)})},renameAttr:({columnName:x,displayName:y})=>{const j=[...a],N=j.findIndex(L=>L.column_name===x),[_]=j.splice(N,1),E={..._};E.display_name=y,j.splice(N,0,E),r(L=>{he(L,`symbology.layers[${n.symbology.activeLayer}].${t}`,j)})},removeAttr:x=>{r(y=>{he(y,`symbology.layers[${n.symbology.activeLayer}].${t}`,a.filter(j=>j.column_name!==x))})}}),e.jsx(Lb,{setState:x=>{r(y=>{if(x!==""){const j=p.find(N=>N.name===x);he(y,`symbology.layers[${n.symbology.activeLayer}].${t}`,a?[...a,{column_name:x,display_name:(j==null?void 0:j.display_name)||x}]:[{column_name:x,display_name:(j==null?void 0:j.display_name)||x}])}})},availableColumnNames:f.map(x=>{const y=p.find(j=>j.name===x);return{value:x,label:(y==null?void 0:y.display_name)||x}})})]})}const MO=({selectedColumns:t,sampleData:s,path:n,reorderAttrs:r,removeAttr:a,renameAttr:l})=>e.jsx(Wn,{onDrop:r,children:t==null?void 0:t.map((i,c)=>e.jsxs("div",{className:"group/title w-full text-sm grid grid-cols-9 cursor-grab",children:[e.jsx("div",{className:"truncate border-t border-r border-slate-200 col-span-4 px-2 py-1",children:e.jsx("input",{type:"text",className:"w-full px-2  border text-sm border-transparent hover:border-slate-200 outline-2 outline-transparent rounded-md bg-transparent text-slate-700 placeholder:text-gray-400 focus:outline-pink-300 sm:leading-6",value:i.display_name,onChange:d=>{l({columnName:i.column_name,displayName:d.target.value})}})}),e.jsx("div",{className:"truncate flex items-center text-[13px] border-t border-slate-200 col-span-4 text-slate-300 px-4 py-1",children:s.map(d=>d[i.column_name]).filter(d=>d!=="null").filter(LO).slice(0,2).join(", ")}),e.jsx("div",{className:"border-t flex items-center border-slate-200 cursor-pointer fill-white group-hover/title:fill-slate-300 hover:bg-slate-100 rounded group/icon col-span-1 p-0.5",onClick:()=>{a(i.column_name)},children:e.jsx($r,{className:"mx-[6px] cursor-pointer group-hover/icon:fill-slate-500 "})})]},c))});function BO(t){const{state:s,setState:n}=b.useContext(Ze),r=b.useMemo(()=>{var a,l;return((l=(a=s.symbology)==null?void 0:a.layers)==null?void 0:l[s.symbology.activeLayer])||null},[s]);return r&&e.jsxs("div",{className:"pb-4  max-h-[calc(100vh_-_251px)] scrollbar-xs overflow-x-hidden overflow-y-auto",children:[e.jsxs("div",{className:"flex mx-4 mt-1",children:[e.jsx("div",{className:"w-16 text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center",children:"Popover"}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsx(Fs,{children:e.jsx(kb,{path:"['hover']",params:{options:[{value:"",name:"None"},{value:"hover",name:"Hover"}]}})})})]}),e.jsx("div",{className:"w-16 text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center mx-4",children:"Attributes"}),r.hover&&e.jsx(TO,{path:"['hover-columns']",params:{}})]})}const Vm={fill:({layer:t,color:s})=>e.jsx("div",{className:"pr-2",children:e.jsx("div",{className:"w-4 h-4 rounded ",style:{backgroundColor:s}})}),circle:({layer:t,color:s})=>{let n=C(t,"layers[0].paint['circle-stroke-color']","#ccc");return e.jsx("div",{className:"pl-0.5 pr-2",children:e.jsx("div",{className:"w-3 h-3 rounded-full ",style:{backgroundColor:s,borderColor:n}})})},line:({layer:t,color:s})=>e.jsx("div",{className:"pr-2",children:e.jsx("div",{className:"w-4 h-1",style:{backgroundColor:s}})})};function AO(){const{state:t,setState:s}=w.useContext(Ze);let{legenddata:n,layertype:r}=b.useMemo(()=>({legenddata:C(t,`symbology.layers[${t.symbology.activeLayer}]['legend-data']`,[]),layertype:C(t,`symbology.layers[${t.symbology.activeLayer}]['type']`,"fill")}),[t]);const a=Vm[r]||Vm.fill;return!n||n.length===0?e.jsx("div",{children:" No Legend Data "}):e.jsx("div",{className:"w-full max-h-[550px] pb-4 overflow-auto",children:n.map((l,i)=>e.jsxs("div",{className:"w-full flex items-center hover:bg-pink-50",children:[e.jsx("div",{className:"flex items-center h-6 w-10 justify-center  ",children:e.jsx(a,{color:l.color})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-500  text-sm truncate",children:e.jsx("input",{type:"text",className:"block w-full border border-transparent hover:border-slate-200 outline-2 outline-transparent rounded-md bg-transparent py-1 px-2 text-slate-800 placeholder:text-gray-400 focus:outline-pink-300 sm:leading-6",placeholder:"Select / Create New Map",value:n[i].label,onChange:c=>s(d=>{d.symbology.layers[d.symbology.activeLayer]["legend-data"][i].label=c.target.value})})})]},i))})}function OO(t){const{state:s,setState:n}=w.useContext(Ze),r=b.useMemo(()=>{var a,l;return((l=(a=s.symbology)==null?void 0:a.layers)==null?void 0:l[s.symbology.activeLayer])||null},[s]);return b.useMemo(()=>$b[r.type]||[],[r.type]),r&&e.jsx("div",{children:e.jsxs("div",{className:"",children:[e.jsx("div",{className:"font-bold tracking-wider text-sm text-slate-700 p-4",children:"Legend"}),e.jsx(AO,{})]})})}const{simple:Hm,select:PO}=dr;function DO(t,s,n){return n.indexOf(t)===s}const RO=(t,s)=>t.filter(n=>!s.includes(n)),FO={string:["!=","=="],integer:["!=","<","<=","==",">=",">","between"],number:["!=","<","<=","==",">=",">","between"]},VO=({removeFilter:t,activeColumn:s,setActiveColumn:n})=>{var m;const{state:r,setState:a}=w.useContext(Ze),l=C(r,`symbology.layers[${r.symbology.activeLayer}].filter`,{}),i=C(r,`symbology.layers[${r.symbology.activeLayer}].source_id`),{pgEnv:c,falcor:d,falcorCache:u}=b.useContext(ce);b.useEffect(()=>{i&&d.get(["dama",c,"sources","byId",i,"attributes","metadata"])},[i]);const p=b.useMemo(()=>{let h=C(u,["dama",c,"sources","byId",i,"attributes","metadata","value","columns"],[]);return h.length===0&&(h=C(u,["dama",c,"sources","byId",i,"attributes","metadata","value"],[])),h},[i,u]);return e.jsx("div",{className:"flex w-full flex-wrap",children:(m=Object.keys(l||{}))==null?void 0:m.map((h,f)=>{var S,k,$;const g=p.find(I=>I.name===h)||{},x=l[h],y=s===h?"bg-pink-100":"",j=s===h?"text-pink-100":"text-white",N=g.type==="string"&&["!=","=="].includes(x.operator),_=x.operator==="between",E=((S=p.find(I=>I.name===h))==null?void 0:S.display_name)||h;let L=x==null?void 0:x.value;return N?Array.isArray(x==null?void 0:x.value)&&(L=(k=x==null?void 0:x.value)==null?void 0:k.join(", ")):_&&Array.isArray(x==null?void 0:x.value)&&(L=($=x==null?void 0:x.value)==null?void 0:$.join(" and ")),e.jsxs("div",{className:`${y} m-1 border border-slate-200 rounded group/title w-full px-1 text-sm grid grid-cols-9 cursor-pointer hover:border-pink-500 hover:border`,onClick:()=>{n(h)},children:[e.jsxs("div",{className:"truncate col-span-8 py-1",children:[E," ",e.jsx("span",{className:"font-thin",children:x.operator})," ",L]}),e.jsx("div",{className:`cursor-pointer ${j} group-hover/title:text-black group/icon col-span-1 p-1`,onClick:I=>{I.stopPropagation(),t(h)},children:e.jsx("i",{className:"mx-2 fa fa-x cursor-pointer group-hover/icon:text-pink-800"})})]},f)})})};function HO({path:t,params:s={}}){var S,k;const{state:n,setState:r}=w.useContext(Ze),[a,l]=w.useState(""),{activeColumn:i,setActiveColumn:c}=s,{sourceId:d}=b.useMemo(()=>({sourceId:C(n,`symbology.layers[${n.symbology.activeLayer}].source_id`)}),[n]),{pgEnv:u,falcor:p,falcorCache:m}=b.useContext(ce);b.useEffect(()=>{d&&p.get(["dama",u,"sources","byId",d,"attributes","metadata"])},[d]);const h=b.useMemo(()=>{let $=C(m,["dama",u,"sources","byId",d,"attributes","metadata","value","columns"],[]);return $.length===0&&($=C(m,["dama",u,"sources","byId",d,"attributes","metadata","value"],[])),$},[d,m]),f=b.useMemo(()=>h.find($=>$.name===i),[i]),g=FO[f==null?void 0:f.type]||[],x=C(n,`symbology.layers[${n.symbology.activeLayer}].filter`,{}),y=`${t}.${i}.value`,j=((S=x==null?void 0:x[i])==null?void 0:S.operator)==="between",N=(f==null?void 0:f.type)==="string"&&["!=","=="].includes((k=x==null?void 0:x[i])==null?void 0:k.operator),_=N?e.jsx(Fs,{children:e.jsx("label",{className:"flex",children:e.jsx("div",{className:"flex items-center",children:e.jsx("input",{className:"w-full",type:"text",value:a,onChange:$=>{l($.target.value)}})})})}):e.jsx(Fs,{children:e.jsx(Hm,{path:y+(j?"[0]":""),params:{default:""}})}),E=N?"Search values":"Value:",L=j?null:e.jsx("div",{className:"p-1",children:E});return e.jsxs(e.Fragment,{children:[!i&&e.jsx(zO,{path:t,params:s,setActiveColumn:c}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-4",children:[e.jsxs("div",{className:"flex my-1 items-center",children:[e.jsx("div",{className:"p-1",children:"Column:"}),e.jsx("div",{className:"p-2",children:f.display_name??i})]}),e.jsxs("div",{className:"flex my-1 items-center",children:[e.jsx("div",{className:"p-1",children:"Operator:"}),e.jsx(Fs,{children:e.jsx(PO,{path:`${t}.${i}.operator`,params:{options:g.map($=>({value:$,name:$}))}})})]}),e.jsxs("div",{className:"flex my-1 items-center",children:[L,_]}),j&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1",children:"And"}),e.jsx("div",{className:"flex my-1 items-center",children:e.jsx(Fs,{children:e.jsx(Hm,{path:y+"[1]",params:{default:""}})})})]})]}),N&&e.jsx(UO,{params:s,path:y,filterSearchValue:a})]})]})}function zO({path:t,params:s={},setActiveColumn:n}){var y,j;const{state:r,setState:a}=w.useContext(Ze),l=C(r,`symbology.layers[${r.symbology.activeLayer}].${t}`,s.default||((j=(y=s==null?void 0:s.options)==null?void 0:y[0])==null?void 0:j.value)||{}),i=Object.keys(l),c=C(r,`symbology.layers[${r.symbology.activeLayer}].source_id`),{pgEnv:d,falcor:u,falcorCache:p}=b.useContext(ce);b.useEffect(()=>{c&&u.get(["dama",d,"sources","byId",c,"attributes","metadata"])},[c]);const m=b.useMemo(()=>{let N=C(p,["dama",d,"sources","byId",c,"attributes","metadata","value","columns"],[]);return N.length===0&&(N=C(p,["dama",d,"sources","byId",c,"attributes","metadata","value"],[])),N},[c,p]),h=b.useMemo(()=>m.filter(N=>!["wkb_geometry"].includes(N)).map(N=>N.name),[m]),f=RO(h,i).map(N=>{const _=m.find(E=>E.name===N);return{value:N,label:(_==null?void 0:_.display_name)||N}}),g={operator:"==",value:[]},x={operator:"==",value:""};return e.jsx(Lb,{setState:N=>{a(_=>{if(N!==""){const E=m.find(S=>S.name===N);let L={...g,columnName:N};E.type!=="string"&&(L={...x,columnName:N}),he(_,`symbology.layers[${r.symbology.activeLayer}].${t}.${N}`,L)}}),n(N)},availableColumnNames:f})}function UO({params:t,path:s,filterSearchValue:n}){var x,y;const{pgEnv:r,falcor:a,falcorCache:l}=b.useContext(ce),{state:i,setState:c}=w.useContext(Ze),{activeColumn:d,setActiveColumn:u}=t,{viewId:p,sourceId:m}=b.useMemo(()=>({viewId:C(i,`symbology.layers[${i.symbology.activeLayer}].view_id`),sourceId:C(i,`symbology.layers[${i.symbology.activeLayer}].source_id`)}),[i]);b.useEffect(()=>{m&&a.get(["dama",r,"sources","byId",m,"attributes","metadata"])},[m]),b.useEffect(()=>{a.get(["dama",r,"viewsbyId",p,"databyIndex",{from:0,to:2e3},[d]])},[a,r,p,d]);const h=b.useMemo(()=>Object.values(C(l,["dama",r,"viewsbyId",p,"databyIndex"],[])).map(j=>j!=null&&j.value?C(l,j.value,""):""),[r,l]),f=b.useMemo(()=>{var j,N;return(N=(j=h==null?void 0:h.map(_=>_[d]))==null?void 0:j.filter(_=>_!=="null"))==null?void 0:N.filter(DO)},[h,d]);f.sort();const g=C(i,`symbology.layers[${i.symbology.activeLayer}].${s}`,t.default||((y=(x=t==null?void 0:t.options)==null?void 0:x[0])==null?void 0:y.value));return f==null?void 0:f.filter(j=>{var N,_;return(_=(N=j==null?void 0:j.toString())==null?void 0:N.toLowerCase())==null?void 0:_.includes(n.toString().toLowerCase())}).map((j,N)=>{const _=g==null?void 0:g.includes(j),E=_?"bg-pink-100":"";return e.jsx("div",{className:`${E} px-4 w-full text-sm hover:bg-pink-200 hover:cursor-pointer`,onClick:()=>c(L=>{const S=_?g.filter(k=>k!==j):[...Array.isArray(g)?g:[],j];he(L,`symbology.layers[${i.symbology.activeLayer}].${s}`,S)}),children:e.jsxs("div",{className:"flex",children:[e.jsx("input",{readOnly:!0,type:"checkbox",checked:_}),e.jsx("div",{className:"truncate flex items-center text-[13px] px-4 py-1",children:j})]})},N)})}function WO(t){const{state:s,setState:n}=b.useContext(Ze),[r,a]=b.useState(!1),[l,i]=b.useState(),c=C(s,`symbology.layers[${s.symbology.activeLayer}].filter`);return e.jsxs("div",{className:"pb-4 w-full max-h-[calc(100vh_-_251px)] scrollbar-xs overflow-x-hidden overflow-y-auto",children:[e.jsx("div",{className:"w-full mt-1 mx-4 text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center mx",children:"Filters"}),e.jsx("div",{className:"mx-4",children:e.jsx(VO,{removeFilter:d=>{i(null),a(!1),n(u=>{const p=Object.keys(c).reduce((m,h)=>(h!==d&&(m[h]=c[h]),m),{});he(u,`symbology.layers[${s.symbology.activeLayer}].filter`,p)})},activeColumn:l,setActiveColumn:i})}),e.jsx("div",{className:"m-4",children:e.jsx(We,{className:"p-1",themeOptions:{size:"sm",color:"transparent"},onClick:()=>{a(!0),i(null)},children:"Add Filter"})}),(l||r)&&e.jsx(HO,{path:"['filter']",params:{activeColumn:l,setActiveColumn:i}})]})}function GO(t){var l,i,c,d;const{state:s,setState:n}=w.useContext(Ze),r=b.useMemo(()=>{var u,p;return((p=(u=s.symbology)==null?void 0:u.layers)==null?void 0:p[s.symbology.activeLayer])||null},[s]),a=["Style","Legend","Popup","Filter"];return r&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-white/95 w-[312px] rounded-lg drop-shadow-lg pointer-events-auto min-h-[400px] max-h-[calc(100vh_-_161px)]  ",children:[e.jsxs("div",{className:"flex justify-between items-center border-b",children:[e.jsx("div",{className:"flex text-slate-700 p-2 ",children:e.jsx("input",{type:"text",className:"block w-[220px] border border-transparent hover:border-slate-200 outline-2 outline-transparent rounded-md bg-transparent py-1 px-2 text-slate-800 placeholder:text-gray-400 focus:outline-pink-300 sm:leading-6",placeholder:"Select / Create New Map",value:(d=(c=(l=s==null?void 0:s.symbology)==null?void 0:l.layers)==null?void 0:c[(i=s==null?void 0:s.symbology)==null?void 0:i.activeLayer])==null?void 0:d.name,onChange:u=>n(p=>{p.symbology.layers[p.symbology.activeLayer].name=u.target.value})})}),e.jsx("div",{className:"text-sm pt-1.5 px-1.5  hover:bg-slate-100 flex items-center",children:e.jsx(xd,{location:"right-0",layer:r,button:e.jsx(gl,{className:" cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700"})})}),e.jsx("div",{onClick:()=>n(u=>{u.symbology.activeLayer=null}),className:"p-2.5 rounded hover:bg-slate-100 m-1 cursor-pointer",children:e.jsx($r,{className:"fill-slate-500"})})]}),e.jsx("div",{className:"min-h-20 relative",children:e.jsxs(mt.Group,{children:[e.jsx("div",{className:"flex justify-between items-center border-b",children:e.jsx(mt.List,{children:a.map(u=>e.jsx(mt,{as:b.Fragment,children:({selected:p})=>e.jsx("button",{className:`
                        ${p?"text-slate-600 border-b font-medium border-slate-600":"text-slate-400"} mx-1 text-sm p-2 cursor-pointer
                      `,children:u})},u))})}),e.jsxs(mt.Panels,{children:[e.jsx(mt.Panel,{children:e.jsx(kO,{})}),e.jsx(mt.Panel,{children:e.jsx(OO,{})}),e.jsx(mt.Panel,{children:e.jsx(BO,{})}),e.jsx(mt.Panel,{children:e.jsx(WO,{})})]})]})})]})})}const JO=({maplibreMap:t,layer:s,layerProps:n,allLayerProps:r})=>{b.useEffect(()=>()=>{s.layers.forEach(l=>{try{t&&t.getLayer(l.id)&&t.removeLayer(l.id)}catch(i){console.log("catch",i)}})},[]);const a=JA(n);b.useEffect(()=>{var i,c,d,u,p,m,h,f,g,x;if(((n==null?void 0:n["data-column"])!==(a==null?void 0:a["data-column"])||(n==null?void 0:n.filter)!==(a==null?void 0:a.filter))&&t.getSource((c=(i=n==null?void 0:n.sources)==null?void 0:i[0])==null?void 0:c.id)){let y=Ie((d=n.sources)==null?void 0:d[0]),j=(u=y.source.tiles)==null?void 0:u[0];j&&(y.source.tiles=[qO(j,n)]),(p=n==null?void 0:n.layers)==null||p.forEach(_=>{t.getLayer(_==null?void 0:_.id)&&t.getLayer(_==null?void 0:_.id)&&t.removeLayer(_==null?void 0:_.id)}),t.removeSource(y.id),t.getSource(y.id)?console.log("cant add",t.getSource(y.id)):t.addSource(y.id,y.source);let N=Object.values(r).find(_=>_.order===n.order+1);(m=n==null?void 0:n.layers)==null||m.forEach(_=>{t.getLayer(N==null?void 0:N.id)?t.addLayer(_,N==null?void 0:N.id):t.addLayer(_)})}if((n==null?void 0:n.order)<((a==null?void 0:a.order)||-1)){let y=Object.values(r).find(j=>j.order===n.order+1);(h=n==null?void 0:n.layers)==null||h.forEach(j=>{t.getLayer(j==null?void 0:j.id)&&t.getLayer(j==null?void 0:j.id)&&t.moveLayer(j==null?void 0:j.id,y==null?void 0:y.id)})}(f=n==null?void 0:n.layers)==null||f.forEach((y,j)=>{t.getLayer(y.id)&&Object.keys(y.paint).forEach(N=>{var _,E,L,S;Fe((L=(E=(_=a==null?void 0:a.layers)==null?void 0:_[j])==null?void 0:E.paint)==null?void 0:L[N],(S=y==null?void 0:y.paint)==null?void 0:S[N])||t.setPaintProperty(y.id,N,y.paint[N])})}),(g=n==null?void 0:n.layers)==null||g.forEach((y,j)=>{t.getLayer(y.id)&&Object.keys((y==null?void 0:y.layout)||{}).forEach(N=>{var _,E,L,S;Fe((L=(E=(_=a==null?void 0:a.layers)==null?void 0:_[j])==null?void 0:E.layout)==null?void 0:L[N],(S=y==null?void 0:y.layout)==null?void 0:S[N])||t.setLayoutProperty(y.id,N,y.layout[N])})});const{filter:l}=n;(x=n==null?void 0:n.layers)==null||x.forEach((y,j)=>{if(t.getLayer(y.id)&&l){const N=Object.keys(l).map(_=>{let E=[];const L=l[_].operator,S=l[_].value,k=["get",_];return L==="between"?E=["all",[">=",["to-string",k],["to-string",S==null?void 0:S[0]]],["<=",["to-string",k],["to-string",S==null?void 0:S[1]]]]:["==","!="].includes(L)?(E=["in",k,["literal",S]],L==="!="&&(E=["!",E])):E=[L,["to-string",k],["to-string",S]],E});t.setFilter(y.id,["all",...N])}})},[n])},qO=(t,s)=>{var l;let n=t;const r=(s==null?void 0:s.filter)&&((l=Object.keys(s==null?void 0:s.filter))==null?void 0:l.length)>0,a=i=>i.includes(s==null?void 0:s["data-column"]);return n&&(s!=null&&s["data-column"]||r)&&(n!=null&&n.includes("?cols=")||(n+="?cols="),s!=null&&s["data-column"]&&!a(n)&&(n+=s==null?void 0:s["data-column"]),a(n)&&r&&(n+=","),r&&Object.keys(s.filter).forEach((i,c)=>{n+=`${i}`,c<Object.keys(s.filter).length-1&&(n+=",")})),n};let KO=class extends dd{constructor(){super(...arguments);ye(this,"onHover",{layers:this.layers.filter(n=>{var r;return((r=n==null?void 0:n.id)==null?void 0:r.indexOf("_case"))===-1}).map(n=>n.id),callback:(n,r,a)=>[r[0].id,n,(r[0]||{}).properties],Component:YO,isPinnable:this.isPinnable||!0});ye(this,"RenderComponent",JO)}};const YO=({data:t,layer:s})=>{if(!s.props.hover)return;const{source_id:n,view_id:r}=s,a=w.useContext(ce),l=w.useContext(ke),i=a!=null&&a.falcor?a:l,{pgEnv:c,falcor:d,falcorCache:u}=i,p=w.useMemo(()=>C(t,"[0]",null),[t]),m=w.useMemo(()=>s.props["hover-columns"],[s]);b.useEffect(()=>{n&&d.get(["dama",c,"sources","byId",n,"attributes","metadata"])},[n,m]);const h=w.useMemo(()=>{if(m)return m;{let y=C(u,["dama",c,"sources","byId",n,"attributes","metadata","value","columns"],[]);return y.length===0&&(y=C(u,["dama",c,"sources","byId",n,"attributes","metadata","value"],[])),y}},[n,u,m]),f=w.useMemo(()=>{let y=C(u,["dama",c,"sources","byId",n,"attributes","metadata","value","columns"],[]);return y.length===0&&(y=C(u,["dama",c,"sources","byId",n,"attributes","metadata","value"],[])),y},[n,u]);let g=(typeof(h==null?void 0:h[0])=="string"?h:h.map(y=>y.name||y.column_name)).filter(y=>!["wkb_geometry"].includes(y));w.useEffect(()=>{d.get(["dama",c,"viewsbyId",r,"databyId",p,g])},[d,c,r,p,h]);const x=w.useMemo(()=>C(u,["dama",c,"viewsbyId",r,"databyId",""+p],{}),[p,u,r,c]);return e.jsxs("div",{className:"bg-white p-4 max-h-64 max-w-lg min-w-[300px] scrollbar-xs overflow-y-scroll",children:[e.jsx("div",{className:"font-medium pb-1 w-full border-b ",children:(s==null?void 0:s.name)||""}),Object.keys(x).length===0?`Fetching Attributes ${p}`:"",Object.keys(x).filter(y=>typeof x[y]!="object").sort((y,j)=>{const N=(m==null?void 0:m.findIndex(E=>E.column_name===y))||0,_=(m==null?void 0:m.findIndex(E=>E.column_name===j))||0;return N-_}).map((y,j)=>{const N=h.find(L=>L.name===y||L.column_name===y)||{},_=f.find(L=>L.name===y||L.column_name===y)||{},E=JSON.parse((_==null?void 0:_.meta_lookup)||"{}");return N.name||N.display_name?e.jsxs("div",{className:"flex border-b pt-1",children:[e.jsx("div",{className:"flex-1 font-medium text-xs text-slate-400 pl-1",children:N.display_name||N.name}),e.jsx("div",{className:"flex-1 text-right text-sm font-thin pl-4 pr-1",children:(x==null?void 0:x[y])!=="null"?C(E,x==null?void 0:x[y],x==null?void 0:x[y]):""})]},j):e.jsx(e.Fragment,{})})]})},Ze=b.createContext(void 0),ZO=({collection:t,symbologies:s,activeSymbologyId:n,...r})=>{var y,j;const a=b.useRef(!1),{falcor:l,falcorCache:i,pgEnv:c,baseUrl:d}=w.useContext(ce),u=$e(),{symbologyId:p}=Ye(),[m,h]=fo(s.find(N=>+N.symbology_id==+n)||{name:"",collection_id:t.collection_id,description:""});b.useEffect(()=>{if(!p&&+n&&+p!=+n){u(`${d}/collection/${t.collection_id}/mapeditor/${n}`);let N=s.find(_=>+_.symbology_id==+n);h(N)}},[n,p,s,i]),b.useEffect(()=>{var L;async function N(){await l.set({paths:[["dama",c,"symbologies","byId",+n,"attributes","symbology"]],jsonGraph:{dama:{[c]:{symbologies:{byId:{[+n]:{attributes:{symbology:JSON.stringify(m.symbology)}}}}}}}})}async function _(){await l.set({paths:[["dama",c,"symbologies","byId",+n,"attributes","name"]],jsonGraph:{dama:{[c]:{symbologies:{byId:{[+n]:{attributes:{name:m.name}}}}}}}})}let E=s.find(S=>+S.symbology_id==+n);(L=m==null?void 0:m.symbology)!=null&&L.layers&&E&&!Fe(m==null?void 0:m.symbology,E==null?void 0:E.symbology)&&N(),m!=null&&m.name&&(m==null?void 0:m.name)!==E.name&&_()},[m.symbology,m.name]),b.useEffect(()=>{s.find(N=>+N.symbology_id==+n)&&h(s.find(N=>+N.symbology_id==+n))},[s.length,n]);const[f,g]=fo([]);b.useEffect(()=>{(async()=>{a.current&&g(_=>{var $;let E=_.map(I=>I.id).filter(I=>I),L=Object.values((($=m==null?void 0:m.symbology)==null?void 0:$.layers)||{}).filter(I=>I).filter(I=>!E.includes(I.id)).sort((I,T)=>T.order-I.order).map(I=>new KO(I));return[..._.filter(I=>{var T;return Object.keys(((T=m==null?void 0:m.symbology)==null?void 0:T.layers)||{}).includes(I.id)}),...L].sort((I,T)=>m.symbology.layers[T.id].order-m.symbology.layers[I.id].order)})})()},[(y=m==null?void 0:m.symbology)==null?void 0:y.layers]);const x=b.useMemo(()=>{var N;return((N=m==null?void 0:m.symbology)==null?void 0:N.layers)||{}},[(j=m==null?void 0:m.symbology)==null?void 0:j.layers]);return e.jsx(Ze.Provider,{value:{state:m,setState:h,collection:t,symbologies:s},children:e.jsxs("div",{className:"w-full h-full relative",ref:a,children:[e.jsx(md,{layers:f,layerProps:x,hideLoading:!0,showLayerSelect:!0,mapOptions:{center:[-76,43.3],zoom:6,maxPitch:60,protocols:[bb],styles:[{name:"Default",style:"https://api.maptiler.com/maps/dataviz/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Satellite",style:"https://api.maptiler.com/maps/hybrid/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Streets",style:"https://api.maptiler.com/maps/streets-v2/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Light",style:"https://api.maptiler.com/maps/dataviz-light/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Dark",style:"https://api.maptiler.com/maps/dataviz-dark/style.json?key=mU28JQ6HchrQdneiq6k9"}]},leftSidebar:!1,rightSidebar:!1}),e.jsxs("div",{className:"absolute inset-0 flex pointer-events-none",children:[e.jsx(cO,{}),e.jsx("div",{className:"flex-1"}),e.jsx(GO,{})]})]})})},ri={overview:{name:"Overview",path:"",component:CA},mapeditor:{name:"Map Editor",path:"/mapeditor",fullWidth:!0,hideBreadcrumbs:!0,component:ZO},versions:{name:"Versions",path:"/versions",hidden:"true",component:PA}},zr={},Ur=({})=>{var k;const{collectionId:t,page:s,symbologyId:n}=Ye(),[r,a]=b.useState(ri||[]),[l,i]=b.useState(n),{pgEnv:c,baseUrl:d,falcor:u,falcorCache:p,user:m}=w.useContext(ce),h=m.authLevel,f=b.useMemo(()=>s?C(r,`[${s}].component`,r.overview.component):r.overview.component,[s,r]),g=b.useMemo(()=>s?C(r,`[${s}].fullWidth`,!1):!1,[s,r]),x=b.useMemo(()=>s?C(r,`[${s}].hideBreadcrumbs`,!1):!1,[s,r]);b.useEffect(()=>{async function $(){const I=["dama",c,"collections","byId",t,"symbologies","length"],T=await u.get(I);return await u.get(["dama",c,"collections","byId",t,"symbologies","byIndex",{from:0,to:C(T.json,I,0)-1},"attributes",Object.values(lr)],["dama",c,"collections","byId",t,"attributes",Object.values(or)],["dama",c,"collections","byId",t,"meta"])}$()},[t,u,c]);const y=b.useMemo(()=>Object.keys(C(p,["dama",c,"symbologies","byId"],{})),[p,t,c]);b.useEffect(()=>{var I;async function $(){const T=["dama",c,"symbologies","byId",y.filter(A=>A&&A!=="undefined"),"attributes",Object.values(lr)];await u.get(T)}(I=y==null?void 0:y.filter(T=>T&&T!=="undefined"))!=null&&I.length&&$()},[y,t,c]);const j=b.useMemo(()=>{const $=C(p,["dama",c,"symbologies","byId"],{});return Object.values($).map(I=>{var R,O;const A={...(R=I.attributes)!=null&&R.value?(O=I.attributes)==null?void 0:O.value:I.attributes};return Object.keys(I.attributes).forEach(M=>{var D;A[M]=((D=I.attributes[M])==null?void 0:D.value)||I.attributes[M]}),A}).filter(I=>I.collection_id===parseInt(t))},[p,t,c]);b.useEffect(()=>{if(l&&l!==n&&i(n),!l&&j.length>0){let $=j.filter(I=>{var T;return(T=I==null?void 0:I.metadata)==null?void 0:T.authoritative}).length>0?j.filter(I=>{var T;return(T=I==null?void 0:I.metadata)==null?void 0:T.authoritative}):j;i($.sort((I,T)=>I._created_timestamp-T._created_timestamp)[0].symbology_id)}},[j,n]);const N=b.useMemo(()=>{let $=hd(C(p,["dama",c,"collections","byId",t],{attributes:{}}).attributes);if(zr[$.type]){let I=Object.keys(zr[$.type]).reduce((A,R)=>((zr[$.type][R].path||R==="overview")&&(A[R]=zr[$.type][R]),A),{}),T={...ri,...I};a(T)}else a(ri);return $},[p,t,c]),_=jb(((k=N==null?void 0:N.statistics)==null?void 0:k.access)||{}),[E,L]=Vn(),S=w.useCallback($=>{const I=[];return E.forEach((T,A)=>{I.push(`${A}=${T}`)}),`${d}/collection/${t}${$.path}${l&&$.path?"/"+l:""}${I.length?`?${I.join("&")}`:""}`},[d,t,l,E]);return _>h?e.jsx(wb,{}):e.jsxs(ss,{baseUrl:d,fullWidth:g,hideBreadcrumbs:x,children:[e.jsx(_c,{menuItems:Object.values(r).filter($=>{const I=($==null?void 0:$.authLevel)||-1,T=m.authLevel||-1;return!$.hidden&&I<=T}).sort(($,I)=>(($==null?void 0:$.authLevel)||-1)-((I==null?void 0:I.authLevel)||-1)).map($=>({name:$.name,path:S($)})),themeOptions:{size:"inline"}}),e.jsx("div",{className:"w-full flex-1 bg-white shadow",children:e.jsx(f,{searchParams:E,setSearchParams:L,collection:N,symbologies:j,user:m,baseUrl:d,activeSymbologyId:l})})]})},XO=()=>{const t=$e(),[s,n]=b.useState(Object.keys(or).filter(u=>!["collection_id","categories","metadata","source_dependencies","user_id","_created_timestamp","_modified_timestamp"].includes(u)).reduce((u,p)=>(u[p]="",u),{})),[r,a]=b.useState(null),{pgEnv:l,baseUrl:i}=w.useContext(ce);b.useEffect(()=>{(async()=>{const p=(await Promise.all(Object.keys(Zt).map(async m=>Zt[m].getIsAlreadyCreated&&await Zt[m].getIsAlreadyCreated(l)?null:m))).filter(Boolean).reduce((m,h)=>(m[h]=Zt[h],m),{});a(p)})()},[l]);const c=["name"],d=async()=>{const p=await(await fetch(`${Rt}/dama-admin/${l}/collection/publish`,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}})).json();t(`${i}/collection/${p.collection_id}`)};return e.jsx("div",{children:e.jsxs(ss,{children:[e.jsx("div",{className:"p-4 font-medium",children:" Create New Collection "}),e.jsxs("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:[e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:Object.keys(or).filter(u=>!["collection_id","metadata","categories","source_dependencies","user_id","_created_timestamp","_modified_timestamp"].includes(u)).map((u,p)=>e.jsx("div",{className:"flex justify-between group",children:e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 py-5 capitalize",children:[u," ",c.includes(u)&&e.jsx("span",{style:{color:"red",verticalAlign:"super"},children:"*"})]}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"pt-3 pr-8",children:e.jsx(Un,{className:"w-full p-2 flex-1 px-2 shadow bg-grey-50 focus:bg-blue-100  border-gray-300 ",value:C(s,u,""),onChange:m=>{n({...s,[u]:m})}})})})]})},p))}),e.jsx("div",{children:e.jsx(We,{onClick:()=>{d()},children:"Publish"})})]})]})})};async function QO({falcor:t,pgEnv:s,sourceId:n}){const r=await t.get(["dama",s,"sources","byId",n,"dependents"]),a=[],l=[];C(r,["json","dama",s,"sources","byId",n,"dependents"]).forEach(i=>{a.push(i.source_id),l.push(i.view_id)}),await t.get(["dama",s,"sources","byId",[...a,n],"attributes",["type","name","display_name"]]),await t.get(["dama",s,"views","byId",l,"attributes",["version","metadata","_modified_timestamp","last_updated"]])}const eP=({text:t})=>{const{falcor:s,baseUrl:n,pgEnv:r}=w.useContext(ce),{sourceId:a}=Ye(),l=$e();async function i(){const d=await(await fetch(`${Rt}/dama-admin/${r}/deleteDamaSource`,{method:"POST",body:JSON.stringify({source_id:a}),headers:{"Content-Type":"application/json"}})).json();console.log("delete response",d),s.invalidate(["dama",r,"sources","length"],["dama",r,"sources","byIndex"],["dama",r,"sources","byId",a]),console.log("navigate to",n),l(n||"/")}return e.jsx("button",{className:"bg-red-50 hover:bg-red-400 hover:text-white p-2",onClick:i,children:"Confirm Delete"})},tP=()=>e.jsxs("div",{className:"pb-4 flex justify-between",children:[e.jsx("label",{children:"No dependents found."}),e.jsx(eP,{text:"Confirm Delete"})]});function sP(){const{pgEnv:t,baseUrl:s,falcor:n,falcorCache:r}=w.useContext(ce),{sourceId:a}=Ye();console.log("delete page",a),b.useEffect(()=>{QO({falcor:n,pgEnv:t,sourceId:a})},[a,t,n]),C(r,["dama",t,"sources","byId",a,"dependents","value"],[]);const l=C(r,["dama",t,"sources","byId",a,"attributes","name"],"");return C(r,["dama",t,"sources","byId"],{}),C(r,["dama",t,"views","byId"],{}),e.jsx("div",{children:e.jsx(ss,{children:e.jsxs("div",{className:"w-full p-4 bg-white my-1 block border shadow",children:[e.jsxs("div",{className:"pb-4 font-bold",children:["Delete ",e.jsx("i",{children:l})]}),tP()]})})})}const zm=t=>Object.entries(t||{}).reduce((s,n)=>{const[r,a]=n;return typeof a.value<"u"?s[r]=a.value:s[r]=a,s},{}),nP=({fullWidth:t})=>{const{etl_context_id:s}=Ye(),{pgEnv:n,baseUrl:r,falcor:a,falcorCache:l}=w.useContext(ce);b.useEffect(()=>{async function c(){return await a.get(["dama",n,"etlContexts","byEtlContextId",s,"attributes",tc]).then(d=>{var p;const u=zm(C(d,["json","dama",n,"etlContexts","byEtlContextId",s],{attributes:{}}));Object.keys(u).length&&a.get(["dama",n,"sources","byId",[(p=u==null?void 0:u.meta)==null?void 0:p.source_id],"attributes","name"])})}s&&c()},[a,s,n]);const i=b.useMemo(()=>{var m,h;const c=zm(C(l,["dama",n,"etlContexts","byEtlContextId",s],{attributes:{}}).value);let d=C(l,["dama",n,"sources","byId",[(m=c==null?void 0:c.meta)==null?void 0:m.source_id],"attributes","name"],"");const u=(h=c==null?void 0:c.events)==null?void 0:h.find(f=>f.type.toLowerCase().includes("initial"));return d=typeof d=="string"?d:"",u&&u.type&&(d+=" "+u.type.split(":")[0]),[{name:d}]},[l,s,n,r]);return e.jsx("nav",{className:"border-b border-gray-200 flex ","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:`${t?"w-full":"max-w-screen-xl w-full mx-auto"}  px-4 flex space-x-4 sm:px-6 lg:px-8`,children:[e.jsx("li",{className:"flex",children:e.jsx("div",{className:"flex items-center",children:e.jsxs(je,{to:`${r||"/"}`,className:"hover:text-[#bbd4cb] text-[#679d89]",children:[e.jsx("i",{className:"fad fa-database flex-shrink-0 h-5 w-5","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Home"})]})})}),e.jsx("li",{className:"flex",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"flex-shrink-0 w-6 h-full text-gray-300",viewBox:"0 0 30 44",preserveAspectRatio:"none",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:e.jsx("path",{d:"M.293 0l22 22-22 22h1.414l22-22-22-22H.293z"})}),e.jsx(je,{to:`${r}/tasks`,className:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700",children:"All Tasks"})]})}),i.map((c,d)=>e.jsx("li",{className:"flex",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"flex-shrink-0 w-6 h-full text-gray-300",viewBox:"0 0 30 44",preserveAspectRatio:"none",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:e.jsx("path",{d:"M.293 0l22 22-22 22h1.414l22-22-22-22H.293z"})}),c.href?e.jsx(je,{to:c.href,className:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700","aria-current":c.current?"page":void 0,children:c.name}):e.jsx("div",{className:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700","aria-current":c.current?"page":void 0,children:c.name})]})},d))]})})},Ib=({children:t})=>e.jsxs(e.Fragment,{children:[e.jsx(nP,{}),e.jsx("div",{className:"mt-4",children:t})]}),aP=t=>e.jsx(Ib,{children:e.jsx(Wx,{...t})});function rP(t,s,n){return n.indexOf(t)===s}const oP=({value:t,...s})=>{const n=new Date(t);return e.jsx("div",{children:n.toLocaleString()})},lP=[{accessor:"etl_context_id",Header:"ETL Context ID"},{accessor:"event_id",Header:"Event ID"},{accessor:"user",Header:"User",Cell:Ux},{accessor:"created_at",Header:"Created At",Cell:oP},{accessor:"type",Header:"Type"},{accessor:"payload",Header:"Data",Cell:({value:t})=>{const s=typeof t=="string"?JSON.parse(t):t,n=(s==null?void 0:s.data)||(s==null?void 0:s.message);return e.jsx(e.Fragment,{children:JSON.stringify(n)})}}],Va=10,iP=t=>{const{etl_context_id:s}=Ye(),{pgEnv:n,falcor:r,falcorCache:a}=w.useContext(ce),[l,i]=w.useState(0),c=w.useMemo(()=>ws(l*Va,l*Va+Va),[l,Va]),d=["dama",n,"etlContexts",s,"allEvents","length"],u=h=>["dama",n,"etlContexts",s,"allEvents",h,["event_id","etl_context_id","created_at","type","payload","user"]];w.useEffect(()=>{(async()=>{await r.get(d)})()},[r,n]);const p=w.useMemo(()=>C(a,d),[r,a,n]);w.useEffect(()=>{(async()=>{await r.get(u(c)).then(f=>{const g=u(c);g.pop(),g.pop();const x=Object.values(C(f,["json",...g])).map(j=>j.etl_context_id).filter(j=>!!j).filter(rP),y=["dama",n,"etlContexts","byEtlContextId"];x.forEach(j=>{r.get([...y,j])})})})()},[r,n,c]);const m=w.useMemo(()=>c.map(h=>{const f=u(h);return f.pop(),{...C(a,f)}}).filter(h=>!!h.etl_context_id),[a,n,s,c]);return e.jsx(Ib,{children:e.jsx(St,{data:m,columns:lP,pageSize:Va,manualPagination:!0,numRecords:p,onPageChange:i,sortBy:"created_at",sortOrder:"desc",disableFilters:!0,disableSortBy:!0})})},cP=()=>{const{pgEnv:t,baseUrl:s,falcor:n,falcorCache:r}=w.useContext(ce),[a,l]=b.useState(""),[i,c]=b.useState(!1),d=w.useCallback(f=>{c(!0),n.set({paths:[["dama-info",t,"settings"]],jsonGraph:{"dama-info":{[t]:{settings:JSON.stringify({filtered_categories:f.filteredCategories})}}}}).then(()=>c(!1))},[t]);b.useEffect(()=>{async function f(){const g=["dama",t,"sources","length"],x=await n.get(g);await n.get(["dama",t,"sources","byIndex",{from:0,to:C(x.json,g,0)-1},"attributes",Object.values(Es)],["dama-info",t,"settings"])}f()},[n,t]);const u=b.useMemo(()=>Object.values(C(r,["dama",t,"sources","byIndex"],{})).map(f=>ts(C(r,f.value,{attributes:{}}).attributes)),[r,t]),p=b.useMemo(()=>C(r,["dama-info",t,"settings","value","filtered_categories"],[]),[r,t]),m=[...new Set(u.filter(f=>{var g;return!((g=f.categories)!=null&&g.find(x=>p.find(y=>x.includes(y))))}).reduce((f,g)=>{var x;return[...f,...((x=g.categories)==null?void 0:x.map(y=>y[0]))||[]]},[]))].sort(),h=[...new Set(u.reduce((f,g)=>{var x;return[...f,...((x=g.categories)==null?void 0:x.map(y=>y[0]))||[]]},[]))].reduce((f,g)=>{var x;return f[g]=(x=u.filter(y=>{var j;return(j=y.categories)==null?void 0:j.find(N=>N.includes(g))}))==null?void 0:x.length,f},{});return e.jsxs(ss,{baseUrl:s,children:[e.jsx("input",{value:a,className:"my-4 w-full text-lg p-2 border border-gray-300 ",placeholder:"Start typing or click on a category to filter categories...",onChange:f=>{l(f.target.value)},onKeyDown:f=>{const g=m.find(x=>x.toLowerCase()===f.target.value.toLowerCase());f.key==="Enter"&&g&&(d({filteredCategories:[...p,g]}),l(""))}}),e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"w-full sm:w-1/2 border-2 p-1 my-1 bg-slate-200 rounded-md",children:[e.jsxs("label",{className:"text-gray-800 text-sm",children:["Available Categories",e.jsx("span",{className:"text-xs italic mx-1",children:"(click to filter...)"})]}),e.jsx("div",{className:"flex flex-row",children:e.jsx("div",{className:"w-full flex flex-wrap p-1 max-h-[80dvh] overflow-auto scrollbar-sm",children:(m||[]).filter(f=>!a||f.toLowerCase().includes(a.toLowerCase())).sort((f,g)=>f.localeCompare(g)).map(f=>e.jsxs("button",{className:"bg-white hover:bg-blue-50 p-2 m-1 rounded-md flex items-center",onClick:g=>d({filteredCategories:[...p,f]}),children:[e.jsx("i",{className:"fa fa-category"})," ",f,e.jsx("div",{className:"bg-blue-200 text-blue-600 text-xs w-5 h-5 ml-2 shrink-0 grow-0 rounded-lg flex items-center justify-center border border-blue-300",children:h[f]})]},f))})})]}),e.jsxs("div",{className:"w-full sm:w-1/2 border-2 p-1 my-1 bg-slate-200 rounded-md",children:[e.jsxs("label",{className:"text-gray-800 text-sm",children:["Filtered Categories ",e.jsx("span",{className:"text-xs italic mx-1",children:"(click to un-filter...)"})]}),e.jsx("div",{className:"w-full flex flex-wrap items-center p-1 max-h-[20dvh] overflow-auto scrollbar-sm",children:p!=null&&p.length?p.filter(f=>!a||f.toLowerCase().includes(a.toLowerCase())).sort((f,g)=>f.localeCompare(g)).map(f=>e.jsxs("button",{className:"bg-white hover:bg-blue-50 p-2 m-1 rounded-md flex items-center",onClick:g=>d({filteredCategories:p.filter(x=>x!==f)}),children:[e.jsx("i",{className:"fa fa-category"})," ",f,e.jsx("div",{className:"bg-blue-200 text-blue-600 text-xs w-5 h-5 ml-2 shrink-0 grow-0 rounded-lg flex items-center justify-center border border-blue-300",children:h[f]})]},f)):e.jsx("div",{className:"text-gray-800",children:"No categories have been filtered."})})]})]})]})},dP=({totalPages:t,pageSize:s,currentPage:n,setVCurrentPage:r})=>{const a=Math.ceil(t/s);return e.jsxs("div",{className:"float-right flex flex-col items-end p-1 text-sm font-gray-500",children:[e.jsxs("div",{className:"text-xs italic",children:["showing ",Math.min(s,t)," of ",isNaN(t)?0:parseInt(t).toLocaleString()," rows"]}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("div",{className:"mx-1 cursor-pointer hover:text-gray-800",onClick:()=>r(n>0?n-1:n),children:"<< prev"}),e.jsx("select",{className:"p-0.5 border-2 text-gray-800 hover:bg-blue-50 rounded-lg",value:n,onChange:l=>r(+l.target.value),children:[...new Array(a).keys()].map(l=>e.jsx("option",{className:"p-2 border-2 text-gray-800 hover:bg-blue-50",value:l,children:l+1},l))}),e.jsx("div",{className:"mx-1 cursor-pointer text-gray-500 hover:text-gray-800",onClick:()=>r(n<t?n+1:n),children:"next >>"})]})]})},uP=t=>{if(typeof t=="object")return t;try{return JSON.parse(t)}catch{return t}},Um=t=>typeof t=="object"?JSON.stringify(t):t,mP=[{app:"dms-site",type:"docs-page",baseUrl:""},{app:"dms-site",type:"docs-docs",baseUrl:"/docs"},{app:"dms-site",type:"docs-play",baseUrl:"/playground"}],pP=()=>{const{pgEnv:t,baseUrl:s,falcor:n,falcorCache:r}=w.useContext(ce),[a,l]=b.useState({app:"dms-site",type:"docs-page",baseUrl:""});b.useState(void 0);const[i,c]=b.useState(!1),[d,u]=b.useState(0),p=20;b.useEffect(()=>{async function g(){c(!0);const x=await n.get(["dms","data",`${a.app}+${a.type}`,"length"]),y=C(x,["json","dms","data",`${a.app}+${a.type}`,"length"],0);await n.get(["dms","data",`${a.app}+${a.type}`,"byIndex",{from:0,to:y-1},["app","type","data"]]),c(!1)}g()},[a,t]);const m=b.useMemo(()=>Object.values(C(r,["dms","data",`${a.app}+${a.type}`,"byIndex"],{})).map(g=>C(r,g.value)).filter(g=>{var x,y;return!((y=(x=g==null?void 0:g.data)==null?void 0:x.value)!=null&&y.template_id)}),[r,t,a]),h=b.useMemo(()=>m.reduce((g,x)=>[...g,...C(x,["data","value","sections"],[]).map(y=>y.id).filter(y=>y)],[]),[m]);b.useEffect(()=>{async function g(){h.length&&(c(!0),await n.chunk(["dms","data","byId",h,["data"]]),c(!1))}g()},[m]);const f=b.useMemo(()=>h.reduce((g,x)=>({...g,[x]:C(r,["dms","data","byId",x,"data","value"])}),{}),[r,t,m,h]);return e.jsxs(ss,{baseUrl:s,children:[e.jsx("select",{className:"p-4 bg-transparent font-bold",value:JSON.stringify(a),onChange:g=>l(JSON.parse(g.target.value)),children:mP.map(g=>e.jsx("option",{value:JSON.stringify(g),children:JSON.stringify(g)},g))}),e.jsx("div",{className:"font-bold max-h-[calc(100vh-150px)] grid grid-cols-2 divide-x divide-y overflow-auto scrollbar-sm",style:{gridTemplateColumns:"1fr 3fr"},children:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"Page"}),e.jsx("div",{children:"Sections"})]})}),e.jsx("div",{className:"max-h-[calc(100vh-150px)] grid grid-cols-2 divide-x divide-y overflow-auto scrollbar-sm",style:{gridTemplateColumns:"1fr 3fr"},children:m.filter((g,x)=>x>=d*p&&x<d*p+p).map((g,x)=>{const y=C(g,["data","value","sections"],[]).filter(j=>f[j.id]).map(j=>{var L,S,k,$,I;const N=uP((S=(L=f[j.id])==null?void 0:L.element)==null?void 0:S["element-data"]),_=Um((N==null?void 0:N.dataSource)||(N==null?void 0:N.ealSourceId)),E=Um((N==null?void 0:N.version)||(N==null?void 0:N.ealViewId));return e.jsxs("div",{className:"p-2 hover:bg-blue-300",children:[e.jsxs(je,{className:"w-full justify-between",to:`${a.baseUrl}/${C(g,["data","value","url_slug"])}#${j.id}`,children:[(k=f[j.id])==null?void 0:k.title,e.jsx("span",{className:"px-4 italic text-blue-300 hover: text-blue-600 text-sm",children:"view"})]}),e.jsxs("div",{children:["type: ",(I=($=f[j.id])==null?void 0:$.element)==null?void 0:I["element-type"]]}),e.jsxs("div",{className:"font-bold text-gray-900",children:["source: ",_]}),e.jsxs("div",{className:"font-bold text-gray-900",children:["version: ",E]})]})});return e.jsxs(w.Fragment,{children:[e.jsx("div",{className:"p-2 w-full",children:e.jsxs(je,{to:`${a.baseUrl}/${C(g,["data","value","url_slug"])}`,children:[C(g,["data","value","title"]),e.jsx("span",{className:"px-4 italic text-sm",children:C(g,["data","value","url_slug"])})]})}),e.jsx("div",{className:"p-2 h-[250px] overflow-auto scrollbar-sm",children:y})]})})}),e.jsx(dP,{pageSize:p,totalPages:m.length,currentPage:d,setVCurrentPage:u})]})},Ea=({className:t="fill-slate-800",size:s="20"})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 24 24",className:t,children:e.jsx("path",{d:"M10.5858 12L4.92898 17.6569L6.3432 19.0711L12 13.4143L17.6569 19.0711L19.0711 17.6569L13.4142 12L19.0711 6.34317L17.6569 4.92896L12 10.5858L6.34317 4.92897L4.92896 6.34319L10.5858 12Z"})}),bd=({className:t="fill-slate-800",size:s="12"})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 12 12",className:t,children:e.jsx("path",{d:"M7 0H5V5H0V7H5V12H7V7H12V5H7V0Z"})}),yd=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 13.5C7.82843 13.5 8.5 12.8284 8.5 12C8.5 11.1716 7.82843 10.5 7 10.5C6.17157 10.5 5.5 11.1716 5.5 12C5.5 12.8284 6.17157 13.5 7 13.5ZM13.5 12C13.5 12.8284 12.8284 13.5 12 13.5C11.1716 13.5 10.5 12.8284 10.5 12C10.5 11.1716 11.1716 10.5 12 10.5C12.8284 10.5 13.5 11.1716 13.5 12ZM18.5 12C18.5 12.8284 17.8284 13.5 17 13.5C16.1716 13.5 15.5 12.8284 15.5 12C15.5 11.1716 16.1716 10.5 17 10.5C17.8284 10.5 18.5 11.1716 18.5 12Z"})}),Tb=({className:t="fill-gray-900",onClick:s=()=>{}})=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,onClick:s,children:[e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.1278 12C15.1278 13.6863 13.7274 15.0533 12 15.0533C10.2726 15.0533 8.8722 13.6863 8.8722 12C8.8722 10.3137 10.2726 8.94664 12 8.94664C13.7274 8.94664 15.1278 10.3137 15.1278 12ZM13.3717 12C13.3717 12.7395 12.7576 13.339 12 13.339C11.2424 13.339 10.6283 12.7395 10.6283 12C10.6283 11.2604 11.2424 10.6609 12 10.6609C12.7576 10.6609 13.3717 11.2604 13.3717 12Z"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 18C7.90486 18 4.40498 15.512 3 12C4.40498 8.48798 7.90475 6 11.9999 6C16.095 6 19.595 8.48798 21 12C19.595 15.512 16.0951 18 12 18ZM11.9999 7.71429C15.1026 7.71429 17.7877 9.45991 19.0808 12C17.7877 14.5401 15.1027 16.2857 12 16.2857C8.89726 16.2857 6.21206 14.5401 4.91897 12C6.21206 9.45991 8.89715 7.71429 11.9999 7.71429Z"})]}),Mb=({className:t="fill-slate-800",onClick:s=()=>{}})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,onClick:s,children:e.jsx("path",{d:"M3 12C3.34629 12.8656 3.81984 13.669 4.3982 14.3883L3.1051 15.6814L4.51932 17.0956L5.80754 15.8074C6.60111 16.4553 7.50288 16.9811 8.48252 17.3552L8.01453 19.1018L9.94638 19.6194L10.4142 17.8735C10.9301 17.9567 11.4599 18 12 18C12.5413 18 13.0722 17.9565 13.5892 17.873L14.0572 19.6194L15.989 19.1018L15.5207 17.354C16.4999 16.9796 17.4012 16.4537 18.1944 15.8058L19.4842 17.0956L20.8984 15.6814L19.6034 14.3863C20.181 13.6676 20.654 12.8648 21 12H19.0808C17.7877 14.5401 15.1027 16.2857 12 16.2857C8.89725 16.2857 6.21206 14.5401 4.91897 12H3Z"})}),hP=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.75146 15.1306V15.1306C6.7516 15.5448 6.41592 15.8807 6.0017 15.8808C5.58749 15.881 5.2516 15.5453 5.25146 15.1311C5.25142 14.9906 5.29183 13.8577 5.72195 12.7308C6.15161 11.6052 7.07875 10.2542 8.93625 10.2542C10.6713 10.2542 11.7208 10.8779 12.6242 11.4218L12.6343 11.4279C13.5029 11.9509 14.2064 12.3744 15.4163 12.3744C15.9048 12.3744 16.2194 12.1925 16.4573 11.9172C16.7183 11.6151 16.9063 11.1726 17.0283 10.6575C17.1484 10.1509 17.1911 9.63239 17.2023 9.23237C17.2078 9.03445 17.2055 8.87034 17.2019 8.75742C17.2001 8.70106 17.198 8.65774 17.1964 8.62967L17.1946 8.59935L17.1942 8.59372C17.1628 8.18088 17.4718 7.82024 17.8847 7.78861C18.2977 7.75696 18.6582 8.06611 18.6898 8.47911L17.942 8.53641C18.6898 8.47911 18.6898 8.47911 18.6898 8.47911L18.69 8.48178L18.6903 8.48614L18.6913 8.4998L18.6941 8.54621C18.6963 8.58534 18.6989 8.64059 18.7011 8.70969C18.7055 8.84767 18.7082 9.042 18.7017 9.27419C18.6888 9.73442 18.6397 10.3629 18.4879 11.0033C18.3382 11.6352 18.0746 12.3396 17.5923 12.8979C17.0869 13.4828 16.3665 13.8744 15.4163 13.8744C13.7881 13.8744 12.7801 13.267 11.9056 12.74C11.8871 12.7289 11.8688 12.7179 11.8505 12.7068C10.993 12.1906 10.2412 11.7542 8.93625 11.7542C8.00391 11.7542 7.46363 12.3742 7.12334 13.2657C6.95675 13.7022 6.86216 14.1544 6.80996 14.5155C6.78413 14.6942 6.76931 14.8461 6.76102 14.9566C6.75321 15.0608 6.75168 15.1221 6.75146 15.1306Z"})}),fP=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.6289 16.4087C18.7672 16.1958 18.7885 15.9274 18.6854 15.6954L14.6854 6.6954C14.5242 6.3327 14.1083 6.15839 13.7367 6.29775L5.73666 9.29775C5.44393 9.40753 5.25 9.68737 5.25 10L5.25 16C5.25 16.4142 5.58578 16.75 6 16.75L18 16.75C18.2539 16.75 18.4905 16.6216 18.6289 16.4087ZM16.8459 15.25L6.75 15.25L6.75 10.5197L13.6017 7.95038L16.8459 15.25Z"})}),gP=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 14.5C13.3807 14.5 14.5 13.3807 14.5 12C14.5 10.6193 13.3807 9.5 12 9.5C10.6193 9.5 9.5 10.6193 9.5 12C9.5 13.3807 10.6193 14.5 12 14.5ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z"})}),vd=({className:t="fill-slate-800"})=>e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",className:t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.64645 4.64645C2.84171 4.45118 3.15829 4.45118 3.35355 4.64645L6 7.29289L8.64645 4.64645C8.84171 4.45118 9.15829 4.45118 9.35355 4.64645C9.54882 4.84171 9.54882 5.15829 9.35355 5.35355L6.35355 8.35355C6.15829 8.54882 5.84171 8.54882 5.64645 8.35355L2.64645 5.35355C2.45118 5.15829 2.45118 4.84171 2.64645 4.64645Z"})}),xP=({className:t="fill-slate-800",size:s="12",onClick:n=()=>{}})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 320 512",className:t,onClick:n,children:e.jsx("path",{d:"M137.4 374.6c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l128 128z"})}),bP=({className:t="fill-slate-800",size:s="12",onClick:n=()=>{}})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 320 512",className:t,onClick:n,children:e.jsx("path",{d:"M182.6 137.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8l256 0c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-128-128z"})}),yP=({className:t="fill-slate-800",size:s="12"})=>e.jsx("svg",{className:t,width:s,height:s,viewBox:"0 0 576 512",children:e.jsx("path",{d:"M384 480l48 0c11.4 0 21.9-6 27.6-15.9l112-192c5.8-9.9 5.8-22.1 .1-32.1S555.5 224 544 224l-400 0c-11.4 0-21.9 6-27.6 15.9L48 357.1 48 96c0-8.8 7.2-16 16-16l117.5 0c4.2 0 8.3 1.7 11.3 4.7l26.5 26.5c21 21 49.5 32.8 79.2 32.8L416 144c8.8 0 16 7.2 16 16l0 32 48 0 0-32c0-35.3-28.7-64-64-64L298.5 96c-17 0-33.3-6.7-45.3-18.7L226.7 50.7c-12-12-28.3-18.7-45.3-18.7L64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l23.7 0L384 480z"})}),vP=({className:t="fill-slate-800",size:s="12"})=>e.jsx("svg",{className:t,width:s,height:s,viewBox:"0 0 448 512",children:e.jsx("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"})}),jP=({className:t="fill-slate-800",size:s="12"})=>e.jsx("svg",{className:t,width:s,height:s,viewBox:"0 0 448 512",children:e.jsx("path",{d:"M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-242.7c0-17-6.7-33.3-18.7-45.3L352 50.7C340 38.7 323.7 32 306.7 32L64 32zm0 96c0-17.7 14.3-32 32-32l192 0c17.7 0 32 14.3 32 32l0 64c0 17.7-14.3 32-32 32L96 224c-17.7 0-32-14.3-32-32l0-64zM224 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"})}),ln=["rgb(80, 149, 127)","rgb(159, 161, 69)","rgb(128, 182, 109)","rgb(122, 168, 36)","rgb(96, 117, 159)","rgb(55, 124, 164)","rgb(78, 139, 212)","rgb(104, 198, 222)","rgb(136, 154, 221)","rgb(143, 125, 191)","rgb(158, 101, 179)","rgb(191, 105, 162)","rgb(204, 98, 92)","rgb(235, 147, 96)","rgb(213, 176, 42)","rgb(242, 218, 58)","rgb(173, 122, 103)","rgb(130, 100, 100)","rgb(128, 128, 128)","rgb(204, 204, 204)"],Jo=t=>((!t||typeof t!="string")&&(t=ln[yl(0,ln.length-1)]),"#"+t.match(/\d+/g).map(n=>(+n).toString(16).padStart(2,0)).join``),wP=t=>{const{style:s}=new Option;return s.color=t,s.color},Rn=t=>Jo(wP(t));function NP(t,s){const n=ln[yl(0,ln.length-1)];return[{id:t,type:"circle",layout:{visibility:"visible"},paint:{"circle-color":n,"circle-radius":4,"circle-stroke-color":jd(-.4,n),"circle-stroke-width":1},source:`${s.source}_${t}`,"source-layer":s["source-layer"]}]}function CP(t,s){const n=ln[yl(0,ln.length-1)];return[{id:`${t}_case`,type:"line",layout:{visibility:"visible"},paint:{"line-color":jd(-.4,n),"line-width":3},source:`${s.source}_${t}`,"source-layer":s["source-layer"]},{id:t,type:"line",layout:{visibility:"visible"},paint:{"line-color":n,"line-width":3},source:`${s.source}_${t}`,"source-layer":s["source-layer"]}]}function _P(t,s){const n=ln[yl(0,ln.length-1)];return[{id:`${t}_case`,type:"line",layout:{visibility:"visible"},paint:{"line-color":jd(-.4,n),"line-width":1},source:`${s.source}_${t}`,"source-layer":s["source-layer"]},{id:t,type:"fill",layout:{visibility:"visible"},paint:{"fill-color":n,"fill-opacity":.75},source:`${s.source}_${t}`,"source-layer":s["source-layer"]}]}const SP=(t,s)=>{const n={fill:_P,line:CP,circle:NP};return n[s==null?void 0:s.type]?n[s==null?void 0:s.type](t,s):[s]},jd=(t,i)=>{var n=parseInt,r=Math.round,[a,l,i,c]=i.split(","),u=t<0,d=u?0:t*255**2,u=u?1+t:1-t;return"rgb"+(c?"a(":"(")+r((u*n(a[3]=="a"?a.slice(5):a.slice(4))**2+d)**.5)+","+r((u*n(l)**2+d)**.5)+","+r((u*n(i)**2+d)**.5)+(c?","+c:")")};function yl(t=0,s=100){return Math.floor(Math.random()*(s-t))+t}const Bb=t=>{const s=b.useRef();return b.useEffect(()=>{s.current=t}),s.current},wd={cat1:["rgb(107, 184, 199)","rgb(229, 102, 102)","rgb(172, 114, 165)","rgb(114, 172, 120)","rgb(234, 147, 97)","rgb(166, 140, 217)","rgb(237, 190, 94)","rgb(103, 203, 148)","rgb(209, 152, 77)","rgb(168, 169, 96)"],cat2:["rgb(234, 147, 97)","rgb(136, 154, 221)","rgb(198, 150, 88)","rgb(139, 193, 168)","rgb(225, 184, 81)","rgb(206, 126, 168)","rgb(184, 203, 128)","rgb(152, 135, 196)","rgb(223, 215, 129)","rgb(148, 209, 152)"],cat3:["rgb(119, 170, 221)","rgb(238, 136, 102)","rgb(238, 221, 136)","rgb(255, 170, 187)","rgb(153, 221, 255)","rgb(68, 187, 153)","rgb(187, 204, 51)","rgb(112, 128, 207)","rgb(170, 170, 0)","rgb(170, 68, 153)"],cat4:["rgb(155, 201, 69)","rgb(138, 81, 158)","rgb(228, 136, 7)","rgb(195, 75, 143)","rgb(46, 137, 194)","rgb(60, 175, 154)","rgb(249, 122, 113)","rgb(223, 173, 22)","rgb(116, 116, 205)","rgb(179, 136, 86)"],cat5:["rgb(92, 107, 192)","rgb(255, 167, 38)","rgb(236, 64, 122)","rgb(66, 165, 245)","rgb(255, 112, 67)","rgb(102, 187, 106)","rgb(255, 213, 79)","rgb(38, 166, 154)","rgb(255, 138, 101)","rgb(126, 87, 194)"],cat6:["rgb(204, 102, 119)","rgb(51, 34, 136)","rgb(221, 204, 119)","rgb(17, 119, 51)","rgb(136, 204, 238)","rgb(136, 34, 85)","rgb(68, 170, 153)","rgb(153, 153, 51)","rgb(170, 68, 153)","rgb(238, 119, 51)"],cat7:["rgb(129, 144, 71)","rgb(93, 106, 42)","rgb(172, 114, 165)","rgb(107, 71, 128)","rgb(114, 127, 192)","rgb(76, 89, 154)","rgb(179, 126, 117)","rgb(141, 87, 78)","rgb(166, 140, 43)","rgb(76, 141, 154)"],cat8:["rgb(255, 115, 87)","rgb(255, 142, 66)","rgb(255, 173, 41)","rgb(249, 203, 21)","rgb(147, 208, 83)","rgb(40, 189, 140)","rgb(7, 166, 171)","rgb(64, 142, 191)","rgb(107, 127, 184)","rgb(138, 111, 165)"],cat9:["rgb(201, 63, 54)","rgb(219, 96, 51)","rgb(233, 125, 43)","rgb(242, 154, 38)","rgb(248, 187, 42)","rgb(191, 202, 88)","rgb(139, 179, 111)","rgb(103, 158, 125)","rgb(69, 130, 124)","rgb(40, 109, 128)"]},$P=({source:t,selectedSource:s,setSource:n,cat1:r,setCat1:a})=>{const{pgEnv:l,baseUrl:i,falcor:c,falcorCache:d}=w.useContext(ce),u=s.viewId,p=(s==null?void 0:s.sourceId)===t.source_id,m=["dama",l,"sources","byId",t.source_id,"views","length"],h=b.useMemo(()=>parseInt(C(d,m,0)),[d]);b.useEffect(()=>{async function g(){const x=await c.get(m);await c.get(["dama",l,"sources","byId",t.source_id,"views","byIndex",{from:0,to:C(x.json,m,0)-1},"attributes",Object.values(fn)])}g()},[c,d,t,l]);const f=b.useMemo(()=>Object.values(C(d,["dama",l,"sources","byId",t.source_id,"views","byIndex"],{})).map(g=>{var x;return ts((x=C(d,g.value,{}))==null?void 0:x.attributes)}).sort((g,x)=>new Date(x==null?void 0:x._created_timestamp)-new Date(g==null?void 0:g._created_timestamp)),[d,t.source_id]);return e.jsxs("div",{children:[e.jsx("div",{className:`w-full p-4 ${p?"bg-blue-100 hover:bg-blue-200":"bg-white hover:bg-blue-50"} overflow-hidden block border shadow flex`,onClick:()=>{if(s.sourceId!==t.source_id){const g={...t,add:!0,sourceId:t.source_id};h===1&&f.length===1&&(g.viewId=f[0].view_id),n(g)}else n({...rc,add:!0})},children:e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-medium w-full block",children:e.jsx("span",{children:t.name})}),e.jsx("div",{children:(C(t,"categories",[])||[]).map(g=>(typeof g=="string"?[g]:g).map((x,y)=>{const j=x===r;let N="bg-blue-100 text-blue-400 hover:bg-blue-400";return(p||j)&&(N="bg-blue-300 text-blue-500 hover:bg-blue-400",p&&j&&(N="bg-blue-400 text-blue-600 hover:bg-blue-500")),e.jsx("div",{onClick:_=>{_.stopPropagation(),a(j?"":x)},className:`inline hover:cursor-pointer text-xs p-1 px-2 ${N}  mr-2`,children:x},y)}))}),e.jsx("div",{className:"py-2 block",children:t.description})]})}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-200 shadow grid grid-cols-10 ",children:[e.jsx("div",{className:"border-bottom border-black border-b-2 pl-4 col-span-6",children:"Name"}),e.jsx("div",{className:"border-bottom border-black border-b-2 pl-[7px] col-span-2",children:"Date uploaded"}),e.jsx("div",{className:"border-bottom border-black border-b-2 pl-[3px] col-span-2",children:"Last modified"})]}),f.map((g,x)=>{const y=u===g.view_id,j=x%2==0,N=y?"bg-gray-300 hover:bg-gray-400":j?"bg-gray-200 hover:bg-gray-300":"bg-gray-100 hover:bg-gray-200";return e.jsxs("div",{className:`${N} px-4  shadow grid grid-cols-10 gap-4`,onClick:()=>{n(y?{...s,viewId:void 0}:{...s,viewId:g.view_id})},children:[e.jsx("div",{className:"col-span-6",children:e.jsx("div",{children:g.version??g.view_id})}),e.jsx("div",{className:"flex items-center col-span-2",children:new Date(g._created_timestamp).toLocaleDateString()}),e.jsxs("div",{className:"flex items-center col-span-2",children:[new Date(g._modified_timestamp).toLocaleDateString(),y&&e.jsx(vc,{className:"ml-2 text-green-700 h-5 w-5"})]})]},`sourceview_row_${g.view_id}`)})]})]})},EP=({selectedSource:t,setSource:s})=>{var E,L;const[n,r]=b.useState(""),[a,l]=b.useState(),[i,c]=b.useState(),{pgEnv:d,baseUrl:u,falcor:p,falcorCache:m}=w.useContext(ce),[h,f]=b.useState("asc"),g="Unknown",x=((L=(E=window.location.pathname.replace(`${u}/`,""))==null?void 0:E.split("/"))==null?void 0:L[0])==="listall";b.useEffect(()=>{async function S(){const k=["dama",d,"sources","length"],$=await p.get(k);await p.get(["dama",d,"sources","byIndex",{from:0,to:C($.json,k,0)-1},"attributes",Object.values(Es)])}S()},[p,d]);const y=b.useMemo(()=>Object.values(C(m,["dama",d,"sources","byIndex"],{})).map(S=>ts(C(m,S.value,{attributes:{}}).attributes)),[m,d]),j=[...new Set(y.filter(S=>{var k;return x||!x&&!((k=S.categories)!=null&&k.find($=>$.includes(g)))}).reduce((S,k)=>{var $;return[...S,...(($=k.categories)==null?void 0:$.map(I=>I[0]))||[]]},[]))].sort(),N=j.reduce((S,k)=>{var $;return S[k]=($=y.filter(I=>{var T;return(T=I.categories)==null?void 0:T.find(A=>A.includes(k))}))==null?void 0:$.length,S},{}),_="bg-transparent hover:bg-blue-100 rounded-sm p-2 ml-0.5 border-2";return e.jsxs(ss,{baseUrl:u,isListAll:x,hideBreadcrumbs:!0,children:[e.jsxs("div",{className:"py-4 flex flex-rows items-center",children:[e.jsx("input",{className:"w-full text-lg p-2 border border-gray-300 ",placeholder:"Search datasources",value:n,onChange:S=>r(S.target.value)}),e.jsx("button",{className:_,title:"Toggle Sort",onClick:()=>f(h==="asc"?"desc":"asc"),children:e.jsx("i",{className:`fa-solid ${h==="asc"?"fa-arrow-down-z-a":"fa-arrow-down-a-z"} text-xl text-blue-400`})}),e.jsx("div",{onClick:()=>{l(""),r("")},className:_,title:x?"View Key Sources":"View All Sources",children:e.jsx("i",{className:`fa-solid ${x?"fa-filter-list":"fa-list-ul"} text-xl text-blue-400`})})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"w-1/4 flex flex-col space-y-1.5 max-h-[65dvh] overflow-auto scrollbar-sm",children:(j||[]).filter(S=>S!==g).sort((S,k)=>S.localeCompare(k)).map(S=>e.jsxs("div",{className:`${a===S||i===S?"bg-blue-100 hover:bg-blue-200":"bg-white hover:bg-blue-50"}  hover:cursor-pointer p-2 rounded-md flex items-center`,onClick:()=>{l(S===a?"":S)},children:[e.jsx("i",{className:"fa fa-category"}),S,e.jsx("div",{className:"bg-blue-200 text-blue-600 text-xs w-5 h-5 ml-2 shrink-0 grow-0 rounded-lg flex items-center justify-center border border-blue-300",children:N[S]})]},S))}),e.jsx("div",{className:"w-3/4 flex flex-col space-y-1.5 ml-1.5 max-h-[65dvh] overflow-y-auto overflow-x-hidden scrollbar-sm",children:y.filter(S=>{var k;return x||!x&&!((k=S.categories)!=null&&k.find($=>$.includes(g)))}).filter(S=>{let k=!0;return a&&(k=!1,(C(S,"categories",[])||[]).forEach($=>{$[0]===a&&(!i||$[1]===i)&&(k=!0)})),k}).filter(S=>{let k=S.name+" "+((S==null?void 0:S.categories)||[]).reduce(($,I)=>($+=Array.isArray(I)?I.join(" "):typeof I=="string"?I:"",$),"");return!n.length>2||k.toLowerCase().includes(n.toLowerCase())}).sort((S,k)=>{var I;return(h==="asc"?1:-1)*((I=S.name)==null?void 0:I.localeCompare(k.name))}).map((S,k)=>e.jsx($P,{cat1:a,setCat1:l,source:S,baseUrl:u,selectedSource:t,setSource:s},k))})]})]})},rc={active:!1,sourceId:null,viewId:null,add:!1};function kP(){const{state:t,setState:s}=w.useContext(He),{pgEnv:n,baseUrl:r,falcor:a,falcorCache:l}=w.useContext(ce),[i,c]=w.useState(rc);b.useEffect(()=>{async function h(){const f=["dama",n,"sources","length"],g=await a.get(f);await a.get(["dama",n,"sources","byIndex",{from:0,to:C(g.json,f,0)-1},"attributes",Object.values(Es)])}h()},[a,n]);const d=b.useMemo(()=>Object.values(C(l,["dama",n,"sources","byIndex"],{})).map(h=>ts(C(l,h.value,{attributes:{}}).attributes)),[l,n]);b.useEffect(()=>{async function h(){const{sourceId:f}=i,g=["dama",n,"sources","byId",f,"views","length"],x=await a.get(g);return await a.get(["dama",n,"sources","byId",f,"views","byIndex",{from:0,to:C(x.json,g,0)-1},"attributes",Object.values(fn)])}i.sourceId&&h()},[i.sourceId,a,n]);const u=b.useMemo(()=>Object.values(C(l,["dama",n,"sources","byId",i.sourceId,"views","byIndex"],{})).map(h=>ts(C(l,h.value,{attributes:{}}).attributes)),[l,i.sourceId,n]);b.useMemo(()=>{var h;return((h=t.symbology)==null?void 0:h.layers)||[]},[t.symbology]);const p=()=>{var j,N,_,E,L,S,k,$,I;const h=((j=d.filter(T=>T.source_id===+i.sourceId))==null?void 0:j[0])||{},f=((N=u.filter(T=>T.view_id===+i.viewId))==null?void 0:N[0])||{},g=Math.random().toString(36).replace(/[^a-z]+/g,""),x=(L=(E=(_=f==null?void 0:f.metadata)==null?void 0:_.tiles)==null?void 0:E.layers)==null?void 0:L[0],y={id:g,name:`${h.display_name||h.name} ${f.version||f.view_id}`,source_id:h.source_id,view_id:i.viewId,"layer-type":"simple",type:x.type,sources:(((k=(S=f==null?void 0:f.metadata)==null?void 0:S.tiles)==null?void 0:k.sources)||[]).map(T=>{const A={...T};return A.id=`${T.id}_${g}`,A}),layers:SP(g,x),isVisible:!0,hover:"hover",order:((I=Object.keys((($=t==null?void 0:t.symbology)==null?void 0:$.layers)||{}))==null?void 0:I.length)||0};s(T=>{var A;T!=null&&T.symbology||(T.symbology={}),(A=T==null?void 0:T.symbology)!=null&&A.layers||(T.symbology.layers={}),he(T,`symbology.layers[${g}]`,y),(!T.symbology.activeLayer||!T.symbology.layers[T.symbology.activeLayer])&&he(T,"symbology.activeLayer",y.id)}),c({add:!1,sourceId:null,viewId:null})},m=(i==null?void 0:i.sourceId)&&(i==null?void 0:i.viewId);return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"p-1 rounded hover:bg-slate-100 m-1",onClick:()=>c({...i,add:!i.add}),children:i.add?e.jsx(Ea,{className:"fill-slate-500"}):e.jsx(bd,{className:"fill-slate-500"})}),e.jsxs(Er,{open:i.add,setOpen:()=>c({...i,add:!i.add}),width:"w-[1200px]",children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fad fa-layer-group text-blue-600","aria-hidden":"true"})}),e.jsx("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full",children:e.jsx(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:"Add Layer"})})]}),e.jsx("div",{className:"mt-2 w-full",children:e.jsx(EP,{selectedSource:i,setSource:c})}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex justify-end",children:[e.jsx("div",{className:"mr-1",children:e.jsx("button",{type:"button",themeOptions:{color:"cancel"},className:"inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>c({...rc}),children:"Cancel"})}),e.jsx("div",{children:e.jsx("button",{type:"button",themeOptions:m?{color:"primary"}:{color:"transparent"},disabled:!m,className:"inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>p(),children:"Add layer"})})]})]})]})}const LP=({layer:t})=>{const{state:s,setState:n}=b.useContext(He),{falcor:r,falcorCache:a,pgEnv:l}=b.useContext(ce),{view_id:i}=t,{zoomToFit:c}=b.useMemo(()=>({zoomToFit:C(s,"symbology.zoomToFit")}),[s]);b.useEffect(()=>{i&&r.get(["dama",l,"views","byId",i,"attributes","metadata"])},[i]);const d=b.useMemo(()=>{let h=C(a,["dama",l,"views","byId",i,"attributes","metadata","value","columns"],[]);return h.length===0&&(h=C(a,["dama",l,"views","byId",i,"attributes","metadata","value"],[])),h},[i,a]),u=b.useMemo(()=>d.extent,[d]);b.useEffect(()=>{const h=async()=>{const f=JSON.stringify({}),g=await r.get(["dama",l,"viewsbyId",i,"options",f,"databyIndex",{},["ST_AsGeojson(ST_Extent(wkb_geometry)) as bextent"]]),x=C(g,["json","dama",l,"viewsbyId",i,"options",f,"databyIndex",0,["ST_AsGeojson(ST_Extent(wkb_geometry)) as bextent"]]);r.call(["dama","views","metadata","update"],[l,i,{extent:x}]).then(y=>console.log("resp from saving view extent:",y))};Object.keys(d).length>0&&!u&&h()},[d,u]);const p=b.useMemo(()=>{if(u){const f=JSON.parse(u).coordinates[0],g=f.reduce((x,y)=>x.extend(y),new cs.LngLatBounds(f[0],f[0]));return[g._sw,g._ne]}else return null},[u]),m=Fe(JSON.stringify(c),JSON.stringify(p));return e.jsx("div",{onClick:()=>{n(h=>{m?he(h,"symbology.zoomToFit",[]):he(h,"symbology.zoomToFit",p)})},className:`${m?"bg-blue-100 hover:bg-blue-200":"hover:bg-pink-50 "} group flex w-full items-center text-slate-600 rounded-md px-2 py-2 text-sm`,children:"Zoom to Fit"})};function IP({button:t,className:s}){const[n,r]=b.useState(!1);return e.jsxs("div",{onClick:()=>r(!0),className:s,children:[e.jsx(TP,{open:n,setOpen:r}),t]})}const oc=t=>{if(t.includes("(")&&t.includes(")")){const s=t.indexOf("("),n=t.indexOf(")"),r=parseInt(t.slice(s+1,n));return isNaN(r)?t+" (1)":t.substring(0,s+1)+(r+1)+t.substring(n)}else return t+" (1)"};function TP({open:t,setOpen:s}){const n=b.useRef(null),{pgEnv:r,falcor:a,falcorCache:l,baseUrl:i}=b.useContext(ce),{state:c,setState:d,symbologies:u}=b.useContext(He),{symbologyId:p}=Ye(),m=$e(),h=b.useMemo(()=>u.find(k=>+k.symbology_id==+p),[u,p]),f={action:null,name:oc(c==null?void 0:c.name)},[g,x]=b.useState(f);b.useEffect(()=>{x({...g,name:oc(c==null?void 0:c.name)})},[c.name]);async function y(){await a.set({paths:[["dama",r,"symbologies","byId",+p,"attributes","symbology"]],jsonGraph:{dama:{[r]:{symbologies:{byId:{[+p]:{attributes:{symbology:JSON.stringify(c.symbology)}}}}}}}})}async function j(){await a.set({paths:[["dama",r,"symbologies","byId",+p,"attributes","name"]],jsonGraph:{dama:{[r]:{symbologies:{byId:{[+p]:{attributes:{name:c.name}}}}}}}})}const N=async()=>{var A,R,O;let k=JSON.stringify({...c,name:g.name});Object.keys(c.symbology.layers).forEach(M=>{const D=Math.random().toString(36).replace(/[^a-z]+/g,"");k=k.replaceAll(M,D)});const $=await a.call(["dama","symbology","symbology","create"],[r,JSON.parse(k)]),I=((A=Object.keys(C($,["json","dama",r,"symbologies","byId"],{})))==null?void 0:A[0])||!1,T=(O=(R=C($,["json","dama",r,"symbologies","byId"],{}))==null?void 0:R[I])==null?void 0:O.attributes;I&&(await a.invalidate(["dama",r,"symbologies","byIndex"],["dama",r,"symbologies","length"]),s(!1),x({action:null,name:""}),d(T),m(`${i}/mapeditor/${I}`))},_=()=>{var $;const k=Cd+`${p}`;g.action==="save"?(($=c==null?void 0:c.symbology)!=null&&$.layers&&h&&!Fe(c==null?void 0:c.symbology,h==null?void 0:h.symbology)&&y(),c!=null&&c.name&&(c==null?void 0:c.name)!==(h==null?void 0:h.name)&&j()):g.action==="discard"?(window.localStorage.setItem(k,JSON.stringify(h)),d(h)):g.action==="saveas"&&(window.localStorage.setItem(k,JSON.stringify(h)),N()),s(!1),x(f)},E=b.useMemo(()=>{var k,$,I;return((k=c==null?void 0:c.symbology)==null?void 0:k.layers)&&h&&!Fe(($=c==null?void 0:c.symbology)==null?void 0:$.layers,(I=h==null?void 0:h.symbology)==null?void 0:I.layers)||(c==null?void 0:c.name)!==(h==null?void 0:h.name)},[c,h]),L=g.action?g.action==="discard"?"danger":"primary":"white",S=g.action?" ":"disabled:opacity-75 pointer-events-none	";return e.jsxs(Er,{open:t,setOpen:s,initialFocus:n,children:[e.jsxs("div",{className:"flex items-center ",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fa-regular fa-floppy-disk text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-2 sm:mt-0 sm:text-left w-full",children:[e.jsx(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:"Manage Changes"}),E?e.jsx("div",{className:"text-sm text-red-400 font-semibold",children:"You have unsaved changes"}):e.jsx("div",{className:"text-sm text-green-700 italic",children:"No pending changes"})]})]}),e.jsxs("div",{className:"flex items-center capitalize",children:[e.jsxs("div",{className:"mt-4 ml-1 w-32 flex  flex-col items-start justify-items-start",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"discard",name:"discard",value:"discard",type:"radio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:g.action==="discard",disabled:!E,onChange:k=>x({...g,action:k.target.value})}),e.jsx("label",{htmlFor:"discard",className:"ml-2 text-sm text-gray-900",children:"Discard"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"save",name:"save",value:"save",type:"radio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:g.action==="save",disabled:!E,onChange:k=>{x({...g,action:k.target.value})}}),e.jsx("label",{htmlFor:"save",className:"ml-2 text-sm text-gray-900",children:"Save"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"saveas",name:"saveas",value:"saveas",type:"radio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:g.action==="saveas",onChange:k=>x({...g,action:k.target.value})}),e.jsx("label",{htmlFor:"saveas",className:"ml-2 text-sm text-gray-900",children:"Save As"})]})]}),g.action==="saveas"&&e.jsx("div",{className:"flex mt-4 ml-4 w-full items-start justify-items-start",children:e.jsx("input",{value:g.name,onChange:k=>x({...g,name:k.target.value}),className:"p-1 w-full bg-slate-100 ",placeholder:"New Map Name"})})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsx("div",{className:"px-1",children:e.jsx(We,{themeOptions:{size:"sm",color:L},className:S,disabled:!g.action,onClick:_,children:MP[g.action]??"Save ..."})}),e.jsx("div",{className:"px-1",children:e.jsx(We,{themeOptions:{size:"sm",color:"transparent"},onClick:()=>{s(!1),x(f)},children:"Cancel"})})]})]})}const MP={save:"Save Changes",saveas:"Save and Open",discard:"Discard Changes"},BP=({layer:t})=>{const{state:s,setState:n}=b.useContext(He),r=()=>{let a=JSON.stringify({...t,name:oc(t.name),order:Object.values(s.symbology.layers).length});const l=Math.random().toString(36).replace(/[^a-z]+/g,"");a=a.replaceAll(t.id,l),n(i=>{he(i,`symbology.layers[${l}]`,JSON.parse(a))})};return e.jsx("div",{onClick:r,className:"hover:bg-pink-50 flex w-full items-center text-slate-600 rounded-md px-2 py-2 text-sm",children:"Duplicate layer"})},AP={fill:fP,circle:gP,line:hP};function Nd({layer:t,button:s,location:n="left-0"}){const{state:r,setState:a}=w.useContext(He);return e.jsxs(Oe,{as:"div",className:"relative inline-block text-left",children:[e.jsx(Oe.Button,{children:s}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsx(Oe.Items,{className:`absolute ${n} mt-1 w-36 origin-top-left divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none`,children:e.jsxs("div",{className:"px-1 py-1 ",children:[e.jsx(Oe.Item,{children:e.jsx(LP,{layer:t})}),e.jsx(Oe.Item,{children:e.jsx(BP,{layer:t})}),e.jsx(Oe.Item,{children:({active:l})=>e.jsx("div",{className:`${l?"bg-pink-50 ":""} group flex w-full items-center text-red-400 rounded-md px-2 py-2 text-sm`,onClick:()=>{a(i=>{delete i.symbology.layers[t.id],Object.values(i.symbology.layers).sort((c,d)=>c.order-d.order).forEach((c,d)=>c.order=d)})},children:"Remove"})})]})})})]})}function OP({index:t,layer:s,i:n}){const{state:r,setState:a}=w.useContext(He),{activeLayer:l}=r.symbology,i=()=>{a(u=>{u.symbology.activeLayer=l===s.id?"":s.id})},c=AP[s.type]||e.jsx("span",{}),d=s.visible;return e.jsxs("div",{className:`w-full ${l==s.id?"bg-pink-100":""} p-2 py-1 flex border-white/85 border hover:border-pink-500 group items-center`,children:[e.jsx("div",{className:"px-1",children:e.jsx(c,{className:"fill-slate-400"})}),e.jsx("div",{onClick:i,className:"text-sm text-slate-600 font-medium truncate flex-1",children:s.name}),e.jsx("div",{className:"text-sm pt-1 px-0.5 flex items-center",children:e.jsx(Nd,{layer:s,button:e.jsx(yd,{className:` ${l==s.id?"fill-pink-100":"fill-white"} cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`})})}),e.jsx("div",{onClick:()=>{a(u=>{u.symbology.layers[s.id].visible=!u.symbology.layers[s.id].visible})},children:d?e.jsx(Tb,{className:` ${l==s.id?"fill-pink-100":"fill-white"} cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`}):e.jsx(Mb,{className:` ${l==s.id?"fill-pink-100":"fill-white"} cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`})})]})}function PP(t){const{state:s,setState:n}=w.useContext(He),r=b.useMemo(()=>{var l;return((l=s.symbology)==null?void 0:l.layers)||{}},[s]),a=w.useCallback((l,i)=>{n(c=>{const d=Object.values(c.symbology.layers);let u=Object.values(c.symbology.layers).length-1,p=u-l,m=u-i;const[h]=d.splice(p,1);d.splice(m,0,h),d.forEach((f,g)=>{f.order=g}),c.symbology.layers=d.reduce((f,g)=>(f[g.id]=g,f),{})})},[]);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-20 relative",children:e.jsx(Wn,{onDrop:a,offset:{x:16,y:45},children:Object.values(r).sort((l,i)=>i.order-l.order).map((l,i)=>e.jsx(OP,{layer:l,i},l.id))})})})}function DP({layer:t}){const{state:s,setState:n}=w.useContext(He),{activeLayer:r}=s.symbology,a=t.isVisible,l=()=>{n(i=>{i.symbology.layers[t.id].isVisible=!i.symbology.layers[t.id].isVisible,i.symbology.layers[t.id].layers.forEach((c,d)=>{let p=C(s,`symbology.layers[${t.id}].layers[${d}].layout.visibility`,"")==="visible"?"none":"visible";i.symbology.layers[t.id].layers[d].layout={visibility:p}})})};return e.jsx(e.Fragment,{children:a?e.jsx(Tb,{onClick:l,className:` ${r==t.id?"fill-pink-100":"fill-white"} pt-[2px] cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`}):e.jsx(Mb,{onClick:l,className:` ${r==t.id?"fill-pink-100":"fill-white"} pt-[2px] cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`})})}const va={fill:({layer:t,color:s})=>e.jsx("div",{className:"pr-2",children:e.jsx("div",{className:"w-4 h-4 rounded ",style:{backgroundColor:s}})}),circle:({layer:t,color:s})=>{let n=C(t,"layers[0].paint['circle-stroke-color']","#ccc");return e.jsx("div",{className:"pl-0.5 pr-2",children:e.jsx("div",{className:"w-3 h-3 rounded-full ",style:{backgroundColor:s,borderColor:n}})})},line:({layer:t,color:s})=>e.jsx("div",{className:"pr-2",children:e.jsx("div",{className:"w-4 h-1",style:{backgroundColor:s}})})},Zn={fill:t=>C(t,"layers[1].paint['fill-color']","#ccc"),circle:t=>C(t,"layers[0].paint['circle-color']","#ccc"),line:t=>C(t,"layers[1].paint['line-color']","#ccc")};function RP({layer:t,toggleSymbology:s,isListVisible:n}){var l,i;w.useContext(He),b.useMemo(()=>({interactiveFilters:C(t,"['interactive-filters']",[])}),[t]);const r=t==null?void 0:t.selectedInteractiveFilterIndex,a=(i=(l=t==null?void 0:t["interactive-filters"])==null?void 0:l[r])==null?void 0:i["layer-type"];return e.jsxs("div",{className:"w-full max-h-[350px] overflow-x-auto scrollbar-sm",children:[a==="categories"&&e.jsx(Ab,{layer:t,toggleSymbology:s}),a==="choropleth"&&e.jsx(Ob,{layer:t,toggleSymbology:s})]})}function Ab({layer:t,toggleSymbology:s}){const n=va[t.type]||va.fill;let r=(t==null?void 0:t["legend-data"])||[];return(!r||r.length===0)&&(r=[]),e.jsx("div",{className:"w-full max-h-[250px] overflow-x-auto",onClick:s,children:r.map((a,l)=>e.jsxs("div",{className:"w-full flex items-center hover:bg-pink-50",children:[e.jsx("div",{className:"flex items-center h-6 w-10 justify-center  ",children:e.jsx(n,{color:a.color})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-500 h-6 text-sm truncate",children:a.label})]},l))})}function Ob({layer:t,toggleSymbology:s}){const{state:n,setState:r}=w.useContext(He);let{legenddata:a,isLoadingColorbreaks:l}=b.useMemo(()=>({legenddata:C(t,"['legend-data']",[]),isLoadingColorbreaks:C(t,"['is-loading-colorbreaks']",!1)}),[n]);const i=va[t.type]||va.fill``;return l?e.jsx("div",{className:"w-full max-h-[250px] overflow-x-auto scrollbar-sm",children:e.jsxs("div",{className:"flex w-full justify-center overflow-hidden pb-2",children:["Creating legend...",e.jsx("span",{style:{fontSize:"1.5rem"},className:"ml-2 fa-solid fa-spinner fa-spin"})]})}):e.jsx("div",{className:"w-full max-h-[250px] overflow-x-auto scrollbar-sm",onClick:s,children:a.map((c,d)=>e.jsxs("div",{className:"w-full flex items-center hover:bg-pink-50",children:[e.jsx("div",{className:"flex items-center h-6 w-10 justify-center  ",children:e.jsx(i,{color:c.color})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-500 h-6 text-sm truncate",children:c.label})]},d))})}function FP({layer:t,i:s,numLayers:n,onRowMove:r}){var j;const{state:a,setState:l}=w.useContext(He),{activeLayer:i}=a.symbology,[c,d]=w.useState(!0);let{layerType:u,selectedInteractiveFilterIndex:p,interactiveFilters:m}=b.useMemo(()=>({layerType:C(t,"['layer-type']"),selectedInteractiveFilterIndex:C(t,"['selectedInteractiveFilterIndex']"),interactiveFilters:C(t,"['interactive-filters']",[])}),[a,t]);const h=()=>{l(N=>{N.symbology.activeLayer=i===t.id?"":t.id})},f=u==="simple"||u==="interactive"&&((j=m==null?void 0:m[p])==null?void 0:j["layer-type"])==="simple"||!u,g=va[t.type]||va.fill;let x=Zn!=null&&Zn[t==null?void 0:t.type]?Zn==null?void 0:Zn[t==null?void 0:t.type](t):"#fff",y;return u==="interactive"?y=e.jsxs("div",{className:"text-sm mr-1 flex items-center",children:[f&&e.jsx("div",{onClick:h,className:"pl-1",children:e.jsx(g,{layer:t,color:x})}),e.jsx("div",{className:"text-slate-600 font-medium truncate flex-1",children:e.jsx("div",{className:"rounded-md h-[36px] pl-0 flex w-full w-[216px] items-center border border-transparent cursor-pointer hover:border-slate-300",children:e.jsx("select",{className:"w-full bg-transparent",value:p,onChange:N=>{l(_=>{_.symbology.layers[t.id].selectedInteractiveFilterIndex=parseInt(N.target.value)})},children:m.map((N,_)=>e.jsx("option",{value:_,children:N.label},_))})})})]}):y=e.jsxs("div",{onClick:h,className:"text-sm text-slate-600 font-medium truncate flex flex-1",children:[f&&e.jsx("div",{onClick:h,className:"px-1",children:e.jsx(g,{layer:t,color:x})}),t.name]}),e.jsxs("div",{className:`${i==t.id?"bg-pink-100":""} hover:border-pink-500 group border`,children:[e.jsxs("div",{className:`w-full px-2 pt-1 pb-0 flex border-blue-50/50 border justify-between items-center ${u==="interactive"&&!f?"pl-[3px]":""}`,children:[y,e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"text-sm pt-1  flex items-center",children:e.jsx(Nd,{layer:t,button:e.jsx(yd,{className:` ${i==t.id?"fill-pink-100":"fill-white"} pb-[2px] cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`})})}),e.jsx(bP,{onClick:()=>{r(s,s-1)},size:24,className:`${s===0?"pointer-events-none":""} mr-[-6px] ${i==t.id?"fill-pink-100":"fill-white"}  pt-[2px] cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`}),e.jsx(xP,{onClick:()=>{r(s,s+1)},size:24,className:`${s===n-1?"pointer-events-none":""} mr-[-3px] ${i==t.id?"fill-pink-100":"fill-white"} pb-[2px] cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700`}),e.jsx(DP,{layer:t})]})]}),u==="categories"&&e.jsx(Ab,{layer:t,toggleSymbology:h}),u==="choropleth"&&e.jsx(Ob,{layer:t,toggleSymbology:h}),u==="interactive"&&e.jsx(RP,{layer:t,toggleSymbology:h,isListVisible:c})]})}function VP(t){const{state:s,setState:n}=w.useContext(He),r=b.useMemo(()=>{var i;return((i=s.symbology)==null?void 0:i.layers)||{}},[s]),a=w.useCallback((i,c)=>{n(d=>{const u=Object.values(d.symbology.layers);u.sort((m,h)=>h.order-m.order);const[p]=u.splice(i,1);u.splice(c,0,p),u.reverse().forEach((m,h)=>{m.order=h}),d.symbology.layers=u.reverse().reduce((m,h)=>(m[h.id]=h,m),{})})},[]),l=b.useMemo(()=>Object.values(r).length,[r]);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-20 relative max-h-[calc(100vh_-_220px)] scrollbar-sm ",children:Object.values(r).sort((i,c)=>c.order-i.order).map((i,c)=>e.jsx(FP,{layer:i,i:c,numLayers:l,onRowMove:a},i.id))})})}function HP(){const{state:t}=w.useContext(He),s=["Legend","Layers"];return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-white/95 w-[340px] rounded-lg drop-shadow-lg pointer-events-auto min-h-[400px] max-h-[calc(100vh_-_111px)] scroll-xs",children:[e.jsx(OD,{}),(t==null?void 0:t.symbology_id)&&e.jsxs(mt.Group,{children:[e.jsxs("div",{className:"flex justify-between items-center border-b",children:[e.jsx(mt.List,{children:s.map(n=>e.jsx(mt,{as:b.Fragment,children:({selected:r})=>e.jsx("button",{className:`
                        ${r?"text-slate-600 border-b font-medium border-slate-600":"text-slate-400"} mx-1 text-sm p-2 cursor-pointer
                      `,children:n})},n))}),e.jsx(kP,{})]}),e.jsxs(mt.Panels,{children:[e.jsx(mt.Panel,{children:e.jsx(VP,{})}),e.jsx(mt.Panel,{children:e.jsx(PP,{})})]})]})]})})}const Pb={fill:[{label:"Type",type:"inline",controls:[{type:"selectType",params:{options:[{name:"Simple",value:"simple"},{name:"Categories",value:"categories"},{name:"Color Range",value:"choropleth"},{name:"Interactive",value:"interactive"}]},path:"['layer-type']",datapath:"layers[1].paint['fill-color']"}]},{label:"Color By",type:"inline",conditional:{path:"['layer-type']",conditions:["categories","choropleth"]},controls:[{type:"selectViewColumn",params:{options:[{name:"Column Select",value:"simple"}]},path:"['data-column']"}]},{label:"Categories",type:"popover",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoryControl",params:{options:[{name:"Column Select",value:"simple"}],format:t=>`${((t==null?void 0:t.length)-3||0)/2||"10"} Categories`},path:"layers[1].paint['fill-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoricalColor",path:"['color-set']"}]},{label:"Scale",type:"popover",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"choroplethControl",params:{format:t=>{var s;return`${(((s=t==null?void 0:t[3])==null?void 0:s.length)-3||0)/2||"10"} Categories`}},path:"layers[1].paint['fill-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"rangeColor",path:"['color-range']"}]},{label:"Fill",type:"popover",conditional:{path:"['layer-type']",conditions:["simple"]},controls:[{type:"color",path:"layers[1].paint['fill-color']"}]},{label:"Stroke",type:"popover",conditional:{path:"['layer-type']",conditions:["categories","choropleth","simple"]},controls:[{type:"color",path:"layers[0].paint['line-color']"},{type:"range",unit:"px",path:"layers[0].paint['line-width']",params:{min:"0",max:"10",step:"0.5",default:"3",units:"px"}}]},{label:"Interactive Filters",type:"full-width",conditional:{path:"['layer-type']",conditions:["interactive"]},controls:[{type:"interactiveFilterControl",path:"['interactive-filters']"}]},{label:"Opacity",type:"inline",conditional:{path:"['layer-type']",conditions:["categories","choropleth","simple"]},controls:[{type:"range",unit:"%",path:"layers[1].paint['fill-opacity']",params:{min:"0",max:"1",step:"0.01",default:"0.75",units:"%",format:t=>Math.round(t*100)}}]}],circle:[{label:"Type",type:"inline",controls:[{type:"selectType",params:{options:[{name:"Simple",value:"simple"},{name:"Categories",value:"categories"},{name:"Color Range",value:"choropleth"}]},path:"['layer-type']",datapath:"layers[0].paint['circle-color']"}]},{label:"Color By",type:"inline",conditional:{path:"['layer-type']",conditions:["categories","choropleth"]},controls:[{type:"selectViewColumn",params:{options:[{name:"Column Select",value:"simple"}]},path:"['data-column']",datapath:"['category-data']"}]},{label:"Categories",type:"popover",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoryControl",params:{options:[{name:"Column Select",value:"simple"}],format:t=>`${((t==null?void 0:t.length)-3||0)/2||"10"} Categories`},path:"layers[0].paint['circle-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoricalColor",path:"['color-set']"}]},{label:"Scale",type:"popover",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"choroplethControl",params:{format:t=>{var s;return`${(((s=t==null?void 0:t[3])==null?void 0:s.length)-3||0)/2||"10"} Categories`}},path:"layers[1].paint['circle-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"rangeColor",path:"['color-range']"}]},{label:"Fill",type:"popover",conditional:{path:"['layer-type']",conditions:["simple"]},controls:[{type:"color",path:"layers[0].paint['circle-color']"}]},{label:"Size",type:"inline",controls:[{type:"range",unit:"%",path:"layers[0].paint['circle-radius']",params:{min:"0",max:"20",step:"0.5",default:"3",units:"px"}}]},{label:"Stroke",type:"popover",conditional:{path:"['layer-type']",conditions:["categories","choropleth","simple"]},controls:[{type:"color",path:"layers[0].paint['circle-stroke-color']"},{type:"range",unit:"px",path:"layers[0].paint['circle-stroke-width']",params:{min:"0",max:"20",step:"0.5",default:"3",units:"px"}}]},{label:"Interactive Filters",type:"full-width",conditional:{path:"['layer-type']",conditions:["interactive"]},controls:[{type:"interactiveFilterControl",path:"['interactive-filters']"}]},{label:"Opacity",type:"inline",conditional:{path:"['layer-type']",conditions:["categories","choropleth","simple"]},controls:[{type:"range",unit:"%",path:"layers[0].paint['circle-opacity']",params:{min:"0",max:"1",step:"0.01",default:"0.75",units:"%",format:t=>Math.round(t*100)}}]}],line:[{label:"Type",type:"inline",controls:[{type:"selectType",params:{options:[{name:"Simple",value:"simple"},{name:"Categories",value:"categories"},{name:"Color Range",value:"choropleth"}]},path:"['layer-type']",datapath:"layers[1].paint['line-color']"}]},{label:"Color By",type:"inline",conditional:{path:"['layer-type']",conditions:["categories","choropleth"]},controls:[{type:"selectViewColumn",params:{options:[{name:"Column Select",value:"simple"}]},path:"['data-column']",datapath:"['category-data']"}]},{label:"Categories",type:"popover",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoryControl",params:{options:[{name:"Column Select",value:"simple"}],format:t=>`${((t==null?void 0:t.length)-3||0)/2||"10"} Categories`},path:"layers[1].paint['line-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["categories"]},controls:[{type:"categoricalColor",path:"['color-set']"}]},{label:"Scale",type:"popover",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"choroplethControl",params:{format:t=>{var s;return`${(((s=t==null?void 0:t[3])==null?void 0:s.length)-3||0)/2||"10"} Categories`}},path:"layers[1].paint['line-color']"}]},{label:"Fill",type:"inline",conditional:{path:"['layer-type']",conditions:["choropleth"]},controls:[{type:"rangeColor",path:"['color-range']"}]},{label:"Fill",type:"popover",conditional:{path:"['layer-type']",conditions:["simple"]},controls:[{type:"color",path:"layers[1].paint['line-color']"}]},{label:"Size",type:"inline",controls:[{type:"range",unit:"%",path:"layers[1].paint['line-width']",params:{min:"0",max:"20",step:"0.5",default:"3",units:"px"}}]},{label:"Offset",type:"inline",controls:[{type:"range",unit:"%",path:"layers[1].paint['line-offset']",params:{min:"-10",max:"10",step:"0.5",default:"0",units:"px"}}]},{label:"Casing",type:"popover",controls:[{type:"color",path:"layers[0].paint['line-color']"},{type:"range",unit:"px",path:"layers[0].paint['line-width']",params:{min:"0",max:"20",step:"0.5",default:"3",units:"px"}},{type:"range",unit:"px",path:"layers[0].paint['line-offset']",params:{min:"-10",max:"10",step:"0.5",default:"0",units:"px"}}]},{label:"Opacity",type:"inline",conditional:{path:"['layer-type']",conditions:["categories","choropleth","simple"]},controls:[{type:"range",unit:"%",path:"layers[1].paint['line-opacity']",params:{min:"0",max:"1",step:"0.01",default:"0.75",units:"%",format:t=>Math.round(t*100)}}]},{label:"Interactive Filters",type:"full-width",conditional:{path:"['layer-type']",conditions:["interactive"]},controls:[{type:"interactiveFilterControl",path:"['interactive-filters']"}]}]};function zP(t,s,n,r=10,a){var u,p;let l=JSON.parse(((p=((u=a.filter(m=>m.name===t))==null?void 0:u[0])||{})==null?void 0:p.meta_lookup)||"{}"),c=["match",["to-string",["get",(t||"").includes("AS ")?t.split("AS ")[1]:t]]];Array.from(Array(+r).keys()).forEach((m,h)=>{var g,x;let f=""+((g=s==null?void 0:s[h])==null?void 0:g[t]);f&&f!="[object Object]"&&(c.push(""+((x=s==null?void 0:s[h])==null?void 0:x[t])),c.push(Rn(n[h%n.length])))});const d=(c||[]).filter((m,h)=>h>2).map((m,h)=>h%2===0?{color:m,label:C(l,c[h+2],c[h+2])}:null).filter(m=>m);return{paint:c,legend:d}}function Wm(t){let s=typeof t=="object"&&Array.isArray(t);return s&&(t.forEach(n=>{(!n||n==="undefined")&&(s=!1)}),s)}function UP(t,s,n,r=10,a="ckmeans",l,i){let c=["step",["to-number",["get",t]]],d=l;if(!Array.isArray(d)||d.length===0)return!1;d.forEach((p,m)=>{c.push(n[m]),c.push(Math.floor(+p))}),c.push(n[r-1]);const u=[...(c||[]).filter((p,m)=>m>2).map((p,m)=>m%2===1?{color:c[m+1],label:`${Gm(c[m+2])} - ${Gm(c[m+4]||s)}`}:null).filter(p=>p)];return{paint:["case",["==",["get",t],null],i,c],legend:u}}const Gm=(t,s=2,n=!1)=>t>=1e12?`${n?"$":""} ${(t/1e12).toFixed(s)} T`:t>=1e9?`${n?"$":""} ${(t/1e9).toFixed(s)} B`:t>=1e6?`${n?"$":""} ${(t/1e6).toFixed(s)} M`:t>=1e3?`${n?"$":""} ${(t/1e3).toFixed(s)} K`:typeof t=="object"?"":`${n?"$":""} ${parseInt(t)}`,os={seq1:{2:["#f7e76e","#ce141f"],3:["#f7e76e","#ec962a","#ce141f"],4:["#f7e76e","#f1b33d","#e5751d","#ce141f"],5:["#f7e76e","#f3c048","#ec962a","#e1631a","#ce141f"],6:["#f7e76e","#f4c94f","#efa835","#e88321","#de581a","#ce141f"],7:["#f7e76e","#f4ce54","#f1b33d","#ec962a","#e5751d","#dc501a","#ce141f"],8:["#f7e76e","#f5d157","#f2bb43","#eea331","#e98823","#e36b1b","#da491b","#ce141f"],9:["#f7e76e","#f5d45a","#f3c048","#f0ac38","#ec962a","#e77e1f","#e1631a","#d9451b","#ce141f"]},seq2:{2:["#fde89b","#4d53b3"],3:["#fde89b","#f37b8a","#4d53b3"],4:["#fde89b","#ff9e81","#d4629b","#4d53b3"],5:["#fde89b","#ffb080","#f37b8a","#bd5aa4","#4d53b3"],6:["#fde89b","#ffbc82","#fe8f83","#e36a94","#ad57a9","#4d53b3"],7:["#fde89b","#ffc385","#ff9e81","#f37b8a","#d4629b","#a056ac","#4d53b3"],8:["#fde89b","#ffc887","#ffa880","#fb8985","#e86f91","#c85da0","#9755ad","#4d53b3"],9:["#fde89b","#ffcc88","#ffb080","#ff9582","#f37b8a","#de6797","#bd5aa4","#9055af","#4d53b3"]},seq3:{2:["#f2e68c","#035d6d"],3:["#f2e68c","#59a884","#035d6d"],4:["#f2e68c","#87bf84","#319082","#035d6d"],5:["#f2e68c","#a0ca84","#59a884","#1f837f","#035d6d"],6:["#f2e68c","#afd084","#74b684","#409984","#147b7d","#035d6d"],7:["#f2e68c","#bad485","#87bf84","#59a884","#319082","#0e767b","#035d6d"],8:["#f2e68c","#c2d785","#95c584","#6cb284","#479e84","#268881","#097379","#035d6d"],9:["#f2e68c","#c8d986","#a0ca84","#7bb984","#59a884","#3a9683","#1f837f","#077078","#035d6d"]},seq4:{2:["#e8e873","#4b5899"],3:["#e8e873","#2cbaa8","#4b5899"],4:["#e8e873","#62d198","#209eb0","#4b5899"],5:["#e8e873","#84d98c","#2cbaa8","#2d8eaf","#4b5899"],6:["#e8e873","#98dd85","#4ac9a0","#1caaae","#3483ad","#4b5899"],7:["#e8e873","#a5e081","#62d198","#2cbaa8","#209eb0","#397cab","#4b5899"],8:["#e8e873","#afe17e","#75d691","#41c5a2","#1eafad","#2795af","#3d77a9","#4b5899"],9:["#e8e873","#b6e27c","#84d98c","#53cc9d","#2cbaa8","#1ca5af","#2d8eaf","#3f74a8","#4b5899"]},seq5:{2:["#f3cdb4","#c33c3c"],3:["#f3cdb4","#dd8a6c","#c33c3c"],4:["#f3cdb4","#e5a182","#d57259","#c33c3c"],5:["#f3cdb4","#e8ac8d","#dd8a6c","#d16651","#c33c3c"],6:["#f3cdb4","#eab395","#e29879","#d87c61","#ce5e4c","#c33c3c"],7:["#f3cdb4","#ecb79a","#e5a182","#dd8a6c","#d57259","#cc5949","#c33c3c"],8:["#f3cdb4","#edba9d","#e7a788","#e09475","#da8064","#d36b54","#cb5547","#c33c3c"],9:["#f3cdb4","#eebda0","#e8ac8d","#e39b7c","#dd8a6c","#d7785e","#d16651","#ca5246","#c33c3c"]},seq6:{2:["#f6e389","#cd4c71"],3:["#f6e389","#f49566","#cd4c71"],4:["#f6e389","#f7af6b","#ec7b66","#cd4c71"],5:["#f6e389","#f8bc70","#f49566","#e66e68","#cd4c71"],6:["#f6e389","#f8c474","#f6a568","#ef8566","#e26769","#cd4c71"],7:["#f6e389","#f8c976","#f7af6b","#f49566","#ec7b66","#df626b","#cd4c71"],8:["#f6e389","#f8cd79","#f8b76d","#f6a067","#f18a66","#e87467","#dd5f6b","#cd4c71"],9:["#f6e389","#f8d07a","#f8bc70","#f7a869","#f49566","#ee8166","#e66e68","#db5c6c","#cd4c71"]},seq7:{2:["#f2e9a6","#344e31"],3:["#f2e9a6","#8a9968","#344e31"],4:["#f2e9a6","#abb47c","#6b8055","#344e31"],5:["#f2e9a6","#bcc186","#8a9968","#5d734c","#344e31"],6:["#f2e9a6","#c6c98c","#9da974","#778a5c","#546b46","#344e31"],7:["#f2e9a6","#cdce90","#abb47c","#8a9968","#6b8055","#4e6643","#344e31"],8:["#f2e9a6","#d3d293","#b4bb81","#98a570","#7c8e60","#637850","#4b6340","#344e31"],9:["#f2e9a6","#d6d596","#bcc186","#a2ad77","#8a9968","#73865a","#5d734c","#48603e","#344e31"]},seq8:{2:["#d2e2a6","#096b6d"],3:["#d2e2a6","#6ba888","#096b6d"],4:["#d2e2a6","#8cbc91","#4d9480","#096b6d"],5:["#d2e2a6","#9dc596","#6ba888","#3e897b","#096b6d"],6:["#d2e2a6","#a7cb98","#7fb48d","#599c83","#358379","#096b6d"],7:["#d2e2a6","#aecf9b","#8cbc91","#6ba888","#4d9480","#2f7f77","#096b6d"],8:["#d2e2a6","#b3d29c","#95c193","#79b08c","#5e9f85","#448e7d","#2a7c76","#096b6d"],9:["#d2e2a6","#b7d49d","#9dc596","#84b78f","#6ba888","#549982","#3e897b","#277a75","#096b6d"]},seq9:{2:["#ebdbad","#27859c"],3:["#ebdbad","#7eb699","#27859c"],4:["#ebdbad","#a2c39a","#5ba79b","#27859c"],5:["#ebdbad","#b4ca9c","#7eb699","#4b9f9c","#27859c"],6:["#ebdbad","#c0cd9e","#93be99","#68ad9a","#429a9c","#27859c"],7:["#ebdbad","#c7d0a0","#a2c39a","#7eb699","#5ba79b","#3c979d","#27859c"],8:["#ebdbad","#ccd1a1","#adc79b","#8dbc99","#6eb099","#51a29b","#38949d","#27859c"],9:["#ebdbad","#d0d2a3","#b4ca9c","#99c099","#7eb699","#63ab9a","#4b9f9c","#35929d","#27859c"]},seq10:{2:["#d0f0da","#274c72"],3:["#d0f0da","#609fa8","#274c72"],4:["#d0f0da","#82bab7","#438398","#274c72"],5:["#d0f0da","#95c8bf","#609fa8","#387590","#274c72"],6:["#d0f0da","#a0d0c4","#74afb1","#4e8e9f","#336d8b","#274c72"],7:["#d0f0da","#a8d5c7","#82bab7","#609fa8","#438398","#306887","#274c72"],8:["#d0f0da","#aed9ca","#8dc2bb","#6eabae","#5393a1","#3d7b94","#2e6484","#274c72"],9:["#d0f0da","#b2dccc","#95c8bf","#79b3b3","#609fa8","#4a8a9c","#387590","#2c6182","#274c72"]},seq11:{2:["#ffcdc6","#513a8d"],3:["#f3c0b9","#bd6f95","#513a8d"],4:["#f3c0b9","#d3899c","#a15991","#513a8d"],5:["#f3c0b9","#dc96a1","#bd6f95","#915090","#513a8d"],6:["#f3c0b9","#e19ea5","#cb7e99","#ad6293","#864a90","#513a8d"],7:["#f3c0b9","#e5a4a8","#d3899c","#bd6f95","#a15991","#7f478f","#513a8d"],8:["#f3c0b9","#e7a8aa","#d8909f","#c77a98","#b26593","#985491","#79458f","#513a8d"],9:["#f3c0b9","#e8abac","#dc96a1","#ce829a","#bd6f95","#a95e92","#915090","#75438f","#513a8d"]},seq12:{2:["#e9c5ed","#663b91"],3:["#e9c5ed","#aa7dbd","#663b91"],4:["#e9c5ed","#bf94cc","#9466ae","#663b91"],5:["#e9c5ed","#caa0d4","#aa7dbd","#895ba7","#663b91"],6:["#e9c5ed","#d0a7d9","#b78bc6","#9d6fb4","#8255a2","#663b91"],7:["#e9c5ed","#d4acdc","#bf94cc","#aa7dbd","#9466ae","#7d509f","#663b91"],8:["#e9c5ed","#d7b0df","#c59bd1","#b387c4","#a173b6","#8e60aa","#7a4d9d","#663b91"],9:["#e9c5ed","#dab2e1","#caa0d4","#ba8ec9","#aa7dbd","#996cb2","#895ba7","#784b9c","#663b91"]},div1:{2:["#2b8bab","#dc565f"],3:["#2b8bab","#eff4c8","#dc565f"],4:["#2b8bab","#a4d5b5","#e8c68b","#dc565f"],5:["#2b8bab","#7fc4b2","#eff4c8","#e7ac74","#dc565f"],6:["#2b8bab","#69bab1","#c2e2ba","#e9d9a2","#e79c6a","#dc565f"],7:["#2b8bab","#5cb2b1","#a4d5b5","#eff4c8","#e8c68b","#e69165","#dc565f"],8:["#2b8bab","#52adb0","#8fccb3","#cfe7bd","#eae1ac","#e7b87d","#e58962","#dc565f"],9:["#2b8bab","#4ca9b0","#7fc4b2","#b7ddb8","#eff4c8","#e9d299","#e7ac74","#e58360","#dc565f"]},div2:{2:["#448480","#c54b3e"],3:["#448480","#f9dd35","#c54b3e"],4:["#448480","#a0b169","#e9932f","#c54b3e"],5:["#448480","#a0b169","#f9dd35","#e9932f","#c54b3e"],6:["#448480","#82a373","#bec05c","#f0ac30","#e07b31","#c54b3e"],7:["#448480","#82a373","#bec05c","#f9dd35","#f0ac30","#e07b31","#c54b3e"],8:["#448480","#729b77","#a0b169","#cdc755","#f2b830","#e9932f","#db6e32","#c54b3e"],9:["#448480","#729b77","#a0b169","#cdc755","#f9dd35","#f2b830","#e9932f","#db6e32","#c54b3e"]},div3:{3:["#3166aa","#efefef","#c73d4b"],4:["#3166aa","#b6bfd9","#eab7b5","#c73d4b"],5:["#3166aa","#98a8cd","#efefef","#e49a99","#c73d4b"],6:["#3166aa","#869ac6","#cdd2e2","#edcdcc","#e08989","#c73d4b"],7:["#3166aa","#7a91c1","#b6bfd9","#efefef","#eab7b5","#dc7d7e","#c73d4b"],8:["#3166aa","#718bbe","#a5b2d2","#d7dbe6","#eed7d6","#e7a6a5","#da7576","#c73d4b"],9:["#3166aa","#6a86bc","#98a8cd","#c4cbde","#efefef","#ecc5c4","#e49a99","#d86e71","#c73d4b"]},div4:{2:["#518646","#d74528"],3:["#518646","#f8dea0","#d74528"],4:["#518646","#a6b26e","#e8995b","#d74528"],5:["#518646","#a6b26e","#f8dea0","#e8995b","#d74528"],6:["#518646","#8ba35d","#c1c07e","#eeb072","#e38042","#d74528"],7:["#518646","#8ba35d","#c1c07e","#f8dea0","#eeb072","#e38042","#d74528"],8:["#518646","#7d9c56","#a6b26e","#cfc887","#f0bc7e","#e8995b","#e07339","#d74528"],9:["#518646","#7d9c56","#a6b26e","#cfc887","#f8dea0","#f0bc7e","#e8995b","#e07339","#d74528"]},div5:{2:["#59a1a6","#a67b30"],3:["#59a1a6","#f5f5a3","#a67b30"],4:["#59a1a6","#a8cba4","#cdb769","#a67b30"],5:["#59a1a6","#a8cba4","#f5f5a3","#cdb769","#a67b30"],6:["#59a1a6","#8ebda5","#c2d9a4","#dacb7c","#c0a356","#a67b30"],7:["#59a1a6","#8ebda5","#c2d9a4","#f5f5a3","#dacb7c","#c0a356","#a67b30"],8:["#59a1a6","#81b6a5","#a8cba4","#cee0a4","#e1d685","#cdb769","#b9994c","#a67b30"],9:["#59a1a6","#81b6a5","#a8cba4","#cee0a4","#f5f5a3","#e1d685","#cdb769","#b9994c","#a67b30"]},div6:{2:["#8b4583","#4a6147"],3:["#8b4583","#f9f2bf","#4a6147"],4:["#8b4583","#c29ba1","#9ea781","#4a6147"],5:["#8b4583","#c29ba1","#f9f2bf","#9ea781","#4a6147"],6:["#8b4583","#b07e97","#d4b8ab","#bcbf95","#818f6d","#4a6147"],7:["#8b4583","#b07e97","#d4b8ab","#f9f2bf","#bcbf95","#818f6d","#4a6147"],8:["#8b4583","#a77092","#c29ba1","#ddc6b0","#cbcc9f","#9ea781","#738363","#4a6147"],9:["#8b4583","#a77092","#c29ba1","#ddc6b0","#f9f2bf","#cbcc9f","#9ea781","#738363","#4a6147"]},schemeGroups:{sequential:["seq1","seq2","seq3","seq4","seq5","seq6","seq7","seq8","seq9","seq10","seq11","seq12"],singlehue:[],diverging:["div1","div2","div3","div4","div5","div6"]}},WP=(t,s)=>t.filter(n=>!s.includes(n));function GP({path:t,params:s={}}){var $,I;const{state:n,setState:r}=w.useContext(He),{falcor:a,falcorCache:l,pgEnv:i}=w.useContext(ce),c=(s==null?void 0:s.version)==="interactive"?`symbology.layers[${n.symbology.activeLayer}]${s.pathPrefix}`:`symbology.layers[${n.symbology.activeLayer}]`;let{value:d,column:u,categorydata:p,colors:m,sourceId:h,categories:f,showOther:g,legenddata:x}=b.useMemo(()=>({sourceId:C(n,`symbology.layers[${n.symbology.activeLayer}].source_id`),value:C(n,`${c}.${t}`,{}),column:C(n,`${c}['data-column']`,""),categorydata:C(n,`${c}['category-data']`,{}),colors:C(n,`${c}['color-set']`,wd.cat1),categories:C(n,`${c}['categories']`,{}),showOther:C(n,`${c}['category-show-other']`,"#ccc"),legenddata:C(n,`${c}['legend-data']`,[])}),[n]);const[y,j]=w.useState();b.useEffect(()=>{h&&a.get(["dama",i,"sources","byId",h,"attributes","metadata"])},[h]);const N=b.useMemo(()=>{var A,R;let T=C(l,["dama",i,"sources","byId",h,"attributes","metadata","value","columns"],[]);return T.length===0&&(T=C(l,["dama",i,"sources","byId",h,"attributes","metadata","value"],[])),JSON.parse(((R=((A=T.filter(O=>O.name===u))==null?void 0:A[0])||{})==null?void 0:R.meta_lookup)||"{}")},[h,l]),_=b.useMemo(()=>Object.values(p).reduce((T,A)=>(typeof A[u]!="object"&&T++,T),0),[p]),E=(($=f==null?void 0:f.legend)==null?void 0:$.filter(T=>T.label!=="Other"))??[],L=WP(Object.values(p).filter(T=>typeof T[u]!="object").map(T=>T[u]),E.map(T=>T.label)).map(T=>({label:T,value:T})),S=g==="#ccc",k=[10,20,30,50,100];return e.jsxs("div",{className:" w-full items-center",children:[y!==void 0&&e.jsx(e.Fragment,{children:e.jsxs("label",{className:"flex",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"color",value:Rn(C(n,`${c}['categories'].legend[${y}].color`,m[y%m.length])),onChange:T=>{const A=[...d],R=A.indexOf(E[y].label);A.splice(R+1,1,T.target.value),r(O=>{const M=E.map((D,P)=>P===y?{color:T.target.value,label:C(N,D.label,D.label)}:{color:D.color,label:C(N,D.label,D.label)});he(O,`${c}['legend-data']`,M),he(O,`${c}['categories']`,{paint:A,legend:M})})}})}),e.jsxs("div",{className:"flex items-center p-2",children:["Custom color for ",(I=E[y])==null?void 0:I.label," "]})]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Showing"}),e.jsx("div",{className:"border border-transparent hover:border-slate-200 m-1 rounded ",children:e.jsxs("select",{className:"w-full p-2 bg-transparent text-slate-700 text-sm",value:E.length,onChange:T=>{T.target.value<=y&&j(void 0),r(A=>{he(A,`${c}['categories']`,{}),he(A,`${c}.['num-categories']`,T.target.value)})},children:[e.jsxs("option",{value:E.length,children:[E.length," Categories"]},"def"),k.filter((T,A)=>T!==E.length&&(T<_||k[A-1]<_)).map((T,A)=>e.jsxs("option",{value:T,children:[T," Categories"]},A))]})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Show Other"}),e.jsx("div",{className:"flex items-center",children:e.jsxs(Tt,{checked:S,onChange:()=>{r(T=>{const A=S?"rgba(0,0,0,0)":"#ccc";he(T,`${c}['category-show-other']`,A)})},className:`${S?"bg-blue-500":"bg-gray-200"} relative inline-flex h-4 w-8 items-center rounded-full `,children:[e.jsx("span",{className:"sr-only",children:"Show other"}),e.jsx("div",{className:`${S?"translate-x-5":"translate-x-0"} inline-block h-4 w-4  transform rounded-full bg-white transition border-[0.5] border-slate-600`})]})})]}),e.jsxs("div",{className:"w-full max-h-[250px] overflow-auto",children:[e.jsx(Wn,{onDrop:(T,A)=>{r(R=>{const O=[...E],[M]=O.splice(T,1);O.splice(A,0,M),he(R,`${c}['categories']['legend']`,O);const D=[...x],[P]=D.splice(T,1);D.splice(A,0,P),he(R,`${c}['legend-data']`,D)})},children:E.map((T,A)=>e.jsxs("div",{className:"group/title w-full flex items-center hover:bg-slate-100",children:[e.jsx("div",{className:"flex items-center h-8 w-8 justify-center  border-r border-b ",onClick:()=>{j(y!==A?A:void 0)},children:e.jsx("div",{className:"w-4 h-4 rounded border-[0.5px] border-slate-600",style:{backgroundColor:T.color}})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-600 border-b h-8 truncate",children:T.label}),e.jsx("div",{className:"group/icon border-b w-8 h-8 flex items-center border-slate-200 cursor-pointer fill-white group-hover/title:fill-slate-300 hover:bg-slate-200",onClick:()=>{const R=[...d],O=E.filter(D=>D.label!==T.label),M=R.indexOf(T.label);R.splice(M,2),r(D=>{he(D,`${c}['legend-data']`,O),he(D,`${c}.['num-categories']`,O.length),he(D,`${c}['categories']`,{paint:R,legend:O.map(P=>({color:P.color,label:C(N,P.label,P.label)}))})})},children:e.jsx(Ea,{className:"mx-[6px] cursor-pointer group-hover/icon:fill-slate-500 "})})]},A))}),S&&e.jsxs("div",{className:"w-full flex items-center hover:bg-slate-100",children:[e.jsx("div",{className:"flex items-center h-8 w-8 justify-center  border-r border-b ",children:e.jsx("div",{className:"w-4 h-4 rounded border-[0.5px] border-slate-600",style:{backgroundColor:g}})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-600 border-b h-8 truncate",children:"Other"})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center mx-4",children:"Add Column"}),e.jsx("div",{className:"flex-1 flex items-center mx-4 pb-4",children:e.jsx(Vs,{children:e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsxs("select",{className:"w-full py-2 bg-transparent",value:"",onChange:T=>{const A=[...d],R=[...E],O=A[A.length-2],M=m.map(P=>Jo(P)).indexOf(O),D=M<m.length-1?m[M+1]:m[0];R.push({color:D,label:T.target.value}),A.splice(d.length-1,0,T.target.value,Jo(D)),r(P=>{he(P,`${c}['categories']`,{paint:A,legend:R.map(F=>({color:F.color,label:C(N,F.label,F.label)}))}),he(P,`${c}.['num-categories']`,R.length),he(P,`${c}['legend-data']`,R)})},children:[e.jsx("option",{value:""},-1),(L||[]).map((T,A)=>e.jsx("option",{value:T.value,children:T.label},A))]})})})})})]})]})]})}function JP({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(He),{value:a,selectedInteractiveFilterIndex:l,layerName:i,activeLayer:c}=b.useMemo(()=>{var u;return{value:C(n,`symbology.layers[${n.symbology.activeLayer}].${t}`,[]),selectedInteractiveFilterIndex:C(n,`symbology.layers[${n.symbology.activeLayer}]['selectedInteractiveFilterIndex']`),layerName:C(n,`symbology.layers[${n.symbology.activeLayer}]['name']`,""),activeLayer:C(n,`symbology.layers[${(u=n==null?void 0:n.symbology)==null?void 0:u.activeLayer}]`,{})}},[n]);b.useEffect(()=>{l!==void 0&&!a[l]&&r(u=>{he(u,`symbology.layers[${n.symbology.activeLayer}]['selectedInteractiveFilterIndex']`,void 0)})},[a]);const d=l!=null;return e.jsxs("div",{className:" w-full items-center mt-2",children:[e.jsxs("div",{className:"w-full text-slate-500 text-[14px] flex justify-between ",children:["Interactive Filters",e.jsx(We,{themeOptions:{size:"xs",color:"primary"},className:"col-span-2 capitalize mb-2",onClick:()=>{r(u=>{const p={...c,"layer-type":"simple",label:`${i}`,selectedInteractiveFilterIndex:void 0},m=[...a,p];he(u,`symbology.layers[${n.symbology.activeLayer}].${t}`,m),he(u,`symbology.layers[${n.symbology.activeLayer}]['selectedInteractiveFilterIndex']`,m.length-1)})},children:e.jsx(bd,{className:"fill-gray-200"})})]}),a.map((u,p)=>{const m=l===p;return e.jsxs("div",{className:`group/title w-full text-sm grid grid-cols-12 items-center rounded mb-2 ${m&&"bg-blue-100"}`,children:[e.jsx("div",{className:"truncate col-span-1 flex justify-center items-center",children:e.jsx("input",{type:"radio",checked:m,onChange:()=>{r(h=>{he(h,`symbology.layers[${n.symbology.activeLayer}]['selectedInteractiveFilterIndex']`,p)})}})}),e.jsx("div",{className:"truncate col-span-10",children:u.label}),e.jsx("div",{className:"col-span-1 flex items-center cursor-pointer group-hover/title:fill-slate-700 hover:bg-slate-100 rounded group/icon p-0.5",onClick:()=>{r(h=>{const f=C(h,`symbology.layers[${n.symbology.activeLayer}].${t}`);f.splice(p,1),he(h,`symbology.layers[${n.symbology.activeLayer}].${t}`,f)})},children:e.jsx(Ea,{size:20,className:"m-0.5 cursor-pointer group-hover/icon:fill-slate-900 "})})]},`ifilter_row_${p}`)}),d&&e.jsx(qP,{})]})}const qP=()=>{var a;const{state:t,setState:s}=w.useContext(He),{interactiveFilters:n,selectedInteractiveFilterIndex:r}=b.useMemo(()=>({interactiveFilters:C(t,`symbology.layers[${t.symbology.activeLayer}]['interactive-filters']`,[]),selectedInteractiveFilterIndex:C(t,`symbology.layers[${t.symbology.activeLayer}]['selectedInteractiveFilterIndex']`,[])}),[t]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"truncate col-span-10 group",children:["Editing:",e.jsx("input",{type:"text",className:" px-2  border text-sm border-transparent group-hover:border-slate-200 outline-2 outline-transparent rounded-md bg-transparent text-slate-700 placeholder:text-gray-400 focus:outline-pink-300 sm:leading-6",value:(a=n[r])==null?void 0:a.label,onChange:l=>{s(i=>{he(i,`symbology.layers[${t.symbology.activeLayer}]['interactive-filters'][${r}].label`,l.target.value)})}})]}),e.jsx(Vb,{type:"interactive",pathPrefix:`['interactive-filters'][${r}]`})]})};function Db({button:t,children:s}){return w.useContext(He),e.jsxs(Oe,{as:"div",className:"relative inline-block text-left w-full",children:[e.jsx(Oe.Button,{className:"w-full",children:t}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsx(Oe.Items,{className:"absolute -right-[10px] w-[226px] max-h-[400px] overflow-auto py-2 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none z-20",children:s})})]})}function KP({path:t,datapath:s,params:n={}}){var T,A;const{state:r,setState:a}=w.useContext(He),{falcor:l,falcorCache:i,pgEnv:c}=w.useContext(ce),d=(n==null?void 0:n.version)==="interactive"?`symbology.layers[${r.symbology.activeLayer}]${n.pathPrefix}`:`symbology.layers[${r.symbology.activeLayer}]`;let{value:u,viewId:p,sourceId:m,paintValue:h,column:f,categories:g,categorydata:x,colors:y,colorrange:j,numCategories:N,numbins:_,method:E,showOther:L,symbology_id:S,choroplethdata:k}=b.useMemo(()=>({value:C(r,`${d}.${t}`,{}),viewId:C(r,`symbology.layers[${r.symbology.activeLayer}].view_id`),sourceId:C(r,`symbology.layers[${r.symbology.activeLayer}].source_id`),paintValue:C(r,`${d}.${s}`,{}),column:C(r,`${d}['data-column']`,""),categories:C(r,`${d}['categories']`,{}),categorydata:C(r,`${d}['category-data']`,{}),choroplethdata:C(r,`${d}['choroplethdata']`),colors:C(r,`${d}['color-set']`,wd.cat1),colorrange:C(r,`${d}['color-range']`,os.seq1[9]),numbins:C(r,`${d}['num-bins']`,9),method:C(r,`${d}['bin-method']`,"ckmeans"),numCategories:C(r,`${d}['num-categories']`,10),showOther:C(r,`${d}['category-show-other']`,"#ccc"),symbology_id:C(r,"symbology_id")}),[r]);b.useEffect(()=>{m&&l.get(["dama",c,"sources","byId",m,"attributes","metadata"])},[m]);const $=b.useMemo(()=>{let R=C(i,["dama",c,"sources","byId",m,"attributes","metadata","value","columns"],[]);return R.length===0&&(R=C(i,["dama",c,"sources","byId",m,"attributes","metadata","value"],[])),R},[m,i]),I=b.useMemo(()=>{const R=($==null?void 0:$.length)>0,O=$==null?void 0:$.reduce((M,D)=>(["integer","number"].includes(D.type)&&(M=!0),M),!1);return[{name:"Simple",value:"simple"},R?{name:"Categories",value:"categories"}:null,O?{name:"Color Range",value:"choropleth"}:null,(n==null?void 0:n.version)!=="interactive"?{name:"Interactive",value:"interactive"}:null].filter(M=>M)},[$]);return w.useEffect(()=>{(async()=>{var O;if(u==="categories"){let{paint:M,legend:D}=g!=null&&g.paint&&(g!=null&&g.legend)?Ie(g):zP(f,x,y,N,$);M.length%2?M[M.length-1]=L:M.push(L),L==="#ccc"&&D?(((O=D[D.length-1])==null?void 0:O.label)!=="Other"&&D.push({color:L,label:"Other"}),D[D.length-1].color=L):D[D.length-1].label==="Other"&&D.pop(),Wm(M)&&!Fe(M,h)&&a(F=>{he(F,`${d}['categories']`,{paint:M,legend:D}),he(F,`${d}.${s}`,M),he(F,`${d}['legend-data']`,D)})}else if(u==="choropleth"){const M={column:f,viewId:p,numbins:_,method:E};let D;if(k&&Object.keys(k).length===2)D=k;else{a(G=>{he(G,`${d}['is-loading-colorbreaks']`,!0)});const V=await l.get(["dama",c,"symbologies","byId",[S],"colorDomain","options",JSON.stringify(M)]);D=C(V,["json","dama",c,"symbologies","byId",[S],"colorDomain","options",JSON.stringify(M)]),a(G=>{he(G,`${d}['is-loading-colorbreaks']`,!1)})}let{paint:P,legend:F}=UP(f,D.max,j,_,E,D.breaks,L);L==="#ccc"?(F[F.length-1].label!=="No data"&&F.push({color:L,label:"No data"}),F[F.length-1].color=L):F[F.length-1].label==="No data"&&F.pop(),Wm(P)&&!Fe(P,h)&&a(V=>{he(V,`${d}.${s}`,P),he(V,`${d}['legend-data']`,F),he(V,`${d}['choroplethdata']`,D)})}else u==="simple"&&typeof h!="string"&&a(M=>{he(M,`${d}.${s}`,Jo(null))})})()},[g,u,f,x,y,N,L,j,_,E,k]),e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsx("select",{className:"w-full p-2 bg-transparent",value:C(r,`${d}.${t}`,n.default||((A=(T=n==null?void 0:n.options)==null?void 0:T[0])==null?void 0:A.value)),onChange:R=>a(O=>{var M,D,P,F;if(!f&&R.target.value==="categories"){const B=((M=$.filter(V=>!["integer","number"].includes(V.type))[0])==null?void 0:M.name)??((D=$[0])==null?void 0:D.name);he(O,`${d}['data-column']`,B)}else if(R.target.value==="choropleth"){const B=$.find(V=>V.name===f);if(!["integer","number"].includes(B==null?void 0:B.type)){const V=((P=$.filter(G=>["integer","number"].includes(G.type))[0])==null?void 0:P.name)??((F=$[0])==null?void 0:F.name);he(O,`${d}['data-column']`,V)}}he(O,`${d}.${t}`,R.target.value)}),children:(I||[]).map((R,O)=>e.jsx("option",{value:R.value,children:R.name},O))})})})}function YP({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(He),a=(s==null?void 0:s.version)==="interactive"?`symbology.layers[${n.symbology.activeLayer}]${s.pathPrefix}`:`symbology.layers[${n.symbology.activeLayer}]`;return e.jsxs("label",{className:"flex",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"color",value:Rn(C(n,`${a}.${t}`,"#ccc")),onChange:l=>r(i=>{he(i,`${a}.${t}`,l.target.value)})})}),e.jsx("div",{className:"flex items-center p-2",children:"Custom "})]})}function ZP({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(He),a=c=>c,l=(s==null?void 0:s.format)||a,i=(s==null?void 0:s.version)==="interactive"?`symbology.layers[${n.symbology.activeLayer}]${s.pathPrefix}`:`symbology.layers[${n.symbology.activeLayer}]`;return e.jsxs("div",{className:"flex w-full  items-center",children:[e.jsx("div",{className:"flex-1 flex w-full",children:e.jsx("input",{className:'w-full flex-1 accent-slate-600 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">',type:"range",min:s.min||"0",max:s.max||"1",step:s.step||"0.01",value:C(n,`${i}].${t}`,s.default||"1"),onChange:c=>r(d=>{he(d,`${i}].${t}`,+c.target.value)})})}),e.jsx("div",{className:"pl-2",children:e.jsx("input",{className:"w-14 px-2 py-1 bg-transparent",value:`${l(C(n,`${i}].${t}`,s.default||"1"))}${s.units?s.units:""}`,onChange:()=>{}})})]})}function XP({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(He),a=(s==null?void 0:s.version)==="interactive"?`symbology.layers[${n.symbology.activeLayer}]${s.pathPrefix}`:`symbology.layers[${n.symbology.activeLayer}]`;return e.jsx("label",{className:"flex",children:e.jsx("div",{className:"flex items-center",children:e.jsx("input",{className:"w-full",type:"text",value:C(n,`${a}.${t}`,(s==null?void 0:s.default)??"#ccc"),onChange:l=>r(i=>{he(i,`${a}.${t}`,l.target.value)})})})})}function Rb({path:t,params:s={}}){var l,i;const{state:n,setState:r}=w.useContext(He),a=(s==null?void 0:s.version)==="interactive"?`symbology.layers[${n.symbology.activeLayer}]${s.pathPrefix}`:`symbology.layers[${n.symbology.activeLayer}]`;return e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsx("select",{className:"w-full py-2 bg-transparent",value:C(n,`${a}.${t}`,s.default||((i=(l=s==null?void 0:s.options)==null?void 0:l[0])==null?void 0:i.value)),onChange:c=>r(d=>{he(d,`${a}.${t}`,c.target.value)}),children:((s==null?void 0:s.options)||[]).map((c,d)=>e.jsx("option",{value:c.value,children:c.name},d))})})})}function QP({path:t,datapath:s,params:n={}}){const{state:r,setState:a}=w.useContext(He),{falcor:l,falcorCache:i,pgEnv:c}=w.useContext(ce),d=(n==null?void 0:n.version)==="interactive"?`symbology.layers[${r.symbology.activeLayer}]${n.pathPrefix}`:`symbology.layers[${r.symbology.activeLayer}]`,{layerType:u,viewId:p,sourceId:m}=b.useMemo(()=>({layerType:C(r,`${d}['layer-type']`),viewId:C(r,`symbology.layers[${r.symbology.activeLayer}].view_id`),sourceId:C(r,`symbology.layers[${r.symbology.activeLayer}].source_id`)}),[r]),h=b.useMemo(()=>C(r,`${d}.${t}`,null),[r,t]);b.useEffect(()=>{m&&l.get(["dama",c,"sources","byId",m,"attributes","metadata"])},[c,m]);const f=b.useMemo(()=>{let g=C(i,["dama",c,"sources","byId",m,"attributes","metadata","value","columns"],[]);return g.length===0&&(g=C(i,["dama",c,"sources","byId",m,"attributes","metadata","value"],[])),g},[c,m,i]);return b.useEffect(()=>{if(h&&u==="categories"){const g=JSON.stringify({groupBy:[h.split("AS ")[0]],exclude:{[h.split("AS ")[0]]:["null"]},orderBy:{2:"desc"}});l.get(["dama",c,"viewsbyId",p,"options",g,"databyIndex",{from:0,to:100},[h,"count(1)::int as count"]])}},[h,u,p]),b.useEffect(()=>{if(h&&u==="categories"){const g=JSON.stringify({groupBy:[h.split("AS ")[0]],exclude:{[h.split("AS ")[0]]:["null"]},orderBy:{2:"desc"}});let x=C(i,["dama",c,"viewsbyId",p,"options",g,"databyIndex"],{});a(y=>{he(y,`${d}['category-data']`,x)})}},[h,u,p,i]),e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsx("select",{className:"w-full p-2 bg-transparent",value:h,onChange:g=>a(x=>{let y=C(r,`${d}.sources[0].source.tiles[0]`,"no source tiles").split("?")[0];y!=="no source tiles"&&he(x,`${d}.sources[0].source.tiles[0]`,y+`?cols=${g.target.value}`),he(x,`${d}['choroplethdata']`,{}),he(x,`${d}['categories']`,{}),he(x,`${d}.${t}`,g.target.value)}),children:(f||[]).filter(g=>!(u==="choropleth"&&!["integer","number"].includes(g.type))).filter(g=>!["wkb_geometry"].includes(g.name)).map((g,x)=>e.jsx("option",{value:g.name,children:g.display_name||g.name},x))})})})}function eD({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(He),a=(s==null?void 0:s.version)==="interactive"?`symbology.layers[${n.symbology.activeLayer}]${s.pathPrefix}`:`symbology.layers[${n.symbology.activeLayer}]`;let l=C(n,`${a}['range-key']`,os.schemeGroups.sequential[0]),i=C(n,`${a}['num-bins']`,9),c=C(n,`${a}.${t}`,os[l][i]);return e.jsx("div",{className:"flex w-full items-center",children:e.jsxs(Db,{button:e.jsxs("div",{className:"flex items-center w-full cursor-pointer flex-1",children:[e.jsx("div",{className:"flex-1 flex justify-center ",children:(c.map?c:[]).map((d,u)=>e.jsx("div",{className:"flex-1 h-4",style:{backgroundColor:d}},u))}),e.jsx("div",{className:"flex items-center px-1 border-2 border-transparent h-8  hover fill-slate-400 hover:fill-slate-800 cursor-pointer",children:e.jsx(vd,{className:""})})]}),children:[e.jsx(Oe.Item,{className:"z-20",children:e.jsx("div",{className:"px-4 font-semibold text-sm text-slate-600",children:"SEQUENTIAL"})}),[...os.schemeGroups.sequential,...os.schemeGroups.singlehue].map(d=>e.jsx(Oe.Item,{className:"z-20",children:({active:u})=>e.jsxs("div",{className:`${u?"bg-blue-50 ":""} flex`,children:[e.jsx("div",{className:"w-4 h-4"}),e.jsx("div",{className:"flex-1 flex w-full p-2",onClick:()=>r(p=>{he(p,`${a}.${t}`,os[d][i]),he(p,`${a}['range-key']`,d)}),children:os[d][i].map((p,m)=>e.jsx("div",{className:"flex-1 h-4",style:{backgroundColor:p}},m))})]})},d)),e.jsx(Oe.Item,{className:"z-20",children:e.jsx("div",{className:"px-4 font-semibold text-sm text-slate-600",children:"Diverging"})}),os.schemeGroups.diverging.map(d=>e.jsx(Oe.Item,{className:"z-20",children:({active:u})=>e.jsxs("div",{className:`${u?"bg-blue-50 ":""} flex`,children:[e.jsx("div",{className:"w-4 h-4"}),e.jsx("div",{className:"flex-1 flex w-full p-2",onClick:()=>r(p=>{he(p,`${a}.${t}`,os[d][i]),he(p,`${a}['range-key']`,d)}),children:os[d][i].map((p,m)=>e.jsx("div",{className:"flex-1 h-4",style:{backgroundColor:p}},m))})]})},d))]})})}function tD({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(He);let a=wd;const l=(s==null?void 0:s.version)==="interactive"?`symbology.layers[${n.symbology.activeLayer}]${s.pathPrefix}`:`symbology.layers[${n.symbology.activeLayer}]`;let{value:i,categories:c}=b.useMemo(()=>({value:C(n,`${l}.${t}`,a.cat1),categories:C(n,`${l}['categories']`,{})}),[n]);const d=(u,p)=>{const m=u.legend.map((f,g)=>({...f,color:Rn(p[g])}));return{paint:u.paint.map((f,g)=>g<3||g===u.paint.length-1?f:g%2===1?Rn(p[((g+1)/2-2)%p.length]):f),legend:m}};return e.jsx("div",{className:"flex w-full items-center",children:e.jsx(Db,{button:e.jsxs("div",{className:"flex items-center w-full cursor-pointer flex-1",children:[e.jsx("div",{className:"flex-1 flex justify-center ",children:(i.map?i:[]).map((u,p)=>e.jsx("div",{className:"w-4 h-4",style:{backgroundColor:u}},p))}),e.jsx("div",{className:"flex items-center px-1 border-2 border-transparent h-8  hover fill-slate-400 hover:fill-slate-800 cursor-pointer",children:e.jsx(vd,{className:""})})]}),children:Object.keys(a).map(u=>e.jsx(Oe.Item,{className:"z-20",children:({active:p})=>e.jsxs("div",{className:`${p?"bg-blue-50 ":""} flex`,children:[e.jsx("div",{className:"w-4 h-4"}),e.jsx("div",{className:"flex-1 flex w-full p-2",onClick:()=>{r(m=>{const h=d(c,a[u]);he(m,`${l}.${t}`,a[u]),he(m,`${l}['categories']`,h)})},children:a[u].map((m,h)=>e.jsx("div",{className:"w-4 h-4",style:{backgroundColor:m}},h))})]})},u))})})}function Wr(t){return Math.pow(10,Math.round(Math.log10(t)))}function sD({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(He);w.useContext(ce);const a=(s==null?void 0:s.version)==="interactive"?`symbology.layers[${n.symbology.activeLayer}]${s.pathPrefix}`:`symbology.layers[${n.symbology.activeLayer}]`;let{numbins:l,method:i,colorKey:c,legenddata:d,showOther:u,choroplethdata:p,isLoadingColorbreaks:m}=b.useMemo(()=>({numbins:C(n,`${a}['num-bins']`,9),colorKey:C(n,`${a}['range-key']`,"seq1"),method:C(n,`${a}['bin-method']`,"ckmeans"),legenddata:C(n,`${a}['legend-data']`),choroplethdata:C(n,`${a}['choroplethdata']`,{breaks:[]}),showOther:C(n,`${a}['category-show-other']`,"#ccc"),isLoadingColorbreaks:C(n,`${a}['is-loading-colorbreaks']`,!1)}),[n]);const{breaks:h,max:f}=p,g=h==null?void 0:h.map((j,N)=>({color:d[N].color,label:`${h[N]} - ${h[N+1]||f}`})).filter(j=>j),x=u==="#ccc",y=g==null?void 0:g.map((j,N)=>e.jsx("div",{children:e.jsxs("div",{className:"w-full flex items-center hover:bg-slate-100 cursor-auto",children:[e.jsx("div",{className:"flex items-center h-8 w-8 justify-center  border-r border-b ",children:e.jsx("div",{className:"w-4 h-4 rounded border-[0.5px] border-slate-600",style:{backgroundColor:j.color}})}),e.jsxs("div",{className:"flex items-center justify-between text-center flex-1 px-2 text-slate-600 border-b h-8 truncate overflow-auto w-full",children:[e.jsx("div",{className:"px-2 w-[10px]",children:N!==0&&e.jsx("i",{className:"fa-solid fa-chevron-left cursor-pointer hover:text-pink-700",onClick:()=>{console.log("move lower bound for range::",j.label),r(_=>{const E=h[N-1]+1,L=[...h];L[N]=N!==0?Math.max(L[N]-Wr(L[N]/10),E):L[N]-Wr(L[N]/10),he(_,`${a}['choroplethdata']['breaks']`,L)})}})}),j.label,e.jsx("div",{className:"px-2 w-[10px]",children:N!==g.length-1&&e.jsx("i",{className:"fa-solid fa-chevron-right cursor-pointer hover:text-pink-700",onClick:()=>{console.log("move upper bound for range::",j.label),r(_=>{const E=[...h];if(N!==g.length-1){const L=N===g.length-2?f-1:h[N+2]-1;E[N+1]=Math.min(E[N+1]+Wr(E[N+1]/10),L),he(_,`${a}['choroplethdata']['breaks']`,E)}else{const L=f+Wr(f/10);he(_,`${a}['choroplethdata']['max']`,L)}})}})})]})]},N)},`range_input_${N}`));return e.jsxs("div",{className:" w-full items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Showing"}),e.jsx("div",{className:"border border-transparent hover:border-slate-200 m-1 rounded ",children:e.jsx("select",{className:"w-full p-2 bg-transparent text-slate-700 text-sm",value:l,onChange:j=>r(N=>{he(N,`${a}.['num-bins']`,j.target.value),he(N,`${a}.['choroplethdata']`,{}),he(N,`${a}.['color-range']`,os[c][j.target.value])}),children:(Object.keys(os[c])||[]).map((j,N)=>e.jsx("option",{value:j,children:j},N))})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Method"}),e.jsx("div",{className:"border border-transparent hover:border-slate-200 m-1 rounded ",children:e.jsxs("select",{className:"w-full p-2 bg-transparent text-slate-700 text-sm",value:i,onChange:j=>r(N=>{he(N,`${a}.['choroplethdata']`,{}),he(N,`${a}['bin-method']`,j.target.value)}),children:[e.jsx("option",{value:"ckmeans",children:"ck-means"}),e.jsx("option",{value:"pretty",children:"Pretty Breaks"}),e.jsx("option",{value:"equalInterval",children:"Equal Interval"})]})})]}),e.jsxs("div",{className:"flex items-center pb-2",children:[e.jsx("div",{className:"text-sm text-slate-400 px-2",children:"Show missing data"}),e.jsx("div",{className:"flex items-center",children:e.jsxs(Tt,{checked:x,onChange:()=>{r(j=>{const N=x?"rgba(0,0,0,0)":"#ccc";he(j,`${a}['category-show-other']`,N)})},className:`${x?"bg-blue-500":"bg-gray-200"} relative inline-flex h-4 w-8 items-center rounded-full `,children:[e.jsx("span",{className:"sr-only",children:"Show other"}),e.jsx("div",{className:`${x?"translate-x-5":"translate-x-0"} inline-block h-4 w-4  transform rounded-full bg-white transition border-[0.5] border-slate-600`})]})})]}),e.jsxs("div",{className:"w-full max-h-[250px] overflow-auto",children:[m?e.jsxs("div",{className:"flex w-full justify-center overflow-hidden pb-2",children:["Creating scale...",e.jsx("span",{style:{fontSize:"1.5rem"},className:"ml-2 fa-solid fa-spinner fa-spin"})]}):y,x&&e.jsxs("div",{className:"w-full flex items-center hover:bg-slate-100",children:[e.jsx("div",{className:"flex items-center h-8 w-8 justify-center  border-r border-b ",children:e.jsx("div",{className:"w-4 h-4 rounded border-[0.5px] border-slate-600",style:{backgroundColor:u}})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-600 border-b h-8 truncate",children:"No data"})]})]})]})}const Fb=({setState:t,availableColumnNames:s})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center ml-4",children:"Add Column"}),e.jsx("div",{className:"flex-1 flex items-center mx-4",children:e.jsx(Vs,{children:e.jsx("label",{className:"flex w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsxs("select",{className:"w-full py-2 bg-transparent",value:"",onChange:n=>t(n.target.value),children:[e.jsx("option",{value:""},-1),(s||[]).map((n,r)=>e.jsx("option",{value:n.value,children:n.label},r))]})})})})})]}),Fn={color:YP,categoricalColor:tD,rangeColor:eD,categoryControl:GP,choroplethControl:sD,interactiveFilterControl:JP,range:ZP,simple:XP,select:Rb,selectType:KP,selectViewColumn:QP};function Vs({children:t}){return e.jsx("div",{className:"rounded-md h-[36px] flex w-full w-[216px] p-2 items-center border border-white/50 hover:bg-white cursor-pointer hover:border-slate-200",children:t})}function nD({values:t,title:s="",children:n}){return e.jsx(Vs,{children:e.jsx(ft,{className:"relative w-full",children:({open:r})=>e.jsxs(e.Fragment,{children:[e.jsx(ft.Button,{className:"w-full",children:e.jsxs("div",{className:"w-full flex items-center group",children:[e.jsx("div",{className:"flex items-center group-hover:flex-1",children:(t||[]).map((a,l)=>e.jsxs(b.Fragment,{children:[a.type==="color"&&e.jsx("div",{className:"h-4 w-4 border",style:{backgroundColor:Rn(a.value)}}),e.jsxs("div",{className:"px-1 py-1 truncate",children:[e.jsx("span",{className:"",children:a.type==="color"?Rn(a.value):a.value}),a.unit?a.unit:""," "]}),e.jsx("div",{className:"px-1 py-1 truncate",children:l<t.length-1?"/":""})]},l))}),e.jsx("div",{className:"flex items-center ",children:e.jsx(vd,{className:"fill-slate-400 group-hover:fill-slate-800"})})]})}),e.jsx(Be,{as:b.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(ft.Panel,{className:"absolute w-[250px] left-0  z-10 mt-3 -translate-x-[325px] -translate-y-[78px] transform px-4  ",children:({close:a})=>e.jsxs("div",{className:"overflow-hidden rounded-lg shadow-lg ring-1 ring-black/5 bg-white/95",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:" w-full flex text-slate-700 py-1 px-2 text-sm font-semibold tracking-wider",children:s}),e.jsx("div",{onClick:()=>a(),className:"p-0.5 rounded hover:bg-slate-100 m-1 cursor-pointer",children:e.jsx(Ea,{className:"fill-slate-700"})})]}),e.jsx("div",{className:"relative",children:n})]})})})]})})})}function aD({label:t,controls:s}){return w.useContext(He),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center",children:t}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsx(Vs,{children:s.map((n,r)=>{const a=Fn[n.type]||Fn.simple;return e.jsx(a,{path:n.path,datapath:n.datapath,params:n.params},r)})})})]})}function rD({label:t,controls:s}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex-1 flex items-center",children:s.map((n,r)=>{const a=Fn[n.type]||Fn.simple;return e.jsx(a,{path:n.path,datapath:n.datapath,params:n.params},r)})})})}function oD(t){const{label:s,controls:n}=t,{state:r,setState:a}=w.useContext(He),l=b.useMemo(()=>n.map(i=>{var m,h;const c=((m=i.params)==null?void 0:m.version)==="interactive"?`symbology.layers[${r.symbology.activeLayer}]${i.params.pathPrefix}`:`symbology.layers[${r.symbology.activeLayer}]`,d=f=>f;let p=(((h=i==null?void 0:i.params)==null?void 0:h.format)||d)(C(r,`${c}.${i.path}`,""));return{type:i==null?void 0:i.type,unit:i==null?void 0:i.unit,value:p}}),[r,n]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center",children:s}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsx(nD,{values:l,title:s,children:n.map((i,c)=>{const d=Fn[i.type]||Fn.simple;return e.jsx(d,{path:i.path,datapath:i.datapath,params:i.params},c)})})})]})}const Jm={popover:oD,inline:aD,"full-width":rD},lD={fill:"Polygons",line:"Lines",circle:"Points"};function Vb(t){const{state:s,setState:n}=w.useContext(He),r=b.useMemo(()=>{var l,i;return((i=(l=s.symbology)==null?void 0:l.layers)==null?void 0:i[s.symbology.activeLayer])||null},[s]);let a=b.useMemo(()=>Pb[r.type]||[],[r.type]);return t.type==="interactive"&&(a=a.filter(l=>l.label!=="Interactive Filters").map(l=>{let i=[...l.controls],c=l.conditional?{...l.conditional}:void 0;return i=i.map(d=>({...d,params:{...d.params,pathPrefix:t.pathPrefix,version:"interactive"}})),l.conditional&&(c.path=t.pathPrefix+c.path),{...l,controls:i,conditional:c}})),r&&e.jsx("div",{children:e.jsxs("div",{className:`${t.type==="interactive"?"mt-2 border-2 p-1 border-gray-100 rounded":"p-4"}`,children:[e.jsx("div",{className:"font-bold tracking-wider text-sm text-slate-700",children:lD[r.type]}),a.filter(l=>{if(l.conditional){const i=C(s,`symbology.layers[${s.symbology.activeLayer}].${l.conditional.path}`,"-999");return l.conditional.conditions.includes(i)}else return!0}).map((l,i)=>{let c=Jm[l.type]||Jm.inline;return e.jsx("div",{className:"flex flex-wrap",children:e.jsx(c,{label:l.label,controls:l.controls})},i)})]})})}function iD(t,s,n){return n.indexOf(t)===s}const cD=(t,s)=>t.filter(n=>!s.includes(n));function dD({path:t,params:s={}}){const{state:n,setState:r}=w.useContext(He),a=(s==null?void 0:s.version)==="interactive"?`symbology.layers[${n.symbology.activeLayer}]${s.pathPrefix}`:`symbology.layers[${n.symbology.activeLayer}]`,l=b.useMemo(()=>C(n,`${a}.${t}`),[n,t,s]),i=C(n,`symbology.layers[${n.symbology.activeLayer}].view_id`),c=C(n,`symbology.layers[${n.symbology.activeLayer}].source_id`),{pgEnv:d,falcor:u,falcorCache:p}=b.useContext(ce);b.useEffect(()=>{c&&u.get(["dama",d,"sources","byId",c,"attributes","metadata"])},[c]);const m=b.useMemo(()=>{let y=C(p,["dama",d,"sources","byId",c,"attributes","metadata","value","columns"],[]);return y.length===0&&(y=C(p,["dama",d,"sources","byId",c,"attributes","metadata","value"],[])),y},[c,p]),h=b.useMemo(()=>m.map(y=>y.name),[m]);b.useEffect(()=>{l===void 0&&r(y=>{he(y,`${a}.${t}`,m.filter(j=>!["wkb_geometry"].includes(j.name)).map(j=>({column_name:j.name,display_name:(j==null?void 0:j.display_name)||j.name})))})},[m]);const f=b.useMemo(()=>l?typeof l[0]=="string"?l:l.map(y=>y==null?void 0:y.column_name):void 0,[l]),g=b.useMemo(()=>(f?cD(h,f):h).filter(y=>!["wkb_geometry"].includes(y)),[f,h]);w.useEffect(()=>{u.get(["dama",d,"viewsbyId",i,"databyIndex",{from:0,to:100},f])},[u,d,i,f]);const x=b.useMemo(()=>Object.values(C(p,["dama",d,"viewsbyId",i,"databyIndex"],[])).map(y=>y!=null&&y.value?C(p,y.value,""):""),[d,p]);return e.jsxs("div",{className:"flex w-full flex-wrap",children:[e.jsx("div",{className:"flex w-full flex-wrap my-2",children:e.jsx(Fb,{setState:y=>{r(j=>{if(y!==""){const N=m.find(_=>_.name===y);he(j,`${a}.${t}`,l?[...l,{column_name:y,display_name:(N==null?void 0:N.display_name)||y}]:[{column_name:y,display_name:(N==null?void 0:N.display_name)||y}])}})},availableColumnNames:g.map(y=>{const j=m.find(N=>N.name===y);return{value:y,label:(j==null?void 0:j.display_name)||y}})})}),e.jsxs("div",{className:"flex w-full flex-wrap my-2 mx-4 justify-around",children:[e.jsx(We,{themeOptions:{size:"xs",color:"primary"},className:(g==null?void 0:g.length)===0?"disabled:opacity-75 pointer-events-none	":" ",disabled:(g==null?void 0:g.length)===0,onClick:()=>{r(y=>{he(y,`${a}.${t}`,m.filter(j=>!["wkb_geometry"].includes(j.name)).map(j=>({column_name:j.name,display_name:(j==null?void 0:j.display_name)||j.name})))})},children:"Add All Columns"}),e.jsx(We,{themeOptions:{size:"xs",color:"danger"},className:(f==null?void 0:f.length)===0?"disabled:opacity-75 pointer-events-none	bgDanger":" bgDanger",disabled:(f==null?void 0:f.length)===0,onClick:()=>{r(y=>{he(y,`${a}.${t}`,[])})},children:"Remove All Columns"})]}),e.jsx(uD,{selectedColumns:l,sampleData:x,reorderAttrs:(y,j)=>{const N=[...l],[_]=N.splice(y,1);N.splice(j,0,_),r(E=>{he(E,`${a}.${t}`,N)})},renameAttr:({columnName:y,displayName:j})=>{const N=[...l],_=N.findIndex(S=>S.column_name===y),[E]=N.splice(_,1),L={...E};L.display_name=j,N.splice(_,0,L),r(S=>{he(S,`${a}.${t}`,N)})},removeAttr:y=>{r(j=>{he(j,`${a}.${t}`,l.filter(N=>N.column_name!==y))})}})]})}const uD=({selectedColumns:t,sampleData:s,path:n,reorderAttrs:r,removeAttr:a,renameAttr:l})=>e.jsx(Wn,{onDrop:r,children:t==null?void 0:t.map((i,c)=>e.jsxs("div",{className:"group/title w-full text-sm grid grid-cols-9 cursor-grab",children:[e.jsx("div",{className:"truncate border-t border-r border-slate-200 col-span-4 px-2 py-1",children:e.jsx("input",{type:"text",className:"w-full px-2  border text-sm border-transparent hover:border-slate-200 outline-2 outline-transparent rounded-md bg-transparent text-slate-700 placeholder:text-gray-400 focus:outline-pink-300 sm:leading-6",value:i.display_name,onChange:d=>{l({columnName:i.column_name,displayName:d.target.value})}})}),e.jsx("div",{className:"truncate flex items-center text-[13px] border-t border-slate-200 col-span-4 text-slate-300 px-4 py-1",children:s.map(d=>d[i.column_name]).filter(d=>d!=="null").filter(iD).slice(0,2).join(", ")}),e.jsx("div",{className:"border-t flex items-center border-slate-200 cursor-pointer fill-white group-hover/title:fill-slate-300 hover:bg-slate-100 rounded group/icon col-span-1 p-0.5",onClick:()=>{a(i.column_name)},children:e.jsx(Ea,{className:"mx-[6px] cursor-pointer group-hover/icon:fill-slate-500 "})})]},c))});function mD(t){const{state:s,setState:n}=b.useContext(He),{layerType:r,selectedInteractiveFilterIndex:a}=b.useMemo(()=>({selectedInteractiveFilterIndex:C(s,`symbology.layers[${s.symbology.activeLayer}]['selectedInteractiveFilterIndex']`),layerType:C(s,`symbology.layers[${s.symbology.activeLayer}]['layer-type']`,"fill")}),[s]);let l="";r==="interactive"&&(l=`['interactive-filters'][${a}]`);const{activeLayer:i}=b.useMemo(()=>{const c=l!==""?`symbology.layers[${s.symbology.activeLayer}].${l}`:`symbology.layers[${s.symbology.activeLayer}]`;return{activeLayer:C(s,c)}},[s]);return i&&e.jsxs("div",{className:"pb-4  max-h-[calc(100vh_-_251px)] scrollbar-xs overflow-x-hidden overflow-y-auto",children:[e.jsxs("div",{className:"flex mx-4 mt-1",children:[e.jsx("div",{className:"w-16 text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center",children:"Popover"}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsx(Vs,{children:e.jsx(Rb,{path:"['hover']",params:{version:r==="interactive"?"interactive":void 0,pathPrefix:l,options:[{value:"",name:"None"},{value:"hover",name:"Hover"}]}})})})]}),i.hover&&e.jsx(dD,{path:"['hover-columns']",params:{version:r==="interactive"?"interactive":void 0,pathPrefix:l}})]})}const qm={fill:({layer:t,color:s})=>e.jsx("div",{className:"pr-2",children:e.jsx("div",{className:"w-4 h-4 rounded ",style:{backgroundColor:s}})}),circle:({layer:t,color:s})=>{let n=C(t,"layers[0].paint['circle-stroke-color']","#ccc");return e.jsx("div",{className:"pl-0.5 pr-2",children:e.jsx("div",{className:"w-3 h-3 rounded-full ",style:{backgroundColor:s,borderColor:n}})})},line:({layer:t,color:s})=>e.jsx("div",{className:"pr-2",children:e.jsx("div",{className:"w-4 h-1",style:{backgroundColor:s}})})};function pD(){const{state:t,setState:s}=w.useContext(He),{layerType:n,selectedInteractiveFilterIndex:r}=b.useMemo(()=>({selectedInteractiveFilterIndex:C(t,`symbology.layers[${t.symbology.activeLayer}]['selectedInteractiveFilterIndex']`),layerType:C(t,`symbology.layers[${t.symbology.activeLayer}]['layer-type']`,"fill")}),[t]);let a=`symbology.layers[${t.symbology.activeLayer}]`;n==="interactive"&&(a=`symbology.layers[${t.symbology.activeLayer}]['interactive-filters'][${r}]`);const{type:l,legenddata:i}=b.useMemo(()=>({legenddata:C(t,`${a}['legend-data']`,[]),type:C(t,`${a}['type']`,"fill")}),[t]);if(!i||i.length===0)return e.jsx("div",{children:" No Legend Data "});const c=qm[l]||qm.fill;return e.jsx("div",{className:"w-full max-h-[550px] pb-4 overflow-auto",children:i.map((d,u)=>e.jsxs("div",{className:"w-full flex items-center hover:bg-pink-50",children:[e.jsx("div",{className:"flex items-center h-6 w-10 justify-center  ",children:e.jsx(c,{color:d.color})}),e.jsx("div",{className:"flex items-center text-center flex-1 px-4 text-slate-500  text-sm truncate",children:e.jsx("input",{type:"text",className:"block w-full border border-transparent hover:border-slate-200 outline-2 outline-transparent rounded-md bg-transparent py-1 px-2 text-slate-800 placeholder:text-gray-400 focus:outline-pink-300 sm:leading-6",placeholder:"Select / Create New Map",value:i[u].label,onChange:p=>s(m=>{he(m,`${a}['legend-data'][${u}].label`,p.target.value)})})})]},u))})}function hD(t){const{state:s,setState:n}=w.useContext(He),r=b.useMemo(()=>{var a,l;return((l=(a=s.symbology)==null?void 0:a.layers)==null?void 0:l[s.symbology.activeLayer])||null},[s]);return b.useMemo(()=>Pb[r.type]||[],[r.type]),r&&e.jsx("div",{children:e.jsxs("div",{className:"",children:[e.jsx("div",{className:"font-bold tracking-wider text-sm text-slate-700 p-4",children:"Legend"}),e.jsx(pD,{})]})})}const{simple:Km,select:fD}=Fn;function gD(t,s,n){return n.indexOf(t)===s}const xD=(t,s)=>t.filter(n=>!s.includes(n)),bD={string:["!=","=="],integer:["!=","<","<=","==",">=",">","between"],number:["!=","<","<=","==",">=",">","between"]},yD=({removeFilter:t,activeColumn:s,setActiveColumn:n})=>{var m;const{state:r,setState:a}=w.useContext(He),l=C(r,`symbology.layers[${r.symbology.activeLayer}].filter`,{}),i=C(r,`symbology.layers[${r.symbology.activeLayer}].source_id`),{pgEnv:c,falcor:d,falcorCache:u}=b.useContext(ce);b.useEffect(()=>{i&&d.get(["dama",c,"sources","byId",i,"attributes","metadata"])},[i]);const p=b.useMemo(()=>{let h=C(u,["dama",c,"sources","byId",i,"attributes","metadata","value","columns"],[]);return h.length===0&&(h=C(u,["dama",c,"sources","byId",i,"attributes","metadata","value"],[])),h},[i,u]);return e.jsx("div",{className:"flex w-full flex-wrap",children:(m=Object.keys(l||{}))==null?void 0:m.map((h,f)=>{var S,k,$;const g=p.find(I=>I.name===h)||{},x=l[h],y=s===h?"bg-pink-100":"",j=s===h?"text-pink-100":"text-white",N=g.type==="string"&&["!=","=="].includes(x.operator),_=x.operator==="between",E=((S=p.find(I=>I.name===h))==null?void 0:S.display_name)||h;let L=x==null?void 0:x.value;return N?Array.isArray(x==null?void 0:x.value)&&(L=(k=x==null?void 0:x.value)==null?void 0:k.join(", ")):_&&Array.isArray(x==null?void 0:x.value)&&(L=($=x==null?void 0:x.value)==null?void 0:$.join(" and ")),e.jsxs("div",{className:`${y} m-1 border border-slate-200 rounded group/title w-full px-1 text-sm grid grid-cols-9 cursor-pointer hover:border-pink-500 hover:border`,onClick:()=>{n(h)},children:[e.jsxs("div",{className:"truncate col-span-8 py-1",children:[E," ",e.jsx("span",{className:"font-thin",children:x.operator})," ",L]}),e.jsx("div",{className:`cursor-pointer ${j} group-hover/title:text-black group/icon col-span-1 p-1`,onClick:I=>{I.stopPropagation(),t(h)},children:e.jsx("i",{className:"mx-2 fa fa-x cursor-pointer group-hover/icon:text-pink-800"})})]},f)})})};function vD({path:t,params:s={}}){var S,k;const{state:n,setState:r}=w.useContext(He),[a,l]=w.useState(""),{activeColumn:i,setActiveColumn:c}=s,{sourceId:d}=b.useMemo(()=>({sourceId:C(n,`symbology.layers[${n.symbology.activeLayer}].source_id`)}),[n]),{pgEnv:u,falcor:p,falcorCache:m}=b.useContext(ce);b.useEffect(()=>{d&&p.get(["dama",u,"sources","byId",d,"attributes","metadata"])},[d]);const h=b.useMemo(()=>{let $=C(m,["dama",u,"sources","byId",d,"attributes","metadata","value","columns"],[]);return $.length===0&&($=C(m,["dama",u,"sources","byId",d,"attributes","metadata","value"],[])),$},[d,m]),f=b.useMemo(()=>h.find($=>$.name===i),[i]),g=bD[f==null?void 0:f.type]||[],x=C(n,`symbology.layers[${n.symbology.activeLayer}].filter`,{}),y=`${t}.${i}.value`,j=((S=x==null?void 0:x[i])==null?void 0:S.operator)==="between",N=(f==null?void 0:f.type)==="string"&&["!=","=="].includes((k=x==null?void 0:x[i])==null?void 0:k.operator),_=N?e.jsx(Vs,{children:e.jsx("label",{className:"flex",children:e.jsx("div",{className:"flex items-center",children:e.jsx("input",{className:"w-full",type:"text",value:a,onChange:$=>{l($.target.value)}})})})}):e.jsx(Vs,{children:e.jsx(Km,{path:y+(j?"[0]":""),params:{default:""}})}),E=N?"Search:":"Value:",L=j?null:e.jsx("div",{className:"p-1",children:E});return e.jsxs(e.Fragment,{children:[!i&&e.jsx(jD,{path:t,params:s,setActiveColumn:c}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-4",children:[e.jsxs("div",{className:"flex my-1 items-center",children:[e.jsx("div",{className:"p-1",children:"Column:"}),e.jsx("div",{className:"p-2",children:f.display_name??i})]}),e.jsxs("div",{className:"flex my-1 items-center",children:[e.jsx("div",{className:"p-1",children:"Operator:"}),e.jsx(Vs,{children:e.jsx(fD,{path:`${t}.${i}.operator`,params:{options:g.map($=>({value:$,name:$}))}})})]}),e.jsxs("div",{className:"flex my-1 items-center",children:[L,_]}),j&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1",children:"And"}),e.jsx("div",{className:"flex my-1 items-center",children:e.jsx(Vs,{children:e.jsx(Km,{path:y+"[1]",params:{default:""}})})})]})]}),N&&e.jsx(wD,{params:s,path:y,filterSearchValue:a})]})]})}function jD({path:t,params:s={},setActiveColumn:n}){var y,j;const{state:r,setState:a}=w.useContext(He),l=C(r,`symbology.layers[${r.symbology.activeLayer}].${t}`,s.default||((j=(y=s==null?void 0:s.options)==null?void 0:y[0])==null?void 0:j.value)||{}),i=Object.keys(l),c=C(r,`symbology.layers[${r.symbology.activeLayer}].source_id`),{pgEnv:d,falcor:u,falcorCache:p}=b.useContext(ce);b.useEffect(()=>{c&&u.get(["dama",d,"sources","byId",c,"attributes","metadata"])},[c]);const m=b.useMemo(()=>{let N=C(p,["dama",d,"sources","byId",c,"attributes","metadata","value","columns"],[]);return N.length===0&&(N=C(p,["dama",d,"sources","byId",c,"attributes","metadata","value"],[])),N},[c,p]),h=b.useMemo(()=>m.filter(N=>!["wkb_geometry"].includes(N)).map(N=>N.name),[m]),f=xD(h,i).map(N=>{const _=m.find(E=>E.name===N);return{value:N,label:(_==null?void 0:_.display_name)||N}}),g={operator:"==",value:[]},x={operator:"==",value:""};return e.jsx(Fb,{setState:N=>{a(_=>{if(N!==""){const E=m.find(S=>S.name===N);let L={...g,columnName:N};E.type!=="string"&&(L={...x,columnName:N}),he(_,`symbology.layers[${r.symbology.activeLayer}].${t}.${N}`,L)}}),n(N)},availableColumnNames:f})}function wD({params:t,path:s,filterSearchValue:n}){var y,j;const{pgEnv:r,falcor:a,falcorCache:l}=b.useContext(ce),{state:i,setState:c}=w.useContext(He),{activeColumn:d,setActiveColumn:u}=t,{viewId:p,sourceId:m}=b.useMemo(()=>({viewId:C(i,`symbology.layers[${i.symbology.activeLayer}].view_id`),sourceId:C(i,`symbology.layers[${i.symbology.activeLayer}].source_id`)}),[i]);b.useEffect(()=>{m&&a.get(["dama",r,"sources","byId",m,"attributes","metadata"])},[m]);const h=JSON.stringify({groupBy:[d.split("AS ")[0]],exclude:{[d.split("AS ")[0]]:["null"]}});b.useEffect(()=>{a.get(["dama",r,"viewsbyId",p,"options",h,"databyIndex",{from:0,to:500},[d,"count(1)::int as count"]])},[a,r,p,d]);const f=b.useMemo(()=>Object.values(C(l,["dama",r,"viewsbyId",p,"options",h,"databyIndex"],{})),[r,l]),g=b.useMemo(()=>{var N,_;return(_=(N=f==null?void 0:f.map(E=>E[d]))==null?void 0:N.filter(E=>typeof E=="string"&&E!=="null"))==null?void 0:_.filter(gD)},[f,d]);g.sort();const x=C(i,`symbology.layers[${i.symbology.activeLayer}].${s}`,t.default||((j=(y=t==null?void 0:t.options)==null?void 0:y[0])==null?void 0:j.value));return g==null?void 0:g.filter(N=>{var _,E;return(E=(_=N==null?void 0:N.toString())==null?void 0:_.toLowerCase())==null?void 0:E.includes(n.toString().toLowerCase())}).map((N,_)=>{const E=x==null?void 0:x.includes(N),L=E?"bg-pink-100":"";return e.jsx("div",{className:`${L} px-4 w-full text-sm hover:bg-pink-200 hover:cursor-pointer`,onClick:()=>c(S=>{const k=E?x.filter($=>$!==N):[...Array.isArray(x)?x:[],N];he(S,`symbology.layers[${i.symbology.activeLayer}].${s}`,k)}),children:e.jsxs("div",{className:"flex",children:[e.jsx("input",{readOnly:!0,type:"checkbox",checked:E}),e.jsx("div",{className:"truncate flex items-center text-[13px] px-4 py-1",children:N})]})},_)})}function ND(t){const{state:s,setState:n}=b.useContext(He),[r,a]=b.useState(!1),[l,i]=b.useState(),c=C(s,`symbology.layers[${s.symbology.activeLayer}].filter`);return e.jsxs("div",{className:"pb-4 w-full max-h-[calc(100vh_-_251px)] scrollbar-xs overflow-x-hidden overflow-y-auto",children:[e.jsx("div",{className:"w-full mt-1 mx-4 text-slate-500 text-[14px] tracking-wide min-h-[32px] flex items-center mx",children:"Filters"}),e.jsx("div",{className:"mx-4",children:e.jsx(yD,{removeFilter:d=>{i(null),a(!1),n(u=>{const p=Object.keys(c).reduce((m,h)=>(h!==d&&(m[h]=c[h]),m),{});he(u,`symbology.layers[${s.symbology.activeLayer}].filter`,p)})},activeColumn:l,setActiveColumn:i})}),e.jsx("div",{className:"m-4",children:e.jsx(We,{className:"p-1",themeOptions:{size:"sm",color:"transparent"},onClick:()=>{a(!0),i(null)},children:"Add Filter"})}),(l||r)&&e.jsx(vD,{path:"['filter']",params:{activeColumn:l,setActiveColumn:i}})]})}function CD(t){var l,i,c,d;const{state:s,setState:n}=w.useContext(He),r=b.useMemo(()=>{var u,p,m;return((m=(u=s==null?void 0:s.symbology)==null?void 0:u.layers)==null?void 0:m[(p=s==null?void 0:s.symbology)==null?void 0:p.activeLayer])||null},[s]),a=["Style","Legend","Popup","Filter"];return r&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-white/95 w-[312px] rounded-lg drop-shadow-lg pointer-events-auto min-h-[400px] max-h-[calc(100vh_-_161px)]  ",children:[e.jsxs("div",{className:"flex justify-between items-center border-b",children:[e.jsx("div",{className:"flex text-slate-700 p-2 ",children:e.jsx("input",{type:"text",className:"block w-[220px] border border-transparent hover:border-slate-200 outline-2 outline-transparent rounded-md bg-transparent py-1 px-2 text-slate-800 placeholder:text-gray-400 focus:outline-pink-300 sm:leading-6",placeholder:"Layer Name",value:(d=(c=(l=s==null?void 0:s.symbology)==null?void 0:l.layers)==null?void 0:c[(i=s==null?void 0:s.symbology)==null?void 0:i.activeLayer])==null?void 0:d.name,onChange:u=>n(p=>{p.symbology.activeLayer&&(p.symbology.layers[p.symbology.activeLayer].name=u.target.value)})})}),e.jsx("div",{className:"text-sm pt-1.5 px-1.5  hover:bg-slate-100 flex items-center",children:e.jsx(Nd,{location:"right-0",layer:r,button:e.jsx(yd,{className:" cursor-pointer group-hover:fill-gray-400 group-hover:hover:fill-pink-700"})})}),e.jsx("div",{onClick:()=>n(u=>{u.symbology.activeLayer=null}),className:"p-2.5 rounded hover:bg-slate-100 m-1 cursor-pointer",children:e.jsx(Ea,{className:"fill-slate-500"})})]}),e.jsx("div",{className:"min-h-20 relative",children:e.jsxs(mt.Group,{children:[e.jsx("div",{className:"flex justify-between items-center border-b",children:e.jsx(mt.List,{children:a.map(u=>e.jsx(mt,{as:b.Fragment,children:({selected:p})=>e.jsx("button",{className:`
                        ${p?"text-slate-600 border-b font-medium border-slate-600":"text-slate-400"} mx-1 text-sm p-2 cursor-pointer
                      `,children:u})},u))})}),e.jsxs(mt.Panels,{children:[e.jsx(mt.Panel,{children:e.jsx(Vb,{})}),e.jsx(mt.Panel,{children:e.jsx(hD,{})}),e.jsx(mt.Panel,{children:e.jsx(mD,{})}),e.jsx(mt.Panel,{children:e.jsx(ND,{})})]})]})})]})})}const _D=({maplibreMap:t,layer:s,layerProps:n,allLayerProps:r})=>{const a=b.useContext(PD),{state:l,setState:i}=a||{state:{},setState:()=>{}};b.useEffect(()=>()=>{s.layers.forEach(p=>{try{t&&t.getLayer(p.id)&&t.removeLayer(p.id)}catch{}})},[]);const c=t.getCenter(),d=t.getZoom();b.useEffect(()=>{l.setInitialBounds&&i(p=>{p.setInitialBounds=!1;const m={center:c,zoom:d};Fe(l.initialBounds,m)||(p.initialBounds=m)})},[t,l.setInitialBounds]);const u=Bb(n);b.useEffect(()=>{var m,h,f,g,x,y,j,N,_,E;if(((n==null?void 0:n["data-column"])!==(u==null?void 0:u["data-column"])||(n==null?void 0:n.filter)!==(u==null?void 0:u.filter))&&t.getSource((h=(m=n==null?void 0:n.sources)==null?void 0:m[0])==null?void 0:h.id)){let L=Ie((f=n.sources)==null?void 0:f[0]),S=(g=L.source.tiles)==null?void 0:g[0];S&&(L.source.tiles=[SD(S,n)]),(x=n==null?void 0:n.layers)==null||x.forEach($=>{t.getLayer($==null?void 0:$.id)&&t.getLayer($==null?void 0:$.id)&&t.removeLayer($==null?void 0:$.id)}),t.removeSource(L.id),t.getSource(L.id)?console.log("cant add",t.getSource(L.id)):t.addSource(L.id,L.source);let k=Object.values(r).find($=>($==null?void 0:$.order)===n.order+1);(y=n==null?void 0:n.layers)==null||y.forEach($=>{t.getLayer(k==null?void 0:k.id)?t.addLayer($,k==null?void 0:k.id):t.addLayer($)})}if((u==null?void 0:u.order)!==void 0&&(n==null?void 0:n.order)<(u==null?void 0:u.order)){let L=Object.values(r).find(S=>(S==null?void 0:S.order)===(n==null?void 0:n.order)+1);(j=n==null?void 0:n.layers)==null||j.forEach(S=>{t.getLayer(S==null?void 0:S.id)&&t.moveLayer(S==null?void 0:S.id,L==null?void 0:L.id)})}(N=n==null?void 0:n.layers)==null||N.forEach((L,S)=>{t.getLayer(L.id)&&Object.keys(L.paint).forEach(k=>{var $,I,T,A;Fe((T=(I=($=u==null?void 0:u.layers)==null?void 0:$[S])==null?void 0:I.paint)==null?void 0:T[k],(A=L==null?void 0:L.paint)==null?void 0:A[k])||t.setPaintProperty(L.id,k,L.paint[k])})}),(_=n==null?void 0:n.layers)==null||_.forEach((L,S)=>{t.getLayer(L.id)&&Object.keys((L==null?void 0:L.layout)||{}).forEach(k=>{var $,I,T,A;Fe((T=(I=($=u==null?void 0:u.layers)==null?void 0:$[S])==null?void 0:I.layout)==null?void 0:T[k],(A=L==null?void 0:L.layout)==null?void 0:A[k])||t.setLayoutProperty(L.id,k,L.layout[k])})});const{filter:p}=n;(E=n==null?void 0:n.layers)==null||E.forEach((L,S)=>{if(t.getLayer(L.id)&&p){const k=Object.keys(p).map($=>{let I=[];const T=p[$].operator,A=p[$].value,R=["get",$];return T==="between"?I=["all",[">=",["to-string",R],["to-string",A==null?void 0:A[0]]],["<=",["to-string",R],["to-string",A==null?void 0:A[1]]]]:["==","!="].includes(T)?(I=["in",R,["literal",A]],T==="!="&&(I=["!",I])):I=[T,["to-string",R],["to-string",A]],I});t.setFilter(L.id,["all",...k])}})},[n]),b.useEffect(()=>{var p;t&&r&&((p=r==null?void 0:r.zoomToFit)==null?void 0:p.length)>0&&t.fitBounds(r.zoomToFit,{duration:400})},[t,r==null?void 0:r.zoomToFit])},SD=(t,s)=>{var l;let n=t;const r=(s==null?void 0:s.filter)&&((l=Object.keys(s==null?void 0:s.filter))==null?void 0:l.length)>0,a=i=>i.includes(s==null?void 0:s["data-column"]);return n&&(s!=null&&s["data-column"]||r)&&(n!=null&&n.includes("?cols=")||(n+="?cols="),s!=null&&s["data-column"]&&!a(n)&&(n+=s==null?void 0:s["data-column"]),a(n)&&r&&(n+=","),r&&Object.keys(s.filter).forEach((i,c)=>{n+=`${i}`,c<Object.keys(s.filter).length-1&&(n+=",")})),n};class $D extends dd{constructor(){super(...arguments);ye(this,"onHover",{layers:this.layers.filter(n=>{var r;return((r=n==null?void 0:n.id)==null?void 0:r.indexOf("_case"))===-1}).map(n=>n.id),callback:(n,r,a)=>[r[0].id,n,(r[0]||{}).properties],Component:ED,isPinnable:this.isPinnable||!0});ye(this,"RenderComponent",_D)}}const ED=({data:t,layer:s})=>{if(!s.props.hover)return;const{source_id:n,view_id:r}=s,a=w.useContext(ce),l=w.useContext(ke),i=a!=null&&a.falcor?a:l,{pgEnv:c,falcor:d,falcorCache:u}=i,p=w.useMemo(()=>C(t,"[0]",null),[t]),m=w.useMemo(()=>s.props["hover-columns"],[s]);b.useEffect(()=>{n&&d.get(["dama",c,"sources","byId",n,"attributes","metadata"])},[n,m]);const h=w.useMemo(()=>{if(m)return m;{let y=C(u,["dama",c,"sources","byId",n,"attributes","metadata","value","columns"],[]);return y.length===0&&(y=C(u,["dama",c,"sources","byId",n,"attributes","metadata","value"],[])),y}},[n,u,m]),f=w.useMemo(()=>{let y=C(u,["dama",c,"sources","byId",n,"attributes","metadata","value","columns"],[]);return y.length===0&&(y=C(u,["dama",c,"sources","byId",n,"attributes","metadata","value"],[])),y},[n,u]);let g=(typeof(h==null?void 0:h[0])=="string"?h:h.map(y=>y.name||y.column_name)).filter(y=>!["wkb_geometry"].includes(y));w.useEffect(()=>{d.get(["dama",c,"viewsbyId",r,"databyId",p,g])},[d,c,r,p,h]);const x=w.useMemo(()=>C(u,["dama",c,"viewsbyId",r,"databyId",""+p],{}),[p,u,r,c]);return e.jsxs("div",{className:"bg-white p-4 max-h-64 max-w-lg min-w-[300px] scrollbar-xs overflow-y-scroll",children:[e.jsx("div",{className:"font-medium pb-1 w-full border-b ",children:(s==null?void 0:s.name)||""}),Object.keys(x).length===0&&h.length!==0?`Fetching Attributes ${p}`:"",Object.keys(x).filter(y=>typeof x[y]!="object").sort((y,j)=>{const N=(m==null?void 0:m.findIndex(E=>E.column_name===y))||0,_=(m==null?void 0:m.findIndex(E=>E.column_name===j))||0;return N-_}).map((y,j)=>{const N=h.find(L=>L.name===y||L.column_name===y)||{},_=f.find(L=>L.name===y||L.column_name===y)||{},E=JSON.parse((_==null?void 0:_.meta_lookup)||"{}");return N.name||N.display_name?e.jsxs("div",{className:"flex border-b pt-1",children:[e.jsx("div",{className:"flex-1 font-medium text-xs text-slate-400 pl-1",children:N.display_name||N.name}),e.jsx("div",{className:"flex-1 text-right text-sm font-thin pl-4 pr-1",children:(x==null?void 0:x[y])!=="null"?C(E,x==null?void 0:x[y],x==null?void 0:x[y]):""})]},j):e.jsx("span",{},j)})]})},He=b.createContext(void 0),Cd="mapeditor_symbology_",Ym=()=>{var S,k,$,I,T,A,R,O,M,D,P;const t=b.useRef(!1),{falcor:s,falcorCache:n,pgEnv:r,baseUrl:a}=w.useContext(ce);$e();const{symbologyId:l}=Ye();b.useEffect(()=>{async function F(){const B=["dama",r,"symbologies","byId",[l],"attributes",Object.values(lr)];await s.get(B)}l&&F()},[l,r]),b.useEffect(()=>{async function F(){const B=["dama",r,"symbologies","length"],V=await s.get(B),G=["dama",r,"symbologies","byIndex",{from:0,to:C(V.json,B,0)-1},"attributes",Object.values(lr)];await s.get(G)}F()},[l]);const i=b.useMemo(()=>Object.values(C(n,["dama",r,"symbologies","byIndex"],{})).map(F=>hd(C(n,F.value,{attributes:{}}).attributes)).filter(F=>Object.keys(F).length>0),[n,r]),c=b.useMemo(()=>i==null?void 0:i.find(F=>+F.symbology_id==+l),[i,l]);let d={name:"",description:"",symbology:{layers:{}}};const u=Cd+`${l}`,p=(S=window==null?void 0:window.localStorage)==null?void 0:S.getItem(u),m=p!=="undefined"?JSON.parse(p):null;m?d=m:c&&(d=c),(k=d==null?void 0:d.symbology)!=null&&k.layers&&Object.keys(($=d==null?void 0:d.symbology)==null?void 0:$.layers).length>0&&(((I=d==null?void 0:d.symbology)==null?void 0:I.activeLayer)===""||!(d!=null&&d.symbology.layers[(T=d==null?void 0:d.symbology)==null?void 0:T.activeLayer]))&&(d.symbology.activeLayer=(R=Object.values((A=d==null?void 0:d.symbology)==null?void 0:A.layers).find(F=>F.order===0))==null?void 0:R.id);const[h,f]=fo(d);b.useEffect(()=>{h.symbology_id&&+l!=+h.symbology_id&&f(d)},[d]),b.useEffect(()=>{var B;function F(){try{window.localStorage&&window.localStorage.setItem(u,JSON.stringify(h))}catch(V){console.error(V)}}(B=h==null?void 0:h.symbology)!=null&&B.layers&&!Fe(h,d)&&F()},[h==null?void 0:h.symbology,d]),b.useEffect(()=>{!m&&c&&f(c)},[i.length,c]);const[g,x]=fo([]);b.useEffect(()=>{(async()=>{t.current&&x(B=>{var H;let V=B.map(z=>z.id).filter(z=>z),G=Object.values(((H=h==null?void 0:h.symbology)==null?void 0:H.layers)||{}).filter(z=>z).filter(z=>!V.includes(z.id)).sort((z,W)=>W.order-z.order).map(z=>new $D(z));return[...B.filter(z=>{var W;return Object.keys(((W=h==null?void 0:h.symbology)==null?void 0:W.layers)||{}).includes(z.id)}),...G].sort((z,W)=>{var Y,U;return((Y=h.symbology.layers[W==null?void 0:W.id])==null?void 0:Y.order)-((U=h.symbology.layers[z==null?void 0:z.id])==null?void 0:U.order)})})})()},[(O=h==null?void 0:h.symbology)==null?void 0:O.layers,(M=h==null?void 0:h.symbology)==null?void 0:M.zoomToFit]);const y=b.useMemo(()=>{var F,B;return{...(F=h==null?void 0:h.symbology)==null?void 0:F.layers,zoomToFit:(B=h==null?void 0:h.symbology)==null?void 0:B.zoomToFit}},[(D=h==null?void 0:h.symbology)==null?void 0:D.layers,(P=h==null?void 0:h.symbology)==null?void 0:P.zoomToFit]),{activeLayerType:j,selectedInteractiveFilterIndex:N,currentInteractiveFilter:_}=b.useMemo(()=>{var B,V,G;const F=C(h,`symbology.layers[${(B=h==null?void 0:h.symbology)==null?void 0:B.activeLayer}]['selectedInteractiveFilterIndex']`);return{selectedInteractiveFilterIndex:F,activeLayerType:C(h,`symbology.layers[${(V=h==null?void 0:h.symbology)==null?void 0:V.activeLayer}]['layer-type']`,{}),currentInteractiveFilter:C(h,`symbology.layers[${(G=h==null?void 0:h.symbology)==null?void 0:G.activeLayer}]['interactive-filters'][${F}]`)}},[h==null?void 0:h.symbology.layers]);b.useEffect(()=>{j==="interactive"&&N!==void 0&&(()=>{f(B=>{var X,H,z,W;const V=B.symbology.layers[(X=B==null?void 0:B.symbology)==null?void 0:X.activeLayer],G=C(B,`symbology.layers[${(H=B==null?void 0:B.symbology)==null?void 0:H.activeLayer}]['interactive-filters']`),Z=C(B,`symbology.layers[${(z=B==null?void 0:B.symbology)==null?void 0:z.activeLayer}]['interactive-filters'][${N}]`);Z&&(B.symbology.layers[(W=B==null?void 0:B.symbology)==null?void 0:W.activeLayer]={...V,...Z,order:V.order,"layer-type":"interactive","interactive-filters":G,selectedInteractiveFilterIndex:N})})})()},[N,j,_]);const E=b.useMemo(()=>Object.values(h.symbology.layers).map(F=>F.selectedInteractiveFilterIndex),[h.symbology.layers]),L=Bb(E);return b.useEffect(()=>{f(F=>{Object.values(F.symbology.layers).filter(B=>B["layer-type"]==="interactive"&&B.id!==F.symbology.activeLayer).forEach(B=>{const V=C(B,"['interactive-filters']"),G=B.selectedInteractiveFilterIndex,Z=V[G];Z&&(F.symbology.layers[B.id]={...B,...Z,order:B.order,"layer-type":"interactive","interactive-filters":V,selectedInteractiveFilterIndex:G})})})},[Fe(E,L)]),e.jsx(He.Provider,{value:{state:h,setState:f,symbologies:i},children:e.jsxs("div",{className:"w-full h-full relative",ref:t,children:[e.jsx(md,{layers:g,layerProps:y,hideLoading:!0,showLayerSelect:!0,mapOptions:{center:[-76,43.3],zoom:6,maxPitch:60,protocols:[bb],styles:[{name:"Default",style:"https://api.maptiler.com/maps/dataviz/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Satellite",style:"https://api.maptiler.com/maps/hybrid/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Streets",style:"https://api.maptiler.com/maps/streets-v2/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Light",style:"https://api.maptiler.com/maps/dataviz-light/style.json?key=mU28JQ6HchrQdneiq6k9"},{name:"Dark",style:"https://api.maptiler.com/maps/dataviz-dark/style.json?key=mU28JQ6HchrQdneiq6k9"}]},leftSidebar:!1,rightSidebar:!1}),e.jsxs("div",{className:"absolute inset-0 flex pointer-events-none",children:[e.jsx(HP,{}),e.jsx("div",{className:"flex-1"}),e.jsx(CD,{})]})]})})},kD=({symbology:t,selectedSymbologyId:s,setSelectedSymbologyId:n,cat1:r,setCat1:a})=>{const l=s===t.symbology_id,i=Array.isArray(t==null?void 0:t.categories)?t==null?void 0:t.categories:[];return e.jsx("div",{children:e.jsx("div",{className:`w-full p-4 ${l?"bg-blue-100 hover:bg-blue-200":"bg-white hover:bg-blue-50"} block border shadow flex`,onClick:()=>{n(l?null:t.symbology_id)},children:e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-medium w-full block",children:e.jsx("span",{children:t.name})}),e.jsx("div",{children:i.map(c=>(typeof c=="string"?[c]:c).map((d,u)=>{const p=d===r;let m="bg-blue-100 text-blue-400 hover:bg-blue-400";return(l||p)&&(m="bg-blue-300 text-blue-500 hover:bg-blue-400",l&&p&&(m="bg-blue-400 text-blue-600 hover:bg-blue-500")),e.jsx("div",{onClick:h=>{h.stopPropagation(),a(p?"":d)},className:`inline hover:cursor-pointer text-xs p-1 px-2 ${m}  mr-2`,children:d},u)}))}),e.jsx("div",{className:"py-2 block",children:t.description})]})})})},LD=({selectedSymbologyId:t,setSelectedSymbologyId:s})=>{var E,L;const{falcorCache:n,pgEnv:r,baseUrl:a}=w.useContext(ce),{symbologies:l}=w.useContext(He),i=((L=(E=window.location.pathname.replace(`${a}/`,""))==null?void 0:E.split("/"))==null?void 0:L[0])==="listall",[c,d]=b.useState(""),[u,p]=b.useState(),[m,h]=b.useState(),[f,g]=b.useState("asc"),x="Unknown",y=[...new Set(l.filter(S=>{const k=Array.isArray(S==null?void 0:S.categories)?S==null?void 0:S.categories:[];return i||!i&&!(k!=null&&k.find($=>$.includes(x)))}).reduce((S,k)=>{let $=Array.isArray(k==null?void 0:k.categories)?k.categories:[];return[...S,...$.map(I=>I[0])||[]]},[]))].sort(),j=y.reduce((S,k)=>{var $;return S[k]=($=l.filter(I=>{var T;return(T=I.categories)==null?void 0:T.find(A=>A.includes(k))}))==null?void 0:$.length,S},{}),N=b.useMemo(()=>l.find(S=>S.symbology_id===t)??{},[r,n,t]),_="bg-transparent hover:bg-blue-100 rounded-sm p-2 ml-0.5 border-2";return e.jsxs(ss,{baseUrl:a,isListAll:i,hideBreadcrumbs:!0,children:[e.jsxs("div",{className:"py-4 flex flex-rows items-center",children:[e.jsx("input",{className:"w-full text-lg p-2 border border-gray-300 ",placeholder:"Search symbologies",value:c,onChange:S=>d(S.target.value)}),e.jsx("button",{className:_,title:"Toggle Sort",onClick:()=>g(f==="asc"?"desc":"asc"),children:e.jsx("i",{className:`fa-solid ${f==="asc"?"fa-arrow-down-z-a":"fa-arrow-down-a-z"} text-xl text-blue-400`})}),e.jsx("div",{onClick:()=>{p(""),d("")},className:_,title:i?"View Key Sources":"View All Sources",children:e.jsx("i",{className:`fa-solid ${i?"fa-filter-list":"fa-list-ul"} text-xl text-blue-400`})})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsxs("div",{className:"w-1/4 flex flex-col space-y-1.5 max-h-[65dvh] overflow-auto scrollbar-sm",children:[e.jsx(Px,{symbology:N,editingCategories:!!t,entityType:"symbologies"}),(y||[]).filter(S=>S!==x).sort((S,k)=>S.localeCompare(k)).map(S=>e.jsxs("div",{className:`${u===S||m===S?"bg-blue-100 hover:bg-blue-200":"bg-white hover:bg-blue-50"}  hover:cursor-pointer p-2 rounded-md flex items-center`,onClick:()=>{p(S===u?"":S)},children:[e.jsx("i",{className:"fa fa-category"}),S,e.jsx("div",{className:"bg-blue-200 text-blue-600 text-xs w-5 h-5 ml-2 shrink-0 grow-0 rounded-lg flex items-center justify-center border border-blue-300",children:j[S]})]},S))]}),e.jsx("div",{className:"w-3/4 flex flex-col space-y-1.5 ml-1.5 max-h-[65dvh] overflow-auto scrollbar-sm",children:l.filter(S=>{const k=Array.isArray(S==null?void 0:S.categories)?S==null?void 0:S.categories:[];return i||!i&&!(k!=null&&k.find($=>$.includes(x)))}).filter(S=>{let k=!0;return u&&(k=!1,(C(S,"categories",[])||[]).forEach($=>{$[0]===u&&(!m||$[1]===m)&&(k=!0)})),k}).filter(S=>{const k=Array.isArray(S==null?void 0:S.categories)?S==null?void 0:S.categories:[];let $=S.name+" "+(k||[]).reduce((I,T)=>(I+=Array.isArray(T)?T.join(" "):typeof T=="string"?T:"",I),"");return!c.length>2||$.toLowerCase().includes(c.toLowerCase())}).sort((S,k)=>{var I;return(f==="asc"?1:-1)*((I=S.name)==null?void 0:I.localeCompare(k.name))}).map((S,k)=>e.jsx(kD,{cat1:u,setCat1:p,symbology:S,baseUrl:a,selectedSymbologyId:t,setSelectedSymbologyId:s},k))})]})]})},ID=({modalState:t,setModalState:s})=>{const{baseUrl:n}=w.useContext(ce),r=$e();return e.jsx("div",{children:e.jsxs(Er,{open:t.open,setOpen:()=>s({...t,open:!t.open}),width:"w-[1200px]",children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fad fa-layer-group text-blue-600","aria-hidden":"true"})}),e.jsx("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full",children:e.jsx(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:"Select Symbology"})})]}),e.jsx("div",{className:"mt-2 ",children:e.jsx(LD,{selectedSymbologyId:t.symbologyId,setSelectedSymbologyId:a=>{s({...t,symbologyId:a})}})}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex justify-end",children:[e.jsx("div",{className:"mr-1",children:e.jsx(We,{type:"button",themeOptions:{color:"cancel"},onClick:()=>s(lc),children:"Cancel"})}),e.jsx("div",{children:e.jsx(We,{type:"button",themeOptions:t.symbologyId?{color:"primary"}:{color:"transparent"},disabled:!t.symbologyId,onClick:()=>{r(`${n}/mapeditor/${t.symbologyId}`),s(lc)},children:"Open Symbology"})})]})]})})};function TD({button:t,className:s}){const[n,r]=b.useState(!1);return e.jsxs("div",{onClick:()=>r(!0),className:s,children:[e.jsx(MD,{open:n,setOpen:r}),t]})}const oi={name:"",loading:!1};function MD({open:t,setOpen:s}){var h;const n=b.useRef(null),{pgEnv:r,falcor:a,baseUrl:l}=b.useContext(ce),{state:i,setState:c}=b.useContext(He),d=$e(),[u,p]=b.useState(oi),m=async()=>{var j,N;const f={name:u.name,description:"map",symbology:{layers:{}}};let g=await a.call(["dama","symbology","symbology","create"],[r,f]);const x=(N=(j=Object.values(C(g,["json","dama",r,"symbologies","byId"],{})).filter(_=>Object.keys(_).includes("attributes")))==null?void 0:j[0])==null?void 0:N.attributes;let{symbology_id:y}=x||!1;y&&(await a.invalidate(["dama",r,"symbologies","byIndex"],["dama",r,"symbologies","byId"],["dama",r,"symbologies","length"]),s(!1),c(x),p(oi),d(`${l}/mapeditor/${y}`))};return e.jsxs(Er,{open:t,setOpen:s,initialFocus:n,children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fad fa-layer-group text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full",children:[e.jsx(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:"Create New Map"}),e.jsx("div",{className:"mt-2 w-full",children:e.jsx("input",{value:u.name,onChange:f=>p({...i,name:f.target.value}),className:"p-2 bg-slate-100 text-lg font-medium w-full",placeholder:"Map Name"})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsxs("button",{type:"button",disabled:u.loading||((h=u.name)==null?void 0:h.length)<4,className:"disabled:bg-slate-300 disabled:cursor-warning inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto",onClick:m,children:["Creat",u.loading?"ing...":"e"]}),e.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>{s(!1),p(oi)},ref:n,children:"Cancel"})]})]})}function BD({button:t,className:s}){const[n,r]=b.useState(!1);return e.jsxs("div",{onClick:()=>r(!0),className:s,children:[e.jsx(AD,{open:n,setOpen:r}),t]})}const AD=({open:t,setOpen:s})=>{const{pgEnv:n,falcor:r,falcorCache:a,baseUrl:l}=b.useContext(ce),{symbologyId:i}=Ye(),c=$e(),d=async()=>{await r.call(["dama","symbology","symbology","delete"],[n,i]),await r.invalidate(["dama",n,"symbologies","byIndex"],["dama",n,"symbologies","byId",i],["dama",n,"symbologies","length"]);const u=Cd+`${i}`;window.localStorage.setItem(u,null),c(`${l}/mapeditor`)};return e.jsxs(Er,{open:t,setOpen:s,children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("i",{className:"fad fa-layer-group text-blue-600","aria-hidden":"true"})}),e.jsx("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full",children:e.jsx(Je.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900",children:"Delete Symbology"})})]}),e.jsx("div",{className:"flex items-center",children:"Are you sure you want to delete this symbology? This action cannot be undone."}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsx("div",{className:"px-1",children:e.jsx(We,{themeOptions:{size:"sm",color:"danger"},className:" capitalize",onClick:d,children:"Delete"})}),e.jsx("div",{className:"px-1",children:e.jsx(We,{themeOptions:{size:"sm",color:"transparent"},className:" capitalize",onClick:()=>s(!1),children:"Cancel"})})]})]})};function Er({open:t,setOpen:s,width:n="sm:my-8 sm:w-full sm:max-w-lg sm:p-6",initialFocus:r,children:a}){return e.jsx(Be.Root,{show:t,as:b.Fragment,children:e.jsxs(Je,{as:"div",className:"relative z-30 ",initialFocus:r,onClose:s,children:[e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),e.jsx("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:e.jsx("div",{onClick:()=>{s(!1)},className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:e.jsx(Be.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:e.jsx(Je.Panel,{className:`relative transform overflow-auto rounded-lg bg-white px-4 h-[calc(100vh_-_100px)] pb-4 pt-5 text-left shadow-xl transition-all ${n}`,children:a})})})})]})})}const lc={open:!1,symbologyId:null};function OD(){const{state:t,setState:s}=b.useContext(He),{symbologyId:n}=Ye(),[r,a]=b.useState(lc);return e.jsxs("div",{className:"p-1 flex",children:[e.jsxs("div",{className:"w-full px-1 flex bg-slate-100 border border-transparent hover:border-slate-300 group rounded-md shadow-sm ring-1 ring-inset ring-slate-100 focus-within:ring-2 focus-within:ring-inset focus-within:ring-pink-600 sm:max-w-md",children:[e.jsx("input",{type:"text",className:"block w-[220px] flex-1 outline-0  bg-transparent p-2 text-slate-800 placeholder:text-gray-400  focus:border-0  sm:leading-6",placeholder:"Select / Create New Map",value:t==null?void 0:t.name,onClick:n?void 0:()=>a({...r,open:!0}),onChange:i=>{s(c=>{he(c,"name",i.target.value)})}}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex  mr-2",children:e.jsx(TD,{className:"relative inline-block text-left",button:e.jsx(bd,{size:14,className:"cursor-pointer fill-none group-hover:fill-gray-400 group-hover:hover:fill-pink-700"})})}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex  mr-2",onClick:()=>a({...r,open:!0}),children:e.jsx(yP,{size:14,className:"cursor-pointer fill-none group-hover:fill-gray-400 group-hover:hover:fill-pink-700"})}),e.jsx("div",{className:"flex  mr-2",children:e.jsx(IP,{button:e.jsx(jP,{size:14,className:"cursor-pointer fill-none group-hover:fill-gray-400 group-hover:hover:fill-pink-700"})})}),e.jsx("div",{className:"flex",children:e.jsx(BD,{button:e.jsx(vP,{size:14,className:"cursor-pointer fill-none group-hover:fill-gray-400 group-hover:hover:fill-pink-700"})})})]})]})]}),e.jsx("div",{className:"flex items-center ml-1",children:e.jsx(ID,{className:" p-1 rounded hover:bg-slate-100 group",modalState:r,setModalState:a})})]})}const PD=b.createContext(void 0),ht=(t,s)=>{const{baseUrl:n="/datasources",defaultPgEnv:r="pan",useFalcor:a,useAuth:l}=s;return()=>{const{falcor:i,falcorCache:c}=a(),d=l();return e.jsx(ce.Provider,{value:{pgEnv:r,baseUrl:n,falcor:i,falcorCache:c,user:d},children:e.jsx(t,{})})}},DD=t=>{const{baseUrl:s="/datasources",defaultPgEnv:n="pan",authLevel:r=-1,components:a={},dataTypes:l={},navSettings:i={},useFalcor:c,useAuth:d}=t,{Head:u=sI,List:p=MI,View:m=xA,Create:h=bA,Del:f=wA}=a,{sideNav:g={size:"none"},topNav:x={size:"none"}}=i;return Object.keys(l).forEach(y=>fA(y,l[y])),[{name:"Data Sources",path:`${s}/`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(p,t)},{name:"Data Sources",path:`${s}/cat/:cat1`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(p,t)},{name:"Data Sources",path:`${s}/cat/:cat1/:cat2`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(p,t)},{name:"Data Sources",path:`${s}/listall`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(p,t)},{name:"Data Sources",path:`${s}/listall/cat/:cat1`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(p,t)},{name:"Data Sources",path:`${s}/listall/cat/:cat1/:cat2`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(p,t)},{name:"View Source",path:`${s}/source/:sourceId`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(m,t)},{name:"View Source",path:`${s}/source/:sourceId/:page`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(m,t)},{name:"View Source",path:`${s}/source/:sourceId/:page/:viewId`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(m,t)},{name:"View Source",path:`${s}/source/:sourceId/:page/:viewId/:vPage`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(m,t)},{name:"Create Source",path:`${s}/create/source`,exact:!0,authLevel:!1,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(h,t)},{name:"Delete Source",path:`${s}/delete/source/:sourceId`,exact:!0,authLevel:!0,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(f,t)},{name:"Data Collections",path:`${s}/mapeditor`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(Ym,t)},{name:"Data Collections",path:`${s}/mapeditor/:symbologyId`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(Ym,t)},{name:"Data Collections",path:`${s}/collections`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(ni,t)},{name:"Data Collections",path:`${s}/collections/cat/:cat1`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(ni,t)},{name:"Data Collections",path:`${s}/collections/cat/:cat1/:cat2`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(ni,t)},{name:"View Collection",path:`${s}/collection/:collectionId`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(Ur,t)},{name:"View Collection",path:`${s}/collection/:collectionId/:page`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(Ur,t)},{name:"View Symbology",path:`${s}/collection/:collectionId/:page/:symbologyId`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(Ur,t)},{name:"View Symbology",path:`${s}/collection/:collectionId/:page/:symbologyId/:sPage`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(Ur,t)},{name:"Create Collection",path:`${s}/create/collection`,exact:!0,authLevel:!1,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(XO,t)},{name:"Delete Collection",path:`${s}/delete/collection/:collectionId`,exact:!0,authLevel:!0,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(sP,t)},{name:"Tasks",path:`${s}/tasks`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(aP,t)},{name:"Task",path:`${s}/task/:etl_context_id`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(iP,t)},{name:"Settings",path:`${s}/settings`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(cP,t)},{name:"DMS List",path:`${s}/dmslist`,exact:!0,authLevel:r,mainNav:!1,Title:()=>e.jsx(pt,{baseUrl:s}),sideNav:g,topNav:x,component:ht(pP,t)}]};async function bt(t){if(!t.ok){let s=t.statusText;try{const{message:n}=await t.json();s=n}catch(n){console.error(n)}throw new Error(s)}}function vt(t){return`${Rt}/dama-admin/${t}`}const Ke=async({rtPfx:t,setVersions:s,type:n})=>{const r=new URL(`${t}/hazard_mitigation/versionSelectorUtils`);r.searchParams.append("type",n);const a=await fetch(r);await bt(a);const{sources:l,views:i}=await a.json();return s({sources:l,views:i}),{sources:l,views:i}},RD=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/disaster_declarations_summary_v2`);l.searchParams.append("table_name","disaster_declarations_summaries_v2"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},FD=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>RD({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:" Add New Source"})})},VD=({source:t})=>e.jsx("div",{children:" Table View "}),HD=({metadataActiveView:t,metadataCompareView:s,activeView:n,compareView:r,compareMode:a,views:l})=>(console.log("comes here",C(t,["countbymonth","value"],[]),t),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-2 sm:px-6 text-lg font-md",children:"Number of Disaster by Month"}),e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-11 sm:gap-1 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Month"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"volcaniceruption"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Flood"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Earthquake"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"severeicestorm"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Freezing"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Drought"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Tsunami"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Fire"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Typhoon"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Damleveebreak"})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:C(t,["countbymonth","value"],[]).map((i,c)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-11 sm:gap-1 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:i.month}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.volcaniceruption}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.flood}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.earthquake}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.severeicestorm}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.freezing}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.drought}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.tsunami}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.fire}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.typhoon}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.damleveebreak})]},c))})})]})})]})),zD=({metadataActiveView:t,metadataCompareView:s,activeView:n,compareView:r,compareMode:a,views:l})=>(console.log("comes here",C(t,["ddCount","value"],[]),t),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"Number of Disaster by Year"}),e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Year"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Disaster Count ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]}),a?e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Disaster Count ",`(${l.find(i=>i.view_id.toString()===r.toString()).version})`]}):null]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:C(t,["count","value"],[]).map((i,c)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:i.fy_declared}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.disaster_number})]},c))})})]})})]})),UD=({source:t,views:s})=>{const{falcor:n,falcorCache:r}=Na(),{pgEnv:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState(s[0].view_id),[u,p]=b.useState(void 0);b.useEffect(()=>{n.get(["dama",a,"sources","byId",t.source_id,"views","invalidate"],["disaster_declaration_summary",a,"source",t.source_id,"view",[l,c],["count","countbymonth"]])},[l,c,a,t.source_id,n]),console.log("fc?",r);const m=C(r,["disaster_declaration_summary",a,"source",t.source_id,"view",l]),h=C(r,["disaster_declaration_summary",a,"source",t.source_id,"view",c]);return console.log("md",m),!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsx(e.Fragment,{children:!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsxs(e.Fragment,{children:[e.jsx(zD,{metadataActiveView:m,metadataCompareView:h,activeView:l,compareView:c,compareMode:u,views:s}),e.jsx(HD,{metadataActiveView:m,metadataCompareView:h,activeView:l,compareView:c,compareMode:u,views:s})]})})},WD={map:{name:"Map",path:"/map",component:()=>e.jsx("div",{children:" No Map "})},stats:{name:"Stats",path:"/stats",component:UD},table:{name:"Table",path:"/table",component:VD},sourceCreate:{name:"Create",component:FD}},GD=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/fema_web_disaster_summaries_v1`);l.searchParams.append("table_name","fema_web_disaster_summaries_v1"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},JD=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>GD({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:" Add New Source"})})},qD=({source:t})=>e.jsx("div",{children:" Table View "}),KD=({metadataActiveView:t,metadataCompareView:s,activeView:n,compareView:r,compareMode:a,views:l})=>(console.log("comes here",C(t,["countbymonth","value"],[]),t),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-2 sm:px-6 text-lg font-md",children:"Number of Disaster by Month"}),e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-11 sm:gap-1 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Month"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"volcaniceruption"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Flood"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Earthquake"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"severeicestorm"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Freezing"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Drought"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Tsunami"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Fire"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Typhoon"}),e.jsx("dd",{className:"text-sm font-medium text-gray-600 ",children:"Damleveebreak"})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:C(t,["countbymonth","value"],[]).map((i,c)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-11 sm:gap-1 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:i.month}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.volcaniceruption}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.flood}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.earthquake}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.severeicestorm}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.freezing}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.drought}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.tsunami}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.fire}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.typhoon}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.damleveebreak})]},c))})})]})})]})),YD=({metadataActiveView:t,metadataCompareView:s,activeView:n,compareView:r,compareMode:a,views:l})=>(console.log("comes here",C(t,["ddCount","value"],[]),t),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"Number of Disaster by Year"}),e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Year"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Disaster Count ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]}),a?e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Disaster Count ",`(${l.find(i=>i.view_id.toString()===r.toString()).version})`]}):null]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:C(t,["count","value"],[]).map((i,c)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:i.fy_declared}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.disaster_number})]},c))})})]})})]})),ZD=({source:t,views:s})=>{const{falcor:n,falcorCache:r}=Na(),{pgEnv:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState(s[0].view_id),[u,p]=b.useState(void 0);b.useEffect(()=>{n.get(["dama",a,"sources","byId",t.source_id,"views","invalidate"],["disaster_declaration_summary",a,"source",t.source_id,"view",[l,c],["count","countbymonth"]])},[l,c,a,t.source_id,n]),console.log("fc?",r);const m=C(r,["disaster_declaration_summary",a,"source",t.source_id,"view",l]),h=C(r,["disaster_declaration_summary",a,"source",t.source_id,"view",c]);return console.log("md",m),!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsx(e.Fragment,{children:!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsxs(e.Fragment,{children:[e.jsx(YD,{metadataActiveView:m,metadataCompareView:h,activeView:l,compareView:c,compareMode:u,views:s}),e.jsx(KD,{metadataActiveView:m,metadataCompareView:h,activeView:l,compareView:c,compareMode:u,views:s})]})})},XD={map:{name:"Map",path:"/map",component:()=>e.jsx("div",{children:" No Map "})},stats:{name:"Stats",path:"/stats",component:ZD},table:{name:"Table",path:"/table",component:qD},sourceCreate:{name:"Create",component:JD}},qa=(t,s=2,n=!1)=>t>=1e12?`${n?"$":""} ${(t/1e12).toFixed(s)} T`:t>=1e9?`${n?"$":""} ${(t/1e9).toFixed(s)} B`:t>=1e6?`${n?"$":""} ${(t/1e6).toFixed(s)} M`:t>=1e3?`${n?"$":""} ${(t/1e3).toFixed(s)} K`:typeof t=="object"?"":`${n?"$":""} ${parseInt(t)}`,qe=(t,s=!1)=>(s?"$ ":"")+parseInt(t).toLocaleString(),QD=t=>{const s={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return t?new Date(t).toLocaleDateString(void 0,s):""},kr=(t,s)=>Array.from({length:s+1-t},(n,r)=>r+t),Ae=({value:t,setValue:s,versions:n,type:r})=>e.jsx("div",{className:"flex justify-between group",children:e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 py-5",children:["Select ",r," version:"]}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"pt-3 pr-8",children:e.jsxs("select",{className:"w-full bg-white p-3 flex-1 shadow bg-grey-50 focus:bg-blue-100  border-gray-300",value:t||"",onChange:a=>{s(a.target.value)},children:[e.jsx("option",{value:"",disabled:!0,children:"Select your option"},r),(n.views||n).sort((a,l)=>l.view_id-a.view_id).map(a=>e.jsxs("option",{value:a.view_id||a,className:`p-2 ${C(a,["metadata","authoritative"])==="true"?"font-bold":""}`,children:[C(a,"version")||a,a.view_id&&` (${a.view_id||""} ${QD(a._modified_timestamp)})`]},a.view_id||a))]})})})]})}),eR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a,viewNFIP:l,viewDDS:i,viewCounty:c})=>{const d=[l.view_id,i.view_id,c.view_id],u=new URL(`${t}/hazard_mitigation/nfip_v1_enhanced`);u.searchParams.append("table_name","fima_nfip_claims_v1_enhanced"),u.searchParams.append("source_name",n.name),u.searchParams.append("existing_source_id",n.source_id),u.searchParams.append("view_dependencies",JSON.stringify(d)),u.searchParams.append("version",r),u.searchParams.append("nfip_schema",l.table_schema),u.searchParams.append("nfip_table",l.table_name),u.searchParams.append("dds_schema",i.table_schema),u.searchParams.append("dds_table",i.table_name),u.searchParams.append("county_schema",c.table_schema),u.searchParams.append("county_table",c.table_name);const p=await fetch(u);await bt(p);const m=await p.json();console.log("res",m),a(`${s}/source/${m.payload.source_id}/versions`)},tR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a),[i,c]=w.useState(),[d,u]=w.useState(),[p,m]=w.useState(),[h,f]=w.useState({sources:[],views:[]}),[g,x]=w.useState({sources:[],views:[]}),[y,j]=w.useState({sources:[],views:[]});return w.useEffect(()=>{async function N(){await Ke({rtPfx:l,setVersions:f,type:"fima_nfip_claims_v1"}),await Ke({rtPfx:l,setVersions:x,type:"disaster_declarations_summaries_v2"}),await Ke({rtPfx:l,setVersions:j,type:"tl_county"})}N()},[l]),e.jsxs("div",{className:"w-full",children:[Ae({value:i,setValue:c,versions:h,type:"NFIP"}),Ae({value:d,setValue:u,versions:g,type:"Disaster Declarations Summary"}),Ae({value:p,setValue:m,versions:y,type:"County"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>eR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r,viewNFIP:h.views.find(N=>N.view_id===parseInt(i)),viewDDS:g.views.find(N=>N.view_id===parseInt(d)),viewCounty:y.views.find(N=>N.view_id===parseInt(p))}),children:" Add New Source"})]})},sR={sourceCreate:{name:"Create",component:tR}},nR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/ihp_v1`);l.searchParams.append("table_name","individuals_and_households_program_valid_registrations_v1"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("existing_view_id","484"),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},aR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>nR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:" Add New Source"})})},rR={sourceCreate:{name:"Create",component:aR}},oR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/pa_v1`);l.searchParams.append("table_name","public_assistance_funded_projects_details_v1"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},lR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>oR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:" Add New Source"})})},iR={sourceCreate:{name:"Create",component:lR}},cR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a,viewPa:l,viewDDS:i})=>{const c=[l.view_id,i.view_id],d=new URL(`${t}/hazard_mitigation/pa_v1_enhanced`);d.searchParams.append("table_name","pa_funded_projects_enhanced"),d.searchParams.append("source_name",n.name),d.searchParams.append("existing_source_id",n.source_id),d.searchParams.append("view_dependencies",JSON.stringify(c)),d.searchParams.append("version",r),d.searchParams.append("ofd_schema",l.table_schema),d.searchParams.append("pa_table",l.table_name),d.searchParams.append("dds_table",i.table_name);const u=await fetch(d);await bt(u);const p=await u.json();console.log("res",p),a(`${s}/source/${p.payload.source_id}/versions`)},dR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a),[i,c]=b.useState(),[d,u]=b.useState(),[p,m]=w.useState({sources:[],views:[]}),[h,f]=w.useState({sources:[],views:[]});return w.useEffect(()=>{async function g(){await Ke({rtPfx:l,setVersions:m,type:"public_assistance_funded_projects_details_v1"}),await Ke({rtPfx:l,setVersions:f,type:"disaster_declarations_summaries_v2"})}g()},[l]),e.jsxs("div",{className:"w-full",children:[Ae({value:i,setValue:c,versions:p,type:"PA"}),Ae({value:d,setValue:u,versions:h,type:"Disaster Declarations Summary"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>cR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r,viewPa:p.views.find(g=>g.view_id===parseInt(i)),viewDDS:h.views.find(g=>g.view_id===parseInt(d))}),children:" Add New Source"})]})},uR={sourceCreate:{name:"Create",component:dR}},mR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/hmgp_summaries_v2`);l.searchParams.append("table_name","hazard_mitigation_grant_program_disaster_summaries_v2"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},pR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>mR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:" Add New Source"})})},hR={sourceCreate:{name:"Create",component:pR}},fR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/hmgp_properties_v2`);l.searchParams.append("table_name","hazard_mitigation_assistance_mitigated_properties_v3"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},gR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>fR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:" Add New Source"})})},xR={sourceCreate:{name:"Create",component:gR}},bR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/hmgp_projects_v2`);l.searchParams.append("table_name","hazard_mitigation_assistance_projects_v3"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},yR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>bR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:" Add New Source"})})},vR={sourceCreate:{name:"Create",component:yR}},jR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a,viewHmgp:l,viewDDS:i})=>{const c=[l.view_id,i.view_id],d=new URL(`${t}/hazard_mitigation/hmgp_projects_v2_enhanced`);d.searchParams.append("table_name","hazard_mitigation_assistance_projects_enhanced"),d.searchParams.append("source_name",n.name),d.searchParams.append("existing_source_id",n.source_id),d.searchParams.append("view_dependencies",JSON.stringify(c)),d.searchParams.append("version",r),d.searchParams.append("ofd_schema",l.table_schema),d.searchParams.append("hmgp_table",l.table_name),d.searchParams.append("dds_table",i.table_name);const u=await fetch(d);await bt(u);const p=await u.json();console.log("res",p),a(`${s}/source/${p.payload.source_id}/versions`)},wR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a),[i,c]=b.useState(),[d,u]=b.useState(),[p,m]=w.useState({sources:[],views:[]}),[h,f]=w.useState({sources:[],views:[]});return w.useEffect(()=>{async function g(){await Ke({rtPfx:l,setVersions:m,type:"hazard_mitigation_assistance_projects_v3"}),await Ke({rtPfx:l,setVersions:f,type:"disaster_declarations_summaries_v2"})}g()},[l]),e.jsxs("div",{className:"w-full",children:[Ae({value:i,setValue:c,versions:p,type:"HMGP"}),Ae({value:d,setValue:u,versions:h,type:"Disaster Declarations Summary"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>jR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r,viewHmgp:p.views.find(g=>g.view_id===parseInt(i)),viewDDS:h.views.find(g=>g.view_id===parseInt(d))}),children:" Add New Source"})]})},NR={sourceCreate:{name:"Create",component:wR}},CR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/loadNCEI`);l.searchParams.append("table_name","details"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},_R=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>CR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:"Add New Source"})})},SR=({source:t})=>e.jsx("div",{children:" Table View "}),Zm=(t,s,n)=>e.jsx("select",{className:"w-40 pr-4 py-3 bg-white mr-2 flex items-center text-sm",value:s,onChange:r=>n(r.target.value),children:t.map((r,a)=>e.jsx("option",{value:r.view_id,className:"ml-2  truncate",children:r.version},a))}),$R=({source:t,views:s})=>{const{pgEnv:n,falcor:r,falcorCache:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState(s[0].view_id),[u,p]=b.useState(void 0);b.useEffect(()=>{r.get(["ncei_storm_events",n,"source",t.source_id,"view",[l,c],["numRows","eventsByYear","eventsByType"]])},[l,c,n,t.source_id,r]);const m=C(a,["ncei_storm_events",n,"source",t.source_id,"view",l]),h=C(a,["ncei_storm_events",n,"source",t.source_id,"view",c]);return!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("label",{children:"Current Version: "}),Zm(s,l,i),e.jsx("button",{className:`${u?"bg-red-50 hover:bg-red-400":"bg-blue-100 hover:bg-blue-600"}
                     hover:text-white align-right border-2 border-gray-100 p-2 hover:bg-gray-100`,disabled:s.length===1,onClick:()=>p(!u),children:u?"Discard":"Compare"})]},"versionSelector"),e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[u?e.jsx("label",{children:"Compare with Version: "}):null,u?Zm(s,c,d):null]},"compareVersionSelector"),e.jsx("div",{className:"overflow-hidden",children:e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-gray-600",children:"Total Number of Rows"}),e.jsxs("dt",{className:"text-sm text-gray-900",children:[C(m,["numRows","value"]),` (${s.find(f=>f.view_id.toString()===l.toString()).version})`]}),u?e.jsxs("dt",{className:"text-sm text-gray-900",children:[C(h,["numRows","value"]),` (${s.find(f=>f.view_id.toString()===c.toString()).version})`]}):null]})}),e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"Number of Rows/Events by Year"}),e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Year"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Count ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),u?e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Count ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}):null]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:C(m,["eventsByYear","value"],[]).map((f,g)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:f.year}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:f.num_events}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u?C(C(h,["eventsByYear","value"],[]).find(x=>x.year===f.year),"num_events"):null})]},g))})})]})}),e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"Number of Rows/Events by Type"}),e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Event Type"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Count ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),u?e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Count ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}):null]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:C(m,["eventsByType","value"],[]).map((f,g)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:f.event_type}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:f.num_events}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u?C(C(h,["eventsByType","value"],[]).find(x=>x.event_type===f.event_type),"num_events"):null})]},g))})})]})]})},ER={stats:{name:"Stats",path:"/stats",component:$R},table:{name:"Table",path:"/table",component:SR},sourceCreate:{name:"Create",component:_R}},kR=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a,startYear:l,endYear:i,viewNCEI:c={},viewZTC:d={},viewCousubs:u={},viewCounty:p={},viewState:m={},viewTract:h={}})=>{const f=[d.view_id,m.view_id,p.view_id,u.view_id,h.view_id,c.view_id],g=new URL(`${t}/hazard_mitigation/enhanceNCEI`);g.searchParams.append("table_name","details_enhanced"),g.searchParams.append("source_name",n.name),g.searchParams.append("existing_source_id",n.source_id),g.searchParams.append("view_dependencies",JSON.stringify(f)),g.searchParams.append("version",r),g.searchParams.append("start_year",l),g.searchParams.append("end_year",i),g.searchParams.append("ncei_schema",c.table_schema),g.searchParams.append("ncei_table",c.table_name),g.searchParams.append("tract_schema",h.table_schema),g.searchParams.append("tract_table",h.table_name),g.searchParams.append("ztc_schema",d.table_schema),g.searchParams.append("ztc_table",d.table_name),g.searchParams.append("state_schema",m.table_schema),g.searchParams.append("state_table",m.table_name),g.searchParams.append("county_schema",p.table_schema),g.searchParams.append("county_table",p.table_name),g.searchParams.append("cousub_schema",u.table_schema),g.searchParams.append("cousub_table",u.table_name);const x=await fetch(g);await bt(x);const y=await x.json();console.log("res",y),a(`${s}/source/${y.payload.source_id}/versions`)},LR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),[l,i]=w.useState(1996),[c,d]=w.useState(2019),u=kr(1996,new Date().getFullYear()).reverse(),[p,m]=w.useState(),[h,f]=w.useState(),[g,x]=w.useState(),[y,j]=w.useState(),[N,_]=w.useState(),[E,L]=w.useState(),[S,k]=w.useState({sources:[],views:[]}),[$,I]=w.useState({sources:[],views:[]}),[T,A]=w.useState({sources:[],views:[]}),[R,O]=w.useState({sources:[],views:[]}),[M,D]=w.useState({sources:[],views:[]}),[P,F]=w.useState({sources:[],views:[]}),B=vt(a);return w.useEffect(()=>{async function V(){await Ke({rtPfx:B,setVersions:k,type:"zone_to_county"}),await Ke({rtPfx:B,setVersions:I,type:"tl_cousub"}),await Ke({rtPfx:B,setVersions:A,type:"tl_tract"}),await Ke({rtPfx:B,setVersions:O,type:"tl_state"}),await Ke({rtPfx:B,setVersions:D,type:"tl_county"}),await Ke({rtPfx:B,setVersions:F,type:"ncei_storm_events"})}V()},[B]),e.jsxs("div",{className:"w-full",children:[Ae({value:l,setValue:i,versions:[l],type:"Start Year"}),Ae({value:c,setValue:d,versions:u,type:"End Year"}),Ae({value:E,setValue:L,versions:P,type:"NCEI Storm Events"}),Ae({value:p,setValue:m,versions:S,type:"Zone to County"}),Ae({value:y,setValue:j,versions:R,type:"State"}),Ae({value:N,setValue:_,versions:M,type:"County"}),Ae({value:h,setValue:f,versions:$,type:"Cousubs"}),Ae({value:g,setValue:x,versions:T,type:"Tracts"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>kR({rtPfx:B,baseUrl:n,source:t,startYear:l,endYear:c,viewNCEI:P.views.find(V=>V.view_id===parseInt(E)),viewZTC:S.views.find(V=>V.view_id===parseInt(p)),viewState:R.views.find(V=>V.view_id===parseInt(y)),viewCounty:M.views.find(V=>V.view_id===parseInt(N)),viewCousubs:$.views.find(V=>V.view_id===parseInt(h)),viewTract:T.views.find(V=>V.view_id===parseInt(g)),newVersion:s,navigate:r}),children:"Add New Source"})]})},Gr=t=>t&&(t>=1e9?`${(t/1e9).toFixed(3)} B`:t>=1e6?`${(t/1e6).toFixed(3)} M`:t>=1e3?`${(t/1e3).toFixed(3)} K`:`${t.toFixed(3)}`),Xm=(t,s,n)=>e.jsx("select",{className:"w-40 pr-4 py-3 bg-white mr-2 flex items-center text-sm",value:s,onChange:r=>n(r.target.value),children:t.map((r,a)=>e.jsx("option",{value:r.view_id,className:"ml-2  truncate",children:r.version},a))}),IR=({metadataActiveView:t,metadataCompareView:s,activeView:n,compareView:r,compareMode:a,views:l})=>e.jsx("div",{className:"overflow-hidden",children:e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-gray-600",children:"Total Number of Rows"}),e.jsxs("dt",{className:"text-sm text-gray-900",children:[C(t,["numRows","value"]),` (${l.find(i=>i.view_id.toString()===n.toString()).version})`]}),a?e.jsxs("dt",{className:"text-sm text-gray-900",children:[C(s,["numRows","value"]),` (${l.find(i=>i.view_id.toString()===r.toString()).version})`]}):null]})}),TR=({metadataActiveView:t,metadataCompareView:s,activeView:n,compareView:r,compareMode:a,views:l})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"Number of Rows/Events by Year"}),e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Year"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Count ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]}),a?e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Count ",`(${l.find(i=>i.view_id.toString()===r.toString()).version})`]}):null]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:C(t,["eventsByYear","value"],[]).map((i,c)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:i.year}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.num_events}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:a?C(C(s,["eventsByYear","value"],[]).find(d=>d.year===i.year),"num_events"):null})]},c))})})]})})]}),MR=({metadataActiveView:t,metadataCompareView:s,activeView:n,compareView:r,compareMode:a,views:l})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"Number of Rows/Events by Type"}),e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-7 sm:gap-4 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Event Type"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["total events ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["loss events ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["EAL buildings ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["EAL crop ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["EAL person ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["EAL Total ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:C(t,["eventsByType","value"],[]).map((i,c)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-7 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:i.event_type}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.total_events}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:i.loss_events}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:Gr(i.annual_property_damage)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:Gr(i.annual_crop_damage)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:Gr(i.annual_person_damage)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:Gr(i.annual_property_damage+i.annual_crop_damage+i.annual_person_damage)})]},c))})})]})]}),BR=({metadataActiveView:t,metadataCompareView:s,activeView:n,compareView:r,compareMode:a,views:l})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"Event Type Mapping"}),e.jsxs("div",{children:[e.jsxs("div",{className:`py-4 sm:py-2 sm:grid sm:grid-cols-${a?"7":"2"} sm:gap-4 sm:px-6 border-b-2`,children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"NRI Category"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Event Types ",a?`(${l.find(i=>i.view_id.toString()===n.toString()).version})`:null]}),a?e.jsx(e.Fragment,{children:e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Event Types ",`(${l.find(i=>i.view_id.toString()===r.toString()).version})`]})}):null]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:C(t,["eventsMappingToNRICategories","value"],[]).map((i,c)=>e.jsxs("div",{className:`py-4 sm:py-5 sm:grid sm:grid-cols-${a?"7":"2"} sm:gap-4 sm:px-6`,children:[e.jsx("dt",{className:"text-sm text-gray-900",children:i.nri_category}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:(i.event_types||[]).join(", ")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:a?(C(C(s,["eventsMappingToNRICategories","value"],[]).find(d=>d.nri_category===i.nri_category),"event_types")||[]).join(", "):null})]},c))})})]})]}),AR=({source:t,views:s})=>{const{pgEnv:n,falcor:r,falcorCache:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState(s[0].view_id),[u,p]=b.useState(void 0);b.useEffect(()=>{r.get(["dama",n,"sources","byId",t.source_id,"views","invalidate"],["ncei_storm_events_enhanced",n,"source",t.source_id,"view",[l,c],["numRows","eventsByYear","eventsByType","eventsMappingToNRICategories"]])},[l,c,n,t.source_id,r]),console.log("fc",a);const m=C(a,["ncei_storm_events_enhanced",n,"source",t.source_id,"view",l]),h=C(a,["ncei_storm_events_enhanced",n,"source",t.source_id,"view",c]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("label",{children:"Current Version: "}),Xm(s,l,i),e.jsx("button",{className:`${u?"bg-red-50 hover:bg-red-400":"bg-blue-100 hover:bg-blue-600"}
                     hover:text-white align-right border-2 border-gray-100 p-2 hover:bg-gray-100`,disabled:s.length===1,onClick:()=>p(!u),children:u?"Discard":"Compare"})]},"versionSelector"),e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[u?e.jsx("label",{children:"Compare with Version: "}):null,u?Xm(s,c,d):null]},"compareVersionSelector"),!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsxs(e.Fragment,{children:[e.jsx(IR,{metadataActiveView:m,metadataCompareView:h,activeView:l,compareView:c,compareMode:u,views:s}),e.jsx(BR,{metadataActiveView:m,metadataCompareView:h,activeView:l,compareView:c,compareMode:u,views:s}),e.jsx(MR,{metadataActiveView:m,metadataCompareView:h,activeView:l,compareView:c,compareMode:u,views:s}),e.jsx(TR,{metadataActiveView:m,metadataCompareView:h,activeView:l,compareView:c,compareMode:u,views:s})]})]})},OR=({source:t})=>e.jsx("div",{children:" Table View "}),PR={stats:{name:"Stats",path:"/stats",component:AR},table:{name:"Table",path:"/table",component:OR},sourceCreate:{name:"Create",component:LR}},DR=async({rtPfx:t,baseUrl:s,source:n,tigerTable:r,newVersion:a,navigate:l,setVar:i,setSourceValues:c})=>{const d=new URL(`${t}/hazard_mitigation/tigerDownloadAction`);d.searchParams.append("table_name",r),d.searchParams.append("source_name",n.name),d.searchParams.append("existing_source_id",n.source_id),d.searchParams.append("version",a);const u=await fetch(d);await bt(u);const{etl_context_id:p,source_id:m,isNewSource:h}=await u.json();h?l(m&&p?`/source/${m}/uploads/${p}`:`/source/${m}/versions`):(i(!1),c({etl_context_id:p,source_id:m}))},RR=({value:t,setValue:s,domain:n})=>e.jsx("div",{className:"flex justify-between group",children:e.jsxs("div",{className:"flex-1 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 py-5",children:["Select Type:"," "]}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"pt-3 pr-8",children:e.jsxs("select",{className:"w-full bg-white p-3 flex-1 shadow bg-grey-50 focus:bg-blue-100  border-gray-300",value:t||"",onChange:r=>{s(r.target.value)},children:[e.jsx("option",{value:"",disabled:!0,children:"Select your option"}),n==null?void 0:n.map(r=>e.jsx("option",{value:r,className:"p-2",children:r},r))]})})})]})}),FR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=b.useContext(ce),[l,i]=b.useState(),[c,d]=b.useState(!0),[u,p]=b.useState({etl_context_id:null,source_id:null}),m=vt(a);return e.jsxs("div",{className:"w-full",children:[RR({value:l,setValue:i,domain:["STATE","COUNTY","COUSUB","TRACT"]}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>DR({rtPfx:m,baseUrl:n,source:t,tigerTable:l,newVersion:s,navigate:r,setVar:d,setSourceValues:p}),disabled:!l,children:"Add New Source"}),c?null:e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{children:[" Source with type ",l," already created "]})," ",e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>{u!=null&&u.source_id&&(u!=null&&u.etl_context_id)?r(`/source/${u==null?void 0:u.source_id}/uploads/${u==null?void 0:u.etl_context_id}`):r(`/source/${u==null?void 0:u.source_id}`)},children:"Check Progress..."})]})]})},VR={sourceCreate:{name:"Create",component:FR}},HR=async({rtPfx:t,source:s,newVersion:n,navigate:r})=>{const a=new URL(`${t}/hazard_mitigation/tigerFullDownloadAction`);a.searchParams.append("source_name",s.name),a.searchParams.append("existing_source_id",s.source_id),a.searchParams.append("version",n);const l=await fetch(a);await bt(l);const{etl_context_id:i,source_id:c}=await l.json();c&&i&&r(`/source/${c}/uploads/${i}`)},zR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=b.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>HR({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:"Add New Source"})})},UR={sourceCreate:{name:"Create",component:zR}},WR=async({rtPfx:t,baseUrl:s,source:n,table:r,newVersion:a,navigate:l})=>{const i=new URL(`${t}/hazard_mitigation/usdaLoader`);i.searchParams.append("table_name",r),i.searchParams.append("source_name",n.name),i.searchParams.append("existing_source_id",n.source_id),i.searchParams.append("version",a);const c=await fetch(i);await bt(c);const d=await c.json();console.log("res",d),l(`${s}/source/${d.payload.source_id}/versions`)},GR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>WR({rtPfx:l,baseUrl:n,source:t,table:"usda_crop_insurance_cause_of_loss",newVersion:s,navigate:r}),children:" Add New Source"})})},JR={sourceCreate:{name:"Create",component:GR}},qR=async({rtPfx:t,baseUrl:s,source:n,table:r,newVersion:a,navigate:l,viewUSDA:i,viewDDS:c})=>{const d=[i.view_id,c.view_id],u=new URL(`${t}/hazard_mitigation/usda_enhanced`);u.searchParams.append("table_name",r),u.searchParams.append("source_name",n.name),u.searchParams.append("existing_source_id",n.source_id),u.searchParams.append("view_dependencies",JSON.stringify(d)),u.searchParams.append("version",a),u.searchParams.append("usda_schema",i.table_schema),u.searchParams.append("usda_table",i.table_name),u.searchParams.append("dds_schema",c.table_schema),u.searchParams.append("dds_table",c.table_name);const p=await fetch(u);await bt(p);const m=await p.json();console.log("res",m),l(`${s}/source/${m.payload.source_id}/versions`)},KR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a),[i,c]=w.useState(),[d,u]=w.useState(),[p,m]=w.useState({sources:[],views:[]}),[h,f]=w.useState({sources:[],views:[]});return w.useEffect(()=>{async function g(){await Ke({rtPfx:l,setVersions:m,type:"usda_crop_insurance_cause_of_loss"}),await Ke({rtPfx:l,setVersions:f,type:"disaster_declarations_summaries_v2"})}g()},[l]),e.jsxs("div",{className:"w-full",children:[Ae({value:i,setValue:c,versions:p,type:"USDA"}),Ae({value:d,setValue:u,versions:h,type:"Disaster Declarations Summary"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>qR({rtPfx:l,baseUrl:n,source:t,table:"usda_crop_insurance_cause_of_loss_enhanced",newVersion:s,navigate:r,viewUSDA:p.views.find(g=>g.view_id===parseInt(i)),viewDDS:h.views.find(g=>g.view_id===parseInt(d))}),children:" Add New Source"})]})},YR={sourceCreate:{name:"Create",component:KR}},ZR=async({rtPfx:t,baseUrl:s,source:n,viewCounty:r={},viewState:a={},table:l,newVersion:i,navigate:c})=>{const d=[a.view_id,r.view_id],u=new URL(`${t}/hazard_mitigation/sbaLoader`);u.searchParams.append("table_name",l),u.searchParams.append("source_name",n.name),u.searchParams.append("existing_source_id",n.source_id),u.searchParams.append("view_dependencies",JSON.stringify(d)),u.searchParams.append("version",i),u.searchParams.append("state_schema",a.table_schema),u.searchParams.append("state_table",a.table_name),u.searchParams.append("county_schema",r.table_schema),u.searchParams.append("county_table",r.table_name);const p=await fetch(u);await bt(p);const m=await p.json();console.log("res",m),c(`${s}/source/${m.payload.source_id}/versions`)},XR=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a),[i,c]=w.useState(),[d,u]=w.useState(),[p,m]=w.useState({sources:[],views:[]}),[h,f]=w.useState({sources:[],views:[]});return w.useEffect(()=>{async function g(){await Ke({rtPfx:l,setVersions:m,type:"tl_state"}),await Ke({rtPfx:l,setVersions:f,type:"tl_county"})}g()},[l]),e.jsxs("div",{className:"w-full",children:[Ae({value:i,setValue:c,versions:p,type:"State"}),Ae({value:d,setValue:u,versions:h,type:"County"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>ZR({rtPfx:l,baseUrl:n,source:t,viewState:p.views.find(g=>g.view_id===parseInt(i)),viewCounty:h.views.find(g=>g.view_id===parseInt(d)),table:"sba_disaster_loan_data_new",newVersion:s,navigate:r}),children:" Add New Source"})]})},QR={sourceCreate:{name:"Create",component:XR}},eF=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/nriLoader`);l.searchParams.append("table_name","nri"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},tF=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>eF({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:" Add New Source"})})},sF={sourceCreate:{name:"Create",component:tF}},nF=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a})=>{const l=new URL(`${t}/hazard_mitigation/nriTractsLoader`);l.searchParams.append("table_name","nri_tracts"),l.searchParams.append("source_name",n.name),l.searchParams.append("existing_source_id",n.source_id),l.searchParams.append("version",r);const i=await fetch(l);await bt(i);const c=await i.json();console.log("res",c),a(`${s}/source/${c.payload.source_id}/versions`)},aF=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),l=vt(a);return e.jsx("div",{className:"w-full",children:e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>nF({rtPfx:l,baseUrl:n,source:t,newVersion:s,navigate:r}),children:" Add New Source"})})},rF={sourceCreate:{name:"Create",component:aF}},oF=async({rtPfx:t,baseUrl:s,source:n,startYear:r,endYear:a,newVersion:l,navigate:i,viewNCEI:c={},viewNRI:d={}})=>{const u=[c.view_id,d.view_id],p=new URL(`${t}/hazard_mitigation/pbSWDLoader`);p.searchParams.append("table_name","per_basis_swd"),p.searchParams.append("source_name",n.name),p.searchParams.append("existing_source_id",n.source_id),p.searchParams.append("view_dependencies",JSON.stringify(u)),p.searchParams.append("version",l),p.searchParams.append("startYear",r),p.searchParams.append("endYear",a),p.searchParams.append("ncei_schema",c.table_schema),p.searchParams.append("ncei_table",c.table_name),p.searchParams.append("nri_schema",d.table_schema),p.searchParams.append("nri_table",d.table_name);const m=await fetch(p);await bt(m);const h=await m.json();console.log("res",h),i(`${s}/source/${h.payload.source_id}/versions`)},lF=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),[l,i]=w.useState(1996),[c,d]=w.useState(2019),u=kr(1996,new Date().getFullYear()).reverse(),[p,m]=w.useState(),[h,f]=w.useState(),[g,x]=w.useState({sources:[],views:[]}),[y,j]=w.useState({sources:[],views:[]}),N=vt(a);return w.useEffect(()=>{async function _(){await Ke({rtPfx:N,setVersions:x,type:"ncei_storm_events_enhanced"}),await Ke({rtPfx:N,setVersions:j,type:"nri"})}_()},[N]),e.jsxs("div",{className:"w-full",children:[Ae({value:l,setValue:i,versions:[l],type:"Start Year"}),Ae({value:c,setValue:d,versions:u,type:"End Year"}),Ae({value:p,setValue:m,versions:g,type:"NCEI Storm Events"}),Ae({value:h,setValue:f,versions:y,type:"NRI"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>oF({rtPfx:N,baseUrl:n,source:t,startYear:l,endYear:c,viewNCEI:g.views.find(_=>_.view_id===parseInt(p)),viewNRI:y.views.find(_=>_.view_id===parseInt(h)),newVersion:s,navigate:r}),children:"Add New Source"})]})},iF=({source:t})=>e.jsx("div",{children:" Table View "}),Qm=(t,s,n)=>{const r=useNavigate(),{sourceId:a,page:l}=useParams();return e.jsxs("select",{className:"w-40 pr-4 py-3 bg-white mr-2 flex items-center text-sm",value:s,onChange:i=>r(`/datasources/source/${a}/${l}/${i.target.value}`),children:[e.jsx("option",{selected:"true",disabled:"disabled",className:"ml-2  truncate",children:"Select a Version"},"select a version"),t.sort((i,c)=>c.view_id-i.view_id).map((i,c)=>e.jsx("option",{value:i.view_id,className:"ml-2  truncate",children:i.version},c))]})},cF=({source:t,views:s})=>{const{falcor:n,falcorCache:r}=Na(),{pgEnv:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState(s[0].view_id),[u,p]=b.useState(void 0);b.useEffect(()=>{n.get(["per_basis",a,"source",t.source_id,"view",[l,c],"stats"])},[l,c,a,t.source_id,n]);const m=C(r,["per_basis",a,"source",t.source_id,"view",l,"stats","value"],[]).sort((f,g)=>f.nri_category.localeCompare(g.nri_category)),h=C(r,["per_basis",a,"source",t.source_id,"view",c,"stats","value"],[]);return console.log("??",u),!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("label",{children:"Current Version: "}),Qm(s,l),e.jsx("button",{className:`${u?"bg-red-50 hover:bg-red-400":"bg-blue-100 hover:bg-blue-600"}
                     hover:text-white align-right border-2 border-gray-100 p-2 hover:bg-gray-100`,disabled:s.length===1,onClick:()=>p(!u),children:u?"Discard":"Compare"})]},"versionSelector"),e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[u?e.jsx("label",{children:"Compare with Version: "}):null,u?Qm(s,c):null]},"compareVersionSelector"),!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"By Type"}),e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-8 sm:gap-4 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Event Type"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Zero loss events ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Loss causing events ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Total events ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Buildings ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Crop ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Population ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Total ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Zero loss events ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Loss causing events ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Total events ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Buildings ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Crop ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Population ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Total ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:m.map((f,g)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-8 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:f.nri_category}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.num_events_zero_loss)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.num_events_with_loss)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.num_events_total)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.damage_buildings)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.damage_crop)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.damage_population)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.damage_total)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"num_events_zero_loss"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"num_events_with_loss"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"num_events_total"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"damage_buildings"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"damage_crop"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"damage_population"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"damage_total"))})]},g))})})]})]})]})},dF={stats:{name:"Stats",path:"/stats",component:cF},table:{name:"Table",path:"/table",component:iF},sourceCreate:{name:"Create",component:lF}},uF=async({rtPfx:t,baseUrl:s,source:n,startYear:r,endYear:a,newVersion:l,navigate:i,viewNCEI:c={},viewFusion:d={},viewNRI:u={}})=>{const p=[c.view_id,d.view_id,u.view_id],m=new URL(`${t}/hazard_mitigation/pbFusionLoader`);m.searchParams.append("table_name","per_basis_fusion"),m.searchParams.append("source_name",n.name),m.searchParams.append("existing_source_id",n.source_id),m.searchParams.append("view_dependencies",JSON.stringify(p)),m.searchParams.append("version",l),m.searchParams.append("startYear",r),m.searchParams.append("endYear",a),m.searchParams.append("ncei_schema",c.table_schema),m.searchParams.append("ncei_table",c.table_name),m.searchParams.append("fusion_schema",d.table_schema),m.searchParams.append("fusion_table",d.table_name),m.searchParams.append("nri_schema",u.table_schema),m.searchParams.append("nri_table",u.table_name);const h=await fetch(m);await bt(h);const f=await h.json();console.log("res",f),i(`${s}/source/${f.payload.source_id}/versions`)},mF=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),[l,i]=w.useState(1996),[c,d]=w.useState(2019),u=kr(1996,new Date().getFullYear()).reverse(),[p,m]=w.useState(),[h,f]=w.useState(),[g,x]=w.useState(),[y,j]=w.useState({sources:[],views:[]}),[N,_]=w.useState({sources:[],views:[]}),[E,L]=w.useState({sources:[],views:[]}),S=vt(a);return w.useEffect(()=>{async function k(){await Ke({rtPfx:S,setVersions:j,type:"ncei_storm_events_enhanced"}),await Ke({rtPfx:S,setVersions:_,type:"fusion"}),await Ke({rtPfx:S,setVersions:L,type:"nri"})}k()},[S]),e.jsxs("div",{className:"w-full",children:[Ae({value:l,setValue:i,versions:[l],type:"Start Year"}),Ae({value:c,setValue:d,versions:u,type:"End Year"}),Ae({value:p,setValue:m,versions:y,type:"NCEI Storm Events"}),Ae({value:h,setValue:f,versions:N,type:"Fusion"}),Ae({value:g,setValue:x,versions:E,type:"NRI"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>uF({rtPfx:S,baseUrl:n,source:t,startYear:l,endYear:c,viewNCEI:y.views.find(k=>k.view_id===parseInt(p)),viewFusion:N.views.find(k=>k.view_id===parseInt(h)),viewNRI:E.views.find(k=>k.view_id===parseInt(g)),newVersion:s,navigate:r}),children:"Add New Source"})]})},pF=({source:t})=>e.jsx("div",{children:" Table View "}),ep=(t,s,n)=>e.jsx("select",{className:"w-40 pr-4 py-3 bg-white mr-2 flex items-center text-sm",value:s,onChange:r=>n(r.target.value),children:t.map((r,a)=>e.jsx("option",{value:r.view_id,className:"ml-2  truncate",children:r.version},a))}),hF=({source:t,views:s})=>{const{falcor:n,falcorCache:r}=Na(),{pgEnv:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState(s[0].view_id),[u,p]=b.useState(void 0);b.useEffect(()=>{n.get(["per_basis",a,"source",t.source_id,"view",[l,c],"stats"])},[l,c,a,t.source_id,n]);const m=C(r,["per_basis",a,"source",t.source_id,"view",l,"stats","value"],[]).sort((f,g)=>f.nri_category.localeCompare(g.nri_category)),h=C(r,["per_basis",a,"source",t.source_id,"view",c,"stats","value"],[]);return console.log("??",u),!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("label",{children:"Current Version: "}),ep(s,l,i),e.jsx("button",{className:`${u?"bg-red-50 hover:bg-red-400":"bg-blue-100 hover:bg-blue-600"}
                     hover:text-white align-right border-2 border-gray-100 p-2 hover:bg-gray-100`,disabled:s.length===1,onClick:()=>p(!u),children:u?"Discard":"Compare"})]},"versionSelector"),e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[u?e.jsx("label",{children:"Compare with Version: "}):null,u?ep(s,c,d):null]},"compareVersionSelector"),e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"By Type"}),e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-8 sm:gap-4 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Event Type"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Zero loss events ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Loss causing events ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Total events ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Buildings ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Crop ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Population ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Total ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Zero loss events ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Loss causing events ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Total events ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Buildings ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Crop ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Population ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["Total ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:m.map((f,g)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-8 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:f.nri_category}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.num_events_zero_loss)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.num_events_with_loss)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.num_events_total)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.damage_buildings)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.damage_crop)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.damage_population)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.damage_total)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"num_events_zero_loss"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"num_events_with_loss"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"num_events_total"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"damage_buildings"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"damage_crop"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"damage_population"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"damage_total"))})]},g))})})]})]})},fF={stats:{name:"Stats",path:"/stats",component:hF},table:{name:"Table",path:"/table",component:pF},sourceCreate:{name:"Create",component:mF}},gF=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a,startYear:l,endYear:i,viewPB:c={},viewNRI:d={},viewState:u={},viewCounty:p={},viewNCEI:m={}})=>{const h=[c.view_id,d.view_id,u.view_id,p.view_id,m.view_id],f=new URL(`${t}/hazard_mitigation/hlrLoader`);f.searchParams.append("source_name",n.name),f.searchParams.append("existing_source_id",n.source_id),f.searchParams.append("view_dependencies",JSON.stringify(h)),f.searchParams.append("version",r),f.searchParams.append("startYear",l),f.searchParams.append("endYear",i),f.searchParams.append("table_name","hlr"),f.searchParams.append("pb_schema",c.table_schema),f.searchParams.append("pb_table",c.table_name),f.searchParams.append("nri_schema",d.table_schema),f.searchParams.append("nri_table",d.table_name),f.searchParams.append("state_schema",u.table_schema),f.searchParams.append("state_table",u.table_name),f.searchParams.append("county_schema",p.table_schema),f.searchParams.append("county_table",p.table_name),f.searchParams.append("ncei_schema",m.table_schema),f.searchParams.append("ncei_table",m.table_name);const g=await fetch(f);await bt(g);const x=await g.json();console.log("res",x),a(`${s}/source/${x.payload.source_id}/versions`)},xF=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),[l,i]=w.useState(1996),[c,d]=w.useState(2019),u=kr(1996,new Date().getFullYear()).reverse(),[p,m]=w.useState(),[h,f]=w.useState(),[g,x]=w.useState(),[y,j]=w.useState(),[N,_]=w.useState(),[E,L]=w.useState({sources:[],views:[]}),[S,k]=w.useState({sources:[],views:[]}),[$,I]=w.useState({sources:[],views:[]}),[T,A]=w.useState({sources:[],views:[]}),[R,O]=w.useState({sources:[],views:[]}),[M,D]=w.useState({sources:[],views:[]}),[P,F]=w.useState({sources:[],views:[]}),B=vt(a);return w.useEffect(()=>{async function V(){const G=await Ke({rtPfx:B,setVersions:L,type:"per_basis"}),Z=await Ke({rtPfx:B,setVersions:k,type:"per_basis_fusion"});return await Ke({rtPfx:B,setVersions:A,type:"nri"}),await Ke({rtPfx:B,setVersions:O,type:"tl_state"}),await Ke({rtPfx:B,setVersions:D,type:"tl_county"}),await Ke({rtPfx:B,setVersions:F,type:"ncei_storm_events_enhanced"}),{pb_swd:G,pb_fusion:Z}}V().then(({pb_swd:G,pb_fusion:Z})=>{console.log("???",{pb_swd:G,pb_fusion:Z}),I({sources:[...G.sources,...Z.sources],views:[...G.views,...Z.views]})})},[B]),e.jsxs("div",{className:"w-full",children:[Ae({value:l,setValue:i,versions:[l],type:"Start Year"}),Ae({value:c,setValue:d,versions:u,type:"End Year"}),Ae({value:p,setValue:m,versions:$,type:"PB Storm Events"}),Ae({value:h,setValue:f,versions:T,type:"NRI"}),Ae({value:g,setValue:x,versions:R,type:"State"}),Ae({value:y,setValue:j,versions:M,type:"County"}),Ae({value:N,setValue:_,versions:P,type:"NCEI Storm Events"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>gF({rtPfx:B,baseUrl:n,source:t,newVersion:s,startYear:l,endYear:c,viewPB:$.views.find(V=>V.view_id===parseInt(p)),viewNRI:T.views.find(V=>V.view_id===parseInt(h)),viewState:R.views.find(V=>V.view_id===parseInt(g)),viewCounty:M.views.find(V=>V.view_id===parseInt(y)),viewNCEI:P.views.find(V=>V.view_id===parseInt(N)),navigate:r}),children:"Add New Source"})]})},tp=(t,s,n)=>e.jsx("select",{className:"w-40 pr-4 py-3 bg-white mr-2 flex items-center text-sm",value:s,onChange:r=>n(r.target.value),children:t.map((r,a)=>e.jsx("option",{value:r.view_id,className:"ml-2  truncate",children:r.version},a))}),bF=({source:t,views:s})=>{const{falcor:n,falcorCache:r}=Na(),{pgEnv:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState(s[0].view_id),[u,p]=b.useState(void 0);b.useEffect(()=>{n.get(["dama",a,"sources","byId",t.source_id,"views","invalidate"],["hlr",a,"source",t.source_id,"view",[l,c],"eal"])},[l,c,a,t.source_id,n]),console.log("fc?",r);const m=C(r,["hlr",a,"source",t.source_id,"view",l,"eal","value"],[]),h=C(r,["hlr",a,"source",t.source_id,"view",c,"eal","value"],[]);return console.log("md",h),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("label",{children:"Current Version: "}),tp(s,l,i),e.jsx("button",{className:`${u?"bg-red-50 hover:bg-red-400":"bg-blue-100 hover:bg-blue-600"}
                     hover:text-white align-right border-2 border-gray-100 p-2 hover:bg-gray-100`,disabled:s.length===1,onClick:()=>p(!u),children:u?"Discard":"Compare"})]},"versionSelector"),e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[u?e.jsx("label",{children:"Compare with Version: "}):null,u?tp(s,c,d):null]},"compareVersionSelector"),!m||m.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 text-lg font-md",children:"EAL by Type"}),e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-7 sm:gap-4 sm:px-6 border-b-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Event Type"}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["buildings ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["crop ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["population ",u?`(${s.find(f=>f.view_id.toString()===l.toString()).version})`:null]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["buildings ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["crop ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]}),u&&e.jsxs("dd",{className:"text-sm font-medium text-gray-600 ",children:["population ",`(${s.find(f=>f.view_id.toString()===c.toString()).version})`]})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0 overflow-auto h-[700px]",children:e.jsx("dl",{className:"sm:divide-y sm:divide-gray-200",children:m.map((f,g)=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-7 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm text-gray-900",children:f.nri_category}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.swd_buildings)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.swd_crop)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:qe(f.swd_population)}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"swd_buildings"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"swd_crop"))}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 ",children:u&&qe(C(h.find(x=>x.nri_category===f.nri_category),"swd_population"))})]},g))})})]})]})]})},yF={stats:{name:"Stats",path:"/stats",component:bF},map:{name:"Map",path:"/map",component:()=>e.jsx("div",{children:" No Map "})},sourceCreate:{name:"Create",component:xF}},vF=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a,viewHlr:l={},viewNRI:i={}})=>{const c=[l.view_id,i.view_id],d=new URL(`${t}/hazard_mitigation/ealLoader`);d.searchParams.append("table_name","eal"),d.searchParams.append("source_name",n.name),d.searchParams.append("existing_source_id",n.source_id),d.searchParams.append("view_dependencies",JSON.stringify(c)),d.searchParams.append("version",r),d.searchParams.append("hlr_schema",l.table_schema),d.searchParams.append("hlr_table",l.table_name),d.searchParams.append("nri_schema",i.table_schema),d.searchParams.append("nri_table",i.table_name);const u=await fetch(d);await bt(u);const p=await u.json();console.log("res",p),a(`${s}/source/${p.payload.source_id}/versions`)},jF=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),[l,i]=w.useState(),[c,d]=w.useState(),[u,p]=w.useState({sources:[],views:[]}),[m,h]=w.useState({sources:[],views:[]}),f=vt(a);return w.useEffect(()=>{async function g(){await Ke({rtPfx:f,setVersions:p,type:"hlr"}),await Ke({rtPfx:f,setVersions:h,type:"nri"})}g()},[f]),e.jsxs("div",{className:"w-full",children:[Ae({value:l,setValue:i,versions:u,type:"hlr"}),Ae({value:c,setValue:d,versions:m,type:"NRI"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>vF({rtPfx:f,baseUrl:n,source:t,newVersion:s,viewHlr:u.views.find(g=>g.view_id===parseInt(l)),viewNRI:m.views.find(g=>g.view_id===parseInt(c)),navigate:r}),children:"Add New Source"})]})},wF=[ds(12,"Set3")],sp=(t,s,n)=>{const r=$e(),{sourceId:a,page:l}=Ye();return e.jsxs("select",{className:"w-40 pr-4 py-3 bg-white mr-2 flex items-center text-sm",value:s,onChange:i=>r(`/datasources/source/${a}/${l}/${i.target.value}`),children:[e.jsx("option",{selected:"true",disabled:"disabled",className:"ml-2  truncate",children:"Select a Version"},"select a version"),t.sort((i,c)=>c.view_id-i.view_id).map((i,c)=>e.jsx("option",{value:i.view_id,className:"ml-2  truncate",children:i.version},c))]})},NF=({chartComparativeStatsData:t=[]})=>{console.log("??",t);const s=Object.keys(t[0]||{});return console.log("cols",s),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row py-4 sm:py-2 sm:gap-4 sm:px-6 text-lg font-md",children:"All Stats"}),e.jsx("div",{className:"py-4 sm:py-2  sm:gap-4 sm:px-6 border-b-2 max-w-5xl",children:e.jsx(St,{columns:s.map(n=>({Header:n,accessor:n,Cell:r=>n==="nri_category"?r.value:qe(r.value),align:"left"})),data:t,pageSize:t.length})})]})},np=({data:t,keys:s,indexFormat:n,keyFormat:r,valueFormat:a})=>e.jsxs("div",{className:`
      flex flex-col px-2 pt-1 rounded bg-white
      ${s.length<=1?"pb-2":"pb-1"}`,children:[e.jsx("div",{className:"font-bold text-lg leading-6 border-b-2 mb-1 pl-2",children:n(C(t,"index",null))}),s.slice().filter(l=>t.key===l).reverse().map(l=>e.jsxs("div",{className:`
            flex items-center px-2 border-2 rounded transition
            ${t.key===l?"border-current":"border-transparent"}
          `,children:[e.jsx("div",{className:"mr-2 rounded-sm color-square w-5 h-5",style:{backgroundColor:C(t,["barValues",l,"color"],null),opacity:t.key===l?1:.2}}),e.jsxs("div",{className:"mr-4",children:[r(l),":"]}),e.jsx("div",{className:"text-right flex-1",children:a(C(t,["data",l],0))})]},l)),s.length<=1?null:e.jsxs("div",{className:"flex pr-2",children:[e.jsx("div",{className:"w-5 mr-2"}),e.jsx("div",{className:"mr-4 pl-2",children:"Total:"}),e.jsx("div",{className:"flex-1 text-right",children:a(s.reduce((l,i)=>l+C(t,["data",i],0),0))})]})]}),ap=t=>t.map(s=>({nri_category:s.nri_category,avail_eal:s.avail_eal,nri_eal:s.nri_eal,diff:(s.avail_eal-s.nri_eal)/s.nri_eal*100})),CF=({source:t,views:s})=>{var k;const{pgEnv:n,falcor:r,falcorCache:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState(s[0].view_id),[u,p]=b.useState(void 0),[m,h]=b.useState(void 0),f=["dama",n,"viewDependencySubgraphs","byViewId",l],g=($={})=>({...$,"sum(CASE \n                    WHEN coalesce(property_damage::double precision, 0) + coalesce(crop_damage::double precision, 0) + \n                         coalesce(injuries_direct::double precision, 0) + coalesce(injuries_indirect::double precision, 0) +\n                         coalesce(deaths_direct::double precision, 0) + coalesce(deaths_indirect::double precision, 0) > 0\n                    THEN 1\n                    ELSE 0\n		        END) as loss_events":"loss events","(sum(\n                    coalesce(property_damage::double precision, 0) + coalesce(crop_damage::double precision, 0) +\n                    \n                         (\n                             ((coalesce(injuries_direct::double precision, 0) + coalesce(injuries_indirect::double precision, 0)) / 10) +\n                             coalesce(deaths_direct::double precision, 0) + coalesce(deaths_indirect::double precision, 0)\n                         ) * 11600000 \n                )/ (max(year) - min(year))) / 1000000000 as damage":"damage"}),x=($=[])=>JSON.stringify({aggregatedLen:!0,filter:{year:kr(1996,2022)},exclude:{geoid:[null],...$.reduce((I,T)=>({...I,[T]:[null]}),{})},groupBy:$}),y=$=>["dama",n,"viewsbyId",$,"options"];b.useEffect(()=>{if(!l)return Promise.resolve();async function $(){const I=await r.get(f),T=C(I,["json",...f,"dependencies"],[]).find(M=>M.type==="ncei_storm_events_enhanced");h(T.view_id);const A=await r.get([...y(T.view_id),x(["event_type_formatted"]),"length"],[...y(T.view_id),x(["nri_category"]),"length"]),R=C(A,["json",...y(T.view_id),x(["event_type_formatted"]),"length"]),O=C(A,["json",...y(T.view_id),x(["nri_category"]),"length"]);await r.get([...y(T.view_id),x(["event_type_formatted"]),"databyIndex",{from:0,to:R-1},Object.keys(g({event_type_formatted:"event_type_formatted"}))],[...y(T.view_id),x(["nri_category"]),"databyIndex",{from:0,to:O-1},Object.keys(g({nri_category:"nri_category"}))],["comparative_stats",n,"byEalIds","source",t.source_id,"view",[l,c]],["ncei_storm_events_enhanced",n,"view",T.view_id,"normalized_event_count"])}$()},[l,c,r,t.source_id,n]);const j=Object.values(C(a,[...y(m),x(["event_type_formatted"]),"databyIndex"],{})),N=Object.values(C(a,[...y(m),x(["nri_category"]),"databyIndex"],{})),_=C(a,["ncei_storm_events_enhanced",n,"view",m,"normalized_event_count","value"],[]),E=C(a,["comparative_stats",n,"byEalIds","source",t.source_id,"view",l,"value"],[]),L=C(a,["comparative_stats",n,"byEalIds","source",t.source_id,"view",c,"value"],[]),S=ap(E);return ap(L),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("label",{children:"Current Version: "}),sp(s,l),e.jsx("button",{className:`${u?"bg-red-50 hover:bg-red-400":"bg-blue-100 hover:bg-blue-600"}
                     hover:text-white align-right border-2 border-gray-100 p-2 hover:bg-gray-100`,disabled:s.length===1,onClick:()=>p(!u),children:u?"Discard":"Compare"})]},"versionSelector"),e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[u?e.jsx("label",{children:"Compare with Version: "}):null,u?sp(s,c):null]},"compareVersionSelector"),!S||S.length===0?e.jsx("div",{children:" Stats Not Available "}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full p-4 my-1 block flex flex-col",style:{height:"400px"},children:[e.jsxs("label",{className:"text-lg",children:[" ",(k=s.find($=>$.view_id.toString()===l.toString()))==null?void 0:k.version," (SWD, NRI and AVAIL)"]},"nceiLossesTitle"),e.jsx("div",{className:"w-full px-5",children:e.jsx("div",{className:"flex justify-between w-1/4 float-right pr-12",children:["NCEI","NRI","AVAIL"].map(($,I)=>e.jsx("div",{style:{height:"20px",width:"20px",backgroundColor:wF[I]},children:e.jsx("label",{className:"p-2 pl-7",children:$})}))})}),e.jsx(ba,{data:E,keys:Object.keys(E[0]||{}).filter($=>$.includes("eal")||$.includes("annualized")),indexBy:"nri_category",axisBottom:{tickDensity:3,axisColor:"#000",axisOpacity:0},axisLeft:{format:$=>qa($,0),gridLineOpacity:.1,showGridLines:!0,ticks:5,axisColor:"#000",axisOpacity:0},paddingInner:.1,hoverComp:{HoverComp:np,valueFormat:qa},groupMode:"grouped"},"numEvents")]}),u?e.jsxs("div",{className:"w-full p-4 my-1 block flex flex-col",style:{height:"350px"},children:[e.jsxs("label",{className:"text-lg",children:[" EAL (SWD, NRI and AVAIL) ",s.find($=>$.view_id.toString()===c.toString()).version," "]},"nceiLossesTitle"),e.jsx(ba,{data:L,keys:Object.keys(L[0]||{}).filter($=>$.includes("eal")||$.includes("annualized")),indexBy:"nri_category",axisBottom:{tickDensity:3,axisColor:"#000",axisOpacity:0},axisLeft:{format:$=>qa($,0),gridLineOpacity:.1,showGridLines:!0,ticks:5,axisColor:"#000",axisOpacity:0},paddingInner:.1,hoverComp:{HoverComp:np,valueFormat:qa},groupMode:"grouped"},"numEvents")]}):null,e.jsx(NF,{chartComparativeStatsData:E}),e.jsx(St,{data:S,columns:Object.keys(S[0]||{}).map($=>({Header:$,accessor:$,Cell:I=>$==="diff"?`${((I==null?void 0:I.value)||0).toFixed(2)} %`:$==="nri_category"?I==null?void 0:I.value:qe((I==null?void 0:I.value)||0,!0),align:$==="nri_category"?"left":"right",sortType:"basic"})),sortBy:"diff",pageSize:18}),e.jsxs("div",{children:[e.jsx("label",{className:"w-full",children:"Moving Coastal to Hurricane"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/2",children:e.jsx(St,{data:j,columns:Object.keys((j==null?void 0:j[0])||{}).map($=>{const I=g({event_type_formatted:"Pre Coastal->Hurricane"})[$]||$;return{Header:I,accessor:$,align:$==="event_type_formatted"?"left":"right",Cell:T=>{var A,R;return $==="event_type_formatted"?T.value:I==="loss events"?(A=T.value)==null?void 0:A.toLocaleString():`$ ${(R=T.value)==null?void 0:R.toFixed(T.value<.009?4:2)} B`}}}),sortBy:"event_type_formatted",pageSize:18})}),e.jsx("div",{className:"w-1/2",children:e.jsx(St,{data:N,columns:Object.keys((N==null?void 0:N[0])||{}).map($=>{const I=g({nri_category:"Post Coastal->Hurricane"})[$]||$;return{Header:I,accessor:$,align:$==="nri_category"?"left":"right",Cell:T=>{var A,R;return $==="nri_category"?T.value:I==="loss events"?(A=T.value)==null?void 0:A.toLocaleString():`$ ${(R=T.value)==null?void 0:R.toFixed(T.value<.009?4:2)} B`}}}),sortBy:"nri_category",pageSize:18})})]}),e.jsxs("div",{children:["NCEI Enhanced Loss event counts (Consequence Normalized)",e.jsx(St,{data:_,columns:["nri_category","loss_events","total_events"].map($=>({Header:$.replace("_"," "),accessor:$,align:$==="nri_category"?"left":"right",Cell:T=>{var A;return $==="nri_category"?T.value:(A=T.value)==null?void 0:A.toLocaleString()}})),sortBy:"nri_category",pageSize:18})]})]})]})]})},_F={hail:{color:"#027B8E",name:"Hail",prefix:"hail"},winterweat:{color:"#76c8c8",name:"Snowstorm",prefix:"wntw"},icestorm:{color:"#98d1d1",name:"Ice Storm",prefix:"istm"},coldwave:{color:"#badbdb",name:"Coldwave",prefix:"cwav"},coastal:{color:"#54bebe",name:"Coastal",prefix:"cfld"},riverine:{color:"#115f9a",name:"Flooding",prefix:"rfld"},tsunami:{color:"#5e569b",name:"Tsunami",prefix:"tsun"},avalanche:{color:"#776bcd",name:"Avalanche",prefix:"avln"},tornado:{color:"#9080ff",name:"Tornado",prefix:"trnd"},lightning:{color:"#beb9db",name:"Lightning",prefix:"ltng"},wildfire:{color:"#ff1a40",name:"Wildfire",prefix:"wfir"},heatwave:{color:"#ff571a",name:"Heat Wave",prefix:"hwav"},volcano:{color:"#FF8066",name:"Volcano",prefix:"vlcn"},landslide:{color:"#786028",name:"Landslide",prefix:"lnds"},earthquake:{color:"#a57c1b",name:"Earthquake",prefix:"erqk"},drought:{color:"#d2980d",name:"Drought",prefix:"drgt"},hurricane:{color:"#ffb400",name:"Hurricane",prefix:"hrcn"},wind:{color:"#dedad2",name:"Wind",prefix:"swnd"}},rp=(t,s,n,r="view_id",a="version")=>e.jsx("select",{className:"w-40 pr-4 py-3 bg-white mr-2 flex items-center text-sm",value:s,onChange:l=>n(l.target.value),children:t.sort((l,i)=>i[r]-l[r]).map((l,i)=>e.jsx("option",{value:l[r],className:"ml-2  truncate",children:l[a]},i))}),SF=({source:t,views:s})=>{const{falcor:n,falcorCache:r,pgEnv:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState("hurricane"),u=Object.keys(_F).map(h=>({key:h,value:h}));b.useEffect(()=>{n.get(["comparative_stats",a,"byEalIds","source",t.source_id,"view",[l],"mega"])},[l,n,t.source_id,a]);const p=C(r,["comparative_stats",a,"byEalIds","source",t.source_id,"view",l,"mega","value"],[]).filter(h=>h.nri_category===c),m=Object.keys(p[0]||{}).map(h=>({Header:h,accessor:h,align:"left",filter:"text"}));return console.log(p),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("label",{children:"Current Version: "}),rp(s,l,i),rp(u,c,d,"value","key")]},"versionSelector"),e.jsx("div",{className:"max-w-6xl overflow-auto scrollbar-sm",children:e.jsx(St,{data:p,columns:m,pageSize:50})})]})};function $F(t){return t.slice().sort(function(s,n){return s-n})}function EF(t){for(var s=0,n,r=0;r<t.length;r++)(r===0||t[r]!==n)&&(n=t[r],s++);return s}function op(t,s){for(var n=[],r=0;r<t;r++){for(var a=[],l=0;l<s;l++)a.push(0);n.push(a)}return n}function ic(t,s,n,r){var a;if(t>0){var l=(n[s]-n[t-1])/(s-t+1);a=r[s]-r[t-1]-(s-t+1)*l*l}else a=r[s]-n[s]*n[s]/(s+1);return a<0?0:a}function cc(t,s,n,r,a,l,i){if(!(t>s)){var c=Math.floor((t+s)/2);r[n][c]=r[n-1][c-1],a[n][c]=c;var d=n;t>n&&(d=Math.max(d,a[n][t-1]||0)),d=Math.max(d,a[n-1][c]||0);var u=c-1;s<r[0].length-1&&(u=Math.min(u,a[n][s+1]||0));for(var p,m,h,f,g=u;g>=d&&(p=ic(g,c,l,i),!(p+r[n-1][d-1]>=r[n][c]));--g)m=ic(d,c,l,i),h=m+r[n-1][d-1],h<r[n][c]&&(r[n][c]=h,a[n][c]=d),d++,f=p+r[n-1][g-1],f<r[n][c]&&(r[n][c]=f,a[n][c]=g);cc(t,c-1,n,r,a,l,i),cc(c+1,s,n,r,a,l,i)}}function kF(t,s,n){for(var r=s[0].length,a=new Array(r),l=new Array(r),i=t[Math.floor(r/2)],c=0;c<r;++c)c===0?(a[0]=t[0]-i,l[0]=(t[0]-i)*(t[0]-i)):(a[c]=a[c-1]+t[c]-i,l[c]=l[c-1]+(t[c]-i)*(t[c]-i)),s[0][c]=ic(0,c,a,l),n[0][c]=0;for(var d,u=1;u<s.length;++u)u<s.length-1?d=u:d=r-1,cc(d,r-1,u,s,n,a,l)}function LF(t,s){if(s>t.length)throw new Error("Cannot generate more classes than there are data values");var n=t.length,r=$F(t),a=EF(r);if(a===1)return[r[0]];s=Math.min(a,s);var l=op(s,n),i=op(s,n);kF(r,l,i);for(var c=[],d=i[0].length-1,u=i.length-1;u>=0;u--){var p=i[u][d];c[u]=r[p],u>0&&(d=p-1)}return c}const lp=["avail_eal","nri_eal","diff"],li={ctype:{name:"Consequence",format:t=>t},geoid:{name:"geoid",format:t=>t},region:{name:"region",format:t=>t},nri_category:{name:"Hazard",format:t=>t},va_n:{name:"National Variance",format:t=>t==null?void 0:t.toFixed(9)},va_r:{name:"Regional Variance",format:t=>t==null?void 0:t.toFixed(9)},va_s:{name:"Surrounding Variance",format:t=>t==null?void 0:t.toFixed(9)},va_c:{name:"County Variance",format:t=>t==null?void 0:t.toFixed(9)},av_n:{name:"National Average",format:t=>t==null?void 0:t.toFixed(9)},av_r:{name:"Regional Average",format:t=>t==null?void 0:t.toFixed(9)},av_s:{name:"Surrounding Average",format:t=>t==null?void 0:t.toFixed(9)},av_c:{name:"County Average",format:t=>t==null?void 0:t.toFixed(9)},wt_n:{name:"National Weight",format:t=>t==null?void 0:t.toFixed(9)},wt_r:{name:"Regional Weight",format:t=>t==null?void 0:t.toFixed(9)},wt_s:{name:"Surrounding Weight",format:t=>t==null?void 0:t.toFixed(9)},wt_c:{name:"County Weight",format:t=>t==null?void 0:t.toFixed(9)},hlr_n:{name:"National HLR",format:t=>t==null?void 0:t.toFixed(9)},hlr_r:{name:"Regional HLR",format:t=>t==null?void 0:t.toFixed(9)},hlr_s:{name:"Surrounding HLR",format:t=>t==null?void 0:t.toFixed(9)},hlr_c:{name:"County HLR",format:t=>t==null?void 0:t.toFixed(9)},hlr:{name:"HLR",format:t=>t==null?void 0:t.toFixed(9)},national_percent_hazard:{name:"National %",format:t=>t==null?void 0:t.toFixed(3)},state_percent_hazard:{name:"State %",format:t=>t==null?void 0:t.toFixed(3)},avail_eal:{name:"AVAIL EAL",format:t=>qe(t)},nri_eal:{name:"NRI EAL",format:t=>qe(t)},diff:{name:"% Differance (AVAIL vs NRI)",format:t=>t==null?void 0:t.toFixed(3)}};class IF extends ml{constructor(n){super(n);ye(this,"name","EAL");ye(this,"id","ealpd");ye(this,"data",[]);ye(this,"dataSRC","byHaz");ye(this,"filters",{hazard:{name:"Hazard",type:"dropdown",multi:!1,value:"hurricane",domain:["avalanche","coastal","coldwave","drought","earthquake","hail","heatwave","hurricane","icestorm","landslide","lightning","riverine","tornado","tsunami","volcano","wildfire","wind","winterweat"]},compare:{name:"compare",type:"dropdown",multi:!1,value:"avail_eal",domain:[{key:"avail_eal",label:"Avail EAL"},{key:"nri_eal",label:"NRI EAL"},{key:"diff",label:"% Difference"}],valueAccessor:n=>n.key,accessor:n=>n.label}});ye(this,"legend",{Title:({layer:n})=>`Expected Annual Loss by ${C(n.filters.hazard,"value","").toUpperCase()} in $`,domain:[],range:ds(9,"RdYlGn",!1),show:!0});ye(this,"onHover",{layers:["counties","events"],HoverComp:({data:n,layer:r})=>e.jsx("div",{style:{maxHeight:"300px"},className:"rounded relative px-1 overflow-auto scrollbarXsm bg-white",children:n.map((a,l)=>e.jsx("div",{className:"flex",children:a.map((i,c)=>e.jsx("div",{className:`
                    ${c===0?"flex-1 font-bold":"overflow-auto scrollbarXsm"}
                    ${a.length>1&&c===0?"mr-4":""}
                    ${a.length===1&&c===0?`border-b-2 text-lg ${l>0?"mt-1":""}`:""}
                    `,children:i},c))},l))}),callback:(n,r,a)=>r.reduce((l,i)=>{let{hazard:c,paintKey:d}=this.props,u=this.data[this.dataSRC].find(m=>c!=="all"?m.nri_category===c&&m.geoid===i.properties.geoid:m.geoid===i.properties.geoid);return[[i.properties.geoid,""],...Object.keys(u||{}).filter(m=>li[m]).map(m=>{var h,f;return[((h=li[m])==null?void 0:h.name)||m,(f=li[m])==null?void 0:f.format(C(u,m))]})]},[])});ye(this,"sources",[{id:"counties",source:{type:"vector",url:"https://dama-dev.availabs.org/tiles/data/hazmit_dama_s344_v694_1686676399487.json"}}]);ye(this,"layers",[{id:"counties",source:"counties","source-layer":"s344_v694",type:"fill"},{id:"counties-line",source:"counties","source-layer":"s344_v694",type:"line",paint:{"line-width":["interpolate",["linear"],["zoom"],4,.5,22,1],"line-color":"#ccc","line-opacity":.5}}])}init(n,r,a){n.fitBounds([-125.0011,24.9493,-66.9326,49.5904])}onFilterChange(n,r,a,l){switch(n){case"hazard":this.dataSRC=r==="all"?"allHaz":"byHaz"}}fetchData(n,r){console.log("fetchData",this.props);const a=229;let{hazard:l,paintKey:i,consequence:c,viewId:d,pgEnv:u}=this.props;const p=["dama",u,"viewDependencySubgraphs","byViewId",d],m=["ctype","geoid","region","surrounding","nri_category","va_n","av_n","va_r","av_r","va_c","av_c","va_s","av_s","wt_n","hlr_n","wt_r","hlr_r","wt_c","hlr_c","wt_s","hlr_s","hlr"],h=JSON.stringify({filter:{nri_category:[l],ctype:[c==="All"?"buildings":c]}}),f=g=>["dama",u,"viewsbyId",g,"options",h];return n.get(["comparative_stats",u,"byEalIds","source",a,"view",d,"byGeoid","all"],p).then(async g=>{let x=[];if(!lp.includes(i)){c==="All"&&(c="buildings"),console.log("fetching for",i,c);const j=C(g,["json",...p,"dependencies"],[]).find(E=>E.type==="hlr"),N=await n.get([...f(j.view_id),"length"]),_=C(N,["json",...f(j.view_id),"length"]);if(_){const E=await n.get([...f(j.view_id),"databyIndex",{from:0,to:_-1},m]);x=Object.values(C(E,["json",...f(j.view_id),"databyIndex"],{}))}console.log("!!!",x)}this.data={byHaz:lp.includes(i)?C(g,["json","comparative_stats",u,"byEalIds","source",a,"view",d,"byGeoid","all"],[]).filter(y=>y.nri_category===l):x}})}getColorScale(n){return n.length||(n=[0,25,50,75,100]),this.legend.range=ds(9,"Oranges",!1),this.props.paintKey==="max_wt"?(this.legend.domain=["National","Regional","Surrounding","County"],this.legend.range=ds(4,"RdYlGn",!1),this.legend.type="ordinal",this.legend.format=null,r=>r==="wt_n"?this.legend.range[0]:r==="wt_r"?this.legend.range[1]:r==="wt_s"?this.legend.range[2]:r==="wt_c"?this.legend.range[3]:"#000"):(this.props.paintKey==="diff"&&(this.legend.range=ds(9,"RdYlGn",!1),n=[-100,-75,-50,-25,0,50,100,500,1e3]),this.legend.domain=LF(n,Math.min(n.length,this.legend.range.length)),this.legend.type="threshold",this.legend.format="0.2s",ps().domain(this.legend.domain).range(this.legend.range))}handleMapFocus(n){n.fitBounds([-125.0011,24.9493,-66.9326,49.5904])}paintMap(n){let{hazard:r,paintKey:a}=this.props;const l=({wt_n:p,wt_r:m,wt_s:h,wt_c:f})=>Math.max(p,m,h,f),i=(p,m)=>Object.keys(p).filter(h=>["wt_n","wt_r","wt_s","wt_c"].includes(h)).find(h=>p[h]===m),c=p=>a==="max_wt"?i(p,l(p)):p[a],d=this.getColorScale(this.data[this.dataSRC].filter(p=>r!=="all"?p.nri_category===r:!0).map(p=>c(p)).filter(p=>p));let u={};this.data[this.dataSRC].filter(p=>r!=="all"?p.nri_category===r:!0).forEach(p=>{u[p.geoid]=p[a]||a==="max_wt"?d(c(p)):"rgb(0,0,0)"}),console.log("painting...",u),n.setPaintProperty("counties","fill-color",["get",["get","geoid"],["literal",u]])}render(n,r){this.handleMapFocus(n),this.paintMap(n)}}const TF=(t={})=>new IF(t),MF=["avalanche","coastal","coldwave","drought","earthquake","hail","heatwave","hurricane","icestorm","landslide","lightning","riverine","tornado","tsunami","volcano","wildfire","wind","winterweat"],BF=["avail_eal","nri_eal","diff","wt_n","wt_r","wt_s","wt_c","max_wt","hlr_r","hlr"],AF=["buildings","crop","population"],OF=({views:t})=>{const{viewId:s,sourceId:n,page:r}=Ye(),a=$e(),{baseUrl:l}=w.useContext(ce);return console.log("ViewSelector",l),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("div",{className:"py-3.5 px-2 text-sm text-gray-400",children:"Version : "}),e.jsx("div",{className:"flex-1",children:e.jsx("select",{className:"pl-3 pr-4 py-2.5 border border-blue-100 bg-blue-50 w-full bg-white mr-2 flex items-center justify-between text-sm",value:s,onChange:i=>a(`${l}/source/${n}/${r}/${i.target.value}`),children:t.sort((i,c)=>c.view_id-i.view_id).map((i,c)=>e.jsx("option",{className:"ml-2  truncate",value:i.view_id,children:i.version?i.version:i.view_id},c))})})]})},PF=({source:t,views:s})=>{var f;const[n,r]=w.useState("hurricane"),[a,l]=w.useState("avail_eal"),[i,c]=w.useState(["avail_eal","nri_eal","diff"].includes(a)?"All":"buildings"),{falcor:d,pgEnv:u}=w.useContext(ce);let{viewId:p}=Ye();p||(p=(f=s==null?void 0:s[(s==null?void 0:s.length)-1])==null?void 0:f.view_id);const m=b.useMemo(()=>[TF()],[]),h={[m[0].id]:{hazard:n,paintKey:a,consequence:i,viewId:p,pgEnv:u}};return e.jsxs("div",{className:"w-full h-[700px]",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex flex-1",children:[e.jsx("div",{className:"py-3.5 px-2 text-sm text-gray-400",children:"Hazard : "}),e.jsx("div",{className:"flex-1",children:e.jsx("select",{className:"pl-3 pr-4 py-2.5 border border-blue-100 bg-blue-50 w-full bg-white mr-2 flex items-center justify-between text-sm",value:n,onChange:g=>r(g.target.value),children:MF.map((g,x)=>e.jsx("option",{className:"ml-2  truncate",value:g,children:g},x))})})]}),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("div",{className:"py-3.5 px-2 text-sm text-gray-400",children:"Display : "}),e.jsx("div",{className:"flex-1",children:e.jsx("select",{className:"pl-3 pr-4 py-2.5 border border-blue-100 bg-blue-50 w-full bg-white mr-2 flex items-center justify-between text-sm",value:a,onChange:g=>l(g.target.value),children:BF.map((g,x)=>e.jsx("option",{className:"ml-2  truncate",value:g,children:g},x))})})]}),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("div",{className:"py-3.5 px-2 text-sm text-gray-400",children:"Consequence : "}),e.jsx("div",{className:"flex-1",children:e.jsx("select",{className:"pl-3 pr-4 py-2.5 border border-blue-100 bg-blue-50 w-full bg-white mr-2 flex items-center justify-between text-sm",value:i,onChange:g=>c(g.target.value),children:(["avail_eal","nri_eal","diff"].includes(a)?["All"]:AF).map((g,x)=>e.jsx("option",{className:"ml-2  truncate",value:g,children:g},x))})})]}),e.jsx("div",{children:e.jsx(OF,{views:s})})]}),e.jsx(ul,{falcor:d,mapOptions:{zoom:6.2,center:[-75.95,42.89]},layers:m,CustomSidebar:()=>e.jsx("div",{}),layerProps:h})]})},DF={stats:{name:"Stats",path:"/stats",component:CF},map:{name:"Map",path:"/map",component:PF},table:{name:"Table",path:"/table",component:SF},sourceCreate:{name:"Create",component:jF}},RF=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a,viewPAFPD:l={},viewIHP:i={},viewDDS:c={},viewSBA:d={},viewNFIP:u={},viewUSDA:p={}})=>{const m=[l.view_id,i.view_id,c.view_id,d.view_id,u.view_id,p.view_id],h=new URL(`${t}/hazard_mitigation/disasterLossSummaryLoader`);h.searchParams.append("source_name",n.name),h.searchParams.append("existing_source_id",n.source_id),h.searchParams.append("view_dependencies",JSON.stringify(m)),h.searchParams.append("version",r),h.searchParams.append("table_name","disaster_loss_summary"),h.searchParams.append("ofd_schema",l.table_schema),h.searchParams.append("pafpd_table",l.table_name),h.searchParams.append("pafpd_schema",l.table_schema),h.searchParams.append("ihp_table",i.table_name),h.searchParams.append("ihp_schema",i.table_schema),h.searchParams.append("dds_table",c.table_name),h.searchParams.append("dds_schema",c.table_schema),h.searchParams.append("sba_table",d.table_name),h.searchParams.append("sba_schema",d.table_schema),h.searchParams.append("nfip_table",u.table_name),h.searchParams.append("nfip_schema",u.table_schema),h.searchParams.append("usda_table",p.table_name),h.searchParams.append("usda_schema",p.table_schema);const f=await fetch(h);await bt(f);const g=await f.json();console.log("res",g),a(`${s}/source/${g.payload.source_id}/versions`)},FF=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),[l,i]=w.useState(),[c,d]=w.useState(),[u,p]=w.useState(),[m,h]=w.useState(),[f,g]=w.useState(),[x,y]=w.useState(),[j,N]=w.useState({sources:[],views:[]}),[_,E]=w.useState({sources:[],views:[]}),[L,S]=w.useState({sources:[],views:[]}),[k,$]=w.useState({sources:[],views:[]}),[I,T]=w.useState({sources:[],views:[]}),[A,R]=w.useState({sources:[],views:[]}),O=vt(a);return w.useEffect(()=>{async function M(){await Ke({rtPfx:O,setVersions:N,type:"public_assistance_funded_projects_details_v1_enhanced"}),await Ke({rtPfx:O,setVersions:E,type:"individuals_and_households_program_valid_registrations_v1"}),await Ke({rtPfx:O,setVersions:S,type:"disaster_declarations_summaries_v2"}),await Ke({rtPfx:O,setVersions:$,type:"sba_disaster_loan_data_new"}),await Ke({rtPfx:O,setVersions:T,type:"fima_nfip_claims_v1_enhanced"}),await Ke({rtPfx:O,setVersions:R,type:"usda_crop_insurance_cause_of_loss_enhanced"})}M()},[O]),e.jsxs("div",{className:"w-full",children:[Ae({value:u,setValue:p,versions:L,type:"Disaster Declarations Summaries"}),Ae({value:c,setValue:d,versions:_,type:"Individuals and Households Program Valid Registrations"}),Ae({value:l,setValue:i,versions:j,type:"Public Assistance Funded Projects Details"}),Ae({value:m,setValue:h,versions:k,type:"SBA Loan Data"}),Ae({value:f,setValue:g,versions:I,type:"NFIP Claims Enhanced"}),Ae({value:x,setValue:y,versions:A,type:"USDA Crop Loss Enhanced"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>RF({rtPfx:O,baseUrl:n,source:t,newVersion:s,viewPAFPD:j.views.find(M=>M.view_id===parseInt(l)),viewIHP:_.views.find(M=>M.view_id===parseInt(c)),viewDDS:L.views.find(M=>M.view_id===parseInt(u)),viewSBA:k.views.find(M=>M.view_id===parseInt(m)),viewNFIP:I.views.find(M=>M.view_id===parseInt(f)),viewUSDA:A.views.find(M=>M.view_id===parseInt(x)),navigate:r}),children:"Add New Source"})]})},VF={stats:{name:"Stats",path:"/stats",component:()=>e.jsx("div",{children:" No stats "})},sourceCreate:{name:"Create",component:FF}},HF=async({rtPfx:t,baseUrl:s,source:n,newVersion:r,navigate:a,viewDL:l={},viewNCEIE:i={}})=>{const c=[l.view_id,i.view_id],d=new URL(`${t}/hazard_mitigation/fusionLoader`);d.searchParams.append("source_name",n.name),d.searchParams.append("existing_source_id",n.source_id),d.searchParams.append("view_dependencies",JSON.stringify(c)),d.searchParams.append("version",r),d.searchParams.append("table_name","fusion"),d.searchParams.append("dl_table",l.table_name),d.searchParams.append("dl_schema",l.table_schema),d.searchParams.append("nceie_table",i.table_name),d.searchParams.append("nceie_schema",i.table_schema);const u=await fetch(d);await bt(u);const p=await u.json();console.log("res",p),a(`${s}/source/${p.payload.source_id}/versions`)},zF=({source:t,newVersion:s,baseUrl:n})=>{const r=$e(),{pgEnv:a}=w.useContext(ce),[l,i]=w.useState(),[c,d]=w.useState(),[u,p]=w.useState({sources:[],views:[]}),[m,h]=w.useState({sources:[],views:[]}),f=vt(a);return w.useEffect(()=>{async function g(){await Ke({rtPfx:f,setVersions:p,type:"disaster_loss_summary"}),await Ke({rtPfx:f,setVersions:h,type:"ncei_storm_events_enhanced"})}g()},[f]),e.jsxs("div",{className:"w-full",children:[Ae({value:l,setValue:i,versions:u,type:"Open Fema Data"}),Ae({value:c,setValue:d,versions:m,type:"NCEI Enhanced"}),e.jsx("button",{className:"align-right p-2 border-2 border-gray-200",onClick:()=>HF({rtPfx:f,baseUrl:n,source:t,newVersion:s,viewDL:u.views.find(g=>g.view_id===parseInt(l)),viewNCEIE:m.views.find(g=>g.view_id===parseInt(c)),navigate:r}),children:"Add New Source"})]})},UF=(t,s,n)=>e.jsx("select",{className:"w-40 pr-4 py-3 bg-white mr-2 flex items-center text-sm",value:s,onChange:r=>n(r.target.value),children:t.sort((r,a)=>a.view_id-r.view_id).map((r,a)=>e.jsx("option",{value:r.view_id,className:"ml-2  truncate",children:r.version},a))}),WF=({source:t,views:s})=>{const{pgEnv:n,falcor:r,falcorCache:a}=w.useContext(ce),[l,i]=b.useState(s[0].view_id),[c,d]=b.useState(),[u,p]=b.useState(),[m,h]=b.useState("36");b.useState("pd");const f=["dama",n,"viewDependencySubgraphs","byViewId",l],g=["geoid","name"],x=JSON.stringify({}),y=L=>["dama",n,"viewsbyId",L,"options",x];JSON.stringify({});const j=L=>["fusion",n,"source",t.source_id,"view",l,"geoid",L,"fusionVsWds"];b.useEffect(()=>{r.get(f)},[l,n,t.source_id,r]),b.useEffect(()=>{async function L(){const S=C(a,[...f,"value","dependencies"],[]),k=S.find(A=>A.type==="tl_state"),$=S.find(A=>A.type==="disaster_declarations_summaries_v2");d(k==null?void 0:k.view_id),p($==null?void 0:$.view_id);const I=await r.get([...y(k==null?void 0:k.view_id),"length"]),T=C(I,["json",...y(k==null?void 0:k.view_id),"length"],0);await r.get([...y(k==null?void 0:k.view_id),"databyIndex",{from:0,to:T-1},g]),await r.get(j(m))}L()},[a,l,m]);const N=Object.values(C(a,[...y(c),"databyIndex"],{})).filter(L=>L==null?void 0:L.geoid).map(L=>({label:L.name,value:L.geoid})),_=C(a,[...j(m),"value"],[]),E=Object.keys(_[0]||{}).map(L=>({Header:L.replaceAll("_"," "),accessor:L,...L==="date"&&{sortType:(S,k)=>new Date(k.values.date)-new Date(S.values.date)},Cell:S=>{const $=["incident_type","declaration_title","date","wds_disaster_number","disaster_number","nri_category","fema_incident_type"].includes(L)?S.value:qa(S.value||0,!0);return e.jsx("div",{children:$})}}));return console.log("fusionVdDds",_),e.jsxs("div",{className:"max-w-5xl m-auto",children:[e.jsxs("div",{className:"flex flex-row items-center py-4 sm:py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("label",{children:"Current Version: "}),UF(s,l,i)]},"versionSelector"),e.jsx("select",{className:"w-full p-2 bg-blue-50 hover:bg-blue-100",value:m,onChange:L=>h(L.target.value),children:N.map(L=>e.jsx("option",{value:L.value,children:L.label},L.value))}),e.jsx("div",{className:"w-full overflow-auto",children:e.jsx(St,{data:_,columns:E,pageSize:80,sortBy:"date",sortOrder:"desc"})})]})},GF={stats:{name:"Stats",path:"/stats",component:WF},sourceCreate:{name:"Create",component:zF}},JF={tiger_2017:VR,tiger_2017_full:UR,ncei_storm_events:ER,ncei_storm_events_enhanced:PR,usda_crop_insurance_cause_of_loss:JR,usda_crop_insurance_cause_of_loss_enhanced:YR,sba_disaster_loan_data_new:QR,nri:sF,nri_tracts:rF,disaster_declarations_summaries_v2:WD,fema_web_disaster_summaries_v1:XD,fima_nfip_claims_v1_enhanced:sR,individuals_and_households_program_valid_registrations_v1:rR,public_assistance_funded_projects_details_v1:iR,public_assistance_funded_projects_details_v1_enhanced:uR,hazard_mitigation_grant_program_disaster_summaries_v2:hR,hazard_mitigation_assistance_mitigated_properties_v3:xR,hazard_mitigation_assistance_projects_v3:vR,hazard_mitigation_assistance_projects_v3_enhanced:NR,disaster_loss_summary:VF,per_basis:dF,per_basis_fusion:fF,hlr:yF,eal:DF,fusion:GF},qF=[...DD({baseUrl:"/cenrep",defaultPgEnv:"hazmit_dama",dataTypes:JF,useFalcor:et,useAuth:kv}),tI],KF={Routes:qF},Jr={www:KF};function YF(t){const s=R2(window.location.host),n=b.useMemo(()=>(Jr==null?void 0:Jr[s])||Jr.www,[s]),r=b.useMemo(()=>{const a=[...n.Routes,...H2];return D2(a,A2)},[n]);return e.jsxs(e.Fragment,{children:[e.jsx(n1,{router:a1(r)}),e.jsx(Pp,{})]})}window.global||(window.global=window);const ZF=Up(sh),XF=Ev(YF,{AUTH_HOST:L2,PROJECT_NAME:k2,CLIENT_HOST:I2});r1.createRoot(document.getElementById("root")).render(e.jsx(w.StrictMode,{children:e.jsx(o1,{store:zj,children:e.jsx(ow,{falcor:ZF,children:e.jsx(Jp.Provider,{value:E2,children:e.jsx(XF,{})})})})}));export{dh as $,ga as B,gC as C,sl as D,UC as F,fu as I,ru as L,I5 as P,sC as S,xa as T,au as a,Bl as b,vV as c,wV as d,uC as e,jV as f,hC as g,sr as h,_h as i,xr as u};
